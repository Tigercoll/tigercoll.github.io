<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" integrity="sha256-jTIdiMuX/e3DGJUGwl3pKSxuc6YOuqtJYkM0bGQESA4=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"tigercoll.top","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.10.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>



<link rel="canonical" href="https://tigercoll.top/post/99362a3b.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://tigercoll.top/post/99362a3b.html","path":"post/99362a3b.html","title":"Day026：漏洞扫描与基线 - 自动化基线检查与报告"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Day026：漏洞扫描与基线 - 自动化基线检查与报告 | Tigercoll's Blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Tigercoll's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>
	
      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Day026%EF%BC%9A%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F%E4%B8%8E%E5%9F%BA%E7%BA%BF-%E8%87%AA%E5%8A%A8%E5%8C%96%E5%9F%BA%E7%BA%BF%E6%A3%80%E6%9F%A5%E4%B8%8E%E6%8A%A5%E5%91%8A"><span class="nav-number">1.</span> <span class="nav-text">Day026：漏洞扫描与基线 - 自动化基线检查与报告</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87"><span class="nav-number">1.1.</span> <span class="nav-text">学习目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9"><span class="nav-number">1.2.</span> <span class="nav-text">学习内容</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%B8%8F%E2%83%A3-%E8%87%AA%E5%8A%A8%E5%8C%96%E5%9F%BA%E7%BA%BF%E6%A3%80%E6%9F%A5%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="nav-number">1.2.1.</span> <span class="nav-text">1️⃣ 自动化基线检查架构设计</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">1.1 整体架构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-%E4%BB%A3%E7%A0%81%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">1.2 代码目录结构</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%B8%8F%E2%83%A3-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AE%BE%E8%AE%A1"><span class="nav-number">1.2.2.</span> <span class="nav-text">2️⃣ 配置文件设计</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-%E7%9B%AE%E6%A0%87%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE%EF%BC%88targets-json%EF%BC%89"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">2.1 目标主机配置（targets.json）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-%E6%A3%80%E6%9F%A5%E9%A1%B9%E9%85%8D%E7%BD%AE%EF%BC%88checks-yaml%EF%BC%89"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">2.2 检查项配置（checks.yaml）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%EF%B8%8F%E2%83%A3-%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.2.3.</span> <span class="nav-text">3️⃣ 核心代码实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-%E5%9F%BA%E7%A1%80%E6%A3%80%E6%9F%A5%E7%B1%BB%EF%BC%88checks-x2F-base-py%EF%BC%89"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">3.1 基础检查类（checks&#x2F;base.py）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-Web-%E6%A3%80%E6%9F%A5%E6%A8%A1%E5%9D%97%EF%BC%88checks-x2F-web-py%EF%BC%89"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">3.2 Web 检查模块（checks&#x2F;web.py）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%EF%B8%8F%E2%83%A3-%E6%8A%A5%E5%91%8A%E7%94%9F%E6%88%90%E6%A8%A1%E5%9D%97"><span class="nav-number">1.2.4.</span> <span class="nav-text">4️⃣ 报告生成模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-CSV-%E5%AF%BC%E5%87%BA%EF%BC%88reports-x2F-csv-exporter-py%EF%BC%89"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">4.1 CSV 导出（reports&#x2F;csv_exporter.py）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-JSON-%E5%AF%BC%E5%87%BA%EF%BC%88reports-x2F-json-exporter-py%EF%BC%89"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">4.2 JSON 导出（reports&#x2F;json_exporter.py）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%EF%B8%8F%E2%83%A3-%E4%B8%BB%E7%A8%8B%E5%BA%8F%EF%BC%88main-py%EF%BC%89"><span class="nav-number">1.2.5.</span> <span class="nav-text">5️⃣ 主程序（main.py）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6%EF%B8%8F%E2%83%A3-%E9%81%BF%E5%85%8D%E7%A1%AC%E7%BC%96%E7%A0%81%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-number">1.2.6.</span> <span class="nav-text">6️⃣ 避免硬编码的最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-1-%E9%85%8D%E7%BD%AE%E5%88%86%E7%A6%BB"><span class="nav-number">1.2.6.1.</span> <span class="nav-text">6.1 配置分离</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-number">1.2.6.2.</span> <span class="nav-text">6.2 环境变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-3-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0"><span class="nav-number">1.2.6.3.</span> <span class="nav-text">6.3 命令行参数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E8%B7%B5%E4%BB%BB%E5%8A%A1%EF%BC%88%E5%90%88%E6%B3%95%E6%8E%88%E6%9D%83%E8%8C%83%E5%9B%B4%E5%86%85%EF%BC%89"><span class="nav-number">1.3.</span> <span class="nav-text">实践任务（合法授权范围内）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1-1%EF%BC%88%E5%BF%85%E5%81%9A%EF%BC%89%EF%BC%9A%E6%90%AD%E5%BB%BA%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="nav-number">1.3.1.</span> <span class="nav-text">任务 1（必做）：搭建项目结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1-2%EF%BC%88%E5%BF%85%E5%81%9A%EF%BC%89%EF%BC%9A%E5%AE%9E%E7%8E%B0-Web-%E6%A3%80%E6%9F%A5%E6%A8%A1%E5%9D%97"><span class="nav-number">1.3.2.</span> <span class="nav-text">任务 2（必做）：实现 Web 检查模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1-3%EF%BC%88%E5%BF%85%E5%81%9A%EF%BC%89%EF%BC%9A%E5%AE%9E%E7%8E%B0%E6%8A%A5%E5%91%8A%E5%AF%BC%E5%87%BA%E6%A8%A1%E5%9D%97"><span class="nav-number">1.3.3.</span> <span class="nav-text">任务 3（必做）：实现报告导出模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1-4%EF%BC%88%E5%BF%85%E5%81%9A%EF%BC%89%EF%BC%9A%E5%88%9B%E5%BB%BA%E4%B8%BB%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.3.4.</span> <span class="nav-text">任务 4（必做）：创建主程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1-5%EF%BC%88%E5%BF%85%E5%81%9A%EF%BC%89%EF%BC%9A%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95"><span class="nav-number">1.3.5.</span> <span class="nav-text">任务 5（必做）：运行测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1-6%EF%BC%88%E8%BF%9B%E9%98%B6%EF%BC%89%EF%BC%9A%E6%B7%BB%E5%8A%A0%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95"><span class="nav-number">1.3.6.</span> <span class="nav-text">任务 6（进阶）：添加日志记录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1-7%EF%BC%88%E8%BF%9B%E9%98%B6%EF%BC%89%EF%BC%9A%E6%94%AF%E6%8C%81%E5%A4%9A%E7%9B%AE%E6%A0%87%E6%89%B9%E9%87%8F%E6%89%AB%E6%8F%8F"><span class="nav-number">1.3.7.</span> <span class="nav-text">任务 7（进阶）：支持多目标批量扫描</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B7%A9%E5%9B%BA%E7%BB%83%E4%B9%A0%EF%BC%88%E9%A2%98%E4%B8%8E%E5%A4%8D%E7%9B%98%EF%BC%89"><span class="nav-number">1.4.</span> <span class="nav-text">巩固练习（题与复盘）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0-1%EF%BC%9A%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D%E8%84%9A%E6%9C%AC%E7%A1%AC%E7%BC%96%E7%A0%81%EF%BC%9F"><span class="nav-number">1.4.1.</span> <span class="nav-text">练习 1：如何避免脚本硬编码？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0-2%EF%BC%9A%E4%B8%BA%E8%84%9A%E6%9C%AC%E6%B7%BB%E5%8A%A0%E6%97%A5%E5%BF%97%E4%B8%8E%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="nav-number">1.4.2.</span> <span class="nav-text">练习 2：为脚本添加日志与错误处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0-3%EF%BC%9A%E8%AE%BE%E8%AE%A1%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84%E6%A3%80%E6%9F%A5%E6%8F%92%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="nav-number">1.4.3.</span> <span class="nav-text">练习 3：设计可扩展的检查插件系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0-4%EF%BC%9A%E7%94%9F%E6%88%90-HTML-%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8A%A5%E5%91%8A"><span class="nav-number">1.4.4.</span> <span class="nav-text">练习 4：生成 HTML 可视化报告</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%84%E4%BC%B0%E6%A0%87%E5%87%86%EF%BC%88%E8%BE%BE%E6%88%90%E5%88%A4%E5%AE%9A%EF%BC%89"><span class="nav-number">1.5.</span> <span class="nav-text">评估标准（达成判定）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%BE%BE%E6%88%90%E6%83%85%E5%86%B5%EF%BC%88%E7%94%B1%E5%AD%A6%E4%B9%A0%E8%80%85%E5%A1%AB%E5%86%99%EF%BC%89"><span class="nav-number">1.6.</span> <span class="nav-text">学习成果达成情况（由学习者填写）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%88%AA%E5%9B%BE%E4%B8%8E%E8%AF%81%E6%8D%AE"><span class="nav-number">1.6.1.</span> <span class="nav-text">截图与证据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E5%91%BD%E4%BB%A4%E4%B8%8E%E8%BE%93%E5%87%BA%EF%BC%88%E7%B2%98%E8%B4%B4%E5%85%B3%E9%94%AE%E7%89%87%E6%AE%B5%EF%BC%89"><span class="nav-number">1.6.2.</span> <span class="nav-text">关键命令与输出（粘贴关键片段）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E8%AE%BA%E4%B8%8E%E5%8F%8D%E6%80%9D"><span class="nav-number">1.6.3.</span> <span class="nav-text">结论与反思</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9B%86%E4%B8%AD%E5%8F%82%E8%80%83%E7%AD%94%E6%A1%88%EF%BC%88%E5%90%AB%E6%80%9D%E8%B7%AF%EF%BC%89"><span class="nav-number">1.7.</span> <span class="nav-text">集中参考答案（含思路）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0-1-%E5%8F%82%E8%80%83%E7%AD%94%E6%A1%88%EF%BC%9A%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D%E8%84%9A%E6%9C%AC%E7%A1%AC%E7%BC%96%E7%A0%81%EF%BC%9F"><span class="nav-number">1.7.1.</span> <span class="nav-text">练习 1 参考答案：如何避免脚本硬编码？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0-2-%E5%8F%82%E8%80%83%E7%AD%94%E6%A1%88%EF%BC%9A%E4%B8%BA%E8%84%9A%E6%9C%AC%E6%B7%BB%E5%8A%A0%E6%97%A5%E5%BF%97%E4%B8%8E%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="nav-number">1.7.2.</span> <span class="nav-text">练习 2 参考答案：为脚本添加日志与错误处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0-3-%E5%8F%82%E8%80%83%E7%AD%94%E6%A1%88%EF%BC%9A%E8%AE%BE%E8%AE%A1%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84%E6%A3%80%E6%9F%A5%E6%8F%92%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="nav-number">1.7.3.</span> <span class="nav-text">练习 3 参考答案：设计可扩展的检查插件系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0-4-%E5%8F%82%E8%80%83%E7%AD%94%E6%A1%88%EF%BC%9A%E7%94%9F%E6%88%90-HTML-%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8A%A5%E5%91%8A"><span class="nav-number">1.7.4.</span> <span class="nav-text">练习 4 参考答案：生成 HTML 可视化报告</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E7%A4%BA%E4%BE%8B%E5%A1%AB%E5%86%99%EF%BC%88%E5%8F%AF%E7%85%A7%E6%8A%84%EF%BC%89"><span class="nav-number">1.8.</span> <span class="nav-text">学习成果示例填写（可照抄）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%88%AA%E5%9B%BE%E4%B8%8E%E8%AF%81%E6%8D%AE%EF%BC%88%E7%A4%BA%E4%BE%8B%EF%BC%89"><span class="nav-number">1.8.1.</span> <span class="nav-text">截图与证据（示例）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E5%91%BD%E4%BB%A4%E4%B8%8E%E8%BE%93%E5%87%BA%EF%BC%88%E7%A4%BA%E4%BE%8B%EF%BC%89"><span class="nav-number">1.8.2.</span> <span class="nav-text">关键命令与输出（示例）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E8%AE%BA%E4%B8%8E%E5%8F%8D%E6%80%9D%EF%BC%88%E7%A4%BA%E4%BE%8B%EF%BC%89"><span class="nav-number">1.8.3.</span> <span class="nav-text">结论与反思（示例）</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Tigercoll"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Tigercoll</p>
  <div class="site-description" itemprop="description">万丈高楼平地起,勿在浮沙筑高台</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives">
          <span class="site-state-item-count">82</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories">
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags">
        <span class="site-state-item-count">75</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Tigercoll" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Tigercoll" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tigercoll.top/post/99362a3b.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Tigercoll">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tigercoll's Blog">
      <meta itemprop="description" content="万丈高楼平地起,勿在浮沙筑高台">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Day026：漏洞扫描与基线 - 自动化基线检查与报告 | Tigercoll's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Day026：漏洞扫描与基线 - 自动化基线检查与报告
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-01-19 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-19T00:00:00+08:00">2026-01-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络安全</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="Day026：漏洞扫描与基线-自动化基线检查与报告"><a href="#Day026：漏洞扫描与基线-自动化基线检查与报告" class="headerlink" title="Day026：漏洞扫描与基线 - 自动化基线检查与报告"></a>Day026：漏洞扫描与基线 - 自动化基线检查与报告</h1><ul>
<li>日期：2026-01-19</li>
<li>周次：第4周</li>
</ul>
<h2 id="学习目标"><a href="#学习目标" class="headerlink" title="学习目标"></a>学习目标</h2><p>今天你将掌握：</p>
<ul>
<li><strong>将基线检查脚本化</strong>：用 Python 编写可复用的自动化基线检查工具</li>
<li><strong>模块化设计</strong>：分离配置、检查项、报告生成，便于扩展</li>
<li><strong>参数化配置</strong>：避免硬编码，支持命令行参数和配置文件</li>
<li><strong>多目标批量扫描</strong>：支持对多个主机执行基线检查</li>
<li><strong>结构化报告导出</strong>：生成 CSV&#x2F;JSON&#x2F;HTML 格式的汇总报告</li>
</ul>
<hr>
<span id="more"></span>

<h2 id="学习内容"><a href="#学习内容" class="headerlink" title="学习内容"></a>学习内容</h2><h3 id="1️⃣-自动化基线检查架构设计"><a href="#1️⃣-自动化基线检查架构设计" class="headerlink" title="1️⃣ 自动化基线检查架构设计"></a>1️⃣ 自动化基线检查架构设计</h3><h4 id="1-1-整体架构"><a href="#1-1-整体架构" class="headerlink" title="1.1 整体架构"></a>1.1 整体架构</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">自动化基线检查系统</span><br><span class="line">│</span><br><span class="line">├─ 配置层（Configuration Layer）</span><br><span class="line">│  ├─ 目标主机列表（targets.json）</span><br><span class="line">│  ├─ 检查项配置（checks.yaml）</span><br><span class="line">│  └─ 报告模板（template.html）</span><br><span class="line">│</span><br><span class="line">├─ 检查层（Check Layer）</span><br><span class="line">│  ├─ Windows 检查模块</span><br><span class="line">│  ├─ Linux 检查模块</span><br><span class="line">│  └─ Web 检查模块</span><br><span class="line">│</span><br><span class="line">├─ 数据层（Data Layer）</span><br><span class="line">│  ├─ 检查结果存储（results/）</span><br><span class="line">│  └─ 历史记录对比（history/）</span><br><span class="line">│</span><br><span class="line">└─ 报告层（Report Layer）</span><br><span class="line">   ├─ CSV 导出</span><br><span class="line">   ├─ JSON 导出</span><br><span class="line">   └─ HTML 可视化报告</span><br></pre></td></tr></table></figure>

<h4 id="1-2-代码目录结构"><a href="#1-2-代码目录结构" class="headerlink" title="1.2 代码目录结构"></a>1.2 代码目录结构</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">baseline_checker/</span><br><span class="line">├── config/</span><br><span class="line">│   ├── targets.json          # 扫描目标列表</span><br><span class="line">│   ├── checks.yaml           # 检查项配置</span><br><span class="line">│   └── thresholds.json       # 风险阈值</span><br><span class="line">├── checks/</span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   ├── base.py              # 检查基类</span><br><span class="line">│   ├── windows.py           # Windows 检查项</span><br><span class="line">│   ├── linux.py             # Linux 检查项</span><br><span class="line">│   └── web.py               # Web 检查项</span><br><span class="line">├── reports/</span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   ├── csv_exporter.py      # CSV 导出</span><br><span class="line">│   ├── json_exporter.py    # JSON 导出</span><br><span class="line">│   └── html_generator.py    # HTML 生成</span><br><span class="line">├── main.py                  # 主入口</span><br><span class="line">├── utils.py                 # 工具函数</span><br><span class="line">└── requirements.txt         # 依赖列表</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="2️⃣-配置文件设计"><a href="#2️⃣-配置文件设计" class="headerlink" title="2️⃣ 配置文件设计"></a>2️⃣ 配置文件设计</h3><h4 id="2-1-目标主机配置（targets-json）"><a href="#2-1-目标主机配置（targets-json）" class="headerlink" title="2.1 目标主机配置（targets.json）"></a>2.1 目标主机配置（targets.json）</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Web服务器-01&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;web&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://192.168.1.10:8080&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;前端应用服务器&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;应用服务器-01&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;192.168.1.20&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;ssh_user&quot;</span><span class="punctuation">:</span> <span class="string">&quot;root&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;ssh_key_path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;~/.ssh/id_rsa&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;后端应用服务器&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;数据库服务器&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;windows&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;192.168.1.30&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;winrm_user&quot;</span><span class="punctuation">:</span> <span class="string">&quot;administrator&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;winrm_password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;encrypted_password&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;SQL Server&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-检查项配置（checks-yaml）"><a href="#2-2-检查项配置（checks-yaml）" class="headerlink" title="2.2 检查项配置（checks.yaml）"></a>2.2 检查项配置（checks.yaml）</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">checks:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;版本信息泄露&quot;</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">&quot;header&quot;</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">&quot;medium&quot;</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;安全响应头&quot;</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">&quot;headers_check&quot;</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">&quot;high&quot;</span></span><br><span class="line">      <span class="attr">headers_required:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">X-Frame-Options</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">X-Content-Type-Options</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;目录列出&quot;</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">&quot;directory_listing&quot;</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">&quot;high&quot;</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/uploads/</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/backup/</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">linux:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;SSH 配置检查&quot;</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">&quot;ssh_config&quot;</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">&quot;high&quot;</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;防火墙状态&quot;</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">&quot;firewall&quot;</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">&quot;medium&quot;</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;补丁更新状态&quot;</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">&quot;patches&quot;</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">&quot;high&quot;</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">windows:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;密码策略&quot;</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">&quot;password_policy&quot;</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">&quot;high&quot;</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;管理员组成员&quot;</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">&quot;admin_users&quot;</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">&quot;medium&quot;</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="3️⃣-核心代码实现"><a href="#3️⃣-核心代码实现" class="headerlink" title="3️⃣ 核心代码实现"></a>3️⃣ 核心代码实现</h3><h4 id="3-1-基础检查类（checks-x2F-base-py）"><a href="#3-1-基础检查类（checks-x2F-base-py）" class="headerlink" title="3.1 基础检查类（checks&#x2F;base.py）"></a>3.1 基础检查类（checks&#x2F;base.py）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Severity</span>(<span class="title class_ inherited__">Enum</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;风险等级&quot;&quot;&quot;</span></span><br><span class="line">    CRITICAL = <span class="string">&quot;critical&quot;</span></span><br><span class="line">    HIGH = <span class="string">&quot;high&quot;</span></span><br><span class="line">    MEDIUM = <span class="string">&quot;medium&quot;</span></span><br><span class="line">    LOW = <span class="string">&quot;low&quot;</span></span><br><span class="line">    INFO = <span class="string">&quot;info&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CheckStatus</span>(<span class="title class_ inherited__">Enum</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;检查状态&quot;&quot;&quot;</span></span><br><span class="line">    PASSED = <span class="string">&quot;passed&quot;</span></span><br><span class="line">    FAILED = <span class="string">&quot;failed&quot;</span></span><br><span class="line">    WARNING = <span class="string">&quot;warning&quot;</span></span><br><span class="line">    SKIPPED = <span class="string">&quot;skipped&quot;</span></span><br><span class="line">    ERROR = <span class="string">&quot;error&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CheckResult</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;检查结果&quot;&quot;&quot;</span></span><br><span class="line">    check_name: <span class="built_in">str</span></span><br><span class="line">    status: CheckStatus</span><br><span class="line">    severity: Severity</span><br><span class="line">    message: <span class="built_in">str</span></span><br><span class="line">    details: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    recommendation: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    timestamp: datetime = datetime.now()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaseCheck</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;检查基类&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name: <span class="built_in">str</span>, severity: Severity = Severity.MEDIUM</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.severity = severity</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, target: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>) -&gt; CheckResult:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;执行检查</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            target: 目标主机配置</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            CheckResult: 检查结果</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_create_passed_result</span>(<span class="params">self, message: <span class="built_in">str</span>, details: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] | <span class="literal">None</span> = <span class="literal">None</span></span>) -&gt; CheckResult:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;创建通过结果&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> CheckResult(</span><br><span class="line">            check_name=self.name,</span><br><span class="line">            status=CheckStatus.PASSED,</span><br><span class="line">            severity=self.severity,</span><br><span class="line">            message=message,</span><br><span class="line">            details=details</span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_create_failed_result</span>(<span class="params">self, message: <span class="built_in">str</span>, recommendation: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span>, </span></span><br><span class="line"><span class="params">                               details: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] | <span class="literal">None</span> = <span class="literal">None</span></span>) -&gt; CheckResult:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;创建失败结果&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> CheckResult(</span><br><span class="line">            check_name=self.name,</span><br><span class="line">            status=CheckStatus.FAILED,</span><br><span class="line">            severity=self.severity,</span><br><span class="line">            message=message,</span><br><span class="line">            recommendation=recommendation,</span><br><span class="line">            details=details</span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_create_error_result</span>(<span class="params">self, message: <span class="built_in">str</span>, details: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] | <span class="literal">None</span> = <span class="literal">None</span></span>) -&gt; CheckResult:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;创建错误结果&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> CheckResult(</span><br><span class="line">            check_name=self.name,</span><br><span class="line">            status=CheckStatus.ERROR,</span><br><span class="line">            severity=self.severity,</span><br><span class="line">            message=message,</span><br><span class="line">            details=details</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>

<h4 id="3-2-Web-检查模块（checks-x2F-web-py）"><a href="#3-2-Web-检查模块（checks-x2F-web-py）" class="headerlink" title="3.2 Web 检查模块（checks&#x2F;web.py）"></a>3.2 Web 检查模块（checks&#x2F;web.py）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urljoin</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> checks.base <span class="keyword">import</span> BaseCheck, CheckResult, Severity, CheckStatus</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VersionDisclosureCheck</span>(<span class="title class_ inherited__">BaseCheck</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;版本信息泄露检查&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="string">&quot;版本信息泄露&quot;</span>, Severity.MEDIUM)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, target: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>) -&gt; CheckResult:</span><br><span class="line">        url = target[<span class="string">&quot;url&quot;</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            resp = requests.head(url, timeout=<span class="number">10</span>)</span><br><span class="line">            </span><br><span class="line">            server = resp.headers.get(<span class="string">&quot;Server&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">            x_powered = resp.headers.get(<span class="string">&quot;X-Powered-By&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            issues = []</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 检查 Server 头是否包含版本号</span></span><br><span class="line">            <span class="keyword">if</span> server <span class="keyword">and</span> <span class="built_in">any</span>(char.isdigit() <span class="keyword">for</span> char <span class="keyword">in</span> server):</span><br><span class="line">                issues.append(<span class="string">f&quot;Server 头暴露版本: <span class="subst">&#123;server&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 检查 X-Powered-By 头</span></span><br><span class="line">            <span class="keyword">if</span> x_powered:</span><br><span class="line">                issues.append(<span class="string">f&quot;X-Powered-By 头暴露技术栈: <span class="subst">&#123;x_powered&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> issues:</span><br><span class="line">                <span class="keyword">return</span> self._create_failed_result(</span><br><span class="line">                    message=<span class="string">f&quot;发现 <span class="subst">&#123;<span class="built_in">len</span>(issues)&#125;</span> 个版本信息泄露问题&quot;</span>,</span><br><span class="line">                    recommendation=<span class="string">&quot;配置服务器隐藏版本号&quot;</span>,</span><br><span class="line">                    details=&#123;<span class="string">&quot;issues&quot;</span>: issues, <span class="string">&quot;headers&quot;</span>: <span class="built_in">dict</span>(resp.headers)&#125;</span><br><span class="line">                )</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> self._create_passed_result(</span><br><span class="line">                message=<span class="string">&quot;未发现版本信息泄露&quot;</span>,</span><br><span class="line">                details=&#123;<span class="string">&quot;server&quot;</span>: server&#125;</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> self._create_error_result(</span><br><span class="line">                message=<span class="string">f&quot;检查失败: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SecurityHeadersCheck</span>(<span class="title class_ inherited__">BaseCheck</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;安全响应头检查&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    REQUIRED_HEADERS = [</span><br><span class="line">        <span class="string">&quot;X-Frame-Options&quot;</span>,</span><br><span class="line">        <span class="string">&quot;X-Content-Type-Options&quot;</span>,</span><br><span class="line">        <span class="string">&quot;X-XSS-Protection&quot;</span></span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, required_headers: <span class="built_in">list</span>[<span class="built_in">str</span>] | <span class="literal">None</span> = <span class="literal">None</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="string">&quot;安全响应头检查&quot;</span>, Severity.HIGH)</span><br><span class="line">        self.required_headers = required_headers <span class="keyword">or</span> self.REQUIRED_HEADERS</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, target: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>) -&gt; CheckResult:</span><br><span class="line">        url = target[<span class="string">&quot;url&quot;</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            resp = requests.head(url, timeout=<span class="number">10</span>)</span><br><span class="line">            headers = resp.headers</span><br><span class="line">            </span><br><span class="line">            missing = []</span><br><span class="line">            present = []</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> header <span class="keyword">in</span> self.required_headers:</span><br><span class="line">                <span class="keyword">if</span> header <span class="keyword">in</span> headers:</span><br><span class="line">                    present.append(header)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    missing.append(header)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> missing:</span><br><span class="line">                <span class="keyword">return</span> self._create_failed_result(</span><br><span class="line">                    message=<span class="string">f&quot;缺少 <span class="subst">&#123;<span class="built_in">len</span>(missing)&#125;</span> 个安全响应头&quot;</span>,</span><br><span class="line">                    recommendation=<span class="string">f&quot;配置以下响应头: <span class="subst">&#123;<span class="string">&#x27;, &#x27;</span>.join(missing)&#125;</span>&quot;</span>,</span><br><span class="line">                    details=&#123;</span><br><span class="line">                        <span class="string">&quot;missing&quot;</span>: missing,</span><br><span class="line">                        <span class="string">&quot;present&quot;</span>: present,</span><br><span class="line">                        <span class="string">&quot;all_headers&quot;</span>: <span class="built_in">dict</span>(headers)</span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> self._create_passed_result(</span><br><span class="line">                message=<span class="string">f&quot;所有必需的安全响应头已配置 (<span class="subst">&#123;<span class="built_in">len</span>(present)&#125;</span> 个)&quot;</span>,</span><br><span class="line">                details=&#123;<span class="string">&quot;headers&quot;</span>: present&#125;</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> self._create_error_result(</span><br><span class="line">                message=<span class="string">f&quot;检查失败: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HTTPMethodsCheck</span>(<span class="title class_ inherited__">BaseCheck</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;HTTP 方法限制检查&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    DANGEROUS_METHODS = [<span class="string">&quot;TRACE&quot;</span>, <span class="string">&quot;OPTIONS&quot;</span>, <span class="string">&quot;PUT&quot;</span>, <span class="string">&quot;DELETE&quot;</span>, <span class="string">&quot;PATCH&quot;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="string">&quot;HTTP 方法限制&quot;</span>, Severity.HIGH)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, target: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>) -&gt; CheckResult:</span><br><span class="line">        url = target[<span class="string">&quot;url&quot;</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            allowed = []</span><br><span class="line">            blocked = []</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> method <span class="keyword">in</span> self.DANGEROUS_METHODS:</span><br><span class="line">                resp = requests.request(method, url, timeout=<span class="number">10</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> resp.status_code <span class="keyword">in</span> [<span class="number">405</span>, <span class="number">501</span>]:</span><br><span class="line">                    blocked.append(method)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    allowed.append(method)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> allowed:</span><br><span class="line">                <span class="keyword">return</span> self._create_failed_result(</span><br><span class="line">                    message=<span class="string">f&quot;<span class="subst">&#123;<span class="built_in">len</span>(allowed)&#125;</span> 个危险方法被允许&quot;</span>,</span><br><span class="line">                    recommendation=<span class="string">&quot;在服务器配置中禁用不必要的 HTTP 方法&quot;</span>,</span><br><span class="line">                    details=&#123;</span><br><span class="line">                        <span class="string">&quot;allowed&quot;</span>: allowed,</span><br><span class="line">                        <span class="string">&quot;blocked&quot;</span>: blocked</span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> self._create_passed_result(</span><br><span class="line">                message=<span class="string">f&quot;所有危险方法已被禁用 (<span class="subst">&#123;<span class="built_in">len</span>(blocked)&#125;</span> 个)&quot;</span>,</span><br><span class="line">                details=&#123;<span class="string">&quot;blocked&quot;</span>: blocked&#125;</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> self._create_error_result(</span><br><span class="line">                message=<span class="string">f&quot;检查失败: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DirectoryListingCheck</span>(<span class="title class_ inherited__">BaseCheck</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;目录列出检查&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, paths: <span class="built_in">list</span>[<span class="built_in">str</span>] | <span class="literal">None</span> = <span class="literal">None</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="string">&quot;目录列出检查&quot;</span>, Severity.HIGH)</span><br><span class="line">        self.paths = paths <span class="keyword">or</span> [<span class="string">&quot;/uploads/&quot;</span>, <span class="string">&quot;/backup/&quot;</span>, <span class="string">&quot;/images/&quot;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, target: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>) -&gt; CheckResult:</span><br><span class="line">        base_url = target[<span class="string">&quot;url&quot;</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            listing_dirs = []</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> path <span class="keyword">in</span> self.paths:</span><br><span class="line">                url = urljoin(base_url, path)</span><br><span class="line">                resp = requests.get(url, timeout=<span class="number">10</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 简单判断目录列出</span></span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;Index of&quot;</span> <span class="keyword">in</span> resp.text <span class="keyword">or</span> <span class="string">&quot;Parent Directory&quot;</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">                    listing_dirs.append(url)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> listing_dirs:</span><br><span class="line">                <span class="keyword">return</span> self._create_failed_result(</span><br><span class="line">                    message=<span class="string">f&quot;<span class="subst">&#123;<span class="built_in">len</span>(listing_dirs)&#125;</span> 个目录可被列出&quot;</span>,</span><br><span class="line">                    recommendation=<span class="string">&quot;关闭目录列出功能（Nginx: autoindex off, Apache: Options -Indexes）&quot;</span>,</span><br><span class="line">                    details=&#123;<span class="string">&quot;directories&quot;</span>: listing_dirs&#125;</span><br><span class="line">                )</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> self._create_passed_result(</span><br><span class="line">                message=<span class="string">&quot;未发现目录列出风险&quot;</span>,</span><br><span class="line">                details=&#123;<span class="string">&quot;checked_paths&quot;</span>: self.paths&#125;</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> self._create_error_result(</span><br><span class="line">                message=<span class="string">f&quot;检查失败: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br><span class="line">            )</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="4️⃣-报告生成模块"><a href="#4️⃣-报告生成模块" class="headerlink" title="4️⃣ 报告生成模块"></a>4️⃣ 报告生成模块</h3><h4 id="4-1-CSV-导出（reports-x2F-csv-exporter-py）"><a href="#4-1-CSV-导出（reports-x2F-csv-exporter-py）" class="headerlink" title="4.1 CSV 导出（reports&#x2F;csv_exporter.py）"></a>4.1 CSV 导出（reports&#x2F;csv_exporter.py）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> checks.base <span class="keyword">import</span> CheckResult</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CSVExporter</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;CSV 格式导出器&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, output_dir: <span class="built_in">str</span> = <span class="string">&quot;results&quot;</span></span>):</span><br><span class="line">        self.output_dir = Path(output_dir)</span><br><span class="line">        self.output_dir.mkdir(exist_ok=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">export</span>(<span class="params">self, results: <span class="built_in">list</span>[<span class="built_in">tuple</span>[<span class="built_in">str</span>, <span class="built_in">list</span>[CheckResult]]], filename: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;导出检查结果为 CSV</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            results: [(target_name, [CheckResult, ...]), ...]</span></span><br><span class="line"><span class="string">            filename: 输出文件名（默认带时间戳）</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            str: 导出文件路径</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> filename <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line">            filename = <span class="string">f&quot;baseline_report_<span class="subst">&#123;datetime.now().strftime(<span class="string">&#x27;%Y%m%d_%H%M%S&#x27;</span>)&#125;</span>.csv&quot;</span></span><br><span class="line">        </span><br><span class="line">        filepath = self.output_dir / filename</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&quot;w&quot;</span>, newline=<span class="string">&quot;&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            writer = csv.writer(f)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 写入表头</span></span><br><span class="line">            writer.writerow([</span><br><span class="line">                <span class="string">&quot;目标名称&quot;</span>, <span class="string">&quot;检查项&quot;</span>, <span class="string">&quot;状态&quot;</span>, <span class="string">&quot;风险等级&quot;</span>, </span><br><span class="line">                <span class="string">&quot;消息&quot;</span>, <span class="string">&quot;建议&quot;</span>, <span class="string">&quot;时间&quot;</span></span><br><span class="line">            ])</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 写入数据</span></span><br><span class="line">            <span class="keyword">for</span> target_name, check_results <span class="keyword">in</span> results:</span><br><span class="line">                <span class="keyword">for</span> result <span class="keyword">in</span> check_results:</span><br><span class="line">                    writer.writerow([</span><br><span class="line">                        target_name,</span><br><span class="line">                        result.check_name,</span><br><span class="line">                        result.status.value,</span><br><span class="line">                        result.severity.value,</span><br><span class="line">                        result.message,</span><br><span class="line">                        result.recommendation <span class="keyword">or</span> <span class="string">&quot;&quot;</span>,</span><br><span class="line">                        result.timestamp.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">                    ])</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(filepath)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">export_summary</span>(<span class="params">self, results: <span class="built_in">list</span>[<span class="built_in">tuple</span>[<span class="built_in">str</span>, <span class="built_in">list</span>[CheckResult]]], filename: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;导出汇总报告</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            results: [(target_name, [CheckResult, ...]), ...]</span></span><br><span class="line"><span class="string">            filename: 输出文件名</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            str: 导出文件路径</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> filename <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line">            filename = <span class="string">f&quot;baseline_summary_<span class="subst">&#123;datetime.now().strftime(<span class="string">&#x27;%Y%m%d_%H%M%S&#x27;</span>)&#125;</span>.csv&quot;</span></span><br><span class="line">        </span><br><span class="line">        filepath = self.output_dir / filename</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 统计各目标的结果</span></span><br><span class="line">        summary_data = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> target_name, check_results <span class="keyword">in</span> results:</span><br><span class="line">            passed = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> r <span class="keyword">in</span> check_results <span class="keyword">if</span> r.status.value == <span class="string">&quot;passed&quot;</span>)</span><br><span class="line">            failed = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> r <span class="keyword">in</span> check_results <span class="keyword">if</span> r.status.value == <span class="string">&quot;failed&quot;</span>)</span><br><span class="line">            error = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> r <span class="keyword">in</span> check_results <span class="keyword">if</span> r.status.value == <span class="string">&quot;error&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            high_risk = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> r <span class="keyword">in</span> check_results </span><br><span class="line">                          <span class="keyword">if</span> r.status.value == <span class="string">&quot;failed&quot;</span> <span class="keyword">and</span> r.severity.value <span class="keyword">in</span> [<span class="string">&quot;critical&quot;</span>, <span class="string">&quot;high&quot;</span>])</span><br><span class="line">            </span><br><span class="line">            summary_data.append(&#123;</span><br><span class="line">                <span class="string">&quot;目标名称&quot;</span>: target_name,</span><br><span class="line">                <span class="string">&quot;总检查项&quot;</span>: <span class="built_in">len</span>(check_results),</span><br><span class="line">                <span class="string">&quot;通过&quot;</span>: passed,</span><br><span class="line">                <span class="string">&quot;失败&quot;</span>: failed,</span><br><span class="line">                <span class="string">&quot;错误&quot;</span>: error,</span><br><span class="line">                <span class="string">&quot;高危项&quot;</span>: high_risk,</span><br><span class="line">                <span class="string">&quot;通过率&quot;</span>: <span class="string">f&quot;<span class="subst">&#123;passed / <span class="built_in">len</span>(check_results) * <span class="number">100</span>:<span class="number">.1</span>f&#125;</span>%&quot;</span> <span class="keyword">if</span> check_results <span class="keyword">else</span> <span class="string">&quot;N/A&quot;</span></span><br><span class="line">            &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 写入 CSV</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&quot;w&quot;</span>, newline=<span class="string">&quot;&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            writer = csv.DictWriter(f, fieldnames=[</span><br><span class="line">                <span class="string">&quot;目标名称&quot;</span>, <span class="string">&quot;总检查项&quot;</span>, <span class="string">&quot;通过&quot;</span>, <span class="string">&quot;失败&quot;</span>, <span class="string">&quot;错误&quot;</span>, <span class="string">&quot;高危项&quot;</span>, <span class="string">&quot;通过率&quot;</span></span><br><span class="line">            ])</span><br><span class="line">            writer.writeheader()</span><br><span class="line">            writer.writerows(summary_data)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(filepath)</span><br></pre></td></tr></table></figure>

<h4 id="4-2-JSON-导出（reports-x2F-json-exporter-py）"><a href="#4-2-JSON-导出（reports-x2F-json-exporter-py）" class="headerlink" title="4.2 JSON 导出（reports&#x2F;json_exporter.py）"></a>4.2 JSON 导出（reports&#x2F;json_exporter.py）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> checks.base <span class="keyword">import</span> CheckResult</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JSONExporter</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;JSON 格式导出器&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, output_dir: <span class="built_in">str</span> = <span class="string">&quot;results&quot;</span></span>):</span><br><span class="line">        self.output_dir = Path(output_dir)</span><br><span class="line">        self.output_dir.mkdir(exist_ok=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">export</span>(<span class="params">self, results: <span class="built_in">list</span>[<span class="built_in">tuple</span>[<span class="built_in">str</span>, <span class="built_in">list</span>[CheckResult]]], filename: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;导出检查结果为 JSON&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> filename <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            filename = <span class="string">f&quot;baseline_report_<span class="subst">&#123;datetime.now().strftime(<span class="string">&#x27;%Y%m%d_%H%M%S&#x27;</span>)&#125;</span>.json&quot;</span></span><br><span class="line">        </span><br><span class="line">        filepath = self.output_dir / filename</span><br><span class="line">        </span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;report_time&quot;</span>: datetime.now().isoformat(),</span><br><span class="line">            <span class="string">&quot;summary&quot;</span>: self._generate_summary(results),</span><br><span class="line">            <span class="string">&quot;targets&quot;</span>: []</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> target_name, check_results <span class="keyword">in</span> results:</span><br><span class="line">            target_data = &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: target_name,</span><br><span class="line">                <span class="string">&quot;checks&quot;</span>: []</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> result <span class="keyword">in</span> check_results:</span><br><span class="line">                target_data[<span class="string">&quot;checks&quot;</span>].append(&#123;</span><br><span class="line">                    <span class="string">&quot;name&quot;</span>: result.check_name,</span><br><span class="line">                    <span class="string">&quot;status&quot;</span>: result.status.value,</span><br><span class="line">                    <span class="string">&quot;severity&quot;</span>: result.severity.value,</span><br><span class="line">                    <span class="string">&quot;message&quot;</span>: result.message,</span><br><span class="line">                    <span class="string">&quot;recommendation&quot;</span>: result.recommendation,</span><br><span class="line">                    <span class="string">&quot;timestamp&quot;</span>: result.timestamp.isoformat(),</span><br><span class="line">                    <span class="string">&quot;details&quot;</span>: result.details</span><br><span class="line">                &#125;)</span><br><span class="line">            </span><br><span class="line">            data[<span class="string">&quot;targets&quot;</span>].append(target_data)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            json.dump(data, f, indent=<span class="number">2</span>, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(filepath)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_generate_summary</span>(<span class="params">self, results: <span class="built_in">list</span>[<span class="built_in">tuple</span>[<span class="built_in">str</span>, <span class="built_in">list</span>[CheckResult]]]</span>) -&gt; <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;生成汇总信息&quot;&quot;&quot;</span></span><br><span class="line">        total_checks = <span class="built_in">sum</span>(<span class="built_in">len</span>(checks) <span class="keyword">for</span> _, checks <span class="keyword">in</span> results)</span><br><span class="line">        total_passed = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> _, checks <span class="keyword">in</span> results <span class="keyword">for</span> r <span class="keyword">in</span> checks <span class="keyword">if</span> r.status.value == <span class="string">&quot;passed&quot;</span>)</span><br><span class="line">        total_failed = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> _, checks <span class="keyword">in</span> results <span class="keyword">for</span> r <span class="keyword">in</span> checks <span class="keyword">if</span> r.status.value == <span class="string">&quot;failed&quot;</span>)</span><br><span class="line">        total_high_risk = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> _, checks <span class="keyword">in</span> results </span><br><span class="line">                           <span class="keyword">for</span> r <span class="keyword">in</span> checks <span class="keyword">if</span> r.status.value == <span class="string">&quot;failed&quot;</span> <span class="keyword">and</span> r.severity.value <span class="keyword">in</span> [<span class="string">&quot;critical&quot;</span>, <span class="string">&quot;high&quot;</span>])</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;total_targets&quot;</span>: <span class="built_in">len</span>(results),</span><br><span class="line">            <span class="string">&quot;total_checks&quot;</span>: total_checks,</span><br><span class="line">            <span class="string">&quot;passed&quot;</span>: total_passed,</span><br><span class="line">            <span class="string">&quot;failed&quot;</span>: total_failed,</span><br><span class="line">            <span class="string">&quot;high_risk_items&quot;</span>: total_high_risk,</span><br><span class="line">            <span class="string">&quot;pass_rate&quot;</span>: <span class="string">f&quot;<span class="subst">&#123;total_passed / total_checks * <span class="number">100</span>:<span class="number">.1</span>f&#125;</span>%&quot;</span> <span class="keyword">if</span> total_checks &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&quot;N/A&quot;</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5️⃣-主程序（main-py）"><a href="#5️⃣-主程序（main-py）" class="headerlink" title="5️⃣ 主程序（main.py）"></a>5️⃣ 主程序（main.py）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">自动化基线检查主程序</span></span><br><span class="line"><span class="string">用法: python main.py --config config/targets.json --output results/</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> checks.web <span class="keyword">import</span> VersionDisclosureCheck, SecurityHeadersCheck, HTTPMethodsCheck, DirectoryListingCheck</span><br><span class="line"><span class="keyword">from</span> checks.base <span class="keyword">import</span> CheckStatus, Severity</span><br><span class="line"><span class="keyword">from</span> reports.csv_exporter <span class="keyword">import</span> CSVExporter</span><br><span class="line"><span class="keyword">from</span> reports.json_exporter <span class="keyword">import</span> JSONExporter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_targets</span>(<span class="params">config_path: <span class="built_in">str</span></span>) -&gt; <span class="built_in">list</span>[<span class="built_in">dict</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;加载目标配置&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(config_path, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = json.load(f)</span><br><span class="line">    <span class="keyword">return</span> data.get(<span class="string">&quot;targets&quot;</span>, [])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_web_checks</span>(<span class="params">target: <span class="built_in">dict</span></span>) -&gt; <span class="built_in">list</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;执行 Web 检查&quot;&quot;&quot;</span></span><br><span class="line">    checks = [</span><br><span class="line">        VersionDisclosureCheck(),</span><br><span class="line">        SecurityHeadersCheck(),</span><br><span class="line">        HTTPMethodsCheck(),</span><br><span class="line">        DirectoryListingCheck(),</span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    results = []</span><br><span class="line">    <span class="keyword">for</span> check <span class="keyword">in</span> checks:</span><br><span class="line">        result = check.execute(target)</span><br><span class="line">        results.append(result)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 打印实时结果</span></span><br><span class="line">        icon = <span class="string">&quot;✅&quot;</span> <span class="keyword">if</span> result.status == CheckStatus.PASSED <span class="keyword">else</span> <span class="string">&quot;❌&quot;</span></span><br><span class="line">        severity_icon = &#123;</span><br><span class="line">            <span class="string">&quot;critical&quot;</span>: <span class="string">&quot;🔴&quot;</span>,</span><br><span class="line">            <span class="string">&quot;high&quot;</span>: <span class="string">&quot;🟠&quot;</span>,</span><br><span class="line">            <span class="string">&quot;medium&quot;</span>: <span class="string">&quot;🟡&quot;</span>,</span><br><span class="line">            <span class="string">&quot;low&quot;</span>: <span class="string">&quot;🟢&quot;</span>,</span><br><span class="line">            <span class="string">&quot;info&quot;</span>: <span class="string">&quot;🔵&quot;</span></span><br><span class="line">        &#125;.get(result.severity.value, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;icon&#125;</span> <span class="subst">&#123;severity_icon&#125;</span> [<span class="subst">&#123;result.check_name&#125;</span>] <span class="subst">&#123;result.message&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_checks</span>(<span class="params">targets: <span class="built_in">list</span>[<span class="built_in">dict</span>]</span>) -&gt; <span class="built_in">list</span>[<span class="built_in">tuple</span>[<span class="built_in">str</span>, <span class="built_in">list</span>]]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;执行所有检查&quot;&quot;&quot;</span></span><br><span class="line">    all_results = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> target <span class="keyword">in</span> targets:</span><br><span class="line">        target_name = target.get(<span class="string">&quot;name&quot;</span>, target.get(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;Unknown&quot;</span>))</span><br><span class="line">        target_type = target.get(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;unknown&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n<span class="subst">&#123;<span class="string">&#x27;=&#x27;</span> * <span class="number">60</span>&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;扫描目标: <span class="subst">&#123;target_name&#125;</span> (<span class="subst">&#123;target_type&#125;</span>)&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;<span class="string">&#x27;=&#x27;</span> * <span class="number">60</span>&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> target_type == <span class="string">&quot;web&quot;</span>:</span><br><span class="line">            results = run_web_checks(target)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;⚠️  暂不支持 <span class="subst">&#123;target_type&#125;</span> 类型&quot;</span>)</span><br><span class="line">            results = []</span><br><span class="line">        </span><br><span class="line">        all_results.append((target_name, results))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> all_results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_reports</span>(<span class="params">results: <span class="built_in">list</span>[<span class="built_in">tuple</span>[<span class="built_in">str</span>, <span class="built_in">list</span>]], output_dir: <span class="built_in">str</span>, formats: <span class="built_in">list</span>[<span class="built_in">str</span>]</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;生成报告&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line">    </span><br><span class="line">    timestamp = datetime.now().strftime(<span class="string">&quot;%Y%m%d_%H%M%S&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n<span class="subst">&#123;<span class="string">&#x27;=&#x27;</span> * <span class="number">60</span>&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;生成报告...&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;<span class="string">&#x27;=&#x27;</span> * <span class="number">60</span>&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> fmt <span class="keyword">in</span> formats:</span><br><span class="line">        <span class="keyword">if</span> fmt == <span class="string">&quot;csv&quot;</span>:</span><br><span class="line">            exporter = CSVExporter(output_dir)</span><br><span class="line">            path = exporter.export(results)</span><br><span class="line">            summary_path = exporter.export_summary(results)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;✅ CSV 报告: <span class="subst">&#123;path&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;✅ CSV 汇总: <span class="subst">&#123;summary_path&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;json&quot;</span>:</span><br><span class="line">            exporter = JSONExporter(output_dir)</span><br><span class="line">            path = exporter.export(results)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;✅ JSON 报告: <span class="subst">&#123;path&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&quot;自动化基线检查工具&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--config&quot;</span>, <span class="string">&quot;-c&quot;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&quot;目标配置文件路径&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--output&quot;</span>, <span class="string">&quot;-o&quot;</span>, default=<span class="string">&quot;results&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;输出目录&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--format&quot;</span>, <span class="string">&quot;-f&quot;</span>, nargs=<span class="string">&quot;+&quot;</span>, default=[<span class="string">&quot;csv&quot;</span>, <span class="string">&quot;json&quot;</span>],</span><br><span class="line">                       choices=[<span class="string">&quot;csv&quot;</span>, <span class="string">&quot;json&quot;</span>], <span class="built_in">help</span>=<span class="string">&quot;报告格式&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 加载配置</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> Path(args.config).exists():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;❌ 配置文件不存在: <span class="subst">&#123;args.config&#125;</span>&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    targets = load_targets(args.config)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;加载了 <span class="subst">&#123;<span class="built_in">len</span>(targets)&#125;</span> 个扫描目标&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 执行检查</span></span><br><span class="line">    results = run_checks(targets)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 生成报告</span></span><br><span class="line">    generate_reports(results, args.output, args.<span class="built_in">format</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 打印汇总</span></span><br><span class="line">    total_checks = <span class="built_in">sum</span>(<span class="built_in">len</span>(checks) <span class="keyword">for</span> _, checks <span class="keyword">in</span> results)</span><br><span class="line">    total_passed = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> _, checks <span class="keyword">in</span> results <span class="keyword">for</span> r <span class="keyword">in</span> checks <span class="keyword">if</span> r.status == CheckStatus.PASSED)</span><br><span class="line">    total_failed = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> _, checks <span class="keyword">in</span> results <span class="keyword">for</span> r <span class="keyword">in</span> checks <span class="keyword">if</span> r.status == CheckStatus.FAILED)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n<span class="subst">&#123;<span class="string">&#x27;=&#x27;</span> * <span class="number">60</span>&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;检查完成！&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;<span class="string">&#x27;=&#x27;</span> * <span class="number">60</span>&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;总检查项: <span class="subst">&#123;total_checks&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;通过: <span class="subst">&#123;total_passed&#125;</span> ✅&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;失败: <span class="subst">&#123;total_failed&#125;</span> ❌&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;通过率: <span class="subst">&#123;total_passed / total_checks * <span class="number">100</span>:<span class="number">.1</span>f&#125;</span>%&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;<span class="string">&#x27;=&#x27;</span> * <span class="number">60</span>&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="6️⃣-避免硬编码的最佳实践"><a href="#6️⃣-避免硬编码的最佳实践" class="headerlink" title="6️⃣ 避免硬编码的最佳实践"></a>6️⃣ 避免硬编码的最佳实践</h3><h4 id="6-1-配置分离"><a href="#6-1-配置分离" class="headerlink" title="6.1 配置分离"></a>6.1 配置分离</h4><p><strong>不推荐（硬编码）</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">check_web_server</span>():</span><br><span class="line">    url = <span class="string">&quot;http://192.168.1.10:8080&quot;</span>  <span class="comment"># 硬编码</span></span><br><span class="line">    timeout = <span class="number">10</span></span><br><span class="line">    </span><br><span class="line">    resp = requests.get(url, timeout=timeout)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p><strong>推荐（配置化）</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://192.168.1.10:8080&quot;</span>,</span><br><span class="line">  <span class="string">&quot;timeout&quot;</span>: <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># script.py</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_web_server</span>(<span class="params">config: <span class="built_in">dict</span></span>):</span><br><span class="line">    url = config[<span class="string">&quot;url&quot;</span>]</span><br><span class="line">    timeout = config[<span class="string">&quot;timeout&quot;</span>]</span><br><span class="line">    </span><br><span class="line">    resp = requests.get(url, timeout=timeout)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<h4 id="6-2-环境变量"><a href="#6-2-环境变量" class="headerlink" title="6.2 环境变量"></a>6.2 环境变量</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"></span><br><span class="line">load_dotenv()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用环境变量</span></span><br><span class="line">api_key = os.getenv(<span class="string">&quot;API_KEY&quot;</span>)</span><br><span class="line">database_url = os.getenv(<span class="string">&quot;DATABASE_URL&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="6-3-命令行参数"><a href="#6-3-命令行参数" class="headerlink" title="6.3 命令行参数"></a>6.3 命令行参数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">&quot;--url&quot;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&quot;目标 URL&quot;</span>)</span><br><span class="line">parser.add_argument(<span class="string">&quot;--timeout&quot;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">10</span>, <span class="built_in">help</span>=<span class="string">&quot;超时时间&quot;</span>)</span><br><span class="line"></span><br><span class="line">args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">url = args.url</span><br><span class="line">timeout = args.timeout</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="实践任务（合法授权范围内）"><a href="#实践任务（合法授权范围内）" class="headerlink" title="实践任务（合法授权范围内）"></a>实践任务（合法授权范围内）</h2><blockquote>
<p><strong>注意</strong>：请在你自己的测试环境、本地虚拟机或授权靶场中执行以下任务。</p>
</blockquote>
<hr>
<h3 id="任务-1（必做）：搭建项目结构"><a href="#任务-1（必做）：搭建项目结构" class="headerlink" title="任务 1（必做）：搭建项目结构"></a>任务 1（必做）：搭建项目结构</h3><p><strong>目标</strong>：创建自动化基线检查项目的基础目录结构。</p>
<p><strong>步骤</strong>：</p>
<ol>
<li><strong>创建目录结构</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Windows PowerShell</span></span><br><span class="line"><span class="built_in">mkdir</span> baseline_checker, baseline_checker\config, baseline_checker\checks, baseline_checker\reports, baseline_checker\results</span><br><span class="line"></span><br><span class="line"><span class="comment"># Linux/Mac</span></span><br><span class="line"><span class="built_in">mkdir</span> -p baseline_checker/&#123;config,checks,reports,results&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>创建配置文件</strong></li>
</ol>
<p>创建 <code>config/targets.json</code>：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;本机测试&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;web&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8080&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;本地测试服务器&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>创建 Python 模块</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> baseline_checker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建空的 __init__.py 文件</span></span><br><span class="line"><span class="built_in">type</span> nul &gt; checks\__init__.py</span><br><span class="line"><span class="built_in">type</span> nul &gt; reports\__init__.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建主文件</span></span><br><span class="line"><span class="built_in">type</span> nul &gt; main.py</span><br><span class="line"><span class="built_in">type</span> nul &gt; utils.py</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>安装依赖</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 requirements.txt</span></span><br><span class="line"><span class="built_in">echo</span> requests &gt; requirements.txt</span><br><span class="line"><span class="built_in">echo</span> pyyaml &gt;&gt; requirements.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装依赖</span></span><br><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="任务-2（必做）：实现-Web-检查模块"><a href="#任务-2（必做）：实现-Web-检查模块" class="headerlink" title="任务 2（必做）：实现 Web 检查模块"></a>任务 2（必做）：实现 Web 检查模块</h3><p><strong>目标</strong>：创建 Web 检查模块并实现基础检查功能。</p>
<p><strong>步骤</strong>：</p>
<ol>
<li><strong>创建 <code>checks/base.py</code></strong></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Severity</span>(<span class="title class_ inherited__">Enum</span>):</span><br><span class="line">    CRITICAL = <span class="string">&quot;critical&quot;</span></span><br><span class="line">    HIGH = <span class="string">&quot;high&quot;</span></span><br><span class="line">    MEDIUM = <span class="string">&quot;medium&quot;</span></span><br><span class="line">    LOW = <span class="string">&quot;low&quot;</span></span><br><span class="line">    INFO = <span class="string">&quot;info&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CheckStatus</span>(<span class="title class_ inherited__">Enum</span>):</span><br><span class="line">    PASSED = <span class="string">&quot;passed&quot;</span></span><br><span class="line">    FAILED = <span class="string">&quot;failed&quot;</span></span><br><span class="line">    WARNING = <span class="string">&quot;warning&quot;</span></span><br><span class="line">    SKIPPED = <span class="string">&quot;skipped&quot;</span></span><br><span class="line">    ERROR = <span class="string">&quot;error&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CheckResult</span>:</span><br><span class="line">    check_name: <span class="built_in">str</span></span><br><span class="line">    status: CheckStatus</span><br><span class="line">    severity: Severity</span><br><span class="line">    message: <span class="built_in">str</span></span><br><span class="line">    details: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    recommendation: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    timestamp: datetime = datetime.now()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaseCheck</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name: <span class="built_in">str</span>, severity: Severity = Severity.MEDIUM</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.severity = severity</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, target: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>) -&gt; CheckResult:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>创建 <code>checks/web.py</code></strong></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> checks.base <span class="keyword">import</span> BaseCheck, CheckResult, Severity, CheckStatus</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VersionDisclosureCheck</span>(<span class="title class_ inherited__">BaseCheck</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="string">&quot;版本信息泄露&quot;</span>, Severity.MEDIUM)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, target: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>) -&gt; CheckResult:</span><br><span class="line">        url = target[<span class="string">&quot;url&quot;</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            resp = requests.head(url, timeout=<span class="number">10</span>)</span><br><span class="line">            server = resp.headers.get(<span class="string">&quot;Server&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">            x_powered = resp.headers.get(<span class="string">&quot;X-Powered-By&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            issues = []</span><br><span class="line">            <span class="keyword">if</span> server <span class="keyword">and</span> <span class="built_in">any</span>(char.isdigit() <span class="keyword">for</span> char <span class="keyword">in</span> server):</span><br><span class="line">                issues.append(<span class="string">f&quot;Server: <span class="subst">&#123;server&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> x_powered:</span><br><span class="line">                issues.append(<span class="string">f&quot;X-Powered-By: <span class="subst">&#123;x_powered&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> issues:</span><br><span class="line">                <span class="keyword">return</span> CheckResult(</span><br><span class="line">                    check_name=self.name,</span><br><span class="line">                    status=CheckStatus.FAILED,</span><br><span class="line">                    severity=self.severity,</span><br><span class="line">                    message=<span class="string">f&quot;发现版本信息泄露&quot;</span>,</span><br><span class="line">                    details=&#123;<span class="string">&quot;issues&quot;</span>: issues&#125;,</span><br><span class="line">                    recommendation=<span class="string">&quot;隐藏版本信息&quot;</span></span><br><span class="line">                )</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> CheckResult(</span><br><span class="line">                check_name=self.name,</span><br><span class="line">                status=CheckStatus.PASSED,</span><br><span class="line">                severity=self.severity,</span><br><span class="line">                message=<span class="string">&quot;未发现版本信息泄露&quot;</span></span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> CheckResult(</span><br><span class="line">                check_name=self.name,</span><br><span class="line">                status=CheckStatus.ERROR,</span><br><span class="line">                severity=self.severity,</span><br><span class="line">                message=<span class="string">f&quot;检查失败: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SecurityHeadersCheck</span>(<span class="title class_ inherited__">BaseCheck</span>):</span><br><span class="line">    REQUIRED_HEADERS = [</span><br><span class="line">        <span class="string">&quot;X-Frame-Options&quot;</span>,</span><br><span class="line">        <span class="string">&quot;X-Content-Type-Options&quot;</span>,</span><br><span class="line">        <span class="string">&quot;X-XSS-Protection&quot;</span></span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="string">&quot;安全响应头检查&quot;</span>, Severity.HIGH)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, target: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>) -&gt; CheckResult:</span><br><span class="line">        url = target[<span class="string">&quot;url&quot;</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            resp = requests.head(url, timeout=<span class="number">10</span>)</span><br><span class="line">            headers = resp.headers</span><br><span class="line">            </span><br><span class="line">            missing = [h <span class="keyword">for</span> h <span class="keyword">in</span> self.REQUIRED_HEADERS <span class="keyword">if</span> h <span class="keyword">not</span> <span class="keyword">in</span> headers]</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> missing:</span><br><span class="line">                <span class="keyword">return</span> CheckResult(</span><br><span class="line">                    check_name=self.name,</span><br><span class="line">                    status=CheckStatus.FAILED,</span><br><span class="line">                    severity=self.severity,</span><br><span class="line">                    message=<span class="string">f&quot;缺少 <span class="subst">&#123;<span class="built_in">len</span>(missing)&#125;</span> 个安全响应头&quot;</span>,</span><br><span class="line">                    details=&#123;<span class="string">&quot;missing&quot;</span>: missing&#125;,</span><br><span class="line">                    recommendation=<span class="string">f&quot;配置以下响应头: <span class="subst">&#123;<span class="string">&#x27;, &#x27;</span>.join(missing)&#125;</span>&quot;</span></span><br><span class="line">                )</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> CheckResult(</span><br><span class="line">                check_name=self.name,</span><br><span class="line">                status=CheckStatus.PASSED,</span><br><span class="line">                severity=self.severity,</span><br><span class="line">                message=<span class="string">f&quot;所有安全响应头已配置 (<span class="subst">&#123;<span class="built_in">len</span>(self.REQUIRED_HEADERS)&#125;</span> 个)&quot;</span></span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> CheckResult(</span><br><span class="line">                check_name=self.name,</span><br><span class="line">                status=CheckStatus.ERROR,</span><br><span class="line">                severity=self.severity,</span><br><span class="line">                message=<span class="string">f&quot;检查失败: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br><span class="line">            )</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="任务-3（必做）：实现报告导出模块"><a href="#任务-3（必做）：实现报告导出模块" class="headerlink" title="任务 3（必做）：实现报告导出模块"></a>任务 3（必做）：实现报告导出模块</h3><p><strong>目标</strong>：实现 CSV 和 JSON 格式的报告导出。</p>
<p><strong>步骤</strong>：</p>
<ol>
<li><strong>创建 <code>reports/csv_exporter.py</code></strong></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> checks.base <span class="keyword">import</span> CheckResult</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CSVExporter</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, output_dir: <span class="built_in">str</span> = <span class="string">&quot;results&quot;</span></span>):</span><br><span class="line">        self.output_dir = Path(output_dir)</span><br><span class="line">        self.output_dir.mkdir(exist_ok=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">export</span>(<span class="params">self, results: <span class="built_in">list</span>[<span class="built_in">tuple</span>[<span class="built_in">str</span>, <span class="built_in">list</span>[CheckResult]]], filename: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">if</span> filename <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line">            filename = <span class="string">f&quot;baseline_report_<span class="subst">&#123;datetime.now().strftime(<span class="string">&#x27;%Y%m%d_%H%M%S&#x27;</span>)&#125;</span>.csv&quot;</span></span><br><span class="line">        </span><br><span class="line">        filepath = self.output_dir / filename</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&quot;w&quot;</span>, newline=<span class="string">&quot;&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            writer = csv.writer(f)</span><br><span class="line">            writer.writerow([<span class="string">&quot;目标名称&quot;</span>, <span class="string">&quot;检查项&quot;</span>, <span class="string">&quot;状态&quot;</span>, <span class="string">&quot;风险等级&quot;</span>, <span class="string">&quot;消息&quot;</span>, <span class="string">&quot;建议&quot;</span>, <span class="string">&quot;时间&quot;</span>])</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> target_name, check_results <span class="keyword">in</span> results:</span><br><span class="line">                <span class="keyword">for</span> result <span class="keyword">in</span> check_results:</span><br><span class="line">                    writer.writerow([</span><br><span class="line">                        target_name,</span><br><span class="line">                        result.check_name,</span><br><span class="line">                        result.status.value,</span><br><span class="line">                        result.severity.value,</span><br><span class="line">                        result.message,</span><br><span class="line">                        result.recommendation <span class="keyword">or</span> <span class="string">&quot;&quot;</span>,</span><br><span class="line">                        result.timestamp.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">                    ])</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(filepath)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>创建 <code>reports/json_exporter.py</code></strong></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> checks.base <span class="keyword">import</span> CheckResult</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JSONExporter</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, output_dir: <span class="built_in">str</span> = <span class="string">&quot;results&quot;</span></span>):</span><br><span class="line">        self.output_dir = Path(output_dir)</span><br><span class="line">        self.output_dir.mkdir(exist_ok=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">export</span>(<span class="params">self, results: <span class="built_in">list</span>[<span class="built_in">tuple</span>[<span class="built_in">str</span>, <span class="built_in">list</span>[CheckResult]]], filename: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">if</span> filename <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            filename = <span class="string">f&quot;baseline_report_<span class="subst">&#123;datetime.now().strftime(<span class="string">&#x27;%Y%m%d_%H%M%S&#x27;</span>)&#125;</span>.json&quot;</span></span><br><span class="line">        </span><br><span class="line">        filepath = self.output_dir / filename</span><br><span class="line">        </span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;report_time&quot;</span>: datetime.now().isoformat(),</span><br><span class="line">            <span class="string">&quot;targets&quot;</span>: []</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> target_name, check_results <span class="keyword">in</span> results:</span><br><span class="line">            target_data = &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: target_name,</span><br><span class="line">                <span class="string">&quot;checks&quot;</span>: []</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> result <span class="keyword">in</span> check_results:</span><br><span class="line">                target_data[<span class="string">&quot;checks&quot;</span>].append(&#123;</span><br><span class="line">                    <span class="string">&quot;name&quot;</span>: result.check_name,</span><br><span class="line">                    <span class="string">&quot;status&quot;</span>: result.status.value,</span><br><span class="line">                    <span class="string">&quot;severity&quot;</span>: result.severity.value,</span><br><span class="line">                    <span class="string">&quot;message&quot;</span>: result.message,</span><br><span class="line">                    <span class="string">&quot;recommendation&quot;</span>: result.recommendation,</span><br><span class="line">                    <span class="string">&quot;timestamp&quot;</span>: result.timestamp.isoformat()</span><br><span class="line">                &#125;)</span><br><span class="line">            </span><br><span class="line">            data[<span class="string">&quot;targets&quot;</span>].append(target_data)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            json.dump(data, f, indent=<span class="number">2</span>, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(filepath)</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="任务-4（必做）：创建主程序"><a href="#任务-4（必做）：创建主程序" class="headerlink" title="任务 4（必做）：创建主程序"></a>任务 4（必做）：创建主程序</h3><p><strong>目标</strong>：编写主程序，整合所有模块。</p>
<p>**创建 <code>main.py</code>**：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> checks.web <span class="keyword">import</span> VersionDisclosureCheck, SecurityHeadersCheck</span><br><span class="line"><span class="keyword">from</span> checks.base <span class="keyword">import</span> CheckStatus</span><br><span class="line"><span class="keyword">from</span> reports.csv_exporter <span class="keyword">import</span> CSVExporter</span><br><span class="line"><span class="keyword">from</span> reports.json_exporter <span class="keyword">import</span> JSONExporter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_targets</span>(<span class="params">config_path: <span class="built_in">str</span></span>) -&gt; <span class="built_in">list</span>[<span class="built_in">dict</span>]:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(config_path, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = json.load(f)</span><br><span class="line">    <span class="keyword">return</span> data.get(<span class="string">&quot;targets&quot;</span>, [])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_checks</span>(<span class="params">targets: <span class="built_in">list</span>[<span class="built_in">dict</span>]</span>) -&gt; <span class="built_in">list</span>[<span class="built_in">tuple</span>[<span class="built_in">str</span>, <span class="built_in">list</span>]]:</span><br><span class="line">    all_results = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> target <span class="keyword">in</span> targets:</span><br><span class="line">        target_name = target.get(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Unknown&quot;</span>)</span><br><span class="line">        target_type = target.get(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;unknown&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n<span class="subst">&#123;<span class="string">&#x27;=&#x27;</span> * <span class="number">60</span>&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;扫描目标: <span class="subst">&#123;target_name&#125;</span> (<span class="subst">&#123;target_type&#125;</span>)&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;<span class="string">&#x27;=&#x27;</span> * <span class="number">60</span>&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> target_type == <span class="string">&quot;web&quot;</span>:</span><br><span class="line">            checks = [</span><br><span class="line">                VersionDisclosureCheck(),</span><br><span class="line">                SecurityHeadersCheck(),</span><br><span class="line">            ]</span><br><span class="line">            results = []</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> check <span class="keyword">in</span> checks:</span><br><span class="line">                result = check.execute(target)</span><br><span class="line">                results.append(result)</span><br><span class="line">                </span><br><span class="line">                icon = <span class="string">&quot;✅&quot;</span> <span class="keyword">if</span> result.status == CheckStatus.PASSED <span class="keyword">else</span> <span class="string">&quot;❌&quot;</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;icon&#125;</span> [<span class="subst">&#123;result.check_name&#125;</span>] <span class="subst">&#123;result.message&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            all_results.append((target_name, results))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;⚠️  暂不支持 <span class="subst">&#123;target_type&#125;</span> 类型&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> all_results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_reports</span>(<span class="params">results: <span class="built_in">list</span>[<span class="built_in">tuple</span>[<span class="built_in">str</span>, <span class="built_in">list</span>]], output_dir: <span class="built_in">str</span></span>):</span><br><span class="line">    csv_exporter = CSVExporter(output_dir)</span><br><span class="line">    json_exporter = JSONExporter(output_dir)</span><br><span class="line">    </span><br><span class="line">    csv_path = csv_exporter.export(results)</span><br><span class="line">    json_path = json_exporter.export(results)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n<span class="subst">&#123;<span class="string">&#x27;=&#x27;</span> * <span class="number">60</span>&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;报告生成完成！&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;<span class="string">&#x27;=&#x27;</span> * <span class="number">60</span>&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;✅ CSV 报告: <span class="subst">&#123;csv_path&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;✅ JSON 报告: <span class="subst">&#123;json_path&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&quot;自动化基线检查工具&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--config&quot;</span>, <span class="string">&quot;-c&quot;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&quot;目标配置文件路径&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--output&quot;</span>, <span class="string">&quot;-o&quot;</span>, default=<span class="string">&quot;results&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;输出目录&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> Path(args.config).exists():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;❌ 配置文件不存在: <span class="subst">&#123;args.config&#125;</span>&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    targets = load_targets(args.config)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;加载了 <span class="subst">&#123;<span class="built_in">len</span>(targets)&#125;</span> 个扫描目标&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    results = run_checks(targets)</span><br><span class="line">    generate_reports(results, args.output)</span><br><span class="line">    </span><br><span class="line">    total_checks = <span class="built_in">sum</span>(<span class="built_in">len</span>(checks) <span class="keyword">for</span> _, checks <span class="keyword">in</span> results)</span><br><span class="line">    total_passed = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> _, checks <span class="keyword">in</span> results <span class="keyword">for</span> r <span class="keyword">in</span> checks <span class="keyword">if</span> r.status == CheckStatus.PASSED)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n总检查项: <span class="subst">&#123;total_checks&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;通过: <span class="subst">&#123;total_passed&#125;</span> ✅&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;失败: <span class="subst">&#123;total_checks - total_passed&#125;</span> ❌&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="任务-5（必做）：运行测试"><a href="#任务-5（必做）：运行测试" class="headerlink" title="任务 5（必做）：运行测试"></a>任务 5（必做）：运行测试</h3><p><strong>目标</strong>：运行基线检查工具并验证结果。</p>
<p><strong>步骤</strong>：</p>
<ol>
<li><strong>准备测试环境</strong></li>
</ol>
<p>启动一个本地 Web 服务器（如 Nginx&#x2F;Apache）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 简单 HTTP 服务器（用于测试）</span></span><br><span class="line">python -m http.server 8080</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>运行基线检查</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> baseline_checker</span><br><span class="line">python main.py --config config/targets.json --output results</span><br></pre></td></tr></table></figure>

<p><strong>预期输出</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">加载了 1 个扫描目标</span><br><span class="line"></span><br><span class="line">============================================================</span><br><span class="line">扫描目标: 本机测试 (web)</span><br><span class="line">============================================================</span><br><span class="line">  ❌ [版本信息泄露] 发现版本信息泄露</span><br><span class="line">  ❌ [安全响应头检查] 缺少 3 个安全响应头</span><br><span class="line"></span><br><span class="line">============================================================</span><br><span class="line">报告生成完成！</span><br><span class="line">============================================================</span><br><span class="line">✅ CSV 报告: results/baseline_report_20260119_143000.csv</span><br><span class="line">✅ JSON 报告: results/baseline_report_20260119_143000.json</span><br><span class="line"></span><br><span class="line">总检查项: 2</span><br><span class="line">通过: 0 ✅</span><br><span class="line">失败: 2 ❌</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>查看生成的报告</strong></li>
</ol>
<p><strong>查看 CSV 报告</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> results\baseline_report_*.csv</span><br></pre></td></tr></table></figure>

<p><strong>查看 JSON 报告</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> results\baseline_report_*.json</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="任务-6（进阶）：添加日志记录"><a href="#任务-6（进阶）：添加日志记录" class="headerlink" title="任务 6（进阶）：添加日志记录"></a>任务 6（进阶）：添加日志记录</h3><p><strong>目标</strong>：为脚本添加详细的日志记录功能。</p>
<p>**修改 <code>utils.py</code>**：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup_logger</span>(<span class="params">name: <span class="built_in">str</span> = <span class="string">&quot;baseline_checker&quot;</span>, log_file: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span>, level: <span class="built_in">int</span> = logging.INFO</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;配置日志记录器</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        name: 日志记录器名称</span></span><br><span class="line"><span class="string">        log_file: 日志文件路径（可选）</span></span><br><span class="line"><span class="string">        level: 日志级别</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    logger = logging.getLogger(name)</span><br><span class="line">    logger.setLevel(level)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 控制台处理器</span></span><br><span class="line">    console_handler = logging.StreamHandler()</span><br><span class="line">    console_handler.setLevel(level)</span><br><span class="line">    console_format = logging.Formatter(</span><br><span class="line">        <span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>,</span><br><span class="line">        datefmt=<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span></span><br><span class="line">    )</span><br><span class="line">    console_handler.setFormatter(console_format)</span><br><span class="line">    logger.addHandler(console_handler)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 文件处理器</span></span><br><span class="line">    <span class="keyword">if</span> log_file:</span><br><span class="line">        log_path = Path(log_file)</span><br><span class="line">        log_path.parent.mkdir(parents=<span class="literal">True</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line">        file_handler = logging.FileHandler(log_path, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        file_handler.setLevel(level)</span><br><span class="line">        file_format = logging.Formatter(</span><br><span class="line">            <span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>,</span><br><span class="line">            datefmt=<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span></span><br><span class="line">        )</span><br><span class="line">        file_handler.setFormatter(file_format)</span><br><span class="line">        logger.addHandler(file_handler)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> logger</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_log_filename</span>() -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;创建带时间戳的日志文件名&quot;&quot;&quot;</span></span><br><span class="line">    timestamp = datetime.now().strftime(<span class="string">&quot;%Y%m%d_%H%M%S&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;baseline_checker_<span class="subst">&#123;timestamp&#125;</span>.log&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>修改 <code>main.py</code> 添加日志</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> setup_logger, create_log_filename</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># ... 之前的代码 ...</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 设置日志</span></span><br><span class="line">    log_file = Path(args.output) / create_log_filename()</span><br><span class="line">    logger = setup_logger(log_file=<span class="built_in">str</span>(log_file))</span><br><span class="line">    logger.info(<span class="string">f&quot;基线检查工具启动&quot;</span>)</span><br><span class="line">    logger.info(<span class="string">f&quot;配置文件: <span class="subst">&#123;args.config&#125;</span>&quot;</span>)</span><br><span class="line">    logger.info(<span class="string">f&quot;输出目录: <span class="subst">&#123;args.output&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    targets = load_targets(args.config)</span><br><span class="line">    logger.info(<span class="string">f&quot;加载了 <span class="subst">&#123;<span class="built_in">len</span>(targets)&#125;</span> 个扫描目标&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ... 运行检查 ...</span></span><br><span class="line">    </span><br><span class="line">    logger.info(<span class="string">&quot;检查完成&quot;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="任务-7（进阶）：支持多目标批量扫描"><a href="#任务-7（进阶）：支持多目标批量扫描" class="headerlink" title="任务 7（进阶）：支持多目标批量扫描"></a>任务 7（进阶）：支持多目标批量扫描</h3><p><strong>目标</strong>：扩展配置以支持多个目标。</p>
<p>**修改 <code>config/targets.json</code>**：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;本机-8080&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;web&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:8080&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;本地测试服务器 1&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;本机-3000&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;web&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:3000&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;本地测试服务器 2&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>运行批量扫描</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python main.py --config config/targets.json --output results</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="巩固练习（题与复盘）"><a href="#巩固练习（题与复盘）" class="headerlink" title="巩固练习（题与复盘）"></a>巩固练习（题与复盘）</h2><hr>
<h3 id="练习-1：如何避免脚本硬编码？"><a href="#练习-1：如何避免脚本硬编码？" class="headerlink" title="练习 1：如何避免脚本硬编码？"></a>练习 1：如何避免脚本硬编码？</h3><p><strong>思路提示</strong>：</p>
<ul>
<li>配置文件分离（JSON&#x2F;YAML&#x2F;INI）</li>
<li>环境变量</li>
<li>命令行参数</li>
<li>数据库配置存储</li>
</ul>
<hr>
<h3 id="练习-2：为脚本添加日志与错误处理"><a href="#练习-2：为脚本添加日志与错误处理" class="headerlink" title="练习 2：为脚本添加日志与错误处理"></a>练习 2：为脚本添加日志与错误处理</h3><p><strong>任务</strong>：完善 <code>VersionDisclosureCheck</code> 的错误处理，添加重试机制。</p>
<p><strong>思路提示</strong>：</p>
<ul>
<li>使用 <code>try-except</code> 捕获网络异常</li>
<li>添加超时和重试次数限制</li>
<li>记录详细的错误日志</li>
</ul>
<hr>
<h3 id="练习-3：设计可扩展的检查插件系统"><a href="#练习-3：设计可扩展的检查插件系统" class="headerlink" title="练习 3：设计可扩展的检查插件系统"></a>练习 3：设计可扩展的检查插件系统</h3><p><strong>任务</strong>：设计一个插件加载机制，允许动态添加新的检查项。</p>
<p><strong>思路提示</strong>：</p>
<ul>
<li>使用 Python 的 <code>importlib</code> 动态加载模块</li>
<li>定义插件接口规范</li>
<li>使用装饰器注册检查项</li>
</ul>
<hr>
<h3 id="练习-4：生成-HTML-可视化报告"><a href="#练习-4：生成-HTML-可视化报告" class="headerlink" title="练习 4：生成 HTML 可视化报告"></a>练习 4：生成 HTML 可视化报告</h3><p><strong>任务</strong>：实现 HTML 报告生成器，提供交互式图表。</p>
<p><strong>思路提示</strong>：</p>
<ul>
<li>使用 Jinja2 模板引擎</li>
<li>集成 Chart.js 或 ECharts 生成图表</li>
<li>使用 CSS 美化报告样式</li>
</ul>
<hr>
<h2 id="评估标准（达成判定）"><a href="#评估标准（达成判定）" class="headerlink" title="评估标准（达成判定）"></a>评估标准（达成判定）</h2><ul>
<li>✅ 项目目录结构清晰，模块分离合理</li>
<li>✅ Web 检查模块能正确执行基础检查</li>
<li>✅ CSV&#x2F;JSON 报告导出功能正常</li>
<li>✅ 主程序支持命令行参数</li>
<li>✅ 配置文件与代码分离，避免硬编码</li>
<li>✅ 具备基本的日志记录和错误处理</li>
</ul>
<hr>
<h2 id="学习成果达成情况（由学习者填写）"><a href="#学习成果达成情况（由学习者填写）" class="headerlink" title="学习成果达成情况（由学习者填写）"></a>学习成果达成情况（由学习者填写）</h2><hr>
<h3 id="截图与证据"><a href="#截图与证据" class="headerlink" title="截图与证据"></a>截图与证据</h3><ul>
<li><input disabled="" type="checkbox"> 项目目录结构截图</li>
<li><input disabled="" type="checkbox"> <code>config/targets.json</code> 配置文件内容</li>
<li><input disabled="" type="checkbox"> 脚本运行输出截图（带实时检查结果）</li>
<li><input disabled="" type="checkbox"> 生成的 CSV 报告文件</li>
<li><input disabled="" type="checkbox"> 生成的 JSON 报告文件</li>
<li><input disabled="" type="checkbox"> 日志文件内容截图</li>
</ul>
<hr>
<h3 id="关键命令与输出（粘贴关键片段）"><a href="#关键命令与输出（粘贴关键片段）" class="headerlink" title="关键命令与输出（粘贴关键片段）"></a>关键命令与输出（粘贴关键片段）</h3><p><strong>项目结构</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">baseline_checker/</span><br><span class="line">├── config/</span><br><span class="line">│   └── targets.json</span><br><span class="line">├── checks/</span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   ├── base.py</span><br><span class="line">│   └── web.py</span><br><span class="line">├── reports/</span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   ├── csv_exporter.py</span><br><span class="line">│   └── json_exporter.py</span><br><span class="line">├── results/</span><br><span class="line">│   ├── baseline_report_20260119_143000.csv</span><br><span class="line">│   ├── baseline_report_20260119_143000.json</span><br><span class="line">│   └── baseline_checker_20260119_143000.log</span><br><span class="line">├── main.py</span><br><span class="line">├── utils.py</span><br><span class="line">└── requirements.txt</span><br></pre></td></tr></table></figure>

<p><strong>运行脚本</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ python main.py --config config/targets.json --output results</span><br><span class="line">加载了 1 个扫描目标</span><br><span class="line"></span><br><span class="line">============================================================</span><br><span class="line">扫描目标: 本机测试 (web)</span><br><span class="line">============================================================</span><br><span class="line">  ❌ [版本信息泄露] 发现版本信息泄露</span><br><span class="line">  ❌ [安全响应头检查] 缺少 3 个安全响应头</span><br><span class="line"></span><br><span class="line">============================================================</span><br><span class="line">报告生成完成！</span><br><span class="line">============================================================</span><br><span class="line">✅ CSV 报告: results/baseline_report_20260119_143000.csv</span><br><span class="line">✅ JSON 报告: results/baseline_report_20260119_143000.json</span><br><span class="line"></span><br><span class="line">总检查项: 2</span><br><span class="line">通过: 0 ✅</span><br><span class="line">失败: 2 ❌</span><br></pre></td></tr></table></figure>

<p><strong>CSV 报告内容</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">目标名称,检查项,状态,风险等级,消息,建议,时间</span><br><span class="line">本机测试,版本信息泄露,failed,medium,发现版本信息泄露,隐藏版本信息,2026-01-19 14:30:00</span><br><span class="line">本机测试,安全响应头检查,failed,high,缺少 3 个安全响应头,配置以下响应头: X-Frame-Options, X-Content-Type-Options, X-XSS-Protection,2026-01-19 14:30:00</span><br></pre></td></tr></table></figure>

<p><strong>JSON 报告内容</strong>：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;report_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2026-01-19T14:30:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;本机测试&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;checks&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;版本信息泄露&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;failed&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;severity&quot;</span><span class="punctuation">:</span> <span class="string">&quot;medium&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;发现版本信息泄露&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;recommendation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;隐藏版本信息&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2026-01-19T14:30:00&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;安全响应头检查&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;failed&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;severity&quot;</span><span class="punctuation">:</span> <span class="string">&quot;high&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;缺少 3 个安全响应头&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;recommendation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;配置以下响应头: X-Frame-Options, X-Content-Type-Options, X-XSS-Protection&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2026-01-19T14:30:00&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="结论与反思"><a href="#结论与反思" class="headerlink" title="结论与反思"></a>结论与反思</h3><p><strong>我今天搞清楚了</strong>：</p>
<ul>
<li>模块化设计是编写可维护脚本的关键（基类、子类分离）</li>
<li>配置文件与代码分离可以避免硬编码，提高灵活性</li>
<li>结构化报告（CSV&#x2F;JSON）便于后续分析和自动化处理</li>
<li>日志记录对于调试和审计非常重要</li>
</ul>
<p><strong>我差点搞混的是</strong>：</p>
<ul>
<li>最初不知道如何设计基类和子类的继承关系</li>
<li>不确定应该用数据类（dataclass）还是普通类存储检查结果</li>
<li>混淆了检查的”状态”（passed&#x2F;failed）和”风险等级”（critical&#x2F;high&#x2F;medium&#x2F;low）</li>
</ul>
<p><strong>明天我要继续补的是</strong>：</p>
<ul>
<li>学习 WAF（Web 应用防火墙）的原理与配置（Day027）</li>
<li>了解常见 Web 漏洞（SQL 注入、XSS、CSRF）的检测与防护（Day028-030）</li>
<li>学习安全报告模板化和可视化</li>
</ul>
<p><strong>本次学习耗时</strong>：约 4 小时</p>
<p><strong>掌握程度自评</strong>：</p>
<ul>
<li><input disabled="" type="checkbox"> 😕 理解了基本概念，但代码实现不熟练</li>
<li><input disabled="" type="checkbox"> 🙂 完成了基础任务</li>
<li><input disabled="" type="checkbox"> 😃 完成了所有任务并理解原理</li>
<li><input disabled="" type="checkbox"> 🤩 实现了扩展功能（日志、重试、多目标扫描）</li>
</ul>
<hr>
<h2 id="集中参考答案（含思路）"><a href="#集中参考答案（含思路）" class="headerlink" title="集中参考答案（含思路）"></a>集中参考答案（含思路）</h2><hr>
<h3 id="练习-1-参考答案：如何避免脚本硬编码？"><a href="#练习-1-参考答案：如何避免脚本硬编码？" class="headerlink" title="练习 1 参考答案：如何避免脚本硬编码？"></a>练习 1 参考答案：如何避免脚本硬编码？</h3><p><strong>硬编码的问题</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ❌ 不推荐：硬编码</span></span><br><span class="line">url = <span class="string">&quot;http://192.168.1.10:8080&quot;</span></span><br><span class="line">timeout = <span class="number">10</span></span><br><span class="line">api_key = <span class="string">&quot;sk-abc123def456&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_server</span>():</span><br><span class="line">    resp = requests.get(url, timeout=timeout, headers=&#123;<span class="string">&quot;Authorization&quot;</span>: <span class="string">f&quot;Bearer <span class="subst">&#123;api_key&#125;</span>&quot;</span>&#125;)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p><strong>问题</strong>：</p>
<ul>
<li>目标变更需要修改代码</li>
<li>敏感信息泄露风险（API Key、密码）</li>
<li>不同环境（开发&#x2F;测试&#x2F;生产）需要不同配置</li>
<li>代码复用性差</li>
</ul>
<hr>
<p><strong>方案 1：配置文件（JSON&#x2F;YAML）</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;server&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://192.168.1.10:8080&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;timeout&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;auth&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;api_key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;API_KEY&#125;&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;config.json&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    config = json.load(f)</span><br><span class="line"></span><br><span class="line">url = config[<span class="string">&quot;server&quot;</span>][<span class="string">&quot;url&quot;</span>]</span><br><span class="line">timeout = config[<span class="string">&quot;server&quot;</span>][<span class="string">&quot;timeout&quot;</span>]</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>方案 2：环境变量</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .env 文件（不提交到 Git）</span></span><br><span class="line">API_KEY=sk-abc123def456</span><br><span class="line">SERVER_URL=http://192.168.1.10:8080</span><br><span class="line">TIMEOUT=10</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"></span><br><span class="line">load_dotenv()</span><br><span class="line"></span><br><span class="line">api_key = os.getenv(<span class="string">&quot;API_KEY&quot;</span>)</span><br><span class="line">server_url = os.getenv(<span class="string">&quot;SERVER_URL&quot;</span>)</span><br><span class="line">timeout = <span class="built_in">int</span>(os.getenv(<span class="string">&quot;TIMEOUT&quot;</span>, <span class="string">&quot;10&quot;</span>))  <span class="comment"># 默认值</span></span><br></pre></td></tr></table></figure>

<hr>
<p><strong>方案 3：命令行参数</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">&quot;--url&quot;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&quot;服务器 URL&quot;</span>)</span><br><span class="line">parser.add_argument(<span class="string">&quot;--timeout&quot;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">10</span>, <span class="built_in">help</span>=<span class="string">&quot;超时时间&quot;</span>)</span><br><span class="line">parser.add_argument(<span class="string">&quot;--api-key&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;API 密钥&quot;</span>)</span><br><span class="line"></span><br><span class="line">args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">url = args.url</span><br><span class="line">timeout = args.timeout</span><br><span class="line">api_key = args.api_key</span><br></pre></td></tr></table></figure>

<p><strong>最佳实践</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">优先级：命令行参数 &gt; 环境变量 &gt; 配置文件 &gt; 默认值</span><br><span class="line"></span><br><span class="line">┌─────────────────────────────────────┐</span><br><span class="line">│         配置层次结构                 │</span><br><span class="line">├─────────────────────────────────────┤</span><br><span class="line">│ 1. 命令行参数（临时覆盖）           │</span><br><span class="line">│ 2. 环境变量（敏感信息）             │</span><br><span class="line">│ 3. 配置文件（常规配置）             │</span><br><span class="line">│ 4. 代码默认值（兜底）               │</span><br><span class="line">└─────────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="练习-2-参考答案：为脚本添加日志与错误处理"><a href="#练习-2-参考答案：为脚本添加日志与错误处理" class="headerlink" title="练习 2 参考答案：为脚本添加日志与错误处理"></a>练习 2 参考答案：为脚本添加日志与错误处理</h3><p>**改进后的 <code>VersionDisclosureCheck</code>**：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> checks.base <span class="keyword">import</span> BaseCheck, CheckResult, Severity, CheckStatus</span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> get_logger</span><br><span class="line"></span><br><span class="line">logger = get_logger(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VersionDisclosureCheck</span>(<span class="title class_ inherited__">BaseCheck</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, max_retries: <span class="built_in">int</span> = <span class="number">3</span>, timeout: <span class="built_in">int</span> = <span class="number">10</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="string">&quot;版本信息泄露&quot;</span>, Severity.MEDIUM)</span><br><span class="line">        self.max_retries = max_retries</span><br><span class="line">        self.timeout = timeout</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, target: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>) -&gt; CheckResult:</span><br><span class="line">        url = target[<span class="string">&quot;url&quot;</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> attempt <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, self.max_retries + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                logger.info(<span class="string">f&quot;检查 <span class="subst">&#123;url&#125;</span>（第 <span class="subst">&#123;attempt&#125;</span>/<span class="subst">&#123;self.max_retries&#125;</span> 次尝试）&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                resp = requests.head(url, timeout=self.timeout)</span><br><span class="line">                </span><br><span class="line">                server = resp.headers.get(<span class="string">&quot;Server&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">                x_powered = resp.headers.get(<span class="string">&quot;X-Powered-By&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                issues = []</span><br><span class="line">                <span class="keyword">if</span> server <span class="keyword">and</span> <span class="built_in">any</span>(char.isdigit() <span class="keyword">for</span> char <span class="keyword">in</span> server):</span><br><span class="line">                    issues.append(<span class="string">f&quot;Server: <span class="subst">&#123;server&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> x_powered:</span><br><span class="line">                    issues.append(<span class="string">f&quot;X-Powered-By: <span class="subst">&#123;x_powered&#125;</span>&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> issues:</span><br><span class="line">                    logger.warning(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span> 发现版本信息泄露: <span class="subst">&#123;issues&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="keyword">return</span> CheckResult(</span><br><span class="line">                        check_name=self.name,</span><br><span class="line">                        status=CheckStatus.FAILED,</span><br><span class="line">                        severity=self.severity,</span><br><span class="line">                        message=<span class="string">f&quot;发现版本信息泄露&quot;</span>,</span><br><span class="line">                        details=&#123;<span class="string">&quot;issues&quot;</span>: issues&#125;,</span><br><span class="line">                        recommendation=<span class="string">&quot;隐藏版本信息&quot;</span></span><br><span class="line">                    )</span><br><span class="line">                </span><br><span class="line">                logger.info(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span> 版本信息检查通过&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> CheckResult(</span><br><span class="line">                    check_name=self.name,</span><br><span class="line">                    status=CheckStatus.PASSED,</span><br><span class="line">                    severity=self.severity,</span><br><span class="line">                    message=<span class="string">&quot;未发现版本信息泄露&quot;</span></span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">except</span> requests.exceptions.Timeout:</span><br><span class="line">                logger.warning(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span> 请求超时（第 <span class="subst">&#123;attempt&#125;</span> 次尝试）&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> attempt &lt; self.max_retries:</span><br><span class="line">                    time.sleep(<span class="number">2</span> ** attempt)  <span class="comment"># 指数退避</span></span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    logger.error(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span> 达到最大重试次数&quot;</span>)</span><br><span class="line">                    <span class="keyword">return</span> CheckResult(</span><br><span class="line">                        check_name=self.name,</span><br><span class="line">                        status=CheckStatus.ERROR,</span><br><span class="line">                        severity=self.severity,</span><br><span class="line">                        message=<span class="string">f&quot;请求超时（重试 <span class="subst">&#123;self.max_retries&#125;</span> 次后仍失败）&quot;</span></span><br><span class="line">                    )</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">except</span> requests.exceptions.ConnectionError <span class="keyword">as</span> e:</span><br><span class="line">                logger.error(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span> 连接失败: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> CheckResult(</span><br><span class="line">                    check_name=self.name,</span><br><span class="line">                    status=CheckStatus.ERROR,</span><br><span class="line">                    severity=self.severity,</span><br><span class="line">                    message=<span class="string">f&quot;连接失败: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br><span class="line">                )</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                logger.error(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span> 未知错误: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>, exc_info=<span class="literal">True</span>)</span><br><span class="line">                <span class="keyword">return</span> CheckResult(</span><br><span class="line">                    check_name=self.name,</span><br><span class="line">                    status=CheckStatus.ERROR,</span><br><span class="line">                    severity=self.severity,</span><br><span class="line">                    message=<span class="string">f&quot;检查失败: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br><span class="line">                )</span><br></pre></td></tr></table></figure>

<p><strong>关键改进点</strong>：</p>
<ol>
<li><p><strong>重试机制</strong>：</p>
<ul>
<li>最大重试次数（<code>max_retries</code>）</li>
<li>指数退避（每次重试间隔递增）</li>
</ul>
</li>
<li><p><strong>详细的日志记录</strong>：</p>
<ul>
<li><code>logger.info</code>：常规信息</li>
<li><code>logger.warning</code>：警告（如超时、检查失败）</li>
<li><code>logger.error</code>：错误（如连接失败）</li>
<li><code>exc_info=True</code>：记录异常堆栈</li>
</ul>
</li>
<li><p><strong>异常分类处理</strong>：</p>
<ul>
<li><code>Timeout</code>：重试</li>
<li><code>ConnectionError</code>：直接失败</li>
<li>其他异常：记录堆栈</li>
</ul>
</li>
</ol>
<hr>
<h3 id="练习-3-参考答案：设计可扩展的检查插件系统"><a href="#练习-3-参考答案：设计可扩展的检查插件系统" class="headerlink" title="练习 3 参考答案：设计可扩展的检查插件系统"></a>练习 3 参考答案：设计可扩展的检查插件系统</h3><p><strong>插件接口定义（<code>checks/plugin_interface.py</code>）</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"><span class="keyword">from</span> checks.base <span class="keyword">import</span> CheckResult</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaseCheckPlugin</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;检查插件基类&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 插件元数据</span></span><br><span class="line">    name: <span class="built_in">str</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    description: <span class="built_in">str</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    version: <span class="built_in">str</span> = <span class="string">&quot;1.0.0&quot;</span></span><br><span class="line">    enabled: <span class="built_in">bool</span> = <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, target: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>) -&gt; CheckResult:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;执行检查&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">init</span>(<span class="params">self, config: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] | <span class="literal">None</span> = <span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;初始化插件（可选）&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p><strong>插件注册装饰器（<code>checks/registry.py</code>）</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Callable</span>, <span class="type">Type</span></span><br><span class="line"><span class="keyword">from</span> checks.plugin_interface <span class="keyword">import</span> BaseCheckPlugin</span><br><span class="line"></span><br><span class="line">_CHECK_PLUGINS: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Type</span>[BaseCheckPlugin]] = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register_check</span>(<span class="params">name: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;插件注册装饰器&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decorator</span>(<span class="params">cls: <span class="type">Type</span>[BaseCheckPlugin]</span>):</span><br><span class="line">        cls.name = name</span><br><span class="line">        _CHECK_PLUGINS[name] = cls</span><br><span class="line">        <span class="keyword">return</span> cls</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_check</span>(<span class="params">name: <span class="built_in">str</span></span>) -&gt; <span class="type">Type</span>[BaseCheckPlugin] | <span class="literal">None</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;获取检查插件&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> _CHECK_PLUGINS.get(name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_checks</span>() -&gt; <span class="built_in">list</span>[<span class="built_in">str</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;列出所有可用检查&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(_CHECK_PLUGINS.keys())</span><br></pre></td></tr></table></figure>

<p><strong>动态加载插件（<code>checks/loader.py</code>）</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line"><span class="keyword">import</span> pkgutil</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> checks.registry <span class="keyword">import</span> list_checks</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_plugins</span>(<span class="params">module_name: <span class="built_in">str</span> = <span class="string">&quot;checks.plugins&quot;</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;动态加载所有插件</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        module_name: 插件模块包名</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        package = importlib.import_module(module_name)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> _, name, _ <span class="keyword">in</span> pkgutil.iter_modules(package.__path__):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                importlib.import_module(<span class="string">f&quot;<span class="subst">&#123;module_name&#125;</span>.<span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;⚠️  加载插件 <span class="subst">&#123;name&#125;</span> 失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;✅ 已加载 <span class="subst">&#123;<span class="built_in">len</span>(list_checks())&#125;</span> 个检查插件&quot;</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> ImportError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;⚠️  插件模块 <span class="subst">&#123;module_name&#125;</span> 不存在&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>示例插件（<code>checks/plugins/custom_check.py</code>）</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> checks.plugin_interface <span class="keyword">import</span> BaseCheckPlugin</span><br><span class="line"><span class="keyword">from</span> checks.base <span class="keyword">import</span> CheckStatus, Severity, CheckResult</span><br><span class="line"><span class="keyword">from</span> checks.registry <span class="keyword">import</span> register_check</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="meta">@register_check(<span class="params"><span class="string">&quot;自定义HTTP检查&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomHTTPCheck</span>(<span class="title class_ inherited__">BaseCheckPlugin</span>):</span><br><span class="line">    description = <span class="string">&quot;检查自定义 HTTP 响应特征&quot;</span></span><br><span class="line">    version = <span class="string">&quot;1.0.0&quot;</span></span><br><span class="line">    enabled = <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">init</span>(<span class="params">self, config: <span class="built_in">dict</span> | <span class="literal">None</span> = <span class="literal">None</span></span>):</span><br><span class="line">        <span class="keyword">if</span> config:</span><br><span class="line">            self.custom_headers = config.get(<span class="string">&quot;headers&quot;</span>, &#123;&#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.custom_headers = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, target: <span class="built_in">dict</span></span>) -&gt; CheckResult:</span><br><span class="line">        url = target[<span class="string">&quot;url&quot;</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            resp = requests.get(url, headers=self.custom_headers, timeout=<span class="number">10</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 自定义检查逻辑</span></span><br><span class="line">            <span class="keyword">if</span> resp.status_code == <span class="number">200</span> <span class="keyword">and</span> <span class="string">&quot;custom_flag&quot;</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">                <span class="keyword">return</span> CheckResult(</span><br><span class="line">                    check_name=self.name,</span><br><span class="line">                    status=CheckStatus.PASSED,</span><br><span class="line">                    severity=Severity.LOW,</span><br><span class="line">                    message=<span class="string">&quot;自定义检查通过&quot;</span></span><br><span class="line">                )</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> CheckResult(</span><br><span class="line">                    check_name=self.name,</span><br><span class="line">                    status=CheckStatus.FAILED,</span><br><span class="line">                    severity=Severity.MEDIUM,</span><br><span class="line">                    message=<span class="string">&quot;自定义检查失败&quot;</span>,</span><br><span class="line">                    recommendation=<span class="string">&quot;检查响应内容&quot;</span></span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> CheckResult(</span><br><span class="line">                check_name=self.name,</span><br><span class="line">                status=CheckStatus.ERROR,</span><br><span class="line">                severity=Severity.LOW,</span><br><span class="line">                message=<span class="string">f&quot;检查失败: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br><span class="line">            )</span><br></pre></td></tr></table></figure>

<p><strong>使用示例</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加载所有插件</span></span><br><span class="line"><span class="keyword">from</span> checks.loader <span class="keyword">import</span> load_plugins</span><br><span class="line"><span class="keyword">from</span> checks.registry <span class="keyword">import</span> get_check</span><br><span class="line"></span><br><span class="line">load_plugins(<span class="string">&quot;checks.plugins&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取并实例化插件</span></span><br><span class="line">check_class = get_check(<span class="string">&quot;自定义HTTP检查&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> check_class:</span><br><span class="line">    check_instance = check_class()</span><br><span class="line">    result = check_instance.execute(&#123;<span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://example.com&quot;</span>&#125;)</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="练习-4-参考答案：生成-HTML-可视化报告"><a href="#练习-4-参考答案：生成-HTML-可视化报告" class="headerlink" title="练习 4 参考答案：生成 HTML 可视化报告"></a>练习 4 参考答案：生成 HTML 可视化报告</h3><p><strong>HTML 模板（<code>reports/template.html</code>）</strong>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>基线检查报告<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/chart.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">body</span> &#123; <span class="attribute">font-family</span>: Arial, sans-serif; <span class="attribute">margin</span>: <span class="number">20px</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.summary</span> &#123; <span class="attribute">display</span>: flex; <span class="attribute">gap</span>: <span class="number">20px</span>; <span class="attribute">margin-bottom</span>: <span class="number">30px</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.card</span> &#123; <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>; <span class="attribute">padding</span>: <span class="number">20px</span>; <span class="attribute">border-radius</span>: <span class="number">8px</span>; <span class="attribute">flex</span>: <span class="number">1</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.card</span> <span class="selector-tag">h3</span> &#123; <span class="attribute">margin-top</span>: <span class="number">0</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.passed</span> &#123; <span class="attribute">color</span>: <span class="number">#28a745</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.failed</span> &#123; <span class="attribute">color</span>: <span class="number">#dc3545</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.error</span> &#123; <span class="attribute">color</span>: <span class="number">#6c757d</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.target-section</span> &#123; <span class="attribute">margin-bottom</span>: <span class="number">40px</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.check-row</span> &#123; <span class="attribute">padding</span>: <span class="number">10px</span>; <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#eee</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.severity-critical</span> &#123; <span class="attribute">border-left</span>: <span class="number">4px</span> solid <span class="number">#dc3545</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.severity-high</span> &#123; <span class="attribute">border-left</span>: <span class="number">4px</span> solid <span class="number">#fd7e14</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.severity-medium</span> &#123; <span class="attribute">border-left</span>: <span class="number">4px</span> solid <span class="number">#ffc107</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.severity-low</span> &#123; <span class="attribute">border-left</span>: <span class="number">4px</span> solid <span class="number">#28a745</span>; &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>基线检查报告<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>生成时间: &#123;&#123; report_time &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;summary&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span>总览<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>目标数量: &#123;&#123; summary.total_targets &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>总检查项: &#123;&#123; summary.total_checks &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>通过: <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;passed&quot;</span>&gt;</span>&#123;&#123; summary.passed &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>失败: <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;failed&quot;</span>&gt;</span>&#123;&#123; summary.failed &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>通过率: &#123;&#123; summary.pass_rate &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span>风险分布<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;severityChart&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    &#123;% for target in targets %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;target-section&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123; target.name &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>检查项<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>状态<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>风险等级<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>消息<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>建议<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">                &#123;% for check in target.checks %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;check-row severity-&#123;&#123; check.severity &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; check.name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;&#123;&#123; check.status &#125;&#125;&quot;</span>&gt;</span>&#123;&#123; check.status &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; check.severity &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; check.message &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; check.recommendation or &#x27;-&#x27; &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;severityChart&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">new</span> <span class="title class_">Chart</span>(ctx, &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">type</span>: <span class="string">&#x27;doughnut&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">labels</span>: [<span class="string">&#x27;严重&#x27;</span>, <span class="string">&#x27;高危&#x27;</span>, <span class="string">&#x27;中危&#x27;</span>, <span class="string">&#x27;低危&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">datasets</span>: [&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">data</span>: [</span></span><br><span class="line"><span class="language-javascript">                        &#123;&#123; summary.<span class="property">critical_count</span> &#125;&#125;,</span></span><br><span class="line"><span class="language-javascript">                        &#123;&#123; summary.<span class="property">high_count</span> &#125;&#125;,</span></span><br><span class="line"><span class="language-javascript">                        &#123;&#123; summary.<span class="property">medium_count</span> &#125;&#125;,</span></span><br><span class="line"><span class="language-javascript">                        &#123;&#123; summary.<span class="property">low_count</span> &#125;&#125;</span></span><br><span class="line"><span class="language-javascript">                    ],</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">backgroundColor</span>: [<span class="string">&#x27;#dc3545&#x27;</span>, <span class="string">&#x27;#fd7e14&#x27;</span>, <span class="string">&#x27;#ffc107&#x27;</span>, <span class="string">&#x27;#28a745&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">                &#125;]</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>HTML 生成器（<code>reports/html_generator.py</code>）</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Template</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> checks.base <span class="keyword">import</span> CheckResult</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HTMLGenerator</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, template_path: <span class="built_in">str</span>, output_dir: <span class="built_in">str</span> = <span class="string">&quot;results&quot;</span></span>):</span><br><span class="line">        self.template_path = Path(template_path)</span><br><span class="line">        self.output_dir = Path(output_dir)</span><br><span class="line">        self.output_dir.mkdir(exist_ok=<span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(self.template_path, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            self.template = Template(f.read())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate</span>(<span class="params">self, results: <span class="built_in">list</span>[<span class="built_in">tuple</span>[<span class="built_in">str</span>, <span class="built_in">list</span>[CheckResult]]], filename: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;生成 HTML 报告&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> filename <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            filename = <span class="string">f&quot;baseline_report_<span class="subst">&#123;datetime.now().strftime(<span class="string">&#x27;%Y%m%d_%H%M%S&#x27;</span>)&#125;</span>.html&quot;</span></span><br><span class="line">        </span><br><span class="line">        filepath = self.output_dir / filename</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 统计汇总数据</span></span><br><span class="line">        summary = self._generate_summary(results)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 准备目标数据</span></span><br><span class="line">        targets_data = []</span><br><span class="line">        <span class="keyword">for</span> target_name, check_results <span class="keyword">in</span> results:</span><br><span class="line">            targets_data.append(&#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: target_name,</span><br><span class="line">                <span class="string">&quot;checks&quot;</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;name&quot;</span>: r.check_name,</span><br><span class="line">                        <span class="string">&quot;status&quot;</span>: r.status.value,</span><br><span class="line">                        <span class="string">&quot;severity&quot;</span>: r.severity.value,</span><br><span class="line">                        <span class="string">&quot;message&quot;</span>: r.message,</span><br><span class="line">                        <span class="string">&quot;recommendation&quot;</span>: r.recommendation</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">for</span> r <span class="keyword">in</span> check_results</span><br><span class="line">                ]</span><br><span class="line">            &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 渲染模板</span></span><br><span class="line">        html_content = self.template.render(</span><br><span class="line">            report_time=datetime.now().strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>),</span><br><span class="line">            summary=summary,</span><br><span class="line">            targets=targets_data</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(html_content)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(filepath)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_generate_summary</span>(<span class="params">self, results: <span class="built_in">list</span>[<span class="built_in">tuple</span>[<span class="built_in">str</span>, <span class="built_in">list</span>[CheckResult]]]</span>) -&gt; <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;生成汇总数据&quot;&quot;&quot;</span></span><br><span class="line">        total_targets = <span class="built_in">len</span>(results)</span><br><span class="line">        total_checks = <span class="built_in">sum</span>(<span class="built_in">len</span>(checks) <span class="keyword">for</span> _, checks <span class="keyword">in</span> results)</span><br><span class="line">        total_passed = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> _, checks <span class="keyword">in</span> results <span class="keyword">for</span> r <span class="keyword">in</span> checks <span class="keyword">if</span> r.status.value == <span class="string">&quot;passed&quot;</span>)</span><br><span class="line">        total_failed = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> _, checks <span class="keyword">in</span> results <span class="keyword">for</span> r <span class="keyword">in</span> checks <span class="keyword">if</span> r.status.value == <span class="string">&quot;failed&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 风险等级统计</span></span><br><span class="line">        severity_counts = &#123;<span class="string">&quot;critical&quot;</span>: <span class="number">0</span>, <span class="string">&quot;high&quot;</span>: <span class="number">0</span>, <span class="string">&quot;medium&quot;</span>: <span class="number">0</span>, <span class="string">&quot;low&quot;</span>: <span class="number">0</span>&#125;</span><br><span class="line">        <span class="keyword">for</span> _, checks <span class="keyword">in</span> results:</span><br><span class="line">            <span class="keyword">for</span> r <span class="keyword">in</span> checks:</span><br><span class="line">                <span class="keyword">if</span> r.status.value == <span class="string">&quot;failed&quot;</span>:</span><br><span class="line">                    severity_counts[r.severity.value] += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;total_targets&quot;</span>: total_targets,</span><br><span class="line">            <span class="string">&quot;total_checks&quot;</span>: total_checks,</span><br><span class="line">            <span class="string">&quot;passed&quot;</span>: total_passed,</span><br><span class="line">            <span class="string">&quot;failed&quot;</span>: total_failed,</span><br><span class="line">            <span class="string">&quot;pass_rate&quot;</span>: <span class="string">f&quot;<span class="subst">&#123;total_passed / total_checks * <span class="number">100</span>:<span class="number">.1</span>f&#125;</span>%&quot;</span> <span class="keyword">if</span> total_checks &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&quot;N/A&quot;</span>,</span><br><span class="line">            <span class="string">&quot;critical_count&quot;</span>: severity_counts[<span class="string">&quot;critical&quot;</span>],</span><br><span class="line">            <span class="string">&quot;high_count&quot;</span>: severity_counts[<span class="string">&quot;high&quot;</span>],</span><br><span class="line">            <span class="string">&quot;medium_count&quot;</span>: severity_counts[<span class="string">&quot;medium&quot;</span>],</span><br><span class="line">            <span class="string">&quot;low_count&quot;</span>: severity_counts[<span class="string">&quot;low&quot;</span>]</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="学习成果示例填写（可照抄）"><a href="#学习成果示例填写（可照抄）" class="headerlink" title="学习成果示例填写（可照抄）"></a>学习成果示例填写（可照抄）</h2><blockquote>
<p>可将”示例”内容替换为你自己的时间与截图文件名。</p>
</blockquote>
<hr>
<h3 id="截图与证据（示例）"><a href="#截图与证据（示例）" class="headerlink" title="截图与证据（示例）"></a>截图与证据（示例）</h3><ul>
<li>项目结构：<code>images/day026_project_structure.png</code></li>
<li>配置文件：<code>images/day026_config_json.png</code></li>
<li>脚本运行：<code>images/day026_script_output.png</code></li>
<li>CSV 报告：<code>images/day026_csv_report.png</code></li>
<li>JSON 报告：<code>images/day026_json_report.png</code></li>
</ul>
<hr>
<h3 id="关键命令与输出（示例）"><a href="#关键命令与输出（示例）" class="headerlink" title="关键命令与输出（示例）"></a>关键命令与输出（示例）</h3><p><strong>项目初始化</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> baseline_checker &amp;&amp; <span class="built_in">cd</span> baseline_checker</span><br><span class="line">$ <span class="built_in">mkdir</span> config checks reports results</span><br><span class="line">$ <span class="built_in">type</span> nul &gt; checks\__init__.py</span><br><span class="line">$ <span class="built_in">type</span> nul &gt; reports\__init__.py</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> requests &gt; requirements.txt</span><br><span class="line">$ pip install -r requirements.txt</span><br></pre></td></tr></table></figure>

<p><strong>运行基线检查</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ python main.py --config config/targets.json --output results</span><br><span class="line">加载了 1 个扫描目标</span><br><span class="line"></span><br><span class="line">============================================================</span><br><span class="line">扫描目标: 本机测试 (web)</span><br><span class="line">============================================================</span><br><span class="line">  ❌ [版本信息泄露] 发现版本信息泄露</span><br><span class="line">  ❌ [安全响应头检查] 缺少 3 个安全响应头</span><br><span class="line"></span><br><span class="line">============================================================</span><br><span class="line">报告生成完成！</span><br><span class="line">============================================================</span><br><span class="line">✅ CSV 报告: results/baseline_report_20260119_143000.csv</span><br><span class="line">✅ JSON 报告: results/baseline_report_20260119_143000.json</span><br><span class="line"></span><br><span class="line">总检查项: 2</span><br><span class="line">通过: 0 ✅</span><br><span class="line">失败: 2 ❌</span><br></pre></td></tr></table></figure>

<p><strong>日志文件内容</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">2026-01-19 14:30:00 - baseline_checker - INFO - 基线检查工具启动</span><br><span class="line">2026-01-19 14:30:00 - baseline_checker - INFO - 配置文件: config/targets.json</span><br><span class="line">2026-01-19 14:30:00 - baseline_checker - INFO - 输出目录: results</span><br><span class="line">2026-01-19 14:30:00 - baseline_checker - INFO - 加载了 1 个扫描目标</span><br><span class="line">2026-01-19 14:30:00 - baseline_checker - INFO - 检查 http://localhost:8080（第 1/3 次尝试）</span><br><span class="line">2026-01-19 14:30:00 - baseline_checker - WARNING - http://localhost:8080 发现版本信息泄露: [&#x27;Server: nginx/1.18.0&#x27;]</span><br><span class="line">2026-01-19 14:30:00 - baseline_checker - INFO - 检查完成</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="结论与反思（示例）"><a href="#结论与反思（示例）" class="headerlink" title="结论与反思（示例）"></a>结论与反思（示例）</h3><p><strong>我今天搞清楚了</strong>：</p>
<ul>
<li>模块化设计是构建可维护自动化工具的关键</li>
<li>配置与代码分离可以避免硬编码，提高灵活性</li>
<li>日志记录对于调试、审计和问题排查非常重要</li>
<li>结构化报告（CSV&#x2F;JSON&#x2F;HTML）便于后续分析和可视化</li>
</ul>
<p><strong>我差点搞混的是</strong>：</p>
<ul>
<li>最初不理解为什么需要基类和子类的继承关系</li>
<li>混淆了检查的”状态”（passed&#x2F;failed）和”风险等级”（critical&#x2F;high&#x2F;medium&#x2F;low）</li>
<li>不确定如何实现插件加载机制，后来学习了 <code>importlib</code> 和装饰器模式</li>
</ul>
<p><strong>明天我要继续补的是</strong>：</p>
<ul>
<li>学习 WAF（Web 应用防火墙）的原理与配置（Day027）</li>
<li>了解常见 Web 漏洞（SQL 注入、XSS、CSRF）的检测与防护（Day028-030）</li>
<li>学习安全报告的自动化发送和告警</li>
</ul>
<p><strong>本次学习耗时</strong>：约 4.5 小时</p>
<p><strong>掌握程度自评</strong>：</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 😃 完成了所有任务并理解原理</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag"># 网络</a>
              <a href="/tags/%E5%AE%89%E5%85%A8/" rel="tag"># 安全</a>
              <a href="/tags/%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/" rel="tag"># 学习计划</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/a67b221d.html" rel="prev" title="Day025：漏洞扫描与基线 - Web 中间件暴露面与加固">
                  <i class="fa fa-chevron-left"></i> Day025：漏洞扫描与基线 - Web 中间件暴露面与加固
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/cd46dc34.html" rel="next" title="Day027：漏洞扫描与基线 - 加固复验与变更记录">
                  Day027：漏洞扫描与基线 - 加固复验与变更记录 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="lv-container" data-id="city" data-uid="MTAyMC8zNDY4NC8xMTIyMQ=="></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2026</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tigercoll</span>
</div>
<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("04/21/2019 15:54:40");//此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "等待与你相遇的 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>
<!--
-->

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  




<script src="/js/third-party/comments/livere.js"></script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
