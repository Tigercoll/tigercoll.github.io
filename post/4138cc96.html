<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" integrity="sha256-jTIdiMuX/e3DGJUGwl3pKSxuc6YOuqtJYkM0bGQESA4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-center-simple.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"tigercoll.top","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.10.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Day013：安全协议与加密 - 加密应用与场景 日期：2026-01-06 周次：第 2 周  学习目标学完今天你应该能做到：  能把”加密”分成 3 类场景：传输中、存储中、认证&#x2F;签名 能识别 5 个常见错误： 明文存密码 可逆加密存密码 没盐（salt） 迭代太低&#x2F;用快哈希（如 SHA-256）直接存密码 密钥硬编码&#x2F;长期不轮换   能输出一张你自己的”应用加密">
<meta property="og:type" content="article">
<meta property="og:title" content="Day013：安全协议与加密 - 加密应用与场景">
<meta property="og:url" content="https://tigercoll.top/post/4138cc96.html">
<meta property="og:site_name" content="Tigercoll&#39;s Blog">
<meta property="og:description" content="Day013：安全协议与加密 - 加密应用与场景 日期：2026-01-06 周次：第 2 周  学习目标学完今天你应该能做到：  能把”加密”分成 3 类场景：传输中、存储中、认证&#x2F;签名 能识别 5 个常见错误： 明文存密码 可逆加密存密码 没盐（salt） 迭代太低&#x2F;用快哈希（如 SHA-256）直接存密码 密钥硬编码&#x2F;长期不轮换   能输出一张你自己的”应用加密">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2026-01-05T16:00:00.000Z">
<meta property="article:modified_time" content="2026-01-05T16:00:00.000Z">
<meta property="article:author" content="Tigercoll">
<meta property="article:tag" content="网络">
<meta property="article:tag" content="安全">
<meta property="article:tag" content="学习计划">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://tigercoll.top/post/4138cc96.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://tigercoll.top/post/4138cc96.html","path":"post/4138cc96.html","title":"Day013：安全协议与加密 - 加密应用与场景"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Day013：安全协议与加密 - 加密应用与场景 | Tigercoll's Blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Tigercoll's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>
	
      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Day013%EF%BC%9A%E5%AE%89%E5%85%A8%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%8A%A0%E5%AF%86-%E5%8A%A0%E5%AF%86%E5%BA%94%E7%94%A8%E4%B8%8E%E5%9C%BA%E6%99%AF"><span class="nav-number">1.</span> <span class="nav-text">Day013：安全协议与加密 - 加密应用与场景</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87"><span class="nav-number">1.1.</span> <span class="nav-text">学习目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9"><span class="nav-number">1.2.</span> <span class="nav-text">学习内容</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%B8%8F%E2%83%A3-%E4%BC%A0%E8%BE%93%E4%B8%AD%E5%8A%A0%E5%AF%86%EF%BC%88In-Transit%EF%BC%89%EF%BC%9A%E4%BD%A0%E6%9C%80%E5%B8%B8%E8%A7%81%E7%9C%8B%E5%88%B0%E7%9A%84-TLS-x2F-HTTPS"><span class="nav-number">1.2.1.</span> <span class="nav-text">1️⃣ 传输中加密（In Transit）：你最常见看到的 TLS&#x2F;HTTPS</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%A0%E5%85%B3%E6%B3%A8-3-%E7%82%B9%E5%B0%B1%E5%A4%9F%EF%BC%9A"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">你关注 3 点就够：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E5%9D%91%EF%BC%88%E4%BD%A0%E8%A6%81%E4%BC%9A%E8%AF%86%E5%88%AB%EF%BC%89"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">常见坑（你要会识别）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%B8%8F%E2%83%A3-%E5%AD%98%E5%82%A8%E4%B8%AD%E5%8A%A0%E5%AF%86%EF%BC%88At-Rest%EF%BC%89%EF%BC%9A%E7%9B%98%E4%B8%8A-x2F-%E5%BA%93%E9%87%8C%E7%9A%84%E4%B8%80%E5%88%87"><span class="nav-number">1.2.2.</span> <span class="nav-text">2️⃣ 存储中加密（At Rest）：盘上&#x2F;库里的一切</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%99%E9%87%8C%E5%AE%B9%E6%98%93%E7%8A%AF%E7%9A%84%E9%94%99%EF%BC%88%E6%96%B0%E6%89%8B%E5%B8%B8%E8%A7%81%EF%BC%89"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">这里容易犯的错（新手常见）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A3%E7%A1%AE%E6%96%B9%E5%90%91%EF%BC%88%E5%88%86%E4%B8%A4%E7%B1%BB%E6%95%B0%E6%8D%AE%EF%BC%89"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">正确方向（分两类数据）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#A-%E5%AF%86%E7%A0%81%E5%AD%98%E5%82%A8%EF%BC%88%E4%B8%8D%E5%8F%AF%E9%80%86%EF%BC%8C%E5%8F%AA%E8%83%BD%E9%AA%8C%E8%AF%81%EF%BC%89"><span class="nav-number">1.2.2.2.1.</span> <span class="nav-text">A. 密码存储（不可逆，只能验证）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#B-%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%EF%BC%88%E9%9D%9E%E5%AF%86%E7%A0%81%EF%BC%8C%E9%9C%80%E5%8F%AF%E9%80%86%EF%BC%89"><span class="nav-number">1.2.2.2.2.</span> <span class="nav-text">B. 敏感数据（非密码，需可逆）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%EF%B8%8F%E2%83%A3-%E8%AE%A4%E8%AF%81-x2F-%E7%AD%BE%E5%90%8D%EF%BC%9A%E4%BD%A0%E5%9C%A8-API%E3%80%81%E7%99%BB%E5%BD%95%E3%80%81%E8%AF%81%E4%B9%A6%E9%87%8C%E9%83%BD%E8%83%BD%E9%81%87%E5%88%B0"><span class="nav-number">1.2.3.</span> <span class="nav-text">3️⃣ 认证&#x2F;签名：你在 API、登录、证书里都能遇到</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E5%9C%BA%E6%99%AF%E5%AF%B9%E6%AF%94"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">常见场景对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HMAC-vs-%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%EF%BC%88%E5%85%B3%E9%94%AE%E5%8C%BA%E5%88%AB%EF%BC%89"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">HMAC vs 数字签名（关键区别）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%EF%B8%8F%E2%83%A3-%E5%AF%86%E9%92%A5%E7%AE%A1%E7%90%86%EF%BC%88KMS-x2F-%E8%BD%AE%E6%8D%A2%EF%BC%89%EF%BC%9A%E7%9C%9F%E6%AD%A3%E2%80%9D%E6%8B%89%E5%BC%80%E5%B7%AE%E8%B7%9D%E2%80%9D%E7%9A%84%E5%9C%B0%E6%96%B9"><span class="nav-number">1.2.4.</span> <span class="nav-text">4️⃣ 密钥管理（KMS&#x2F;轮换）：真正”拉开差距”的地方</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E7%A8%8B%E4%B8%8A%E6%9C%80%E5%B8%B8%E8%A7%81%E7%BF%BB%E8%BD%A6%E7%82%B9%EF%BC%88%E4%BD%A0%E8%A6%81%E4%BC%9A%E8%AF%86%E5%88%AB%EF%BC%89"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">工程上最常见翻车点（你要会识别）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%A0%E5%85%88%E4%BB%8E%E2%80%9D%E8%83%BD%E5%81%9A%E5%88%B0%E7%9A%84%E6%9C%80%E5%B0%8F%E5%AE%9E%E8%B7%B5%E2%80%9D%E5%BC%80%E5%A7%8B"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">你先从”能做到的最小实践”开始</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%86%E9%92%A5%E8%BD%AE%E6%8D%A2%E7%AD%96%E7%95%A5%EF%BC%88%E6%9C%80%E5%B0%8F%E5%8F%AF%E7%94%A8%E7%89%88%EF%BC%89"><span class="nav-number">1.2.4.3.</span> <span class="nav-text">密钥轮换策略（最小可用版）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E8%B7%B5%E4%BB%BB%E5%8A%A1%EF%BC%88%E5%90%88%E6%B3%95%E6%8E%88%E6%9D%83%E8%8C%83%E5%9B%B4%E5%86%85%EF%BC%89"><span class="nav-number">1.3.</span> <span class="nav-text">实践任务（合法授权范围内）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1-1%EF%BC%88%E5%BF%85%E5%81%9A%EF%BC%89%EF%BC%9A%E7%94%A8%E2%80%9D%E6%A3%80%E6%9F%A5%E6%B8%85%E5%8D%95%E2%80%9D%E8%AF%84%E4%BC%B0%E4%B8%80%E4%B8%AA%E5%AF%86%E7%A0%81%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88"><span class="nav-number">1.3.1.</span> <span class="nav-text">任务 1（必做）：用”检查清单”评估一个密码存储方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1-2%EF%BC%88%E5%BF%85%E5%81%9A%EF%BC%89%EF%BC%9A%E7%94%A8-Python-%E6%BC%94%E7%A4%BA%E2%80%9D%E5%BF%AB%E5%93%88%E5%B8%8C-vs-%E6%85%A2-KDF%E2%80%9D%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">1.3.2.</span> <span class="nav-text">任务 2（必做）：用 Python 演示”快哈希 vs 慢 KDF”的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1-3%EF%BC%88%E5%BF%85%E5%81%9A%EF%BC%89%EF%BC%9A%E5%86%99%E4%B8%80%E5%BC%A0%E2%80%9D%E5%BA%94%E7%94%A8%E5%8A%A0%E5%AF%86%E6%A3%80%E6%9F%A5%E6%B8%85%E5%8D%95%E2%80%9D%EF%BC%88%E5%AD%98%E6%A1%A3%E5%88%B0%E4%BB%8A%E5%A4%A9%E7%9A%84%E6%88%90%E6%9E%9C%E9%87%8C%EF%BC%89"><span class="nav-number">1.3.3.</span> <span class="nav-text">任务 3（必做）：写一张”应用加密检查清单”（存档到今天的成果里）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%A0%E8%BE%93%E5%8A%A0%E5%AF%86%E6%A3%80%E6%9F%A5%E6%B8%85%E5%8D%95"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">传输加密检查清单</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%86%E7%A0%81%E5%AD%98%E5%82%A8%E6%A3%80%E6%9F%A5%E6%B8%85%E5%8D%95"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">密码存储检查清单</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86%E6%A3%80%E6%9F%A5%E6%B8%85%E5%8D%95"><span class="nav-number">1.3.3.3.</span> <span class="nav-text">敏感数据加密检查清单</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%86%E9%92%A5%E7%AE%A1%E7%90%86%E6%A3%80%E6%9F%A5%E6%B8%85%E5%8D%95"><span class="nav-number">1.3.3.4.</span> <span class="nav-text">密钥管理检查清单</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E4%B8%8E%E5%AE%A1%E8%AE%A1%E6%A3%80%E6%9F%A5%E6%B8%85%E5%8D%95"><span class="nav-number">1.3.3.5.</span> <span class="nav-text">日志与审计检查清单</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1-4%EF%BC%88%E5%BC%BA%E7%83%88%E6%8E%A8%E8%8D%90%EF%BC%89%EF%BC%9Abcrypt-%E5%AE%9E%E6%88%98%E6%BC%94%E7%A4%BA"><span class="nav-number">1.3.4.</span> <span class="nav-text">任务 4（强烈推荐）：bcrypt 实战演示</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B7%A9%E5%9B%BA%E7%BB%83%E4%B9%A0%EF%BC%88%E9%A2%98%E4%B8%8E%E5%A4%8D%E7%9B%98%EF%BC%89"><span class="nav-number">1.4.</span> <span class="nav-text">巩固练习（题与复盘）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%98-1%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E8%83%BD%E7%94%A8%E6%98%8E%E6%96%87%E6%88%96%E5%8F%AF%E9%80%86%E5%8A%A0%E5%AF%86%E5%AD%98%E5%82%A8%E5%AF%86%E7%A0%81%EF%BC%9F"><span class="nav-number">1.4.1.</span> <span class="nav-text">题 1：为什么不能用明文或可逆加密存储密码？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%98-2%EF%BC%9A%E8%AE%BE%E8%AE%A1%E4%B8%80%E5%A5%97%E5%AF%86%E7%A0%81%E5%AD%98%E5%82%A8%E7%AD%96%E7%95%A5%EF%BC%88%E5%86%99%E5%88%B0%E8%83%BD%E8%90%BD%E5%9C%B0%EF%BC%89"><span class="nav-number">1.4.2.</span> <span class="nav-text">题 2：设计一套密码存储策略（写到能落地）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%98-3%EF%BC%88%E6%96%B0%E5%A2%9E%EF%BC%89%EF%BC%9A%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E5%AF%86%E9%92%A5%E9%9C%80%E8%A6%81%E7%B4%A7%E6%80%A5%E8%BD%AE%E6%8D%A2%EF%BC%9F"><span class="nav-number">1.4.3.</span> <span class="nav-text">题 3（新增）：什么情况下密钥需要紧急轮换？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%98-4%EF%BC%88%E6%96%B0%E5%A2%9E%EF%BC%89%EF%BC%9A%E5%AF%B9%E6%AF%94-HMAC-%E5%92%8C-%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">1.4.4.</span> <span class="nav-text">题 4（新增）：对比 HMAC 和 数字签名的应用场景</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%84%E4%BC%B0%E6%A0%87%E5%87%86%EF%BC%88%E8%BE%BE%E6%88%90%E5%88%A4%E5%AE%9A%EF%BC%89"><span class="nav-number">1.5.</span> <span class="nav-text">评估标准（达成判定）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%BE%BE%E6%88%90%E6%83%85%E5%86%B5%EF%BC%88%E7%94%B1%E5%AD%A6%E4%B9%A0%E8%80%85%E5%A1%AB%E5%86%99%EF%BC%89"><span class="nav-number">1.6.</span> <span class="nav-text">学习成果达成情况（由学习者填写）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%88%AA%E5%9B%BE%E4%B8%8E%E8%AF%81%E6%8D%AE"><span class="nav-number">1.6.1.</span> <span class="nav-text">截图与证据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E5%91%BD%E4%BB%A4%E4%B8%8E%E8%BE%93%E5%87%BA"><span class="nav-number">1.6.2.</span> <span class="nav-text">关键命令与输出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%8A%A0%E5%AF%86%E6%A3%80%E6%9F%A5%E6%B8%85%E5%8D%95%EF%BC%88%E5%8B%BE%E9%80%89%E4%BD%A0%E7%9A%84%E9%A1%B9%E7%9B%AE%E7%AC%A6%E5%90%88%E7%9A%84%E9%A1%B9%EF%BC%89"><span class="nav-number">1.6.3.</span> <span class="nav-text">应用加密检查清单（勾选你的项目符合的项）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%A0%E8%BE%93%E5%8A%A0%E5%AF%86"><span class="nav-number">1.6.3.1.</span> <span class="nav-text">传输加密</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%86%E7%A0%81%E5%AD%98%E5%82%A8"><span class="nav-number">1.6.3.2.</span> <span class="nav-text">密码存储</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86"><span class="nav-number">1.6.3.3.</span> <span class="nav-text">敏感数据加密</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%86%E9%92%A5%E7%AE%A1%E7%90%86"><span class="nav-number">1.6.3.4.</span> <span class="nav-text">密钥管理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E4%B8%8E%E5%AE%A1%E8%AE%A1"><span class="nav-number">1.6.3.5.</span> <span class="nav-text">日志与审计</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E8%AE%BA%E4%B8%8E%E5%8F%8D%E6%80%9D"><span class="nav-number">1.6.4.</span> <span class="nav-text">结论与反思</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9B%86%E4%B8%AD%E5%8F%82%E8%80%83%E7%AD%94%E6%A1%88%EF%BC%88%E5%90%AB%E6%80%9D%E8%B7%AF%EF%BC%89"><span class="nav-number">1.7.</span> <span class="nav-text">集中参考答案（含思路）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%98-1-%E5%8F%82%E8%80%83%E7%AD%94%E6%A1%88"><span class="nav-number">1.7.1.</span> <span class="nav-text">题 1 参考答案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%98-2-%E5%8F%82%E8%80%83%E7%AD%94%E6%A1%88%EF%BC%88%E5%AE%8C%E6%95%B4%E5%AF%86%E7%A0%81%E5%AD%98%E5%82%A8%E7%AD%96%E7%95%A5%EF%BC%89"><span class="nav-number">1.7.2.</span> <span class="nav-text">题 2 参考答案（完整密码存储策略）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%AE%97%E6%B3%95%E9%80%89%E6%8B%A9"><span class="nav-number">1.7.2.1.</span> <span class="nav-text">1. 算法选择</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-salt-%E7%AD%96%E7%95%A5"><span class="nav-number">1.7.2.2.</span> <span class="nav-text">2. salt 策略</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E6%88%90%E6%9C%AC%E5%8F%82%E6%95%B0"><span class="nav-number">1.7.2.3.</span> <span class="nav-text">3. 成本参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E5%AD%98%E5%82%A8%E5%AD%97%E6%AE%B5"><span class="nav-number">1.7.2.4.</span> <span class="nav-text">4. 存储字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E9%AA%8C%E8%AF%81%E6%B5%81%E7%A8%8B"><span class="nav-number">1.7.2.5.</span> <span class="nav-text">5. 验证流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-%E8%BF%81%E7%A7%BB-x2F-%E5%8D%87%E7%BA%A7%E7%AD%96%E7%95%A5"><span class="nav-number">1.7.2.6.</span> <span class="nav-text">6. 迁移&#x2F;升级策略</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%98-3-%E5%8F%82%E8%80%83%E7%AD%94%E6%A1%88%EF%BC%88%E5%AF%86%E9%92%A5%E7%B4%A7%E6%80%A5%E8%BD%AE%E6%8D%A2%EF%BC%89"><span class="nav-number">1.7.3.</span> <span class="nav-text">题 3 参考答案（密钥紧急轮换）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A6%E5%8F%91%E6%9D%A1%E4%BB%B6%EF%BC%88%E6%8C%89%E4%B8%A5%E9%87%8D%E7%A8%8B%E5%BA%A6%E6%8E%92%E5%BA%8F%EF%BC%89"><span class="nav-number">1.7.3.1.</span> <span class="nav-text">触发条件（按严重程度排序）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4%EF%BC%88SOP%EF%BC%89"><span class="nav-number">1.7.3.2.</span> <span class="nav-text">操作步骤（SOP）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%98-4-%E5%8F%82%E8%80%83%E7%AD%94%E6%A1%88%EF%BC%88HMAC-vs-%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%EF%BC%89"><span class="nav-number">1.7.4.</span> <span class="nav-text">题 4 参考答案（HMAC vs 数字签名）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E7%A4%BA%E4%BE%8B%E5%A1%AB%E5%86%99%EF%BC%88%E5%8F%AF%E7%85%A7%E6%8A%84%EF%BC%89"><span class="nav-number">1.8.</span> <span class="nav-text">学习成果示例填写（可照抄）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%88%AA%E5%9B%BE%E4%B8%8E%E8%AF%81%E6%8D%AE%EF%BC%88%E7%A4%BA%E4%BE%8B%EF%BC%89"><span class="nav-number">1.8.1.</span> <span class="nav-text">截图与证据（示例）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E5%91%BD%E4%BB%A4%E4%B8%8E%E8%BE%93%E5%87%BA%EF%BC%88%E7%A4%BA%E4%BE%8B%EF%BC%89"><span class="nav-number">1.8.2.</span> <span class="nav-text">关键命令与输出（示例）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E8%AE%BA%E4%B8%8E%E5%8F%8D%E6%80%9D%EF%BC%88%E7%A4%BA%E4%BE%8B%EF%BC%89"><span class="nav-number">1.8.3.</span> <span class="nav-text">结论与反思（示例）</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Tigercoll"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Tigercoll</p>
  <div class="site-description" itemprop="description">万丈高楼平地起,勿在浮沙筑高台</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives">
          <span class="site-state-item-count">82</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories">
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags">
        <span class="site-state-item-count">75</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Tigercoll" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Tigercoll" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/Tigercoll" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tigercoll.top/post/4138cc96.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Tigercoll">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tigercoll's Blog">
      <meta itemprop="description" content="万丈高楼平地起,勿在浮沙筑高台">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Day013：安全协议与加密 - 加密应用与场景 | Tigercoll's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Day013：安全协议与加密 - 加密应用与场景
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-01-06 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-06T00:00:00+08:00">2026-01-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络安全</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="Day013：安全协议与加密-加密应用与场景"><a href="#Day013：安全协议与加密-加密应用与场景" class="headerlink" title="Day013：安全协议与加密 - 加密应用与场景"></a>Day013：安全协议与加密 - 加密应用与场景</h1><ul>
<li>日期：2026-01-06</li>
<li>周次：第 2 周</li>
</ul>
<h2 id="学习目标"><a href="#学习目标" class="headerlink" title="学习目标"></a>学习目标</h2><p>学完今天你应该能做到：</p>
<ul>
<li>能把”加密”分成 3 类场景：<strong>传输中</strong>、<strong>存储中</strong>、<strong>认证&#x2F;签名</strong></li>
<li>能识别 5 个常见错误：<ul>
<li>明文存密码</li>
<li>可逆加密存密码</li>
<li>没盐（salt）</li>
<li>迭代太低&#x2F;用快哈希（如 SHA-256）直接存密码</li>
<li>密钥硬编码&#x2F;长期不轮换</li>
</ul>
</li>
<li>能输出一张你自己的”应用加密检查清单”（照着抄也行）</li>
<li>能用 Python 演示”快哈希 vs 慢 KDF”的性能差异</li>
<li>能写出一份完整的密码存储设计文档</li>
</ul>
<span id="more"></span>

<h2 id="学习内容"><a href="#学习内容" class="headerlink" title="学习内容"></a>学习内容</h2><h3 id="1️⃣-传输中加密（In-Transit）：你最常见看到的-TLS-x2F-HTTPS"><a href="#1️⃣-传输中加密（In-Transit）：你最常见看到的-TLS-x2F-HTTPS" class="headerlink" title="1️⃣ 传输中加密（In Transit）：你最常见看到的 TLS&#x2F;HTTPS"></a>1️⃣ 传输中加密（In Transit）：你最常见看到的 TLS&#x2F;HTTPS</h3><p><strong>核心原理（1 句话）</strong>：用加密保护”数据在网络上飞”的过程。</p>
<h4 id="你关注-3-点就够："><a href="#你关注-3-点就够：" class="headerlink" title="你关注 3 点就够："></a>你关注 3 点就够：</h4><p><strong>A. 是否加密（是不是 HTTPS）</strong></p>
<ul>
<li>看地址栏：<code>https://</code> 开头 + 小锁图标 🔒</li>
<li>抓包看：Wireshark 显示 <code>TLS</code> 而不是明文 <code>HTTP</code></li>
<li>Chrome 开发者工具：Network → Protocol 列显示 <code>h2</code>（HTTP&#x2F;2 over TLS）</li>
</ul>
<p><strong>B. 是否验证身份（证书可信吗）</strong></p>
<p>检查证书的 4 个要素：</p>
<table>
<thead>
<tr>
<th>检查项</th>
<th>怎么看</th>
<th>合格标准</th>
</tr>
</thead>
<tbody><tr>
<td>域名匹配</td>
<td>点小锁 → 证书详情 → “颁发给”</td>
<td>与访问的域名一致</td>
</tr>
<tr>
<td>有效期</td>
<td>证书详情 → “有效期自…至…”</td>
<td>当前日期在有效期内</td>
</tr>
<tr>
<td>证书链</td>
<td>证书详情 → “证书路径”</td>
<td>Root CA → Intermediate CA → 网站证书</td>
</tr>
<tr>
<td>受信任</td>
<td>浏览器无红色警告</td>
<td>根证书在操作系统信任列表中</td>
</tr>
</tbody></table>
<p><strong>C. 是否能被降级&#x2F;误用</strong></p>
<table>
<thead>
<tr>
<th>风险类型</th>
<th>表现</th>
<th>危害</th>
<th>检测方法</th>
</tr>
</thead>
<tbody><tr>
<td>混合内容（Mixed Content）</td>
<td>HTTPS 页面加载 HTTP 资源（图片&#x2F;JS&#x2F;CSS）</td>
<td>部分资源可能被劫持</td>
<td>浏览器 F12 控制台黄色&#x2F;红色警告</td>
</tr>
<tr>
<td>老 TLS 版本</td>
<td>使用 TLS 1.0&#x2F;1.1</td>
<td>容易被攻击（如 BEAST、POODLE）</td>
<td><code>curl -v</code> 查看 TLS version</td>
</tr>
<tr>
<td>证书固定失效</td>
<td>APP 不验证证书链</td>
<td>中间人攻击</td>
<td>抓包工具能解密 HTTPS</td>
</tr>
<tr>
<td>HTTP 自动跳转失败</td>
<td>输入 <code>http://</code> 不跳转到 <code>https://</code></td>
<td>首次访问被劫持</td>
<td>手动测试 <code>curl -I http://site</code></td>
</tr>
</tbody></table>
<h4 id="常见坑（你要会识别）"><a href="#常见坑（你要会识别）" class="headerlink" title="常见坑（你要会识别）"></a>常见坑（你要会识别）</h4><table>
<thead>
<tr>
<th>坑</th>
<th>后果</th>
<th>怎么发现</th>
<th>如何修复</th>
</tr>
</thead>
<tbody><tr>
<td>证书过期</td>
<td>浏览器拒绝访问（NET::ERR_CERT_DATE_INVALID）</td>
<td>点小锁看有效期</td>
<td>续期证书（Let’s Encrypt 可免费自动续期）</td>
</tr>
<tr>
<td>自签名证书</td>
<td>浏览器警告”不安全”</td>
<td>证书链中找不到受信任的根 CA</td>
<td>用受信任 CA 签发证书或将根证书加入信任列表</td>
</tr>
<tr>
<td>域名不匹配</td>
<td>中间人攻击风险</td>
<td>证书颁发给 <code>example.com</code> 但访问 <code>test.com</code></td>
<td>申请多域名证书（SAN）或通配符证书</td>
</tr>
<tr>
<td>混合内容</td>
<td>部分资源未加密，可能被劫持</td>
<td>浏览器 F12 控制台有黄色&#x2F;红色警告</td>
<td>所有资源改用 HTTPS 或相对协议 <code>//cdn.example.com/style.css</code></td>
</tr>
</tbody></table>
<h3 id="2️⃣-存储中加密（At-Rest）：盘上-x2F-库里的一切"><a href="#2️⃣-存储中加密（At-Rest）：盘上-x2F-库里的一切" class="headerlink" title="2️⃣ 存储中加密（At Rest）：盘上&#x2F;库里的一切"></a>2️⃣ 存储中加密（At Rest）：盘上&#x2F;库里的一切</h3><p><strong>核心原理（1 句话）</strong>：数据存在硬盘&#x2F;数据库时也要保护，防止物理失窃&#x2F;备份泄露。</p>
<h4 id="这里容易犯的错（新手常见）"><a href="#这里容易犯的错（新手常见）" class="headerlink" title="这里容易犯的错（新手常见）"></a>这里容易犯的错（新手常见）</h4><table>
<thead>
<tr>
<th>错误做法</th>
<th>为什么不行</th>
<th>正确做法</th>
</tr>
</thead>
<tbody><tr>
<td>❌ 明文存密码</td>
<td>数据库泄露 &#x3D; 密码直接曝光</td>
<td>用 KDF 哈希 + salt</td>
</tr>
<tr>
<td>❌ MD5&#x2F;SHA-256 存密码</td>
<td>太快，GPU 每秒可尝试数十亿次</td>
<td>用 bcrypt&#x2F;Argon2&#x2F;scrypt&#x2F;PBKDF2</td>
</tr>
<tr>
<td>❌ AES 加密存密码</td>
<td>密钥泄露就能批量解密</td>
<td>密码不需要可逆，用哈希不用加密</td>
</tr>
<tr>
<td>❌ 统一 salt</td>
<td>重复密码会暴露（相同 hash）</td>
<td>每个用户独立随机 salt</td>
</tr>
<tr>
<td>❌ 迭代次数太低</td>
<td>爆破成本太低</td>
<td>PBKDF2 ≥ 200,000 次，bcrypt work_factor ≥ 10</td>
</tr>
</tbody></table>
<h4 id="正确方向（分两类数据）"><a href="#正确方向（分两类数据）" class="headerlink" title="正确方向（分两类数据）"></a>正确方向（分两类数据）</h4><h5 id="A-密码存储（不可逆，只能验证）"><a href="#A-密码存储（不可逆，只能验证）" class="headerlink" title="A. 密码存储（不可逆，只能验证）"></a>A. 密码存储（不可逆，只能验证）</h5><p>用 <strong>KDF</strong>（Key Derivation Function，密钥派生函数）而不是普通哈希：</p>
<table>
<thead>
<tr>
<th>KDF 算法</th>
<th>特点</th>
<th>推荐指数</th>
<th>成本参数</th>
<th>Python 库</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Argon2</strong></td>
<td>2015 年密码哈希竞赛冠军，抗 GPU&#x2F;ASIC，内存困难</td>
<td>⭐⭐⭐⭐⭐</td>
<td><code>memory_cost=65536</code>, <code>time_cost=3</code>, <code>parallelism=4</code></td>
<td><code>argon2-cffi</code></td>
</tr>
<tr>
<td><strong>scrypt</strong></td>
<td>内存困难，较老但仍安全</td>
<td>⭐⭐⭐⭐</td>
<td><code>N=2^14</code>, <code>r=8</code>, <code>p=1</code></td>
<td><code>hashlib.scrypt</code> (Python 3.6+)</td>
</tr>
<tr>
<td><strong>bcrypt</strong></td>
<td>工业标准，广泛支持，Blowfish 变种</td>
<td>⭐⭐⭐⭐</td>
<td><code>work_factor=10~12</code>（每增加 1，慢 2 倍）</td>
<td><code>bcrypt</code></td>
</tr>
<tr>
<td><strong>PBKDF2</strong></td>
<td>标准库自带，最基础，NIST 推荐</td>
<td>⭐⭐⭐</td>
<td><code>iterations=200,000~600,000</code></td>
<td><code>hashlib.pbkdf2_hmac</code></td>
</tr>
</tbody></table>
<p><strong>为什么要 KDF？（用对比说明）</strong></p>
<table>
<thead>
<tr>
<th>对比项</th>
<th>SHA-256（快哈希）</th>
<th>bcrypt（KDF）</th>
</tr>
</thead>
<tbody><tr>
<td>单次计算时间</td>
<td>0.001 ms</td>
<td>100-300 ms</td>
</tr>
<tr>
<td>GPU 每秒尝试次数</td>
<td>数十亿次</td>
<td>数千次</td>
</tr>
<tr>
<td>8 字符密码爆破时间</td>
<td>几小时</td>
<td>数百年</td>
</tr>
<tr>
<td>是否需要 salt</td>
<td>可选（但必须）</td>
<td>内置 salt 机制</td>
</tr>
<tr>
<td>能否调节难度</td>
<td>不能</td>
<td>可以（随硬件升级增加成本）</td>
</tr>
</tbody></table>
<p><strong>bcrypt 存储格式详解</strong>（以 bcrypt 为例）：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$2b$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p/.CPY.tHOHEa2xFH0p3.O</span><br><span class="line"> │  │  │                                               │</span><br><span class="line"> │  │  └─ salt（22 字符 Base64）                       └─ hash（31 字符 Base64）</span><br><span class="line"> │  └─ work_factor（成本参数，10 表示 2^10=1024 轮迭代）</span><br><span class="line"> └─ 算法版本（2b 表示 bcrypt 新版本）</span><br></pre></td></tr></table></figure>

<p><strong>关键特性</strong>：</p>
<ul>
<li><strong>慢是特性，不是缺陷</strong>：单次验证 100-300ms 对用户无感，但让攻击者爆破成本指数级上升</li>
<li><strong>每个用户独立 salt</strong>：防止彩虹表攻击，即使两个用户密码相同，hash 也不同</li>
<li><strong>可调节成本</strong>：随着硬件性能提升，可以增加 work_factor（如从 10 提到 12）</li>
</ul>
<h5 id="B-敏感数据（非密码，需可逆）"><a href="#B-敏感数据（非密码，需可逆）" class="headerlink" title="B. 敏感数据（非密码，需可逆）"></a>B. 敏感数据（非密码，需可逆）</h5><p>比如身份证号、银行卡、健康记录、API 密钥等：</p>
<p><strong>算法选择</strong>：</p>
<table>
<thead>
<tr>
<th>算法</th>
<th>特点</th>
<th>推荐场景</th>
</tr>
</thead>
<tbody><tr>
<td><strong>AES-256-GCM</strong></td>
<td>认证加密（AEAD），既保密又防篡改</td>
<td>数据库字段加密、文件加密</td>
</tr>
<tr>
<td><strong>ChaCha20-Poly1305</strong></td>
<td>软件实现更快，移动端友好</td>
<td>移动 APP、物联网设备</td>
</tr>
<tr>
<td>AES-256-CBC + HMAC</td>
<td>传统方案，需手动做 MAC</td>
<td>老系统兼容</td>
</tr>
</tbody></table>
<p><strong>密钥管理层级</strong>（从低到高）：</p>
<table>
<thead>
<tr>
<th>层级</th>
<th>做法</th>
<th>风险</th>
<th>适用场景</th>
</tr>
</thead>
<tbody><tr>
<td>❌ 硬编码</td>
<td>密钥写在代码里</td>
<td>代码泄露 &#x3D; 密钥泄露</td>
<td><strong>禁止使用</strong></td>
</tr>
<tr>
<td>⚠️ 环境变量</td>
<td><code>os.environ[&#39;SECRET_KEY&#39;]</code></td>
<td>进程信息可能泄露，日志可能打印</td>
<td>个人项目&#x2F;学习</td>
</tr>
<tr>
<td>✅ 配置中心</td>
<td>Consul&#x2F;Vault&#x2F;etcd</td>
<td>需要额外维护配置中心</td>
<td>中小团队</td>
</tr>
<tr>
<td>✅✅ 云 KMS</td>
<td>AWS KMS&#x2F;Azure Key Vault&#x2F;GCP KMS</td>
<td>依赖云服务商</td>
<td>企业生产环境</td>
</tr>
<tr>
<td>✅✅✅ HSM</td>
<td>硬件安全模块（FIPS 140-2 认证）</td>
<td>成本高，操作复杂</td>
<td>金融&#x2F;支付&#x2F;政府</td>
</tr>
</tbody></table>
<p><strong>IV&#x2F;Nonce 处理规则</strong>：</p>
<ul>
<li><strong>必须随机</strong>：每次加密用新的随机 IV（<code>os.urandom(16)</code>）</li>
<li><strong>可以公开</strong>：IV 不是密钥，可以和密文一起存储（如 <code>IV || Ciphertext</code>）</li>
<li><strong>不能重复</strong>：同一密钥下 IV 重复会泄露明文模式（尤其 AES-CTR&#x2F;GCM）</li>
</ul>
<p><strong>存储格式示例</strong>（JSON 形式）：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;algorithm&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AES-256-GCM&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;iv&quot;</span><span class="punctuation">:</span> <span class="string">&quot;a1b2c3d4e5f6...&quot;</span><span class="punctuation">,</span>  <span class="comment">// Base64 编码的 IV</span></span><br><span class="line">  <span class="attr">&quot;ciphertext&quot;</span><span class="punctuation">:</span> <span class="string">&quot;9f8e7d6c5b4a...&quot;</span><span class="punctuation">,</span>  <span class="comment">// Base64 编码的密文</span></span><br><span class="line">  <span class="attr">&quot;tag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1a2b3c4d...&quot;</span><span class="punctuation">,</span>  <span class="comment">// GCM 模式的认证标签</span></span><br><span class="line">  <span class="attr">&quot;key_version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;v2&quot;</span>  <span class="comment">// 密钥版本，便于轮换</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="3️⃣-认证-x2F-签名：你在-API、登录、证书里都能遇到"><a href="#3️⃣-认证-x2F-签名：你在-API、登录、证书里都能遇到" class="headerlink" title="3️⃣ 认证&#x2F;签名：你在 API、登录、证书里都能遇到"></a>3️⃣ 认证&#x2F;签名：你在 API、登录、证书里都能遇到</h3><p><strong>核心原理（1 句话）</strong>：证明”消息是谁发的”+”有没有被改过”。</p>
<h4 id="常见场景对比"><a href="#常见场景对比" class="headerlink" title="常见场景对比"></a>常见场景对比</h4><table>
<thead>
<tr>
<th>场景</th>
<th>用什么</th>
<th>目的</th>
<th>示例</th>
<th>验证方</th>
</tr>
</thead>
<tbody><tr>
<td><strong>API 请求签名</strong></td>
<td>HMAC-SHA256</td>
<td>防止请求被篡改&#x2F;重放</td>
<td>AWS Signature V4, 微信支付签名</td>
<td>服务端（持有相同密钥）</td>
</tr>
<tr>
<td><strong>JWT 令牌</strong></td>
<td>HS256(HMAC) 或 RS256(RSA)</td>
<td>无状态认证</td>
<td>用户登录后生成 JWT，后续请求带上</td>
<td>任何服务（HS256 需密钥，RS256 需公钥）</td>
</tr>
<tr>
<td><strong>TLS 证书</strong></td>
<td>RSA&#x2F;ECDSA 签名</td>
<td>证明公钥归属</td>
<td>CA 用私钥签名网站的公钥</td>
<td>浏览器&#x2F;操作系统（持有 CA 公钥）</td>
</tr>
<tr>
<td><strong>Git 提交</strong></td>
<td>GPG 签名（RSA&#x2F;ECDSA）</td>
<td>证明提交者身份</td>
<td><code>git commit -S</code></td>
<td>GitHub&#x2F;GitLab（导入的 GPG 公钥）</td>
</tr>
<tr>
<td><strong>代码签名</strong></td>
<td>Authenticode（Windows）&#x2F;Codesign（macOS）</td>
<td>证明软件来源</td>
<td>驱动程序、安装包</td>
<td>操作系统（验证证书链）</td>
</tr>
</tbody></table>
<h4 id="HMAC-vs-数字签名（关键区别）"><a href="#HMAC-vs-数字签名（关键区别）" class="headerlink" title="HMAC vs 数字签名（关键区别）"></a>HMAC vs 数字签名（关键区别）</h4><table>
<thead>
<tr>
<th>对比项</th>
<th>HMAC</th>
<th>数字签名（RSA&#x2F;ECDSA）</th>
</tr>
</thead>
<tbody><tr>
<td><strong>密钥类型</strong></td>
<td>对称（共享密钥）</td>
<td>非对称（公私钥对）</td>
</tr>
<tr>
<td><strong>谁能生成</strong></td>
<td>双方都能（持有共享密钥）</td>
<td>只有持有私钥的人</td>
</tr>
<tr>
<td><strong>谁能验证</strong></td>
<td>双方都能</td>
<td>任何人（用公钥验证）</td>
</tr>
<tr>
<td><strong>不可否认性</strong></td>
<td>❌ 双方都能生成，无法证明是谁</td>
<td>✅ 只有私钥持有者能生成</td>
</tr>
<tr>
<td><strong>适用场景</strong></td>
<td>双方信任的内部系统（如微服务间认证）</td>
<td>需要”不可否认性”的场景（如合同签署、代码发布）</td>
</tr>
<tr>
<td><strong>性能</strong></td>
<td>快（对称运算，几微秒）</td>
<td>慢（非对称运算，几毫秒）</td>
</tr>
<tr>
<td><strong>密钥分发</strong></td>
<td>困难（需要安全通道分发密钥）</td>
<td>简单（公钥可公开）</td>
</tr>
</tbody></table>
<p><strong>典型误用案例</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ❌ 错误：用 SHA-256 做&quot;签名&quot;（任何人都能算，无法证明身份）</span></span><br><span class="line">signature = hashlib.sha256(request_params.encode()).hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ✅ 正确：用 HMAC（需要密钥才能生成有效签名）</span></span><br><span class="line">signature = hmac.new(secret_key, request_params.encode(), hashlib.sha256).hexdigest()</span><br></pre></td></tr></table></figure>

<h3 id="4️⃣-密钥管理（KMS-x2F-轮换）：真正”拉开差距”的地方"><a href="#4️⃣-密钥管理（KMS-x2F-轮换）：真正”拉开差距”的地方" class="headerlink" title="4️⃣ 密钥管理（KMS&#x2F;轮换）：真正”拉开差距”的地方"></a>4️⃣ 密钥管理（KMS&#x2F;轮换）：真正”拉开差距”的地方</h3><p><strong>核心原理（1 句话）</strong>：再好的加密，密钥管理不当也白搭。</p>
<h4 id="工程上最常见翻车点（你要会识别）"><a href="#工程上最常见翻车点（你要会识别）" class="headerlink" title="工程上最常见翻车点（你要会识别）"></a>工程上最常见翻车点（你要会识别）</h4><table>
<thead>
<tr>
<th>翻车点</th>
<th>后果</th>
<th>真实案例</th>
<th>正确做法</th>
</tr>
</thead>
<tbody><tr>
<td><strong>密钥硬编码</strong></td>
<td>代码泄露（GitHub 公开&#x2F;反编译）&#x3D; 密钥全暴露</td>
<td>某公司 AWS 密钥提交到 GitHub，1 小时后被挖矿</td>
<td>用环境变量&#x2F;配置中心&#x2F;KMS</td>
</tr>
<tr>
<td><strong>密钥与数据同地</strong></td>
<td>机器被入侵&#x2F;备份泄露，数据+密钥一锅端</td>
<td>某医疗系统数据库备份含加密字段+密钥文件</td>
<td>密钥分离存储（如 AWS KMS）</td>
</tr>
<tr>
<td><strong>永不轮换</strong></td>
<td>密钥泄露后，历史+未来数据全部可解密</td>
<td>某支付公司密钥用了 5 年，泄露后无法止损</td>
<td>定期轮换（每季度&#x2F;每年）</td>
</tr>
<tr>
<td><strong>无权限控制</strong></td>
<td>所有服务&#x2F;人员都能读密钥</td>
<td>开发环境密钥被测试团队误用到生产</td>
<td>IAM 策略：最小权限原则</td>
</tr>
<tr>
<td><strong>无备份&#x2F;单点</strong></td>
<td>密钥丢失 &#x3D; 所有数据永久无法解密</td>
<td>某创业公司密钥文件被误删，数据库全废</td>
<td>密钥托管（Escrow）或异地多副本</td>
</tr>
<tr>
<td><strong>日志泄露密钥</strong></td>
<td>DEBUG 日志打印密钥，被收集到日志平台</td>
<td>某公司日志中心存有明文密钥，被内部人员窃取</td>
<td>日志脱敏，禁止打印密钥&#x2F;Token</td>
</tr>
</tbody></table>
<h4 id="你先从”能做到的最小实践”开始"><a href="#你先从”能做到的最小实践”开始" class="headerlink" title="你先从”能做到的最小实践”开始"></a>你先从”能做到的最小实践”开始</h4><table>
<thead>
<tr>
<th>层级</th>
<th>做法</th>
<th>适用场景</th>
<th>成本</th>
<th>安全性</th>
</tr>
</thead>
<tbody><tr>
<td><strong>入门级</strong></td>
<td>密钥放 <code>.env</code> 文件（不进 git，加入 <code>.gitignore</code>）</td>
<td>个人项目、学习演示</td>
<td>免费</td>
<td>⭐⭐</td>
</tr>
<tr>
<td><strong>进阶级</strong></td>
<td>密钥放配置中心（Consul&#x2F;Vault）+ 访问控制</td>
<td>小团队项目（5-20 人）</td>
<td>自建或低成本云服务</td>
<td>⭐⭐⭐</td>
</tr>
<tr>
<td><strong>生产级</strong></td>
<td>云服务商 KMS + 自动轮换 + 审计日志</td>
<td>企业应用（100+ 用户）</td>
<td>$1-10&#x2F;密钥&#x2F;月</td>
<td>⭐⭐⭐⭐</td>
</tr>
<tr>
<td><strong>金融级</strong></td>
<td>HSM（硬件安全模块）+ FIPS 140-2 认证 + 密钥仪式</td>
<td>支付&#x2F;银行&#x2F;证券</td>
<td>$1000+&#x2F;月</td>
<td>⭐⭐⭐⭐⭐</td>
</tr>
</tbody></table>
<h4 id="密钥轮换策略（最小可用版）"><a href="#密钥轮换策略（最小可用版）" class="headerlink" title="密钥轮换策略（最小可用版）"></a>密钥轮换策略（最小可用版）</h4><p><strong>1. 定义轮换周期</strong></p>
<table>
<thead>
<tr>
<th>密钥类型</th>
<th>敏感度</th>
<th>轮换周期</th>
<th>依据</th>
</tr>
</thead>
<tbody><tr>
<td>支付密钥</td>
<td>极高</td>
<td>3-6 个月</td>
<td>PCI-DSS 合规要求</td>
</tr>
<tr>
<td>数据加密密钥（DEK）</td>
<td>高</td>
<td>1 年</td>
<td>行业最佳实践</td>
</tr>
<tr>
<td>API 密钥</td>
<td>中</td>
<td>1-2 年</td>
<td>根据使用频率</td>
</tr>
<tr>
<td>日志签名密钥</td>
<td>低</td>
<td>2 年</td>
<td>历史日志需长期验证</td>
</tr>
</tbody></table>
<p><strong>2. 轮换流程（5 步法）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">阶段 1：准备</span><br><span class="line">  └─ 生成新密钥 key_v2（在 KMS 中生成，标记为 &quot;active&quot;）</span><br><span class="line">  └─ 将 key_v1 标记为 &quot;deprecated&quot;（保留但不再用于新加密）</span><br><span class="line"></span><br><span class="line">阶段 2：双跑</span><br><span class="line">  └─ 新数据用 key_v2 加密</span><br><span class="line">  └─ 旧数据仍保留 key_v1（解密时根据 key_version 字段选择密钥）</span><br><span class="line"></span><br><span class="line">阶段 3：重加密（可选，视数据量而定）</span><br><span class="line">  └─ 后台任务逐步将旧数据用 key_v2 重新加密</span><br><span class="line">  └─ 更新 key_version 字段为 &quot;v2&quot;</span><br><span class="line"></span><br><span class="line">阶段 4：观察期（1-4 周）</span><br><span class="line">  └─ 监控是否有系统仍在使用 key_v1</span><br><span class="line">  └─ 检查审计日志，确认无异常访问</span><br><span class="line"></span><br><span class="line">阶段 5：废弃</span><br><span class="line">  └─ 将 key_v1 标记为 &quot;disabled&quot;（保留但禁止使用）</span><br><span class="line">  └─ 6 个月后彻底删除 key_v1（符合审计要求后）</span><br></pre></td></tr></table></figure>

<p><strong>3. 应急轮换（紧急情况）</strong></p>
<table>
<thead>
<tr>
<th>触发条件</th>
<th>响应时间</th>
<th>操作步骤</th>
</tr>
</thead>
<tbody><tr>
<td>密钥疑似泄露（如员工离职前打印了密钥）</td>
<td>1 小时内</td>
<td>立即生成 key_v2，停用 key_v1，通知所有系统</td>
</tr>
<tr>
<td>安全事件（如服务器被入侵）</td>
<td>2 小时内</td>
<td>轮换所有密钥，审计历史访问记录，评估影响范围</td>
</tr>
<tr>
<td>合规要求（如监管机构要求）</td>
<td>24 小时内</td>
<td>按合规流程轮换，提交证据报告</td>
</tr>
</tbody></table>
<h2 id="实践任务（合法授权范围内）"><a href="#实践任务（合法授权范围内）" class="headerlink" title="实践任务（合法授权范围内）"></a>实践任务（合法授权范围内）</h2><blockquote>
<p>今天做一个”密码存储安全评估”的小演练：你可以评估你自己的 demo、或者网上随便找段示例代码（只做阅读分析）。</p>
</blockquote>
<h3 id="任务-1（必做）：用”检查清单”评估一个密码存储方案"><a href="#任务-1（必做）：用”检查清单”评估一个密码存储方案" class="headerlink" title="任务 1（必做）：用”检查清单”评估一个密码存储方案"></a>任务 1（必做）：用”检查清单”评估一个密码存储方案</h3><p>下面给你一个典型的<strong>坏例子</strong>（❌ <strong>不要在生产环境用</strong>）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ❌ 错误示例：用 SHA-256 直接存密码</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register_user_bad</span>(<span class="params">username, password</span>):</span><br><span class="line">    password_hash = hashlib.sha256(password.encode()).hexdigest()</span><br><span class="line">    <span class="comment"># 存储到数据库：INSERT INTO users (username, password_hash) VALUES (?, ?)</span></span><br><span class="line">    <span class="keyword">return</span> password_hash</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify_user_bad</span>(<span class="params">username, password, stored_hash</span>):</span><br><span class="line">    password_hash = hashlib.sha256(password.encode()).hexdigest()</span><br><span class="line">    <span class="keyword">return</span> password_hash == stored_hash</span><br></pre></td></tr></table></figure>

<p><strong>你需要写出为什么它不行</strong>（至少 3 点）：</p>
<ol>
<li>❌ <strong>SHA-256 太快</strong>：GPU 每秒可尝试数十亿次，8 字符密码几小时就能爆破</li>
<li>❌ <strong>没 salt</strong>：重复密码会有相同 hash，攻击者看到相同 hash 就知道密码一样</li>
<li>❌ <strong>无法升级</strong>：硬件性能提升后，无法增加计算难度（SHA-256 不支持成本参数）</li>
<li>❌ <strong>容易彩虹表攻击</strong>：预先计算好的常见密码哈希表可以瞬间查到</li>
</ol>
<p>然后写出一个”够用版正确方案”（伪代码即可）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ✅ 正确示例：用 bcrypt（工业标准）</span></span><br><span class="line"><span class="keyword">import</span> bcrypt</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register_user_good</span>(<span class="params">username, password</span>):</span><br><span class="line">    <span class="comment"># bcrypt 自动生成 salt 并包含在输出中</span></span><br><span class="line">    salt = bcrypt.gensalt(rounds=<span class="number">12</span>)  <span class="comment"># work_factor=12（2^12=4096 轮迭代）</span></span><br><span class="line">    password_hash = bcrypt.hashpw(password.encode(), salt)</span><br><span class="line">    <span class="comment"># 存储到数据库：INSERT INTO users (username, password_hash) VALUES (?, ?)</span></span><br><span class="line">    <span class="keyword">return</span> password_hash.decode()  <span class="comment"># 返回的格式：$2b$12$salt..hash..</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify_user_good</span>(<span class="params">username, password, stored_hash</span>):</span><br><span class="line">    <span class="comment"># bcrypt.checkpw 会自动从 stored_hash 中提取 salt</span></span><br><span class="line">    <span class="keyword">return</span> bcrypt.checkpw(password.encode(), stored_hash.encode())</span><br></pre></td></tr></table></figure>

<p><strong>为什么这个方案好</strong>：</p>
<ul>
<li>✅ <strong>bcrypt 很慢</strong>：单次验证 100-300ms，让攻击者每秒只能尝试几次</li>
<li>✅ <strong>自动 salt</strong>：每个用户独立随机 salt，防止彩虹表和重复密码暴露</li>
<li>✅ <strong>可升级</strong>：可以调整 rounds 参数（如从 12 提到 13），让计算时间翻倍</li>
<li>✅ <strong>工业标准</strong>：被广泛审计和使用，库实现经过充分测试</li>
</ul>
<h3 id="任务-2（必做）：用-Python-演示”快哈希-vs-慢-KDF”的区别"><a href="#任务-2（必做）：用-Python-演示”快哈希-vs-慢-KDF”的区别" class="headerlink" title="任务 2（必做）：用 Python 演示”快哈希 vs 慢 KDF”的区别"></a>任务 2（必做）：用 Python 演示”快哈希 vs 慢 KDF”的区别</h3><p>用标准库的 PBKDF2（这是 KDF 的一种）对比 SHA-256：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">python - &lt;&lt; <span class="string">&#x27;PY&#x27;</span></span><br><span class="line">import os</span><br><span class="line">import time</span><br><span class="line">import hashlib</span><br><span class="line"></span><br><span class="line">password = b<span class="string">&quot;P@ssw0rd!&quot;</span></span><br><span class="line">salt = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试 SHA-256（快哈希）</span></span><br><span class="line"><span class="built_in">start</span> = time.time()</span><br><span class="line">sha = hashlib.sha256(password).hexdigest()</span><br><span class="line">sha_time = (time.time() - <span class="built_in">start</span>) * <span class="number">1000</span></span><br><span class="line">print(f<span class="string">&quot;SHA-256:  &#123;sha[:32]&#125;... time=&#123;sha_time:.4f&#125; ms&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试 PBKDF2（KDF，200,000 次迭代）</span></span><br><span class="line"><span class="built_in">start</span> = time.time()</span><br><span class="line">pbk = hashlib.pbkdf2_hmac(<span class="string">&#x27;sha256&#x27;</span>, password, salt, <span class="number">200</span>_000).hex()</span><br><span class="line">pbk_time = (time.time() - <span class="built_in">start</span>) * <span class="number">1000</span></span><br><span class="line">print(f<span class="string">&quot;PBKDF2:   &#123;pbk[:32]&#125;... time=&#123;pbk_time:.4f&#125; ms&quot;</span>)</span><br><span class="line"></span><br><span class="line">print(f<span class="string">&quot;\n性能对比：PBKDF2 比 SHA-256 慢 &#123;pbk_time/sha_time:.0f&#125; 倍&quot;</span>)</span><br><span class="line">print(<span class="string">&quot;✅ 这就是 KDF 的目的：让攻击者爆破成本指数级上升&quot;</span>)</span><br><span class="line">PY</span><br></pre></td></tr></table></figure>

<p><strong>你要记录的结论</strong>（截图保存）：</p>
<ul>
<li>PBKDF2 明显更慢（通常慢 1000-10000 倍）<strong>这是它的目的</strong>：让爆破成本变高</li>
<li>有 salt，每次结果不一样（因为 salt 随机）</li>
<li>在我的机器上：<ul>
<li>SHA-256 用时：约 ___ ms</li>
<li>PBKDF2 用时：约 ___ ms</li>
<li>慢了 ___ 倍</li>
</ul>
</li>
</ul>
<h3 id="任务-3（必做）：写一张”应用加密检查清单”（存档到今天的成果里）"><a href="#任务-3（必做）：写一张”应用加密检查清单”（存档到今天的成果里）" class="headerlink" title="任务 3（必做）：写一张”应用加密检查清单”（存档到今天的成果里）"></a>任务 3（必做）：写一张”应用加密检查清单”（存档到今天的成果里）</h3><p>把下面的清单复制到你的成果区，然后<strong>逐条检查你的项目&#x2F;学习项目</strong>：</p>
<h4 id="传输加密检查清单"><a href="#传输加密检查清单" class="headerlink" title="传输加密检查清单"></a>传输加密检查清单</h4><ul>
<li><input disabled="" type="checkbox"> 所有敏感接口必须 HTTPS（包括 API、登录、支付）</li>
<li><input disabled="" type="checkbox"> 证书有效且域名匹配</li>
<li><input disabled="" type="checkbox"> 禁止在代码中忽略证书错误（如 <code>curl -k</code>、<code>requests.verify=False</code>）</li>
<li><input disabled="" type="checkbox"> 所有外部资源（CDN&#x2F;图片&#x2F;JS）使用 HTTPS</li>
<li><input disabled="" type="checkbox"> 配置 HSTS（HTTP Strict Transport Security）头部</li>
</ul>
<h4 id="密码存储检查清单"><a href="#密码存储检查清单" class="headerlink" title="密码存储检查清单"></a>密码存储检查清单</h4><ul>
<li><input disabled="" type="checkbox"> 使用 KDF（bcrypt&#x2F;Argon2&#x2F;scrypt&#x2F;PBKDF2），<strong>禁止</strong> MD5&#x2F;SHA-256 直接存密码</li>
<li><input disabled="" type="checkbox"> 每个用户独立随机 salt（不要全局统一 salt）</li>
<li><input disabled="" type="checkbox"> 成本参数合理：PBKDF2 ≥ 200,000 次，bcrypt work_factor ≥ 10</li>
<li><input disabled="" type="checkbox"> <strong>禁止</strong>可逆加密存密码（如 AES 加密存储）</li>
<li><input disabled="" type="checkbox"> 登录失败有限流（防止在线爆破）</li>
</ul>
<h4 id="敏感数据加密检查清单"><a href="#敏感数据加密检查清单" class="headerlink" title="敏感数据加密检查清单"></a>敏感数据加密检查清单</h4><ul>
<li><input disabled="" type="checkbox"> 敏感字段加密（如身份证号、银行卡），使用 AES-GCM 或 ChaCha20-Poly1305</li>
<li><input disabled="" type="checkbox"> 密钥不进 git（加入 <code>.gitignore</code>）</li>
<li><input disabled="" type="checkbox"> 密钥与数据分离存储（不要和数据库在同一台机器）</li>
<li><input disabled="" type="checkbox"> 每次加密使用新的随机 IV&#x2F;Nonce</li>
<li><input disabled="" type="checkbox"> 存储格式包含 <code>algorithm</code>、<code>iv</code>、<code>ciphertext</code>、<code>key_version</code></li>
</ul>
<h4 id="密钥管理检查清单"><a href="#密钥管理检查清单" class="headerlink" title="密钥管理检查清单"></a>密钥管理检查清单</h4><ul>
<li><input disabled="" type="checkbox"> 密钥不硬编码在代码中</li>
<li><input disabled="" type="checkbox"> 密钥有轮换策略（至少定义了”多久换一次”）</li>
<li><input disabled="" type="checkbox"> 密钥有应急替换流程（密钥泄露时怎么办）</li>
<li><input disabled="" type="checkbox"> 密钥有备份（但备份也要加密）</li>
<li><input disabled="" type="checkbox"> 最小权限：只有需要的服务&#x2F;人员能访问密钥</li>
</ul>
<h4 id="日志与审计检查清单"><a href="#日志与审计检查清单" class="headerlink" title="日志与审计检查清单"></a>日志与审计检查清单</h4><ul>
<li><input disabled="" type="checkbox"> 日志不打印敏感信息（密码&#x2F;Token&#x2F;密钥&#x2F;完整身份证号）</li>
<li><input disabled="" type="checkbox"> 密钥访问有审计日志（谁在什么时候访问了密钥）</li>
<li><input disabled="" type="checkbox"> 敏感操作有日志（如密码重置、密钥轮换）</li>
</ul>
<h3 id="任务-4（强烈推荐）：bcrypt-实战演示"><a href="#任务-4（强烈推荐）：bcrypt-实战演示" class="headerlink" title="任务 4（强烈推荐）：bcrypt 实战演示"></a>任务 4（强烈推荐）：bcrypt 实战演示</h3><p>安装 bcrypt 库并实际运行：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 bcrypt</span></span><br><span class="line">pip install bcrypt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行演示</span></span><br><span class="line">python - &lt;&lt; <span class="string">&#x27;PY&#x27;</span></span><br><span class="line">import bcrypt</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">password = b<span class="string">&quot;MySecureP@ssw0rd&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注册：生成哈希</span></span><br><span class="line">print(<span class="string">&quot;=== 注册流程 ===&quot;</span>)</span><br><span class="line"><span class="built_in">start</span> = time.time()</span><br><span class="line">salt = bcrypt.gensalt(rounds=<span class="number">12</span>)  <span class="comment"># work_factor=12</span></span><br><span class="line">password_hash = bcrypt.hashpw(password, salt)</span><br><span class="line">register_time = (time.time() - <span class="built_in">start</span>) * <span class="number">1000</span></span><br><span class="line">print(f<span class="string">&quot;密码哈希: &#123;password_hash.decode()&#125;&quot;</span>)</span><br><span class="line">print(f<span class="string">&quot;耗时: &#123;register_time:.2f&#125; ms&quot;</span>)</span><br><span class="line">print(f<span class="string">&quot;解析: <span class="variable">$2b</span> (算法) / <span class="variable">$12</span> (work_factor) / 22字符salt / 31字符hash&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录：验证哈希</span></span><br><span class="line">print(<span class="string">&quot;\n=== 登录流程（正确密码）===&quot;</span>)</span><br><span class="line"><span class="built_in">start</span> = time.time()</span><br><span class="line">is_valid = bcrypt.checkpw(password, password_hash)</span><br><span class="line">login_time = (time.time() - <span class="built_in">start</span>) * <span class="number">1000</span></span><br><span class="line">print(f<span class="string">&quot;验证结果: &#123;&#x27;✅ 密码正确&#x27; if is_valid else &#x27;❌ 密码错误&#x27;&#125;&quot;</span>)</span><br><span class="line">print(f<span class="string">&quot;耗时: &#123;login_time:.2f&#125; ms&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 错误密码测试</span></span><br><span class="line">print(<span class="string">&quot;\n=== 登录流程（错误密码）===&quot;</span>)</span><br><span class="line">wrong_password = b<span class="string">&quot;WrongPassword&quot;</span></span><br><span class="line"><span class="built_in">start</span> = time.time()</span><br><span class="line">is_valid = bcrypt.checkpw(wrong_password, password_hash)</span><br><span class="line">verify_time = (time.time() - <span class="built_in">start</span>) * <span class="number">1000</span></span><br><span class="line">print(f<span class="string">&quot;验证结果: &#123;&#x27;✅ 密码正确&#x27; if is_valid else &#x27;❌ 密码错误&#x27;&#125;&quot;</span>)</span><br><span class="line">print(f<span class="string">&quot;耗时: &#123;verify_time:.2f&#125; ms&quot;</span>)</span><br><span class="line"></span><br><span class="line">print(f<span class="string">&quot;\n💡 注意：即使密码错误，验证时间也差不多（&#123;verify_time:.2f&#125; ms）&quot;</span>)</span><br><span class="line">print(<span class="string">&quot;   这是防御措施：防止攻击者通过时间差判断密码对错&quot;</span>)</span><br><span class="line">PY</span><br></pre></td></tr></table></figure>

<h2 id="巩固练习（题与复盘）"><a href="#巩固练习（题与复盘）" class="headerlink" title="巩固练习（题与复盘）"></a>巩固练习（题与复盘）</h2><h3 id="题-1：为什么不能用明文或可逆加密存储密码？"><a href="#题-1：为什么不能用明文或可逆加密存储密码？" class="headerlink" title="题 1：为什么不能用明文或可逆加密存储密码？"></a>题 1：为什么不能用明文或可逆加密存储密码？</h3><p><strong>思路</strong>：你要把”数据库泄露”当成必然会发生的事故来设计。</p>
<ul>
<li><strong>明文存储</strong>：数据库一旦泄露，所有用户密码直接曝光</li>
<li><strong>可逆加密（如 AES）</strong>：只要密钥泄露或被拿到，密码仍然会被批量解密</li>
<li><strong>正确做法</strong>：用 KDF 哈希 + salt，让攻击者只能去猜（而且很慢）</li>
<li><strong>深层原因</strong>：密码是用户的<strong>认证凭据</strong>，不是需要还原的数据（不像身份证号需要解密展示）</li>
</ul>
<h3 id="题-2：设计一套密码存储策略（写到能落地）"><a href="#题-2：设计一套密码存储策略（写到能落地）" class="headerlink" title="题 2：设计一套密码存储策略（写到能落地）"></a>题 2：设计一套密码存储策略（写到能落地）</h3><p><strong>思路</strong>：写 6 个要素（照着这个框架填）：</p>
<ol>
<li><strong>算法选择</strong>：bcrypt（work_factor&#x3D;12）或 Argon2id（默认参数）</li>
<li><strong>salt 策略</strong>：每个用户独立随机 salt，由 KDF 自动生成并包含在输出中</li>
<li><strong>成本参数</strong>：bcrypt work_factor&#x3D;12（约 250ms），每 2 年评估是否需要增加</li>
<li><strong>存储字段</strong>：数据库表包含 <code>password_hash</code>（TEXT 类型，存储完整的 bcrypt 输出）</li>
<li><strong>验证流程</strong>：登录时调用 <code>bcrypt.checkpw(input_password, stored_hash)</code></li>
<li><strong>升级策略</strong>：用户下次登录成功时，检测 work_factor 是否过低，如果是则用新参数重新哈希并更新</li>
</ol>
<h3 id="题-3（新增）：什么情况下密钥需要紧急轮换？"><a href="#题-3（新增）：什么情况下密钥需要紧急轮换？" class="headerlink" title="题 3（新增）：什么情况下密钥需要紧急轮换？"></a>题 3（新增）：什么情况下密钥需要紧急轮换？</h3><p><strong>思路</strong>：列举触发条件 + 响应时间 + 操作步骤。</p>
<ul>
<li><strong>触发条件示例</strong>：<ol>
<li>员工离职（尤其是有权限访问密钥的员工）</li>
<li>服务器被入侵或疑似入侵</li>
<li>密钥出现在日志&#x2F;错误报告&#x2F;监控系统中</li>
<li>密钥被误提交到 git 仓库（即使已删除提交）</li>
<li>第三方供应商安全事件（如使用的云服务商被攻击）</li>
</ol>
</li>
<li><strong>响应时间</strong>：根据敏感度 1-24 小时内</li>
<li><strong>操作步骤</strong>：<ol>
<li>立即生成新密钥并标记为 active</li>
<li>停用旧密钥（但保留，不删除，用于审计）</li>
<li>通知所有相关系统更新密钥引用</li>
<li>审计旧密钥的历史访问记录</li>
<li>评估影响范围（哪些数据可能已被解密）</li>
<li>生成事件报告，总结教训</li>
</ol>
</li>
</ul>
<h3 id="题-4（新增）：对比-HMAC-和-数字签名的应用场景"><a href="#题-4（新增）：对比-HMAC-和-数字签名的应用场景" class="headerlink" title="题 4（新增）：对比 HMAC 和 数字签名的应用场景"></a>题 4（新增）：对比 HMAC 和 数字签名的应用场景</h3><p><strong>思路</strong>：从”信任模型”角度分析。</p>
<table>
<thead>
<tr>
<th>场景</th>
<th>应该用</th>
<th>原因</th>
</tr>
</thead>
<tbody><tr>
<td>微服务 A 调用微服务 B（内部系统）</td>
<td>HMAC</td>
<td>双方互信，共享密钥，性能高</td>
</tr>
<tr>
<td>用户浏览器 ← 服务器下发 JWT</td>
<td>可以用 HMAC（HS256）</td>
<td>如果只有服务器验证 JWT</td>
</tr>
<tr>
<td>用户浏览器 → 多个微服务都验证 JWT</td>
<td>数字签名（RS256）</td>
<td>避免把密钥分发给所有微服务，用公钥验证</td>
</tr>
<tr>
<td>APP 验证服务器响应完整性</td>
<td>数字签名</td>
<td>APP 只需内置公钥，无法伪造响应</td>
</tr>
<tr>
<td>代码签名（发布软件包）</td>
<td>数字签名</td>
<td>需要”不可否认性”，证明是谁签的</td>
</tr>
</tbody></table>
<h2 id="评估标准（达成判定）"><a href="#评估标准（达成判定）" class="headerlink" title="评估标准（达成判定）"></a>评估标准（达成判定）</h2><ul>
<li>✅ 你写出至少 5 条”密码存储&#x2F;密钥管理”风险点 + 对应改法</li>
<li>✅ 你能跑出 PBKDF2 示例并截图（对比 SHA-256 和 PBKDF2 的耗时）</li>
<li>✅ 你完成并保存”应用加密检查清单”</li>
<li>✅ 你能解释”为什么 bcrypt 单次验证 100ms 是特性不是缺陷”</li>
<li>✅ 你能说出至少 3 种密钥轮换的触发条件</li>
</ul>
<h2 id="学习成果达成情况（由学习者填写）"><a href="#学习成果达成情况（由学习者填写）" class="headerlink" title="学习成果达成情况（由学习者填写）"></a>学习成果达成情况（由学习者填写）</h2><h3 id="截图与证据"><a href="#截图与证据" class="headerlink" title="截图与证据"></a>截图与证据</h3><ul>
<li><input disabled="" type="checkbox"> 任务 2：PBKDF2 vs SHA-256 性能对比截图</li>
<li><input disabled="" type="checkbox"> 任务 4（可选）：bcrypt 演示输出截图</li>
</ul>
<h3 id="关键命令与输出"><a href="#关键命令与输出" class="headerlink" title="关键命令与输出"></a>关键命令与输出</h3><p><strong>PBKDF2 演示输出</strong>（粘贴关键行）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SHA-256:  ______... time=____ ms</span><br><span class="line">PBKDF2:   ______... time=____ ms</span><br><span class="line">性能对比：PBKDF2 比 SHA-256 慢 ____ 倍</span><br></pre></td></tr></table></figure>

<h3 id="应用加密检查清单（勾选你的项目符合的项）"><a href="#应用加密检查清单（勾选你的项目符合的项）" class="headerlink" title="应用加密检查清单（勾选你的项目符合的项）"></a>应用加密检查清单（勾选你的项目符合的项）</h3><h4 id="传输加密"><a href="#传输加密" class="headerlink" title="传输加密"></a>传输加密</h4><ul>
<li><input disabled="" type="checkbox"> 所有敏感接口 HTTPS</li>
<li><input disabled="" type="checkbox"> 证书有效且域名匹配</li>
<li><input disabled="" type="checkbox"> 禁止忽略证书错误</li>
<li><input disabled="" type="checkbox"> 所有外部资源 HTTPS</li>
<li><input disabled="" type="checkbox"> 配置 HSTS</li>
</ul>
<h4 id="密码存储"><a href="#密码存储" class="headerlink" title="密码存储"></a>密码存储</h4><ul>
<li><input disabled="" type="checkbox"> 使用 KDF（bcrypt&#x2F;Argon2）</li>
<li><input disabled="" type="checkbox"> 每用户独立 salt</li>
<li><input disabled="" type="checkbox"> 成本参数合理</li>
<li><input disabled="" type="checkbox"> 禁止可逆加密存密码</li>
<li><input disabled="" type="checkbox"> 登录失败限流</li>
</ul>
<h4 id="敏感数据加密"><a href="#敏感数据加密" class="headerlink" title="敏感数据加密"></a>敏感数据加密</h4><ul>
<li><input disabled="" type="checkbox"> 敏感字段加密（AES-GCM）</li>
<li><input disabled="" type="checkbox"> 密钥不进 git</li>
<li><input disabled="" type="checkbox"> 密钥与数据分离</li>
<li><input disabled="" type="checkbox"> 每次新 IV</li>
<li><input disabled="" type="checkbox"> 存储格式完整</li>
</ul>
<h4 id="密钥管理"><a href="#密钥管理" class="headerlink" title="密钥管理"></a>密钥管理</h4><ul>
<li><input disabled="" type="checkbox"> 密钥不硬编码</li>
<li><input disabled="" type="checkbox"> 有轮换策略</li>
<li><input disabled="" type="checkbox"> 有应急流程</li>
<li><input disabled="" type="checkbox"> 有备份</li>
<li><input disabled="" type="checkbox"> 最小权限</li>
</ul>
<h4 id="日志与审计"><a href="#日志与审计" class="headerlink" title="日志与审计"></a>日志与审计</h4><ul>
<li><input disabled="" type="checkbox"> 日志不打印敏感信息</li>
<li><input disabled="" type="checkbox"> 密钥访问有审计</li>
<li><input disabled="" type="checkbox"> 敏感操作有日志</li>
</ul>
<h3 id="结论与反思"><a href="#结论与反思" class="headerlink" title="结论与反思"></a>结论与反思</h3><p><strong>我今天搞清楚了</strong>：</p>
<ul>
<li>（例如：密码存储要用 KDF 而不是加密；密钥管理比算法选择更重要）</li>
</ul>
<p><strong>我差点搞混的是</strong>：</p>
<ul>
<li>（例如：以为”加密存密码”就安全了，其实密码不需要可逆）</li>
</ul>
<p><strong>明天我要继续补的是</strong>：</p>
<ul>
<li>（例如：密钥轮换的具体实施、配置中心 Vault 的使用）</li>
</ul>
<p><strong>本次学习耗时</strong>：约 ___ 小时</p>
<p><strong>掌握程度自评</strong>：</p>
<ul>
<li><input disabled="" type="checkbox"> 😕 看懂了但没动手</li>
<li><input disabled="" type="checkbox"> 🙂 跑通了基础任务</li>
<li><input disabled="" type="checkbox"> 😃 完成了所有任务并理解原理</li>
<li><input disabled="" type="checkbox"> 🤩 额外研究了 Argon2&#x2F;Vault&#x2F;HSM</li>
</ul>
<h2 id="集中参考答案（含思路）"><a href="#集中参考答案（含思路）" class="headerlink" title="集中参考答案（含思路）"></a>集中参考答案（含思路）</h2><h3 id="题-1-参考答案"><a href="#题-1-参考答案" class="headerlink" title="题 1 参考答案"></a>题 1 参考答案</h3><p><strong>为什么不能用明文或可逆加密存储密码？</strong></p>
<ol>
<li><p><strong>明文存密码</strong>：</p>
<ul>
<li>后果：数据库一旦泄露（SQL 注入&#x2F;备份泄露&#x2F;内部人员窃取），所有用户密码直接曝光</li>
<li>连锁反应：用户在多个网站复用密码，泄露后会被”撞库攻击”（攻击者拿泄露的密码去尝试登录其他网站）</li>
</ul>
</li>
<li><p><strong>可逆加密存密码</strong>（如 AES 加密）：</p>
<ul>
<li>问题：密钥一旦泄露&#x2F;被误配置&#x2F;被备份暴露，攻击者可以批量解密得到明文密码</li>
<li>现实场景：密钥和数据库常常在同一台机器&#x2F;同一份备份里，一起泄露</li>
<li>根本矛盾：密码是<strong>认证凭据</strong>，不是需要还原的数据（不像身份证号需要解密展示给用户）</li>
</ul>
</li>
<li><p><strong>正确方式</strong>：</p>
<ul>
<li>用 KDF（如 bcrypt&#x2F;scrypt&#x2F;Argon2&#x2F;PBKDF2）+ 每用户 salt + 合理成本参数</li>
<li>原理：让攻击者即使拿到数据库也只能进行高成本猜测（每个密码需要 100-300ms 验证）</li>
<li>效果：8 字符密码爆破时间从”几小时”（SHA-256）延长到”数百年”（bcrypt）</li>
</ul>
</li>
</ol>
<h3 id="题-2-参考答案（完整密码存储策略）"><a href="#题-2-参考答案（完整密码存储策略）" class="headerlink" title="题 2 参考答案（完整密码存储策略）"></a>题 2 参考答案（完整密码存储策略）</h3><h4 id="1-算法选择"><a href="#1-算法选择" class="headerlink" title="1. 算法选择"></a>1. 算法选择</h4><ul>
<li><strong>首选</strong>：bcrypt（work_factor&#x3D;12）</li>
<li><strong>备选</strong>：Argon2id（memory&#x3D;64MB, iterations&#x3D;3, parallelism&#x3D;4）</li>
<li><strong>理由</strong>：工业标准，库成熟，广泛审计</li>
</ul>
<h4 id="2-salt-策略"><a href="#2-salt-策略" class="headerlink" title="2. salt 策略"></a>2. salt 策略</h4><ul>
<li><strong>生成方式</strong>：由 KDF 自动生成随机 salt（bcrypt 为 16 字节随机数）</li>
<li><strong>存储方式</strong>：salt 包含在 password_hash 输出中（无需单独存储）</li>
<li><strong>重要性</strong>：防止彩虹表攻击，防止重复密码暴露</li>
</ul>
<h4 id="3-成本参数"><a href="#3-成本参数" class="headerlink" title="3. 成本参数"></a>3. 成本参数</h4><ul>
<li><strong>初始设定</strong>：bcrypt work_factor&#x3D;12（单次验证约 250ms）</li>
<li><strong>升级策略</strong>：每 2 年评估硬件性能，必要时增加到 13（验证时间翻倍）</li>
<li><strong>上限</strong>：单次验证不超过 500ms（避免影响用户体验）</li>
</ul>
<h4 id="4-存储字段"><a href="#4-存储字段" class="headerlink" title="4. 存储字段"></a>4. 存储字段</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">UNIQUE</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    password_hash TEXT <span class="keyword">NOT</span> <span class="keyword">NULL</span>,  <span class="comment">-- 存储完整的 bcrypt 输出（约 60 字符）</span></span><br><span class="line">    password_updated_at <span class="type">TIMESTAMP</span>,</span><br><span class="line">    created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="5-验证流程"><a href="#5-验证流程" class="headerlink" title="5. 验证流程"></a>5. 验证流程</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">username, input_password</span>):</span><br><span class="line">    <span class="comment"># 从数据库获取 stored_hash</span></span><br><span class="line">    user = db.query(<span class="string">&quot;SELECT password_hash FROM users WHERE username=?&quot;</span>, username)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>  <span class="comment"># 用户不存在</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 验证密码（bcrypt.checkpw 会自动提取 salt）</span></span><br><span class="line">    is_valid = bcrypt.checkpw(input_password.encode(), user.password_hash.encode())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> is_valid:</span><br><span class="line">        <span class="comment"># （可选）检查是否需要升级 work_factor</span></span><br><span class="line">        upgrade_password_hash_if_needed(user.<span class="built_in">id</span>, input_password, user.password_hash)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h4 id="6-迁移-x2F-升级策略"><a href="#6-迁移-x2F-升级策略" class="headerlink" title="6. 迁移&#x2F;升级策略"></a>6. 迁移&#x2F;升级策略</h4><ul>
<li><p><strong>场景 1</strong>：从旧系统迁移（如 MD5 存储）</p>
<ul>
<li>用户下次登录成功时，用 bcrypt 重新哈希并覆盖旧 hash</li>
<li>过渡期：同时验证 MD5 和 bcrypt（兼容未登录用户）</li>
</ul>
</li>
<li><p><strong>场景 2</strong>：提升 work_factor（如从 10 提到 12）</p>
<ul>
<li>用户下次登录成功时，检测 work_factor 是否过低</li>
<li>如果过低，用新参数重新哈希并更新 <code>password_hash</code> 和 <code>password_updated_at</code></li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">upgrade_password_hash_if_needed</span>(<span class="params">user_id, password, current_hash</span>):</span><br><span class="line">    <span class="comment"># 解析当前 hash 的 work_factor（bcrypt 格式：$2b$10$...）</span></span><br><span class="line">    current_work_factor = <span class="built_in">int</span>(current_hash.split(<span class="string">&#x27;$&#x27;</span>)[<span class="number">2</span>])</span><br><span class="line">    target_work_factor = <span class="number">12</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> current_work_factor &lt; target_work_factor:</span><br><span class="line">        <span class="comment"># 用新参数重新哈希</span></span><br><span class="line">        new_salt = bcrypt.gensalt(rounds=target_work_factor)</span><br><span class="line">        new_hash = bcrypt.hashpw(password.encode(), new_salt).decode()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 更新数据库</span></span><br><span class="line">        db.execute(</span><br><span class="line">            <span class="string">&quot;UPDATE users SET password_hash=?, password_updated_at=NOW() WHERE id=?&quot;</span>,</span><br><span class="line">            new_hash, user_id</span><br><span class="line">        )</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;✅ User <span class="subst">&#123;user_id&#125;</span> password hash upgraded to work_factor=<span class="subst">&#123;target_work_factor&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="题-3-参考答案（密钥紧急轮换）"><a href="#题-3-参考答案（密钥紧急轮换）" class="headerlink" title="题 3 参考答案（密钥紧急轮换）"></a>题 3 参考答案（密钥紧急轮换）</h3><h4 id="触发条件（按严重程度排序）"><a href="#触发条件（按严重程度排序）" class="headerlink" title="触发条件（按严重程度排序）"></a>触发条件（按严重程度排序）</h4><table>
<thead>
<tr>
<th>严重度</th>
<th>触发条件</th>
<th>响应时间</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>🔴 极高</td>
<td>密钥已确认泄露（出现在公开渠道）</td>
<td>1 小时内</td>
<td>密钥被提交到 GitHub 公开仓库</td>
</tr>
<tr>
<td>🟠 高</td>
<td>服务器被入侵或疑似入侵</td>
<td>2 小时内</td>
<td>检测到未授权访问密钥文件</td>
</tr>
<tr>
<td>🟡 中</td>
<td>有权限人员离职（尤其是管理员）</td>
<td>24 小时内</td>
<td>DBA 离职前可能备份了密钥</td>
</tr>
<tr>
<td>🟢 低</td>
<td>密钥超过轮换周期</td>
<td>1 周内</td>
<td>密钥已使用 2 年（按策略应轮换）</td>
</tr>
</tbody></table>
<h4 id="操作步骤（SOP）"><a href="#操作步骤（SOP）" class="headerlink" title="操作步骤（SOP）"></a>操作步骤（SOP）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">阶段 1：应急响应（0-1小时）</span><br><span class="line">  ├─ 01. 确认泄露范围（哪些密钥、何时泄露、谁可能看到）</span><br><span class="line">  ├─ 02. 立即生成新密钥 key_v2（在 KMS 中生成）</span><br><span class="line">  ├─ 03. 将旧密钥 key_v1 标记为 &quot;compromised&quot;（立即停用）</span><br><span class="line">  └─ 04. 通知所有相关团队（开发/运维/安全）</span><br><span class="line"></span><br><span class="line">阶段 2：系统更新（1-4小时）</span><br><span class="line">  ├─ 05. 更新所有服务配置（指向 key_v2）</span><br><span class="line">  ├─ 06. 滚动重启服务（避免全部中断）</span><br><span class="line">  ├─ 07. 验证服务可用性（监控错误率/成功率）</span><br><span class="line">  └─ 08. 确认旧密钥不再被使用（审计日志）</span><br><span class="line"></span><br><span class="line">阶段 3：审计与评估（4-24小时）</span><br><span class="line">  ├─ 09. 导出 key_v1 的历史访问记录</span><br><span class="line">  ├─ 10. 分析哪些数据可能已被解密（时间窗口分析）</span><br><span class="line">  ├─ 11. 评估业务影响（是否需要通知用户/监管机构）</span><br><span class="line">  └─ 12. 决定是否需要重加密历史数据</span><br><span class="line"></span><br><span class="line">阶段 4：善后与总结（1-7天）</span><br><span class="line">  ├─ 13. 生成事件报告（时间线/影响范围/应对措施）</span><br><span class="line">  ├─ 14. 改进措施（如加强权限控制/增加审计）</span><br><span class="line">  ├─ 15. 彻底删除 key_v1（在保留审计期后）</span><br><span class="line">  └─ 16. 团队复盘会议（总结教训/更新流程）</span><br></pre></td></tr></table></figure>

<h3 id="题-4-参考答案（HMAC-vs-数字签名）"><a href="#题-4-参考答案（HMAC-vs-数字签名）" class="headerlink" title="题 4 参考答案（HMAC vs 数字签名）"></a>题 4 参考答案（HMAC vs 数字签名）</h3><table>
<thead>
<tr>
<th>对比维度</th>
<th>HMAC</th>
<th>数字签名（RSA&#x2F;ECDSA）</th>
</tr>
</thead>
<tbody><tr>
<td><strong>信任模型</strong></td>
<td>双方互信（共享密钥）</td>
<td>单向信任（公钥可公开）</td>
</tr>
<tr>
<td><strong>典型场景</strong></td>
<td>微服务 A 调用微服务 B</td>
<td>APP 验证服务器响应</td>
</tr>
<tr>
<td><strong>不可否认性</strong></td>
<td>❌ 双方都能生成，无法证明是谁</td>
<td>✅ 只有私钥持有者能生成</td>
</tr>
<tr>
<td><strong>密钥分发</strong></td>
<td>困难（需要安全通道）</td>
<td>简单（公钥可公开）</td>
</tr>
<tr>
<td><strong>性能</strong></td>
<td>快（几微秒）</td>
<td>慢（几毫秒）</td>
</tr>
<tr>
<td><strong>适用场景</strong></td>
<td>内部系统、对称信任</td>
<td>公开系统、需要身份证明</td>
</tr>
</tbody></table>
<p><strong>选型决策树</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">需要签名的场景</span><br><span class="line">  │</span><br><span class="line">  ├─ 双方是否互信？</span><br><span class="line">  │   ├─ 是（如微服务内部调用）</span><br><span class="line">  │   │   └─ 用 HMAC（性能高，实现简单）</span><br><span class="line">  │   └─ 否（如用户 APP ← 服务器）</span><br><span class="line">  │       └─ 用数字签名（公钥可公开分发）</span><br><span class="line">  │</span><br><span class="line">  ├─ 是否需要&quot;不可否认性&quot;？</span><br><span class="line">  │   ├─ 是（如合同签署、代码发布）</span><br><span class="line">  │   │   └─ 必须用数字签名（HMAC 双方都能生成，无法证明）</span><br><span class="line">  │   └─ 否（只要防篡改即可）</span><br><span class="line">  │       └─ HMAC 即可</span><br><span class="line">  │</span><br><span class="line">  └─ 是否需要多方验证？</span><br><span class="line">      ├─ 是（如 JWT 被多个微服务验证）</span><br><span class="line">      │   └─ 用 RS256（公钥分发简单）</span><br><span class="line">      └─ 否（只有一个服务验证）</span><br><span class="line">          └─ HS256 或 RS256 都可以</span><br></pre></td></tr></table></figure>

<p><strong>真实案例对比</strong>：</p>
<ol>
<li><p><strong>AWS API 签名</strong>（用 HMAC）</p>
<ul>
<li>场景：客户端调用 AWS API</li>
<li>原因：客户端和 AWS 都持有 Access Key Secret，双方互信</li>
<li>优势：性能高，无需证书管理</li>
</ul>
</li>
<li><p><strong>Apple APNs 推送</strong>（用数字签名）</p>
<ul>
<li>场景：服务器 → Apple 推送服务 → 用户设备</li>
<li>原因：需要证明推送来自特定 APP（不可否认性）</li>
<li>优势：Apple 可以验证推送来源，防止伪造</li>
</ul>
</li>
<li><p><strong>JWT in 微服务架构</strong></p>
<ul>
<li>单体应用：用 HS256（只有一个服务验证，共享密钥）</li>
<li>微服务：用 RS256（多个服务验证，分发公钥更安全）</li>
</ul>
</li>
</ol>
<h2 id="学习成果示例填写（可照抄）"><a href="#学习成果示例填写（可照抄）" class="headerlink" title="学习成果示例填写（可照抄）"></a>学习成果示例填写（可照抄）</h2><h3 id="截图与证据（示例）"><a href="#截图与证据（示例）" class="headerlink" title="截图与证据（示例）"></a>截图与证据（示例）</h3><ul>
<li><code>images/day013_pbkdf2_vs_sha256.png</code>：性能对比输出（PBKDF2 慢 5000 倍）</li>
<li><code>images/day013_bcrypt_demo.png</code>：bcrypt 注册&#x2F;登录流程输出</li>
</ul>
<h3 id="关键命令与输出（示例）"><a href="#关键命令与输出（示例）" class="headerlink" title="关键命令与输出（示例）"></a>关键命令与输出（示例）</h3><p><strong>PBKDF2 vs SHA-256 性能对比</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SHA-256:  8e35c2cd3bf6641bdb0e2050... time=0.0234 ms</span><br><span class="line">PBKDF2:   c5a0f8e7d4b3c2a1f9e8d7c6... time=123.4567 ms</span><br><span class="line"></span><br><span class="line">性能对比：PBKDF2 比 SHA-256 慢 5279 倍</span><br><span class="line">✅ 这就是 KDF 的目的：让攻击者爆破成本指数级上升</span><br></pre></td></tr></table></figure>

<p><strong>bcrypt 演示输出</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">=== 注册流程 ===</span><br><span class="line">密码哈希: $2b$12$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p/.CPY.tHOHEa2xFH0p3.O</span><br><span class="line">耗时: 267.89 ms</span><br><span class="line">解析: $2b (算法) / $12 (work_factor) / 22字符salt / 31字符hash</span><br><span class="line"></span><br><span class="line">=== 登录流程（正确密码）===</span><br><span class="line">验证结果: ✅ 密码正确</span><br><span class="line">耗时: 271.23 ms</span><br><span class="line"></span><br><span class="line">=== 登录流程（错误密码）===</span><br><span class="line">验证结果: ❌ 密码错误</span><br><span class="line">耗时: 268.45 ms</span><br><span class="line"></span><br><span class="line">💡 注意：即使密码错误，验证时间也差不多（268.45 ms）</span><br><span class="line">   这是防御措施：防止攻击者通过时间差判断密码对错</span><br></pre></td></tr></table></figure>

<h3 id="结论与反思（示例）"><a href="#结论与反思（示例）" class="headerlink" title="结论与反思（示例）"></a>结论与反思（示例）</h3><p><strong>我今天搞清楚了</strong>：</p>
<ul>
<li>密码存储不是”加密存”，而是”慢哈希(KDF)+salt+参数”</li>
<li>KDF 的”慢”不是缺点，是用来抗爆破的特性（单次 100-300ms 对用户无感，对攻击者致命）</li>
<li>密钥管理比算法选择更重要：再强的加密，密钥硬编码也白搭</li>
<li>HMAC 适合双方互信，数字签名适合需要”不可否认性”的场景</li>
</ul>
<p><strong>我差点搞混的是</strong>：</p>
<ul>
<li>以为”AES 加密存密码”就安全了，其实密码不需要可逆（认证凭据 vs 敏感数据）</li>
<li>以为 IV 要保密，其实 IV 可以公开但不能重复</li>
<li>以为 HMAC 和数字签名一样，其实 HMAC 双方都能生成（无不可否认性）</li>
</ul>
<p><strong>明天我要继续补的是</strong>：</p>
<ul>
<li>密钥轮换的具体实施（配置中心 Vault 的使用）</li>
<li>证书链验证流程（如何从根 CA 到网站证书一层层验证）</li>
<li>实际抓包看 TLS 握手过程（ClientHello&#x2F;ServerHello&#x2F;Certificate）</li>
</ul>
<p><strong>本次学习耗时</strong>：约 3 小时</p>
<p><strong>掌握程度自评</strong>：</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 😃 完成了所有任务并理解原理</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.jpg" alt="Tigercoll 微信">
        <span>微信</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag"># 网络</a>
              <a href="/tags/%E5%AE%89%E5%85%A8/" rel="tag"># 安全</a>
              <a href="/tags/%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/" rel="tag"># 学习计划</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/47beb889.html" rel="prev" title="Day012：安全协议与加密 - 加密基础：哈希/对称/非对称">
                  <i class="fa fa-chevron-left"></i> Day012：安全协议与加密 - 加密基础：哈希/对称/非对称
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/b2632e05.html" rel="next" title="Day014：安全协议与加密 - 第 2 周综合实验与测评">
                  Day014：安全协议与加密 - 第 2 周综合实验与测评 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="lv-container" data-id="city" data-uid="MTAyMC8zNDY4NC8xMTIyMQ=="></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2026</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tigercoll</span>
</div>
<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("04/21/2019 15:54:40");//此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "等待与你相遇的 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>
<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>
-->

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  




<script src="/js/third-party/comments/livere.js"></script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true,"react":{"opacity":0.7}}});</script></body>
</html>
