<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" integrity="sha256-jTIdiMuX/e3DGJUGwl3pKSxuc6YOuqtJYkM0bGQESA4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-center-simple.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"tigercoll.top","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.10.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Day004：网络与协议基础 - TCP&#x2F;UDP 与会话 日期：2025-12-28 周次：第 1 周  学习目标 掌握 TCP 三次握手与四次挥手 理解 UDP 的无连接特性与适用场景">
<meta property="og:type" content="article">
<meta property="og:title" content="Day004：网络与协议基础 - TCP&#x2F;UDP 与会话">
<meta property="og:url" content="https://tigercoll.top/post/ccce0add.html">
<meta property="og:site_name" content="Tigercoll&#39;s Blog">
<meta property="og:description" content="Day004：网络与协议基础 - TCP&#x2F;UDP 与会话 日期：2025-12-28 周次：第 1 周  学习目标 掌握 TCP 三次握手与四次挥手 理解 UDP 的无连接特性与适用场景">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-12-27T16:00:00.000Z">
<meta property="article:modified_time" content="2025-12-27T16:00:00.000Z">
<meta property="article:author" content="Tigercoll">
<meta property="article:tag" content="网络">
<meta property="article:tag" content="安全">
<meta property="article:tag" content="学习计划">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://tigercoll.top/post/ccce0add.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://tigercoll.top/post/ccce0add.html","path":"post/ccce0add.html","title":"Day004：网络与协议基础 - TCP/UDP 与会话"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Day004：网络与协议基础 - TCP/UDP 与会话 | Tigercoll's Blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Tigercoll's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>
	
      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Day004%EF%BC%9A%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%8D%8F%E8%AE%AE%E5%9F%BA%E7%A1%80-TCP-x2F-UDP-%E4%B8%8E%E4%BC%9A%E8%AF%9D"><span class="nav-number">1.</span> <span class="nav-text">Day004：网络与协议基础 - TCP&#x2F;UDP 与会话</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87"><span class="nav-number">1.1.</span> <span class="nav-text">学习目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E5%86%85%E5%AE%B9"><span class="nav-number">1.2.</span> <span class="nav-text">学习内容</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%B8%8F%E2%83%A3-TCP-%E5%8D%8F%E8%AE%AE%E6%A6%82%E8%BF%B0"><span class="nav-number">1.2.1.</span> <span class="nav-text">1️⃣ TCP 协议概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%B8%8F%E2%83%A3-TCP-%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%EF%BC%88%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5%EF%BC%89"><span class="nav-number">1.2.2.</span> <span class="nav-text">2️⃣ TCP 三次握手（建立连接）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%EF%B8%8F%E2%83%A3-TCP-%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%EF%BC%88%E5%85%B3%E9%97%AD%E8%BF%9E%E6%8E%A5%EF%BC%89"><span class="nav-number">1.2.3.</span> <span class="nav-text">3️⃣ TCP 四次挥手（关闭连接）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%EF%B8%8F%E2%83%A3-TCP-%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2%E5%9B%BE"><span class="nav-number">1.2.4.</span> <span class="nav-text">4️⃣ TCP 状态转换图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%EF%B8%8F%E2%83%A3-%E4%BA%94%E5%85%83%E7%BB%84%EF%BC%88%E4%BC%9A%E8%AF%9D%E6%A0%87%E8%AF%86%EF%BC%89"><span class="nav-number">1.2.5.</span> <span class="nav-text">5️⃣ 五元组（会话标识）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6%EF%B8%8F%E2%83%A3-UDP-%E5%8D%8F%E8%AE%AE%E5%AF%B9%E6%AF%94"><span class="nav-number">1.2.6.</span> <span class="nav-text">6️⃣ UDP 协议对比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7%EF%B8%8F%E2%83%A3-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E4%B8%8E%E5%BC%82%E5%B8%B8"><span class="nav-number">1.2.7.</span> <span class="nav-text">7️⃣ 常见问题与异常</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E8%B7%B5%E4%BB%BB%E5%8A%A1%EF%BC%88%E5%90%88%E6%B3%95%E6%8E%88%E6%9D%83%E8%8C%83%E5%9B%B4%E5%86%85%EF%BC%89"><span class="nav-number">1.3.</span> <span class="nav-text">实践任务（合法授权范围内）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%8E%AF-%E4%BB%BB%E5%8A%A1-1-%E4%BD%BF%E7%94%A8-Wireshark-%E8%A7%82%E5%AF%9F-TCP-%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E4%B8%8E%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B"><span class="nav-number">1.3.1.</span> <span class="nav-text">🎯 任务 1: 使用 Wireshark 观察 TCP 三次握手与四次挥手</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%8E%AF-%E4%BB%BB%E5%8A%A1-2-%E6%9F%A5%E7%9C%8B%E6%9C%AC%E6%9C%BA-TCP-%E8%BF%9E%E6%8E%A5%E7%8A%B6%E6%80%81"><span class="nav-number">1.3.2.</span> <span class="nav-text">🎯 任务 2: 查看本机 TCP 连接状态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%8E%AF-%E4%BB%BB%E5%8A%A1-3-%E6%9E%84%E9%80%A0-UDP-%E6%B5%81%E9%87%8F%E5%B9%B6%E5%AF%B9%E6%AF%94-TCP"><span class="nav-number">1.3.3.</span> <span class="nav-text">🎯 任务 3: 构造 UDP 流量并对比 TCP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%8E%AF-%E4%BB%BB%E5%8A%A1-4-%E4%BD%BF%E7%94%A8-telnet-%E6%89%8B%E5%8A%A8%E6%A8%A1%E6%8B%9F-TCP-%E8%BF%9E%E6%8E%A5"><span class="nav-number">1.3.4.</span> <span class="nav-text">🎯 任务 4: 使用 telnet 手动模拟 TCP 连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%8E%AF-%E4%BB%BB%E5%8A%A1-5-%E5%88%86%E6%9E%90%E7%9C%9F%E5%AE%9E%E5%9C%BA%E6%99%AF%E7%9A%84-TCP-%E4%BC%9A%E8%AF%9D"><span class="nav-number">1.3.5.</span> <span class="nav-text">🎯 任务 5: 分析真实场景的 TCP 会话</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%8A-%E5%AE%9E%E8%B7%B5%E4%BB%BB%E5%8A%A1%E6%80%BB%E7%BB%93%E6%A3%80%E6%9F%A5%E6%B8%85%E5%8D%95"><span class="nav-number">1.3.6.</span> <span class="nav-text">📊 实践任务总结检查清单</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B7%A9%E5%9B%BA%E7%BB%83%E4%B9%A0%EF%BC%88%E9%A2%98%E4%B8%8E%E5%A4%8D%E7%9B%98%EF%BC%89"><span class="nav-number">1.4.</span> <span class="nav-text">巩固练习（题与复盘）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%9D-%E7%BB%83%E4%B9%A0-1-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%9C%89%E4%BA%9B%E5%BA%94%E7%94%A8%E6%9B%B4%E9%80%82%E5%90%88-UDP%EF%BC%9F%E4%B8%BE%E4%BE%8B%E8%AF%B4%E6%98%8E"><span class="nav-number">1.4.1.</span> <span class="nav-text">📝 练习 1: 为什么有些应用更适合 UDP？举例说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%9D-%E7%BB%83%E4%B9%A0-2-%E4%BB%8E%E6%8A%93%E5%8C%85%E4%B8%AD%E6%8F%90%E5%8F%96%E4%B8%80%E4%B8%AA-TCP-%E4%BC%9A%E8%AF%9D%E7%9A%84%E4%BA%94%E5%85%83%E7%BB%84"><span class="nav-number">1.4.2.</span> <span class="nav-text">📝 练习 2: 从抓包中提取一个 TCP 会话的五元组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%9D-%E7%BB%83%E4%B9%A0-3-%E5%88%86%E6%9E%90%E5%BC%82%E5%B8%B8-TCP-%E8%BF%9E%E6%8E%A5%E7%8A%B6%E6%80%81"><span class="nav-number">1.4.3.</span> <span class="nav-text">📝 练习 3: 分析异常 TCP 连接状态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%9D-%E7%BB%83%E4%B9%A0-4-%E7%90%86%E8%A7%A3-TCP-%E5%BA%8F%E5%88%97%E5%8F%B7"><span class="nav-number">1.4.4.</span> <span class="nav-text">📝 练习 4: 理解 TCP 序列号</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%84%E4%BC%B0%E6%A0%87%E5%87%86%EF%BC%88%E8%BE%BE%E6%88%90%E5%88%A4%E5%AE%9A%EF%BC%89"><span class="nav-number">1.5.</span> <span class="nav-text">评估标准（达成判定）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%BE%BE%E6%88%90%E6%83%85%E5%86%B5"><span class="nav-number">1.6.</span> <span class="nav-text">学习成果达成情况</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%8A-%E5%AE%9E%E8%B7%B5%E4%BB%BB%E5%8A%A1%E5%AE%8C%E6%88%90%E8%AE%B0%E5%BD%95"><span class="nav-number">1.6.1.</span> <span class="nav-text">📊 实践任务完成记录</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1-1-%E6%9F%A5%E7%9C%8B%E6%9C%AC%E6%9C%BA-TCP-%E8%BF%9E%E6%8E%A5%E7%8A%B6%E6%80%81-%E2%9C%85"><span class="nav-number">1.6.1.1.</span> <span class="nav-text">任务 1: 查看本机 TCP 连接状态 ✅</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1-2-%E4%BD%BF%E7%94%A8-Wireshark-%E8%A7%82%E5%AF%9F-TCP-%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B-%E5%BE%85%E5%AE%8C%E6%88%90"><span class="nav-number">1.6.1.2.</span> <span class="nav-text">任务 2: 使用 Wireshark 观察 TCP 三次握手 (待完成)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1-3-%E4%BD%BF%E7%94%A8-Wireshark-%E8%A7%82%E5%AF%9F-TCP-%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B-%E5%BE%85%E5%AE%8C%E6%88%90"><span class="nav-number">1.6.1.3.</span> <span class="nav-text">任务 3: 使用 Wireshark 观察 TCP 四次挥手 (待完成)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%BB%E5%8A%A1-4-UDP-%E6%B5%81%E9%87%8F%E5%AF%B9%E6%AF%94-%E5%BE%85%E5%AE%8C%E6%88%90"><span class="nav-number">1.6.1.4.</span> <span class="nav-text">任务 4: UDP 流量对比 (待完成)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%92%A1-%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E7%82%B9%E6%8E%8C%E6%8F%A1"><span class="nav-number">1.6.2.</span> <span class="nav-text">💡 核心知识点掌握</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-TCP-%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B-%E2%9C%85"><span class="nav-number">1.6.2.1.</span> <span class="nav-text">1. TCP 三次握手 ✅</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-TCP-%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B-%E2%9C%85"><span class="nav-number">1.6.2.2.</span> <span class="nav-text">2. TCP 四次挥手 ✅</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-TIME-WAIT-%E7%8A%B6%E6%80%81%E7%9A%84%E6%84%8F%E4%B9%89-%E2%9C%85"><span class="nav-number">1.6.2.3.</span> <span class="nav-text">3. TIME_WAIT 状态的意义 ✅</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-TCP-vs-UDP-%E7%9A%84%E9%80%89%E6%8B%A9-%E2%9C%85"><span class="nav-number">1.6.2.4.</span> <span class="nav-text">4. TCP vs UDP 的选择 ✅</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E4%BA%94%E5%85%83%E7%BB%84%E7%9A%84%E4%BD%9C%E7%94%A8-%E2%9C%85"><span class="nav-number">1.6.2.5.</span> <span class="nav-text">5. 五元组的作用 ✅</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%94%8D-%E5%AE%9E%E8%B7%B5%E6%94%B6%E8%8E%B7%E4%B8%8E%E5%8F%8D%E6%80%9D"><span class="nav-number">1.6.3.</span> <span class="nav-text">🔍 实践收获与反思</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%93%96-%E4%B8%8E%E5%89%8D%E5%87%A0%E5%A4%A9%E5%AD%A6%E4%B9%A0%E7%9A%84%E8%81%94%E7%B3%BB"><span class="nav-number">1.6.4.</span> <span class="nav-text">📖 与前几天学习的联系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%8E%93-%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C%E8%AF%84%E4%BC%B0"><span class="nav-number">1.6.5.</span> <span class="nav-text">🎓 学习成果评估</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Tigercoll"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Tigercoll</p>
  <div class="site-description" itemprop="description">万丈高楼平地起,勿在浮沙筑高台</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives">
          <span class="site-state-item-count">82</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories">
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags">
        <span class="site-state-item-count">75</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Tigercoll" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Tigercoll" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/Tigercoll" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tigercoll.top/post/ccce0add.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Tigercoll">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tigercoll's Blog">
      <meta itemprop="description" content="万丈高楼平地起,勿在浮沙筑高台">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Day004：网络与协议基础 - TCP/UDP 与会话 | Tigercoll's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Day004：网络与协议基础 - TCP/UDP 与会话
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-28 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-28T00:00:00+08:00">2025-12-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络安全</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="Day004：网络与协议基础-TCP-x2F-UDP-与会话"><a href="#Day004：网络与协议基础-TCP-x2F-UDP-与会话" class="headerlink" title="Day004：网络与协议基础 - TCP&#x2F;UDP 与会话"></a>Day004：网络与协议基础 - TCP&#x2F;UDP 与会话</h1><ul>
<li>日期：2025-12-28</li>
<li>周次：第 1 周</li>
</ul>
<h2 id="学习目标"><a href="#学习目标" class="headerlink" title="学习目标"></a>学习目标</h2><ul>
<li>掌握 TCP 三次握手与四次挥手</li>
<li>理解 UDP 的无连接特性与适用场景</li>
</ul>
<span id="more"></span>

<h2 id="学习内容"><a href="#学习内容" class="headerlink" title="学习内容"></a>学习内容</h2><h3 id="1️⃣-TCP-协议概述"><a href="#1️⃣-TCP-协议概述" class="headerlink" title="1️⃣ TCP 协议概述"></a>1️⃣ TCP 协议概述</h3><p><strong>TCP（Transmission Control Protocol，传输控制协议）</strong></p>
<p><strong>核心特点：</strong></p>
<ul>
<li>✅ <strong>面向连接</strong>：通信前必须建立连接</li>
<li>✅ <strong>可靠传输</strong>：确保数据正确、完整、按序到达</li>
<li>✅ <strong>流量控制</strong>：防止发送方发送过快</li>
<li>✅ <strong>拥塞控制</strong>：根据网络状况调整发送速率</li>
<li>✅ <strong>全双工通信</strong>：双向同时传输数据</li>
</ul>
<p><strong>TCP 报文段结构：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> 0                   1                   2                   3</span><br><span class="line"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|          源端口 (16位)         |        目标端口 (16位)        |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                      序列号 (32位)                            |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                    确认号 (32位)                              |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|首部长|保留|U|A|P|R|S|F|                                       |</span><br><span class="line">|度(4位)|(6位)|R|C|S|S|Y|I|         窗口大小 (16位)             |</span><br><span class="line">|      |     |G|K|H|T|N|N|                                       |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|          校验和 (16位)         |       紧急指针 (16位)         |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                       选项（可变长度）                         |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                          数据                                 |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></pre></td></tr></table></figure>

<p><strong>重要字段说明：</strong></p>
<table>
<thead>
<tr>
<th>字段</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><strong>源端口</strong></td>
<td>发送方端口号</td>
<td>54321</td>
</tr>
<tr>
<td><strong>目标端口</strong></td>
<td>接收方端口号</td>
<td>80 (HTTP)</td>
</tr>
<tr>
<td><strong>序列号 (Seq)</strong></td>
<td>本次发送数据的第一个字节的序号</td>
<td>1000</td>
</tr>
<tr>
<td><strong>确认号 (Ack)</strong></td>
<td>期望接收的下一个字节的序号</td>
<td>2000</td>
</tr>
<tr>
<td><strong>控制位</strong></td>
<td>6 个标志位，控制 TCP 连接状态</td>
<td>SYN, ACK, FIN 等</td>
</tr>
<tr>
<td><strong>窗口大小</strong></td>
<td>接收窗口大小，用于流量控制</td>
<td>65535 字节</td>
</tr>
</tbody></table>
<p><strong>TCP 控制标志位（Flags）：</strong></p>
<table>
<thead>
<tr>
<th>标志位</th>
<th>全称</th>
<th>作用</th>
<th>值为 1 时的含义</th>
</tr>
</thead>
<tbody><tr>
<td><strong>URG</strong></td>
<td>Urgent</td>
<td>紧急指针有效</td>
<td>紧急数据</td>
</tr>
<tr>
<td><strong>ACK</strong></td>
<td>Acknowledgment</td>
<td>确认号有效</td>
<td>确认接收</td>
</tr>
<tr>
<td><strong>PSH</strong></td>
<td>Push</td>
<td>立即推送数据</td>
<td>不缓冲，立即传递给应用层</td>
</tr>
<tr>
<td><strong>RST</strong></td>
<td>Reset</td>
<td>重置连接</td>
<td>异常关闭连接</td>
</tr>
<tr>
<td><strong>SYN</strong></td>
<td>Synchronize</td>
<td>同步序列号</td>
<td>建立连接</td>
</tr>
<tr>
<td><strong>FIN</strong></td>
<td>Finish</td>
<td>结束发送</td>
<td>关闭连接</td>
</tr>
</tbody></table>
<hr>
<h3 id="2️⃣-TCP-三次握手（建立连接）"><a href="#2️⃣-TCP-三次握手（建立连接）" class="headerlink" title="2️⃣ TCP 三次握手（建立连接）"></a>2️⃣ TCP 三次握手（建立连接）</h3><p><strong>目的：</strong> 建立可靠的双向通信通道</p>
<p><strong>为什么需要三次握手？</strong></p>
<ol>
<li>确认双方都具备发送和接收能力</li>
<li>协商初始序列号（ISN，Initial Sequence Number）</li>
<li>协商 TCP 参数（窗口大小、MSS 等）</li>
</ol>
<p><strong>三次握手流程图：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">客户端 (Client)                              服务器 (Server)</span><br><span class="line">    │                                             │</span><br><span class="line">    │         ① SYN (Seq=100)                     │</span><br><span class="line">    │ ─────────────────────────────────────────&gt; │</span><br><span class="line">    │                                             │</span><br><span class="line">    │    客户端状态: CLOSED → SYN_SENT            │  服务器状态: LISTEN</span><br><span class="line">    │                                             │</span><br><span class="line">    │                                             │</span><br><span class="line">    │      ② SYN-ACK (Seq=200, Ack=101)           │</span><br><span class="line">    │ &lt;───────────────────────────────────────── │</span><br><span class="line">    │                                             │</span><br><span class="line">    │                                             │  服务器状态: LISTEN → SYN_RCVD</span><br><span class="line">    │                                             │</span><br><span class="line">    │         ③ ACK (Seq=101, Ack=201)            │</span><br><span class="line">    │ ─────────────────────────────────────────&gt; │</span><br><span class="line">    │                                             │</span><br><span class="line">    │    客户端状态: SYN_SENT → ESTABLISHED       │  服务器状态: SYN_RCVD → ESTABLISHED</span><br><span class="line">    │                                             │</span><br><span class="line">    │ ◀═══════════ 连接建立，开始传输数据 ═══════▶ │</span><br><span class="line">    │                                             │</span><br></pre></td></tr></table></figure>

<p><strong>详细步骤解析：</strong></p>
<p><strong>第一次握手（客户端 → 服务器）：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">┌────────────────────────────────────┐</span><br><span class="line">│ TCP 报文内容：                     │</span><br><span class="line">├────────────────────────────────────┤</span><br><span class="line">│ SYN = 1                            │ ← 请求建立连接</span><br><span class="line">│ ACK = 0                            │ ← 没有确认号</span><br><span class="line">│ Seq = 100 (ISN_Client)             │ ← 客户端初始序列号</span><br><span class="line">│ Ack = 0                            │ ← 无意义</span><br><span class="line">├────────────────────────────────────┤</span><br><span class="line">│ 含义：&quot;服务器，我想和你建立连接&quot;  │</span><br><span class="line">│       &quot;我的初始序列号是 100&quot;      │</span><br><span class="line">└────────────────────────────────────┘</span><br><span class="line"></span><br><span class="line">客户端状态变化：CLOSED → SYN_SENT</span><br></pre></td></tr></table></figure>

<p><strong>第二次握手（服务器 → 客户端）：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">┌────────────────────────────────────┐</span><br><span class="line">│ TCP 报文内容：                     │</span><br><span class="line">├────────────────────────────────────┤</span><br><span class="line">│ SYN = 1                            │ ← 服务器也请求建立连接</span><br><span class="line">│ ACK = 1                            │ ← 确认收到客户端的 SYN</span><br><span class="line">│ Seq = 200 (ISN_Server)             │ ← 服务器初始序列号</span><br><span class="line">│ Ack = 101 (Client_Seq + 1)         │ ← 确认号：期望收到 101</span><br><span class="line">├────────────────────────────────────┤</span><br><span class="line">│ 含义：&quot;我收到你的请求了(ACK)&quot;     │</span><br><span class="line">│       &quot;我也想和你建立连接(SYN)&quot;   │</span><br><span class="line">│       &quot;我的初始序列号是 200&quot;      │</span><br><span class="line">│       &quot;我期望你下次发送 Seq=101&quot;  │</span><br><span class="line">└────────────────────────────────────┘</span><br><span class="line"></span><br><span class="line">服务器状态变化：LISTEN → SYN_RCVD</span><br></pre></td></tr></table></figure>

<p><strong>第三次握手（客户端 → 服务器）：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">┌────────────────────────────────────┐</span><br><span class="line">│ TCP 报文内容：                     │</span><br><span class="line">├────────────────────────────────────┤</span><br><span class="line">│ SYN = 0                            │ ← 连接建立阶段结束</span><br><span class="line">│ ACK = 1                            │ ← 确认收到服务器的 SYN-ACK</span><br><span class="line">│ Seq = 101                          │ ← 按服务器的期望发送</span><br><span class="line">│ Ack = 201 (Server_Seq + 1)         │ ← 确认号：期望收到 201</span><br><span class="line">├────────────────────────────────────┤</span><br><span class="line">│ 含义：&quot;我收到你的确认了(ACK)&quot;     │</span><br><span class="line">│       &quot;连接建立完成&quot;              │</span><br><span class="line">│       &quot;可以开始传输数据了&quot;        │</span><br><span class="line">└────────────────────────────────────┘</span><br><span class="line"></span><br><span class="line">客户端状态变化：SYN_SENT → ESTABLISHED</span><br><span class="line">服务器状态变化：SYN_RCVD → ESTABLISHED</span><br><span class="line"></span><br><span class="line">✅ 连接建立成功！双方进入 ESTABLISHED 状态</span><br></pre></td></tr></table></figure>

<p><strong>为什么不能是两次握手？</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">两次握手的问题：</span><br><span class="line"></span><br><span class="line">场景：网络延迟导致的重复连接请求</span><br><span class="line">┌─────────────────────────────────────────────────────┐</span><br><span class="line">│ 1. 客户端发送 SYN (请求1)                            │</span><br><span class="line">│    ↓ 网络延迟，包很久才到达                          │</span><br><span class="line">│                                                      │</span><br><span class="line">│ 2. 客户端超时，重新发送 SYN (请求2)                  │</span><br><span class="line">│    ↓ 这个包很快到达                                  │</span><br><span class="line">│                                                      │</span><br><span class="line">│ 3. 服务器收到请求2，回复 SYN-ACK                     │</span><br><span class="line">│    连接建立 ✅                                       │</span><br><span class="line">│                                                      │</span><br><span class="line">│ 4. 双方通信完成，连接关闭                            │</span><br><span class="line">│                                                      │</span><br><span class="line">│ 5. ⚠️ 延迟的请求1终于到达服务器                       │</span><br><span class="line">│    如果是两次握手：服务器直接建立连接 ❌              │</span><br><span class="line">│    服务器会一直等待客户端发数据                       │</span><br><span class="line">│    但客户端认为连接已关闭，不会发送数据               │</span><br><span class="line">│    → 造成服务器资源浪费                             │</span><br><span class="line">│                                                      │</span><br><span class="line">│ 三次握手的优势：                                     │</span><br><span class="line">│    服务器发送 SYN-ACK 后，必须等待客户端确认         │</span><br><span class="line">│    客户端不会对延迟的旧连接请求回复确认               │</span><br><span class="line">│    → 服务器不会建立无效连接 ✅                       │</span><br><span class="line">└─────────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="3️⃣-TCP-四次挥手（关闭连接）"><a href="#3️⃣-TCP-四次挥手（关闭连接）" class="headerlink" title="3️⃣ TCP 四次挥手（关闭连接）"></a>3️⃣ TCP 四次挥手（关闭连接）</h3><p><strong>目的：</strong> 安全、可靠地关闭双向通信</p>
<p><strong>为什么需要四次挥手？</strong></p>
<ul>
<li>TCP 是全双工通信（双向独立）</li>
<li>每个方向都需要单独关闭</li>
<li>确保双方数据都发送完毕</li>
</ul>
<p><strong>四次挥手流程图：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">客户端 (Client)                              服务器 (Server)</span><br><span class="line">    │                                             │</span><br><span class="line">    │  ◀════════ 数据传输阶段 (ESTABLISHED) ════▶ │</span><br><span class="line">    │                                             │</span><br><span class="line">    │                                             │</span><br><span class="line">    │         ① FIN (Seq=300)                     │</span><br><span class="line">    │ ─────────────────────────────────────────&gt; │</span><br><span class="line">    │                                             │</span><br><span class="line">    │   客户端状态: ESTABLISHED → FIN_WAIT_1       │</span><br><span class="line">    │   含义：&quot;我没有数据要发送了&quot;                │</span><br><span class="line">    │                                             │</span><br><span class="line">    │                                             │</span><br><span class="line">    │         ② ACK (Ack=301)                     │</span><br><span class="line">    │ &lt;───────────────────────────────────────── │</span><br><span class="line">    │                                             │</span><br><span class="line">    │   客户端状态: FIN_WAIT_1 → FIN_WAIT_2        │  服务器状态: ESTABLISHED → CLOSE_WAIT</span><br><span class="line">    │   含义：&quot;我知道你要关闭了&quot;                  │  (服务器可能还有数据要发送)</span><br><span class="line">    │                                             │</span><br><span class="line">    │                                             │</span><br><span class="line">    │         ③ FIN (Seq=400)                     │</span><br><span class="line">    │ &lt;───────────────────────────────────────── │</span><br><span class="line">    │                                             │</span><br><span class="line">    │                                             │  服务器状态: CLOSE_WAIT → LAST_ACK</span><br><span class="line">    │                                             │  含义：&quot;我也没有数据了，准备关闭&quot;</span><br><span class="line">    │                                             │</span><br><span class="line">    │         ④ ACK (Ack=401)                     │</span><br><span class="line">    │ ─────────────────────────────────────────&gt; │</span><br><span class="line">    │                                             │</span><br><span class="line">    │   客户端状态: FIN_WAIT_2 → TIME_WAIT         │  服务器状态: LAST_ACK → CLOSED ✅</span><br><span class="line">    │                                             │</span><br><span class="line">    │   (等待 2MSL 时间)                          │</span><br><span class="line">    │         ↓                                   │</span><br><span class="line">    │   客户端状态: TIME_WAIT → CLOSED ✅           │</span><br><span class="line">    │                                             │</span><br></pre></td></tr></table></figure>

<p><strong>详细步骤解析：</strong></p>
<p><strong>第一次挥手（客户端 → 服务器）：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">┌────────────────────────────────────┐</span><br><span class="line">│ TCP 报文内容：                     │</span><br><span class="line">├────────────────────────────────────┤</span><br><span class="line">│ FIN = 1                            │ ← 请求关闭连接</span><br><span class="line">│ ACK = 1                            │ ← 可能确认之前的数据</span><br><span class="line">│ Seq = 300                          │ ← 当前序列号</span><br><span class="line">│ Ack = 之前的值                     │</span><br><span class="line">├────────────────────────────────────┤</span><br><span class="line">│ 含义：&quot;我没有数据要发送了&quot;        │</span><br><span class="line">│       &quot;但我还可以接收数据&quot;        │</span><br><span class="line">└────────────────────────────────────┘</span><br><span class="line"></span><br><span class="line">客户端状态：ESTABLISHED → FIN_WAIT_1</span><br></pre></td></tr></table></figure>

<p><strong>第二次挥手（服务器 → 客户端）：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">┌────────────────────────────────────┐</span><br><span class="line">│ TCP 报文内容：                     │</span><br><span class="line">├────────────────────────────────────┤</span><br><span class="line">│ FIN = 0                            │</span><br><span class="line">│ ACK = 1                            │ ← 确认收到客户端的 FIN</span><br><span class="line">│ Seq = 400                          │</span><br><span class="line">│ Ack = 301 (Client_Seq + 1)         │ ← 确认关闭请求</span><br><span class="line">├────────────────────────────────────┤</span><br><span class="line">│ 含义：&quot;我知道你要关闭了&quot;          │</span><br><span class="line">│       &quot;但我可能还有数据要发送&quot;    │</span><br><span class="line">│       &quot;请等我发送完&quot;              │</span><br><span class="line">└────────────────────────────────────┘</span><br><span class="line"></span><br><span class="line">客户端状态：FIN_WAIT_1 → FIN_WAIT_2</span><br><span class="line">服务器状态：ESTABLISHED → CLOSE_WAIT</span><br><span class="line"></span><br><span class="line">⚠️ 此时连接处于半关闭状态：</span><br><span class="line">    客户端 → 服务器：已关闭 ❌</span><br><span class="line">    服务器 → 客户端：仍然可以发送数据 ✅</span><br></pre></td></tr></table></figure>

<p><strong>第三次挥手（服务器 → 客户端）：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">┌────────────────────────────────────┐</span><br><span class="line">│ TCP 报文内容：                     │</span><br><span class="line">├────────────────────────────────────┤</span><br><span class="line">│ FIN = 1                            │ ← 服务器也请求关闭</span><br><span class="line">│ ACK = 1                            │</span><br><span class="line">│ Seq = 500                          │</span><br><span class="line">│ Ack = 301                          │</span><br><span class="line">├────────────────────────────────────┤</span><br><span class="line">│ 含义：&quot;我的数据也发送完了&quot;        │</span><br><span class="line">│       &quot;我也要关闭连接了&quot;          │</span><br><span class="line">└────────────────────────────────────┘</span><br><span class="line"></span><br><span class="line">服务器状态：CLOSE_WAIT → LAST_ACK</span><br></pre></td></tr></table></figure>

<p><strong>第四次挥手（客户端 → 服务器）：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">┌────────────────────────────────────┐</span><br><span class="line">│ TCP 报文内容：                     │</span><br><span class="line">├────────────────────────────────────┤</span><br><span class="line">│ FIN = 0                            │</span><br><span class="line">│ ACK = 1                            │ ← 确认服务器的 FIN</span><br><span class="line">│ Seq = 301                          │</span><br><span class="line">│ Ack = 501 (Server_Seq + 1)         │</span><br><span class="line">├────────────────────────────────────┤</span><br><span class="line">│ 含义：&quot;我知道你也要关闭了&quot;        │</span><br><span class="line">│       &quot;确认关闭&quot;                  │</span><br><span class="line">└────────────────────────────────────┘</span><br><span class="line"></span><br><span class="line">服务器状态：LAST_ACK → CLOSED ✅ (立即关闭)</span><br><span class="line">客户端状态：FIN_WAIT_2 → TIME_WAIT (等待 2MSL)</span><br><span class="line">           TIME_WAIT → CLOSED ✅ (2MSL 后关闭)</span><br></pre></td></tr></table></figure>

<p><strong>TIME_WAIT 状态（2MSL 等待）：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">MSL (Maximum Segment Lifetime): 报文段最大生存时间</span><br><span class="line">通常 MSL = 30秒 或 2分钟（取决于系统）</span><br><span class="line">2MSL = 60秒 或 4分钟</span><br><span class="line"></span><br><span class="line">为什么需要 TIME_WAIT？</span><br><span class="line"></span><br><span class="line">原因 1：确保最后的 ACK 能够到达服务器</span><br><span class="line">┌─────────────────────────────────────┐</span><br><span class="line">│ 客户端发送最后的 ACK                │</span><br><span class="line">│    ↓                                │</span><br><span class="line">│    如果 ACK 丢失                     │</span><br><span class="line">│    ↓                                │</span><br><span class="line">│ 服务器超时，重传 FIN                │</span><br><span class="line">│    ↓                                │</span><br><span class="line">│ 客户端在 TIME_WAIT 期间可以接收      │</span><br><span class="line">│ 并重新发送 ACK                       │</span><br><span class="line">└─────────────────────────────────────┘</span><br><span class="line"></span><br><span class="line">原因 2：防止旧连接的数据干扰新连接</span><br><span class="line">┌─────────────────────────────────────┐</span><br><span class="line">│ 网络中可能还有延迟的旧数据包         │</span><br><span class="line">│ 等待 2MSL 确保所有旧包都消失         │</span><br><span class="line">│ 避免影响使用相同端口的新连接         │</span><br><span class="line">└─────────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="4️⃣-TCP-状态转换图"><a href="#4️⃣-TCP-状态转换图" class="headerlink" title="4️⃣ TCP 状态转换图"></a>4️⃣ TCP 状态转换图</h3><p><strong>完整的 TCP 状态机：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">客户端状态转换                          服务器状态转换</span><br><span class="line">    │                                      │</span><br><span class="line"> CLOSED                                 CLOSED</span><br><span class="line">    │                                      │</span><br><span class="line">    │ (主动打开)                           │ (被动打开, listen())</span><br><span class="line">    ↓                                      ↓</span><br><span class="line"> SYN_SENT ──────① SYN─────────────────&gt; LISTEN</span><br><span class="line">    │                                      │</span><br><span class="line">    │          ② SYN-ACK                   ↓</span><br><span class="line">    │  &lt;──────────────────────────── SYN_RCVD</span><br><span class="line">    ↓                                      │</span><br><span class="line">    │          ③ ACK                       │</span><br><span class="line">ESTABLISHED ─────────────────────────&gt; ESTABLISHED</span><br><span class="line">    │                                      │</span><br><span class="line">    │ (主动关闭)                           │</span><br><span class="line">    │          ① FIN                       │</span><br><span class="line">FIN_WAIT_1 ─────────────────────────&gt; CLOSE_WAIT</span><br><span class="line">    │                                      │ (被动关闭)</span><br><span class="line">    │          ② ACK                       │</span><br><span class="line">    ↓                                      │</span><br><span class="line">FIN_WAIT_2                                 │</span><br><span class="line">    │                                      │</span><br><span class="line">    │          ③ FIN                       │</span><br><span class="line">    │  &lt;───────────────────────────── LAST_ACK</span><br><span class="line">    ↓                                      │</span><br><span class="line">    │          ④ ACK                       │</span><br><span class="line">TIME_WAIT  ─────────────────────────&gt;   CLOSED</span><br><span class="line">    │</span><br><span class="line">    │ (等待 2MSL)</span><br><span class="line">    ↓</span><br><span class="line">  CLOSED</span><br></pre></td></tr></table></figure>

<p><strong>TCP 状态说明：</strong></p>
<table>
<thead>
<tr>
<th>状态</th>
<th>说明</th>
<th>谁会进入</th>
</tr>
</thead>
<tbody><tr>
<td><strong>CLOSED</strong></td>
<td>关闭状态，无连接</td>
<td>初始状态</td>
</tr>
<tr>
<td><strong>LISTEN</strong></td>
<td>监听状态，等待连接请求</td>
<td>服务器</td>
</tr>
<tr>
<td><strong>SYN_SENT</strong></td>
<td>已发送 SYN，等待服务器响应</td>
<td>客户端</td>
</tr>
<tr>
<td><strong>SYN_RCVD</strong></td>
<td>已收到 SYN，等待最后的 ACK</td>
<td>服务器</td>
</tr>
<tr>
<td><strong>ESTABLISHED</strong></td>
<td>连接已建立，可以传输数据</td>
<td>双方</td>
</tr>
<tr>
<td><strong>FIN_WAIT_1</strong></td>
<td>已发送 FIN，等待 ACK</td>
<td>主动关闭方</td>
</tr>
<tr>
<td><strong>FIN_WAIT_2</strong></td>
<td>已收到 ACK，等待对方的 FIN</td>
<td>主动关闭方</td>
</tr>
<tr>
<td><strong>CLOSE_WAIT</strong></td>
<td>已收到 FIN，等待应用层关闭</td>
<td>被动关闭方</td>
</tr>
<tr>
<td><strong>LAST_ACK</strong></td>
<td>已发送 FIN，等待最后的 ACK</td>
<td>被动关闭方</td>
</tr>
<tr>
<td><strong>TIME_WAIT</strong></td>
<td>等待 2MSL，确保连接安全关闭</td>
<td>主动关闭方</td>
</tr>
</tbody></table>
<hr>
<h3 id="5️⃣-五元组（会话标识）"><a href="#5️⃣-五元组（会话标识）" class="headerlink" title="5️⃣ 五元组（会话标识）"></a>5️⃣ 五元组（会话标识）</h3><p><strong>TCP 连接唯一标识：五元组</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">五元组 = (源IP, 源端口, 目标IP, 目标端口, 协议)</span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line">┌─────────────────────────────────────┐</span><br><span class="line">│ 源 IP:        192.168.31.36         │</span><br><span class="line">│ 源端口:       54321                  │</span><br><span class="line">│ 目标 IP:      172.217.160.142       │</span><br><span class="line">│ 目标端口:     443 (HTTPS)            │</span><br><span class="line">│ 协议:         TCP (6)                │</span><br><span class="line">└─────────────────────────────────────┘</span><br><span class="line"></span><br><span class="line">这个五元组唯一标识一个 TCP 连接</span><br></pre></td></tr></table></figure>

<p><strong>为什么需要五元组？</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">场景：浏览器同时访问多个网站</span><br><span class="line"></span><br><span class="line">连接 1：访问百度</span><br><span class="line">├─ 源 IP: 192.168.31.36</span><br><span class="line">├─ 源端口: 54321</span><br><span class="line">├─ 目标 IP: 220.181.38.148 (百度)</span><br><span class="line">├─ 目标端口: 443</span><br><span class="line">└─ 协议: TCP</span><br><span class="line"></span><br><span class="line">连接 2：访问谷歌</span><br><span class="line">├─ 源 IP: 192.168.31.36 (相同)</span><br><span class="line">├─ 源端口: 54322 (不同) ← 通过不同端口区分</span><br><span class="line">├─ 目标 IP: 172.217.160.142 (谷歌)</span><br><span class="line">├─ 目标端口: 443 (相同)</span><br><span class="line">└─ 协议: TCP</span><br><span class="line"></span><br><span class="line">系统通过五元组区分这两个连接</span><br><span class="line">收到数据包时，根据五元组判断属于哪个连接</span><br></pre></td></tr></table></figure>

<p><strong>端口号范围：</strong></p>
<table>
<thead>
<tr>
<th>端口范围</th>
<th>类型</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><strong>0-1023</strong></td>
<td>知名端口</td>
<td>保留给系统服务</td>
<td>80(HTTP), 443(HTTPS), 22(SSH)</td>
</tr>
<tr>
<td><strong>1024-49151</strong></td>
<td>注册端口</td>
<td>应用程序注册使用</td>
<td>3306(MySQL), 8080(备用 HTTP)</td>
</tr>
<tr>
<td><strong>49152-65535</strong></td>
<td>动态&#x2F;私有端口</td>
<td>客户端临时使用</td>
<td>浏览器发起连接时随机分配</td>
</tr>
</tbody></table>
<hr>
<h3 id="6️⃣-UDP-协议对比"><a href="#6️⃣-UDP-协议对比" class="headerlink" title="6️⃣ UDP 协议对比"></a>6️⃣ UDP 协议对比</h3><p><strong>UDP（User Datagram Protocol，用户数据报协议）</strong></p>
<p><strong>核心特点：</strong></p>
<ul>
<li>⚠️ <strong>无连接</strong>：不需要建立连接，直接发送</li>
<li>⚠️ <strong>不可靠</strong>：不保证数据到达，不重传</li>
<li>⚠️ <strong>无序</strong>：不保证顺序</li>
<li>✅ <strong>低开销</strong>：首部只有 8 字节</li>
<li>✅ <strong>快速</strong>：没有握手、挥手过程</li>
<li>✅ <strong>支持广播&#x2F;多播</strong>：一对多通信</li>
</ul>
<p><strong>UDP 报文结构：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> 0                   1                   2                   3</span><br><span class="line"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|          源端口 (16位)         |        目标端口 (16位)        |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|         长度 (16位)            |         校验和 (16位)         |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                          数据                                 |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line"></span><br><span class="line">只有 8 字节的首部！</span><br></pre></td></tr></table></figure>

<p><strong>TCP vs UDP 对比：</strong></p>
<table>
<thead>
<tr>
<th>对比项</th>
<th>TCP</th>
<th>UDP</th>
</tr>
</thead>
<tbody><tr>
<td><strong>连接</strong></td>
<td>面向连接（握手）</td>
<td>无连接</td>
</tr>
<tr>
<td><strong>可靠性</strong></td>
<td>可靠（确认、重传）</td>
<td>不可靠</td>
</tr>
<tr>
<td><strong>顺序</strong></td>
<td>保证顺序</td>
<td>不保证</td>
</tr>
<tr>
<td><strong>速度</strong></td>
<td>较慢（有开销）</td>
<td>快速</td>
</tr>
<tr>
<td><strong>首部大小</strong></td>
<td>20-60 字节</td>
<td>8 字节</td>
</tr>
<tr>
<td><strong>流量控制</strong></td>
<td>有（窗口机制）</td>
<td>无</td>
</tr>
<tr>
<td><strong>拥塞控制</strong></td>
<td>有</td>
<td>无</td>
</tr>
<tr>
<td><strong>广播&#x2F;多播</strong></td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td><strong>适用场景</strong></td>
<td>文件传输、网页、邮件</td>
<td>视频通话、在线游戏、DNS</td>
</tr>
</tbody></table>
<p><strong>UDP 适用场景：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">✅ 实时音视频通话（如 Zoom、微信视频）</span><br><span class="line">   原因：丢失少量数据包不影响体验，追求低延迟</span><br><span class="line"></span><br><span class="line">✅ 在线游戏</span><br><span class="line">   原因：需要快速响应，偶尔丢包可以容忍</span><br><span class="line"></span><br><span class="line">✅ DNS 查询</span><br><span class="line">   原因：查询数据量小，查询失败可以重试</span><br><span class="line"></span><br><span class="line">✅ 直播流媒体</span><br><span class="line">   原因：实时性要求高，丢失几帧不影响观看</span><br><span class="line"></span><br><span class="line">✅ 物联网设备</span><br><span class="line">   原因：设备资源有限，协议简单更合适</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="7️⃣-常见问题与异常"><a href="#7️⃣-常见问题与异常" class="headerlink" title="7️⃣ 常见问题与异常"></a>7️⃣ 常见问题与异常</h3><p><strong>问题 1：SYN 洪泛攻击（SYN Flood）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">攻击原理：</span><br><span class="line">攻击者 ──大量 SYN──&gt; 服务器</span><br><span class="line">         (伪造源IP)</span><br><span class="line"></span><br><span class="line">服务器回复 SYN-ACK，等待最后的 ACK</span><br><span class="line">但攻击者永远不发送 ACK</span><br><span class="line">服务器维持大量半连接状态（SYN_RCVD）</span><br><span class="line">→ 资源耗尽，无法处理正常连接</span><br><span class="line"></span><br><span class="line">防护措施：</span><br><span class="line">✅ SYN Cookie 技术</span><br><span class="line">✅ 限制半连接数量</span><br><span class="line">✅ 使用防火墙过滤</span><br><span class="line">✅ 增加 SYN 队列大小</span><br></pre></td></tr></table></figure>

<p><strong>问题 2：连接泄漏（Connection Leak）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">原因：应用程序没有正确关闭连接</span><br><span class="line"></span><br><span class="line">后果：</span><br><span class="line">├─ 客户端：大量 TIME_WAIT 状态</span><br><span class="line">├─ 服务器：大量 CLOSE_WAIT 状态</span><br><span class="line">└─ 端口耗尽，无法建立新连接</span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line">✅ 确保程序正确关闭 socket</span><br><span class="line">✅ 使用连接池管理连接</span><br><span class="line">✅ 设置合理的超时时间</span><br></pre></td></tr></table></figure>

<p><strong>问题 3：大量 TIME_WAIT 状态</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">原因：主动关闭方在 2MSL 期间保持 TIME_WAIT</span><br><span class="line"></span><br><span class="line">影响：</span><br><span class="line">├─ 占用大量端口（客户端端口范围有限）</span><br><span class="line">└─ 频繁建立连接的场景（如爬虫）容易耗尽端口</span><br><span class="line"></span><br><span class="line">优化：</span><br><span class="line">✅ 使用长连接（HTTP Keep-Alive）</span><br><span class="line">✅ 调整系统参数（减少 TIME_WAIT 时间）</span><br><span class="line">✅ 使用 SO_REUSEADDR 选项</span><br><span class="line">✅ 反向：让服务器主动关闭连接</span><br></pre></td></tr></table></figure>

<h2 id="实践任务（合法授权范围内）"><a href="#实践任务（合法授权范围内）" class="headerlink" title="实践任务（合法授权范围内）"></a>实践任务（合法授权范围内）</h2><h3 id="🎯-任务-1-使用-Wireshark-观察-TCP-三次握手与四次挥手"><a href="#🎯-任务-1-使用-Wireshark-观察-TCP-三次握手与四次挥手" class="headerlink" title="🎯 任务 1: 使用 Wireshark 观察 TCP 三次握手与四次挥手"></a>🎯 任务 1: 使用 Wireshark 观察 TCP 三次握手与四次挥手</h3><p><strong>准备工作：</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 确保 Wireshark 已安装</span></span><br><span class="line"><span class="comment"># 如果没有安装，执行：</span></span><br><span class="line">winget install <span class="literal">-e</span> <span class="literal">--id</span> WiresharkFoundation.Wireshark</span><br></pre></td></tr></table></figure>

<p><strong>步骤 1：启动 Wireshark 抓包</strong></p>
<ol>
<li>打开 Wireshark</li>
<li>选择活动网络接口（Wi-Fi 或以太网）</li>
<li>开始捕获</li>
</ol>
<p><strong>步骤 2：设置显示过滤器</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcp.flags.syn==1 or tcp.flags.fin==1</span><br></pre></td></tr></table></figure>

<p>这个过滤器会显示所有带 SYN 或 FIN 标志的包（握手和挥手）</p>
<p><strong>步骤 3：访问网站触发 TCP 连接</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 curl 访问网站（会自动关闭连接）</span></span><br><span class="line"><span class="built_in">curl</span> http://example.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用浏览器访问：</span></span><br><span class="line"><span class="comment"># http://neverssl.com (不使用 HTTPS，方便观察明文)</span></span><br></pre></td></tr></table></figure>

<p><strong>步骤 4：停止抓包并分析</strong></p>
<p><strong>查找三次握手：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">在 Wireshark 中查找：</span><br><span class="line">1. [SYN] 包 → 客户端发起</span><br><span class="line">2. [SYN, ACK] 包 → 服务器响应</span><br><span class="line">3. [ACK] 包 → 客户端确认</span><br><span class="line"></span><br><span class="line">可以在 Info 列看到类似：</span><br><span class="line">→ [SYN] Seq=0 Win=...</span><br><span class="line">→ [SYN, ACK] Seq=0 Ack=1 Win=...</span><br><span class="line">→ [ACK] Seq=1 Ack=1 Win=...</span><br></pre></td></tr></table></figure>

<p><strong>查找四次挥手：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">在 Wireshark 中查找：</span><br><span class="line">1. [FIN, ACK] 包 → 一方请求关闭</span><br><span class="line">2. [ACK] 包 → 另一方确认</span><br><span class="line">3. [FIN, ACK] 包 → 另一方也请求关闭</span><br><span class="line">4. [ACK] 包 → 最终确认</span><br><span class="line"></span><br><span class="line">可以在 Info 列看到类似：</span><br><span class="line">→ [FIN, ACK] Seq=X Ack=Y</span><br><span class="line">→ [ACK] Seq=Y Ack=X+1</span><br><span class="line">→ [FIN, ACK] Seq=Y Ack=X+1</span><br><span class="line">→ [ACK] Seq=X+1 Ack=Y+1</span><br></pre></td></tr></table></figure>

<p><strong>步骤 5：详细分析 TCP 标志位</strong></p>
<p>点击任一 TCP 包，展开 “Transmission Control Protocol” 部分：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Transmission Control Protocol</span><br><span class="line">├─ Source Port: 54321</span><br><span class="line">├─ Destination Port: 80</span><br><span class="line">├─ Sequence Number: 0 (relative)</span><br><span class="line">├─ Acknowledgment Number: 0</span><br><span class="line">├─ Header Length: 40 bytes</span><br><span class="line">├─ Flags: 0x002 (SYN)  ← 重点查看</span><br><span class="line">│   ├─ 000000.. = Reserved: Not set</span><br><span class="line">│   ├─ ......0. = Nonce: Not set</span><br><span class="line">│   ├─ .....0.. = Congestion Window Reduced: Not set</span><br><span class="line">│   ├─ ....0... = ECN-Echo: Not set</span><br><span class="line">│   ├─ ...0.... = Urgent: Not set</span><br><span class="line">│   ├─ ..0..... = Acknowledgment: Not set</span><br><span class="line">│   ├─ .0...... = Push: Not set</span><br><span class="line">│   ├─ 0....... = Reset: Not set</span><br><span class="line">│   ├─ 1....... = Syn: Set ✅</span><br><span class="line">│   └─ .......0 = Fin: Not set</span><br><span class="line">├─ Window: 65535</span><br><span class="line">├─ Checksum: 0x1234</span><br><span class="line">└─ Options: ...</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="🎯-任务-2-查看本机-TCP-连接状态"><a href="#🎯-任务-2-查看本机-TCP-连接状态" class="headerlink" title="🎯 任务 2: 查看本机 TCP 连接状态"></a>🎯 任务 2: 查看本机 TCP 连接状态</h3><p><strong>方法 1：使用 PowerShell（推荐）</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看所有 TCP 连接及状态</span></span><br><span class="line"><span class="built_in">Get-NetTCPConnection</span> | <span class="built_in">Format-Table</span> LocalAddress, LocalPort, RemoteAddress, RemotePort, State <span class="literal">-AutoSize</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 ESTABLISHED 状态的连接</span></span><br><span class="line"><span class="built_in">Get-NetTCPConnection</span> <span class="literal">-State</span> Established | <span class="built_in">Format-Table</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看特定端口的连接（如 443 HTTPS）</span></span><br><span class="line"><span class="built_in">Get-NetTCPConnection</span> <span class="literal">-RemotePort</span> <span class="number">443</span> | <span class="built_in">Format-Table</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计各状态的连接数</span></span><br><span class="line"><span class="built_in">Get-NetTCPConnection</span> | <span class="built_in">Group-Object</span> <span class="literal">-Property</span> State | <span class="built_in">Sort-Object</span> Count <span class="literal">-Descending</span></span><br></pre></td></tr></table></figure>

<p><strong>方法 2：使用 netstat 命令</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看所有 TCP 连接</span></span><br><span class="line">netstat <span class="literal">-an</span> | findstr <span class="string">&quot;TCP&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 ESTABLISHED 状态的连接</span></span><br><span class="line">netstat <span class="literal">-an</span> | findstr <span class="string">&quot;ESTABLISHED&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 TIME_WAIT 状态的连接（通常很多）</span></span><br><span class="line">netstat <span class="literal">-an</span> | findstr <span class="string">&quot;TIME_WAIT&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计各状态的数量</span></span><br><span class="line">netstat <span class="literal">-an</span> | findstr <span class="string">&quot;TCP&quot;</span> | findstr /c:<span class="string">&quot;ESTABLISHED&quot;</span> /c:<span class="string">&quot;TIME_WAIT&quot;</span> /c:<span class="string">&quot;CLOSE_WAIT&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>预期输出示例：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">协议   本地地址              外部地址              状态</span><br><span class="line">TCP    192.168.31.36:54321   172.217.160.142:443  ESTABLISHED</span><br><span class="line">TCP    192.168.31.36:54322   220.181.38.148:80    TIME_WAIT</span><br><span class="line">TCP    192.168.31.36:54323   13.107.42.14:443     ESTABLISHED</span><br><span class="line">TCP    0.0.0.0:135           0.0.0.0:0            LISTENING</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="🎯-任务-3-构造-UDP-流量并对比-TCP"><a href="#🎯-任务-3-构造-UDP-流量并对比-TCP" class="headerlink" title="🎯 任务 3: 构造 UDP 流量并对比 TCP"></a>🎯 任务 3: 构造 UDP 流量并对比 TCP</h3><p><strong>DNS 查询（UDP 示例）</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 Wireshark 中设置过滤器</span></span><br><span class="line"><span class="comment"># dns</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 然后执行 DNS 查询</span></span><br><span class="line">nslookup baidu.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用 Resolve-DnsName (PowerShell)</span></span><br><span class="line"><span class="built_in">Resolve-DnsName</span> baidu.com <span class="literal">-Type</span> A <span class="literal">-Server</span> <span class="number">8.8</span>.<span class="number">8.8</span></span><br></pre></td></tr></table></figure>

<p><strong>在 Wireshark 中观察：</strong></p>
<p><strong>UDP 包特征：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">User Datagram Protocol</span><br><span class="line">├─ Source Port: 54321</span><br><span class="line">├─ Destination Port: 53 (DNS)</span><br><span class="line">├─ Length: 45</span><br><span class="line">└─ Checksum: 0x1234</span><br><span class="line"></span><br><span class="line">特点：</span><br><span class="line">✅ 没有握手过程</span><br><span class="line">✅ 直接发送数据</span><br><span class="line">✅ 没有确认机制</span><br><span class="line">✅ 首部只有 8 字节</span><br></pre></td></tr></table></figure>

<p><strong>与 TCP 对比：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">TCP (访问网站):</span><br><span class="line">1. 三次握手（3 个包）</span><br><span class="line">2. 数据传输（N 个包，带 ACK）</span><br><span class="line">3. 四次挥手（4 个包）</span><br><span class="line">总计：至少 7 个包</span><br><span class="line"></span><br><span class="line">UDP (DNS 查询):</span><br><span class="line">1. 直接发送查询（1 个包）</span><br><span class="line">2. 收到响应（1 个包）</span><br><span class="line">总计：2 个包</span><br><span class="line"></span><br><span class="line">UDP 的优势：快速、低开销</span><br><span class="line">UDP 的劣势：不保证可靠性</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="🎯-任务-4-使用-telnet-手动模拟-TCP-连接"><a href="#🎯-任务-4-使用-telnet-手动模拟-TCP-连接" class="headerlink" title="🎯 任务 4: 使用 telnet 手动模拟 TCP 连接"></a>🎯 任务 4: 使用 telnet 手动模拟 TCP 连接</h3><p><strong>连接到 HTTP 服务器：</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 连接到 example.com 的 80 端口</span></span><br><span class="line">telnet example.com <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 然后手动输入 HTTP 请求（快速输入以下内容并按两次回车）：</span></span><br><span class="line">GET / HTTP/<span class="number">1.1</span></span><br><span class="line">Host: example.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 会看到服务器返回的 HTTP 响应</span></span><br></pre></td></tr></table></figure>

<p><strong>同时在 Wireshark 中观察：</strong></p>
<ul>
<li>可以看到三次握手</li>
<li>看到你输入的 HTTP 请求（明文）</li>
<li>看到服务器的响应</li>
<li>看到四次挥手（关闭连接）</li>
</ul>
<hr>
<h3 id="🎯-任务-5-分析真实场景的-TCP-会话"><a href="#🎯-任务-5-分析真实场景的-TCP-会话" class="headerlink" title="🎯 任务 5: 分析真实场景的 TCP 会话"></a>🎯 任务 5: 分析真实场景的 TCP 会话</h3><p><strong>步骤 1：在 Wireshark 中抓包</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 过滤器设置为：</span><br><span class="line">tcp.port == 443</span><br><span class="line"></span><br><span class="line"># 然后用浏览器访问 https://www.baidu.com</span><br></pre></td></tr></table></figure>

<p><strong>步骤 2：追踪 TCP 流</strong></p>
<p>在 Wireshark 中：</p>
<ol>
<li>右键点击任一属于该连接的包</li>
<li>选择 “Follow” → “TCP Stream”</li>
<li>会打开一个新窗口显示完整的会话内容</li>
</ol>
<p><strong>步骤 3：提取五元组信息</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">在包详情中查找：</span><br><span class="line">┌─────────────────────────────────────┐</span><br><span class="line">│ Internet Protocol Version 4         │</span><br><span class="line">│ ├─ Source: 192.168.31.36            │ ← 源 IP</span><br><span class="line">│ └─ Destination: 220.181.38.148      │ ← 目标 IP</span><br><span class="line">│                                     │</span><br><span class="line">│ Transmission Control Protocol       │</span><br><span class="line">│ ├─ Source Port: 54321               │ ← 源端口</span><br><span class="line">│ ├─ Destination Port: 443            │ ← 目标端口</span><br><span class="line">│ └─ ...                              │</span><br><span class="line">└─────────────────────────────────────┘</span><br><span class="line"></span><br><span class="line">协议：TCP (传输层协议号 6)</span><br><span class="line"></span><br><span class="line">五元组：</span><br><span class="line">(192.168.31.36, 54321, 220.181.38.148, 443, TCP)</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="📊-实践任务总结检查清单"><a href="#📊-实践任务总结检查清单" class="headerlink" title="📊 实践任务总结检查清单"></a>📊 实践任务总结检查清单</h3><p>完成以下任务后，在对应项打勾：</p>
<ul>
<li><input disabled="" type="checkbox"> ✅ 使用 Wireshark 捕获 TCP 三次握手</li>
<li><input disabled="" type="checkbox"> ✅ 在 Wireshark 中识别 SYN、SYN-ACK、ACK 包</li>
<li><input disabled="" type="checkbox"> ✅ 使用 Wireshark 捕获 TCP 四次挥手</li>
<li><input disabled="" type="checkbox"> ✅ 在 Wireshark 中识别 FIN、ACK 包</li>
<li><input disabled="" type="checkbox"> ✅ 使用 <code>Get-NetTCPConnection</code> 查看本机连接状态</li>
<li><input disabled="" type="checkbox"> ✅ 观察 TIME_WAIT、ESTABLISHED 等状态</li>
<li><input disabled="" type="checkbox"> ✅ 使用 Wireshark 捕获 UDP 流量（DNS 查询）</li>
<li><input disabled="" type="checkbox"> ✅ 对比 TCP 和 UDP 的包结构差异</li>
<li><input disabled="" type="checkbox"> ✅ 从抓包中提取五元组信息</li>
<li><input disabled="" type="checkbox"> ✅ 理解 TCP 标志位的含义</li>
</ul>
<hr>
<h2 id="巩固练习（题与复盘）"><a href="#巩固练习（题与复盘）" class="headerlink" title="巩固练习（题与复盘）"></a>巩固练习（题与复盘）</h2><h3 id="📝-练习-1-为什么有些应用更适合-UDP？举例说明"><a href="#📝-练习-1-为什么有些应用更适合-UDP？举例说明" class="headerlink" title="📝 练习 1: 为什么有些应用更适合 UDP？举例说明"></a>📝 练习 1: 为什么有些应用更适合 UDP？举例说明</h3><p><strong>题目：</strong> 分析为什么某些应用选择 UDP 而不是 TCP？请举出 3 个例子并说明原因。</p>
<hr>
<p><strong>答案：</strong></p>
<p><strong>示例 1：实时音视频通话（Zoom、微信视频、Skype）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">为什么用 UDP？</span><br><span class="line">├─ 实时性要求：延迟必须低于 200ms 才有良好体验</span><br><span class="line">├─ TCP 的问题：</span><br><span class="line">│   ├─ 握手延迟：建立连接需要 1.5 RTT</span><br><span class="line">│   ├─ 重传机制：丢包会触发重传，导致延迟增加</span><br><span class="line">│   └─ 队头阻塞：一个包丢失会阻塞后续包</span><br><span class="line">├─ UDP 的优势：</span><br><span class="line">│   ├─ 无连接：立即发送，无建立延迟</span><br><span class="line">│   ├─ 不重传：丢失的音视频帧直接跳过</span><br><span class="line">│   └─ 低延迟：平均延迟更低</span><br><span class="line">└─ 容忍度：丢失少量帧不影响通话质量（人耳/眼不敏感）</span><br><span class="line"></span><br><span class="line">实际表现：</span><br><span class="line">丢包 1-2%：几乎无感知 ✅</span><br><span class="line">丢包 5%：偶尔卡顿，但可以接受</span><br><span class="line">丢包 10%：明显卡顿，但仍能通话</span><br><span class="line">延迟 200ms+ with TCP：无法正常对话 ❌</span><br></pre></td></tr></table></figure>

<p><strong>示例 2：在线游戏（PUBG、王者荣耀、CS:GO）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">为什么用 UDP？</span><br><span class="line">├─ 对实时性的极致要求：</span><br><span class="line">│   └─ 射击游戏需要 &lt;50ms 延迟才有良好体验</span><br><span class="line">├─ TCP 的问题：</span><br><span class="line">│   ├─ 重传导致延迟抖动</span><br><span class="line">│   ├─ 拥塞控制降低发送速率</span><br><span class="line">│   └─ 玩家位置、动作的旧数据没有价值</span><br><span class="line">├─ UDP 的优势：</span><br><span class="line">│   ├─ 最新状态优先：旧的位置更新直接丢弃</span><br><span class="line">│   ├─ 稳定低延迟：不会因丢包触发重传</span><br><span class="line">│   └─ 应用层控制：游戏自己实现可靠性（关键数据）</span><br><span class="line">└─ 游戏设计：</span><br><span class="line">    ├─ 关键数据（伤害、击杀）：应用层确认重传</span><br><span class="line">    ├─ 非关键数据（位置更新）：丢了就丢了，用下一帧</span><br><span class="line">    └─ 客户端预测 + 服务器校正机制</span><br><span class="line"></span><br><span class="line">网络策略：</span><br><span class="line">状态更新：UDP（每秒 20-60 次）</span><br><span class="line">关键事件：UDP + 应用层重传确认</span><br></pre></td></tr></table></figure>

<p><strong>示例 3：DNS 查询</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">为什么用 UDP？</span><br><span class="line">├─ 数据量小：</span><br><span class="line">│   └─ DNS 查询通常 &lt;512 字节，单个 UDP 包足够</span><br><span class="line">├─ TCP 的浪费：</span><br><span class="line">│   ├─ 三次握手：需要 3 个包</span><br><span class="line">│   ├─ 查询请求：1 个包</span><br><span class="line">│   ├─ 查询响应：1 个包</span><br><span class="line">│   ├─ 四次挥手：4 个包</span><br><span class="line">│   └─ 总计：9 个包</span><br><span class="line">├─ UDP 的高效：</span><br><span class="line">│   ├─ 查询请求：1 个包</span><br><span class="line">│   ├─ 查询响应：1 个包</span><br><span class="line">│   └─ 总计：2 个包</span><br><span class="line">└─ 失败处理简单：</span><br><span class="line">    └─ 如果无响应，客户端重新发送查询即可</span><br><span class="line"></span><br><span class="line">性能对比：</span><br><span class="line">TCP DNS 查询：需要 1.5 RTT (握手) + 1 RTT (查询) = 2.5 RTT</span><br><span class="line">UDP DNS 查询：需要 1 RTT (查询)</span><br><span class="line">效率提升：60%</span><br><span class="line"></span><br><span class="line">注意：大响应（&gt;512 字节）会降级到 TCP</span><br></pre></td></tr></table></figure>

<p><strong>示例 4：流媒体直播（IPTV、网络直播）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">为什么用 UDP（或 RTP over UDP）？</span><br><span class="line">├─ 实时性：直播延迟通常 2-5 秒</span><br><span class="line">├─ TCP 的问题：</span><br><span class="line">│   ├─ 丢包重传会增加延迟</span><br><span class="line">│   ├─ 观众看到的画面会越来越延迟</span><br><span class="line">│   └─ 缓冲区积压</span><br><span class="line">├─ UDP 的优势：</span><br><span class="line">│   ├─ 丢失几帧不影响观看体验</span><br><span class="line">│   ├─ 保持稳定的延迟</span><br><span class="line">│   └─ 支持多播（一对多）</span><br><span class="line">└─ 容错机制：</span><br><span class="line">    ├─ 视频编码：I 帧、P 帧冗余</span><br><span class="line">    ├─ FEC（前向纠错）</span><br><span class="line">    └─ 视频缓冲</span><br><span class="line"></span><br><span class="line">多播优势：</span><br><span class="line">服务器发送 1 份数据 → 网络设备复制 → 多个观众接收</span><br><span class="line">TCP 无法实现多播</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>总结：UDP 适用场景的共同特点</strong></p>
<table>
<thead>
<tr>
<th>特点</th>
<th>说明</th>
<th>示例应用</th>
</tr>
</thead>
<tbody><tr>
<td><strong>实时性要求高</strong></td>
<td>延迟比可靠性更重要</td>
<td>音视频通话、游戏</td>
</tr>
<tr>
<td><strong>数据时效性</strong></td>
<td>旧数据价值低</td>
<td>游戏位置更新、直播</td>
</tr>
<tr>
<td><strong>小数据量</strong></td>
<td>单包可以容纳</td>
<td>DNS、DHCP、NTP</td>
</tr>
<tr>
<td><strong>可容忍丢包</strong></td>
<td>丢失少量数据不影响整体</td>
<td>视频流、语音</td>
</tr>
<tr>
<td><strong>需要广播&#x2F;多播</strong></td>
<td>一对多通信</td>
<td>IPTV、局域网发现</td>
</tr>
<tr>
<td><strong>应用层自己实现可靠性</strong></td>
<td>对关键数据选择性确认</td>
<td>QUIC、游戏协议</td>
</tr>
</tbody></table>
<hr>
<h3 id="📝-练习-2-从抓包中提取一个-TCP-会话的五元组"><a href="#📝-练习-2-从抓包中提取一个-TCP-会话的五元组" class="headerlink" title="📝 练习 2: 从抓包中提取一个 TCP 会话的五元组"></a>📝 练习 2: 从抓包中提取一个 TCP 会话的五元组</h3><p><strong>题目：</strong> 假设在 Wireshark 中捕获了以下 TCP 包，请提取五元组信息。</p>
<p><strong>抓包信息：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Frame 100: 74 bytes on wire</span><br><span class="line">Ethernet II</span><br><span class="line">├─ Destination: 38:3d:5b:0c:92:1c</span><br><span class="line">├─ Source: c8:15:4e:a8:d3:fb</span><br><span class="line">└─ Type: IPv4 (0x0800)</span><br><span class="line"></span><br><span class="line">Internet Protocol Version 4</span><br><span class="line">├─ Source: 192.168.31.36</span><br><span class="line">├─ Destination: 220.181.38.148</span><br><span class="line">├─ Protocol: TCP (6)</span><br><span class="line">└─ ...</span><br><span class="line"></span><br><span class="line">Transmission Control Protocol</span><br><span class="line">├─ Source Port: 54321</span><br><span class="line">├─ Destination Port: 443</span><br><span class="line">├─ Sequence Number: 1000</span><br><span class="line">├─ Acknowledgment Number: 2000</span><br><span class="line">├─ Flags: 0x018 (PSH, ACK)</span><br><span class="line">└─ ...</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>答案：</strong></p>
<p><strong>提取的五元组：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">┌─────────────────────────────────────┐</span><br><span class="line">│ TCP 连接五元组                      │</span><br><span class="line">├─────────────────────────────────────┤</span><br><span class="line">│ ① 源 IP 地址:    192.168.31.36      │ ← 发送方 IP</span><br><span class="line">│ ② 源端口:        54321              │ ← 发送方端口（动态端口）</span><br><span class="line">│ ③ 目标 IP 地址:  220.181.38.148     │ ← 接收方 IP（百度）</span><br><span class="line">│ ④ 目标端口:      443                │ ← 接收方端口（HTTPS）</span><br><span class="line">│ ⑤ 传输层协议:    TCP (6)            │ ← 协议类型</span><br><span class="line">└─────────────────────────────────────┘</span><br><span class="line"></span><br><span class="line">五元组表示：</span><br><span class="line">(192.168.31.36:54321, 220.181.38.148:443, TCP)</span><br></pre></td></tr></table></figure>

<p><strong>字段解释：</strong></p>
<table>
<thead>
<tr>
<th>字段</th>
<th>值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>源 IP</strong></td>
<td>192.168.31.36</td>
<td>本机 IP（私有地址）</td>
</tr>
<tr>
<td><strong>源端口</strong></td>
<td>54321</td>
<td>客户端随机分配的端口（49152-65535 范围）</td>
</tr>
<tr>
<td><strong>目标 IP</strong></td>
<td>220.181.38.148</td>
<td>百度服务器 IP</td>
</tr>
<tr>
<td><strong>目标端口</strong></td>
<td>443</td>
<td>HTTPS 服务（标准端口）</td>
</tr>
<tr>
<td><strong>协议</strong></td>
<td>TCP (6)</td>
<td>传输层协议（IP 协议号 6）</td>
</tr>
</tbody></table>
<p><strong>连接方向判断：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">客户端 → 服务器：</span><br><span class="line">└─ 源端口 &gt; 1024（动态端口）</span><br><span class="line">   目标端口 = 443（标准服务端口）</span><br><span class="line">   → 这是客户端发起的连接</span><br><span class="line"></span><br><span class="line">服务器 → 客户端的回复包：</span><br><span class="line">└─ 源端口 = 443</span><br><span class="line">   目标端口 = 54321</span><br><span class="line">   → 五元组相同（但源和目标交换）</span><br></pre></td></tr></table></figure>

<p><strong>五元组的唯一性：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">场景：同时访问多个 HTTPS 网站</span><br><span class="line"></span><br><span class="line">连接 1: (192.168.31.36:54321, 220.181.38.148:443, TCP) → 百度</span><br><span class="line">连接 2: (192.168.31.36:54322, 172.217.160.142:443, TCP) → Google</span><br><span class="line">连接 3: (192.168.31.36:54323, 220.181.38.148:443, TCP) → 百度新连接</span><br><span class="line"></span><br><span class="line">虽然有相同的源 IP、目标 IP、目标端口</span><br><span class="line">但源端口不同 → 五元组不同 → 不同的连接</span><br></pre></td></tr></table></figure>

<p><strong>在 Wireshark 中快速查看五元组：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">方法 1：查看包详情</span><br><span class="line">展开 IP 层 → 看源和目标 IP</span><br><span class="line">展开 TCP 层 → 看源和目标端口</span><br><span class="line"></span><br><span class="line">方法 2：使用统计功能</span><br><span class="line">Statistics → Conversations → TCP</span><br><span class="line">会列出所有 TCP 会话及其五元组信息</span><br><span class="line"></span><br><span class="line">方法 3：使用过滤器</span><br><span class="line">tcp.stream eq 0  # 查看第一个 TCP 流的所有包</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="📝-练习-3-分析异常-TCP-连接状态"><a href="#📝-练习-3-分析异常-TCP-连接状态" class="headerlink" title="📝 练习 3: 分析异常 TCP 连接状态"></a>📝 练习 3: 分析异常 TCP 连接状态</h3><p><strong>题目：</strong> 服务器上出现大量 CLOSE_WAIT 状态的连接，可能是什么原因？如何排查？</p>
<hr>
<p><strong>答案：</strong></p>
<p><strong>CLOSE_WAIT 状态说明：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">TCP 四次挥手中的状态：</span><br><span class="line">1. 客户端发送 FIN → 服务器收到</span><br><span class="line">2. 服务器回复 ACK → 进入 CLOSE_WAIT 状态 ⚠️</span><br><span class="line">3. 服务器应该发送 FIN → 完成关闭</span><br><span class="line">4. 但如果应用程序没有关闭 socket → 一直停留在 CLOSE_WAIT</span><br><span class="line"></span><br><span class="line">正常情况：CLOSE_WAIT 状态应该很快（几毫秒内）过渡到 LAST_ACK</span><br><span class="line">异常情况：大量连接长时间停留在 CLOSE_WAIT → 应用程序问题</span><br></pre></td></tr></table></figure>

<p><strong>可能的原因：</strong></p>
<p><strong>原因 1：应用程序未正确关闭 socket</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 错误的代码示例（Python）</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_client</span>(<span class="params">conn</span>):</span><br><span class="line">    data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">    process_data(data)</span><br><span class="line">    <span class="comment"># ❌ 忘记调用 conn.close()</span></span><br><span class="line">    <span class="comment"># 导致连接一直停留在 CLOSE_WAIT</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 正确的代码</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_client</span>(<span class="params">conn</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">        process_data(data)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        conn.close()  <span class="comment"># ✅ 确保关闭</span></span><br></pre></td></tr></table></figure>

<p><strong>原因 2：应用程序异常退出</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">场景：</span><br><span class="line">1. 客户端正常关闭连接（发送 FIN）</span><br><span class="line">2. 服务器接收到 FIN，回复 ACK（进入 CLOSE_WAIT）</span><br><span class="line">3. 应用程序处理数据时抛出异常</span><br><span class="line">4. 异常未被捕获，线程/进程崩溃</span><br><span class="line">5. socket 未被正确关闭 → CLOSE_WAIT 泄漏</span><br></pre></td></tr></table></figure>

<p><strong>原因 3：应用程序逻辑阻塞</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">场景：</span><br><span class="line">1. 客户端关闭连接</span><br><span class="line">2. 服务器进入 CLOSE_WAIT</span><br><span class="line">3. 应用程序正在执行长时间操作（数据库查询、文件 I/O）</span><br><span class="line">4. 应用程序尚未检测到连接关闭</span><br><span class="line">5. 长时间停留在 CLOSE_WAIT</span><br><span class="line"></span><br><span class="line">问题：缺少超时机制或定期检查连接状态</span><br></pre></td></tr></table></figure>

<p><strong>排查步骤：</strong></p>
<p><strong>步骤 1：查看 CLOSE_WAIT 数量</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Windows</span></span><br><span class="line"><span class="built_in">Get-NetTCPConnection</span> <span class="literal">-State</span> CloseWait | <span class="built_in">Measure-Object</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Linux</span></span><br><span class="line">netstat <span class="literal">-an</span> | grep CLOSE_WAIT | wc <span class="literal">-l</span></span><br></pre></td></tr></table></figure>

<p><strong>步骤 2：找出占用 CLOSE_WAIT 的进程</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Windows</span></span><br><span class="line"><span class="built_in">Get-NetTCPConnection</span> <span class="literal">-State</span> CloseWait |</span><br><span class="line">    <span class="built_in">Select-Object</span> LocalPort, RemoteAddress, RemotePort, OwningProcess |</span><br><span class="line">    <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">        <span class="variable">$_</span> | <span class="built_in">Add-Member</span> <span class="literal">-NotePropertyName</span> ProcessName <span class="literal">-NotePropertyValue</span> (<span class="built_in">Get-Process</span> <span class="literal">-Id</span> <span class="variable">$_</span>.OwningProcess).ProcessName <span class="literal">-PassThru</span></span><br><span class="line">    &#125; | <span class="built_in">Format-Table</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Linux</span></span><br><span class="line">netstat <span class="literal">-anp</span> | grep CLOSE_WAIT</span><br></pre></td></tr></table></figure>

<p><strong>步骤 3：检查应用程序日志</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查找：</span><br><span class="line">✅ 异常堆栈（未捕获的异常）</span><br><span class="line">✅ 连接关闭日志（是否存在）</span><br><span class="line">✅ 资源泄漏相关警告</span><br></pre></td></tr></table></figure>

<p><strong>步骤 4：使用 strace&#x2F;Process Monitor 跟踪</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Linux: 跟踪系统调用</span></span><br><span class="line">strace -p &lt;PID&gt; -e trace=close,shutdown</span><br><span class="line"></span><br><span class="line"><span class="comment"># Windows: 使用 Process Monitor</span></span><br><span class="line"><span class="comment"># 过滤 TCP Close 操作</span></span><br></pre></td></tr></table></figure>

<p><strong>解决方案：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">✅ 代码层面：</span><br><span class="line">   ├─ 使用 try-finally 确保 socket 关闭</span><br><span class="line">   ├─ 使用 with 语句（Python）或 using（C#）</span><br><span class="line">   ├─ 设置 socket 超时</span><br><span class="line">   └─ 捕获并处理所有异常</span><br><span class="line"></span><br><span class="line">✅ 架构层面：</span><br><span class="line">   ├─ 使用连接池管理连接</span><br><span class="line">   ├─ 实现心跳检测机制</span><br><span class="line">   ├─ 设置空闲连接超时</span><br><span class="line">   └─ 监控 CLOSE_WAIT 数量，告警</span><br><span class="line"></span><br><span class="line">✅ 系统层面（临时措施）：</span><br><span class="line">   ├─ 重启应用程序释放连接</span><br><span class="line">   ├─ 调整 TCP 参数（不推荐，治标不治本）</span><br><span class="line">   └─ 增加文件描述符限制</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="📝-练习-4-理解-TCP-序列号"><a href="#📝-练习-4-理解-TCP-序列号" class="headerlink" title="📝 练习 4: 理解 TCP 序列号"></a>📝 练习 4: 理解 TCP 序列号</h3><p><strong>题目：</strong> 三次握手时，客户端发送 SYN (Seq&#x3D;1000)，服务器回复 SYN-ACK (Seq&#x3D;2000, Ack&#x3D;1001)。客户端接下来应该发送什么？如果客户端要发送 100 字节数据，序列号如何变化？</p>
<hr>
<p><strong>答案：</strong></p>
<p><strong>第三次握手（客户端发送）：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">TCP 报文：</span><br><span class="line">├─ Flags: ACK = 1</span><br><span class="line">├─ Seq = 1001  ← 按服务器期望的序号</span><br><span class="line">├─ Ack = 2001  ← 服务器 Seq + 1</span><br><span class="line">└─ Data: 无（或者携带应用层数据）</span><br><span class="line"></span><br><span class="line">解释：</span><br><span class="line">服务器的 Ack=1001 表示&quot;期望收到 Seq=1001 的数据&quot;</span><br><span class="line">所以客户端下一个包的 Seq 必须是 1001</span><br></pre></td></tr></table></figure>

<p><strong>发送 100 字节数据后：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">数据包 1：</span><br><span class="line">├─ Seq = 1001</span><br><span class="line">├─ Ack = 2001</span><br><span class="line">├─ Data: 100 字节</span><br><span class="line">└─ 实际占用序列号：1001-1100</span><br><span class="line"></span><br><span class="line">服务器回复 ACK：</span><br><span class="line">├─ Seq = 2001（服务器还没发数据）</span><br><span class="line">├─ Ack = 1101  ← 1001 + 100 = 1101</span><br><span class="line">└─ 含义：&quot;我收到了 1001-1100，期望下一个是 1101&quot;</span><br><span class="line"></span><br><span class="line">客户端下一个包：</span><br><span class="line">├─ Seq = 1101  ← 必须从 1101 开始</span><br><span class="line">└─ ...</span><br></pre></td></tr></table></figure>

<p><strong>序列号计算规则：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">规则：</span><br><span class="line">1. 初始序列号（ISN）：SYN 包中协商</span><br><span class="line">2. 数据传输：Seq 增加 = 发送的字节数</span><br><span class="line">3. ACK 确认：Ack = 对方 Seq + 对方数据字节数</span><br><span class="line">4. SYN 和 FIN 各占用 1 个序列号（虽然不传输实际数据）</span><br><span class="line"></span><br><span class="line">示例流程：</span><br><span class="line">┌──────────────────────────────────────┐</span><br><span class="line">│ 客户端                  服务器        │</span><br><span class="line">├──────────────────────────────────────┤</span><br><span class="line">│ SYN (Seq=1000)      →                │</span><br><span class="line">│                     ← SYN-ACK        │</span><br><span class="line">│                       (Seq=2000,     │</span><br><span class="line">│                        Ack=1001)     │</span><br><span class="line">│ ACK (Seq=1001,      →                │</span><br><span class="line">│      Ack=2001)                       │</span><br><span class="line">│ ─────── 连接建立 ────────             │</span><br><span class="line">│ PSH,ACK (Seq=1001,  →                │</span><br><span class="line">│          Ack=2001,                   │</span><br><span class="line">│          Len=100)                    │</span><br><span class="line">│                     ← ACK            │</span><br><span class="line">│                       (Seq=2001,     │</span><br><span class="line">│                        Ack=1101)     │</span><br><span class="line">│ PSH,ACK (Seq=1101,  →                │</span><br><span class="line">│          Ack=2001,                   │</span><br><span class="line">│          Len=50)                     │</span><br><span class="line">│                     ← ACK            │</span><br><span class="line">│                       (Seq=2001,     │</span><br><span class="line">│                        Ack=1151)     │</span><br><span class="line">└──────────────────────────────────────┘</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">- SYN 占用 1 个序列号（1000 → 1001）</span><br><span class="line">- 100 字节数据占用 100 个序列号（1001 → 1101）</span><br><span class="line">- 50 字节数据占用 50 个序列号（1101 → 1151）</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="评估标准（达成判定）"><a href="#评估标准（达成判定）" class="headerlink" title="评估标准（达成判定）"></a>评估标准（达成判定）</h2><ul>
<li>✅ 能准确解释握手&#x2F;挥手报文字段及顺序</li>
<li>✅ 能清晰区分 TCP 与 UDP 的差异</li>
</ul>
<h2 id="学习成果达成情况"><a href="#学习成果达成情况" class="headerlink" title="学习成果达成情况"></a>学习成果达成情况</h2><h3 id="📊-实践任务完成记录"><a href="#📊-实践任务完成记录" class="headerlink" title="📊 实践任务完成记录"></a>📊 实践任务完成记录</h3><h4 id="任务-1-查看本机-TCP-连接状态-✅"><a href="#任务-1-查看本机-TCP-连接状态-✅" class="headerlink" title="任务 1: 查看本机 TCP 连接状态 ✅"></a><strong>任务 1: 查看本机 TCP 连接状态</strong> ✅</h4><p><strong>执行命令：</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-NetTCPConnection</span> | <span class="built_in">Group-Object</span> <span class="literal">-Property</span> State | <span class="built_in">Sort-Object</span> Count <span class="literal">-Descending</span></span><br></pre></td></tr></table></figure>

<p><strong>输出结果：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Count Name        说明</span><br><span class="line">----- ----        -----</span><br><span class="line">  290 Established  已建立的连接（正常数据传输）</span><br><span class="line">  226 Bound        绑定到本地地址但未连接</span><br><span class="line">  212 TimeWait     主动关闭方等待 2MSL</span><br><span class="line">   61 Listen       监听状态（服务器等待连接）</span><br><span class="line">   29 CloseWait    被动关闭方，等待应用程序关闭 ⚠️</span><br><span class="line">    2 SynSent      已发送 SYN，等待响应</span><br><span class="line">    1 FinWait1     已发送 FIN，等待 ACK</span><br></pre></td></tr></table></figure>

<p><strong>关键发现：</strong></p>
<ol>
<li><p><strong>Established (290 个)</strong> - 正常</p>
<ul>
<li>主要是本地进程间通信（127.0.0.1）</li>
<li>部分是与外网服务器的连接</li>
</ul>
</li>
<li><p><strong>TimeWait (212 个)</strong> - 正常</p>
<ul>
<li>主动关闭连接后的等待状态</li>
<li>说明系统频繁建立和关闭连接</li>
<li>这是正常现象，会在 2MSL 后自动清理</li>
</ul>
</li>
<li><p><strong>CloseWait (29 个)</strong> - 需要关注 ⚠️</p>
<ul>
<li>表示远程端已关闭连接</li>
<li>但本地应用程序尚未关闭 socket</li>
<li>如果数量持续增长，可能存在连接泄漏</li>
</ul>
</li>
</ol>
<p><strong>示例连接分析：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">五元组示例 1 (本地通信):</span><br><span class="line">├─ 源 IP: 127.0.0.1</span><br><span class="line">├─ 源端口: 64498</span><br><span class="line">├─ 目标 IP: 127.0.0.1</span><br><span class="line">├─ 目标端口: 64497</span><br><span class="line">├─ 协议: TCP</span><br><span class="line">└─ 状态: ESTABLISHED</span><br><span class="line"></span><br><span class="line">五元组示例 2 (外网连接):</span><br><span class="line">├─ 源 IP: 192.168.31.36 (本机)</span><br><span class="line">├─ 源端口: 63283</span><br><span class="line">├─ 目标 IP: 209.141.48.237 (外网服务器)</span><br><span class="line">├─ 目标端口: 443 (HTTPS)</span><br><span class="line">├─ 协议: TCP</span><br><span class="line">└─ 状态: ESTABLISHED</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="任务-2-使用-Wireshark-观察-TCP-三次握手-待完成"><a href="#任务-2-使用-Wireshark-观察-TCP-三次握手-待完成" class="headerlink" title="任务 2: 使用 Wireshark 观察 TCP 三次握手 (待完成)"></a><strong>任务 2: 使用 Wireshark 观察 TCP 三次握手</strong> (待完成)</h4><p><strong>步骤：</strong></p>
<ol>
<li>✅ 打开 Wireshark，选择网络接口</li>
<li>✅ 设置过滤器：<code>tcp.flags.syn==1 or tcp.flags.fin==1</code></li>
<li>✅ 访问网站：<code>curl http://example.com</code></li>
<li>✅ 停止抓包并分析</li>
</ol>
<p><strong>预期观察到：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">三次握手：</span><br><span class="line">1. [SYN] 客户端 → 服务器</span><br><span class="line">   ├─ Seq = X (初始序列号)</span><br><span class="line">   ├─ Ack = 0</span><br><span class="line">   └─ Flags: SYN</span><br><span class="line"></span><br><span class="line">2. [SYN, ACK] 服务器 → 客户端</span><br><span class="line">   ├─ Seq = Y (服务器初始序列号)</span><br><span class="line">   ├─ Ack = X + 1</span><br><span class="line">   └─ Flags: SYN, ACK</span><br><span class="line"></span><br><span class="line">3. [ACK] 客户端 → 服务器</span><br><span class="line">   ├─ Seq = X + 1</span><br><span class="line">   ├─ Ack = Y + 1</span><br><span class="line">   └─ Flags: ACK</span><br><span class="line"></span><br><span class="line">连接建立！双方进入 ESTABLISHED 状态</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="任务-3-使用-Wireshark-观察-TCP-四次挥手-待完成"><a href="#任务-3-使用-Wireshark-观察-TCP-四次挥手-待完成" class="headerlink" title="任务 3: 使用 Wireshark 观察 TCP 四次挥手 (待完成)"></a><strong>任务 3: 使用 Wireshark 观察 TCP 四次挥手</strong> (待完成)</h4><p><strong>预期观察到：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">四次挥手：</span><br><span class="line">1. [FIN, ACK] 客户端 → 服务器</span><br><span class="line">   ├─ Seq = M</span><br><span class="line">   ├─ Ack = N</span><br><span class="line">   └─ Flags: FIN, ACK</span><br><span class="line"></span><br><span class="line">2. [ACK] 服务器 → 客户端</span><br><span class="line">   ├─ Seq = N</span><br><span class="line">   ├─ Ack = M + 1</span><br><span class="line">   └─ Flags: ACK</span><br><span class="line"></span><br><span class="line">3. [FIN, ACK] 服务器 → 客户端</span><br><span class="line">   ├─ Seq = N</span><br><span class="line">   ├─ Ack = M + 1</span><br><span class="line">   └─ Flags: FIN, ACK</span><br><span class="line"></span><br><span class="line">4. [ACK] 客户端 → 服务器</span><br><span class="line">   ├─ Seq = M + 1</span><br><span class="line">   ├─ Ack = N + 1</span><br><span class="line">   └─ Flags: ACK</span><br><span class="line"></span><br><span class="line">连接关闭！</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="任务-4-UDP-流量对比-待完成"><a href="#任务-4-UDP-流量对比-待完成" class="headerlink" title="任务 4: UDP 流量对比 (待完成)"></a><strong>任务 4: UDP 流量对比</strong> (待完成)</h4><p><strong>DNS 查询示例：</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 Wireshark 中设置过滤器：dns</span></span><br><span class="line">nslookup baidu.com <span class="number">8.8</span>.<span class="number">8.8</span></span><br></pre></td></tr></table></figure>

<p><strong>预期对比：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">TCP 连接（访问网站）：</span><br><span class="line">├─ 三次握手：3 个包</span><br><span class="line">├─ 数据传输：N 个包（每个都有 ACK）</span><br><span class="line">├─ 四次挥手：4 个包</span><br><span class="line">└─ 总计：至少 7+ 个包</span><br><span class="line"></span><br><span class="line">UDP 查询（DNS）：</span><br><span class="line">├─ 查询请求：1 个包</span><br><span class="line">├─ 查询响应：1 个包</span><br><span class="line">└─ 总计：2 个包</span><br><span class="line"></span><br><span class="line">UDP 优势：</span><br><span class="line">✅ 无建立连接开销</span><br><span class="line">✅ 数据包少</span><br><span class="line">✅ 延迟低</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="💡-核心知识点掌握"><a href="#💡-核心知识点掌握" class="headerlink" title="💡 核心知识点掌握"></a>💡 核心知识点掌握</h3><h4 id="1-TCP-三次握手-✅"><a href="#1-TCP-三次握手-✅" class="headerlink" title="1. TCP 三次握手 ✅"></a><strong>1. TCP 三次握手</strong> ✅</h4><p><strong>为什么需要三次？</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">目的：</span><br><span class="line">✅ 确认双方收发能力</span><br><span class="line">✅ 协商初始序列号（ISN）</span><br><span class="line">✅ 协商 TCP 参数（窗口大小、MSS）</span><br><span class="line">✅ 防止旧连接请求导致的资源浪费</span><br><span class="line"></span><br><span class="line">两次握手的问题：</span><br><span class="line">❌ 无法防止旧的重复连接请求</span><br><span class="line">❌ 服务器无法确认客户端的接收能力</span><br><span class="line"></span><br><span class="line">四次握手：</span><br><span class="line">❌ 没有必要，三次已经足够</span><br></pre></td></tr></table></figure>

<p><strong>流程记忆口诀：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">客户端：&quot;你好，我想连接&quot; (SYN)</span><br><span class="line">服务器：&quot;好的，我也想连接&quot; (SYN-ACK)</span><br><span class="line">客户端：&quot;收到，开始吧&quot; (ACK)</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="2-TCP-四次挥手-✅"><a href="#2-TCP-四次挥手-✅" class="headerlink" title="2. TCP 四次挥手 ✅"></a><strong>2. TCP 四次挥手</strong> ✅</h4><p><strong>为什么需要四次？</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">原因：</span><br><span class="line">✅ TCP 是全双工通信</span><br><span class="line">✅ 每个方向需要独立关闭</span><br><span class="line">✅ 确保双方数据都发送完毕</span><br><span class="line"></span><br><span class="line">场景说明：</span><br><span class="line">1. 客户端：&quot;我没数据要发了&quot; (FIN)</span><br><span class="line">2. 服务器：&quot;知道了&quot; (ACK)</span><br><span class="line">   [服务器可能还有数据要发]</span><br><span class="line">3. 服务器：&quot;我也发完了&quot; (FIN)</span><br><span class="line">4. 客户端：&quot;知道了，再见&quot; (ACK)</span><br></pre></td></tr></table></figure>

<p><strong>为什么不能三次？</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">如果合并步骤 2 和 3：</span><br><span class="line">客户端发送 FIN 后，服务器可能还有数据要发送</span><br><span class="line">如果立即回复 FIN，就无法发送剩余数据</span><br><span class="line">所以需要先 ACK（我知道了），等发完数据再 FIN（我也关闭）</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="3-TIME-WAIT-状态的意义-✅"><a href="#3-TIME-WAIT-状态的意义-✅" class="headerlink" title="3. TIME_WAIT 状态的意义 ✅"></a><strong>3. TIME_WAIT 状态的意义</strong> ✅</h4><p><strong>为什么需要等待 2MSL？</strong></p>
<p><strong>原因 1：确保最后的 ACK 能到达</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">场景：</span><br><span class="line">1. 客户端发送最后的 ACK</span><br><span class="line">2. 如果 ACK 丢失</span><br><span class="line">3. 服务器超时重传 FIN</span><br><span class="line">4. 客户端需要在 TIME_WAIT 状态接收并重发 ACK</span><br><span class="line"></span><br><span class="line">如果没有 TIME_WAIT：</span><br><span class="line">客户端已关闭 → 收到服务器的 FIN 重传 → 发送 RST</span><br><span class="line">→ 服务器异常关闭</span><br></pre></td></tr></table></figure>

<p><strong>原因 2：防止旧连接干扰</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">场景：</span><br><span class="line">1. 连接关闭后，网络中可能还有延迟的旧数据包</span><br><span class="line">2. 如果立即使用相同的五元组建立新连接</span><br><span class="line">3. 旧数据包可能被新连接接收</span><br><span class="line">4. 导致数据混乱</span><br><span class="line"></span><br><span class="line">2MSL 确保：</span><br><span class="line">所有旧数据包都已消失（MSL = 30秒 或 2分钟）</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="4-TCP-vs-UDP-的选择-✅"><a href="#4-TCP-vs-UDP-的选择-✅" class="headerlink" title="4. TCP vs UDP 的选择 ✅"></a><strong>4. TCP vs UDP 的选择</strong> ✅</h4><p><strong>决策树：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">需要可靠传输？</span><br><span class="line">├─ 是 → 需要保证数据完整性？</span><br><span class="line">│   ├─ 是 → 使用 TCP ✅</span><br><span class="line">│   │   └─ 场景：文件传输、网页、邮件</span><br><span class="line">│   └─ 否 → 可以容忍少量丢失？</span><br><span class="line">│       ├─ 是 → 使用 UDP ✅</span><br><span class="line">│       │   └─ 场景：实时音视频、游戏</span><br><span class="line">│       └─ 否 → 使用 TCP</span><br><span class="line">└─ 否 → 实时性要求高？</span><br><span class="line">    ├─ 是 → 使用 UDP ✅</span><br><span class="line">    │   └─ 场景：DNS、NTP、DHCP</span><br><span class="line">    └─ 否 → 根据其他因素决定</span><br></pre></td></tr></table></figure>

<p><strong>快速判断表：</strong></p>
<table>
<thead>
<tr>
<th>需求</th>
<th>选择</th>
<th>典型应用</th>
</tr>
</thead>
<tbody><tr>
<td>文件必须完整</td>
<td>TCP</td>
<td>HTTP 下载、FTP</td>
</tr>
<tr>
<td>网页必须完整显示</td>
<td>TCP</td>
<td>HTTPS、HTTP</td>
</tr>
<tr>
<td>邮件不能丢失</td>
<td>TCP</td>
<td>SMTP、POP3、IMAP</td>
</tr>
<tr>
<td>视频通话（实时）</td>
<td>UDP</td>
<td>Zoom、微信视频</td>
</tr>
<tr>
<td>游戏（低延迟）</td>
<td>UDP</td>
<td>在线游戏</td>
</tr>
<tr>
<td>快速查询</td>
<td>UDP</td>
<td>DNS、NTP</td>
</tr>
<tr>
<td>直播（实时）</td>
<td>UDP</td>
<td>RTMP、HLS</td>
</tr>
</tbody></table>
<hr>
<h4 id="5-五元组的作用-✅"><a href="#5-五元组的作用-✅" class="headerlink" title="5. 五元组的作用 ✅"></a><strong>5. 五元组的作用</strong> ✅</h4><p><strong>唯一标识一个连接：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">五元组 = (源IP, 源端口, 目标IP, 目标端口, 协议)</span><br><span class="line"></span><br><span class="line">系统如何区分多个连接：</span><br><span class="line">场景：同时访问 10 个网站，都是 HTTPS (443)</span><br><span class="line"></span><br><span class="line">连接 1: (192.168.31.36, 54321, IP1, 443, TCP)</span><br><span class="line">连接 2: (192.168.31.36, 54322, IP2, 443, TCP)</span><br><span class="line">连接 3: (192.168.31.36, 54323, IP3, 443, TCP)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">虽然源IP、目标端口、协议都相同</span><br><span class="line">但源端口不同 → 五元组不同 → 不同的连接</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="🔍-实践收获与反思"><a href="#🔍-实践收获与反思" class="headerlink" title="🔍 实践收获与反思"></a>🔍 实践收获与反思</h3><p><strong>关键理解：</strong></p>
<ol>
<li><p><strong>TCP 的可靠性是有代价的</strong></p>
<ul>
<li>三次握手增加延迟（1.5 RTT）</li>
<li>每个数据包都需要确认</li>
<li>重传机制增加延迟</li>
<li>适合文件传输、网页等不能出错的场景</li>
</ul>
</li>
<li><p><strong>UDP 的”不可靠”是设计选择</strong></p>
<ul>
<li>不是缺陷，而是为了性能</li>
<li>应用层可以选择性实现可靠性（如 QUIC）</li>
<li>适合实时通信、快速查询等场景</li>
</ul>
</li>
<li><p><strong>TIME_WAIT 不是问题，而是保护</strong></p>
<ul>
<li>确保连接安全关闭</li>
<li>防止旧数据干扰新连接</li>
<li>大量 TIME_WAIT 说明连接频繁（可以优化，但不一定是问题）</li>
</ul>
</li>
<li><p><strong>CLOSE_WAIT 才需要关注</strong></p>
<ul>
<li>表示应用程序没有正确关闭连接</li>
<li>可能导致连接泄漏</li>
<li>需要检查代码逻辑</li>
</ul>
</li>
</ol>
<hr>
<h3 id="📖-与前几天学习的联系"><a href="#📖-与前几天学习的联系" class="headerlink" title="📖 与前几天学习的联系"></a>📖 与前几天学习的联系</h3><p><strong>Day001: OSI 模型</strong></p>
<ul>
<li>✅ TCP&#x2F;UDP 工作在传输层（第 4 层）</li>
<li>✅ 负责端到端的数据传输</li>
</ul>
<p><strong>Day002: MAC 与 ARP</strong></p>
<ul>
<li>✅ 数据链路层使用 MAC 地址</li>
<li>✅ ARP 将 IP 映射到 MAC</li>
<li>✅ TCP 包最终封装在以太网帧中传输</li>
</ul>
<p><strong>Day003: IP 与路由</strong></p>
<ul>
<li>✅ 网络层的 IP 负责寻址和路由</li>
<li>✅ TCP 依赖 IP 层传输数据</li>
<li>✅ 五元组中的 IP 地址来自网络层</li>
</ul>
<p><strong>协议栈协作：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">应用层：HTTP/HTTPS 请求</span><br><span class="line">    ↓</span><br><span class="line">传输层：TCP 三次握手 + 可靠传输 ← 本次学习</span><br><span class="line">    ├─ 端口号识别应用</span><br><span class="line">    ├─ 序列号保证顺序</span><br><span class="line">    └─ 确认号保证可靠</span><br><span class="line">    ↓</span><br><span class="line">网络层：IP 路由选择 (Day003)</span><br><span class="line">    ├─ 查路由表</span><br><span class="line">    └─ 确定下一跳</span><br><span class="line">    ↓</span><br><span class="line">数据链路层：ARP + MAC 地址 (Day002)</span><br><span class="line">    ├─ ARP 获取 MAC</span><br><span class="line">    └─ 封装以太网帧</span><br><span class="line">    ↓</span><br><span class="line">物理层：电信号传输</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="🎓-学习成果评估"><a href="#🎓-学习成果评估" class="headerlink" title="🎓 学习成果评估"></a>🎓 学习成果评估</h3><table>
<thead>
<tr>
<th>评估标准</th>
<th>达成情况</th>
<th>证据</th>
</tr>
</thead>
<tbody><tr>
<td><strong>能准确解释三次握手</strong></td>
<td>✅ 达成</td>
<td>理解了 SYN、SYN-ACK、ACK 的作用和顺序</td>
</tr>
<tr>
<td><strong>能准确解释四次挥手</strong></td>
<td>✅ 达成</td>
<td>理解了全双工关闭和 TIME_WAIT 的必要性</td>
</tr>
<tr>
<td><strong>能区分 TCP 与 UDP</strong></td>
<td>✅ 达成</td>
<td>掌握了两者的特点和适用场景</td>
</tr>
<tr>
<td><strong>能提取五元组</strong></td>
<td>✅ 达成</td>
<td>能从抓包中识别连接的五元组</td>
</tr>
<tr>
<td><strong>理解 TCP 状态机</strong></td>
<td>✅ 达成</td>
<td>能解释各种 TCP 状态的含义</td>
</tr>
<tr>
<td><strong>能分析异常连接</strong></td>
<td>✅ 达成</td>
<td>能判断 CLOSE_WAIT 等异常状态的原因</td>
</tr>
</tbody></table>
<hr>
<p><strong>学习日期：</strong> 2025-12-26<br><strong>完成时间：</strong> ⏰ 约 3 小时<br><strong>学习效果：</strong> ⭐⭐⭐⭐⭐ (5&#x2F;5)</p>
<p><strong>下一步计划：</strong></p>
<ul>
<li>📝 Day005: 深入 HTTP&#x2F;HTTPS 协议</li>
<li>🔍 使用 Wireshark 实际抓包验证三次握手和四次挥手</li>
<li>💻 编写简单的 TCP 客户端和服务器程序（Python&#x2F;C#）</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.jpg" alt="Tigercoll 微信">
        <span>微信</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag"># 网络</a>
              <a href="/tags/%E5%AE%89%E5%85%A8/" rel="tag"># 安全</a>
              <a href="/tags/%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/" rel="tag"># 学习计划</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/eb37acc3.html" rel="prev" title="Day003：网络与协议基础 - IP、ICMP 与路由基础">
                  <i class="fa fa-chevron-left"></i> Day003：网络与协议基础 - IP、ICMP 与路由基础
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/c822c636.html" rel="next" title="Day005：网络与协议基础 - DNS 工作流">
                  Day005：网络与协议基础 - DNS 工作流 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="lv-container" data-id="city" data-uid="MTAyMC8zNDY4NC8xMTIyMQ=="></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2026</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tigercoll</span>
</div>
<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("04/21/2019 15:54:40");//此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "等待与你相遇的 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>
<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>
-->

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  




<script src="/js/third-party/comments/livere.js"></script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true,"react":{"opacity":0.7}}});</script></body>
</html>
