[{"title":"jenkins自动部署hexo","url":"/post/280160.html","content":"<p>Hexo 是一个快速、简洁且高效的博客框架。Hexo 使用 <a href=\"http://daringfireball.net/projects/markdown/\">Markdown</a>（或其他渲染引擎）解析文章，在几秒内，即可利用靓丽的主题生成静态网页。我们可以利用jenkins来自动部署hexo.关于jenkins的安装,可以去查看我的另一篇文章—-jenkins<a href=\"https://tigercoll.top/post/ee6ba771.html#more\">安装教程</a></p>\n<span id=\"more\"></span>\n\n<p>hexo需要安装nodejs,</p>\n<h2 id=\"nodejs安装\"><a href=\"#nodejs安装\" class=\"headerlink\" title=\"nodejs安装\"></a>nodejs安装</h2><p>进入Node最新版下载 &lt;<a href=\"https://nodejs.org/en/download/current/\">https://nodejs.org/en/download/current/</a></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 下载nodejs</span></span><br><span class=\"line\">wget -O /home/node.tar.xz https://nodejs.org/dist/v16.17.0/node-v16.17.0-linux-x64.tar.xz</span><br><span class=\"line\"><span class=\"comment\"># 解压</span></span><br><span class=\"line\">tar -xvf  /home/node.tar.xz -C /home</span><br><span class=\"line\"><span class=\"comment\"># 进入目录</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /home/node-v16.17.0-linux-x64/bin/</span><br><span class=\"line\"><span class=\"comment\"># 测试是否成功</span></span><br><span class=\"line\">./node -v</span><br><span class=\"line\"><span class=\"comment\"># 加软连接</span></span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s /home/node-v16.17.0-linux-x64/bin/node /usr/local/bin/node</span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s /home/node-v16.17.0-linux-x64/bin/npm /usr/local/bin/npm</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"安装hexo\"><a href=\"#安装hexo\" class=\"headerlink\" title=\"安装hexo\"></a>安装hexo</h2><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install hexo-cli -g</span><br></pre></td></tr></table></figure>\n\n<p>如果提示找不到hexo命令 </p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看npm包的路径</span></span><br><span class=\"line\">npm root -g</span><br><span class=\"line\"><span class=\"comment\"># 添加软链接</span></span><br><span class=\"line\"><span class=\"built_in\">ln</span> -s /home/node-v16.17.0-linux-x64/lib/node_modules/hexo/bin/hexo /usr/local/bin/hexo</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"配置jenkins\"><a href=\"#配置jenkins\" class=\"headerlink\" title=\"配置jenkins\"></a>配置jenkins</h2><h3 id=\"新建任务\"><a href=\"#新建任务\" class=\"headerlink\" title=\"新建任务\"></a>新建任务</h3><p><img data-src=\"/../images/2022-09-21-jenkins%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hexo/image-20220927143528858.png\" alt=\"image-20220927143528858\"></p>\n<h3 id=\"添加源码管理\"><a href=\"#添加源码管理\" class=\"headerlink\" title=\"添加源码管理\"></a>添加源码管理</h3><p><img data-src=\"/../images/2022-09-21-jenkins%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hexo/image-20220927143853025.png\" alt=\"image-20220927143853025\"></p>\n<h3 id=\"添加凭证\"><a href=\"#添加凭证\" class=\"headerlink\" title=\"添加凭证\"></a>添加凭证</h3><p><img data-src=\"/../images/2022-09-21-jenkins%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hexo/image-20220927143941441.png\" alt=\"image-20220927143941441\"></p>\n<h3 id=\"添加私钥\"><a href=\"#添加私钥\" class=\"headerlink\" title=\"添加私钥\"></a>添加私钥</h3><p>使用<code>ssh-kengen</code>生成ssh密钥对</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa -C <span class=\"string\">&#x27;your email&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>然后将ssh密钥对复制到jenkins目录下</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cp</span>  ~/.ssh/id_rsa ~/.ssh/id_rsa.pub /var/lib/jenkins/.ssh/</span><br></pre></td></tr></table></figure>\n\n<p>将私钥id_rsa复制到jenkins下面</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cat</span>  ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/2022-09-21-jenkins%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hexo/image-20220927144441833.png\" alt=\"image-20220927144441833\"></p>\n<h3 id=\"添加公钥\"><a href=\"#添加公钥\" class=\"headerlink\" title=\"添加公钥\"></a>添加公钥</h3><p>将公钥复制到github下</p>\n<p><img data-src=\"/../images/2022-09-21-jenkins%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hexo/image-20220927144519632.png\" alt=\"image-20220927144519632\"></p>\n<p><img data-src=\"/../images/2022-09-21-jenkins%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hexo/image-20220927144600645.png\" alt=\"image-20220927144600645\"></p>\n<p>没错等你添加完后会报错</p>\n<p><img data-src=\"/../images/2022-09-21-jenkins%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hexo/image-20220927144706745.png\" alt=\"image-20220927144706745\"></p>\n<p>当然确保你jenkins的机器安装了git</p>\n<p>只需要在jenkins的设备上运行一下</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">git ls-remote -h git@github.com:Tigercoll/hexo.git HEAD</span><br></pre></td></tr></table></figure>\n\n<p>然后将ssh下的 <code>known_hosts</code>文件放到jenkins的ssh目录下即可</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cp</span> ~/.ssh/known_hosts /var/lib/jenkins/.ssh/</span><br></pre></td></tr></table></figure>\n\n<p>直接保存再进去即可</p>\n<h3 id=\"更改分支\"><a href=\"#更改分支\" class=\"headerlink\" title=\"更改分支\"></a>更改分支</h3><p><img data-src=\"/../images/2022-09-21-jenkins%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hexo/image-20220927145201769.png\" alt=\"image-20220927145201769\"></p>\n<h3 id=\"配置Github-webhooks\"><a href=\"#配置Github-webhooks\" class=\"headerlink\" title=\"配置Github webhooks\"></a>配置Github webhooks</h3><h4 id=\"在对项目有写权限的用户上获取token\"><a href=\"#在对项目有写权限的用户上获取token\" class=\"headerlink\" title=\"在对项目有写权限的用户上获取token\"></a>在对项目有写权限的用户上获取token</h4><p>进入github –&gt; setting –&gt;Developer settings –&gt; Personal Access Token –&gt; Generate new token</p>\n<p><img data-src=\"/../images/2022-09-21-jenkins%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hexo/jenkins-1.png\" alt=\"img\"></p>\n<p>点击保存，获取token,并<strong>保存好你的token</strong></p>\n<h4 id=\"设置webhooks\"><a href=\"#设置webhooks\" class=\"headerlink\" title=\"设置webhooks\"></a>设置webhooks</h4><p>进入GitHub上指定的项目 –&gt; setting –&gt; WebHooks&amp;Services –&gt; add webhook –&gt; 输入刚刚部署jenkins的服务器的IP</p>\n<p><img data-src=\"/../images/2022-09-21-jenkins%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hexo/jenkins-2.png\" alt=\"img\"></p>\n<h3 id=\"配置Jenkins的Git-Plugin\"><a href=\"#配置Jenkins的Git-Plugin\" class=\"headerlink\" title=\"配置Jenkins的Git Plugin\"></a>配置Jenkins的Git Plugin</h3><p>新版Jenkins在初始的时候已经默认安装了Git Plugin和相关依赖的Plugin，我们不用在重复进行安装，直接配置即可</p>\n<p>系统管理 –&gt; 系统设置 –&gt; GitHub –&gt; Add GitHub Sever</p>\n<p>填写API URL为<a href=\"https://api.github.com/\">https://api.github.com</a></p>\n<p><img data-src=\"/../images/2022-09-21-jenkins%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hexo/jenkins-3.png\" alt=\"img\"></p>\n<p>点击旁边的Add按钮, 添加Secret Text</p>\n<p><img data-src=\"/../images/2022-09-21-jenkins%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hexo/jenkins-4.png\" alt=\"img\"></p>\n<h3 id=\"构建触发器，构建环境\"><a href=\"#构建触发器，构建环境\" class=\"headerlink\" title=\"构建触发器，构建环境\"></a>构建触发器，构建环境</h3><p><img data-src=\"/../images/2022-09-21-jenkins%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hexo/jenkins-7.png\" alt=\"img\"></p>\n<h3 id=\"编写你的构建脚本\"><a href=\"#编写你的构建脚本\" class=\"headerlink\" title=\"编写你的构建脚本\"></a>编写你的构建脚本</h3><p><img data-src=\"/../images/2022-09-21-jenkins%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2hexo/image-20220927154407373.png\" alt=\"image-20220927154407373\"></p>\n<h2 id=\"报错\"><a href=\"#报错\" class=\"headerlink\" title=\"报错\"></a>报错</h2><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">jenkins 构建提示 Error: EACCES: permission denied</span><br></pre></td></tr></table></figure>\n\n<p>添加权限</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">chown</span> -R jenkins:jenkins /var/lib/jenkins/</span><br></pre></td></tr></table></figure>\n\n<p>第一次构建项目也会报错,需要在jenkins本机workspace目录下运行一次</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">Hexo Cannot find module <span class=\"string\">&#x27;./build/Release/DTraceProviderBindings&#x27;</span> 错误</span><br></pre></td></tr></table></figure>\n\n<p>重新构建hexo</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install hexo --no-optional</span><br></pre></td></tr></table></figure>\n\n<p>当然你可以直接在jenkins中添加</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo g -d || npm install hexo --no-optional &amp;&amp; hexo g -d</span><br></pre></td></tr></table></figure>\n","categories":["jenkins自动化"],"tags":["jenkins","hexo"]},{"title":"3 个月网络安全路线图","url":"/post/a91d5572.html","content":"<h1 id=\"3-个月网络安全路线图（按周主题-每日链接）\"><a href=\"#3-个月网络安全路线图（按周主题-每日链接）\" class=\"headerlink\" title=\"3 个月网络安全路线图（按周主题 + 每日链接）\"></a>3 个月网络安全路线图（按周主题 + 每日链接）</h1><p>起始日期可根据需要调整，默认从生成脚本的开始日期起算（Day001 ~ Day090）。每天的详细卡片见 <code>daily/DayXXX.md</code>。</p>\n<blockquote>\n<p>学习结构：目标 → 内容 → 实践 → 巩固 → 评估 → 达成记录（每日自评与证据）</p>\n</blockquote>\n<span id=\"more\"></span>\n\n<h2 id=\"第-1-周：网络与协议基础，抓包入门（Day001-Day007）\"><a href=\"#第-1-周：网络与协议基础，抓包入门（Day001-Day007）\" class=\"headerlink\" title=\"第 1 周：网络与协议基础，抓包入门（Day001 ~ Day007）\"></a>第 1 周：网络与协议基础，抓包入门（Day001 ~ Day007）</h2><ul>\n<li>目标：理解 OSI&#x2F;TCP-IP、常见协议工作原理；能用 Wireshark 抓包并分析基本流量</li>\n<li>每日：<ul>\n<li>Day001：计算机网络总览、OSI 七层模型与 TCP&#x2F;IP 四层模型；术语与路径</li>\n<li>Day002：以太网、MAC、ARP；广播与交换机行为；ARP 欺骗概念（仅理论）</li>\n<li>Day003：IP、ICMP、路由与子网；Ping&#x2F;Traceroute 分析</li>\n<li>Day004：TCP 三次握手与四次挥手、UDP；端口与会话</li>\n<li>Day005：DNS 工作流与常见记录类型；抓包分析 DNS 查询</li>\n<li>Day006：HTTP 协议基础、请求&#x2F;响应头；抓包看明文 HTTP</li>\n<li>Day007：Wireshark 安装与过滤器，实践分析综合流量；周小测与复盘</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"第-2-周：安全协议与加密入门（Day008-Day014）\"><a href=\"#第-2-周：安全协议与加密入门（Day008-Day014）\" class=\"headerlink\" title=\"第 2 周：安全协议与加密入门（Day008 ~ Day014）\"></a>第 2 周：安全协议与加密入门（Day008 ~ Day014）</h2><ul>\n<li>目标：理解 HTTPS&#x2F;TLS、证书链与握手；SSH、SFTP 基础；对称&#x2F;非对称加密与哈希</li>\n<li>每日：<ul>\n<li>Day008：TLS 基本概念、握手流程与密码套件</li>\n<li>Day009：证书、CA、链验证；OpenSSL 基本命令</li>\n<li>Day010：HTTPS 抓包与密文定位；HSTS 与中间人攻击（仅理论）</li>\n<li>Day011：SSH 工作原理、密钥认证；安全配置建议</li>\n<li>Day012：加密基础：对称 vs 非对称、哈希与签名；常见算法与用途</li>\n<li>Day013：密码学在安全工程中的应用场景（安全传输、存储、认证）</li>\n<li>Day014：周综合实验与测评：TLS&#x2F;SSH&#x2F;加密基础</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"第-3-周：操作系统与脚本、服务枚举（Day015-Day021）\"><a href=\"#第-3-周：操作系统与脚本、服务枚举（Day015-Day021）\" class=\"headerlink\" title=\"第 3 周：操作系统与脚本、服务枚举（Day015 ~ Day021）\"></a>第 3 周：操作系统与脚本、服务枚举（Day015 ~ Day021）</h2><ul>\n<li>目标：Linux&#x2F;Windows 安全基础；Shell &amp; Python 脚本；Nmap 端口与服务识别</li>\n<li>每日：<ul>\n<li>Day015：Linux 用户&#x2F;权限、进程&#x2F;服务；基础加固</li>\n<li>Day016：Windows 用户&#x2F;域基础、事件查看器；常见审计点</li>\n<li>Day017：Shell 脚本入门，批量命令与日志处理</li>\n<li>Day018：Python 脚本入门，文本与网络请求</li>\n<li>Day019：Nmap 端口扫描方式与参数；安全使用原则</li>\n<li>Day020：服务枚举与版本识别；脚本化批量扫描输出</li>\n<li>Day021：周综合实验与测评：OS + 枚举 + 脚本</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"第-4-周：漏洞扫描、基线与加固（Day022-Day028）\"><a href=\"#第-4-周：漏洞扫描、基线与加固（Day022-Day028）\" class=\"headerlink\" title=\"第 4 周：漏洞扫描、基线与加固（Day022 ~ Day028）\"></a>第 4 周：漏洞扫描、基线与加固（Day022 ~ Day028）</h2><ul>\n<li>目标：理解漏洞扫描器原理与使用；系统与中间件基线检查；安全加固动作落地</li>\n<li>每日：<ul>\n<li>Day022：漏洞类型总览与常见编号（CVE&#x2F;CWE&#x2F;CVSS）</li>\n<li>Day023：漏洞扫描器（合规用途）安装与配置，报告解读</li>\n<li>Day024：系统基线项与审计；弱口令与配置风险识别</li>\n<li>Day025：Web 中间件与常见暴露面；安全加固建议</li>\n<li>Day026：自动化基线检查脚本与导出报告</li>\n<li>Day027：加固后复验与对比；形成变更记录</li>\n<li>Day028：周综合实验与测评：扫描 + 基线 + 加固</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"第-5-周：日志、可观测性、SIEM-入门（Day029-Day035）\"><a href=\"#第-5-周：日志、可观测性、SIEM-入门（Day029-Day035）\" class=\"headerlink\" title=\"第 5 周：日志、可观测性、SIEM 入门（Day029 ~ Day035）\"></a>第 5 周：日志、可观测性、SIEM 入门（Day029 ~ Day035）</h2><ul>\n<li>目标：知道采集&#x2F;传输&#x2F;存储&#x2F;查询链路；能搭建基础日志采集与简单告警；理解 SIEM 的作用</li>\n<li>每日：<ul>\n<li>Day029：日志与事件的类型、常见字段与合规要求</li>\n<li>Day030：收集与传输：Syslog&#x2F;Filebeat 等入门</li>\n<li>Day031：存储与查询：Elastic&#x2F;OpenSearch 概览</li>\n<li>Day032：可视化与仪表盘；基础告警策略</li>\n<li>Day033：日志规范与字段统一；落地清单</li>\n<li>Day034：事件响应初步：从日志到初步推理</li>\n<li>Day035：周综合实验与测评：日志链路 + 告警</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"第-6-周：Web-安全（OWASP-Top-10）（Day036-Day042）\"><a href=\"#第-6-周：Web-安全（OWASP-Top-10）（Day036-Day042）\" class=\"headerlink\" title=\"第 6 周：Web 安全（OWASP Top 10）（Day036 ~ Day042）\"></a>第 6 周：Web 安全（OWASP Top 10）（Day036 ~ Day042）</h2><ul>\n<li>目标：掌握常见 Web 风险与防护思路；在授权靶场内进行验证</li>\n<li>每日：<ul>\n<li>Day036：OWASP 概览与威胁建模基础</li>\n<li>Day037：身份认证与会话安全；CSRF 基础</li>\n<li>Day038：输入校验与注入风险（SQLi&#x2F;XSS）理论与靶场演示</li>\n<li>Day039：文件上传与路径穿越；配置类风险</li>\n<li>Day040：API 安全基础；速率限制与鉴权策略</li>\n<li>Day041：错误处理与日志；WAF 的作用与边界</li>\n<li>Day042：周综合实验与测评：Top 10 选题验证</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"第-7-周：网络防护与设备（Day043-Day049）\"><a href=\"#第-7-周：网络防护与设备（Day043-Day049）\" class=\"headerlink\" title=\"第 7 周：网络防护与设备（Day043 ~ Day049）\"></a>第 7 周：网络防护与设备（Day043 ~ Day049）</h2><ul>\n<li>目标：理解防火墙&#x2F;IDS&#x2F;IPS 的基本工作原理与部署要点；网络分段与零信任初步</li>\n<li>每日：<ul>\n<li>Day043：防火墙类型与规则设计；最小权限原则</li>\n<li>Day044：IDS&#x2F;IPS 基本原理与告警分析</li>\n<li>Day045：网络分段与访问控制；零信任理念</li>\n<li>Day046：VPN 与远程接入安全；隧道与加密</li>\n<li>Day047：边界与内部防护配合；常见误区</li>\n<li>Day048：综合策略编排与变更流程</li>\n<li>Day049：周综合实验与测评：网络防护</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"第-8-周：渗透测试方法论与合规（Day050-Day056）\"><a href=\"#第-8-周：渗透测试方法论与合规（Day050-Day056）\" class=\"headerlink\" title=\"第 8 周：渗透测试方法论与合规（Day050 ~ Day056）\"></a>第 8 周：渗透测试方法论与合规（Day050 ~ Day056）</h2><ul>\n<li>目标：渗透测试全流程（授权前提）；合规、范围、报告与证据管理</li>\n<li>每日：<ul>\n<li>Day050：方法论与流程：信息收集、攻击面、验证、复现</li>\n<li>Day051：合法授权与边界；靶场搭建</li>\n<li>Day052：工具链（仅靶场）：枚举、字典、弱口令（合规）</li>\n<li>Day053：验证与复现记录；截图与日志</li>\n<li>Day054：报告撰写结构与评分参考（CVSS）</li>\n<li>Day055：复测与修复跟踪；沟通要点</li>\n<li>Day056：周综合实验与测评：渗测方法论</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"第-9-周：内网与横向基础（Day057-Day063）\"><a href=\"#第-9-周：内网与横向基础（Day057-Day063）\" class=\"headerlink\" title=\"第 9 周：内网与横向基础（Day057 ~ Day063）\"></a>第 9 周：内网与横向基础（Day057 ~ Day063）</h2><ul>\n<li>目标：认识内网的身份、权限与横向的风险；仅限自建实验环境与授权范围</li>\n<li>每日：<ul>\n<li>Day057：AD&#x2F;域基础与常见风险面</li>\n<li>Day058：凭据与会话；最小化暴露</li>\n<li>Day059：横向的常见手段（理论），只做模拟验证</li>\n<li>Day060：日志追踪与证据链构建</li>\n<li>Day061：加固与策略优化</li>\n<li>Day062：蓝队视角：检测与处置</li>\n<li>Day063：周综合实验与测评：内网基础</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"第-10-周：云与容器安全概览（Day064-Day070）\"><a href=\"#第-10-周：云与容器安全概览（Day064-Day070）\" class=\"headerlink\" title=\"第 10 周：云与容器安全概览（Day064 ~ Day070）\"></a>第 10 周：云与容器安全概览（Day064 ~ Day070）</h2><ul>\n<li>目标：理解 IaaS&#x2F;PaaS&#x2F;SaaS 风险与控制；容器与镜像、注册表与运行时安全</li>\n<li>每日：<ul>\n<li>Day064：云共享责任模型；账号与权限</li>\n<li>Day065：网络与存储安全；密钥与配置管理</li>\n<li>Day066：容器基础与镜像安全；最小镜像原则</li>\n<li>Day067：K8s 初步：RBAC 与网络策略</li>\n<li>Day068：云审计与告警；合规参考</li>\n<li>Day069：云与容器的攻防边界与最佳实践</li>\n<li>Day070：周综合实验与测评：云&#x2F;容器</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"第-11-周：事件响应与取证基础（Day071-Day077）\"><a href=\"#第-11-周：事件响应与取证基础（Day071-Day077）\" class=\"headerlink\" title=\"第 11 周：事件响应与取证基础（Day071 ~ Day077）\"></a>第 11 周：事件响应与取证基础（Day071 ~ Day077）</h2><ul>\n<li>目标：响应流程、证据采集与链条、初步分析与报告</li>\n<li>每日：<ul>\n<li>Day071：响应流程与分级；准备与演练</li>\n<li>Day072：主机取证基础：镜像、时间线、关键证据</li>\n<li>Day073：网络取证基础：流量与会话复原</li>\n<li>Day074：日志与告警的证据化</li>\n<li>Day075：初步分析与结论；报告结构</li>\n<li>Day076：演练与复盘；改进清单</li>\n<li>Day077：周综合实验与测评：响应&#x2F;取证</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"第-12-周：综合实战与作品集（Day078-Day084）\"><a href=\"#第-12-周：综合实战与作品集（Day078-Day084）\" class=\"headerlink\" title=\"第 12 周：综合实战与作品集（Day078 ~ Day084）\"></a>第 12 周：综合实战与作品集（Day078 ~ Day084）</h2><ul>\n<li>目标：选定综合课题（合法授权&#x2F;靶场），完成从信息收集到报告的闭环与作品集</li>\n<li>每日：<ul>\n<li>Day078：选题与范围界定；目标与度量</li>\n<li>Day079：执行与记录：过程证据链</li>\n<li>Day080：报告撰写与复现核验</li>\n<li>Day081：改进与加固建议整理</li>\n<li>Day082：作品集组装与展示准备</li>\n<li>Day083：演示彩排与反馈收集</li>\n<li>Day084：周综合评审：作品集与展示</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"第-13-周：查缺补漏与冲刺（Day085-Day090）\"><a href=\"#第-13-周：查缺补漏与冲刺（Day085-Day090）\" class=\"headerlink\" title=\"第 13 周：查缺补漏与冲刺（Day085 ~ Day090）\"></a>第 13 周：查缺补漏与冲刺（Day085 ~ Day090）</h2><ul>\n<li>目标：补齐短板、完善笔记与脚本库、整理题库与错题本，最终总测评</li>\n<li>每日：<ul>\n<li>Day085：复盘网络与协议；题库巩固</li>\n<li>Day086：复盘 Web 与漏洞；题库巩固</li>\n<li>Day087：复盘日志&#x2F;防护&#x2F;响应；题库巩固</li>\n<li>Day088：模拟综合场景演练；计时与记录</li>\n<li>Day089：最终报告与作品集完善</li>\n<li>Day090：总测评与未来计划：进一步认证与专项深造</li>\n</ul>\n</li>\n</ul>\n<hr>\n<ul>\n<li>每天的详细内容请查看对应的 <code>daily/DayXXX.md</code>，包含：目标、内容、实践、巩固、评估标准，以及“学习成果达成情况”的填写位。</li>\n<li>所有实践仅在合法授权与自建靶场范围内进行，严禁对未授权的互联网上目标开展任何扫描与攻击。</li>\n</ul>\n","categories":["网络安全学习"],"tags":["网络","安全","学习"]},{"title":"jenkins安装","url":"/post/ee6ba771.html","content":"<p>Jenkins是开源软件项目，基于Java开发的持续集成工具，用于监控持续重复的工作，旨在提供一个开放易用的软件平台，使软件的持续集成变成可能。</p>\n<p><strong>Jenkins的功能</strong></p>\n<p>Jenkins的主要功能是将项目中重复执行的工作自动化的执行。如软件的建造（构建）和在配置文件下设置的job。具体功能大概有：</p>\n<p>1.软件的持续构建和测试，Jenkins提供了一个系统，使开发人员可以很容易的将改变集成到工程中。自动化的，持续的构建有利于提高开发效率。</p>\n<p>2.监视job的执行，如下图所示，job可以实现很多的功能，Jenkins可以对这些项目进行显示，让用户更清楚的注意到这些损毁的job。（具体情况后文中介绍）</p>\n<p>3.项目源代码修改的检测，jenkins能够从项目的Subversion&#x2F;CVS生成最近修改的集合列表，且不会增加Subversion&#x2F;CVS Repository的负载。</p>\n<p>4.分布式构建，Jenkins可以将工程构建到多台机器，更好地利用硬件资源，节省时间。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"最新版本Jenkins安装\"><a href=\"#最新版本Jenkins安装\" class=\"headerlink\" title=\"最新版本Jenkins安装\"></a>最新版本Jenkins安装</h2><h3 id=\"首先要先添加Jenkins源\"><a href=\"#首先要先添加Jenkins源\" class=\"headerlink\" title=\"首先要先添加Jenkins源:\"></a>首先要先添加Jenkins源:</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo</span><br><span class=\"line\"></span><br><span class=\"line\">报错:ERROR: cannot verify pkg.jenkins.io’s certificate, issued by “/C=US/O=Let<span class=\"string\">&#x27;s Encrypt/CN=Let&#x27;</span>s Encrypt Authority X3”:</span><br><span class=\"line\">  Issued certificate not yet valid.</span><br><span class=\"line\">To connect to pkg.jenkins.io insecurely, use ‘--no-check-certificate’.</span><br></pre></td></tr></table></figure>\n\n<p>如果出现上述问题，则需修改命令为:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget --no-check-certificate -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"导入公钥\"><a href=\"#导入公钥\" class=\"headerlink\" title=\"导入公钥\"></a>导入公钥</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"添加完成之后直接使用yum命令安装Jenkins\"><a href=\"#添加完成之后直接使用yum命令安装Jenkins\" class=\"headerlink\" title=\"添加完成之后直接使用yum命令安装Jenkins:\"></a>添加完成之后直接使用yum命令安装Jenkins:</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install fontconfig java-11-openjdk</span><br><span class=\"line\">yum install jenkins</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动jenkins\"><a href=\"#启动jenkins\" class=\"headerlink\" title=\"启动jenkins\"></a>启动jenkins</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">systemctl start jenkins</span><br></pre></td></tr></table></figure>\n\n<p>如果发现启动失败,或许是你的java版本与之不匹配,查看java版本</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">java -version</span><br></pre></td></tr></table></figure>\n\n<p>卸载java</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum remove [要卸载的java]</span><br></pre></td></tr></table></figure>\n\n<p>如果还是不行就用<code>rpm -qa | grep [java]</code>查看</p>\n<p>并用 <code>rpm -e --nodeps [直接复制过来]</code></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">rpm -e --nodeps java-1.8.0-openjdk-headless-1.8.0.345.b01-1.el7_9.x86_64</span><br></pre></td></tr></table></figure>\n\n<p>然后重新启动jenkins 问题解决</p>\n","categories":["jenkins"],"tags":["jenkins","centos"]},{"title":"DHCP","url":"/post/fb84813c.html","content":"<p>动态主机配置协议是一个局域网的<a href=\"https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/328636?fromModule=lemma_inlink\">网络协议</a>。指的是由<a href=\"https://baike.baidu.com/item/%E6%9C%8D%E5%8A%A1%E5%99%A8/100571?fromModule=lemma_inlink\">服务器</a>控制一段IP地址范围，客户机登录服务器时就可以自动获得服务器分配的IP地址和<a href=\"https://baike.baidu.com/item/%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81/100207?fromModule=lemma_inlink\">子网掩码</a>。担任DHCP服务器的计算机需要安装<a href=\"https://baike.baidu.com/item/TCP%2FIP%E5%8D%8F%E8%AE%AE?fromModule=lemma_inlink\">TCP&#x2F;IP协议</a>，并为其设置<a href=\"https://baike.baidu.com/item/%E9%9D%99%E6%80%81IP%E5%9C%B0%E5%9D%80?fromModule=lemma_inlink\">静态IP地址</a>、子网掩码、<a href=\"https://baike.baidu.com/item/%E9%BB%98%E8%AE%A4%E7%BD%91%E5%85%B3/2152622?fromModule=lemma_inlink\">默认网关</a>等内容。</p>\n<p>DHCP是由<a href=\"https://baike.baidu.com/item/IETF?fromModule=lemma_inlink\">IETF</a>（internet 工作任务小组）开发设计的，于1993年10月成为标准协议，其前身是BOOTP协议。当前的DHCP定义可以在RFC 2131中找到，而基于<a href=\"https://baike.baidu.com/item/IPv6?fromModule=lemma_inlink\">IPv6</a>的建议标准（DHCPv6）可以在RFC 3315中找到。</p>\n<span id=\"more\"></span>\n\n<h3 id=\"工作流程\"><a href=\"#工作流程\" class=\"headerlink\" title=\"工作流程\"></a>工作流程</h3><p><img data-src=\"/../images/DHCP/8ad461295fb94e6f9aeaecce6deea128.png\" alt=\"DHCP工作流程\"></p>\n<h3 id=\"DHCP两种配置办法\"><a href=\"#DHCP两种配置办法\" class=\"headerlink\" title=\"DHCP两种配置办法\"></a>DHCP两种配置办法</h3><ol>\n<li><p>接口配置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">dhcp enable                          # 开启dhcp功能</span><br><span class=\"line\">interface G0/0/0                     # 进入接口</span><br><span class=\"line\">dhcp select interface                # 关联接口</span><br><span class=\"line\">dhcp server dns-list X.X.X.X         # 配置DNS\t</span><br><span class=\"line\">dhcp excluded-ip-address X.X.X.X     # 排除地址</span><br><span class=\"line\">dhcp server static-bind ip-address X.X.X.X mac-address XXX-XXX-XXX 配置静态绑定</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>全局配置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">dhcp enable              # 开启全局</span><br><span class=\"line\">ip pool 地址池名称        # 创建全局地址池</span><br><span class=\"line\">network ip地址 mask      # 配置全局地址池可分配网段</span><br><span class=\"line\">gateway-list ip地址      # 配置网关地址</span><br><span class=\"line\">dns-list ip地址          # 配置DNS</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">进入接口</span></span><br><span class=\"line\">dhcp select global</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看地址池属性</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">display ip pool [接口名称] # 查看地址池属性</span><br></pre></td></tr></table></figure></li>\n</ol>\n","categories":["交换机"],"tags":["DHCP","交换机"]},{"title":"Celery 介绍","url":"/post/983a2c20.html","content":"<p>Celery 是一个 基于python开发的分布式异步消息任务队列，通过它可以轻松的实现任务的异步处理， 如果你的业务场景中需要用到异步任务，就可以考虑使用celery， 举几个实例场景中可用的例子:</p>\n<ul>\n<li>异步任务：将耗时的操作任务提交给Celery去异步执行，比如发送短信&#x2F;邮件、消息推送、音频处理等等</li>\n<li>做一个定时任务，比如每天定时执行爬虫爬取指定内容</li>\n<li>还可以使用celery实现简单的分布式爬虫系统等等</li>\n</ul>\n<span id=\"more\"></span>\n\n<h2 id=\"Celery有以下优点：\"><a href=\"#Celery有以下优点：\" class=\"headerlink\" title=\"Celery有以下优点：\"></a>Celery有以下优点：</h2><ul>\n<li>简单：Celery 易于使用和维护，并且它 不需要配置文件 ，并且配置和使用还是比较简单的（后面会讲到配置文件可以有）</li>\n<li>高可用：当任务执行失败或执行过程中发生连接中断，celery 会自动尝试重新执行任务</li>\n<li>快速：单个 Celery 进程每分钟可处理数以百万计的任务，而保持往返延迟在亚毫秒级</li>\n<li>灵活： Celery 几乎所有部分都可以扩展或单独使用，各个部分可以自定义。</li>\n</ul>\n<h2 id=\"执行流程\"><a href=\"#执行流程\" class=\"headerlink\" title=\"执行流程:\"></a>执行流程:</h2><p><img data-src=\"/../images/Celery-%E4%BB%8B%E7%BB%8D/1.png\" alt=\"1\"></p>\n<h2 id=\"组成模块\"><a href=\"#组成模块\" class=\"headerlink\" title=\"组成模块:\"></a>组成模块:</h2><ul>\n<li>任务模块 Task<ul>\n<li>用来创建异步任务,或者定时任务</li>\n</ul>\n</li>\n<li>消息中间件 Broker<ul>\n<li>用来调度生产者创建的任务,并将其放入消息队列(celery本身不提供消息队列, 官方推荐RabbitMQ 和 Redis 等)</li>\n</ul>\n</li>\n<li>任务执行单元 Worker<ul>\n<li>监控消息队列里的任务并执行。</li>\n</ul>\n</li>\n<li>结果存储 Backend<ul>\n<li>用于存储任务执行的结果。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"初识Celery\"><a href=\"#初识Celery\" class=\"headerlink\" title=\"初识Celery\"></a>初识Celery</h2><h3 id=\"安装Celery\"><a href=\"#安装Celery\" class=\"headerlink\" title=\"安装Celery\"></a>安装Celery</h3><p>我们直接通过pip来安装</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">pip install celery</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建tasks\"><a href=\"#创建tasks\" class=\"headerlink\" title=\"创建tasks\"></a>创建tasks</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 导入Celery对象</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> celery <span class=\"keyword\">import</span> Celery</span><br><span class=\"line\"><span class=\"comment\"># 配置消息中间件的地址，推荐用redis或者RabbitMQ</span></span><br><span class=\"line\"><span class=\"comment\"># 这里我们用redis</span></span><br><span class=\"line\"><span class=\"comment\"># redis://密码@地址:端口号/db</span></span><br><span class=\"line\">broker=<span class=\"string\">&#x27;redis://127.0.0.1:6379/1&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 配置结果存放地址</span></span><br><span class=\"line\">backend = <span class=\"string\">&#x27;redis://127.0.0.1:6379/2&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 实例化</span></span><br><span class=\"line\"><span class=\"comment\"># 第一个参数为命名，可以随便取</span></span><br><span class=\"line\"><span class=\"comment\"># 第二个参数为broker</span></span><br><span class=\"line\"><span class=\"comment\"># 第三个参数为backend</span></span><br><span class=\"line\">app = Celery(<span class=\"string\">&#x27;test&#x27;</span>,broker=broker,backend=backend)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建一个task函数</span></span><br><span class=\"line\"><span class=\"meta\">@app.task</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">add</span>(<span class=\"params\">x,y</span>):</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x+y</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"运行worker\"><a href=\"#运行worker\" class=\"headerlink\" title=\"运行worker\"></a>运行worker</h3><p>在刚才创建的目录下</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">运行worker</span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">celery -A tasks worker --loglevel=info</span></span><br></pre></td></tr></table></figure>\n\n<p>成功后会输入如下信息</p>\n<p><img data-src=\"/../images/Celery-%E4%BB%8B%E7%BB%8D/image-20210119220136204.png\" alt=\"image-20210119220136204\"></p>\n<h3 id=\"调用任务\"><a href=\"#调用任务\" class=\"headerlink\" title=\"调用任务\"></a>调用任务</h3><p>打开<code>ipython</code></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 导入任务</span></span><br><span class=\"line\">In[<span class=\"number\">3</span>]: <span class=\"keyword\">from</span> tasks <span class=\"keyword\">import</span> add</span><br><span class=\"line\"><span class=\"comment\"># 运行任务</span></span><br><span class=\"line\">In[<span class=\"number\">4</span>]: add.delay(<span class=\"number\">1</span>,<span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"comment\"># 输出结果ID</span></span><br><span class=\"line\">Out[<span class=\"number\">4</span>]: &lt;AsyncResult: 070956a9-0791-43c6-9bb6-55af6460cc37&gt;</span><br></pre></td></tr></table></figure>\n\n<p>我们可以看到我们启动的worker已经把结果计算完了</p>\n<p><img data-src=\"/../images/Celery-%E4%BB%8B%E7%BB%8D/image-20210119221336068.png\" alt=\"image-20210119221336068\"></p>\n<p>我们还可以去<code>redis</code>中查看</p>\n<p><img data-src=\"/../images/Celery-%E4%BB%8B%E7%BB%8D/image-20210119221812325.png\" alt=\"image-20210119221812325\"></p>\n<h3 id=\"获取结果\"><a href=\"#获取结果\" class=\"headerlink\" title=\"获取结果\"></a>获取结果</h3><p>那么我们如何获取到执行的结果呢？</p>\n<p>我们可以</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> celery.result <span class=\"keyword\">import</span> AsyncResult</span><br><span class=\"line\">res=AsyncResult(<span class=\"string\">&quot;070956a9-0791-43c6-9bb6-55af6460cc37&quot;</span>) <span class=\"comment\"># 参数为task id</span></span><br><span class=\"line\">res.result</span><br></pre></td></tr></table></figure>\n\n","categories":["异步消息队列"],"tags":["异步消息","celery"]},{"title":"Day002：网络与协议基础 - 以太网、MAC 与 ARP","url":"/post/390a098.html","content":"<p>Day002：网络与协议基础 - 以太网、MAC 与 ARP</p>\n<ul>\n<li>日期：2025-12-26</li>\n<li>周次：第 1 周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><ul>\n<li>理解二层寻址（MAC）与 ARP 的工作流程</li>\n<li>认识广播域与交换机学习机制（理论）</li>\n</ul>\n<span id=\"more\"></span>\n\n<h2 id=\"学习内容\"><a href=\"#学习内容\" class=\"headerlink\" title=\"学习内容\"></a>学习内容</h2><h3 id=\"1️⃣-以太网（Ethernet）基础\"><a href=\"#1️⃣-以太网（Ethernet）基础\" class=\"headerlink\" title=\"1️⃣ 以太网（Ethernet）基础\"></a>1️⃣ 以太网（Ethernet）基础</h3><p><strong>以太网</strong>是最常用的局域网技术，工作在 OSI 的数据链路层（第 2 层）。</p>\n<p><strong>以太网帧结构：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">┌──────────────┬──────────────┬──────┬─────────┬─────┐</span><br><span class=\"line\">│ 目标MAC地址  │ 源MAC地址    │ 类型 │ 数据    │ FCS │</span><br><span class=\"line\">│   6字节      │   6字节      │2字节 │46-1500字节│4字节│</span><br><span class=\"line\">└──────────────┴──────────────┴──────┴─────────┴─────┘</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>类型字段</strong>：0x0800 &#x3D; IPv4，0x0806 &#x3D; ARP</li>\n<li><strong>FCS</strong>：帧校验序列，检测传输错误</li>\n</ul>\n<h3 id=\"2️⃣-MAC-地址详解\"><a href=\"#2️⃣-MAC-地址详解\" class=\"headerlink\" title=\"2️⃣ MAC 地址详解\"></a>2️⃣ MAC 地址详解</h3><p><strong>MAC 地址（Media Access Control Address）</strong> - 网卡的物理地址</p>\n<p><strong>特点：</strong></p>\n<ul>\n<li><strong>长度</strong>：48 位（6 字节），写成 12 个十六进制数</li>\n<li><strong>格式</strong>：<code>C8-15-4E-A8-D3-FB</code> 或 <code>C8:15:4E:A8:D3:FB</code></li>\n<li><strong>前 3 字节</strong>：OUI（厂商标识）</li>\n<li><strong>后 3 字节</strong>：厂商分配的序列号</li>\n</ul>\n<p><strong>特殊 MAC 地址：</strong></p>\n<ul>\n<li><strong>广播地址</strong>：<code>FF-FF-FF-FF-FF-FF</code>（所有设备接收）</li>\n<li><strong>多播地址</strong>：第一字节最低位为 1，如 <code>01-00-5e-xx-xx-xx</code></li>\n</ul>\n<h3 id=\"3️⃣-ARP-协议（Address-Resolution-Protocol）\"><a href=\"#3️⃣-ARP-协议（Address-Resolution-Protocol）\" class=\"headerlink\" title=\"3️⃣ ARP 协议（Address Resolution Protocol）\"></a>3️⃣ ARP 协议（Address Resolution Protocol）</h3><p><strong>ARP 的作用：将 IP 地址转换为 MAC 地址</strong></p>\n<p><strong>为什么需要 ARP？</strong></p>\n<ul>\n<li>网络层使用 IP 地址（如 192.168.2.5）</li>\n<li>数据链路层使用 MAC 地址（如 C8-15-4E-A8-D3-FB）</li>\n<li>ARP 负责在两者之间建立映射</li>\n</ul>\n<p><strong>ARP 工作流程：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">主机 A (192.168.2.5) 想要发送数据给主机 B (192.168.2.10)</span><br><span class=\"line\"></span><br><span class=\"line\">步骤 1: A 检查 ARP 缓存</span><br><span class=\"line\">  └─ 如果没有 192.168.2.10 的 MAC → 发送 ARP 请求</span><br><span class=\"line\"></span><br><span class=\"line\">步骤 2: A 发送 ARP 请求（广播）</span><br><span class=\"line\">  ┌────────────────────────────────────┐</span><br><span class=\"line\">  │ 谁有 192.168.2.10？               │</span><br><span class=\"line\">  │ 请告诉 192.168.2.5                │</span><br><span class=\"line\">  │ 我的 MAC 是 C8-15-4E-A8-D3-FB     │</span><br><span class=\"line\">  │ 目标 MAC: FF-FF-FF-FF-FF-FF（广播）│</span><br><span class=\"line\">  └────────────────────────────────────┘</span><br><span class=\"line\">       ↓ 局域网所有设备都收到</span><br><span class=\"line\"></span><br><span class=\"line\">步骤 3: 主机 B 回复 ARP 应答（单播）</span><br><span class=\"line\">  ┌────────────────────────────────────┐</span><br><span class=\"line\">  │ 我是 192.168.2.10                 │</span><br><span class=\"line\">  │ 我的 MAC 是 AA-BB-CC-DD-EE-FF     │</span><br><span class=\"line\">  │ 目标 MAC: C8-15-4E-A8-D3-FB       │</span><br><span class=\"line\">  └────────────────────────────────────┘</span><br><span class=\"line\">       ↓ 单播回复给主机 A</span><br><span class=\"line\"></span><br><span class=\"line\">步骤 4: A 将映射存入 ARP 缓存</span><br><span class=\"line\">  192.168.2.10 → AA-BB-CC-DD-EE-FF</span><br></pre></td></tr></table></figure>\n\n<p><strong>ARP 报文结构：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">字段名称              说明                      值（请求/应答）</span><br><span class=\"line\">────────────────────────────────────────────────────────────</span><br><span class=\"line\">硬件类型              1 = 以太网                1</span><br><span class=\"line\">协议类型              0x0800 = IPv4             0x0800</span><br><span class=\"line\">硬件地址长度          MAC 地址长度              6</span><br><span class=\"line\">协议地址长度          IP 地址长度               4</span><br><span class=\"line\">操作码                1=请求, 2=应答            1 或 2</span><br><span class=\"line\">发送者 MAC 地址       发送者的物理地址          实际 MAC</span><br><span class=\"line\">发送者 IP 地址        发送者的 IP               实际 IP</span><br><span class=\"line\">目标 MAC 地址         目标的物理地址            00-00-00-00-00-00 (请求)</span><br><span class=\"line\">目标 IP 地址          目标的 IP                 查询的 IP</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4️⃣-交换机工作原理\"><a href=\"#4️⃣-交换机工作原理\" class=\"headerlink\" title=\"4️⃣ 交换机工作原理\"></a>4️⃣ 交换机工作原理</h3><p><strong>交换机（Switch）</strong> 根据 MAC 地址转发数据帧。</p>\n<p><strong>MAC 地址表（CAM 表）示例：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">端口    MAC 地址              学习时间</span><br><span class=\"line\">────────────────────────────────────</span><br><span class=\"line\">1       C8-15-4E-A8-D3-FB     10秒前</span><br><span class=\"line\">2       AA-BB-CC-DD-EE-FF     5秒前</span><br><span class=\"line\">3       11-22-33-44-55-66     2秒前</span><br></pre></td></tr></table></figure>\n\n<p><strong>转发决策：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">收到数据帧时：</span><br><span class=\"line\">1. 学习源 MAC → 记录来自哪个端口</span><br><span class=\"line\">2. 查找目标 MAC：</span><br><span class=\"line\">   ├─ 在表中找到 → 单播转发到对应端口</span><br><span class=\"line\">   ├─ 广播地址 → 洪泛到所有端口</span><br><span class=\"line\">   └─ 找不到 → 洪泛到所有端口（除接收端口）</span><br></pre></td></tr></table></figure>\n\n<p><strong>广播域（Broadcast Domain）：</strong></p>\n<ul>\n<li>广播帧能到达的所有设备范围</li>\n<li>同一交换机下的所有端口在同一广播域</li>\n<li>路由器可以隔离广播域</li>\n</ul>\n<h3 id=\"5️⃣-ARP-安全问题（理论）\"><a href=\"#5️⃣-ARP-安全问题（理论）\" class=\"headerlink\" title=\"5️⃣ ARP 安全问题（理论）\"></a>5️⃣ ARP 安全问题（理论）</h3><p>⚠️ <strong>ARP 欺骗&#x2F;中间人攻击：</strong></p>\n<ul>\n<li>ARP 没有认证机制</li>\n<li>攻击者可发送伪造的 ARP 应答</li>\n<li>劫持或窃听流量</li>\n</ul>\n<p><strong>防护措施：</strong></p>\n<ul>\n<li>静态 ARP 条目（关键设备）</li>\n<li>ARP 防护软件</li>\n<li>交换机 DAI（Dynamic ARP Inspection）</li>\n</ul>\n<h2 id=\"实践任务（合法授权范围内）\"><a href=\"#实践任务（合法授权范围内）\" class=\"headerlink\" title=\"实践任务（合法授权范围内）\"></a>实践任务（合法授权范围内）</h2><h3 id=\"📦-任务准备：安装-Wireshark\"><a href=\"#📦-任务准备：安装-Wireshark\" class=\"headerlink\" title=\"📦 任务准备：安装 Wireshark\"></a>📦 任务准备：安装 Wireshark</h3><p><strong>方法 1：使用 Winget 安装</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">winget install <span class=\"literal\">-e</span> <span class=\"literal\">--id</span> WiresharkFoundation.Wireshark</span><br></pre></td></tr></table></figure>\n\n<p><strong>方法 2：手动下载安装</strong></p>\n<ul>\n<li>访问：<a href=\"https://www.wireshark.org/download.html\">https://www.wireshark.org/download.html</a></li>\n<li>下载：Windows Installer (64-bit)</li>\n<li>安装时勾选：Npcap（网络抓包驱动）</li>\n</ul>\n<h3 id=\"🎯-任务-1-使用-Wireshark-抓取本地-ARP-流量\"><a href=\"#🎯-任务-1-使用-Wireshark-抓取本地-ARP-流量\" class=\"headerlink\" title=\"🎯 任务 1: 使用 Wireshark 抓取本地 ARP 流量\"></a>🎯 任务 1: 使用 Wireshark 抓取本地 ARP 流量</h3><p><strong>步骤 1：启动 Wireshark</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 启动 Wireshark（安装后）</span></span><br><span class=\"line\">wireshark</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 2：选择网络接口</strong></p>\n<ul>\n<li>双击你的活动网络接口（如：Wi-Fi、以太网）</li>\n<li>提示：有流量活动的接口会显示实时图表</li>\n</ul>\n<p><strong>步骤 3：设置显示过滤器</strong></p>\n<ul>\n<li>在顶部过滤栏输入：<code>arp</code></li>\n<li>按 Enter 键应用过滤器</li>\n<li>只显示 ARP 协议的数据包</li>\n</ul>\n<p><strong>步骤 4：生成 ARP 流量</strong></p>\n<p>在 PowerShell 中执行以下命令（触发 ARP 请求）：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 清空 ARP 缓存（需要管理员权限）</span></span><br><span class=\"line\"><span class=\"comment\"># 如果没有管理员权限，可以跳过此步骤</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Ping 网关以触发 ARP</span></span><br><span class=\"line\">ping <span class=\"literal\">-n</span> <span class=\"number\">2</span> <span class=\"number\">192.168</span>.<span class=\"number\">2.1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Ping 同网段其他 IP（可能不存在，但会触发 ARP）</span></span><br><span class=\"line\">ping <span class=\"literal\">-n</span> <span class=\"number\">1</span> <span class=\"number\">192.168</span>.<span class=\"number\">2.100</span></span><br><span class=\"line\">ping <span class=\"literal\">-n</span> <span class=\"number\">1</span> <span class=\"number\">192.168</span>.<span class=\"number\">2.101</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 5：分析 ARP 数据包</strong></p>\n<p>在 Wireshark 中，你会看到两种类型的 ARP 包：</p>\n<p><strong>ARP 请求包（Request）特征：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Info: Who has 192.168.2.1? Tell 192.168.2.5</span><br></pre></td></tr></table></figure>\n\n<p><strong>ARP 应答包（Reply）特征：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Info: 192.168.2.1 is at 38:3d:5b:0c:92:1c</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 6：详细字段标注</strong></p>\n<p>点击一个 ARP 请求包，在中间窗格展开字段：</p>\n<h3 id=\"📊-ARP-请求包字段标注\"><a href=\"#📊-ARP-请求包字段标注\" class=\"headerlink\" title=\"📊 ARP 请求包字段标注\"></a>📊 ARP 请求包字段标注</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Frame（帧信息）</span><br><span class=\"line\">├─ Ethernet II（以太网帧头）</span><br><span class=\"line\">│  ├─ Destination: ff:ff:ff:ff:ff:ff（广播 MAC）</span><br><span class=\"line\">│  ├─ Source: c8:15:4e:a8:d3:fb（本机 MAC）</span><br><span class=\"line\">│  └─ Type: ARP (0x0806)（协议类型）</span><br><span class=\"line\">│</span><br><span class=\"line\">└─ Address Resolution Protocol (request)</span><br><span class=\"line\">   ├─ Hardware type: Ethernet (1)（硬件类型：以太网）</span><br><span class=\"line\">   ├─ Protocol type: IPv4 (0x0800)（协议类型：IPv4）</span><br><span class=\"line\">   ├─ Hardware size: 6（MAC 地址长度）</span><br><span class=\"line\">   ├─ Protocol size: 4（IP 地址长度）</span><br><span class=\"line\">   ├─ Opcode: request (1)（操作码：请求）</span><br><span class=\"line\">   ├─ Sender MAC address: c8:15:4e:a8:d3:fb（发送者 MAC）</span><br><span class=\"line\">   ├─ Sender IP address: 192.168.2.5（发送者 IP）</span><br><span class=\"line\">   ├─ Target MAC address: 00:00:00:00:00:00（目标 MAC，未知）</span><br><span class=\"line\">   └─ Target IP address: 192.168.2.1（目标 IP，要查询的）</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"📊-ARP-应答包字段标注\"><a href=\"#📊-ARP-应答包字段标注\" class=\"headerlink\" title=\"📊 ARP 应答包字段标注\"></a>📊 ARP 应答包字段标注</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Frame（帧信息）</span><br><span class=\"line\">├─ Ethernet II（以太网帧头）</span><br><span class=\"line\">│  ├─ Destination: c8:15:4e:a8:d3:fb（请求者 MAC，单播）</span><br><span class=\"line\">│  ├─ Source: 38:3d:5b:0c:92:1c（网关 MAC）</span><br><span class=\"line\">│  └─ Type: ARP (0x0806)</span><br><span class=\"line\">│</span><br><span class=\"line\">└─ Address Resolution Protocol (reply)</span><br><span class=\"line\">   ├─ Hardware type: Ethernet (1)</span><br><span class=\"line\">   ├─ Protocol type: IPv4 (0x0800)</span><br><span class=\"line\">   ├─ Hardware size: 6</span><br><span class=\"line\">   ├─ Protocol size: 4</span><br><span class=\"line\">   ├─ Opcode: reply (2)（操作码：应答）</span><br><span class=\"line\">   ├─ Sender MAC address: 38:3d:5b:0c:92:1c（网关 MAC，已知）</span><br><span class=\"line\">   ├─ Sender IP address: 192.168.2.1（网关 IP）</span><br><span class=\"line\">   ├─ Target MAC address: c8:15:4e:a8:d3:fb（请求者 MAC）</span><br><span class=\"line\">   └─ Target IP address: 192.168.2.5（请求者 IP）</span><br></pre></td></tr></table></figure>\n\n<p><strong>关键区别对比：</strong></p>\n<table>\n<thead>\n<tr>\n<th>字段</th>\n<th>ARP 请求</th>\n<th>ARP 应答</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>以太网目标 MAC</strong></td>\n<td>FF:FF:FF:FF:FF:FF（广播）</td>\n<td>C8:15:4E:A8:D3:FB（单播）</td>\n</tr>\n<tr>\n<td><strong>操作码</strong></td>\n<td>1（request）</td>\n<td>2（reply）</td>\n</tr>\n<tr>\n<td><strong>目标 MAC</strong></td>\n<td>00:00:00:00:00:00（未知）</td>\n<td>C8:15:4E:A8:D3:FB（已知）</td>\n</tr>\n</tbody></table>\n<p><strong>步骤 7：保存抓包文件</strong></p>\n<ul>\n<li>File → Save As</li>\n<li>保存为：<code>day002_arp_capture.pcapng</code></li>\n<li>可以随时重新打开分析</li>\n</ul>\n<h3 id=\"🎯-任务-2-观察-ARP-缓存（已完成）\"><a href=\"#🎯-任务-2-观察-ARP-缓存（已完成）\" class=\"headerlink\" title=\"🎯 任务 2: 观察 ARP 缓存（已完成）\"></a>🎯 任务 2: 观察 ARP 缓存（已完成）</h3><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">arp <span class=\"literal\">-a</span></span><br></pre></td></tr></table></figure>\n\n<p>（此任务已在上面完成）</p>\n<h2 id=\"巩固练习（题与复盘）\"><a href=\"#巩固练习（题与复盘）\" class=\"headerlink\" title=\"巩固练习（题与复盘）\"></a>巩固练习（题与复盘）</h2><ul>\n<li>问答：为何需要 ARP？它解决了什么问题？</li>\n<li>练习：识别抓包中 ARP 的请求&#x2F;应答并解释发送者&#x2F;目标字段</li>\n</ul>\n<h2 id=\"评估标准（达成判定）\"><a href=\"#评估标准（达成判定）\" class=\"headerlink\" title=\"评估标准（达成判定）\"></a>评估标准（达成判定）</h2><ul>\n<li>能在抓包中准确定位与解释 ARP 报文</li>\n<li>能说明 ARP 工作原理与安全注意事项（仅理论）</li>\n</ul>\n<h2 id=\"学习成果达成情况（由学习者填写）\"><a href=\"#学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"学习成果达成情况（由学习者填写）\"></a>学习成果达成情况（由学习者填写）</h2><h3 id=\"📋-实践任务完成情况\"><a href=\"#📋-实践任务完成情况\" class=\"headerlink\" title=\"📋 实践任务完成情况\"></a>📋 实践任务完成情况</h3><p><strong>任务 1: 查看 ARP 缓存</strong></p>\n<ul>\n<li><p>关键命令与输出：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">arp <span class=\"literal\">-a</span></span><br><span class=\"line\"></span><br><span class=\"line\">接口: <span class=\"number\">192.168</span>.<span class=\"number\">2.5</span> <span class=\"literal\">---</span> <span class=\"number\">0</span>x13</span><br><span class=\"line\">  Internet 地址         物理地址              类型</span><br><span class=\"line\">  <span class=\"number\">192.168</span>.<span class=\"number\">2.1</span>           <span class=\"number\">38</span><span class=\"literal\">-3d-5b-0c-92-1c</span>     动态</span><br><span class=\"line\">  <span class=\"number\">192.168</span>.<span class=\"number\">2.255</span>         ff<span class=\"literal\">-ff-ff-ff-ff-ff</span>     静态</span><br><span class=\"line\">  <span class=\"number\">224.0</span>.<span class=\"number\">0.22</span>            <span class=\"number\">01</span><span class=\"literal\">-00-5e-00-00-16</span>     静态</span><br><span class=\"line\">  <span class=\"number\">224.0</span>.<span class=\"number\">0.251</span>           <span class=\"number\">01</span><span class=\"literal\">-00-5e-00-00-fb</span>     静态</span><br><span class=\"line\">  <span class=\"number\">224.0</span>.<span class=\"number\">0.252</span>           <span class=\"number\">01</span><span class=\"literal\">-00-5e-00-00-fc</span>     静态</span><br><span class=\"line\">  <span class=\"number\">239.255</span>.<span class=\"number\">255.250</span>       <span class=\"number\">01</span><span class=\"literal\">-00-5e-7f-ff-fa</span>     静态</span><br><span class=\"line\">  <span class=\"number\">255.255</span>.<span class=\"number\">255.255</span>       ff<span class=\"literal\">-ff-ff-ff-ff-ff</span>     静态</span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><strong>ARP 缓存条目分析：</strong></p>\n<table>\n<thead>\n<tr>\n<th>IP 地址</th>\n<th>MAC 地址</th>\n<th>类型</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>192.168.2.1</td>\n<td>38-3d-5b-0c-92-1c</td>\n<td>动态</td>\n<td><strong>网关&#x2F;路由器</strong> - 访问互联网的必经之路</td>\n</tr>\n<tr>\n<td>192.168.2.255</td>\n<td>ff-ff-ff-ff-ff-ff</td>\n<td>静态</td>\n<td>子网广播地址</td>\n</tr>\n<tr>\n<td>224.0.0.251</td>\n<td>01-00-5e-00-00-fb</td>\n<td>静态</td>\n<td>mDNS 多播地址（本地服务发现）</td>\n</tr>\n<tr>\n<td>239.255.255.250</td>\n<td>01-00-5e-7f-ff-fa</td>\n<td>静态</td>\n<td>SSDP 多播地址（UPnP 设备发现）</td>\n</tr>\n<tr>\n<td>255.255.255.255</td>\n<td>ff-ff-ff-ff-ff-ff</td>\n<td>静态</td>\n<td>全网广播地址</td>\n</tr>\n</tbody></table>\n<p><strong>关键发现：</strong></p>\n<ul>\n<li>✅ 动态条目只有网关（192.168.2.1），说明最近只与网关通信</li>\n<li>✅ 多播地址以 <code>01-00-5e</code> 开头，这是 IPv4 多播 MAC 的标准格式</li>\n<li>✅ 广播 MAC 地址是 <code>ff-ff-ff-ff-ff-ff</code></li>\n</ul>\n<hr>\n<p><strong>任务 2: Wireshark 抓取 ARP 流量（已完成）</strong> ✅</p>\n<p><strong>实践操作：</strong></p>\n<ol>\n<li>✅ 启动 Wireshark 并选择 WLAN 3 接口</li>\n<li>✅ 设置显示过滤器：<code>arp</code></li>\n<li>✅ 执行 <code>ping 192.168.2.1</code> 生成 ARP 流量</li>\n<li>✅ 成功捕获 ARP 请求和应答包</li>\n<li>✅ 分析了数据包的详细字段</li>\n</ol>\n<p><strong>📸 实践截图：</strong></p>\n<p><strong>截图 1: ARP 请求包（广播）</strong><br><img data-src=\"/../images/Day002/day002_arp_request.png\" alt=\"day002_arp_request\"></p>\n<ul>\n<li>Frame 540：ARP 请求包</li>\n<li>目标 MAC: ff:ff:ff:ff:ff:ff（广播）</li>\n<li>操作码: request (1)</li>\n<li>目标 MAC 地址字段为 00:00:00:00:00:00（未知）</li>\n</ul>\n<p><strong>截图 2: ARP 应答包（单播）</strong><br><img data-src=\"/../images/Day002/day002_arp_reply-17667221686171.png\" alt=\"day002_arp_reply\"></p>\n<ul>\n<li>Frame 1742：ARP 应答包</li>\n<li>目标 MAC: c8:15:4e:a8:d3:fb（单播回复给请求者）</li>\n<li>操作码: reply (2)</li>\n<li>发送者 MAC: 38:3d:5b:0c:92:1c（网关 Fiberhom）</li>\n</ul>\n<p><strong>捕获到的 ARP 包分析：</strong></p>\n<p><strong>📦 ARP 请求包 (Request) - Frame 540：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">以太网帧头：</span><br><span class=\"line\">├─ 源 MAC: c8:15:4e:a8:d3:fb（本机 MAC）</span><br><span class=\"line\">├─ 目标 MAC: ff:ff:ff:ff:ff:ff（广播地址）</span><br><span class=\"line\">└─ 类型: ARP (0x0806)</span><br><span class=\"line\"></span><br><span class=\"line\">ARP 报文：</span><br><span class=\"line\">├─ 硬件类型: Ethernet (1)</span><br><span class=\"line\">├─ 协议类型: IPv4 (0x0800)</span><br><span class=\"line\">├─ 硬件地址长度: 6 字节</span><br><span class=\"line\">├─ 协议地址长度: 4 字节</span><br><span class=\"line\">├─ 操作码: request (1) ← 这是请求</span><br><span class=\"line\">├─ 发送者 MAC: c8:15:4e:a8:d3:fb</span><br><span class=\"line\">├─ 发送者 IP: 192.168.2.5（我的 IP）</span><br><span class=\"line\">├─ 目标 MAC: 00:00:00:00:00:00（未知，需要查询）</span><br><span class=\"line\">└─ 目标 IP: 192.168.2.1（网关 IP）</span><br><span class=\"line\"></span><br><span class=\"line\">含义：&quot;我是 192.168.2.5，谁有 192.168.2.1？告诉我你的 MAC！&quot;</span><br></pre></td></tr></table></figure>\n\n<p><strong>📦 ARP 应答包 (Reply) - Frame 1742：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">以太网帧头：</span><br><span class=\"line\">├─ 源 MAC: 38:3d:5b:0c:92:1c（网关 MAC - Fiberhom）</span><br><span class=\"line\">├─ 目标 MAC: c8:15:4e:a8:d3:fb（本机 MAC，单播）</span><br><span class=\"line\">└─ 类型: ARP (0x0806)</span><br><span class=\"line\"></span><br><span class=\"line\">ARP 报文：</span><br><span class=\"line\">├─ 硬件类型: Ethernet (1)</span><br><span class=\"line\">├─ 协议类型: IPv4 (0x0800)</span><br><span class=\"line\">├─ 硬件地址长度: 6 字节</span><br><span class=\"line\">├─ 协议地址长度: 4 字节</span><br><span class=\"line\">├─ 操作码: reply (2) ← 这是应答</span><br><span class=\"line\">├─ 发送者 MAC: c8:15:4e:a8:d3:fb（我的 MAC）</span><br><span class=\"line\">├─ 发送者 IP: 192.168.2.5（我的 IP）</span><br><span class=\"line\">├─ 目标 MAC: 38:3d:5b:0c:92:1c（网关 MAC）</span><br><span class=\"line\">└─ 目标 IP: 192.168.2.1（网关 IP）</span><br><span class=\"line\"></span><br><span class=\"line\">含义：&quot;我是 192.168.2.1，我的 MAC 是 38:3d:5b:0c:92:1c&quot;</span><br></pre></td></tr></table></figure>\n\n<p><strong>🔍 关键观察与验证：</strong></p>\n<table>\n<thead>\n<tr>\n<th>对比项</th>\n<th>ARP 请求</th>\n<th>ARP 应答</th>\n<th>验证结果</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>以太网目标 MAC</strong></td>\n<td>ff:ff:ff:ff:ff:ff（广播）</td>\n<td>c8:15:4e:a8:d3:fb（单播）</td>\n<td>✅ 符合理论</td>\n</tr>\n<tr>\n<td><strong>ARP 操作码</strong></td>\n<td>1 (request)</td>\n<td>2 (reply)</td>\n<td>✅ 正确</td>\n</tr>\n<tr>\n<td><strong>ARP 目标 MAC</strong></td>\n<td>00:00:00:00:00:00（未知）</td>\n<td>38:3d:5b:0c:92:1c（已知）</td>\n<td>✅ 符合预期</td>\n</tr>\n<tr>\n<td><strong>帧长度</strong></td>\n<td>42 bytes</td>\n<td>42 bytes</td>\n<td>✅ ARP 包固定大小</td>\n</tr>\n<tr>\n<td><strong>网关厂商</strong></td>\n<td>-</td>\n<td>Fiberhom</td>\n<td>📝 光纤设备厂商</td>\n</tr>\n</tbody></table>\n<p><strong>💡 实践收获：</strong></p>\n<ol>\n<li>✅ 亲眼看到了 ARP 请求使用广播 (ff:ff:ff:ff:ff:ff)</li>\n<li>✅ 验证了 ARP 应答使用单播直接回复给请求者</li>\n<li>✅ 理解了”谁有 IP？告诉 MAC”的实际过程</li>\n<li>✅ 观察到了真实网络中的 MAC 地址和厂商信息</li>\n<li>✅ 掌握了 Wireshark 的基本使用方法</li>\n</ol>\n<h3 id=\"📝-巩固练习答案\"><a href=\"#📝-巩固练习答案\" class=\"headerlink\" title=\"📝 巩固练习答案\"></a>📝 巩固练习答案</h3><p><strong>练习 1: 为何需要 ARP？它解决了什么问题？</strong></p>\n<p><strong>答案：</strong><br>ARP 解决了<strong>网络层地址（IP）到数据链路层地址（MAC）的映射问题</strong>。</p>\n<p><strong>原因：</strong></p>\n<ol>\n<li><strong>网络层使用 IP 地址</strong>：应用程序和路由使用 IP 地址（如 192.168.2.10）进行通信</li>\n<li><strong>数据链路层使用 MAC 地址</strong>：以太网帧必须使用 MAC 地址（如 AA-BB-CC-DD-EE-FF）才能在局域网传输</li>\n<li><strong>需要转换机制</strong>：当主机知道目标 IP 但不知道 MAC 时，无法发送以太网帧</li>\n</ol>\n<p><strong>ARP 的作用：</strong></p>\n<ul>\n<li>发送广播询问：”谁有这个 IP？请告诉我你的 MAC”</li>\n<li>目标主机回复：”我有这个 IP，我的 MAC 是…”</li>\n<li>建立 IP ↔ MAC 映射，缓存起来供后续使用</li>\n</ul>\n<p><strong>类比：</strong> IP 地址像家庭住址（用于导航），MAC 地址像门牌号（用于实际投递），ARP 就是查找门牌号的过程。</p>\n<hr>\n<p><strong>练习 2: 识别 ARP 请求&#x2F;应答并解释字段</strong></p>\n<p><strong>ARP 请求报文示例：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">操作码: 1 (请求)</span><br><span class=\"line\">发送者 MAC: C8-15-4E-A8-D3-FB  ← 我的 MAC（已知）</span><br><span class=\"line\">发送者 IP:  192.168.2.5        ← 我的 IP（已知）</span><br><span class=\"line\">目标 MAC:   00-00-00-00-00-00  ← 要查询的 MAC（未知，填0）</span><br><span class=\"line\">目标 IP:    192.168.2.1        ← 要查询的 IP（已知）</span><br><span class=\"line\"></span><br><span class=\"line\">以太网帧头：</span><br><span class=\"line\">源 MAC:     C8-15-4E-A8-D3-FB</span><br><span class=\"line\">目标 MAC:   FF-FF-FF-FF-FF-FF  ← 广播，所有设备都收到</span><br></pre></td></tr></table></figure>\n\n<p><strong>解释：</strong></p>\n<ul>\n<li>“我是 192.168.2.5 (MAC: C8-15-4E-A8-D3-FB)”</li>\n<li>“谁有 192.168.2.1？请告诉我你的 MAC 地址”</li>\n<li>使用广播发送，局域网内所有设备都能收到</li>\n</ul>\n<p><strong>ARP 应答报文示例：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">操作码: 2 (应答)</span><br><span class=\"line\">发送者 MAC: 38-3d-5b-0c-92-1c  ← 网关的 MAC（被查询者）</span><br><span class=\"line\">发送者 IP:  192.168.2.1        ← 网关的 IP（被查询者）</span><br><span class=\"line\">目标 MAC:   C8-15-4E-A8-D3-FB  ← 请求者的 MAC</span><br><span class=\"line\">目标 IP:    192.168.2.5        ← 请求者的 IP</span><br><span class=\"line\"></span><br><span class=\"line\">以太网帧头：</span><br><span class=\"line\">源 MAC:     38-3d-5b-0c-92-1c</span><br><span class=\"line\">目标 MAC:   C8-15-4E-A8-D3-FB  ← 单播回复，只发给请求者</span><br></pre></td></tr></table></figure>\n\n<p><strong>解释：</strong></p>\n<ul>\n<li>“我是 192.168.2.1，我的 MAC 是 38-3d-5b-0c-92-1c”</li>\n<li>“这是你要的信息，发送给 192.168.2.5”</li>\n<li>使用单播回复，只有请求者收到</li>\n</ul>\n<h3 id=\"✅-结论与反思\"><a href=\"#✅-结论与反思\" class=\"headerlink\" title=\"✅ 结论与反思\"></a>✅ 结论与反思</h3><p><strong>核心知识点掌握：</strong></p>\n<ol>\n<li>✅ <strong>MAC 地址</strong>：48 位物理地址，全球唯一，用于局域网内数据传输</li>\n<li>✅ <strong>ARP 协议</strong>：IP → MAC 的映射机制，使用”广播请求 + 单播应答”</li>\n<li>✅ <strong>ARP 缓存</strong>：保存 IP-MAC 映射，动态条目有超时时间</li>\n<li>✅ <strong>广播域</strong>：同一交换机下所有设备在同一广播域，ARP 请求会被所有设备接收</li>\n<li>✅ <strong>交换机</strong>：根据 MAC 地址表转发，学习源 MAC，查找目标 MAC</li>\n</ol>\n<p><strong>实践理解：</strong></p>\n<ul>\n<li>本机 ARP 缓存中只有网关的动态条目，说明通常只需要与网关通信</li>\n<li>访问互联网时：本机 → 网关（MAC 转发）→ 网关（IP 路由）→ 互联网</li>\n<li>ARP 只在局域网内工作，跨网段通信通过路由器的 IP 路由实现</li>\n</ul>\n<p><strong>数据流转过程：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">访问百度 (220.181.38.148) 的过程：</span><br><span class=\"line\">1. 检查目标 IP 220.181.38.148 不在本地网段（192.168.2.0/24）</span><br><span class=\"line\">2. 查找路由表，确定需要发给默认网关 192.168.2.1</span><br><span class=\"line\">3. 查 ARP 缓存，获取网关 MAC: 38-3d-5b-0c-92-1c</span><br><span class=\"line\">4. 构造以太网帧：</span><br><span class=\"line\">   - 目标 MAC: 38-3d-5b-0c-92-1c（网关）</span><br><span class=\"line\">   - 源 MAC: C8-15-4E-A8-D3-FB（本机）</span><br><span class=\"line\">   - IP 包内：目标 IP: 220.181.38.148（百度）</span><br><span class=\"line\">5. 网关收到后，剥离以太网帧，根据 IP 路由转发</span><br></pre></td></tr></table></figure>\n\n<p><strong>安全思考：</strong></p>\n<ul>\n<li>⚠️ ARP 无认证，易受欺骗攻击</li>\n<li>🛡️ 关键设备应使用静态 ARP</li>\n<li>🔍 异常 ARP 流量可能是攻击信号</li>\n</ul>\n<h2 id=\"1️⃣-⚠️-ARP-无认证，易受欺骗攻击\"><a href=\"#1️⃣-⚠️-ARP-无认证，易受欺骗攻击\" class=\"headerlink\" title=\"1️⃣ ⚠️ ARP 无认证，易受欺骗攻击\"></a>1️⃣ ⚠️ ARP 无认证，易受欺骗攻击</h2><h3 id=\"为什么-ARP-容易被欺骗？\"><a href=\"#为什么-ARP-容易被欺骗？\" class=\"headerlink\" title=\"为什么 ARP 容易被欺骗？\"></a>为什么 ARP 容易被欺骗？</h3><p><strong>ARP 协议的信任缺陷：</strong></p>\n<ul>\n<li>ARP 设计时<strong>没有身份验证机制</strong></li>\n<li>主机会<strong>无条件信任</strong>收到的 ARP 应答</li>\n<li>即使没有发送 ARP 请求，也会接受<strong>主动发来的 ARP 应答</strong>（Gratuitous ARP）</li>\n<li>新的 ARP 应答会<strong>直接覆盖</strong>缓存中的旧条目</li>\n</ul>\n<h3 id=\"典型攻击场景：ARP-欺骗-x2F-中间人攻击\"><a href=\"#典型攻击场景：ARP-欺骗-x2F-中间人攻击\" class=\"headerlink\" title=\"典型攻击场景：ARP 欺骗&#x2F;中间人攻击\"></a>典型攻击场景：ARP 欺骗&#x2F;中间人攻击</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">正常通信：</span><br><span class=\"line\">主机 A ←─────直接通信─────→ 网关</span><br><span class=\"line\">(192.168.2.5)           (192.168.2.1)</span><br><span class=\"line\"></span><br><span class=\"line\">攻击后：</span><br><span class=\"line\">主机 A ←───→ 攻击者 ←───→ 网关</span><br><span class=\"line\">(192.168.2.5)  (192.168.2.100) (192.168.2.1)</span><br><span class=\"line\">              ↑</span><br><span class=\"line\">         冒充网关的 MAC</span><br><span class=\"line\">         窃听/篡改流量</span><br></pre></td></tr></table></figure>\n\n<p><strong>攻击步骤：</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 攻击者（192.168.2.100）的操作：</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 1. 向主机 A 发送伪造的 ARP 应答</span></span><br><span class=\"line\"><span class=\"comment\"># &quot;我是网关 192.168.2.1，我的 MAC 是 攻击者的MAC&quot;</span></span><br><span class=\"line\">伪造 ARP: <span class=\"number\">192.168</span>.<span class=\"number\">2.1</span> → 攻击者MAC（发给主机 A）</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. 向网关发送伪造的 ARP 应答</span></span><br><span class=\"line\"><span class=\"comment\"># &quot;我是主机 192.168.2.5，我的 MAC 是 攻击者的MAC&quot;</span></span><br><span class=\"line\">伪造 ARP: <span class=\"number\">192.168</span>.<span class=\"number\">2.5</span> → 攻击者MAC（发给网关）</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 结果：主机 A 和网关的流量都经过攻击者</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>危害：</strong></p>\n<ul>\n<li>🔓 窃听敏感信息（未加密的 HTTP、FTP、Telnet）</li>\n<li>✂️ 篡改数据包内容</li>\n<li>🚫 拒绝服务（不转发数据包）</li>\n<li>🎣 劫持会话（Session Hijacking）</li>\n</ul>\n<hr>\n<h2 id=\"2️⃣-🛡️-关键设备应使用静态-ARP\"><a href=\"#2️⃣-🛡️-关键设备应使用静态-ARP\" class=\"headerlink\" title=\"2️⃣ 🛡️ 关键设备应使用静态 ARP\"></a>2️⃣ 🛡️ 关键设备应使用静态 ARP</h2><h3 id=\"什么是静态-ARP？\"><a href=\"#什么是静态-ARP？\" class=\"headerlink\" title=\"什么是静态 ARP？\"></a>什么是静态 ARP？</h3><p><strong>静态 ARP 条目 &#x3D; 手动绑定 IP ↔ MAC，不会自动更新或超时</strong></p>\n<h3 id=\"如何设置静态-ARP？\"><a href=\"#如何设置静态-ARP？\" class=\"headerlink\" title=\"如何设置静态 ARP？\"></a>如何设置静态 ARP？</h3><p><strong>在 Windows 上：</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看当前 ARP 缓存</span></span><br><span class=\"line\">arp <span class=\"literal\">-a</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 添加静态 ARP 条目（网关）</span></span><br><span class=\"line\"><span class=\"comment\"># 格式：arp -s &lt;IP地址&gt; &lt;MAC地址&gt;</span></span><br><span class=\"line\">arp <span class=\"literal\">-s</span> <span class=\"number\">192.168</span>.<span class=\"number\">2.1</span> <span class=\"number\">38</span><span class=\"literal\">-3d-5b-0c-92-1c</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 验证（类型应显示&quot;静态&quot;）</span></span><br><span class=\"line\">arp <span class=\"literal\">-a</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除静态条目</span></span><br><span class=\"line\">arp <span class=\"literal\">-d</span> <span class=\"number\">192.168</span>.<span class=\"number\">2.1</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>在 Linux 上：</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 添加静态 ARP</span></span><br><span class=\"line\">sudo arp -s 192.168.2.1 38:3d:5b:0c:92:1c</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 或使用 ip 命令（推荐）</span></span><br><span class=\"line\">sudo ip neigh add 192.168.2.1 lladdr 38:3d:5b:0c:92:1c dev eth0 nud permanent</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看</span></span><br><span class=\"line\">ip neigh show</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"应该对哪些设备设置静态-ARP？\"><a href=\"#应该对哪些设备设置静态-ARP？\" class=\"headerlink\" title=\"应该对哪些设备设置静态 ARP？\"></a>应该对哪些设备设置静态 ARP？</h3><p><strong>高价值目标（推荐设置静态 ARP）：</strong></p>\n<ul>\n<li>✅ <strong>网关&#x2F;路由器</strong>（192.168.2.1）</li>\n<li>✅ <strong>DNS 服务器</strong>（如果在局域网内）</li>\n<li>✅ <strong>核心服务器</strong>（数据库、文件服务器、域控制器）</li>\n<li>✅ <strong>安全设备</strong>（防火墙、IDS&#x2F;IPS）</li>\n<li>✅ <strong>关键工作站</strong>（管理员电脑、财务电脑）</li>\n</ul>\n<h3 id=\"静态-ARP-的局限性\"><a href=\"#静态-ARP-的局限性\" class=\"headerlink\" title=\"静态 ARP 的局限性\"></a>静态 ARP 的局限性</h3><p><strong>缺点：</strong></p>\n<ul>\n<li>🔧 手动维护成本高（设备更换 MAC 需要手动更新）</li>\n<li>📱 不适合 DHCP 环境（IP 会变化）</li>\n<li>🌐 无法大规模部署（大型网络不现实）</li>\n</ul>\n<p><strong>更好的防护方案：</strong></p>\n<ul>\n<li>交换机启用 <strong>DAI（Dynamic ARP Inspection）</strong></li>\n<li>部署 <strong>ARP 防护软件</strong>（如 ARPwatch）</li>\n<li>使用 <strong>802.1X 网络接入认证</strong></li>\n</ul>\n<hr>\n<h2 id=\"3️⃣-🔍-异常-ARP-流量可能是攻击信号\"><a href=\"#3️⃣-🔍-异常-ARP-流量可能是攻击信号\" class=\"headerlink\" title=\"3️⃣ 🔍 异常 ARP 流量可能是攻击信号\"></a>3️⃣ 🔍 异常 ARP 流量可能是攻击信号</h2><h3 id=\"如何检测异常-ARP-流量？\"><a href=\"#如何检测异常-ARP-流量？\" class=\"headerlink\" title=\"如何检测异常 ARP 流量？\"></a>如何检测异常 ARP 流量？</h3><h3 id=\"🚨-可疑信号-1：频繁的-ARP-请求-x2F-应答\"><a href=\"#🚨-可疑信号-1：频繁的-ARP-请求-x2F-应答\" class=\"headerlink\" title=\"🚨 可疑信号 1：频繁的 ARP 请求&#x2F;应答\"></a>🚨 可疑信号 1：频繁的 ARP 请求&#x2F;应答</h3><p><strong>正常情况：</strong></p>\n<ul>\n<li>ARP 请求偶尔出现（缓存过期时）</li>\n<li>每个 IP 只有少量 ARP 流量</li>\n</ul>\n<p><strong>异常情况：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">连续的 ARP 应答（无对应请求）：</span><br><span class=\"line\">192.168.2.1 is at aa:bb:cc:dd:ee:ff</span><br><span class=\"line\">192.168.2.1 is at aa:bb:cc:dd:ee:ff</span><br><span class=\"line\">192.168.2.1 is at aa:bb:cc:dd:ee:ff</span><br><span class=\"line\">↑ 攻击者不断发送伪造应答，维持欺骗</span><br></pre></td></tr></table></figure>\n\n<p><strong>在 Wireshark 中检测：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">显示过滤器：</span><br><span class=\"line\">arp &amp;&amp; arp.opcode == 2 &amp;&amp; !arp.isgratuitous</span><br><span class=\"line\"></span><br><span class=\"line\">统计：</span><br><span class=\"line\">Statistics → Conversations → Ethernet</span><br><span class=\"line\">查看 ARP 流量占比，正常应 &lt; 1%</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"🚨-可疑信号-2：MAC-地址频繁变化\"><a href=\"#🚨-可疑信号-2：MAC-地址频繁变化\" class=\"headerlink\" title=\"🚨 可疑信号 2：MAC 地址频繁变化\"></a>🚨 可疑信号 2：MAC 地址频繁变化</h3><p><strong>正常情况：</strong></p>\n<ul>\n<li>一个 IP 对应的 MAC 地址稳定</li>\n<li>除非设备重启或更换网卡</li>\n</ul>\n<p><strong>异常情况：</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 第一次查询</span></span><br><span class=\"line\">arp <span class=\"literal\">-a</span></span><br><span class=\"line\"><span class=\"number\">192.168</span>.<span class=\"number\">2.1</span>    <span class=\"number\">38</span><span class=\"literal\">-3d-5b-0c-92-1c</span>    动态</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 10秒后再查</span></span><br><span class=\"line\">arp <span class=\"literal\">-a</span></span><br><span class=\"line\"><span class=\"number\">192.168</span>.<span class=\"number\">2.1</span>    aa<span class=\"literal\">-bb-cc-dd-ee-ff</span>    动态  ← MAC 变了！</span><br></pre></td></tr></table></figure>\n\n<p><strong>检测方法：</strong></p>\n<ul>\n<li>使用 <strong>ARPwatch</strong> 监控 IP-MAC 绑定变化</li>\n<li>在 Wireshark 中过滤同一 IP 的多个 MAC：<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">arp.src.proto_ipv4 == 192.168.2.1</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"🚨-可疑信号-3：Gratuitous-ARP（免费-ARP）滥用\"><a href=\"#🚨-可疑信号-3：Gratuitous-ARP（免费-ARP）滥用\" class=\"headerlink\" title=\"🚨 可疑信号 3：Gratuitous ARP（免费 ARP）滥用\"></a>🚨 可疑信号 3：Gratuitous ARP（免费 ARP）滥用</h3><p><strong>正常 Gratuitous ARP：</strong></p>\n<ul>\n<li>设备启动时通告自己的 IP-MAC</li>\n<li>格式：发送者 IP &#x3D; 目标 IP</li>\n</ul>\n<p><strong>攻击滥用：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">攻击者发送：</span><br><span class=\"line\">Sender IP: 192.168.2.1（网关 IP）</span><br><span class=\"line\">Sender MAC: 攻击者的 MAC</span><br><span class=\"line\">Target IP: 192.168.2.1</span><br><span class=\"line\">Target MAC: ff:ff:ff:ff:ff:ff（广播）</span><br></pre></td></tr></table></figure>\n\n<p><strong>Wireshark 检测：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">显示过滤器：</span><br><span class=\"line\">arp.isgratuitous == 1</span><br><span class=\"line\"></span><br><span class=\"line\">观察：</span><br><span class=\"line\">- 是否来自合法设备？</span><br><span class=\"line\">- 频率是否异常？</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"🚨-可疑信号-4：ARP-扫描\"><a href=\"#🚨-可疑信号-4：ARP-扫描\" class=\"headerlink\" title=\"🚨 可疑信号 4：ARP 扫描\"></a>🚨 可疑信号 4：ARP 扫描</h3><p><strong>攻击者扫描网段：</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 攻击者对所有 IP 发送 ARP 请求</span></span><br><span class=\"line\">Who has <span class=\"number\">192.168</span>.<span class=\"number\">2.1</span>? Tell <span class=\"number\">192.168</span>.<span class=\"number\">2.100</span></span><br><span class=\"line\">Who has <span class=\"number\">192.168</span>.<span class=\"number\">2.2</span>? Tell <span class=\"number\">192.168</span>.<span class=\"number\">2.100</span></span><br><span class=\"line\">Who has <span class=\"number\">192.168</span>.<span class=\"number\">2.3</span>? Tell <span class=\"number\">192.168</span>.<span class=\"number\">2.100</span></span><br><span class=\"line\">...</span><br><span class=\"line\">Who has <span class=\"number\">192.168</span>.<span class=\"number\">2.254</span>? Tell <span class=\"number\">192.168</span>.<span class=\"number\">2.100</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>特征：</strong></p>\n<ul>\n<li>来自同一源 MAC 的大量 ARP 请求</li>\n<li>目标 IP 连续递增</li>\n</ul>\n<hr>\n<h2 id=\"💡-综合防护建议\"><a href=\"#💡-综合防护建议\" class=\"headerlink\" title=\"💡 综合防护建议\"></a>💡 综合防护建议</h2><h3 id=\"个人-x2F-小型网络\"><a href=\"#个人-x2F-小型网络\" class=\"headerlink\" title=\"个人&#x2F;小型网络\"></a>个人&#x2F;小型网络</h3><ol>\n<li>✅ 关键设备设置静态 ARP（网关、服务器）</li>\n<li>✅ 定期检查 ARP 缓存是否异常</li>\n<li>✅ 使用 HTTPS、SSH 等加密协议</li>\n<li>✅ 安装 ARP 防火墙软件（如 ARPGuard）</li>\n</ol>\n<h3 id=\"企业网络\"><a href=\"#企业网络\" class=\"headerlink\" title=\"企业网络\"></a>企业网络</h3><ol>\n<li>✅ 交换机启用 <strong>DAI（Dynamic ARP Inspection）</strong><ul>\n<li>验证 ARP 包的合法性</li>\n<li>与 DHCP Snooping 结合使用</li>\n</ul>\n</li>\n<li>✅ 部署 <strong>ARPwatch</strong> 或 SIEM 监控</li>\n<li>✅ 使用 <strong>802.1X</strong> 网络接入认证</li>\n<li>✅ 网络分段（VLAN）隔离关键系统</li>\n<li>✅ 启用交换机端口安全（Port Security）</li>\n</ol>\n<h3 id=\"Wireshark-检测命令速查\"><a href=\"#Wireshark-检测命令速查\" class=\"headerlink\" title=\"Wireshark 检测命令速查\"></a>Wireshark 检测命令速查</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 只看 ARP 流量</span><br><span class=\"line\">arp</span><br><span class=\"line\"></span><br><span class=\"line\"># 只看 ARP 应答</span><br><span class=\"line\">arp.opcode == 2</span><br><span class=\"line\"></span><br><span class=\"line\"># 检测 Gratuitous ARP</span><br><span class=\"line\">arp.isgratuitous == 1</span><br><span class=\"line\"></span><br><span class=\"line\"># 检测同一 IP 的多个 MAC（欺骗）</span><br><span class=\"line\">arp.src.proto_ipv4 == 192.168.2.1</span><br><span class=\"line\"></span><br><span class=\"line\"># 检测 ARP 风暴（大量请求）</span><br><span class=\"line\">arp.opcode == 1</span><br><span class=\"line\"></span><br><span class=\"line\"># 统计 ARP 流量占比</span><br><span class=\"line\">Statistics → Protocol Hierarchy</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"🎯-实战验证（仅在授权靶场）\"><a href=\"#🎯-实战验证（仅在授权靶场）\" class=\"headerlink\" title=\"🎯 实战验证（仅在授权靶场）\"></a>🎯 实战验证（仅在授权靶场）</h2><p><strong>Day 后续会涉及的实验：</strong></p>\n<ul>\n<li>Week 5-6：使用 Ettercap&#x2F;arpspoof 演示 ARP 欺骗（仅靶场）</li>\n<li>Week 7：配置交换机 DAI 防护</li>\n<li>Week 10：在 SIEM 中配置 ARP 异常告警规则</li>\n</ul>\n<p><strong>安全边界：</strong></p>\n<ul>\n<li>⛔ 禁止在未授权网络进行 ARP 欺骗测试</li>\n<li>⛔ 禁止对生产环境设备进行攻击性测试</li>\n<li>✅ 仅在自建虚拟机网络或授权靶场实验</li>\n</ul>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day001：网络与协议基础 - 网络总览与模型","url":"/post/d82a17eb.html","content":"<p>Day001：网络与协议基础 - 网络总览与模型</p>\n<ul>\n<li>日期：2025-12-25</li>\n<li>周次：第1周</li>\n</ul>\n<span id=\"more\"></span>\n\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><ul>\n<li>理解 OSI 与 TCP&#x2F;IP 模型的层次与职责</li>\n<li>认识常用网络术语（主机、接口、路由、网关、子网等）</li>\n</ul>\n<h2 id=\"学习内容\"><a href=\"#学习内容\" class=\"headerlink\" title=\"学习内容\"></a>学习内容</h2><h3 id=\"📚-OSI-七层模型详解\"><a href=\"#📚-OSI-七层模型详解\" class=\"headerlink\" title=\"📚 OSI 七层模型详解\"></a>📚 OSI 七层模型详解</h3><p><strong>OSI（Open Systems Interconnection，开放系统互连）</strong>是国际标准化组织（ISO）制定的网络通信标准模型，将网络通信分为 7 层：</p>\n<p><strong>第 7 层 - 应用层（Application Layer）</strong></p>\n<ul>\n<li>职责：为应用程序提供网络服务接口</li>\n<li>示例协议：HTTP、HTTPS、FTP、SMTP（邮件）、DNS、SSH</li>\n<li>数据单位：数据（Data）</li>\n<li>例子：浏览器访问网页时使用的 HTTP 协议</li>\n</ul>\n<p><strong>第 6 层 - 表示层（Presentation Layer）</strong></p>\n<ul>\n<li>职责：数据格式转换、加密解密、压缩解压</li>\n<li>示例：SSL&#x2F;TLS 加密、JPEG&#x2F;GIF 图片编码、ASCII&#x2F;Unicode 字符编码</li>\n<li>数据单位：数据（Data）</li>\n<li>例子：HTTPS 中的数据加密</li>\n</ul>\n<p><strong>第 5 层 - 会话层（Session Layer）</strong></p>\n<ul>\n<li>职责：建立、管理、终止会话连接</li>\n<li>示例：NetBIOS、RPC（远程过程调用）</li>\n<li>数据单位：数据（Data）</li>\n<li>例子：视频会议时保持多个数据流的同步</li>\n</ul>\n<p><strong>第 4 层 - 传输层（Transport Layer）</strong></p>\n<ul>\n<li>职责：端到端的可靠传输、流量控制、错误检测</li>\n<li>示例协议：TCP（可靠连接）、UDP（无连接快速）</li>\n<li>数据单位：段（Segment - TCP）或数据报（Datagram - UDP）</li>\n<li>关键概念：端口号（0-65535）</li>\n<li>例子：HTTP 使用 TCP 80 端口，DNS 使用 UDP 53 端口</li>\n</ul>\n<p><strong>第 3 层 - 网络层（Network Layer）</strong></p>\n<ul>\n<li>职责：路由选择、IP 地址寻址、跨网络传输</li>\n<li>示例协议：IP、ICMP（ping 命令）、路由协议（OSPF、BGP）</li>\n<li>数据单位：数据包（Packet）</li>\n<li>关键概念：IP 地址（如 192.168.2.5）</li>\n<li>例子：路由器根据 IP 地址转发数据包</li>\n</ul>\n<p><strong>第 2 层 - 数据链路层（Data Link Layer）</strong></p>\n<ul>\n<li>职责：相邻节点间的数据传输、帧同步、错误检测</li>\n<li>示例协议：以太网（Ethernet）、Wi-Fi（802.11）、PPP、ARP</li>\n<li>数据单位：帧（Frame）</li>\n<li>关键概念：MAC 地址（物理地址，如 C8-15-4E-A8-D3-FB）</li>\n<li>例子：交换机根据 MAC 地址转发数据帧</li>\n</ul>\n<p><strong>第 1 层 - 物理层（Physical Layer）</strong></p>\n<ul>\n<li>职责：比特流传输、电气信号规范</li>\n<li>示例：网线（RJ45）、光纤、无线电波、USB</li>\n<li>数据单位：比特（Bit）</li>\n<li>例子：网线中的电压信号、Wi-Fi 的无线电波</li>\n</ul>\n<h3 id=\"🌐-TCP-x2F-IP-四层模型详解\"><a href=\"#🌐-TCP-x2F-IP-四层模型详解\" class=\"headerlink\" title=\"🌐 TCP&#x2F;IP 四层模型详解\"></a>🌐 TCP&#x2F;IP 四层模型详解</h3><p><strong>TCP&#x2F;IP</strong> 是互联网实际使用的协议栈模型，比 OSI 更简化实用：</p>\n<p><strong>第 4 层 - 应用层（Application Layer）</strong></p>\n<ul>\n<li>对应 OSI：第 5、6、7 层（会话层+表示层+应用层）</li>\n<li>示例协议：HTTP、FTP、SMTP、DNS、SSH、Telnet</li>\n<li>说明：直接为用户应用提供服务</li>\n</ul>\n<p><strong>第 3 层 - 传输层（Transport Layer）</strong></p>\n<ul>\n<li>对应 OSI：第 4 层</li>\n<li>示例协议：TCP、UDP</li>\n<li>说明：端到端通信，TCP 可靠，UDP 快速</li>\n</ul>\n<p><strong>第 2 层 - 网络层&#x2F;互联网层（Internet Layer）</strong></p>\n<ul>\n<li>对应 OSI：第 3 层</li>\n<li>示例协议：IP、ICMP、ARP</li>\n<li>说明：IP 寻址和路由</li>\n</ul>\n<p><strong>第 1 层 - 网络接口层（Network Interface Layer）</strong></p>\n<ul>\n<li>对应 OSI：第 1、2 层（物理层+数据链路层）</li>\n<li>示例：以太网、Wi-Fi</li>\n<li>说明：物理网络硬件接口</li>\n</ul>\n<h3 id=\"📊-OSI-与-TCP-x2F-IP-映射对照表\"><a href=\"#📊-OSI-与-TCP-x2F-IP-映射对照表\" class=\"headerlink\" title=\"📊 OSI 与 TCP&#x2F;IP 映射对照表\"></a>📊 OSI 与 TCP&#x2F;IP 映射对照表</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">OSI 七层模型          TCP/IP 四层          协议示例              数据单位</span><br><span class=\"line\">─────────────────────────────────────────────────────────────</span><br><span class=\"line\">7. 应用层    ┐                           HTTP, FTP, DNS</span><br><span class=\"line\">6. 表示层    ├──────→  应用层            SMTP, SSH, Telnet      数据</span><br><span class=\"line\">5. 会话层    ┘                           </span><br><span class=\"line\"></span><br><span class=\"line\">4. 传输层    ────────→  传输层           TCP, UDP               段/数据报</span><br><span class=\"line\"></span><br><span class=\"line\">3. 网络层    ────────→  网络层           IP, ICMP, ARP          数据包</span><br><span class=\"line\"></span><br><span class=\"line\">2. 数据链路层 ┐</span><br><span class=\"line\">             ├──────→  网络接口层        以太网, Wi-Fi          帧/比特</span><br><span class=\"line\">1. 物理层    ┘</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"🔄-数据封装与解封装过程\"><a href=\"#🔄-数据封装与解封装过程\" class=\"headerlink\" title=\"🔄 数据封装与解封装过程\"></a>🔄 数据封装与解封装过程</h3><p>当你访问网页 <a href=\"http://www.baidu.com/\">http://www.baidu.com</a> 时，数据经过以下封装：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[应用层] HTTP 请求报文：&quot;GET / HTTP/1.1&quot;</span><br><span class=\"line\">    ↓ 添加 TCP 头部</span><br><span class=\"line\">[传输层] TCP 段（源端口、目标端口 80、序列号、确认号）</span><br><span class=\"line\">    ↓ 添加 IP 头部</span><br><span class=\"line\">[网络层] IP 数据包（源 IP: 192.168.2.5、目标 IP: 百度服务器）</span><br><span class=\"line\">    ↓ 添加以太网帧头</span><br><span class=\"line\">[数据链路层] 以太网帧（源 MAC、目标 MAC: 网关 MAC）</span><br><span class=\"line\">    ↓ 转换为信号</span><br><span class=\"line\">[物理层] 无线电波/电信号 → 比特流传输</span><br></pre></td></tr></table></figure>\n\n<p>接收端进行相反的解封装过程，逐层剥离头部，最终得到 HTTP 响应数据。</p>\n<h2 id=\"实践任务（合法授权范围内）\"><a href=\"#实践任务（合法授权范围内）\" class=\"headerlink\" title=\"实践任务（合法授权范围内）\"></a>实践任务（合法授权范围内）</h2><ul>\n<li>在本机使用 ipconfig&#x2F;ifconfig 查看网络配置，识别网关与子网掩码</li>\n<li>画出本地网络示意图（主机、交换机&#x2F;路由器、网关）</li>\n</ul>\n<h2 id=\"巩固练习（题与复盘）\"><a href=\"#巩固练习（题与复盘）\" class=\"headerlink\" title=\"巩固练习（题与复盘）\"></a>巩固练习（题与复盘）</h2><h3 id=\"练习-1：用自己的话总结-OSI-与-TCP-x2F-IP-的层级映射\"><a href=\"#练习-1：用自己的话总结-OSI-与-TCP-x2F-IP-的层级映射\" class=\"headerlink\" title=\"练习 1：用自己的话总结 OSI 与 TCP&#x2F;IP 的层级映射\"></a>练习 1：用自己的话总结 OSI 与 TCP&#x2F;IP 的层级映射</h3><p><strong>答案</strong>：</p>\n<ul>\n<li>OSI 的应用层、表示层、会话层（上三层）合并为 TCP&#x2F;IP 的应用层</li>\n<li>OSI 的传输层对应 TCP&#x2F;IP 的传输层</li>\n<li>OSI 的网络层对应 TCP&#x2F;IP 的网络层</li>\n<li>OSI 的数据链路层和物理层（下两层）合并为 TCP&#x2F;IP 的网络接口层</li>\n<li><strong>简记</strong>：OSI 7层 → TCP&#x2F;IP 4层（3+1+1+2 &#x3D; 4）</li>\n</ul>\n<h3 id=\"练习-2：小测-指出-HTTP-x2F-TCP-x2F-IP-x2F-以太网分别位于哪一层\"><a href=\"#练习-2：小测-指出-HTTP-x2F-TCP-x2F-IP-x2F-以太网分别位于哪一层\" class=\"headerlink\" title=\"练习 2：小测 - 指出 HTTP&#x2F;TCP&#x2F;IP&#x2F;以太网分别位于哪一层\"></a>练习 2：小测 - 指出 HTTP&#x2F;TCP&#x2F;IP&#x2F;以太网分别位于哪一层</h3><table>\n<thead>\n<tr>\n<th>协议&#x2F;技术</th>\n<th>OSI 模型</th>\n<th>TCP&#x2F;IP 模型</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>HTTP</strong></td>\n<td>第 7 层（应用层）</td>\n<td>第 4 层（应用层）</td>\n<td>网页传输协议</td>\n</tr>\n<tr>\n<td><strong>TCP</strong></td>\n<td>第 4 层（传输层）</td>\n<td>第 3 层（传输层）</td>\n<td>可靠传输协议</td>\n</tr>\n<tr>\n<td><strong>IP</strong></td>\n<td>第 3 层（网络层）</td>\n<td>第 2 层（网络层）</td>\n<td>网络寻址协议</td>\n</tr>\n<tr>\n<td><strong>以太网</strong></td>\n<td>第 2 层（数据链路层）</td>\n<td>第 1 层（网络接口层）</td>\n<td>局域网技术</td>\n</tr>\n</tbody></table>\n<h2 id=\"评估标准（达成判定）\"><a href=\"#评估标准（达成判定）\" class=\"headerlink\" title=\"评估标准（达成判定）\"></a>评估标准（达成判定）</h2><ul>\n<li>能正确解释每层的职责并给出示例协议</li>\n<li>能根据输出识别本机网络的关键参数</li>\n</ul>\n<h2 id=\"学习成果达成情况（由学习者填写）\"><a href=\"#学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"学习成果达成情况（由学习者填写）\"></a>学习成果达成情况（由学习者填写）</h2><ul>\n<li><p>截图与证据：已完成网络配置查看</p>\n</li>\n<li><p>关键命令与输出：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看详细网络配置</span></span><br><span class=\"line\">ipconfig /all</span><br><span class=\"line\"><span class=\"comment\"># 输出显示：</span></span><br><span class=\"line\"><span class=\"comment\"># - 活动网络接口：WLAN 3（Intel Wi-Fi 6E AX210）</span></span><br><span class=\"line\"><span class=\"comment\"># - IPv4 地址：192.168.2.5</span></span><br><span class=\"line\"><span class=\"comment\"># - 子网掩码：255.255.255.0</span></span><br><span class=\"line\"><span class=\"comment\"># - 默认网关：192.168.2.1</span></span><br><span class=\"line\"><span class=\"comment\"># - DHCP 服务器：192.168.2.1</span></span><br><span class=\"line\"><span class=\"comment\"># - DNS 服务器：192.168.2.1</span></span><br><span class=\"line\"><span class=\"comment\"># - 物理地址（MAC）：C8-15-4E-A8-D3-FB</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看路由表</span></span><br><span class=\"line\">route print</span><br><span class=\"line\"><span class=\"comment\"># 默认路由：0.0.0.0 -&gt; 192.168.2.1（所有非本地网络流量都转发到网关）</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>结论与反思：</p>\n<ul>\n<li>✅ <strong>网络拓扑理解</strong>：本机通过 Wi-Fi 连接到家庭路由器（192.168.2.1），路由器作为默认网关负责将流量转发到互联网</li>\n<li>✅ <strong>OSI&#x2F;TCP-IP 层次映射</strong>：<ul>\n<li>应用层：HTTP、DNS 等应用协议</li>\n<li>传输层：TCP&#x2F;UDP（端口通信）</li>\n<li>网络层：IP 协议（192.168.2.5 地址）</li>\n<li>数据链路层：以太网&#x2F;Wi-Fi（MAC 地址 C8-15-4E-A8-D3-FB）</li>\n<li>物理层：无线电波信号</li>\n</ul>\n</li>\n<li>✅ <strong>关键术语理解</strong>：<ul>\n<li><strong>主机</strong>：本机 192.168.2.5</li>\n<li><strong>接口</strong>：WLAN 3 无线网卡</li>\n<li><strong>网关</strong>：192.168.2.1（路由器）</li>\n<li><strong>子网</strong>：192.168.2.0&#x2F;24（可容纳 254 个主机）</li>\n<li><strong>子网掩码</strong>：255.255.255.0（定义网络和主机部分）</li>\n</ul>\n</li>\n<li>📊 <strong>本地网络示意图</strong>：<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">互联网</span><br><span class=\"line\">  ↑</span><br><span class=\"line\">[路由器/网关 192.168.2.1] ← DHCP + DNS 服务器</span><br><span class=\"line\">  ↓ (无线)</span><br><span class=\"line\">[本机 WLAN 3: 192.168.2.5]</span><br><span class=\"line\">子网：192.168.2.0/24</span><br></pre></td></tr></table></figure></li>\n<li>💡 <strong>扩展思考</strong>：路由表中 0.0.0.0&#x2F;0 是默认路由，匹配所有不在本地网络的流量；DHCP 自动分配 IP，租约为 24 小时</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"📝-巩固练习完成情况\"><a href=\"#📝-巩固练习完成情况\" class=\"headerlink\" title=\"📝 巩固练习完成情况\"></a>📝 巩固练习完成情况</h3><p><strong>练习 1 - OSI 与 TCP&#x2F;IP 层级映射总结</strong>：</p>\n<ul>\n<li>✅ 已理解：TCP&#x2F;IP 是 OSI 的简化实用版本</li>\n<li>✅ 映射关系：OSI 上三层合并为应用层，中间两层一一对应，下两层合并为网络接口层</li>\n</ul>\n<p><strong>练习 2 - 协议层次判断</strong>：</p>\n<ul>\n<li>✅ HTTP（应用层）→ TCP（传输层）→ IP（网络层）→ 以太网（数据链路层）</li>\n<li>✅ 理解：访问网页时，HTTP 数据依次被 TCP、IP、以太网封装，形成”洋葱模型”</li>\n</ul>\n<p><strong>数据封装实例理解</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">访问百度的过程：</span><br><span class=\"line\">1. 应用层：生成 HTTP GET 请求</span><br><span class=\"line\">2. 传输层：TCP 添加端口信息（源端口随机，目标端口 80）</span><br><span class=\"line\">3. 网络层：IP 添加地址（源 192.168.2.5，目标百度 IP）</span><br><span class=\"line\">4. 数据链路层：以太网添加 MAC 地址（目标是网关 MAC）</span><br><span class=\"line\">5. 物理层：Wi-Fi 无线电波传输</span><br><span class=\"line\">6. 数据到达网关后，网关剥离以太网帧，根据 IP 路由到下一跳</span><br></pre></td></tr></table></figure>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"centos开放指定端口","url":"/post/f39c9d09.html","content":"<center>centos7开放指定端口</center>\n\n<span id=\"more\"></span>\n\n<h4 id=\"开启指定端口：\"><a href=\"#开启指定端口：\" class=\"headerlink\" title=\"开启指定端口：\"></a>开启指定端口：</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --add-port=端口号/tcp --permanent</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"开启指定端口后必须重启防火墙，重启命令\"><a href=\"#开启指定端口后必须重启防火墙，重启命令\" class=\"headerlink\" title=\"开启指定端口后必须重启防火墙，重启命令\"></a>开启指定端口后必须重启防火墙，重启命令</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">systemctl restart firewalld.service</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"查看防火墙状态\"><a href=\"#查看防火墙状态\" class=\"headerlink\" title=\"查看防火墙状态\"></a>查看防火墙状态</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">systemctl status firewalld.service</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"开启防火墙\"><a href=\"#开启防火墙\" class=\"headerlink\" title=\"开启防火墙\"></a>开启防火墙</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">systemctl start firewalld.service</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"禁止开机启动\"><a href=\"#禁止开机启动\" class=\"headerlink\" title=\"禁止开机启动\"></a>禁止开机启动</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">systemctl disable firewalld.service</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"开启开机启动\"><a href=\"#开启开机启动\" class=\"headerlink\" title=\"开启开机启动\"></a>开启开机启动</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">systemctl enable firewalld.service</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"查看已开放端口\"><a href=\"#查看已开放端口\" class=\"headerlink\" title=\"查看已开放端口\"></a>查看已开放端口</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">firewall-cmd --list-ports</span><br></pre></td></tr></table></figure>\n\n","categories":["centos"],"tags":["centos","防火墙","端口"]},{"title":"Day003：网络与协议基础 - IP、ICMP 与路由基础","url":"/post/eb37acc3.html","content":"<p>Day003：网络与协议基础 - IP、ICMP 与路由基础</p>\n<ul>\n<li>日期：2025-12-27</li>\n<li>周次：第 1 周</li>\n</ul>\n<span id=\"more\"></span>\n\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><ul>\n<li>理解 IP 寻址与子网划分</li>\n<li>掌握 Ping&#x2F;Traceroute 的用途与差异</li>\n</ul>\n<h2 id=\"学习内容\"><a href=\"#学习内容\" class=\"headerlink\" title=\"学习内容\"></a>学习内容</h2><h3 id=\"1️⃣-IPv4-地址与子网划分\"><a href=\"#1️⃣-IPv4-地址与子网划分\" class=\"headerlink\" title=\"1️⃣ IPv4 地址与子网划分\"></a>1️⃣ IPv4 地址与子网划分</h3><p><strong>IPv4 地址结构：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">IP 地址 = 网络部分 + 主机部分</span><br><span class=\"line\">192.168.2.5/24</span><br><span class=\"line\">├─────┬─────┤ └─┘</span><br><span class=\"line\">│     │     │   └─ 主机位（8位）</span><br><span class=\"line\">│     │     └───── 子网掩码长度</span><br><span class=\"line\">└─────┴─────────── 网络位（24位）</span><br></pre></td></tr></table></figure>\n\n<p><strong>子网掩码的作用：</strong></p>\n<ul>\n<li><strong>区分网络部分和主机部分</strong></li>\n<li><code>/24</code> &#x3D; <code>255.255.255.0</code>（前 24 位为 1）</li>\n<li><code>/16</code> &#x3D; <code>255.255.0.0</code>（前 16 位为 1）</li>\n</ul>\n<p><strong>IPv4 地址分类（已过时，了解即可）：</strong></p>\n<table>\n<thead>\n<tr>\n<th>类别</th>\n<th>起始地址</th>\n<th>默认掩码</th>\n<th>网络数</th>\n<th>主机数</th>\n<th>用途</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>A 类</td>\n<td>1.0.0.0 - 126.0.0.0</td>\n<td>&#x2F;8</td>\n<td>126</td>\n<td>16,777,214</td>\n<td>大型网络</td>\n</tr>\n<tr>\n<td>B 类</td>\n<td>128.0.0.0 - 191.255.0.0</td>\n<td>&#x2F;16</td>\n<td>16,384</td>\n<td>65,534</td>\n<td>中型网络</td>\n</tr>\n<tr>\n<td>C 类</td>\n<td>192.0.0.0 - 223.255.255.0</td>\n<td>&#x2F;24</td>\n<td>2,097,152</td>\n<td>254</td>\n<td>小型网络</td>\n</tr>\n</tbody></table>\n<p><strong>特殊 IP 地址：</strong></p>\n<table>\n<thead>\n<tr>\n<th>地址范围</th>\n<th>说明</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>0.0.0.0&#x2F;8</strong></td>\n<td>本网络</td>\n<td>0.0.0.0 表示”任意地址”</td>\n</tr>\n<tr>\n<td><strong>127.0.0.0&#x2F;8</strong></td>\n<td>本地回环</td>\n<td>127.0.0.1（localhost）</td>\n</tr>\n<tr>\n<td><strong>10.0.0.0&#x2F;8</strong></td>\n<td>私有 A 类</td>\n<td>10.x.x.x</td>\n</tr>\n<tr>\n<td><strong>172.16.0.0&#x2F;12</strong></td>\n<td>私有 B 类</td>\n<td>172.16-31.x.x</td>\n</tr>\n<tr>\n<td><strong>192.168.0.0&#x2F;16</strong></td>\n<td>私有 C 类</td>\n<td>192.168.x.x</td>\n</tr>\n<tr>\n<td><strong>169.254.0.0&#x2F;16</strong></td>\n<td>APIPA</td>\n<td>DHCP 失败时自动分配</td>\n</tr>\n<tr>\n<td><strong>224.0.0.0&#x2F;4</strong></td>\n<td>多播地址</td>\n<td>224.x.x.x</td>\n</tr>\n</tbody></table>\n<p><strong>子网划分示例：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">网络：192.168.2.0/24</span><br><span class=\"line\"></span><br><span class=\"line\">计算过程：</span><br><span class=\"line\">├─ 网络地址：192.168.2.0（主机位全0）</span><br><span class=\"line\">├─ 广播地址：192.168.2.255（主机位全1）</span><br><span class=\"line\">├─ 可用主机范围：192.168.2.1 - 192.168.2.254</span><br><span class=\"line\">└─ 可用主机数：2^8 - 2 = 254</span><br><span class=\"line\"></span><br><span class=\"line\">公式：可用主机数 = 2^主机位数 - 2</span><br><span class=\"line\">（减2：网络地址和广播地址不可用）</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2️⃣-网关与路由表\"><a href=\"#2️⃣-网关与路由表\" class=\"headerlink\" title=\"2️⃣ 网关与路由表\"></a>2️⃣ 网关与路由表</h3><p><strong>默认网关（Default Gateway）：</strong></p>\n<ul>\n<li>本网段数据的”出口”</li>\n<li>访问其他网段的数据必须通过网关</li>\n<li>通常是路由器的 LAN 侧接口</li>\n</ul>\n<p><strong>路由表（Routing Table）：</strong><br>路由表决定数据包的转发路径。</p>\n<p><strong>Windows 路由表格式：</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">route print</span><br><span class=\"line\"></span><br><span class=\"line\">网络目标        网络掩码          网关          接口        跃点数</span><br><span class=\"line\"><span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>         <span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>       <span class=\"number\">192.168</span>.<span class=\"number\">2.1</span>   <span class=\"number\">192.168</span>.<span class=\"number\">2.5</span>     <span class=\"number\">35</span></span><br><span class=\"line\"><span class=\"number\">127.0</span>.<span class=\"number\">0.0</span>       <span class=\"number\">255.0</span>.<span class=\"number\">0.0</span>         在链路上    <span class=\"number\">127.0</span>.<span class=\"number\">0.1</span>      <span class=\"number\">331</span></span><br><span class=\"line\"><span class=\"number\">192.168</span>.<span class=\"number\">2.0</span>     <span class=\"number\">255.255</span>.<span class=\"number\">255.0</span>     在链路上    <span class=\"number\">192.168</span>.<span class=\"number\">2.5</span>    <span class=\"number\">291</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>路由表字段解释：</strong></p>\n<table>\n<thead>\n<tr>\n<th>字段</th>\n<th>说明</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>网络目标</strong></td>\n<td>目标网络地址</td>\n<td>0.0.0.0（默认路由）</td>\n</tr>\n<tr>\n<td><strong>网络掩码</strong></td>\n<td>子网掩码</td>\n<td>0.0.0.0（匹配所有）</td>\n</tr>\n<tr>\n<td><strong>网关</strong></td>\n<td>下一跳地址</td>\n<td>192.168.2.1（路由器）</td>\n</tr>\n<tr>\n<td><strong>接口</strong></td>\n<td>本地出接口</td>\n<td>192.168.2.5（本机 IP）</td>\n</tr>\n<tr>\n<td><strong>跃点数</strong></td>\n<td>路由成本</td>\n<td>数值越小优先级越高</td>\n</tr>\n</tbody></table>\n<p><strong>默认路由（0.0.0.0&#x2F;0）：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">含义：匹配所有目标地址</span><br><span class=\"line\">作用：当找不到更具体的路由时使用</span><br><span class=\"line\">就像：&quot;如果不知道怎么走,就去找网关&quot;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3️⃣-ICMP-协议（Internet-Control-Message-Protocol）\"><a href=\"#3️⃣-ICMP-协议（Internet-Control-Message-Protocol）\" class=\"headerlink\" title=\"3️⃣ ICMP 协议（Internet Control Message Protocol）\"></a>3️⃣ ICMP 协议（Internet Control Message Protocol）</h3><p><strong>ICMP 的作用：</strong></p>\n<ul>\n<li>网络诊断工具（Ping、Traceroute）</li>\n<li>错误报告（目标不可达、TTL 超时）</li>\n<li>不传输应用数据，只传输控制消息</li>\n</ul>\n<p><strong>ICMP 报文结构：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">┌──────┬──────┬──────────┬─────────┐</span><br><span class=\"line\">│ 类型 │ 代码 │ 校验和   │ 数据    │</span><br><span class=\"line\">│ 1字节│ 1字节│ 2字节    │ 可变    │</span><br><span class=\"line\">└──────┴──────┴──────────┴─────────┘</span><br></pre></td></tr></table></figure>\n\n<p><strong>常见 ICMP 类型：</strong></p>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>代码</th>\n<th>说明</th>\n<th>用途</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>0</strong></td>\n<td>0</td>\n<td>Echo Reply（回显应答）</td>\n<td>Ping 响应</td>\n</tr>\n<tr>\n<td><strong>3</strong></td>\n<td>0-15</td>\n<td>Destination Unreachable</td>\n<td>目标不可达</td>\n</tr>\n<tr>\n<td><strong>8</strong></td>\n<td>0</td>\n<td>Echo Request（回显请求）</td>\n<td>Ping 请求</td>\n</tr>\n<tr>\n<td><strong>11</strong></td>\n<td>0</td>\n<td>Time Exceeded（TTL 超时）</td>\n<td>Traceroute</td>\n</tr>\n</tbody></table>\n<p><strong>Ping 工作流程：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">主机 A (192.168.2.5) Ping 百度 (220.181.38.148)</span><br><span class=\"line\"></span><br><span class=\"line\">步骤 1: 发送 ICMP Echo Request</span><br><span class=\"line\">┌─────────────────────────────┐</span><br><span class=\"line\">│ IP 包头                     │</span><br><span class=\"line\">│ ├─ 源 IP: 192.168.2.5       │</span><br><span class=\"line\">│ ├─ 目标 IP: 220.181.38.148  │</span><br><span class=\"line\">│ └─ 协议: ICMP (1)           │</span><br><span class=\"line\">├─────────────────────────────┤</span><br><span class=\"line\">│ ICMP 包头                   │</span><br><span class=\"line\">│ ├─ 类型: 8（Echo Request）  │</span><br><span class=\"line\">│ ├─ 代码: 0                  │</span><br><span class=\"line\">│ ├─ 序列号: 1                │</span><br><span class=\"line\">│ └─ 标识符: 12345            │</span><br><span class=\"line\">├─────────────────────────────┤</span><br><span class=\"line\">│ 数据载荷（可选）            │</span><br><span class=\"line\">│ &quot;abcdefghijklmnop...&quot;       │</span><br><span class=\"line\">└─────────────────────────────┘</span><br><span class=\"line\"></span><br><span class=\"line\">步骤 2: 目标主机回复 ICMP Echo Reply</span><br><span class=\"line\">┌─────────────────────────────┐</span><br><span class=\"line\">│ IP 包头                     │</span><br><span class=\"line\">│ ├─ 源 IP: 220.181.38.148    │</span><br><span class=\"line\">│ ├─ 目标 IP: 192.168.2.5     │</span><br><span class=\"line\">│ └─ 协议: ICMP (1)           │</span><br><span class=\"line\">├─────────────────────────────┤</span><br><span class=\"line\">│ ICMP 包头                   │</span><br><span class=\"line\">│ ├─ 类型: 0（Echo Reply）    │</span><br><span class=\"line\">│ ├─ 代码: 0                  │</span><br><span class=\"line\">│ ├─ 序列号: 1（相同）        │</span><br><span class=\"line\">│ └─ 标识符: 12345（相同）    │</span><br><span class=\"line\">├─────────────────────────────┤</span><br><span class=\"line\">│ 数据载荷（原样返回）        │</span><br><span class=\"line\">│ &quot;abcdefghijklmnop...&quot;       │</span><br><span class=\"line\">└─────────────────────────────┘</span><br><span class=\"line\"></span><br><span class=\"line\">步骤 3: 计算 RTT（往返时间）</span><br><span class=\"line\">RTT = 接收时间 - 发送时间</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4️⃣-Traceroute-x2F-Tracert-工作原理\"><a href=\"#4️⃣-Traceroute-x2F-Tracert-工作原理\" class=\"headerlink\" title=\"4️⃣ Traceroute&#x2F;Tracert 工作原理\"></a>4️⃣ Traceroute&#x2F;Tracert 工作原理</h3><p><strong>目的：追踪数据包到达目标的完整路径</strong></p>\n<p><strong>核心机制：利用 IP 包的 TTL（Time To Live）字段</strong></p>\n<p><strong>TTL 的作用：</strong></p>\n<ul>\n<li>防止数据包在网络中无限循环</li>\n<li>每经过一个路由器，TTL 减 1</li>\n<li>TTL 减到 0 时，路由器丢弃包并回复 ICMP Time Exceeded</li>\n</ul>\n<p><strong>Traceroute 工作流程：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">目标：追踪到 baidu.com (220.181.38.148) 的路径</span><br><span class=\"line\"></span><br><span class=\"line\">第1轮：TTL=1</span><br><span class=\"line\">本机 ─────TTL=1─────&gt; 第1跳路由器</span><br><span class=\"line\">                      TTL减到0 ❌</span><br><span class=\"line\">本机 &lt;────ICMP超时──── 第1跳路由器</span><br><span class=\"line\">     &quot;我是 192.168.2.1&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">第2轮：TTL=2</span><br><span class=\"line\">本机 ─────TTL=2─────&gt; 第1跳 ─────TTL=1─────&gt; 第2跳路由器</span><br><span class=\"line\">                                              TTL减到0 ❌</span><br><span class=\"line\">本机 &lt;────────────────ICMP超时────────────── 第2跳路由器</span><br><span class=\"line\">     &quot;我是 61.144.56.1&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">第3轮：TTL=3</span><br><span class=\"line\">本机 ────&gt; 第1跳 ────&gt; 第2跳 ────&gt; 第3跳</span><br><span class=\"line\">                                  TTL减到0 ❌</span><br><span class=\"line\">本机 &lt;────────────ICMP超时──────── 第3跳</span><br><span class=\"line\">     &quot;我是 61.144.1.1&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">...依次递增 TTL，直到到达目标主机</span><br><span class=\"line\"></span><br><span class=\"line\">最后一轮：TTL=15</span><br><span class=\"line\">本机 ────&gt; ... ────&gt; 目标主机 (220.181.38.148)</span><br><span class=\"line\">                     收到探测包 ✅</span><br><span class=\"line\">本机 &lt;────ICMP Echo Reply──── 目标主机</span><br><span class=\"line\">     &quot;我是 220.181.38.148&quot;（到达目的地）</span><br></pre></td></tr></table></figure>\n\n<p><strong>Windows tracert vs Linux traceroute 的区别：</strong></p>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th>Windows <code>tracert</code></th>\n<th>Linux <code>traceroute</code></th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>使用协议</strong></td>\n<td>ICMP Echo Request</td>\n<td><strong>UDP</strong>（默认）</td>\n</tr>\n<tr>\n<td><strong>目标端口</strong></td>\n<td>-</td>\n<td>33434-33534</td>\n</tr>\n<tr>\n<td><strong>最后一跳识别</strong></td>\n<td>ICMP Echo Reply</td>\n<td>ICMP Port Unreachable</td>\n</tr>\n<tr>\n<td><strong>命令示例</strong></td>\n<td><code>tracert baidu.com</code></td>\n<td><code>traceroute baidu.com</code></td>\n</tr>\n</tbody></table>\n<p><strong>Linux traceroute 工作原理（UDP 模式）：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">发送 UDP 包到不存在的高端口（33434+）</span><br><span class=\"line\">├─ 中间路由器：TTL 超时 → ICMP Time Exceeded</span><br><span class=\"line\">└─ 目标主机：端口不可达 → ICMP Port Unreachable</span><br><span class=\"line\">   （表示到达目的地）</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"实践任务（合法授权范围内）\"><a href=\"#实践任务（合法授权范围内）\" class=\"headerlink\" title=\"实践任务（合法授权范围内）\"></a>实践任务（合法授权范围内）</h2><h3 id=\"🎯-任务-1-查看并分析路由表\"><a href=\"#🎯-任务-1-查看并分析路由表\" class=\"headerlink\" title=\"🎯 任务 1: 查看并分析路由表\"></a>🎯 任务 1: 查看并分析路由表</h3><p><strong>执行命令：</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">route print</span><br></pre></td></tr></table></figure>\n\n<p><strong>完整输出：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">===========================================================================</span><br><span class=\"line\">接口列表</span><br><span class=\"line\"> 22...84 a9 38 77 8e ac ......Realtek PCIe GbE Family Controller</span><br><span class=\"line\"> 15...00 ff 9f ad fc 6c ......TAP-Windows Adapter V9</span><br><span class=\"line\"> 11...f4 46 37 63 8d 8d ......Microsoft Wi-Fi Direct Virtual Adapter</span><br><span class=\"line\"> 19...f6 46 37 63 8d 8c ......Microsoft Wi-Fi Direct Virtual Adapter #2</span><br><span class=\"line\">  4...00 50 56 c0 00 01 ......VMware Virtual Ethernet Adapter for VMnet1</span><br><span class=\"line\"> 13...00 50 56 c0 00 08 ......VMware Virtual Ethernet Adapter for VMnet8</span><br><span class=\"line\">  6...f4 46 37 63 8d 8c ......Intel(R) Wi-Fi 6 AX201 160MHz</span><br><span class=\"line\"> 16...00 ff a4 bc 6c 7b ......Sangfor SSL VPN CS Support System VNIC</span><br><span class=\"line\"> 23...f4 46 37 63 8d 90 ......Bluetooth Device (Personal Area Network)</span><br><span class=\"line\">  1...........................Software Loopback Interface 1</span><br><span class=\"line\"> 14...00 00 00 00 00 00 00 e0 Microsoft Teredo Tunneling Adapter</span><br><span class=\"line\">===========================================================================</span><br><span class=\"line\"></span><br><span class=\"line\">IPv4 路由表</span><br><span class=\"line\">===========================================================================</span><br><span class=\"line\">活动路由:</span><br><span class=\"line\">网络目标        网络掩码          网关       接口   跃点数</span><br><span class=\"line\">          0.0.0.0          0.0.0.0   192.168.31.254    192.168.31.36    296</span><br><span class=\"line\">        127.0.0.0        255.0.0.0            在链路上         127.0.0.1    331</span><br><span class=\"line\">        127.0.0.1  255.255.255.255            在链路上         127.0.0.1    331</span><br><span class=\"line\">  127.255.255.255  255.255.255.255            在链路上         127.0.0.1    331</span><br><span class=\"line\">     192.168.31.0    255.255.255.0            在链路上     192.168.31.36    296</span><br><span class=\"line\">    192.168.31.36  255.255.255.255            在链路上     192.168.31.36    296</span><br><span class=\"line\">   192.168.31.255  255.255.255.255            在链路上     192.168.31.36    296</span><br><span class=\"line\">    192.168.124.0    255.255.255.0            在链路上     192.168.124.1    291</span><br><span class=\"line\">    192.168.124.1  255.255.255.255            在链路上     192.168.124.1    291</span><br><span class=\"line\">  192.168.124.255  255.255.255.255            在链路上     192.168.124.1    291</span><br><span class=\"line\">    192.168.254.0    255.255.255.0            在链路上     192.168.254.1    291</span><br><span class=\"line\">    192.168.254.1  255.255.255.255            在链路上     192.168.254.1    291</span><br><span class=\"line\">  192.168.254.255  255.255.255.255            在链路上     192.168.254.1    291</span><br><span class=\"line\">        224.0.0.0        240.0.0.0            在链路上         127.0.0.1    331</span><br><span class=\"line\">        224.0.0.0        240.0.0.0            在链路上     192.168.124.1    291</span><br><span class=\"line\">        224.0.0.0        240.0.0.0            在链路上     192.168.254.1    291</span><br><span class=\"line\">        224.0.0.0        240.0.0.0            在链路上     192.168.31.36    296</span><br><span class=\"line\">  255.255.255.255  255.255.255.255            在链路上         127.0.0.1    331</span><br><span class=\"line\">  255.255.255.255  255.255.255.255            在链路上     192.168.124.1    291</span><br><span class=\"line\">  255.255.255.255  255.255.255.255            在链路上     192.168.254.1    291</span><br><span class=\"line\">  255.255.255.255  255.255.255.255            在链路上     192.168.31.36    296</span><br><span class=\"line\">===========================================================================</span><br><span class=\"line\">永久路由:</span><br><span class=\"line\">  网络地址          网络掩码  网关地址  跃点数</span><br><span class=\"line\">          0.0.0.0          0.0.0.0   192.168.31.254     默认</span><br><span class=\"line\">          0.0.0.0          0.0.0.0   192.168.60.254     默认</span><br><span class=\"line\">===========================================================================</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"📊-路由表详细分析\"><a href=\"#📊-路由表详细分析\" class=\"headerlink\" title=\"📊 路由表详细分析\"></a>📊 路由表详细分析</h3><h4 id=\"1-接口列表解读\"><a href=\"#1-接口列表解读\" class=\"headerlink\" title=\"1. 接口列表解读\"></a><strong>1. 接口列表解读</strong></h4><table>\n<thead>\n<tr>\n<th>接口编号</th>\n<th>MAC 地址</th>\n<th>网络适配器</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>6</td>\n<td>f4:46:37:63:8d:8c</td>\n<td>Intel Wi-Fi 6 AX201</td>\n<td><strong>主要网卡</strong>（Wi-Fi 连接）</td>\n</tr>\n<tr>\n<td>22</td>\n<td>84:a9:38:77:8e:ac</td>\n<td>Realtek 有线网卡</td>\n<td>以太网适配器（未使用）</td>\n</tr>\n<tr>\n<td>4</td>\n<td>00:50:56:c0:00:01</td>\n<td>VMware VMnet1</td>\n<td>虚拟机私有网络</td>\n</tr>\n<tr>\n<td>13</td>\n<td>00:50:56:c0:00:08</td>\n<td>VMware VMnet8</td>\n<td>虚拟机 NAT 网络</td>\n</tr>\n<tr>\n<td>15</td>\n<td>00:ff:9f:ad:fc:6c</td>\n<td>TAP-Windows Adapter</td>\n<td>VPN 适配器</td>\n</tr>\n<tr>\n<td>16</td>\n<td>00:ff:a4:bc:6c:7b</td>\n<td>Sangfor SSL VPN</td>\n<td>企业 VPN</td>\n</tr>\n<tr>\n<td>1</td>\n<td>-</td>\n<td>Loopback Interface</td>\n<td>本地回环（127.0.0.1）</td>\n</tr>\n</tbody></table>\n<hr>\n<h4 id=\"2-核心路由条目解析\"><a href=\"#2-核心路由条目解析\" class=\"headerlink\" title=\"2. 核心路由条目解析\"></a><strong>2. 核心路由条目解析</strong></h4><p><strong>🌟 默认路由（Default Route）：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">网络目标: 0.0.0.0</span><br><span class=\"line\">网络掩码: 0.0.0.0</span><br><span class=\"line\">网关:     192.168.31.254</span><br><span class=\"line\">接口:     192.168.31.36</span><br><span class=\"line\">跃点数:   296</span><br></pre></td></tr></table></figure>\n\n<p><strong>含义解释：</strong></p>\n<ul>\n<li><strong>0.0.0.0&#x2F;0</strong>：匹配所有目标 IP 地址（万能路由）</li>\n<li><strong>作用</strong>：当目标 IP 不匹配任何其他路由时，使用此路由</li>\n<li><strong>网关 192.168.31.254</strong>：这是路由器&#x2F;网关的 IP 地址</li>\n<li><strong>接口 192.168.31.36</strong>：本机在该网络的 IP（Wi-Fi 接口）</li>\n<li><strong>工作流程</strong>：<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">访问外网（如 8.8.8.8）</span><br><span class=\"line\">├─ 检查路由表，找不到具体路由</span><br><span class=\"line\">├─ 匹配默认路由 0.0.0.0/0</span><br><span class=\"line\">├─ 从接口 192.168.31.36 发出</span><br><span class=\"line\">└─ 发送到网关 192.168.31.254（由网关继续转发）</span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><strong>类比：</strong></p>\n<ul>\n<li>默认路由就像”找不到路时，去问门卫”</li>\n<li>网关就是小区的”门卫”，知道如何把数据送到外面的世界</li>\n</ul>\n<hr>\n<p><strong>🏠 本地网络路由：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">网络目标: 192.168.31.0</span><br><span class=\"line\">网络掩码: 255.255.255.0</span><br><span class=\"line\">网关:     在链路上</span><br><span class=\"line\">接口:     192.168.31.36</span><br><span class=\"line\">跃点数:   296</span><br></pre></td></tr></table></figure>\n\n<p><strong>含义解释：</strong></p>\n<ul>\n<li><strong>目标</strong>：192.168.31.0&#x2F;24 网段（本地局域网）</li>\n<li><strong>网关：在链路上</strong>：表示直接连接，不需要通过网关</li>\n<li><strong>作用</strong>：访问同网段设备（192.168.31.1 - 192.168.31.254）时，直接在本地网络发送，不经过路由器</li>\n</ul>\n<p><strong>示例：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Ping 192.168.31.100（同网段）</span><br><span class=\"line\">├─ 匹配路由: 192.168.31.0/24</span><br><span class=\"line\">├─ 网关: 在链路上（直连）</span><br><span class=\"line\">├─ 查 ARP 获取 192.168.31.100 的 MAC</span><br><span class=\"line\">└─ 直接发送以太网帧（不经过路由器）</span><br></pre></td></tr></table></figure>\n\n<hr>\n<p><strong>🔁 本地回环路由：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">网络目标: 127.0.0.0</span><br><span class=\"line\">网络掩码: 255.0.0.0</span><br><span class=\"line\">网关:     在链路上</span><br><span class=\"line\">接口:     127.0.0.1</span><br><span class=\"line\">跃点数:   331</span><br></pre></td></tr></table></figure>\n\n<p><strong>含义解释：</strong></p>\n<ul>\n<li><strong>127.0.0.0&#x2F;8</strong>：所有 127.x.x.x 的地址都是本地回环</li>\n<li><strong>作用</strong>：访问本机服务，数据不会离开本机</li>\n<li><strong>用途</strong>：<ul>\n<li><code>ping 127.0.0.1</code>：测试本机 TCP&#x2F;IP 协议栈</li>\n<li><code>localhost</code>：Web 开发时访问本地服务器</li>\n</ul>\n</li>\n</ul>\n<hr>\n<p><strong>🖥️ 虚拟机网络路由：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">网络目标: 192.168.124.0 (VMnet1)</span><br><span class=\"line\">网络掩码: 255.255.255.0</span><br><span class=\"line\">网关:     在链路上</span><br><span class=\"line\">接口:     192.168.124.1</span><br><span class=\"line\">跃点数:   291</span><br><span class=\"line\"></span><br><span class=\"line\">网络目标: 192.168.254.0 (VMnet8)</span><br><span class=\"line\">网络掩码: 255.255.255.0</span><br><span class=\"line\">网关:     在链路上</span><br><span class=\"line\">接口:     192.168.254.1</span><br><span class=\"line\">跃点数:   291</span><br></pre></td></tr></table></figure>\n\n<p><strong>含义解释：</strong></p>\n<ul>\n<li><strong>VMnet1（192.168.124.0&#x2F;24）</strong>：VMware 仅主机模式（Host-Only）</li>\n<li><strong>VMnet8（192.168.254.0&#x2F;24）</strong>：VMware NAT 模式</li>\n<li><strong>作用</strong>：宿主机与虚拟机之间的通信</li>\n</ul>\n<p><strong>场景示例：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">宿主机访问虚拟机 (192.168.124.10)</span><br><span class=\"line\">├─ 匹配路由: 192.168.124.0/24</span><br><span class=\"line\">├─ 通过虚拟网卡 VMnet1 发送</span><br><span class=\"line\">└─ 虚拟机收到数据</span><br></pre></td></tr></table></figure>\n\n<hr>\n<p><strong>📡 多播路由：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">网络目标: 224.0.0.0</span><br><span class=\"line\">网络掩码: 240.0.0.0</span><br><span class=\"line\">网关:     在链路上</span><br><span class=\"line\">接口:     多个接口</span><br></pre></td></tr></table></figure>\n\n<p><strong>含义解释：</strong></p>\n<ul>\n<li><strong>224.0.0.0&#x2F;4</strong>：多播地址范围（224.0.0.0 - 239.255.255.255）</li>\n<li><strong>作用</strong>：支持多播协议（如 IPTV、视频会议）</li>\n<li><strong>每个接口都有多播路由</strong>：允许各网卡接收多播数据</li>\n</ul>\n<hr>\n<p><strong>📢 广播路由：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">网络目标: 255.255.255.255</span><br><span class=\"line\">网络掩码: 255.255.255.255</span><br><span class=\"line\">网关:     在链路上</span><br><span class=\"line\">接口:     多个接口</span><br></pre></td></tr></table></figure>\n\n<p><strong>含义解释：</strong></p>\n<ul>\n<li><strong>255.255.255.255</strong>：受限广播地址</li>\n<li><strong>作用</strong>：在本地网络广播，不会被路由器转发</li>\n<li><strong>用途</strong>：DHCP 发现（客户端寻找 DHCP 服务器）</li>\n</ul>\n<hr>\n<h4 id=\"3-永久路由分析\"><a href=\"#3-永久路由分析\" class=\"headerlink\" title=\"3. 永久路由分析\"></a><strong>3. 永久路由分析</strong></h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">永久路由:</span><br><span class=\"line\">  网络地址          网络掩码  网关地址  跃点数</span><br><span class=\"line\">          0.0.0.0          0.0.0.0   192.168.31.254     默认</span><br><span class=\"line\">          0.0.0.0          0.0.0.0   192.168.60.254     默认</span><br></pre></td></tr></table></figure>\n\n<p><strong>含义：</strong></p>\n<ul>\n<li><strong>永久路由</strong>：系统重启后仍然保留（手动添加的静态路由）</li>\n<li><strong>两个默认网关</strong>：可能是多网络环境或备用网关配置</li>\n<li><strong>192.168.60.254</strong>：可能是之前的网络配置或 VPN 网关</li>\n</ul>\n<hr>\n<h3 id=\"🔍-路由决策过程示例\"><a href=\"#🔍-路由决策过程示例\" class=\"headerlink\" title=\"🔍 路由决策过程示例\"></a>🔍 路由决策过程示例</h3><p><strong>场景 1：访问百度（220.181.38.148）</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">步骤 1: 查找路由表</span><br><span class=\"line\">├─ 220.181.38.148 不匹配任何具体路由</span><br><span class=\"line\">└─ 匹配默认路由 0.0.0.0/0</span><br><span class=\"line\"></span><br><span class=\"line\">步骤 2: 使用默认路由</span><br><span class=\"line\">├─ 网关: 192.168.31.254</span><br><span class=\"line\">├─ 接口: 192.168.31.36（Wi-Fi）</span><br><span class=\"line\">└─ 查 ARP 获取网关 MAC</span><br><span class=\"line\"></span><br><span class=\"line\">步骤 3: 构造以太网帧</span><br><span class=\"line\">├─ 目标 MAC: 网关的 MAC</span><br><span class=\"line\">├─ 源 MAC: Wi-Fi 网卡 MAC (f4:46:37:63:8d:8c)</span><br><span class=\"line\">├─ IP 包：源 IP 192.168.31.36，目标 IP 220.181.38.148</span><br><span class=\"line\">└─ 发送到网关</span><br><span class=\"line\"></span><br><span class=\"line\">步骤 4: 网关转发</span><br><span class=\"line\">└─ 网关根据自己的路由表继续转发到互联网</span><br></pre></td></tr></table></figure>\n\n<hr>\n<p><strong>场景 2：访问同网段设备（192.168.31.100）</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">步骤 1: 查找路由表</span><br><span class=\"line\">└─ 匹配路由: 192.168.31.0/24（在链路上）</span><br><span class=\"line\"></span><br><span class=\"line\">步骤 2: 直接通信</span><br><span class=\"line\">├─ 不需要网关</span><br><span class=\"line\">├─ 查 ARP 获取 192.168.31.100 的 MAC</span><br><span class=\"line\">└─ 直接发送以太网帧到目标设备</span><br></pre></td></tr></table></figure>\n\n<hr>\n<p><strong>场景 3：访问虚拟机（192.168.124.10）</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">步骤 1: 查找路由表</span><br><span class=\"line\">└─ 匹配路由: 192.168.124.0/24</span><br><span class=\"line\"></span><br><span class=\"line\">步骤 2: 通过虚拟网卡</span><br><span class=\"line\">├─ 使用 VMnet1 虚拟网卡</span><br><span class=\"line\">├─ 接口: 192.168.124.1</span><br><span class=\"line\">└─ 发送到虚拟交换机（VMware 处理）</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"💡-关键知识点总结\"><a href=\"#💡-关键知识点总结\" class=\"headerlink\" title=\"💡 关键知识点总结\"></a>💡 关键知识点总结</h3><p><strong>1. 默认路由（0.0.0.0&#x2F;0）的重要性：</strong></p>\n<ul>\n<li>✅ 是”兜底”路由，匹配所有目标</li>\n<li>✅ 跃点数最小的默认路由优先使用</li>\n<li>✅ 没有默认路由就无法访问外网</li>\n</ul>\n<p><strong>2. 路由匹配原则：</strong></p>\n<ul>\n<li><strong>最长前缀匹配</strong>（Longest Prefix Match）</li>\n<li>优先匹配子网掩码最长（最具体）的路由</li>\n<li>例如：访问 192.168.31.100 时：<ul>\n<li>192.168.31.0&#x2F;24（掩码 24 位）✅ 优先</li>\n<li>0.0.0.0&#x2F;0（掩码 0 位）❌ 被排除</li>\n</ul>\n</li>\n</ul>\n<p><strong>3. “在链路上”的含义：</strong></p>\n<ul>\n<li>表示目标在同一网络，直接可达</li>\n<li>不需要通过路由器转发</li>\n<li>使用 ARP 获取 MAC 后直接发送</li>\n</ul>\n<p><strong>4. 跃点数（Metric）：</strong></p>\n<ul>\n<li>表示路由的”成本”或”优先级”</li>\n<li>数值越小，优先级越高</li>\n<li>当有多条路由到同一目标时，选择跃点数最小的</li>\n</ul>\n<hr>\n<h3 id=\"🎯-任务-2-使用-Ping-与-Tracert-分析路径\"><a href=\"#🎯-任务-2-使用-Ping-与-Tracert-分析路径\" class=\"headerlink\" title=\"🎯 任务 2: 使用 Ping 与 Tracert 分析路径\"></a>🎯 任务 2: 使用 Ping 与 Tracert 分析路径</h3><h4 id=\"2-1-Ping-测试-Google-DNS-8-8-8-8\"><a href=\"#2-1-Ping-测试-Google-DNS-8-8-8-8\" class=\"headerlink\" title=\"2.1 Ping 测试 - Google DNS (8.8.8.8)\"></a><strong>2.1 Ping 测试 - Google DNS (8.8.8.8)</strong></h4><p><strong>执行命令：</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">ping <span class=\"literal\">-n</span> <span class=\"number\">4</span> <span class=\"number\">8.8</span>.<span class=\"number\">8.8</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>输出结果：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">正在 Ping 8.8.8.8 具有 32 字节的数据:</span><br><span class=\"line\">来自 8.8.8.8 的回复: 字节=32 时间=165ms TTL=107</span><br><span class=\"line\">来自 8.8.8.8 的回复: 字节=32 时间=162ms TTL=107</span><br><span class=\"line\">来自 8.8.8.8 的回复: 字节=32 时间=163ms TTL=107</span><br><span class=\"line\">来自 8.8.8.8 的回复: 字节=32 时间=171ms TTL=107</span><br><span class=\"line\"></span><br><span class=\"line\">8.8.8.8 的 Ping 统计信息:</span><br><span class=\"line\">    数据包: 已发送 = 4，已接收 = 4，丢失 = 0 (0% 丢失)，</span><br><span class=\"line\">往返行程的估计时间(以毫秒为单位):</span><br><span class=\"line\">    最短 = 162ms，最长 = 171ms，平均 = 165ms</span><br></pre></td></tr></table></figure>\n\n<p><strong>📊 Ping 结果分析：</strong></p>\n<table>\n<thead>\n<tr>\n<th>指标</th>\n<th>数值</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>目标 IP</strong></td>\n<td>8.8.8.8</td>\n<td>Google 公共 DNS 服务器</td>\n</tr>\n<tr>\n<td><strong>数据大小</strong></td>\n<td>32 字节</td>\n<td>ICMP Echo Request 的载荷大小</td>\n</tr>\n<tr>\n<td><strong>往返时间 (RTT)</strong></td>\n<td>162-171ms</td>\n<td>数据包往返所需时间</td>\n</tr>\n<tr>\n<td><strong>平均延迟</strong></td>\n<td>165ms</td>\n<td>平均响应时间</td>\n</tr>\n<tr>\n<td><strong>TTL</strong></td>\n<td>107</td>\n<td>回复包的生存时间（初始值可能是 128）</td>\n</tr>\n<tr>\n<td><strong>丢包率</strong></td>\n<td>0%</td>\n<td>网络连接稳定 ✅</td>\n</tr>\n</tbody></table>\n<p><strong>🔍 深入分析：</strong></p>\n<ol>\n<li><p><strong>TTL &#x3D; 107 的含义：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">初始 TTL（可能）: 128</span><br><span class=\"line\">当前 TTL: 107</span><br><span class=\"line\">经过跳数 = 128 - 107 = 21 跳</span><br><span class=\"line\"></span><br><span class=\"line\">说明：数据包从 Google 服务器返回时，经过了约 21 个路由器</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong>RTT（往返时间）分析：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">165ms 的延迟包括：</span><br><span class=\"line\">├─ 发送时间：本机 → 网关 → ISP → 骨干网 → Google（约 82ms）</span><br><span class=\"line\">├─ 处理时间：Google 服务器处理（&lt;1ms）</span><br><span class=\"line\">└─ 返回时间：Google → 骨干网 → ISP → 网关 → 本机（约 83ms）</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong>延迟评价：</strong></p>\n<ul>\n<li>⚡ &lt;50ms：优秀（游戏级）</li>\n<li>✅ 50-150ms：良好（正常使用）</li>\n<li>⚠️ 150-300ms：一般（当前情况）</li>\n<li>❌ &gt;300ms：较差</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h4 id=\"2-2-Tracert-测试-百度-baidu-com\"><a href=\"#2-2-Tracert-测试-百度-baidu-com\" class=\"headerlink\" title=\"2.2 Tracert 测试 - 百度 (baidu.com)\"></a><strong>2.2 Tracert 测试 - 百度 (baidu.com)</strong></h4><p><strong>执行命令：</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">tracert <span class=\"literal\">-h</span> <span class=\"number\">15</span> baidu.com</span><br></pre></td></tr></table></figure>\n\n<p><strong>输出结果：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">通过最多 15 个跃点跟踪</span><br><span class=\"line\">到 baidu.com [111.63.65.103] 的路由:</span><br><span class=\"line\"></span><br><span class=\"line\">  1     4 ms     4 ms     2 ms  192.168.28.254</span><br><span class=\"line\">  2     3 ms     5 ms     2 ms  192.168.7.1</span><br><span class=\"line\">  3     *        *        *     请求超时。</span><br><span class=\"line\">  4     *        5 ms     *     61.175.2.177</span><br><span class=\"line\">  5     9 ms     *        *     61.175.6.221</span><br><span class=\"line\">  6    31 ms    33 ms    33 ms  202.97.24.113</span><br><span class=\"line\">  7     *        *        *     请求超时。</span><br><span class=\"line\">  8     *        *        *     请求超时。</span><br><span class=\"line\">  9     *        *        *     请求超时。</span><br><span class=\"line\"> 10     *        *        *     请求超时。</span><br><span class=\"line\"> 11     *        *        *     请求超时。</span><br><span class=\"line\"> 12    38 ms    36 ms    36 ms  112.54.105.110</span><br><span class=\"line\"> 13     *        *        *     请求超时。</span><br><span class=\"line\"> 14     *        *        *     请求超时。</span><br><span class=\"line\"> 15     *        *        *     请求超时。</span><br><span class=\"line\"></span><br><span class=\"line\">跟踪完成。</span><br></pre></td></tr></table></figure>\n\n<p><strong>📊 路径追踪分析：</strong></p>\n<table>\n<thead>\n<tr>\n<th>跳数</th>\n<th>IP 地址</th>\n<th>延迟</th>\n<th>说明</th>\n<th>网络层级</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>1</strong></td>\n<td>192.168.28.254</td>\n<td>2-4ms</td>\n<td>本地网关（路由器）</td>\n<td>🏠 家庭网络</td>\n</tr>\n<tr>\n<td><strong>2</strong></td>\n<td>192.168.7.1</td>\n<td>2-5ms</td>\n<td>上级路由器&#x2F;光猫</td>\n<td>🏠 楼宇网络</td>\n</tr>\n<tr>\n<td><strong>3</strong></td>\n<td>*</td>\n<td>超时</td>\n<td>可能禁用 ICMP 响应</td>\n<td>🏢 ISP 接入层</td>\n</tr>\n<tr>\n<td><strong>4</strong></td>\n<td>61.175.2.177</td>\n<td>5ms</td>\n<td>中国电信网络</td>\n<td>🌐 ISP 核心网</td>\n</tr>\n<tr>\n<td><strong>5</strong></td>\n<td>61.175.6.221</td>\n<td>9ms</td>\n<td>中国电信骨干网</td>\n<td>🌐 省级骨干</td>\n</tr>\n<tr>\n<td><strong>6</strong></td>\n<td>202.97.24.113</td>\n<td>31-33ms</td>\n<td>中国电信 163 骨干网</td>\n<td>🌐 国家骨干</td>\n</tr>\n<tr>\n<td><strong>7-11</strong></td>\n<td>*</td>\n<td>超时</td>\n<td>防火墙&#x2F;负载均衡器</td>\n<td>🛡️ 安全设备</td>\n</tr>\n<tr>\n<td><strong>12</strong></td>\n<td>112.54.105.110</td>\n<td>36-38ms</td>\n<td>百度网络边缘节点</td>\n<td>🎯 目标网络</td>\n</tr>\n<tr>\n<td><strong>13-15</strong></td>\n<td>*</td>\n<td>超时</td>\n<td>百度内部网络（不响应）</td>\n<td>🎯 内部路由</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"🗺️-网络路径可视化\"><a href=\"#🗺️-网络路径可视化\" class=\"headerlink\" title=\"🗺️ 网络路径可视化\"></a>🗺️ 网络路径可视化</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">本机 (192.168.31.36)</span><br><span class=\"line\">  │</span><br><span class=\"line\">  ├─ 第 1 跳 (4ms)</span><br><span class=\"line\">  │   └─ 192.168.28.254 (家庭路由器)</span><br><span class=\"line\">  │       &quot;你好，我要访问百度&quot;</span><br><span class=\"line\">  │</span><br><span class=\"line\">  ├─ 第 2 跳 (5ms)</span><br><span class=\"line\">  │   └─ 192.168.7.1 (楼宇网关)</span><br><span class=\"line\">  │       &quot;继续转发到 ISP&quot;</span><br><span class=\"line\">  │</span><br><span class=\"line\">  ├─ 第 3 跳 (超时)</span><br><span class=\"line\">  │   └─ ISP 接入层设备（不响应 ICMP）</span><br><span class=\"line\">  │</span><br><span class=\"line\">  ├─ 第 4 跳 (5ms)</span><br><span class=\"line\">  │   └─ 61.175.2.177 (电信接入网)</span><br><span class=\"line\">  │       &quot;进入电信网络&quot;</span><br><span class=\"line\">  │</span><br><span class=\"line\">  ├─ 第 5 跳 (9ms)</span><br><span class=\"line\">  │   └─ 61.175.6.221 (省级骨干)</span><br><span class=\"line\">  │       &quot;继续在骨干网传输&quot;</span><br><span class=\"line\">  │</span><br><span class=\"line\">  ├─ 第 6 跳 (33ms)</span><br><span class=\"line\">  │   └─ 202.97.24.113 (国家骨干网 ChinaNet)</span><br><span class=\"line\">  │       &quot;这是中国电信 163 骨干网&quot;</span><br><span class=\"line\">  │</span><br><span class=\"line\">  ├─ 第 7-11 跳 (超时)</span><br><span class=\"line\">  │   └─ 防火墙/负载均衡（安全设备不响应）</span><br><span class=\"line\">  │</span><br><span class=\"line\">  ├─ 第 12 跳 (38ms)</span><br><span class=\"line\">  │   └─ 112.54.105.110 (百度边缘节点)</span><br><span class=\"line\">  │       &quot;接近目标&quot;</span><br><span class=\"line\">  │</span><br><span class=\"line\">  └─ 第 13-15 跳 (超时)</span><br><span class=\"line\">      └─ baidu.com (111.63.65.103)</span><br><span class=\"line\">          &quot;到达百度服务器，但内部路由不响应 ICMP&quot;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"📖-TTL-工作原理详解\"><a href=\"#📖-TTL-工作原理详解\" class=\"headerlink\" title=\"📖 TTL 工作原理详解\"></a>📖 TTL 工作原理详解</h3><p><strong>Tracert 如何利用 TTL 追踪路径：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">第 1 轮发送（TTL=1）:</span><br><span class=\"line\">本机 ─────[TTL=1]─────&gt; 路由器 1 (192.168.28.254)</span><br><span class=\"line\">                         TTL 减到 0 ❌</span><br><span class=\"line\">本机 &lt;────[ICMP 超时]─── 路由器 1</span><br><span class=\"line\">     &quot;我是 192.168.28.254，TTL 耗尽&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">第 2 轮发送（TTL=2）:</span><br><span class=\"line\">本机 ─────[TTL=2]─────&gt; 路由器 1 ─────[TTL=1]─────&gt; 路由器 2 (192.168.7.1)</span><br><span class=\"line\">                                                      TTL 减到 0 ❌</span><br><span class=\"line\">本机 &lt;─────────────────[ICMP 超时]────────────────── 路由器 2</span><br><span class=\"line\">     &quot;我是 192.168.7.1，TTL 耗尽&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">第 3 轮发送（TTL=3）:</span><br><span class=\"line\">本机 ─────[TTL=3]─────&gt; 路由器 1 ─────[TTL=2]─────&gt; 路由器 2 ─────[TTL=1]─────&gt; 路由器 3</span><br><span class=\"line\">                                                                                  TTL 减到 0 ❌</span><br><span class=\"line\">                                                                                  不响应 ICMP ⚠️</span><br><span class=\"line\">本机 &lt;─────────────────────────────────────────────────────────────────────────  请求超时 *</span><br><span class=\"line\"></span><br><span class=\"line\">...依次递增 TTL，直到到达目标或达到最大跳数限制</span><br></pre></td></tr></table></figure>\n\n<p><strong>为什么有些跳显示 <code>*</code> (请求超时)？</strong></p>\n<ol>\n<li><p><strong>路由器禁用 ICMP 响应</strong>（安全策略）</p>\n<ul>\n<li>防止网络拓扑被探测</li>\n<li>减少设备负载</li>\n</ul>\n</li>\n<li><p><strong>防火墙过滤</strong></p>\n<ul>\n<li>企业网络边界防火墙</li>\n<li>ISP 边界防火墙</li>\n</ul>\n</li>\n<li><p><strong>设备繁忙&#x2F;丢包</strong></p>\n<ul>\n<li>路由器处理优先级：转发数据 &gt; 回复 ICMP</li>\n<li>网络拥塞导致 ICMP 包丢失</li>\n</ul>\n</li>\n</ol>\n<p><strong>注意：</strong> <code>*</code> 不代表路径中断，只是该设备不响应，数据仍然在转发！</p>\n<hr>\n<h3 id=\"💡-实践总结\"><a href=\"#💡-实践总结\" class=\"headerlink\" title=\"💡 实践总结\"></a>💡 实践总结</h3><p><strong>1. 路由表的作用：</strong></p>\n<ul>\n<li>✅ 决定数据包的转发路径</li>\n<li>✅ 默认路由是访问外网的关键</li>\n<li>✅ 本地网络直连，不需要经过网关</li>\n</ul>\n<p><strong>2. Ping 的用途：</strong></p>\n<ul>\n<li>✅ 测试网络连通性</li>\n<li>✅ 测量网络延迟（RTT）</li>\n<li>✅ 通过 TTL 反推经过的跳数</li>\n</ul>\n<p><strong>3. Tracert 的用途：</strong></p>\n<ul>\n<li>✅ 追踪完整的网络路径</li>\n<li>✅ 定位网络瓶颈或故障点</li>\n<li>✅ 了解数据包的传输路线</li>\n</ul>\n<p><strong>4. TTL 机制：</strong></p>\n<ul>\n<li>✅ 防止数据包无限循环</li>\n<li>✅ Tracert 利用 TTL 逐跳探测</li>\n<li>✅ 每经过一个路由器 TTL 减 1</li>\n</ul>\n<hr>\n<h2 id=\"巩固练习（题与复盘）\"><a href=\"#巩固练习（题与复盘）\" class=\"headerlink\" title=\"巩固练习（题与复盘）\"></a>巩固练习（题与复盘）</h2><h3 id=\"📝-练习-1-子网计算\"><a href=\"#📝-练习-1-子网计算\" class=\"headerlink\" title=\"📝 练习 1: 子网计算\"></a>📝 练习 1: 子网计算</h3><p><strong>题目：</strong> 给出网络 <code>192.168.10.0/26</code>，计算：</p>\n<ul>\n<li>子网掩码（点分十进制）</li>\n<li>可用主机数</li>\n<li>网络地址</li>\n<li>广播地址</li>\n<li>可用主机范围</li>\n</ul>\n<hr>\n<p><strong>答案：</strong></p>\n<p><strong>步骤 1：确定子网掩码</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">/26 表示前 26 位是网络位，后 6 位是主机位</span><br><span class=\"line\"></span><br><span class=\"line\">二进制：</span><br><span class=\"line\">11111111.11111111.11111111.11000000</span><br><span class=\"line\">└────┬────┘└────┬────┘└────┬────┘└──┬──┘</span><br><span class=\"line\">    255        255        255       192</span><br><span class=\"line\"></span><br><span class=\"line\">点分十进制：255.255.255.192</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 2：计算可用主机数</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">主机位数 = 32 - 26 = 6 位</span><br><span class=\"line\">总地址数 = 2^6 = 64</span><br><span class=\"line\">可用主机数 = 64 - 2 = 62 个</span><br><span class=\"line\"></span><br><span class=\"line\">（减 2：网络地址和广播地址不可分配给主机）</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 3：确定网络地址</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">网络地址 = 主机位全部为 0</span><br><span class=\"line\">192.168.10.0</span><br><span class=\"line\"></span><br><span class=\"line\">二进制表示：</span><br><span class=\"line\">192.168.10.00000000</span><br><span class=\"line\">          └──┬──┘</span><br><span class=\"line\">          主机位全 0</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 4：确定广播地址</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">广播地址 = 主机位全部为 1</span><br><span class=\"line\">192.168.10.63</span><br><span class=\"line\"></span><br><span class=\"line\">二进制表示：</span><br><span class=\"line\">192.168.10.00111111</span><br><span class=\"line\">          └──┬──┘</span><br><span class=\"line\">          主机位全 1</span><br><span class=\"line\"></span><br><span class=\"line\">计算：192.168.10.0 + (2^6 - 1) = 192.168.10.0 + 63 = 192.168.10.63</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 5：确定可用主机范围</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">第一个可用 IP：192.168.10.1 （网络地址 + 1）</span><br><span class=\"line\">最后一个可用 IP：192.168.10.62 （广播地址 - 1）</span><br><span class=\"line\"></span><br><span class=\"line\">可用范围：192.168.10.1 - 192.168.10.62</span><br></pre></td></tr></table></figure>\n\n<hr>\n<p><strong>📊 完整答案汇总：</strong></p>\n<table>\n<thead>\n<tr>\n<th>项目</th>\n<th>值</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>子网掩码</strong></td>\n<td>255.255.255.192</td>\n</tr>\n<tr>\n<td><strong>可用主机数</strong></td>\n<td>62</td>\n</tr>\n<tr>\n<td><strong>网络地址</strong></td>\n<td>192.168.10.0</td>\n</tr>\n<tr>\n<td><strong>广播地址</strong></td>\n<td>192.168.10.63</td>\n</tr>\n<tr>\n<td><strong>可用主机范围</strong></td>\n<td>192.168.10.1 - 192.168.10.62</td>\n</tr>\n</tbody></table>\n<p><strong>🔍 验证：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">192.168.10.0    - 网络地址（不可用）</span><br><span class=\"line\">192.168.10.1    - 第 1 个可用主机 ✅</span><br><span class=\"line\">192.168.10.2    - 第 2 个可用主机 ✅</span><br><span class=\"line\">...</span><br><span class=\"line\">192.168.10.62   - 第 62 个可用主机 ✅</span><br><span class=\"line\">192.168.10.63   - 广播地址（不可用）</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"📝-练习-2-路由表分析\"><a href=\"#📝-练习-2-路由表分析\" class=\"headerlink\" title=\"📝 练习 2: 路由表分析\"></a>📝 练习 2: 路由表分析</h3><p><strong>题目：</strong> 解释以下路由表条目的含义：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">网络目标        网络掩码          网关          接口</span><br><span class=\"line\">0.0.0.0         0.0.0.0       192.168.2.1   192.168.2.5</span><br><span class=\"line\">192.168.2.0     255.255.255.0     在链路上    192.168.2.5</span><br></pre></td></tr></table></figure>\n\n<hr>\n<p><strong>答案：</strong></p>\n<p><strong>第 1 条路由（默认路由）：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">网络目标: 0.0.0.0</span><br><span class=\"line\">网络掩码: 0.0.0.0</span><br><span class=\"line\">网关:     192.168.2.1</span><br><span class=\"line\">接口:     192.168.2.5</span><br></pre></td></tr></table></figure>\n\n<p><strong>含义解释：</strong></p>\n<table>\n<thead>\n<tr>\n<th>字段</th>\n<th>含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>0.0.0.0&#x2F;0</strong></td>\n<td>匹配所有目标地址（默认路由）</td>\n</tr>\n<tr>\n<td><strong>网关 192.168.2.1</strong></td>\n<td>路由器&#x2F;网关的 IP 地址</td>\n</tr>\n<tr>\n<td><strong>接口 192.168.2.5</strong></td>\n<td>本机在该网络的 IP 地址</td>\n</tr>\n<tr>\n<td><strong>作用</strong></td>\n<td>访问外网时的”兜底”路由</td>\n</tr>\n</tbody></table>\n<p><strong>工作流程：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">访问百度 (220.181.38.148)</span><br><span class=\"line\">│</span><br><span class=\"line\">├─ 步骤 1: 检查路由表</span><br><span class=\"line\">│   └─ 220.181.38.148 不匹配任何具体路由</span><br><span class=\"line\">│</span><br><span class=\"line\">├─ 步骤 2: 使用默认路由 0.0.0.0/0</span><br><span class=\"line\">│   ├─ 从接口 192.168.2.5 发出</span><br><span class=\"line\">│   └─ 发送到网关 192.168.2.1</span><br><span class=\"line\">│</span><br><span class=\"line\">└─ 步骤 3: 网关继续转发</span><br><span class=\"line\">    └─ 网关根据自己的路由表转发到 ISP</span><br></pre></td></tr></table></figure>\n\n<p><strong>类比：</strong></p>\n<ul>\n<li>就像”不知道怎么走时，去问门卫”</li>\n<li>网关是小区的”门卫”，负责对外联系</li>\n</ul>\n<hr>\n<p><strong>第 2 条路由（本地网络）：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">网络目标: 192.168.2.0</span><br><span class=\"line\">网络掩码: 255.255.255.0</span><br><span class=\"line\">网关:     在链路上</span><br><span class=\"line\">接口:     192.168.2.5</span><br></pre></td></tr></table></figure>\n\n<p><strong>含义解释：</strong></p>\n<table>\n<thead>\n<tr>\n<th>字段</th>\n<th>含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>192.168.2.0&#x2F;24</strong></td>\n<td>本地局域网网段</td>\n</tr>\n<tr>\n<td><strong>在链路上</strong></td>\n<td>直接连接，不需要网关</td>\n</tr>\n<tr>\n<td><strong>接口 192.168.2.5</strong></td>\n<td>本机 IP（用于发送数据）</td>\n</tr>\n<tr>\n<td><strong>作用</strong></td>\n<td>访问同网段设备时使用</td>\n</tr>\n</tbody></table>\n<p><strong>工作流程：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">访问同网段设备 (192.168.2.100)</span><br><span class=\"line\">│</span><br><span class=\"line\">├─ 步骤 1: 检查路由表</span><br><span class=\"line\">│   └─ 匹配路由：192.168.2.0/24</span><br><span class=\"line\">│</span><br><span class=\"line\">├─ 步骤 2: &quot;在链路上&quot;（不需要网关）</span><br><span class=\"line\">│   ├─ 发送 ARP 请求：谁有 192.168.2.100？</span><br><span class=\"line\">│   └─ 获取目标 MAC 地址</span><br><span class=\"line\">│</span><br><span class=\"line\">└─ 步骤 3: 直接发送</span><br><span class=\"line\">    └─ 构造以太网帧，直接发送到目标设备</span><br></pre></td></tr></table></figure>\n\n<p><strong>类比：</strong></p>\n<ul>\n<li>就像”在同一个小区，直接上门”</li>\n<li>不需要”门卫”帮忙，直接互相通信</li>\n</ul>\n<hr>\n<p><strong>🔍 对比总结：</strong></p>\n<table>\n<thead>\n<tr>\n<th>对比项</th>\n<th>默认路由 (0.0.0.0&#x2F;0)</th>\n<th>本地路由 (192.168.2.0&#x2F;24)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>目标范围</strong></td>\n<td>所有地址（外网）</td>\n<td>本地网段 (192.168.2.0-255)</td>\n</tr>\n<tr>\n<td><strong>是否需要网关</strong></td>\n<td>✅ 需要 (192.168.2.1)</td>\n<td>❌ 不需要（在链路上）</td>\n</tr>\n<tr>\n<td><strong>数据流向</strong></td>\n<td>本机 → 网关 → 外网</td>\n<td>本机 → 目标设备（直连）</td>\n</tr>\n<tr>\n<td><strong>使用 ARP</strong></td>\n<td>查询网关 MAC</td>\n<td>查询目标设备 MAC</td>\n</tr>\n<tr>\n<td><strong>典型场景</strong></td>\n<td>访问百度、Google</td>\n<td>访问打印机、NAS</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"📝-练习-3-Traceroute-报文-TTL-的作用\"><a href=\"#📝-练习-3-Traceroute-报文-TTL-的作用\" class=\"headerlink\" title=\"📝 练习 3: Traceroute 报文 TTL 的作用\"></a>📝 练习 3: Traceroute 报文 TTL 的作用</h3><p><strong>题目：</strong> 总结 Traceroute 报文 TTL 的作用</p>\n<hr>\n<p><strong>答案：</strong></p>\n<p><strong>TTL（Time To Live，生存时间）的核心作用：</strong></p>\n<p><strong>1. 防止路由环路导致的无限循环</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">正常情况：数据包按路由表转发到目标</span><br><span class=\"line\">异常情况（路由配置错误）：</span><br><span class=\"line\">  路由器 A → 路由器 B → 路由器 C → 路由器 A（循环）</span><br><span class=\"line\"></span><br><span class=\"line\">TTL 机制：</span><br><span class=\"line\">├─ 初始 TTL = 64 或 128</span><br><span class=\"line\">├─ 每经过一个路由器，TTL 减 1</span><br><span class=\"line\">├─ TTL = 0 时，路由器丢弃数据包</span><br><span class=\"line\">└─ 发送 ICMP Time Exceeded 给源主机</span><br><span class=\"line\"></span><br><span class=\"line\">作用：即使有路由环路，数据包也会在有限步数内被丢弃</span><br></pre></td></tr></table></figure>\n\n<p><strong>2. Traceroute 利用 TTL 探测网络路径</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">核心思想：故意让数据包在每一跳&quot;超时&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">第 1 次探测（TTL=1）:</span><br><span class=\"line\">本机 ────[TTL=1]────&gt; 第 1 跳路由器</span><br><span class=\"line\">                      TTL 减到 0 ❌</span><br><span class=\"line\">本机 &lt;───[ICMP 超时]─ 第 1 跳</span><br><span class=\"line\">     &quot;我是 192.168.2.1&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">第 2 次探测（TTL=2）:</span><br><span class=\"line\">本机 ────[TTL=2]────&gt; 第 1 跳 ────[TTL=1]────&gt; 第 2 跳</span><br><span class=\"line\">                                                TTL 减到 0 ❌</span><br><span class=\"line\">本机 &lt;────────────[ICMP 超时]────────────────  第 2 跳</span><br><span class=\"line\">     &quot;我是 61.144.1.1&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">依次递增 TTL，逐跳收集路由器 IP 地址</span><br></pre></td></tr></table></figure>\n\n<p><strong>3. TTL 减少规则</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">规则：每经过一个三层设备（路由器），TTL 减 1</span><br><span class=\"line\"></span><br><span class=\"line\">不减少 TTL 的设备：</span><br><span class=\"line\">├─ 二层交换机（Switch）- 工作在数据链路层</span><br><span class=\"line\">└─ 集线器（Hub）- 工作在物理层</span><br><span class=\"line\"></span><br><span class=\"line\">减少 TTL 的设备：</span><br><span class=\"line\">├─ 路由器（Router）- 工作在网络层 ✅</span><br><span class=\"line\">├─ 三层交换机（L3 Switch）- 具有路由功能 ✅</span><br><span class=\"line\">└─ 防火墙（Firewall）- 具有路由功能 ✅</span><br></pre></td></tr></table></figure>\n\n<p><strong>4. 通过 TTL 推算网络距离</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">示例：Ping 8.8.8.8 返回 TTL=107</span><br><span class=\"line\"></span><br><span class=\"line\">推算过程：</span><br><span class=\"line\">├─ Google 服务器初始 TTL 可能是 128（Windows 默认）</span><br><span class=\"line\">├─ 或者是 64（Linux 默认）</span><br><span class=\"line\">├─ 假设初始是 128：</span><br><span class=\"line\">│   └─ 经过跳数 = 128 - 107 = 21 跳</span><br><span class=\"line\">├─ 假设初始是 64：</span><br><span class=\"line\">│   └─ 经过跳数 = 64 - 107 = -43（不可能，排除）</span><br><span class=\"line\">└─ 结论：大约经过 21 个路由器</span><br><span class=\"line\"></span><br><span class=\"line\">常见初始 TTL 值：</span><br><span class=\"line\">├─ Windows: 128</span><br><span class=\"line\">├─ Linux/Unix: 64</span><br><span class=\"line\">├─ Cisco 路由器: 255</span><br><span class=\"line\">└─ 嵌入式设备: 255</span><br></pre></td></tr></table></figure>\n\n<p><strong>5. TTL 在安全中的应用</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">检测 IP 欺骗攻击：</span><br><span class=\"line\">├─ 正常服务器返回的 TTL 应该相对稳定</span><br><span class=\"line\">├─ 如果 TTL 突然大幅变化，可能是：</span><br><span class=\"line\">│   ├─ 攻击者伪造 IP</span><br><span class=\"line\">│   ├─ 路由发生变化</span><br><span class=\"line\">│   └─ 中间人攻击</span><br><span class=\"line\">└─ 可以作为异常检测的指标之一</span><br><span class=\"line\"></span><br><span class=\"line\">防止被扫描：</span><br><span class=\"line\">├─ 某些防火墙会修改出站数据包的 TTL</span><br><span class=\"line\">└─ 增加攻击者探测网络拓扑的难度</span><br></pre></td></tr></table></figure>\n\n<hr>\n<p><strong>📊 TTL 作用总结表：</strong></p>\n<table>\n<thead>\n<tr>\n<th>作用</th>\n<th>说明</th>\n<th>受益者</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>防止路由环路</strong></td>\n<td>TTL 减到 0 时丢弃数据包</td>\n<td>整个互联网</td>\n</tr>\n<tr>\n<td><strong>路径探测</strong></td>\n<td>Traceroute 利用 TTL 逐跳探测</td>\n<td>网络管理员</td>\n</tr>\n<tr>\n<td><strong>网络距离估算</strong></td>\n<td>通过 TTL 反推经过的跳数</td>\n<td>网络分析</td>\n</tr>\n<tr>\n<td><strong>故障诊断</strong></td>\n<td>定位网络瓶颈或路由问题</td>\n<td>运维人员</td>\n</tr>\n<tr>\n<td><strong>安全检测</strong></td>\n<td>检测 IP 欺骗或路由异常</td>\n<td>安全团队</td>\n</tr>\n</tbody></table>\n<hr>\n<h2 id=\"评估标准（达成判定）\"><a href=\"#评估标准（达成判定）\" class=\"headerlink\" title=\"评估标准（达成判定）\"></a>评估标准（达成判定）</h2><ul>\n<li>✅ 能正确读取并解释本机路由表</li>\n<li>✅ 能画出到目标的路径示意并解释跳数</li>\n</ul>\n<h2 id=\"学习成果达成情况\"><a href=\"#学习成果达成情况\" class=\"headerlink\" title=\"学习成果达成情况\"></a>学习成果达成情况</h2><h3 id=\"✅-任务完成情况\"><a href=\"#✅-任务完成情况\" class=\"headerlink\" title=\"✅ 任务完成情况\"></a>✅ 任务完成情况</h3><p><strong>任务 1: 查看并分析路由表</strong> ✅</p>\n<ul>\n<li>✅ 执行 <code>route print</code> 命令</li>\n<li>✅ 识别默认路由 (0.0.0.0&#x2F;0 → 192.168.31.254)</li>\n<li>✅ 理解”在链路上”的含义（本地直连）</li>\n<li>✅ 分析多网络环境（主网络、虚拟机网络、回环）</li>\n</ul>\n<p><strong>任务 2: Ping 与 Tracert 测试</strong> ✅</p>\n<ul>\n<li>✅ Ping Google DNS (8.8.8.8)：4 个包全部成功，0% 丢包</li>\n<li>✅ Tracert 到百度：成功追踪 15 跳路径</li>\n<li>✅ 分析 RTT（平均 165ms）和 TTL（107）</li>\n<li>✅ 识别网络层级（家庭 → ISP → 骨干网 → 目标）</li>\n</ul>\n<p><strong>巩固练习完成情况</strong> ✅</p>\n<ul>\n<li>✅ 练习 1：子网计算（192.168.10.0&#x2F;26）</li>\n<li>✅ 练习 2：路由表条目解释</li>\n<li>✅ 练习 3：TTL 作用总结</li>\n</ul>\n<hr>\n<h3 id=\"📊-关键命令与输出\"><a href=\"#📊-关键命令与输出\" class=\"headerlink\" title=\"📊 关键命令与输出\"></a>📊 关键命令与输出</h3><p><strong>1. 路由表查看：</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">route print</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>发现默认网关：192.168.31.254</li>\n<li>本机 IP：192.168.31.36（Wi-Fi）</li>\n<li>虚拟机网络：VMnet1 (192.168.124.0&#x2F;24)、VMnet8 (192.168.254.0&#x2F;24)</li>\n</ul>\n<p><strong>2. 网络连通性测试：</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">ping <span class=\"literal\">-n</span> <span class=\"number\">4</span> <span class=\"number\">8.8</span>.<span class=\"number\">8.8</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>成功率：100% (4&#x2F;4)</li>\n<li>平均延迟：165ms</li>\n<li>TTL：107（推算约 21 跳）</li>\n</ul>\n<p><strong>3. 路径追踪：</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">tracert <span class=\"literal\">-h</span> <span class=\"number\">15</span> baidu.com</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>目标 IP：111.63.65.103</li>\n<li>第 1 跳：192.168.28.254 (本地网关) - 4ms</li>\n<li>第 6 跳：202.97.24.113 (ChinaNet 骨干网) - 33ms</li>\n<li>第 12 跳：112.54.105.110 (百度边缘节点) - 38ms</li>\n</ul>\n<hr>\n<h3 id=\"🎯-核心知识点掌握\"><a href=\"#🎯-核心知识点掌握\" class=\"headerlink\" title=\"🎯 核心知识点掌握\"></a>🎯 核心知识点掌握</h3><p><strong>1. IPv4 地址与子网划分</strong> ✅</p>\n<ul>\n<li>理解 CIDR 表示法（如 192.168.2.0&#x2F;24）</li>\n<li>掌握子网掩码的作用（区分网络位和主机位）</li>\n<li>能够计算可用主机数、网络地址、广播地址</li>\n<li>了解特殊 IP 地址（私有地址、回环地址、多播地址）</li>\n</ul>\n<p><strong>2. 路由表与网关</strong> ✅</p>\n<ul>\n<li>能够读取和解释 Windows 路由表</li>\n<li>理解默认路由 (0.0.0.0&#x2F;0) 的作用：访问外网的”兜底”路由</li>\n<li>理解”在链路上”的含义：直接连接，不需要网关</li>\n<li>掌握路由匹配原则：最长前缀匹配</li>\n</ul>\n<p><strong>3. ICMP 协议</strong> ✅</p>\n<ul>\n<li>理解 ICMP 的作用：网络诊断、错误报告</li>\n<li>掌握 Ping 原理：Echo Request (类型 8) + Echo Reply (类型 0)</li>\n<li>理解 RTT（往返时间）的计算</li>\n<li>能够分析 Ping 结果（延迟、丢包率、TTL）</li>\n</ul>\n<p><strong>4. Traceroute 工作原理</strong> ✅</p>\n<ul>\n<li>理解 TTL 机制：防止路由环路</li>\n<li>掌握 Traceroute 原理：递增 TTL，逐跳探测</li>\n<li>理解 ICMP Time Exceeded 的作用</li>\n<li>能够分析 Tracert 输出，绘制网络路径图</li>\n</ul>\n<hr>\n<h3 id=\"💡-实践收获与反思\"><a href=\"#💡-实践收获与反思\" class=\"headerlink\" title=\"💡 实践收获与反思\"></a>💡 实践收获与反思</h3><p><strong>关键发现：</strong></p>\n<ol>\n<li><p><strong>默认路由是访问互联网的关键</strong></p>\n<ul>\n<li>本机路由表中的 <code>0.0.0.0/0 → 192.168.31.254</code> 是所有外网流量的出口</li>\n<li>没有默认路由，就无法访问外网</li>\n</ul>\n</li>\n<li><p><strong>网络层级结构清晰可见</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">家庭网络 → 楼宇网关 → ISP 接入层 → 省级骨干网 → 国家骨干网 → 目标网络</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong>TTL 是网络诊断的重要工具</strong></p>\n<ul>\n<li>防止路由环路</li>\n<li>Traceroute 利用 TTL 逐跳探测</li>\n<li>通过 TTL 反推网络距离</li>\n</ul>\n</li>\n<li><p><strong>并非所有设备都响应 ICMP</strong></p>\n<ul>\n<li>Tracert 输出中的 <code>*</code> 不代表路径中断</li>\n<li>防火墙、负载均衡器常常不响应 ICMP（安全策略）</li>\n</ul>\n</li>\n<li><p><strong>虚拟化环境的网络复杂性</strong></p>\n<ul>\n<li>VMware 创建了独立的虚拟网络（VMnet1、VMnet8）</li>\n<li>每个虚拟网络都有自己的路由条目</li>\n<li>本机作为虚拟机的网关（192.168.124.1、192.168.254.1）</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h3 id=\"📖-深入理解\"><a href=\"#📖-深入理解\" class=\"headerlink\" title=\"📖 深入理解\"></a>📖 深入理解</h3><p><strong>路由决策过程：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">数据包到达时：</span><br><span class=\"line\">├─ 步骤 1: 查找路由表</span><br><span class=\"line\">│   ├─ 按最长前缀匹配原则</span><br><span class=\"line\">│   └─ 优先匹配更具体的路由</span><br><span class=\"line\">│</span><br><span class=\"line\">├─ 步骤 2: 确定下一跳</span><br><span class=\"line\">│   ├─ 如果是&quot;在链路上&quot; → 直接发送（同网段）</span><br><span class=\"line\">│   └─ 如果有网关 → 发送到网关（跨网段）</span><br><span class=\"line\">│</span><br><span class=\"line\">├─ 步骤 3: 查询 ARP</span><br><span class=\"line\">│   ├─ 同网段：查询目标 IP 的 MAC</span><br><span class=\"line\">│   └─ 跨网段：查询网关 IP 的 MAC</span><br><span class=\"line\">│</span><br><span class=\"line\">└─ 步骤 4: 封装并发送</span><br><span class=\"line\">    └─ 构造以太网帧，发送数据</span><br></pre></td></tr></table></figure>\n\n<p><strong>网络分层协作：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">应用层：用户访问 www.baidu.com</span><br><span class=\"line\">  ↓</span><br><span class=\"line\">传输层：建立 TCP 连接</span><br><span class=\"line\">  ↓</span><br><span class=\"line\">网络层：IP 寻址 + 路由选择 ← 本次学习重点</span><br><span class=\"line\">  ├─ 查路由表：使用默认路由 0.0.0.0/0</span><br><span class=\"line\">  ├─ TTL 设置：初始值 128</span><br><span class=\"line\">  └─ 下一跳：192.168.31.254（网关）</span><br><span class=\"line\">  ↓</span><br><span class=\"line\">数据链路层：MAC 寻址 + 以太网帧封装</span><br><span class=\"line\">  ├─ 查 ARP 缓存：获取网关 MAC</span><br><span class=\"line\">  └─ 封装以太网帧</span><br><span class=\"line\">  ↓</span><br><span class=\"line\">物理层：电信号传输</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"🎓-学习体会\"><a href=\"#🎓-学习体会\" class=\"headerlink\" title=\"🎓 学习体会\"></a>🎓 学习体会</h3><p><strong>本次学习的核心价值：</strong></p>\n<ol>\n<li><p><strong>建立了网络层（IP）的完整认知</strong></p>\n<ul>\n<li>从理论（IP 地址、子网划分）到实践（路由表、Ping、Tracert）</li>\n<li>理解了数据包如何在网络中寻址和转发</li>\n</ul>\n</li>\n<li><p><strong>掌握了重要的网络诊断工具</strong></p>\n<ul>\n<li><code>route print</code>：查看路由表，理解网络配置</li>\n<li><code>ping</code>：测试连通性和延迟</li>\n<li><code>tracert</code>：追踪网络路径，定位故障点</li>\n</ul>\n</li>\n<li><p><strong>理解了 TTL 的多重作用</strong></p>\n<ul>\n<li>安全机制：防止路由环路</li>\n<li>诊断工具：Traceroute 的基础</li>\n<li>距离指标：推算网络跳数</li>\n</ul>\n</li>\n<li><p><strong>认识到真实网络的复杂性</strong></p>\n<ul>\n<li>多网络环境并存（物理网络、虚拟网络、VPN）</li>\n<li>安全设备影响诊断（防火墙不响应 ICMP）</li>\n<li>路由配置的重要性（默认路由是关键）</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h3 id=\"🔗-与前两天学习的联系\"><a href=\"#🔗-与前两天学习的联系\" class=\"headerlink\" title=\"🔗 与前两天学习的联系\"></a>🔗 与前两天学习的联系</h3><p><strong>Day001: OSI 模型与 TCP&#x2F;IP 协议栈</strong></p>\n<ul>\n<li>✅ 网络层（第 3 层）：IP 协议负责寻址和路由</li>\n<li>✅ ICMP 属于网络层协议，辅助 IP 进行错误报告和诊断</li>\n</ul>\n<p><strong>Day002: 以太网、MAC 与 ARP</strong></p>\n<ul>\n<li>✅ 数据链路层（第 2 层）：MAC 地址负责同网段通信</li>\n<li>✅ ARP 协议：IP → MAC 的桥梁</li>\n<li>✅ 路由决策后，需要 ARP 获取 MAC 地址才能发送</li>\n</ul>\n<p><strong>协议协作关系：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">访问外网的完整过程：</span><br><span class=\"line\">1. 应用层：用户访问 www.baidu.com</span><br><span class=\"line\">2. DNS 解析：域名 → IP (220.181.38.148)</span><br><span class=\"line\">3. 路由决策：查路由表 → 使用默认路由 → 下一跳是网关</span><br><span class=\"line\">4. ARP 查询：获取网关 MAC 地址</span><br><span class=\"line\">5. 封装发送：IP 包 + 以太网帧 → 发送到网关</span><br><span class=\"line\">6. 网关转发：网关继续路由到下一跳</span><br><span class=\"line\">7. 逐跳转发：经过多个路由器，TTL 逐渐减少</span><br><span class=\"line\">8. 到达目标：目标服务器处理请求并回复</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"📌-后续学习方向\"><a href=\"#📌-后续学习方向\" class=\"headerlink\" title=\"📌 后续学习方向\"></a>📌 后续学习方向</h3><p><strong>下一步可以深入的主题：</strong></p>\n<ol>\n<li><strong>IPv6</strong> - 下一代 IP 协议</li>\n<li><strong>OSPF&#x2F;BGP</strong> - 动态路由协议</li>\n<li><strong>NAT</strong> - 网络地址转换</li>\n<li><strong>VPN</strong> - 虚拟专用网络</li>\n<li><strong>防火墙规则</strong> - 流量控制与安全</li>\n</ol>\n<p><strong>建议实践：</strong></p>\n<ul>\n<li>在虚拟机中搭建多网段环境，练习路由配置</li>\n<li>使用 Wireshark 抓取 ICMP 包，分析详细字段</li>\n<li>学习静态路由配置，理解路由表的手动管理</li>\n</ul>\n<hr>\n<h3 id=\"✅-评估标准达成情况\"><a href=\"#✅-评估标准达成情况\" class=\"headerlink\" title=\"✅ 评估标准达成情况\"></a>✅ 评估标准达成情况</h3><table>\n<thead>\n<tr>\n<th>评估标准</th>\n<th>达成情况</th>\n<th>证据</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>能正确读取并解释本机路由表</strong></td>\n<td>✅ 达成</td>\n<td>完整解释了 <code>route print</code> 输出，识别默认路由、本地路由、虚拟机路由</td>\n</tr>\n<tr>\n<td><strong>能画出到目标的路径示意并解释跳数</strong></td>\n<td>✅ 达成</td>\n<td>绘制了到百度的完整路径图，解释了 15 跳的含义和网络层级</td>\n</tr>\n<tr>\n<td><strong>理解 IP 寻址与子网划分</strong></td>\n<td>✅ 达成</td>\n<td>完成子网计算练习（192.168.10.0&#x2F;26）</td>\n</tr>\n<tr>\n<td><strong>掌握 Ping&#x2F;Traceroute 的用途与差异</strong></td>\n<td>✅ 达成</td>\n<td>实际执行并分析了 Ping 和 Tracert 的输出结果</td>\n</tr>\n</tbody></table>\n<hr>\n<p><strong>学习日期：</strong> 2025-12-26<br><strong>完成时间：</strong> ⏰ 约 2 小时<br><strong>学习效果：</strong> ⭐⭐⭐⭐⭐ (5&#x2F;5)</p>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Dockerfile","url":"/post/5624fad4.html","content":"<h2 id=\"什么是Dockerfile\"><a href=\"#什么是Dockerfile\" class=\"headerlink\" title=\"什么是Dockerfile?\"></a>什么是Dockerfile?</h2><p>Dockerfile是一个包含用于组合映像的命令的文本文档。可以使用在命令行中调用任何命令。 Docker通过读取 Dockerfile 中的指令自动生成映像。</p>\n<p>Dockerfile 一般分为四部分：</p>\n<ol>\n<li>基础镜像信息</li>\n<li>维护者信息</li>\n<li>镜像操作指令</li>\n<li>容器启动时执行指令</li>\n</ol>\n<p><code>#</code> 为 Dockerfile 中的注释。</p>\n<p>Docker 以从上到下的顺序运行 Dockerfile 的指令。为了指定基本映像，<strong>第一条指令必须是FROM</strong>。一个声明以<code>＃</code> 字符开头则被视为注释。可以在Docker文件中使用 <code>RUN</code>，<code>CMD</code>，<code>FROM</code>，<code>EXPOSE</code>，<code>ENV</code> 等指令。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"常用指令\"><a href=\"#常用指令\" class=\"headerlink\" title=\"常用指令\"></a>常用指令</h2><h3 id=\"FROM：指定基础镜像，必须为第一个命令\"><a href=\"#FROM：指定基础镜像，必须为第一个命令\" class=\"headerlink\" title=\"FROM：指定基础镜像，必须为第一个命令\"></a><code>FROM</code>：指定基础镜像，必须为第一个命令</h3><figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\">格式：</span><br><span class=\"line\">　　<span class=\"keyword\">FROM</span> &lt;image&gt;</span><br><span class=\"line\">　　<span class=\"keyword\">FROM</span> &lt;image&gt;:&lt;tag&gt;</span><br><span class=\"line\">　　<span class=\"keyword\">FROM</span> &lt;image&gt;@&lt;digest&gt;</span><br><span class=\"line\">示例：</span><br><span class=\"line\">　　<span class=\"keyword\">FROM</span> mysql:<span class=\"number\">5.6</span></span><br><span class=\"line\">注：</span><br><span class=\"line\">tag 或 digest 是可选的，如果不使用这两个值时，会使用 latest 版本的基础镜像</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"MAINTAINER：维护者信息\"><a href=\"#MAINTAINER：维护者信息\" class=\"headerlink\" title=\"MAINTAINER：维护者信息\"></a><code>MAINTAINER</code>：维护者信息</h3><figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\">格式：</span><br><span class=\"line\">    <span class=\"keyword\">MAINTAINER</span> &lt;name&gt;</span><br><span class=\"line\">示例：</span><br><span class=\"line\">    <span class=\"keyword\">MAINTAINER</span> tt</span><br><span class=\"line\">    <span class=\"keyword\">MAINTAINER</span> tt@<span class=\"number\">163</span>.com</span><br><span class=\"line\">    <span class=\"keyword\">MAINTAINER</span> tt &lt;tt@<span class=\"number\">163</span>.com&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"RUN：构建镜像时执行的命令\"><a href=\"#RUN：构建镜像时执行的命令\" class=\"headerlink\" title=\"RUN：构建镜像时执行的命令\"></a><code>RUN</code>：构建镜像时执行的命令</h3><p><code>RUN</code> 用于在镜像容器中执行命令，其有以下两种命令执行方式：</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">shell</span><span class=\"language-bash\">执行</span></span><br><span class=\"line\">\t<span class=\"keyword\">RUN</span><span class=\"language-bash\"> &lt;<span class=\"built_in\">command</span>&gt;</span></span><br><span class=\"line\">exec执行</span><br><span class=\"line\">\t<span class=\"keyword\">RUN</span><span class=\"language-bash\"> [<span class=\"string\">&quot;executable&quot;</span>, <span class=\"string\">&quot;param1&quot;</span>, <span class=\"string\">&quot;param2&quot;</span>]</span></span><br><span class=\"line\">注：</span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> 指令创建的中间镜像会被缓存，并会在下次构建中使用。如果不想使用这些缓存镜像，可以在构建时指定--no-cache参数，如：docker build --no-cache</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"COPY-复制指令，从上下文目录中复制文件或者目录到容器里指定路径\"><a href=\"#COPY-复制指令，从上下文目录中复制文件或者目录到容器里指定路径\" class=\"headerlink\" title=\"COPY:复制指令，从上下文目录中复制文件或者目录到容器里指定路径\"></a><code>COPY</code>:复制指令，从上下文目录中复制文件或者目录到容器里指定路径</h3><figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\">格式：</span><br><span class=\"line\">    <span class=\"keyword\">COPY</span><span class=\"language-bash\"> [--<span class=\"built_in\">chown</span>=&lt;user&gt;:&lt;group&gt;] &lt;源路径1&gt;...  &lt;目标路径&gt;</span></span><br><span class=\"line\">    <span class=\"keyword\">COPY</span><span class=\"language-bash\"> [--<span class=\"built_in\">chown</span>=&lt;user&gt;:&lt;group&gt;] [<span class=\"string\">&quot;&lt;源路径1&gt;&quot;</span>,...  <span class=\"string\">&quot;&lt;目标路径&gt;&quot;</span>]</span></span><br><span class=\"line\">    [--chown=&lt;<span class=\"keyword\">user</span>&gt;:&lt;group&gt;]：可选参数，用户改变复制到容器内文件的拥有者和属组。</span><br><span class=\"line\">&lt;源路径&gt;：源文件或者源目录，这里可以是通配符表达式，其通配符规则要满足 Go 的 filepath.Match 规则。例如：</span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"language-bash\"> hom* /mydir/</span></span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"language-bash\"> hom?.txt /mydir/</span></span><br><span class=\"line\">&lt;目标路径&gt;：容器内的指定路径，该路径不用事先建好，路径不存在的话，会自动创建。</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ADD-将本地文件添加到容器中\"><a href=\"#ADD-将本地文件添加到容器中\" class=\"headerlink\" title=\"ADD:将本地文件添加到容器中\"></a>ADD:将本地文件添加到容器中</h3><p>ADD 指令和 COPY 的使用格式一致（同样需求下，官方推荐使用 COPY）。功能也类似，不同之处如下：</p>\n<ul>\n<li>ADD 的优点：在执行 &lt;源文件&gt; 为 tar 压缩文件的话，压缩格式为 gzip, bzip2 以及 xz 的情况下，会自动复制并解压到 &lt;目标路径&gt;。</li>\n<li>ADD 的缺点：在不解压的前提下，无法复制 tar 压缩文件。会令镜像构建缓存失效，从而可能会令镜像构建变得比较缓慢。具体是否使用，可以根据是否需要自动解压来决定。</li>\n</ul>\n<h3 id=\"CMD-构建容器后调用\"><a href=\"#CMD-构建容器后调用\" class=\"headerlink\" title=\"CMD:构建容器后调用\"></a>CMD:构建容器后调用</h3><p>类似于 RUN 指令，用于运行程序，但二者运行的时间点不同:</p>\n<ul>\n<li>CMD 在docker run 时运行。</li>\n<li>RUN 是在 docker build。</li>\n</ul>\n<p><strong>作用</strong>：为启动的容器指定默认要运行的程序，程序运行结束，容器也就结束。CMD 指令指定的程序可被 docker run 命令行参数中指定要运行的程序所覆盖。</p>\n<p><strong>注意</strong>：如果 Dockerfile 中如果存在多个 CMD 指令，仅最后一个生效。</p>\n<p>格式：</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"language-bash\"> &lt;shell 命令&gt; </span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"language-bash\"> [<span class=\"string\">&quot;&lt;可执行文件或命令&gt;&quot;</span>,<span class=\"string\">&quot;&lt;param1&gt;&quot;</span>,<span class=\"string\">&quot;&lt;param2&gt;&quot;</span>,...] </span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"language-bash\"> [<span class=\"string\">&quot;&lt;param1&gt;&quot;</span>,<span class=\"string\">&quot;&lt;param2&gt;&quot;</span>,...]  <span class=\"comment\"># 该写法是为 ENTRYPOINT 指令指定的程序提供默认参数</span></span></span><br></pre></td></tr></table></figure>\n\n<p>推荐使用第二种格式，执行过程比较明确。第一种格式实际上在运行的过程中也会自动转换成第二种格式运行，并且默认可执行文件是 sh。</p>\n<h3 id=\"ENTRYPOINT-追加指令\"><a href=\"#ENTRYPOINT-追加指令\" class=\"headerlink\" title=\"ENTRYPOINT:追加指令\"></a>ENTRYPOINT:追加指令</h3><p>类似于 CMD 指令，但其不会被 docker run 的命令行参数指定的指令所覆盖，而且这些命令行参数会被当作参数送给 ENTRYPOINT 指令指定的程序。</p>\n<p>但是, 如果运行 docker run 时使用了 —entrypoint 选项，此选项的参数可当作要运行的程序覆盖 ENTRYPOINT 指令指定的程序。</p>\n<p><strong>优点</strong>：在执行 docker run 的时候可以指定 ENTRYPOINT 运行所需的参数。</p>\n<p><strong>注意</strong>：如果 Dockerfile 中如果存在多个 ENTRYPOINT 指令，仅最后一个生效。</p>\n<p>格式：</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ENTRYPOINT</span><span class=\"language-bash\"> [<span class=\"string\">&quot;&lt;executeable&gt;&quot;</span>,<span class=\"string\">&quot;&lt;param1&gt;&quot;</span>,<span class=\"string\">&quot;&lt;param2&gt;&quot;</span>,...]</span></span><br></pre></td></tr></table></figure>\n\n<p>可以搭配 CMD 命令使用：一般是变参才会使用 CMD ，这里的 CMD 等于是在给 ENTRYPOINT 传参，以下示例会提到。</p>\n<p>示例：</p>\n<p>假设已通过 Dockerfile 构建了 nginx:test 镜像：</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">FROM</span> nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">ENTRYPOINT</span><span class=\"language-bash\"> [<span class=\"string\">&quot;nginx&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>] <span class=\"comment\"># 定参</span></span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"language-bash\"> [<span class=\"string\">&quot;/etc/nginx/nginx.conf&quot;</span>] <span class=\"comment\"># 变参</span></span></span><br></pre></td></tr></table></figure>\n\n<p>1、不传参运行</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ docker <span class=\"keyword\">run</span><span class=\"language-bash\">  nginx:<span class=\"built_in\">test</span></span></span><br></pre></td></tr></table></figure>\n\n<p>容器内会默认运行以下命令，启动主进程。</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\">nginx -c /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>\n\n<p>2、传参运行</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ docker <span class=\"keyword\">run</span><span class=\"language-bash\">  nginx:<span class=\"built_in\">test</span> -c /etc/nginx/new.conf</span></span><br></pre></td></tr></table></figure>\n\n<p>容器内会默认运行以下命令，启动主进程(&#x2F;etc&#x2F;nginx&#x2F;new.conf:假设容器内已有此文件)</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\">nginx -c /etc/nginx/new.conf</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ENV-设置环境变量\"><a href=\"#ENV-设置环境变量\" class=\"headerlink\" title=\"ENV:设置环境变量\"></a>ENV:设置环境变量</h3><p>设置环境变量，定义了环境变量，那么在后续的指令中，就可以使用这个环境变量。</p>\n<p>格式：</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ENV</span> &lt;key&gt; &lt;value&gt;</span><br><span class=\"line\"><span class=\"keyword\">ENV</span> &lt;key1&gt;=&lt;value1&gt; &lt;key2&gt;=&lt;value2&gt;...</span><br></pre></td></tr></table></figure>\n\n<p>以下示例设置 NODE_VERSION &#x3D; 7.2.0 ， 在后续的指令中可以通过 $NODE_VERSION 引用：</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ENV</span> NODE_VERSION <span class=\"number\">7.2</span>.<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> curl -SLO <span class=\"string\">&quot;https://nodejs.org/dist/v<span class=\"variable\">$NODE_VERSION</span>/node-v<span class=\"variable\">$NODE_VERSION</span>-linux-x64.tar.xz&quot;</span> \\</span></span><br><span class=\"line\"><span class=\"language-bash\">  &amp;&amp; curl -SLO <span class=\"string\">&quot;https://nodejs.org/dist/v<span class=\"variable\">$NODE_VERSION</span>/SHASUMS256.txt.asc&quot;</span></span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ARG-设置的环境变量仅对-Dockerfile-内有效\"><a href=\"#ARG-设置的环境变量仅对-Dockerfile-内有效\" class=\"headerlink\" title=\"ARG:设置的环境变量仅对 Dockerfile 内有效\"></a>ARG:设置的环境变量仅对 Dockerfile 内有效</h3><p>构建参数，与 ENV 作用一至。不过作用域不一样。ARG 设置的环境变量仅对 Dockerfile 内有效，也就是说只有 docker build 的过程中有效，构建好的镜像内不存在此环境变量。</p>\n<p>构建命令 docker build 中可以用 —build-arg &lt;参数名&gt;&#x3D;&lt;值&gt; 来覆盖。</p>\n<p>格式：</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ARG</span> &lt;参数名&gt;[=&lt;默认值&gt;]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"VOLUME-定义匿名数据卷\"><a href=\"#VOLUME-定义匿名数据卷\" class=\"headerlink\" title=\"VOLUME:定义匿名数据卷\"></a>VOLUME:定义匿名数据卷</h3><p>定义匿名数据卷。在启动容器时忘记挂载数据卷，会自动挂载到匿名卷。</p>\n<p>作用：</p>\n<ul>\n<li>避免重要的数据，因容器重启而丢失，这是非常致命的。</li>\n<li>避免容器不断变大。</li>\n</ul>\n<p>格式：</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">VOLUME</span><span class=\"language-bash\"> [<span class=\"string\">&quot;&lt;路径1&gt;&quot;</span>, <span class=\"string\">&quot;&lt;路径2&gt;&quot;</span>...]</span></span><br><span class=\"line\"><span class=\"keyword\">VOLUME</span><span class=\"language-bash\"> &lt;路径&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>在启动容器 docker run 的时候，我们可以通过 -v 参数修改挂载点。</p>\n<h3 id=\"EXPOSE-暴露端口\"><a href=\"#EXPOSE-暴露端口\" class=\"headerlink\" title=\"EXPOSE:暴露端口\"></a>EXPOSE:暴露端口</h3><p>仅仅只是声明端口。</p>\n<p>作用：</p>\n<ul>\n<li>帮助镜像使用者理解这个镜像服务的守护端口，以方便配置映射。</li>\n<li>在运行时使用随机端口映射时，也就是 docker run -P 时，会自动随机映射 EXPOSE 的端口。</li>\n</ul>\n<p>格式：</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">EXPOSE</span> &lt;端口<span class=\"number\">1</span>&gt; [&lt;端口<span class=\"number\">2</span>&gt;...]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"WORKDIR-docker-run之后的目录\"><a href=\"#WORKDIR-docker-run之后的目录\" class=\"headerlink\" title=\"WORKDIR:docker run之后的目录\"></a>WORKDIR:docker run之后的目录</h3><p>指定工作目录。用 WORKDIR 指定的工作目录，会在构建镜像的每一层中都存在。（WORKDIR 指定的工作目录，必须是提前创建好的）。</p>\n<p>docker build 构建镜像过程中的，每一个 RUN 命令都是新建的一层。只有通过 WORKDIR 创建的目录才会一直存在。</p>\n<p>格式：</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> &lt;工作目录路径&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"USER-指定运行后面指令的用户和用户组\"><a href=\"#USER-指定运行后面指令的用户和用户组\" class=\"headerlink\" title=\"USER:指定运行后面指令的用户和用户组\"></a>USER:指定运行后面指令的用户和用户组</h3><p>用于指定执行后续命令的用户和用户组，这边只是切换后续命令执行的用户（用户和用户组必须提前已经存在）。</p>\n<p>格式：</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">USER</span> &lt;用户名&gt;[:&lt;用户组&gt;]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"HEALTHCHECK-用于指定某个程序或者指令来监控-docker-容器服务的运行状态。\"><a href=\"#HEALTHCHECK-用于指定某个程序或者指令来监控-docker-容器服务的运行状态。\" class=\"headerlink\" title=\"HEALTHCHECK:用于指定某个程序或者指令来监控 docker 容器服务的运行状态。\"></a>HEALTHCHECK:用于指定某个程序或者指令来监控 docker 容器服务的运行状态。</h3><p>用于指定某个程序或者指令来监控 docker 容器服务的运行状态。</p>\n<p>格式：</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">HEALTHCHECK</span><span class=\"language-bash\"> [选项] CMD &lt;命令&gt;：设置检查容器健康状况的命令</span></span><br><span class=\"line\"><span class=\"keyword\">HEALTHCHECK</span><span class=\"language-bash\"> NONE：如果基础镜像有健康检查指令，使用这行可以屏蔽掉其健康检查指令</span></span><br><span class=\"line\"><span class=\"keyword\">HEALTHCHECK</span><span class=\"language-bash\"> [选项] CMD &lt;命令&gt; : 这边 CMD 后面跟随的命令使用，可以参考 CMD 的用法。</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ONBUILD-用于延迟构建命令的执行\"><a href=\"#ONBUILD-用于延迟构建命令的执行\" class=\"headerlink\" title=\"ONBUILD:用于延迟构建命令的执行\"></a>ONBUILD:用于延迟构建命令的执行</h3><p>用于延迟构建命令的执行。简单的说，就是 Dockerfile 里用 ONBUILD 指定的命令，在本次构建镜像的过程中不会执行（假设镜像为 test-build）。当有新的 Dockerfile 使用了之前构建的镜像 FROM test-build ，这是执行新镜像的 Dockerfile 构建时候，会执行 test-build 的 Dockerfile 里的 ONBUILD 指定的命令。</p>\n<p>格式：</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ONBUILD</span> &lt;其它指令&gt;</span><br></pre></td></tr></table></figure>\n\n<p>以上参考: <a href=\"https://www.runoob.com/docker/docker-dockerfile.html\">https://www.runoob.com/docker/docker-dockerfile.html</a></p>\n<h2 id=\"实例-制作一个Dockerfile\"><a href=\"#实例-制作一个Dockerfile\" class=\"headerlink\" title=\"实例:制作一个Dockerfile\"></a>实例:制作一个Dockerfile</h2><p>我们在<code>/home</code>下新建一个文件夹 <code>mkdir -f /home/project</code></p>\n<p>进入该目录 <code>cd /home/project</code></p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim app.py</span><br><span class=\"line\"><span class=\"comment\">#app.py</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> flask import Flask</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">@app.route(<span class=\"string\">&#x27;/&#x27;</span>)</span><br><span class=\"line\">def hello_world():</span><br><span class=\"line\">    return <span class=\"string\">&#x27;Hello DockerFile!&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">if __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run(host=<span class=\"string\">&#x27;0.0.0.0&#x27;</span>, port=<span class=\"number\">5000</span>)</span><br></pre></td></tr></table></figure>\n\n<p>新建一个<code>Dockerfile</code>文件,</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Base images 基础镜像 必须放在开头</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> centos</span><br><span class=\"line\"><span class=\"comment\">#MAINTAINER 维护者信息</span></span><br><span class=\"line\"><span class=\"keyword\">MAINTAINER</span> Tigercoll</span><br><span class=\"line\"><span class=\"comment\"># 更新 以及安装python</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> yum -y install python3</span></span><br><span class=\"line\"><span class=\"comment\"># 安装flask</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> pip3 install flask</span></span><br><span class=\"line\"><span class=\"comment\"># 设置环境项目目录</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> WORKPATH /flask/project</span><br><span class=\"line\"><span class=\"comment\"># 创建目录</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> <span class=\"built_in\">mkdir</span> -p <span class=\"variable\">$WORKPATH</span></span></span><br><span class=\"line\"><span class=\"comment\"># 拷贝文件到项目目录</span></span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"language-bash\"> app.py <span class=\"variable\">$WORKPATH</span></span></span><br><span class=\"line\"><span class=\"comment\"># 切换工作目录</span></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> <span class=\"variable\">$WORKPATH</span></span></span><br><span class=\"line\"><span class=\"comment\"># 暴露端口</span></span><br><span class=\"line\"><span class=\"keyword\">EXPOSE</span> <span class=\"number\">5000</span></span><br><span class=\"line\"><span class=\"comment\"># 容器启动时执行</span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"language-bash\"> python3 app.py</span></span><br></pre></td></tr></table></figure>\n\n<p>制作镜像 <code>docker build -t flask:1.0 .</code> 如果名字是Dockerfile的话就不需要 <code>-f</code> 指定,如果不是请用 <code>-f</code> 指定文件,</p>\n<p>这个<code>.</code>是上下文路径:上下文路径，是指 docker 在构建镜像，有时候想要使用到本机的文件（比如复制），docker build 命令得知这个路径后，会将路径下的所有内容打包。</p>\n<p><strong>解析</strong>：由于 docker 的运行模式是 C&#x2F;S。我们本机是 C，docker 引擎是 S。实际的构建过程是在 docker 引擎下完成的，所以这个时候无法用到我们本机的文件。这就需要把我们本机的指定目录下的文件一起打包提供给 docker 引擎使用。</p>\n<p>如果未说明最后一个参数，那么默认上下文路径就是 Dockerfile 所在的位置。</p>\n<p><strong>注意</strong>：上下文路径下不要放无用的文件，因为会一起打包发送给 docker 引擎，如果文件过多会造成过程缓慢。</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\">Removing intermediate container <span class=\"number\">53</span>b01ced53d2</span><br><span class=\"line\"> ---&gt; <span class=\"number\">708</span>e9ab6c83e</span><br><span class=\"line\">Step <span class=\"number\">10</span>/<span class=\"number\">10</span> : <span class=\"keyword\">CMD</span><span class=\"language-bash\"> python3 app.py</span></span><br><span class=\"line\"> ---&gt; Running in <span class=\"number\">871455</span>a7187c</span><br><span class=\"line\">Removing intermediate container <span class=\"number\">871455</span>a7187c</span><br><span class=\"line\"> ---&gt; <span class=\"number\">90</span>d4d1c76098</span><br><span class=\"line\">Successfully built <span class=\"number\">90</span>d4d1c76098</span><br><span class=\"line\">Successfully tagged flask:<span class=\"number\">1.0</span></span><br></pre></td></tr></table></figure>\n\n<p>可以看到这里制作成功了我们<code>docker images</code>看一下</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost project]<span class=\"comment\"># docker images</span></span><br><span class=\"line\">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">flask               <span class=\"number\">1.0</span>                 <span class=\"number\">90</span>d4d1c76098        <span class=\"number\">4</span> minutes ago       <span class=\"number\">275</span>MB</span><br><span class=\"line\">centos              latest              <span class=\"number\">470671670</span>cac        <span class=\"number\">4</span> months ago        <span class=\"number\">237</span>MB</span><br></pre></td></tr></table></figure>\n\n<p>运行一下 <code>docker run -d -p 5000:5000 flask:1.0</code></p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost project]<span class=\"comment\"># docker run -d -p 5000:5000 flask:1.0</span></span><br><span class=\"line\">ea4400c411b18c286731b51ce2e4b7b13c320e08a10b3f7b55e6fb5ed6220722</span><br></pre></td></tr></table></figure>\n\n<p>查看<code>docker ps</code></p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost project]<span class=\"comment\"># docker ps</span></span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</span><br><span class=\"line\">ea4400c411b1        flask:<span class=\"number\">1.0</span>           <span class=\"string\">&quot;/bin/sh -c &#x27;python3…&quot;</span>   <span class=\"number\">23</span> seconds ago      Up <span class=\"number\">22</span> seconds       <span class=\"number\">0.0</span>.<span class=\"number\">0.0</span>:<span class=\"number\">5000</span>-&gt;<span class=\"number\">5000</span>/tcp   admiring_agnesi</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/Dockerfile/image-20200604233641684-16506093032071.png\" alt=\"img\"></p>\n<p>可以看到浏览器能正常访问,说明我们的Dockerfile 制作成功</p>\n","categories":["Dockerfile"],"tags":["docker","Dockerfile"]},{"title":"Docker数据管理(数据卷&数据卷容器)","url":"/post/bba4516c.html","content":"<p>有些时候，我们的服务运行时必不可少的会产生一些日志，或是我们需要把容器内的数据进行备份，甚至多个容器之间进行数据共享，这必然涉及容器的数据管理操作。</p>\n<p><strong>容器中管理数据主要有两种方式：</strong></p>\n<p>数据卷</p>\n<p>数据卷容器</p>\n<span id=\"more\"></span>\n\n<h2 id=\"数据卷\"><a href=\"#数据卷\" class=\"headerlink\" title=\"数据卷\"></a>数据卷</h2><p>数据卷是一个可供容器使用的特殊目录，它绕过文件系统，可以提供很多有用的特性：</p>\n<ul>\n<li>数据卷可以在容器之间共享和重用</li>\n<li>对数据卷的修改会立马生效</li>\n<li>对数据卷的更新，不会影响镜像</li>\n<li>卷会一直存在，直到没有容器使用</li>\n</ul>\n<p>#(类似linux下的挂载(mount))</p>\n<h3 id=\"命令添加\"><a href=\"#命令添加\" class=\"headerlink\" title=\"命令添加\"></a>命令添加</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker run -it -v /宿主机绝对路劲目录:/容器内目录:读写权限 镜像名称</span><br></pre></td></tr></table></figure>\n\n<p>实例:创建</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">sudo docker run -it -v /home/apples/Desktop/dateVolume:/dateVolume centos</span></span><br><span class=\"line\">[root@b0f35537f8c3 /]# </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">这个时候已经进入到centos容器当中,我们<span class=\"built_in\">ls</span>查看,有刚才的dateVolume</span></span><br><span class=\"line\">[root@b0f35537f8c3 /]# ls</span><br><span class=\"line\">bin\t    dev  home  lib64\t   media  opt\troot  sbin  sys  usr</span><br><span class=\"line\">dateVolume  etc  lib   lost+found  mnt\t  proc\trun   srv   tmp  var</span><br></pre></td></tr></table></figure>\n\n<p>我们新建一个ssh连接查看</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">apples@apples-PC:~$ ls /home/apples/Desktop/</span><br><span class=\"line\">dateVolume</span><br></pre></td></tr></table></figure>\n\n<p>所以-v 会新建一个目录,如果原来没有的话</p>\n<p>我们可以用<code>docker inspect 容器ID</code>查看</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">&quot;HostConfig&quot;: &#123;</span><br><span class=\"line\">            &quot;Binds&quot;: [</span><br><span class=\"line\">                &quot;/home/apples/Desktop/dateVolume:/dateVolume&quot;</span><br><span class=\"line\">            ],</span><br><span class=\"line\"></span><br><span class=\"line\">    &quot;Mounts&quot;: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                &quot;Type&quot;: &quot;bind&quot;,</span><br><span class=\"line\">                &quot;Source&quot;: &quot;/home/apples/Desktop/dateVolume&quot;,</span><br><span class=\"line\">                &quot;Destination&quot;: &quot;/dateVolume&quot;,</span><br><span class=\"line\">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class=\"line\">                &quot;RW&quot;: true, #读写</span><br><span class=\"line\">                &quot;Propagation&quot;: &quot;rprivate&quot;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ],</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"数据共享\"><a href=\"#数据共享\" class=\"headerlink\" title=\"数据共享\"></a>数据共享</h3><p>我们进入宿主机刚才创建的目录<code>dateVolume</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">~/Desktop/dateVolume$ </span><span class=\"language-bash\">sudo <span class=\"built_in\">touch</span> a.txt</span></span><br></pre></td></tr></table></figure>\n\n<p>切换回容器中</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@b0f35537f8c3 /]# cd dateVolume/</span><br><span class=\"line\">[root@b0f35537f8c3 dateVolume]# ls</span><br><span class=\"line\">a.txt</span><br></pre></td></tr></table></figure>\n\n<p>发现容器中已经存在刚才创建的<code>a.txt</code></p>\n<p>我们在容器中写入数据</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@b0f35537f8c3 dateVolume]# echo &quot;update in container&quot; &gt; a.txt</span><br></pre></td></tr></table></figure>\n\n<p>我们切换回宿主机 <code>cat</code>查看</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">apples@apples-PC:~/Desktop/dateVolume$ cat a.txt </span><br><span class=\"line\">update in container</span><br></pre></td></tr></table></figure>\n\n<p>证明:数据卷可以在容器之间共享和重用,对数据卷的修改会立马生效</p>\n<h3 id=\"DockerFile添加\"><a href=\"#DockerFile添加\" class=\"headerlink\" title=\"DockerFile添加\"></a>DockerFile添加</h3><p>Dockfile是一种被Docker程序解释的脚本，Dockerfile由一条一条的指令组成，每条指令对应Linux下面的一条命令。Docker程序将这些Dockerfile指令翻译真正的Linux命令。Dockerfile有自己书写格式和支持的命令，Docker程序解决这些命令间的依赖关系，类似于Makefile。Docker程序将读取Dockerfile，根据指令生成定制的image。相比image这种黑盒子，Dockerfile这种显而易见的脚本更容易被使用者接受，它明确的表明image是怎么产生的。有了Dockerfile，当我们需要定制自己额外的需求时，只需在Dockerfile上添加或者修改指令，重新生成image即可，省去了敲命令的麻烦。</p>\n<p>DockerFile 中有个<code>VOLUME</code>来定义匿名的数据卷</p>\n<h4 id=\"VOLUME\"><a href=\"#VOLUME\" class=\"headerlink\" title=\"VOLUME\"></a>VOLUME</h4><p>定义匿名数据卷。在启动容器时忘记挂载数据卷，会自动挂载到匿名卷。</p>\n<p>作用：</p>\n<ul>\n<li>避免重要的数据，因容器重启而丢失，这是非常致命的。</li>\n<li>避免容器不断变大。</li>\n</ul>\n<p>格式：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">VOLUME [&quot;&lt;路径1&gt;&quot;, &quot;&lt;路径2&gt;&quot;...]</span><br><span class=\"line\">VOLUME &lt;路径&gt;</span><br></pre></td></tr></table></figure>\n\n<p>在启动容器 docker run 的时候，我们可以通过 -v 参数修改挂载点。</p>\n<p>我们可以在<code>docker inspect</code> 中查看挂载到宿主机上的路径</p>\n<h2 id=\"数据卷容器\"><a href=\"#数据卷容器\" class=\"headerlink\" title=\"数据卷容器\"></a><strong>数据卷容器</strong></h2><p>如果用户需要在容器之间共享一些持续更新的数据，最简单的方式是使用数据卷容器，数据卷容器其实是一个普通的容器，专门用来提供数据卷供其它容器挂载。</p>\n<p>数据卷容器，其实就是一个正常的容器，专门用来提供数据卷供其它容器挂载的。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker run --volumes-from [容器名称]</span><br></pre></td></tr></table></figure>\n\n<p>我们用刚才已经挂载过的容器(必须要有一个已经挂载过数据卷)</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">~/Desktop/dateVolume$ </span><span class=\"language-bash\">sudo docker ps</span></span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class=\"line\">b0f35537f8c3        centos              &quot;/bin/bash&quot;         About an hour ago   Up About an hour                        priceless_cartwright</span><br></pre></td></tr></table></figure>\n\n<p>然后，在其他容器中使用 <code>--volumes-from</code> 来挂载 刚才容器中的数据卷。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">~/Desktop/dateVolume$ </span><span class=\"language-bash\">sudo docker run -it --volumes-from priceless_cartwright --name mycentos_1 centos</span></span><br><span class=\"line\">[root@2192a4befa17 /]#</span><br></pre></td></tr></table></figure>\n\n<p>我们检查一下之前的数据是否存在</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@2192a4befa17 /]# ls</span><br><span class=\"line\">bin  dateVolume  dev  etc  home  lib  lib64  lost+found  media\tmnt  opt  proc\troot  run  sbin  srv  sys  tmp\tusr  var</span><br><span class=\"line\">[root@2192a4befa17 /]# ls dateVolume/</span><br><span class=\"line\">a.txt</span><br></pre></td></tr></table></figure>\n\n<p>注意：使用 <code>--volumes-from</code> 参数所挂载数据卷的容器自己并不需要保持在运行状态。</p>\n<p>如果删除了挂载的容器，数据卷并不会被自动删除。如果要删除一个数据卷，必须在删除最后一个还挂载着它的容器时使用 <code>docker rm -v</code> 命令来指定同时删除关联的容器。 这可以让用户在容器之间升级和移动数据卷。</p>\n<h3 id=\"利用数据卷容器来备份、恢复、迁移数据卷\"><a href=\"#利用数据卷容器来备份、恢复、迁移数据卷\" class=\"headerlink\" title=\"利用数据卷容器来备份、恢复、迁移数据卷\"></a>利用数据卷容器来备份、恢复、迁移数据卷</h3><p>可以利用数据卷对其中的数据进行进行备份、恢复和迁移。</p>\n<h4 id=\"备份\"><a href=\"#备份\" class=\"headerlink\" title=\"备份\"></a>备份</h4><p>首先使用 <code>--volumes-from</code> 标记来创建一个加载 dbdata 容器卷的容器，并从本地主机挂载当前到容器的 &#x2F;backup 目录。命令如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">sudo docker run --volumes-from dbdata -v $(<span class=\"built_in\">pwd</span>):/backup ubuntu tar cvf /backup/backup.tar /dbdata</span></span><br></pre></td></tr></table></figure>\n\n<p>容器启动后，使用了 <code>tar</code> 命令来将 dbdata 卷备份为本地的 <code>/backup/backup.tar</code>。</p>\n<h4 id=\"恢复\"><a href=\"#恢复\" class=\"headerlink\" title=\"恢复\"></a>恢复</h4><p>如果要恢复数据到一个容器，首先创建一个带有数据卷的容器 dbdata2。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">sudo docker run -v /dbdata --name dbdata2 ubuntu /bin/bash</span></span><br></pre></td></tr></table></figure>\n\n<p>然后创建另一个容器，挂载 dbdata2 的容器，并使用 <code>untar</code> 解压备份文件到挂载的容器卷中。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">sudo docker run --volumes-from dbdata2 -v $(<span class=\"built_in\">pwd</span>):/backup busybox tar xvf</span></span><br><span class=\"line\">/backup/backup.tar</span><br></pre></td></tr></table></figure>\n\n","categories":["docker"],"tags":["docker","数据卷","数据卷容器"]},{"title":"Linux多命令顺序执行","url":"/post/8827c927.html","content":"<p>对于单个命令执行大多数人都是明了的，也就是在一个命令行上执行一条命令。那对于在一行上执行多个命令怎么办呢，其实也很简单，只需在各命令之间加上特殊命令符号，我们常规使用到的有3个特殊命令符号。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"[;]\"></a>[;]</h2><p>如果被分号(;)所分隔的命令会连续的执行下去，就算是错误的命令也会继续执行后面的命令。</p>\n<p><img data-src=\"/../images/Linux%E5%A4%9A%E5%91%BD%E4%BB%A4%E9%A1%BA%E5%BA%8F%E6%89%A7%E8%A1%8C/image-20220927160841394.png\" alt=\"image-20220927160841394\"></p>\n<h2 id=\"amp-amp\"><a href=\"#amp-amp\" class=\"headerlink\" title=\"[&amp;&amp;]\"></a>[&amp;&amp;]</h2><p>如果命令被&amp;&amp;所分隔，那么命令也会一直执行下去，但是中间有错误的命令存在就不会执行后面的命令，没错就直行至完为止。</p>\n<p><img data-src=\"/../images/Linux%E5%A4%9A%E5%91%BD%E4%BB%A4%E9%A1%BA%E5%BA%8F%E6%89%A7%E8%A1%8C/image-20220927160805426.png\" alt=\"image-20220927160805426\"></p>\n<h2 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"[||]\"></a>[||]</h2><p>如果每个命令被双竖线||所分隔，那么一遇到可以执行成功的命令就会停止执行后面的命令，而不管后面的命令是否正确与否。如果执行到错误的命令就是继续执行后一个命令，一直执行到遇到正确的命令为止。</p>\n<p><img data-src=\"/../images/Linux%E5%A4%9A%E5%91%BD%E4%BB%A4%E9%A1%BA%E5%BA%8F%E6%89%A7%E8%A1%8C/image-20220927160909346.png\" alt=\"image-20220927160909346\"></p>\n","categories":["linux"],"tags":["linux"]},{"title":"JWT json-web-token 介绍","url":"/post/d140a83b.html","content":"<p>根据维基百科的定义，<strong>JSON WEB Token</strong>（<strong>JWT</strong>，读作 [&#x2F;dʒɒt&#x2F;]），是一种基于JSON的、用于在网络上声明某种主张的令牌（token）。JWT通常由三部分组成: 头信息（header）, 消息体（payload）和签名（signature）。</p>\n<span id=\"more\"></span>\n\n<h3 id=\"JWT特点：\"><a href=\"#JWT特点：\" class=\"headerlink\" title=\"JWT特点：\"></a>JWT特点：</h3><ul>\n<li><strong>简洁(Compact)</strong>: 可以通过URL，POST参数或者在HTTP header发送，因为数据量小，传输速度也很快</li>\n<li><strong>自包含(Self-contained)</strong> : 负载中包含了所有用户所需要的信息，避免了多次查询数据库</li>\n</ul>\n<h3 id=\"JWT-的原理\"><a href=\"#JWT-的原理\" class=\"headerlink\" title=\"JWT 的原理\"></a>JWT 的原理</h3><p>JWT 的原理是，服务器认证以后，生成一个 JSON 对象，发回给用户，就像下面这样。</p>\n<blockquote>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;姓名&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;admin&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;角色&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;管理员&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;到期时间&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2021年1月1日0点0分&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n</blockquote>\n<p>以后，用户与服务端通信的时候，都要发回这个 JSON 对象。服务器完全只靠这个对象认定用户身份。为了防止用户篡改数据，服务器在生成这个对象的时候，会加上签名（详见后文）。</p>\n<p>服务器就不保存任何 session 数据了，也就是说，服务器变成无状态了，从而比较容易实现扩展。</p>\n<h3 id=\"JWT结构\"><a href=\"#JWT结构\" class=\"headerlink\" title=\"JWT结构\"></a>JWT结构</h3><p>JWT主要包含三个部分之间用英语句号’.’隔开</p>\n<p>header.payload.signature</p>\n<h4 id=\"头部-header\"><a href=\"#头部-header\" class=\"headerlink\" title=\"头部(header)\"></a>头部(header)</h4><p>在header中通常包含两部分,token类型和采用的加密算法</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;alg&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;HS256&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;typ&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;JWT&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>上面代码中，<code>alg</code>属性表示签名的算法（algorithm），默认是 HMAC SHA256（写成 HS256）；<code>typ</code>属性表示这个令牌（token）的类型（type），JWT 令牌统一写为<code>JWT</code>。</p>\n<p>然后再将其进行base64编码得到如下:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> json ,base64</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 因为我们有可能把token放到后面 /?token=xxx,所以我们选择urlsafe_b64encode </span></span><br><span class=\"line\">header = base64.urlsafe_b64encode(json.dumps(&#123;<span class=\"string\">&quot;alg&quot;</span>: <span class=\"string\">&quot;HS256&quot;</span>,  <span class=\"string\">&quot;typ&quot;</span>: <span class=\"string\">&quot;JWT&quot;</span>&#125;).encode(<span class=\"string\">&#x27;utf-8&#x27;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">header</span><br><span class=\"line\"><span class=\"comment\"># b&#x27;eyJhbGciOiAiSFMyNTYiLCAidHlwIjogIkpXVCJ9&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"JWT的负载-Payload\"><a href=\"#JWT的负载-Payload\" class=\"headerlink\" title=\"JWT的负载(Payload)\"></a>JWT的负载(Payload)</h4><p>Payload 部分也是一个 JSON 对象，用来存放实际需要传递的数据。JWT 规定了7个官方字段，供选用。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">iss (issuer)：签发人</span><br><span class=\"line\">exp (expiration time)：过期时间</span><br><span class=\"line\">sub (subject)：主题</span><br><span class=\"line\">aud (audience)：受众</span><br><span class=\"line\">nbf (Not Before)：生效时间</span><br><span class=\"line\">iat (Issued At)：签发时间</span><br><span class=\"line\">jti (JWT ID)：编号</span><br></pre></td></tr></table></figure>\n\n<p>除了官方字段，你还可以在这个部分定义私有字段，下面就是一个例子。</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;user_name&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;admin&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;user_id&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;123&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>然后我们再将其用base64编码一下:</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\">import json <span class=\"punctuation\">,</span>base64</span><br><span class=\"line\"></span><br><span class=\"line\">payload = base64.urlsafe_b64encode(json.dumps(<span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;user_name&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;admin&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;user_id&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;123&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span>).encode(&#x27;utf<span class=\"number\">-8</span>&#x27;))</span><br><span class=\"line\"></span><br><span class=\"line\">payload</span><br><span class=\"line\">Out<span class=\"punctuation\">[</span><span class=\"number\">3</span><span class=\"punctuation\">]</span><span class=\"punctuation\">:</span> b&#x27;eyJ1c2VyX25hbWUiOiAiYWRtaW4iLCAidXNlcl9pZCI6ICIxMjMifQ==&#x27;</span><br></pre></td></tr></table></figure>\n\n<p>注意，JWT 默认是不加密的，任何人都可以读到，所以不要把秘密信息放在这个部分。</p>\n<h4 id=\"Signature-签名\"><a href=\"#Signature-签名\" class=\"headerlink\" title=\"Signature(签名)\"></a>Signature(签名)</h4><p>签名其实是对JWT的头部和负载整合的一个签名验证</p>\n<p>首先需要将头部和负载通过.连接起来.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">sig = header+<span class=\"string\">b&#x27;.&#x27;</span>+payload</span><br><span class=\"line\"><span class=\"string\">b&#x27;eyJhbGciOiAiSFMyNTYiLCAidHlwIjogIkpXVCJ9.eyJ1c2VyX25hbWUiOiAiYWRtaW4iLCAidXNlcl9pZCI6ICIxMjMifQ==&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>然后再对其用HMacSHA256加密算法,这里需要用到一个Key</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> hmac</span><br><span class=\"line\">key = <span class=\"string\">b&#x27;test&#x27;</span></span><br><span class=\"line\">signature = hmac.new(key,sig,digestmod=<span class=\"string\">&#x27;SHA256&#x27;</span>)</span><br><span class=\"line\">sign = signature.hexdigest()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 得到字符串 注意这里得到的是字符串</span></span><br><span class=\"line\"><span class=\"string\">&#x27;0867e2b9ca7c5bec8a8d348487df710429324830ccd00652875a809560c28536&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>然后再对其使用base64位加密</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">sign = base64.urlsafe_b64encode(signature.hexdigest().encode(<span class=\"string\">&#x27;utf-8&#x27;</span>))   <span class=\"string\">b&#x27;MDg2N2UyYjljYTdjNWJlYzhhOGQzNDg0ODdkZjcxMDQyOTMyNDgzMGNjZDAwNjUyODc1YTgwOTU2MGMyODUzNg==&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>最终我们得到JWT</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">jwt = header+<span class=\"string\">b&#x27;.&#x27;</span>+payload+<span class=\"string\">b&#x27;.&#x27;</span>+sign</span><br><span class=\"line\"><span class=\"string\">b&#x27;eyJhbGciOiAiSFMyNTYiLCAidHlwIjogIkpXVCJ9.eyJ1c2VyX25hbWUiOiAiYWRtaW4iLCAidXNlcl9pZCI6ICIxMjMifQ==.MDg2N2UyYjljYTdjNWJlYzhhOGQzNDg0ODdkZjcxMDQyOTMyNDgzMGNjZDAwNjUyODc1YTgwOTU2MGMyODUzNg==&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"JWT的使用\"><a href=\"#JWT的使用\" class=\"headerlink\" title=\"JWT的使用\"></a>JWT的使用</h3><p>客户端收到服务器返回的 JWT，可以储存在 Cookie 里面，也可以储存在 localStorage。</p>\n<p>此后，客户端每次与服务器通信，都要带上这个 JWT。你可以把它放在 Cookie 里面自动发送，但是这样不能跨域，所以更好的做法是放在 HTTP 请求的头信息<code>Authorization</code>字段里面。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Authorization</span>: <span class=\"title class_\">Bearer</span> &lt;token&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"JWT-的几个特点\"><a href=\"#JWT-的几个特点\" class=\"headerlink\" title=\"JWT 的几个特点\"></a>JWT 的几个特点</h3><p>（1）JWT 默认是不加密，但也是可以加密的。生成原始 Token 以后，可以用密钥再加密一次。</p>\n<p>（2）JWT 不加密的情况下，不能将秘密数据写入 JWT。</p>\n<p>（3）JWT 不仅可以用于认证，也可以用于交换信息。有效使用 JWT，可以降低服务器查询数据库的次数。</p>\n<p>（4）JWT 的最大缺点是，由于服务器不保存 session 状态，因此无法在使用过程中废止某个 token，或者更改 token 的权限。也就是说，一旦 JWT 签发了，在到期之前就会始终有效，除非服务器部署额外的逻辑。</p>\n<p>（5）JWT 本身包含了认证信息，一旦泄露，任何人都可以获得该令牌的所有权限。为了减少盗用，JWT 的有效期应该设置得比较短。对于一些比较重要的权限，使用时应该再次对用户进行认证。</p>\n<p>（6）为了减少盗用，JWT 不应该使用 HTTP 协议明码传输，要使用 HTTPS 协议传输。</p>\n<p>以上借鉴了阮一峰大神的博客,<a href=\"https://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html\">博客地址</a></p>\n","categories":["jwt"],"tags":["jwt"]},{"title":"NAT地址转换","url":"/post/2a46438c.html","content":"<p>随着Internet的发展和网络应用的增多，IPv4地址枯竭已成为制约网络发展的瓶颈。尽管IPv6可以从根本上解决IPv4地址空间不足问题，但目前众多网络设备和网络应用大多是基于IPv4的，因此在IPv6广泛应用之前，一些过渡技术（如CIDR、私网地址等）的使用是解决这个问题最主要的技术手段。NAT主要用于实现内部网络（简称内网，使用私有IP地址）访问外部网络（简称外网，使用公有IP地址）的功能。当内网的主机要访问外网时，通过NAT技术可以将其私网地址转换为公网地址，可以实现多个私网用户共用一个公网地址来访问外部网络，这样既可保证网络互通，又节省了公网地址。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"NAT-网络地址转换\"><a href=\"#NAT-网络地址转换\" class=\"headerlink\" title=\"NAT:网络地址转换\"></a>NAT:网络地址转换</h2><ul>\n<li>有效避免来自外网的攻击，可以很大程度上提高网络安全性。</li>\n<li>控制内网主机访问外网，同时也可以控制外网主机访问内网，解决了内网和外网不能互通的问题。</li>\n</ul>\n<h2 id=\"NAT类型\"><a href=\"#NAT类型\" class=\"headerlink\" title=\"NAT类型\"></a>NAT类型</h2><h3 id=\"静态NAT\"><a href=\"#静态NAT\" class=\"headerlink\" title=\"静态NAT\"></a>静态NAT</h3><p>一对一的地址转换,一个公网地址只保留一个内网地址使用</p>\n<p><img data-src=\"/../images/NAT%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2/download.png\" alt=\"img\"></p>\n<h4 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">nat static enable   # 开启NAT 静态功能</span><br><span class=\"line\">nat static global 公网地址 inside 私网地址   # 配置静态NAT</span><br><span class=\"line\">display nat static  # 验证静态NAT 配置</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h3 id=\"动态NAT\"><a href=\"#动态NAT\" class=\"headerlink\" title=\"动态NAT\"></a>动态NAT</h3><p>动态NAT是指将内部网络的私有IP地址转换为公用IP地址时，IP地址对是不确定的，是随机的，所有被授权访问Internet的私有IP地址可随机转换为任何指定的合法IP地址。也就是说，只要指定哪些内部地址可以进行转换，以及用哪些合法地址作为外部地址时，就可以进行动态转换。</p>\n<h3 id=\"NAPT\"><a href=\"#NAPT\" class=\"headerlink\" title=\"NAPT\"></a>NAPT</h3><p>除了一对一的NAT转换方式外，网络地址端口转换NAPT（Network Address Port Translation）可以实现并发的地址转换。它允许多个内部地址映射到同一个公有地址上，因此也可以称为“多对一地址转换”或地址复用。</p>\n<p>NAPT方式属于多对一的地址转换，它通过使用“IP地址＋端口号”的形式进行转换，使多个私网用户可共用一个公网IP地址访问外网</p>\n<p><img data-src=\"/../images/NAT%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2/download-16835273286532.png\" alt=\"img\"></p>\n<h4 id=\"配置-1\"><a href=\"#配置-1\" class=\"headerlink\" title=\"配置\"></a>配置</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">nat address-group 编号 公网地址范围  # 配置NAT 地址池</span><br><span class=\"line\">nat outbound acl 编号     # 关联ACL和NAT地址池</span><br><span class=\"line\">address-group 编号 [no-pat] # ACL用来匹配能够转换的源地址</span><br><span class=\"line\">no-pat                     # 只转换地址而不转换端口</span><br><span class=\"line\">display nat address-group  # 验证NAT地址池配置信息</span><br><span class=\"line\">display nat outbound       # 验证动态NAT 配置信息</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"Easy-IP\"><a href=\"#Easy-IP\" class=\"headerlink\" title=\"Easy IP\"></a>Easy IP</h3><p>Easy IP方式可以利用访问控制列表来控制哪些内部地址可以进行地址转换。</p>\n<p>Easy IP方式特别适合小型局域网访问Internet的情况。这里的小型局域网主要指中小型网吧、小型办公室等环境，一般具有以下特点：内部主机较少、出接口通过拨号方式获得临时公网IP地址以供内部主机访问Internet。对于这种情况，可以使用Easy IP方式使局域网用户都通过这个IP地址接入Internet。</p>\n<p><img data-src=\"/../images/NAT%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2/download-16835275826204.png\" alt=\"img\"></p>\n<h4 id=\"配置-2\"><a href=\"#配置-2\" class=\"headerlink\" title=\"配置\"></a>配置</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">nat outbound acl 编号   # 配置Easy IP ,关联ACL和公网接口</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"NAT-Server\"><a href=\"#NAT-Server\" class=\"headerlink\" title=\"NAT Server\"></a>NAT Server</h3><p>NAT具有“屏蔽”内部主机的作用，但有时内网需要向外网提供服务，比如提供WWW服务或者FTP服务。这种情况下需要内网的服务器不被“屏蔽”，外网用户可以随时访问内网服务器。</p>\n<p>NAT Server可以很好地解决这个问题，当外网用户访问内网服务器时，它通过事先配置好的“公网IP地址+端口号”与“私网IP地址+端口号”间的映射关系，将服务器的“公网IP地址+端口号”根据映射关系替换成对应的“私网IP地址+端口号”。</p>\n<p><img data-src=\"/../images/NAT%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2/download.png\" alt=\"img\"></p>\n<h4 id=\"配置-3\"><a href=\"#配置-3\" class=\"headerlink\" title=\"配置\"></a>配置</h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">nat server protocol tcp/udp  global 公网地址/接口  端口  inside 私网地址 端口  <span class=\"comment\"># 配置nat 服务器</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"检查配置动态地址转换结果\"><a href=\"#检查配置动态地址转换结果\" class=\"headerlink\" title=\"检查配置动态地址转换结果\"></a>检查配置动态地址转换结果</h2><h4 id=\"操作步骤\"><a href=\"#操作步骤\" class=\"headerlink\" title=\"操作步骤\"></a>操作步骤</h4><ul>\n<li>执行命令<strong>display nat address-group</strong> [ <em>group-index</em> ] [ <strong>verbose</strong> ]，查看NAT地址池的配置信息。</li>\n<li>执行命令<strong>display nat outbound</strong> [ <strong>acl</strong> <em>acl-number</em> | <strong>address-group</strong> <em>group-index</em> | <strong>interface</strong> <em>interface-type</em> <em>interface-number</em> [ <em>.subnumber</em> ] ]，查看NAT Outbound信息。</li>\n<li>执行命令<strong>display nat alg</strong>，查看NAT ALG的配置信息。</li>\n<li>执行命令<strong>display nat overlap-address</strong> { <em>map-index</em> | <strong>all</strong> | <strong>inside-vpn-instance</strong> <em>inside-vpn-instance-name</em>}，查看NAT双向地址转换的相关信息。</li>\n<li>执行命令<strong>display firewall-nat session aging-time</strong>，查看NAT表项老化时间的相关信息。</li>\n<li>执行命令<strong>display nat sip cac bandwidth information</strong> [ <strong>verbose</strong> ]，查看设备上的当前总带宽及被占用带宽。</li>\n<li>执行命令<strong>display nat filter-mode</strong>，查看当前的NAT过滤方式。</li>\n<li>执行命令<strong>display nat mapping-mode</strong>，查看NAT映射模式。</li>\n<li>执行命令<strong>display nat mapping table</strong> { <strong>all</strong> | <strong>number</strong> }或者<strong>display nat mapping table inside-address</strong> <em>ip-address</em> <strong>protocol</strong> <em>protocol-name</em> <strong>port</strong> <em>port-number</em> [ <strong>vpn-instance</strong> <em>vpn-instance-name</em> ]，查看NAT映射表所有表项信息或个数。</li>\n</ul>\n","categories":["网络"],"tags":["NAT"]},{"title":"PRC","url":"/post/f4a5d85e.html","content":"<h2 id=\"什么是RPC\"><a href=\"#什么是RPC\" class=\"headerlink\" title=\"什么是RPC\"></a>什么是RPC</h2><p><strong>远程过程调用</strong>（英语：<strong>Remote Procedure Call</strong>，缩写为 <strong>RPC</strong>，也叫<strong>远程程序调用</strong>）是一个计算机通信协议。该协议允许运行于一台计算机的程序调用另一台计算机的子程序，而程序员无需额外地为这个交互作用编程。如果涉及的软件采用面向对象编程，那么远程过程调用亦可称作<strong>远程调用</strong>或<strong>远程方法调用</strong>。</p>\n<p><img data-src=\"/../images/PRC/RPC%E7%A4%BA%E6%84%8F%E5%9B%BE.png\" alt=\"RPC示意图\"></p>\n<span id=\"more\"></span>\n\n<h2 id=\"背景与用途\"><a href=\"#背景与用途\" class=\"headerlink\" title=\"背景与用途\"></a>背景与用途</h2><p>在单台计算机中，我们可以通过程序调用来传递控制和数据；或者说通过程序调用，我们可以将多个程序组成一个整体来实现某个功能。</p>\n<p>如果将这种调用机制推广到多台彼此间可以进行网络通讯的计算机，由多台计算机中的多个程序组成一个整体来实现某个功能，这也是可以的。调用的一方（发起远程过程调用，然后调用这方的环境挂起，参数通过网络传递给被调用方，被调用的一方执行程序，当程序执行完成后，产生的结果再通过网络回传给调用的一方，调用的一方恢复继续执行。这样一种原型思想，就是我们所说的RPC远程过程调用。</p>\n<p>RPC这种思想最早可以追溯到1976年，RPC的发展到今天已经40年有余了。</p>\n<p>如今的计算机应用中，单机性能上很难承受住产品的压力，需要不断扩充多台机器来提升整体的性能。同时为了充分利用这些集群里的计算机，需要对其从架构上进行划分，以提供不同的服务，服务间相互调用完成整个产品的功能。RPC就能帮助我们解决这些服务间的信息传递和调用。</p>\n<h2 id=\"RPC结构\"><a href=\"#RPC结构\" class=\"headerlink\" title=\"RPC结构\"></a>RPC结构</h2><p>RPC的设计思想是力图<strong>使远程调用中的通讯细节对于使用者透明</strong>，调用双方无需关心网络通讯的具体实现。因而实现RPC要进行一定的封装。</p>\n<p>RPC原理上是按如下结构流程进行实现的。</p>\n<p><img data-src=\"/../images/PRC/RPC%E7%BB%93%E6%9E%84-16479126287761.png\" alt=\"RPC结构\"></p>\n<h3 id=\"流程：\"><a href=\"#流程：\" class=\"headerlink\" title=\"流程：\"></a>流程：</h3><ol>\n<li>调用者（Caller, 也叫客户端、Client）以本地调用的方式发起调用；</li>\n<li>Client stub（客户端存根，可理解为辅助助手）收到调用后，负责将被调用的方法名、参数等打包编码成特定格式的能进行网络传输的消息体；</li>\n<li>Client stub将消息体通过网络发送给对端（服务端）</li>\n<li>Server stub（服务端存根，同样可理解为辅助助手）收到通过网络接收到消息后按照相应格式进行拆包解码，获取方法名和参数；</li>\n<li>Server stub根据方法名和参数进行本地调用；</li>\n<li>被调用者（Callee，也叫Server）本地调用执行后将结果返回给server stub;</li>\n<li>Server stub将返回值打包编码成消息，并通过网络发送给对端（客户端）；</li>\n<li>Client stub收到消息后，进行拆包解码，返回给Client；</li>\n<li>Client得到本次RPC调用的最终结果。</li>\n</ol>\n<h2 id=\"gRPC\"><a href=\"#gRPC\" class=\"headerlink\" title=\"gRPC\"></a>gRPC</h2><ul>\n<li><p>gRPC是由Google公司开源的高性能RPC框架。</p>\n</li>\n<li><p>gRPC支持多语言</p>\n<p>gRPC原生使用C、Java、Go进行了三种实现，而C语言实现的版本进行封装后又支持C++、C#、Node、ObjC、 Python、Ruby、PHP等开发语言</p>\n</li>\n<li><p>gRPC支持多平台</p>\n<p>支持的平台包括：Linux、Android、iOS、MacOS、Windows</p>\n</li>\n<li><p>gRPC的消息协议使用Google自家开源的Protocol Buffers协议机制（proto3） 序列化</p>\n</li>\n<li><p>gRPC的传输使用HTTP&#x2F;2标准，支持双向流和连接多路复用</p>\n</li>\n</ul>\n<p><img data-src=\"/../images/PRC/grpc.png\" alt=\"grpc\"></p>\n<h2 id=\"Protocol-Buffers\"><a href=\"#Protocol-Buffers\" class=\"headerlink\" title=\"Protocol Buffers\"></a>Protocol Buffers</h2><p>gRPC的消息协议使用Google自家开源的Protocol Buffers协议机制（proto3） 序列化</p>\n<p>详情可看我的另一篇文章 <a href=\"https://tigercoll.top/2022/03/05/Protocol-Buffers/\">Protocol Buffers</a></p>\n<h2 id=\"接口定义\"><a href=\"#接口定义\" class=\"headerlink\" title=\"接口定义\"></a>接口定义</h2><h3 id=\"接口原型\"><a href=\"#接口原型\" class=\"headerlink\" title=\"接口原型\"></a>接口原型</h3><p>接口名称： proto_test</p>\n<p>调用参数：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">ProtoTestReuqest:</span><br><span class=\"line\">    <span class=\"built_in\">id</span>     \t\t\t<span class=\"comment\"># id</span></span><br><span class=\"line\">    test_content   \t <span class=\"comment\"># 测试内容</span></span><br><span class=\"line\">    </span><br></pre></td></tr></table></figure>\n\n<p>返回数据：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">ProtoTestResponse:</span><br><span class=\"line\">    callback_id    <span class=\"comment\"># 返回测试ID</span></span><br><span class=\"line\">    result         <span class=\"comment\"># 结果</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用Protobuf-定义的接口如下\"><a href=\"#使用Protobuf-定义的接口如下\" class=\"headerlink\" title=\"使用Protobuf 定义的接口如下\"></a>使用Protobuf 定义的接口如下</h3><p><strong>使用protobuf定义的接口文件通常以proto作为文件后缀名</strong></p>\n<p>在rpc目录下新建protoTest.proto文件</p>\n<figure class=\"highlight protobuf\"><table><tr><td class=\"code\"><pre><span class=\"line\">syntax = <span class=\"string\">&quot;proto3&quot;</span>; <span class=\"comment\">// 在gRPC中推荐使用proto3版本。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">ProtoTestReuqest</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int32</span> id=<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"type\">string</span> test_content=<span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">ProtoTestResponse</span> &#123;</span><br><span class=\"line\">\t<span class=\"type\">int32</span> callback_id=<span class=\"number\">1</span>;</span><br><span class=\"line\">\t<span class=\"type\">string</span> result=<span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">service </span><span class=\"title class_\">ProtoTest</span> &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">rpc</span> proto_test(ProtoTestReuqest) <span class=\"keyword\">returns</span>(ProtoTestResponse) </span>&#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"代码生成\"><a href=\"#代码生成\" class=\"headerlink\" title=\"代码生成\"></a>代码生成</h2><h3 id=\"安装protobuf编译器和grpc库\"><a href=\"#安装protobuf编译器和grpc库\" class=\"headerlink\" title=\"安装protobuf编译器和grpc库\"></a>安装protobuf编译器和grpc库</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">pip install grpcio-tools</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"编译生成代码\"><a href=\"#编译生成代码\" class=\"headerlink\" title=\"编译生成代码\"></a>编译生成代码</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">python -m grpc_tools.protoc -I. --python_out=. --grpc_python_out=. protoTest.proto</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>-I</code>表示搜索proto文件中被导入文件的目录</li>\n<li><code>--python_out</code>表示保存生成Python文件的目录，生成的文件中包含接口定义中的数据类型</li>\n<li><code>--grpc_python_out</code>表示保存生成Python文件的目录，生成的文件中包含接口定义中的服务类型</li>\n</ul>\n<p>在rpc目录下执行上述命令，会自动生成如下两个rpc调用辅助代码模块：</p>\n<ul>\n<li>protoTest_pb2.py 保存根据接口定义文件中的数据类型生成的python类</li>\n<li>protoTest_pb2_grpc.py 保存根据接口定义文件中的服务方法类型生成的python调用RPC方法</li>\n</ul>\n<h2 id=\"服务端\"><a href=\"#服务端\" class=\"headerlink\" title=\"服务端\"></a>服务端</h2><p>在rpc目录下新建server.py文件,用来补全服务端代码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> protoTest_pb2</span><br><span class=\"line\"><span class=\"keyword\">import</span> protoTest_pb2_grpc</span><br><span class=\"line\"><span class=\"keyword\">import</span> grpc</span><br><span class=\"line\"><span class=\"keyword\">from</span> concurrent.futures <span class=\"keyword\">import</span> ThreadPoolExecutor</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># rpc接口定义中服务对应成Python的类</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">ProtoTestService</span>(protoTest_pb2_grpc.ProtoTestServicer):</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 在接口定义的同名方法中补全，被调用时应该执行的逻辑</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">proto_test</span>(<span class=\"params\">self, request, context</span>):</span><br><span class=\"line\">        <span class=\"comment\"># request是调用的请求数据对象</span></span><br><span class=\"line\">        <span class=\"built_in\">id</span> = request.<span class=\"built_in\">id</span></span><br><span class=\"line\">        test_content = request.test_content</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"built_in\">id</span>,test_content)</span><br><span class=\"line\">        response = protoTest_pb2.ProtoTestResponse()</span><br><span class=\"line\">        response.callback_id = <span class=\"built_in\">id</span>+<span class=\"number\">1</span></span><br><span class=\"line\">        response.result = <span class=\"string\">&#x27;grpc结果&#x27;</span></span><br><span class=\"line\">        <span class=\"comment\"># 最终要返回一个调用结果</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> response</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">serve</span>():</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    rpc服务端启动方法</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># 创建一个rpc服务器</span></span><br><span class=\"line\">    server = grpc.server(ThreadPoolExecutor(max_workers=<span class=\"number\">10</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 向服务器中添加被调用的服务方法</span></span><br><span class=\"line\">    protoTest_pb2_grpc.add_ProtoTestServicer_to_server(ProtoTestService(), server)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 微服务器绑定ip地址和端口</span></span><br><span class=\"line\">    server.add_insecure_port(<span class=\"string\">&#x27;127.0.0.1:8888&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 启动rpc服务</span></span><br><span class=\"line\">    server.start()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># start()不会阻塞，此处需要加上循环睡眠 防止程序退出</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">        time.sleep(<span class=\"number\">100</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    serve()</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"客户端\"><a href=\"#客户端\" class=\"headerlink\" title=\"客户端\"></a>客户端</h2><p>在rpc目录下新建client.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> grpc</span><br><span class=\"line\"><span class=\"keyword\">import</span> protoTest_pb2</span><br><span class=\"line\"><span class=\"keyword\">import</span> protoTest_pb2_grpc</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">feed_test</span>(<span class=\"params\">stub</span>):</span><br><span class=\"line\">    <span class=\"comment\"># 构建rpc调用的调用参数</span></span><br><span class=\"line\">    request = protoTest_pb2.ProtoTestReuqest()</span><br><span class=\"line\">    request.<span class=\"built_in\">id</span> = <span class=\"number\">1</span></span><br><span class=\"line\">    request.test_content = <span class=\"string\">&#x27;发送grpc&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 通过stub进行方法调用，并接收调用返回值</span></span><br><span class=\"line\">    ret = stub.proto_test(request)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(ret.callback_id)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(ret.result)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">run</span>():</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    rpc客户端调用的方法</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># 使用with语句连接rpc服务器</span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> grpc.insecure_channel(<span class=\"string\">&#x27;127.0.0.1:8888&#x27;</span>) <span class=\"keyword\">as</span> channel:</span><br><span class=\"line\">        <span class=\"comment\"># 创建调用rpc远端服务的辅助对象stub</span></span><br><span class=\"line\">        stub = protoTest_pb2_grpc.ProtoTestStub(channel)</span><br><span class=\"line\">        <span class=\"comment\"># 通过stub进行rpc调用</span></span><br><span class=\"line\">        feed_test(stub)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    run()</span><br></pre></td></tr></table></figure>\n\n","categories":["PRC"],"tags":["PRC"]},{"title":"Mysql新建用户与授权","url":"/post/4c6977a9.html","content":"<h1 id=\"mysql创建用户\"><a href=\"#mysql创建用户\" class=\"headerlink\" title=\"mysql创建用户\"></a>mysql创建用户</h1><h2 id=\"命令\"><a href=\"#命令\" class=\"headerlink\" title=\"命令:\"></a>命令:</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">CREATE USER &#x27;username&#x27;@&#x27;host&#x27; IDENTIFIED BY &#x27;password&#x27;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明:\"></a>说明:</h3><ul>\n<li>username: 用户名,</li>\n<li>host:指定该用户在哪个主机上可以登陆，如果是本地用户可用localhost，如果想让该用户可以<strong>从任意远程主机登陆</strong>，可以使用通配符<code>%</code></li>\n<li>password: 密码</li>\n</ul>\n<span id=\"more\"></span>\n\n<h2 id=\"授权\"><a href=\"#授权\" class=\"headerlink\" title=\"授权:\"></a>授权:</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">grant privilegesCode on dbName.tableName to username@host identified by &quot;password&quot;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"说明-1\"><a href=\"#说明-1\" class=\"headerlink\" title=\"说明:\"></a>说明:</h3><ul>\n<li>privilegesCode:权限,<ul>\n<li>all privileges：所有权限。</li>\n<li>select：读取权限。</li>\n<li>delete：删除权限。</li>\n<li>update：更新权限。</li>\n<li>create：创建权限。</li>\n<li>drop：删除数据库、数据表权限.</li>\n<li>dbName:数据库名.</li>\n<li>tableName:表名.</li>\n<li>username@host:赋予权限的用户.</li>\n<li>password:密码</li>\n</ul>\n</li>\n</ul>\n<p>加完权限需要刷新一下</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">flush privileges :表示刷新权限变更。</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"注意\"><a href=\"#注意\" class=\"headerlink\" title=\"注意:\"></a>注意:</h3><p>用以上命令授权的用户不能给其它用户授权，如果想让该用户可以授权，用以下命令:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GRANT privileges ON databasename.tablename TO &#x27;username&#x27;@&#x27;host&#x27; WITH GRANT OPTION;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"设置与更改用户密码\"><a href=\"#设置与更改用户密码\" class=\"headerlink\" title=\"设置与更改用户密码\"></a>设置与更改用户密码</h2><h3 id=\"命令-1\"><a href=\"#命令-1\" class=\"headerlink\" title=\"命令:\"></a>命令:</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">SET PASSWORD FOR &#x27;username&#x27;@&#x27;host&#x27; = PASSWORD(&#x27;newpassword&#x27;);</span><br><span class=\"line\">flush privileges;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"撤销用户权限\"><a href=\"#撤销用户权限\" class=\"headerlink\" title=\"撤销用户权限\"></a>撤销用户权限</h2><h3 id=\"命令-2\"><a href=\"#命令-2\" class=\"headerlink\" title=\"命令:\"></a>命令:</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">REVOKE privilege ON databasename.tablename FROM &#x27;username&#x27;@&#x27;host&#x27;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"删除用户\"><a href=\"#删除用户\" class=\"headerlink\" title=\"删除用户\"></a>删除用户</h2><h3 id=\"命令-3\"><a href=\"#命令-3\" class=\"headerlink\" title=\"命令:\"></a>命令:</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">DROP USER &#x27;username&#x27;@&#x27;host&#x27;;</span><br></pre></td></tr></table></figure>\n","categories":["mysql"],"tags":["mysql","创建用户","授权"]},{"title":"Pandas进阶","url":"/post/e6fcc668.html","content":"<p>本章介绍pandas层次化索引,索引的堆（stack）,以及多层索引聚合操作,拼接操作</p>\n<span id=\"more\"></span>\n\n<h2 id=\"创建多层行索引\"><a href=\"#创建多层行索引\" class=\"headerlink\" title=\"创建多层行索引\"></a>创建多层行索引</h2><h3 id=\"隐式构造\"><a href=\"#隐式构造\" class=\"headerlink\" title=\"隐式构造\"></a>隐式构造</h3><p>最常见的方法是给DataFrame构造函数的index参数传递两个或更多的数组</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">data = np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">150</span>,size=(<span class=\"number\">6</span>,<span class=\"number\">6</span>))</span><br><span class=\"line\">index = [[<span class=\"string\">&#x27;一班&#x27;</span>,<span class=\"string\">&#x27;一班&#x27;</span>,<span class=\"string\">&#x27;一班&#x27;</span>,<span class=\"string\">&#x27;二班&#x27;</span>,<span class=\"string\">&#x27;二班&#x27;</span>,<span class=\"string\">&#x27;二班&#x27;</span>],[<span class=\"string\">&#x27;张三&#x27;</span>, <span class=\"string\">&#x27;李四&#x27;</span>, <span class=\"string\">&#x27;王五&#x27;</span>, <span class=\"string\">&#x27;赵六&#x27;</span>, <span class=\"string\">&#x27;田七&#x27;</span>, <span class=\"string\">&#x27;孙八&#x27;</span>]]</span><br><span class=\"line\">columns = [[<span class=\"string\">&#x27;期中&#x27;</span>,<span class=\"string\">&#x27;期中&#x27;</span>,<span class=\"string\">&#x27;期中&#x27;</span>,<span class=\"string\">&#x27;期末&#x27;</span>,<span class=\"string\">&#x27;期末&#x27;</span>,<span class=\"string\">&#x27;期末&#x27;</span>],[<span class=\"string\">&#x27;语文&#x27;</span>,<span class=\"string\">&#x27;数学&#x27;</span>,<span class=\"string\">&#x27;英语&#x27;</span>,<span class=\"string\">&#x27;语文&#x27;</span>,<span class=\"string\">&#x27;数学&#x27;</span>,<span class=\"string\">&#x27;英语&#x27;</span>]]</span><br><span class=\"line\">df = DataFrame(columns=columns,index=index,data=data)</span><br><span class=\"line\">df</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/Pandas%E8%BF%9B%E9%98%B6/image-20220711162043742.png\" alt=\"image-20220711162043742\"></p>\n<ul>\n<li>Series也可以创建多层索引</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">index = [[<span class=\"string\">&#x27;一班&#x27;</span>, <span class=\"string\">&#x27;一班&#x27;</span>, <span class=\"string\">&#x27;一班&#x27;</span>, <span class=\"string\">&#x27;二班&#x27;</span>, <span class=\"string\">&#x27;二班&#x27;</span>, <span class=\"string\">&#x27;二班&#x27;</span>], [<span class=\"string\">&#x27;张三&#x27;</span>, <span class=\"string\">&#x27;李四&#x27;</span>, <span class=\"string\">&#x27;王五&#x27;</span>, <span class=\"string\">&#x27;赵六&#x27;</span>, <span class=\"string\">&#x27;田七&#x27;</span>, <span class=\"string\">&#x27;孙八&#x27;</span>]]</span><br><span class=\"line\">data = np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">150</span>, size=<span class=\"number\">6</span>)</span><br><span class=\"line\">s = Series(data=data, index=index)</span><br><span class=\"line\">s</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/Pandas%E8%BF%9B%E9%98%B6/image-20220711162635182.png\" alt=\"image-20220711162635182\"></p>\n<h3 id=\"显示构造pd-MultiIndex\"><a href=\"#显示构造pd-MultiIndex\" class=\"headerlink\" title=\"显示构造pd.MultiIndex\"></a>显示构造pd.MultiIndex</h3><ul>\n<li>使用数组</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">data = np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">150</span>, size=(<span class=\"number\">6</span>,<span class=\"number\">6</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">index = pd.MultiIndex.from_arrays([[<span class=\"string\">&#x27;一班&#x27;</span>, <span class=\"string\">&#x27;一班&#x27;</span>, <span class=\"string\">&#x27;一班&#x27;</span>, <span class=\"string\">&#x27;二班&#x27;</span>, <span class=\"string\">&#x27;二班&#x27;</span>, <span class=\"string\">&#x27;二班&#x27;</span>], [<span class=\"string\">&#x27;张三&#x27;</span>, <span class=\"string\">&#x27;李四&#x27;</span>, <span class=\"string\">&#x27;王五&#x27;</span>, <span class=\"string\">&#x27;赵六&#x27;</span>, <span class=\"string\">&#x27;田七&#x27;</span>, <span class=\"string\">&#x27;孙八&#x27;</span>]])</span><br><span class=\"line\">columns = pd.MultiIndex.from_arrays([[<span class=\"string\">&#x27;期中&#x27;</span>, <span class=\"string\">&#x27;期中&#x27;</span>, <span class=\"string\">&#x27;期中&#x27;</span>, <span class=\"string\">&#x27;期末&#x27;</span>, <span class=\"string\">&#x27;期末&#x27;</span>, <span class=\"string\">&#x27;期末&#x27;</span>], [<span class=\"string\">&#x27;语文&#x27;</span>, <span class=\"string\">&#x27;数学&#x27;</span>, <span class=\"string\">&#x27;英语&#x27;</span>, <span class=\"string\">&#x27;语文&#x27;</span>, <span class=\"string\">&#x27;数学&#x27;</span>, <span class=\"string\">&#x27;英语&#x27;</span>]])</span><br><span class=\"line\">df = DataFrame(index=index, data=data, columns=columns)</span><br><span class=\"line\">df</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/Pandas%E8%BF%9B%E9%98%B6/image-20220712135538144.png\" alt=\"image-20220712135538144\"></p>\n<ul>\n<li>使用tuple</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">data = np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">150</span>, size=(<span class=\"number\">6</span>,<span class=\"number\">6</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">index = pd.MultiIndex.from_tuples([(<span class=\"string\">&#x27;一班&#x27;</span>, <span class=\"string\">&#x27;张三&#x27;</span>), (<span class=\"string\">&#x27;一班&#x27;</span>, <span class=\"string\">&#x27;李四&#x27;</span>), (<span class=\"string\">&#x27;一班&#x27;</span>, <span class=\"string\">&#x27;王五&#x27;</span>), (<span class=\"string\">&#x27;二班&#x27;</span>, <span class=\"string\">&#x27;赵六&#x27;</span>), (<span class=\"string\">&#x27;二班&#x27;</span>, <span class=\"string\">&#x27;田七&#x27;</span>), (<span class=\"string\">&#x27;二班&#x27;</span>, <span class=\"string\">&#x27;孙八&#x27;</span>)])</span><br><span class=\"line\">columns = pd.MultiIndex.from_arrays([[<span class=\"string\">&#x27;期中&#x27;</span>, <span class=\"string\">&#x27;期中&#x27;</span>, <span class=\"string\">&#x27;期中&#x27;</span>, <span class=\"string\">&#x27;期末&#x27;</span>, <span class=\"string\">&#x27;期末&#x27;</span>, <span class=\"string\">&#x27;期末&#x27;</span>], [<span class=\"string\">&#x27;语文&#x27;</span>, <span class=\"string\">&#x27;数学&#x27;</span>, <span class=\"string\">&#x27;英语&#x27;</span>, <span class=\"string\">&#x27;语文&#x27;</span>, <span class=\"string\">&#x27;数学&#x27;</span>, <span class=\"string\">&#x27;英语&#x27;</span>]])</span><br><span class=\"line\">df = DataFrame(index=index, data=data, columns=columns)</span><br><span class=\"line\">df</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/Pandas%E8%BF%9B%E9%98%B6/image-20220712135613233.png\" alt=\"image-20220712135613233\"></p>\n<ul>\n<li>使用product</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">data = np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">150</span>, size=(<span class=\"number\">6</span>,<span class=\"number\">6</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#product 两两相乘,必须有一样的,如果没有一样的,只能使用上面2种</span></span><br><span class=\"line\">index = pd.MultiIndex.from_product([[<span class=\"string\">&#x27;一班&#x27;</span>, <span class=\"string\">&#x27;二班&#x27;</span>], [<span class=\"string\">&#x27;张三&#x27;</span>, <span class=\"string\">&#x27;李四&#x27;</span>, <span class=\"string\">&#x27;王五&#x27;</span>]])</span><br><span class=\"line\">columns = pd.MultiIndex.from_arrays([[<span class=\"string\">&#x27;期中&#x27;</span>, <span class=\"string\">&#x27;期中&#x27;</span>, <span class=\"string\">&#x27;期中&#x27;</span>, <span class=\"string\">&#x27;期末&#x27;</span>, <span class=\"string\">&#x27;期末&#x27;</span>, <span class=\"string\">&#x27;期末&#x27;</span>], [<span class=\"string\">&#x27;语文&#x27;</span>, <span class=\"string\">&#x27;数学&#x27;</span>, <span class=\"string\">&#x27;英语&#x27;</span>, <span class=\"string\">&#x27;语文&#x27;</span>, <span class=\"string\">&#x27;数学&#x27;</span>, <span class=\"string\">&#x27;英语&#x27;</span>]])</span><br><span class=\"line\">df = DataFrame(index=index, data=data, columns=columns)</span><br><span class=\"line\">df</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/Pandas%E8%BF%9B%E9%98%B6/image-20220712142355726.png\" alt=\"image-20220712142355726\"></p>\n<h2 id=\"多层索引对象的索引与切片操作\"><a href=\"#多层索引对象的索引与切片操作\" class=\"headerlink\" title=\"多层索引对象的索引与切片操作\"></a>多层索引对象的索引与切片操作</h2><h3 id=\"Series的操作\"><a href=\"#Series的操作\" class=\"headerlink\" title=\"Series的操作\"></a>Series的操作</h3><p>【重要】对于Series来说，直接中括号[]与使用.loc()完全一样，推荐使用中括号索引和切片。</p>\n<p><img data-src=\"/../images/Pandas%E8%BF%9B%E9%98%B6/image-20220712154123722.png\" alt=\"image-20220712154123722\"></p>\n<h4 id=\"索引\"><a href=\"#索引\" class=\"headerlink\" title=\"索引\"></a>索引</h4><p>原则: 当有多层索引的时候,不要直接索引内层索引.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 先索引外层索引 推荐写法</span></span><br><span class=\"line\">s.loc[<span class=\"string\">&#x27;一班&#x27;</span>, <span class=\"string\">&#x27;张三&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/Pandas%E8%BF%9B%E9%98%B6/image-20220712154250028.png\" alt=\"image-20220712154250028\"></p>\n<h4 id=\"切片\"><a href=\"#切片\" class=\"headerlink\" title=\"切片\"></a>切片</h4><p><img data-src=\"/../images/Pandas%E8%BF%9B%E9%98%B6/image-20220712160244074.png\" alt=\"image-20220712160244074\"></p>\n<h3 id=\"DataFrame的操作\"><a href=\"#DataFrame的操作\" class=\"headerlink\" title=\"DataFrame的操作\"></a>DataFrame的操作</h3><p>可以直接使用列名称来进行列索引</p>\n<p><img data-src=\"/../images/Pandas%E8%BF%9B%E9%98%B6/image-20220712161801042.png\" alt=\"image-20220712161801042\"></p>\n<p>行多级索引的索引和切片操作</p>\n<p><img data-src=\"/../images/Pandas%E8%BF%9B%E9%98%B6/image-20220712162311855.png\" alt=\"image-20220712162311855\"></p>\n<p>列多级索引的索引和切片操作</p>\n<p><img data-src=\"/../images/Pandas%E8%BF%9B%E9%98%B6/image-20220712162441453.png\" alt=\"image-20220712162441453\"></p>\n<p><img data-src=\"/../images/Pandas%E8%BF%9B%E9%98%B6/image-20220712162449968.png\" alt=\"image-20220712162449968\"></p>\n<p>【极其重要】推荐使用loc()函数</p>\n<p>注意在对行索引的时候，若一级行索引还有多个，对二级行索引会遇到问题！也就是说，无法直接对二级索引进行索引，必须让二级索引变成一级索引后才能对其进行索引！</p>\n<h2 id=\"索引的堆\"><a href=\"#索引的堆\" class=\"headerlink\" title=\"索引的堆\"></a>索引的堆</h2><ul>\n<li><code>stack()</code></li>\n<li><code>unstack()</code></li>\n</ul>\n<p>索引的堆指的就是 多层索引中行索引和列索引的转化</p>\n<p><img data-src=\"/../images/Pandas%E8%BF%9B%E9%98%B6/image-20220712165413101.png\" alt=\"image-20220712165413101\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 默认level 是-1  </span></span><br><span class=\"line\">df.stack()</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/Pandas%E8%BF%9B%E9%98%B6/image-20220712170023470.png\" alt=\"image-20220712170023470\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">df.stack(level=<span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/Pandas%E8%BF%9B%E9%98%B6/image-20220712170104141.png\" alt=\"image-20220712170104141\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">df.unstack()</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/Pandas%E8%BF%9B%E9%98%B6/image-20220712170438379.png\" alt=\"image-20220712170438379\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">【小技巧】使用unstack()的时候，level等于哪一个，哪一个就消失，出现在列里。</span><br><span class=\"line\">level的顺序 如下  可以是正序:<span class=\"number\">0</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span> 也可以是倒序:-<span class=\"number\">1</span>,-<span class=\"number\">2</span>,-<span class=\"number\">3</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/Pandas%E8%BF%9B%E9%98%B6/image-20220712170512946.png\" alt=\"image-20220712170512946\"></p>\n<h2 id=\"聚合操作\"><a href=\"#聚合操作\" class=\"headerlink\" title=\"聚合操作\"></a>聚合操作</h2><p>所谓的聚合操作：平均数，方差，最大值，最小值……</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sum</span> / <span class=\"built_in\">min</span> /<span class=\"built_in\">max</span> / mean  / std/ var/ prod/ median / percentile....</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/Pandas%E8%BF%9B%E9%98%B6/image-20220713135057654.png\" alt=\"image-20220713135057654\"></p>\n<p><img data-src=\"/../images/Pandas%E8%BF%9B%E9%98%B6/image-20220713135139465.png\" alt=\"image-20220713135139465\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 一班二班,各科成绩的和.</span></span><br><span class=\"line\"><span class=\"comment\"># 新版本改成了groupby</span></span><br><span class=\"line\"><span class=\"comment\"># df.sum(axis=0, level=0) # 不推荐使用了</span></span><br><span class=\"line\">df.groupby(level=<span class=\"number\">0</span>,axis=<span class=\"number\">0</span>).<span class=\"built_in\">sum</span>()</span><br><span class=\"line\"><span class=\"comment\"># 先根据axis的值看对行还是对列进行 操作. 再去看level, level等于哪一层 ,哪一层就保留下来.</span></span><br></pre></td></tr></table></figure>\n\n<p>【注意】</p>\n<ul>\n<li>需要指定axis</li>\n<li>【小技巧】和unstack()相反，聚合的时候，axis等于哪一个，哪一个就保留。</li>\n</ul>\n","categories":["Pandas"],"tags":["Pandas","数据分析"]},{"title":"Python编程技巧","url":"/post/cc419826.html","content":"<p>分享一下python编程的技巧,在阅读此内容时,请确保你已经掌握了python的基本用法,</p>\n<span id=\"more\"></span>\n\n<h2 id=\"筛选列表-字典\"><a href=\"#筛选列表-字典\" class=\"headerlink\" title=\"筛选列表,字典\"></a>筛选列表,字典</h2><h3 id=\"列表筛选\"><a href=\"#列表筛选\" class=\"headerlink\" title=\"列表筛选\"></a>列表筛选</h3><p>一般都是用for循环加if 来判断如:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">from random import randint</span><br><span class=\"line\"># 模拟数据</span><br><span class=\"line\">data = [randint(-10,10) for _ in range(10)]</span><br><span class=\"line\">result=[]</span><br><span class=\"line\">for i in data:</span><br><span class=\"line\">    if i &gt;=0:</span><br><span class=\"line\">        result.append(i)</span><br><span class=\"line\">result</span><br><span class=\"line\">out:[4, 4, 1, 6, 2, 9, 6]</span><br></pre></td></tr></table></figure>\n\n<p>我们可以用<code>filter</code>函数</p>\n<p><strong>filter()</strong> 函数用于过滤序列，过滤掉不符合条件的元素，返回一个迭代器对象</p>\n<p>该接收两个参数，第一个为函数，第二个为序列，序列的每个元素作为参数传递给函数进行判，然后返回 True 或 False，最后将返回 True 的元素放到新列表中。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">result = <span class=\"built_in\">filter</span>(<span class=\"keyword\">lambda</span> x:x&gt;=<span class=\"number\">0</span>,data)</span><br><span class=\"line\"><span class=\"comment\"># 如果要转换为列表，可以使用 list() 来转换。</span></span><br><span class=\"line\"><span class=\"built_in\">list</span>(result)</span><br><span class=\"line\">out:[<span class=\"number\">4</span>, <span class=\"number\">4</span>, <span class=\"number\">1</span>, <span class=\"number\">6</span>, <span class=\"number\">2</span>, <span class=\"number\">9</span>, <span class=\"number\">6</span>]</span><br></pre></td></tr></table></figure>\n\n<p>我们也可以使用列表生成式</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">[x <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> data <span class=\"keyword\">if</span> x&gt;=<span class=\"number\">0</span>]</span><br></pre></td></tr></table></figure>\n\n<p>那到底哪个更快呢?我们可以用<code>%timeit</code>来测一下,发现是<code>filter</code>函数更快</p>\n<p><img data-src=\"/../images/Python%E7%BC%96%E7%A8%8B%E6%8A%80%E5%B7%A7/image-20200703232926291.png\" alt=\"image-20200703232926291\"></p>\n<h3 id=\"字典筛选\"><a href=\"#字典筛选\" class=\"headerlink\" title=\"字典筛选\"></a>字典筛选</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 模拟一个&#123;学号:分数&#125;的字典</span></span><br><span class=\"line\">data=&#123;k:randint(<span class=\"number\">60</span>,<span class=\"number\">100</span>) <span class=\"keyword\">for</span> k <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"number\">11</span>)&#125;</span><br><span class=\"line\">data</span><br><span class=\"line\">&#123;<span class=\"number\">1</span>: <span class=\"number\">66</span>, <span class=\"number\">2</span>: <span class=\"number\">100</span>, <span class=\"number\">3</span>: <span class=\"number\">67</span>, <span class=\"number\">4</span>: <span class=\"number\">60</span>, <span class=\"number\">5</span>: <span class=\"number\">70</span>, <span class=\"number\">6</span>: <span class=\"number\">99</span>, <span class=\"number\">7</span>: <span class=\"number\">71</span>, <span class=\"number\">8</span>: <span class=\"number\">95</span>, <span class=\"number\">9</span>: <span class=\"number\">88</span>, <span class=\"number\">10</span>: <span class=\"number\">69</span>&#125;</span><br><span class=\"line\"><span class=\"comment\"># 筛选出大于90的</span></span><br><span class=\"line\">&#123;k:v <span class=\"keyword\">for</span> k,v <span class=\"keyword\">in</span> data.items() <span class=\"keyword\">if</span> v&gt;=<span class=\"number\">90</span>&#125;</span><br><span class=\"line\">&#123;<span class=\"number\">2</span>: <span class=\"number\">100</span>, <span class=\"number\">6</span>: <span class=\"number\">99</span>, <span class=\"number\">8</span>: <span class=\"number\">95</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"命名元组\"><a href=\"#命名元组\" class=\"headerlink\" title=\"命名元组\"></a>命名元组</h2><p>我们有一个固定格式的数据,如:</p>\n<p>学生信息:(姓名,年龄,性别,邮箱),而数据量很大,为了减少开销,我们可以用元组表示</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">(<span class=\"string\">&#x27;小明&#x27;</span>,<span class=\"number\">15</span>,<span class=\"string\">&#x27;男&#x27;</span>,<span class=\"string\">&#x27;xiaoming@qq.com&#x27;</span>)</span><br><span class=\"line\">(<span class=\"string\">&#x27;小里&#x27;</span>,<span class=\"number\">11</span>,<span class=\"string\">&#x27;男&#x27;</span>,<span class=\"string\">&#x27;xiaolig@qq.com&#x27;</span>)</span><br><span class=\"line\">(<span class=\"string\">&#x27;小话&#x27;</span>,<span class=\"number\">13</span>,<span class=\"string\">&#x27;女&#x27;</span>,<span class=\"string\">&#x27;xiaohuag@qq.com&#x27;</span>)</span><br><span class=\"line\">(<span class=\"string\">&#x27;小图&#x27;</span>,<span class=\"number\">14</span>,<span class=\"string\">&#x27;男&#x27;</span>,<span class=\"string\">&#x27;xiaotug@qq.com&#x27;</span>)</span><br><span class=\"line\">data= (<span class=\"string\">&#x27;小明&#x27;</span>,<span class=\"number\">15</span>,<span class=\"string\">&#x27;男&#x27;</span>,<span class=\"string\">&#x27;xiaoming@qq.com&#x27;</span>)</span><br><span class=\"line\">我们需要访问的话会使用索引index来访问,但是如果用</span><br><span class=\"line\">姓名:data[<span class=\"number\">0</span>],年龄data[<span class=\"number\">1</span>]这种的话大大降低了可读性</span><br></pre></td></tr></table></figure>\n\n<p>1.我们可以用全局变量</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">NAME = <span class=\"number\">0</span></span><br><span class=\"line\">AGE = <span class=\"number\">1</span></span><br><span class=\"line\">GENDER = <span class=\"number\">2</span></span><br><span class=\"line\">EMAIL = <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"comment\"># 我们也可以用拆包的形式</span></span><br><span class=\"line\"><span class=\"comment\"># NAME,AGE,GENDER,EMAIL = range(4)</span></span><br><span class=\"line\">data = (<span class=\"string\">&#x27;小明&#x27;</span>, <span class=\"number\">15</span>, <span class=\"string\">&#x27;男&#x27;</span>, <span class=\"string\">&#x27;xiaoming@qq.com&#x27;</span>)</span><br><span class=\"line\">data[NAME]</span><br></pre></td></tr></table></figure>\n\n<p>2.也可以用<code>namedtuple</code>来替换元组</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> collections <span class=\"keyword\">import</span> namedtuple</span><br><span class=\"line\"><span class=\"comment\"># 定义一个namedtuple类型Student，并包含name，age,gender,email属性。</span></span><br><span class=\"line\">Student = namedtuple(<span class=\"string\">&#x27;Student&#x27;</span>,[<span class=\"string\">&#x27;name&#x27;</span>,<span class=\"string\">&#x27;age&#x27;</span>,<span class=\"string\">&#x27;gemder&#x27;</span>,<span class=\"string\">&#x27;email&#x27;</span>])</span><br><span class=\"line\"><span class=\"comment\"># 创建一个Student对象</span></span><br><span class=\"line\"><span class=\"comment\"># student = Student(&#x27;小明&#x27;, 15, &#x27;男&#x27;, &#x27;xiaoming@qq.com&#x27;)</span></span><br><span class=\"line\"><span class=\"comment\"># 我也可以使用关键字传参</span></span><br><span class=\"line\"><span class=\"comment\"># student=Student(name=&#x27;小明&#x27;, age=15, gemder=&#x27;男&#x27;, email=&#x27;xiaoming@qq.com&#x27;)</span></span><br><span class=\"line\"><span class=\"comment\"># 也可以传入一个列表,这里注意需要使用&quot;_make&quot;方法</span></span><br><span class=\"line\">student = Student._make([<span class=\"string\">&#x27;小明&#x27;</span>, <span class=\"number\">15</span>, <span class=\"string\">&#x27;男&#x27;</span>, <span class=\"string\">&#x27;xiaoming@qq.com&#x27;</span>])</span><br><span class=\"line\">student</span><br><span class=\"line\">out:Student(name=<span class=\"string\">&#x27;小明&#x27;</span>, age=<span class=\"number\">15</span>, gemder=<span class=\"string\">&#x27;男&#x27;</span>, email=<span class=\"string\">&#x27;xiaoming@qq.com&#x27;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\"># 这样的好处是,我们可以直接用属性来访问</span></span><br><span class=\"line\">student.name</span><br><span class=\"line\">out:<span class=\"string\">&#x27;小明&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"统计列表或字典出现的次数\"><a href=\"#统计列表或字典出现的次数\" class=\"headerlink\" title=\"统计列表或字典出现的次数\"></a>统计列表或字典出现的次数</h2><p>我们希望统计一下列表中,每个元素出现的个数,</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> random <span class=\"keyword\">import</span> randint</span><br><span class=\"line\"><span class=\"comment\"># 用randint模拟</span></span><br><span class=\"line\">data = [randint(<span class=\"number\">0</span>,<span class=\"number\">20</span>) <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">20</span>)]</span><br><span class=\"line\">data</span><br><span class=\"line\">out:[<span class=\"number\">13</span>, <span class=\"number\">5</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">14</span>, <span class=\"number\">13</span>, <span class=\"number\">6</span>, <span class=\"number\">5</span>, <span class=\"number\">13</span>, <span class=\"number\">11</span>, <span class=\"number\">19</span>, <span class=\"number\">3</span>, <span class=\"number\">13</span>, <span class=\"number\">5</span>, <span class=\"number\">13</span>, <span class=\"number\">11</span>, <span class=\"number\">10</span>, <span class=\"number\">6</span>, <span class=\"number\">17</span>, <span class=\"number\">18</span>]</span><br></pre></td></tr></table></figure>\n\n<p>第一种做法:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">result = &#123;&#125;</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> data:</span><br><span class=\"line\">    <span class=\"keyword\">if</span> i <span class=\"keyword\">in</span> result:</span><br><span class=\"line\">        result[i]+=<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        result[i]=<span class=\"number\">1</span></span><br><span class=\"line\">result</span><br><span class=\"line\">out:&#123;<span class=\"number\">13</span>: <span class=\"number\">5</span>, <span class=\"number\">5</span>: <span class=\"number\">3</span>, <span class=\"number\">1</span>: <span class=\"number\">1</span>, <span class=\"number\">2</span>: <span class=\"number\">1</span>, <span class=\"number\">14</span>: <span class=\"number\">1</span>, <span class=\"number\">6</span>: <span class=\"number\">2</span>, <span class=\"number\">11</span>: <span class=\"number\">2</span>, <span class=\"number\">19</span>: <span class=\"number\">1</span>, <span class=\"number\">3</span>: <span class=\"number\">1</span>, <span class=\"number\">10</span>: <span class=\"number\">1</span>, <span class=\"number\">17</span>: <span class=\"number\">1</span>, <span class=\"number\">18</span>: <span class=\"number\">1</span>&#125;</span><br><span class=\"line\"><span class=\"comment\"># 如果我们要统计前3个的话,就要对字典进行排序,我们可以使用内置函数sorted,将字典转化为元组</span></span><br><span class=\"line\">new_tuple = [(v,k)<span class=\"keyword\">for</span> k,v <span class=\"keyword\">in</span> result.items()]</span><br><span class=\"line\"><span class=\"comment\"># 然后用sorted</span></span><br><span class=\"line\"><span class=\"built_in\">sorted</span>(new_tuple)</span><br><span class=\"line\">[(<span class=\"number\">1</span>, <span class=\"number\">1</span>),</span><br><span class=\"line\"> (<span class=\"number\">1</span>, <span class=\"number\">2</span>),</span><br><span class=\"line\"> (<span class=\"number\">1</span>, <span class=\"number\">3</span>),</span><br><span class=\"line\"> (<span class=\"number\">1</span>, <span class=\"number\">10</span>),</span><br><span class=\"line\"> (<span class=\"number\">1</span>, <span class=\"number\">14</span>),</span><br><span class=\"line\"> (<span class=\"number\">1</span>, <span class=\"number\">17</span>),</span><br><span class=\"line\"> (<span class=\"number\">1</span>, <span class=\"number\">18</span>),</span><br><span class=\"line\"> (<span class=\"number\">1</span>, <span class=\"number\">19</span>),</span><br><span class=\"line\"> (<span class=\"number\">2</span>, <span class=\"number\">6</span>),</span><br><span class=\"line\"> (<span class=\"number\">2</span>, <span class=\"number\">11</span>),</span><br><span class=\"line\"> (<span class=\"number\">3</span>, <span class=\"number\">5</span>),</span><br><span class=\"line\"> (<span class=\"number\">5</span>, <span class=\"number\">13</span>)]</span><br><span class=\"line\"><span class=\"comment\"># 我们也可以用zip拼接</span></span><br><span class=\"line\">new_tuple_1 = <span class=\"built_in\">zip</span>(result.values(),result.keys())</span><br><span class=\"line\"><span class=\"built_in\">sorted</span>(new_tuple_1)</span><br><span class=\"line\">[(<span class=\"number\">1</span>, <span class=\"number\">1</span>),</span><br><span class=\"line\"> (<span class=\"number\">1</span>, <span class=\"number\">2</span>),</span><br><span class=\"line\"> (<span class=\"number\">1</span>, <span class=\"number\">3</span>),</span><br><span class=\"line\"> (<span class=\"number\">1</span>, <span class=\"number\">10</span>),</span><br><span class=\"line\"> (<span class=\"number\">1</span>, <span class=\"number\">14</span>),</span><br><span class=\"line\"> (<span class=\"number\">1</span>, <span class=\"number\">17</span>),</span><br><span class=\"line\"> (<span class=\"number\">1</span>, <span class=\"number\">18</span>),</span><br><span class=\"line\"> (<span class=\"number\">1</span>, <span class=\"number\">19</span>),</span><br><span class=\"line\"> (<span class=\"number\">2</span>, <span class=\"number\">6</span>),</span><br><span class=\"line\"> (<span class=\"number\">2</span>, <span class=\"number\">11</span>),</span><br><span class=\"line\"> (<span class=\"number\">3</span>, <span class=\"number\">5</span>),</span><br><span class=\"line\"> (<span class=\"number\">5</span>, <span class=\"number\">13</span>)]</span><br><span class=\"line\"><span class=\"comment\"># 也可以用sorted函数内置的key来指定比较</span></span><br><span class=\"line\"><span class=\"comment\"># 第一个参数为传入的数据,第二个key来指定用哪个值作为比较</span></span><br><span class=\"line\"><span class=\"built_in\">sorted</span>(result.items(),key=<span class=\"keyword\">lambda</span> x:x[<span class=\"number\">1</span>])</span><br><span class=\"line\">[(<span class=\"number\">1</span>, <span class=\"number\">1</span>),</span><br><span class=\"line\"> (<span class=\"number\">2</span>, <span class=\"number\">1</span>),</span><br><span class=\"line\"> (<span class=\"number\">14</span>, <span class=\"number\">1</span>),</span><br><span class=\"line\"> (<span class=\"number\">19</span>, <span class=\"number\">1</span>),</span><br><span class=\"line\"> (<span class=\"number\">3</span>, <span class=\"number\">1</span>),</span><br><span class=\"line\"> (<span class=\"number\">10</span>, <span class=\"number\">1</span>),</span><br><span class=\"line\"> (<span class=\"number\">17</span>, <span class=\"number\">1</span>),</span><br><span class=\"line\"> (<span class=\"number\">18</span>, <span class=\"number\">1</span>),</span><br><span class=\"line\"> (<span class=\"number\">6</span>, <span class=\"number\">2</span>),</span><br><span class=\"line\"> (<span class=\"number\">11</span>, <span class=\"number\">2</span>),</span><br><span class=\"line\"> (<span class=\"number\">5</span>, <span class=\"number\">3</span>),</span><br><span class=\"line\"> (<span class=\"number\">13</span>, <span class=\"number\">5</span>)]</span><br></pre></td></tr></table></figure>\n\n<p>第二种,使用<code>collections</code>的<code>Counter</code></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> collections <span class=\"keyword\">import</span> Counter</span><br><span class=\"line\">c = Counter(data)</span><br><span class=\"line\">Counter(&#123;<span class=\"number\">13</span>: <span class=\"number\">5</span>,</span><br><span class=\"line\">         <span class=\"number\">5</span>: <span class=\"number\">3</span>,</span><br><span class=\"line\">         <span class=\"number\">1</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">         <span class=\"number\">2</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">         <span class=\"number\">14</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">         <span class=\"number\">6</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">         <span class=\"number\">11</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">         <span class=\"number\">19</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">         <span class=\"number\">3</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">         <span class=\"number\">10</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">         <span class=\"number\">17</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">         <span class=\"number\">18</span>: <span class=\"number\">1</span>&#125;)</span><br><span class=\"line\"><span class=\"comment\"># 我们如果要取最多的话只需要使用most_common</span></span><br><span class=\"line\"><span class=\"comment\"># 表示取出现次数最多的前三个</span></span><br><span class=\"line\">c.most_common(<span class=\"number\">3</span>)</span><br><span class=\"line\">[(<span class=\"number\">13</span>, <span class=\"number\">5</span>), (<span class=\"number\">5</span>, <span class=\"number\">3</span>), (<span class=\"number\">6</span>, <span class=\"number\">2</span>)]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"查找公共键\"><a href=\"#查找公共键\" class=\"headerlink\" title=\"查找公共键\"></a>查找公共键</h2><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">需求:</span></span><br><span class=\"line\"><span class=\"string\">现有3个字典,需要查找出在三个字典中公共出现的键</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\">dict_1 = &#123;k:randint(<span class=\"number\">60</span>,<span class=\"number\">100</span>) <span class=\"keyword\">for</span> k <span class=\"keyword\">in</span> sample(<span class=\"string\">&#x27;abcdefg&#x27;</span>,randint(<span class=\"number\">1</span>,<span class=\"number\">7</span>))&#125;</span><br><span class=\"line\">dict_2 = &#123;k:randint(<span class=\"number\">60</span>,<span class=\"number\">100</span>) <span class=\"keyword\">for</span> k <span class=\"keyword\">in</span> sample(<span class=\"string\">&#x27;abcdefg&#x27;</span>,randint(<span class=\"number\">1</span>,<span class=\"number\">7</span>))&#125;</span><br><span class=\"line\">dict_3 = &#123;k:randint(<span class=\"number\">60</span>,<span class=\"number\">100</span>) <span class=\"keyword\">for</span> k <span class=\"keyword\">in</span> sample(<span class=\"string\">&#x27;abcdefg&#x27;</span>,randint(<span class=\"number\">1</span>,<span class=\"number\">7</span>))&#125;</span><br><span class=\"line\">dict_1</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;e&#x27;</span>: <span class=\"number\">68</span>, <span class=\"string\">&#x27;c&#x27;</span>: <span class=\"number\">73</span>, <span class=\"string\">&#x27;b&#x27;</span>: <span class=\"number\">68</span>, <span class=\"string\">&#x27;f&#x27;</span>: <span class=\"number\">80</span>&#125;</span><br><span class=\"line\">dict_2</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;e&#x27;</span>: <span class=\"number\">99</span>, <span class=\"string\">&#x27;g&#x27;</span>: <span class=\"number\">74</span>, <span class=\"string\">&#x27;c&#x27;</span>: <span class=\"number\">96</span>, <span class=\"string\">&#x27;b&#x27;</span>: <span class=\"number\">78</span>&#125;</span><br><span class=\"line\">dict_3</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;b&#x27;</span>: <span class=\"number\">90</span>, <span class=\"string\">&#x27;g&#x27;</span>: <span class=\"number\">93</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>第一种方法:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">result = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> k <span class=\"keyword\">in</span> dict_1.keys():</span><br><span class=\"line\">    <span class=\"keyword\">if</span> k <span class=\"keyword\">in</span> dict_2 <span class=\"keyword\">and</span> k <span class=\"keyword\">in</span> dict_3:</span><br><span class=\"line\">        result.append(k)</span><br><span class=\"line\">result</span><br><span class=\"line\">[<span class=\"string\">&#x27;b&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<p>这种的话 如果我有很多个字典,我就要一个一个判断</p>\n<p>第二种:我们可以用集合的交集</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">dict_1.keys()&amp; dict_2.keys() &amp;dict_3.keys()</span><br><span class=\"line\"><span class=\"comment\"># 如果有多个 我们可以用</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">reduce() 函数会对参数序列中元素进行累积。</span></span><br><span class=\"line\"><span class=\"string\">函数将一个数据集合（链表，元组等）中的所有数据进行下列操作：用传给 reduce 中的函数 function（有两个参数）先对集合中的第 1、2 个元素进行操作，得到的结果再与第三个数据用 function 函数运算，最后得到一个结果。</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 在python3中已将reduce移除,我们需要在functools中导入</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> functools <span class=\"keyword\">import</span> reduce</span><br><span class=\"line\">reduce(<span class=\"keyword\">lambda</span> a,b:a&amp;b,<span class=\"built_in\">map</span>(<span class=\"built_in\">dict</span>.keys,[dict_1,dict_2,dict_3]))</span><br><span class=\"line\">&#123;<span class=\"string\">&#x27;b&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"如何实现历史记录功能\"><a href=\"#如何实现历史记录功能\" class=\"headerlink\" title=\"如何实现历史记录功能\"></a>如何实现历史记录功能</h2><p>需求:记录用户的每次输入</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> collections <span class=\"keyword\">import</span> deque</span><br><span class=\"line\"><span class=\"comment\"># 定义一个deque 他是一个双端循环队列</span></span><br><span class=\"line\"><span class=\"comment\"># deque(可迭代对象, 长度)</span></span><br><span class=\"line\">q = deque([], <span class=\"number\">5</span>)</span><br><span class=\"line\">q.append(<span class=\"number\">1</span>)</span><br><span class=\"line\">q.append(<span class=\"number\">2</span>)</span><br><span class=\"line\">q.append(<span class=\"number\">3</span>)</span><br><span class=\"line\">q.append(<span class=\"number\">4</span>)</span><br><span class=\"line\">q.append(<span class=\"number\">5</span>)</span><br><span class=\"line\">q.append(<span class=\"number\">6</span>)</span><br><span class=\"line\">q</span><br><span class=\"line\">deque([<span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>])</span><br><span class=\"line\"><span class=\"comment\"># 其实内部实现了一个判断列表长度,判断如果长度太长就把左边先进的剔除掉</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"迭代多个可迭代对象\"><a href=\"#迭代多个可迭代对象\" class=\"headerlink\" title=\"迭代多个可迭代对象\"></a>迭代多个可迭代对象</h2><p>需求:</p>\n<ol>\n<li>有一个班的,希望得到语文,数学,英语的总分</li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> random <span class=\"keyword\">import</span> randint</span><br><span class=\"line\">chinese = [randint(<span class=\"number\">60</span>, <span class=\"number\">100</span>) <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">30</span>)]</span><br><span class=\"line\">math = [randint(<span class=\"number\">60</span>, <span class=\"number\">100</span>) <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">30</span>)]</span><br><span class=\"line\">enlish = [randint(<span class=\"number\">60</span>, <span class=\"number\">100</span>) <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">30</span>)]</span><br><span class=\"line\"><span class=\"comment\"># 我们可以使用zip函数</span></span><br><span class=\"line\">total = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">zip</span>(chinese, math, enlish):</span><br><span class=\"line\">    total.append(<span class=\"built_in\">sum</span>(i))</span><br><span class=\"line\">total</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>多个班,希望得到分数超过90的人数</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">from random import randint</span><br><span class=\"line\">c1 = [randint(60, 100) for _ in range(30)]</span><br><span class=\"line\">c2 = [randint(60, 100) for _ in range(33)]</span><br><span class=\"line\">c3 = [randint(60, 100) for _ in range(32)]</span><br><span class=\"line\">c4 = [randint(60, 100) for _ in range(31)]</span><br><span class=\"line\">count = 0</span><br><span class=\"line\">from itertools import chain</span><br><span class=\"line\"># 也可以直接相加,两个效率是一样的</span><br><span class=\"line\"># for i in c1+c2+c3+c4:</span><br><span class=\"line\">for i in chain(c1 ,c2 , c3 , c4):</span><br><span class=\"line\">    if i &gt;= 90:</span><br><span class=\"line\">        count += 1</span><br><span class=\"line\">count</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"拆分多个分隔符的字符串\"><a href=\"#拆分多个分隔符的字符串\" class=\"headerlink\" title=\"拆分多个分隔符的字符串\"></a>拆分多个分隔符的字符串</h2><p>需求:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">有一个字符串包含多个分隔符,如:</span><br><span class=\"line\">s = <span class=\"string\">&#x27;ads;cd|efesada,fjasd,fasd\\tfasd;feas,asdas:fefa\\tffgg&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>使用<code>split</code>方法,进行多次</li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">s = <span class=\"string\">&#x27;ads;cd|efesada,fjasd,fasd\\tfasd;feas,asdas:fefa\\tffgg&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 我们可以对s进行split()</span></span><br><span class=\"line\">res = s.split(<span class=\"string\">&#x27;;&#x27;</span>)</span><br><span class=\"line\">res</span><br><span class=\"line\">[<span class=\"string\">&#x27;ads&#x27;</span>, <span class=\"string\">&#x27;cd|efesada,fjasd,fasd\\tfasd&#x27;</span>, <span class=\"string\">&#x27;feas,asdas:fefa\\tffgg&#x27;</span>]</span><br><span class=\"line\"><span class=\"comment\"># 然后再对res进行一次split()</span></span><br><span class=\"line\">[i.split(<span class=\"string\">&#x27;|&#x27;</span>) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> res]</span><br><span class=\"line\">[[<span class=\"string\">&#x27;ads&#x27;</span>], [<span class=\"string\">&#x27;cd&#x27;</span>, <span class=\"string\">&#x27;efesada,fjasd,fasd\\tfasd&#x27;</span>], [<span class=\"string\">&#x27;feas,asdas:fefa\\tffgg&#x27;</span>]]</span><br><span class=\"line\"><span class=\"comment\"># 这并不是我们想要的结果,我们可以用变量t来接收</span></span><br><span class=\"line\">t=[]</span><br><span class=\"line\">[t.extend(i.split(<span class=\"string\">&#x27;|&#x27;</span>)) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> res]</span><br><span class=\"line\">t</span><br><span class=\"line\">[<span class=\"string\">&#x27;ads&#x27;</span>, <span class=\"string\">&#x27;cd&#x27;</span>, <span class=\"string\">&#x27;efesada,fjasd,fasd\\tfasd&#x27;</span>, <span class=\"string\">&#x27;feas,asdas:fefa\\tffgg&#x27;</span>]</span><br><span class=\"line\"><span class=\"comment\"># 然后再对其进行split()</span></span><br><span class=\"line\"><span class=\"comment\"># 所以我们可以定义一个函数</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">mySplit</span>(<span class=\"params\">s,separators</span>):</span><br><span class=\"line\">    <span class=\"comment\"># 这里需要把传进来的字符串变成列表</span></span><br><span class=\"line\">    res=[s]</span><br><span class=\"line\">    <span class=\"keyword\">for</span> separator <span class=\"keyword\">in</span> separators:</span><br><span class=\"line\">        t = []</span><br><span class=\"line\">        [t.extend(i.split(separator)) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> res]</span><br><span class=\"line\">        res =t</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res</span><br><span class=\"line\">s = <span class=\"string\">&#x27;ads;cd|efesada,fjasd,fasd\\tfasd;feas,asdas:fefa\\tffgg&#x27;</span></span><br><span class=\"line\">result = mySplit(s,<span class=\"string\">&#x27;;,|\\t&#x27;</span>)</span><br><span class=\"line\">result</span><br><span class=\"line\">[<span class=\"string\">&#x27;ads&#x27;</span>, <span class=\"string\">&#x27;cd&#x27;</span>, <span class=\"string\">&#x27;efesada&#x27;</span>, <span class=\"string\">&#x27;fjasd&#x27;</span>, <span class=\"string\">&#x27;fasd&#x27;</span>, <span class=\"string\">&#x27;fasd&#x27;</span>, <span class=\"string\">&#x27;feas&#x27;</span>, <span class=\"string\">&#x27;asdas:fefa&#x27;</span>, <span class=\"string\">&#x27;ffgg&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>使用<code>re.split</code></li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\">s = <span class=\"string\">&#x27;ads;cd|efesada,fjasd,fasd\\tfasd;feas,asdas:fefa\\tffgg&#x27;</span></span><br><span class=\"line\">re.split(<span class=\"string\">&#x27;[;|,\\t]+&#x27;</span>,s)</span><br><span class=\"line\">[<span class=\"string\">&#x27;ads&#x27;</span>, <span class=\"string\">&#x27;cd&#x27;</span>, <span class=\"string\">&#x27;efesada&#x27;</span>, <span class=\"string\">&#x27;fjasd&#x27;</span>, <span class=\"string\">&#x27;fasd&#x27;</span>, <span class=\"string\">&#x27;fasd&#x27;</span>, <span class=\"string\">&#x27;feas&#x27;</span>, <span class=\"string\">&#x27;asdas:fefa&#x27;</span>, <span class=\"string\">&#x27;ffgg&#x27;</span>]</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"进行字符串对齐\"><a href=\"#进行字符串对齐\" class=\"headerlink\" title=\"进行字符串对齐\"></a>进行字符串对齐</h2><ol>\n<li>字符串方法</li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">s=<span class=\"string\">&#x27;aaa&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># ljust 左对齐,第二个参数为填充</span></span><br><span class=\"line\">s.ljust(<span class=\"number\">20</span>,<span class=\"string\">&#x27;#&#x27;</span>)</span><br><span class=\"line\"><span class=\"string\">&#x27;aaa#################&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 右对齐</span></span><br><span class=\"line\">s.rjust(<span class=\"number\">20</span>)</span><br><span class=\"line\"><span class=\"string\">&#x27;                 aaa&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># 居中对齐</span></span><br><span class=\"line\">s.center(<span class=\"number\">20</span>)</span><br><span class=\"line\"><span class=\"string\">&#x27;        aaa         &#x27;</span></span><br></pre></td></tr></table></figure>\n\n<ol>\n<li><code>format</code>方法</li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#左对齐</span></span><br><span class=\"line\"><span class=\"built_in\">format</span>(s,<span class=\"string\">&#x27;&lt;20&#x27;</span>)</span><br><span class=\"line\"><span class=\"string\">&#x27;aaa                 &#x27;</span></span><br><span class=\"line\"><span class=\"comment\">#右对齐</span></span><br><span class=\"line\"><span class=\"built_in\">format</span>(s,<span class=\"string\">&#x27;&gt;20&#x27;</span>)</span><br><span class=\"line\"><span class=\"string\">&#x27;                 aaa&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">#居中对齐</span></span><br><span class=\"line\"><span class=\"built_in\">format</span>(s,<span class=\"string\">&#x27;^20&#x27;</span>)</span><br><span class=\"line\"><span class=\"string\">&#x27;        aaa         &#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"如何设置文件缓冲\"><a href=\"#如何设置文件缓冲\" class=\"headerlink\" title=\"如何设置文件缓冲\"></a>如何设置文件缓冲</h2><ul>\n<li>全缓冲:<code>open</code>函数的bufering设置为大于1的整数n,n为缓冲区大小</li>\n<li>行缓冲:<code>open</code>函数的buffering设置为1,当有换行时写入</li>\n<li>无缓冲:<code>open</code>函数的buffering设置为0,实时写入</li>\n</ul>\n<h2 id=\"如何使用临时文件\"><a href=\"#如何使用临时文件\" class=\"headerlink\" title=\"如何使用临时文件\"></a>如何使用临时文件</h2><p>你需要在程序执行时创建一个临时文件或目录，并希望使用完之后可以自动销毁掉。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> tempfile <span class=\"keyword\">import</span> TemporaryFile</span><br><span class=\"line\"></span><br><span class=\"line\">f = TemporaryFile(mode=<span class=\"string\">&#x27;w+t&#x27;</span>)</span><br><span class=\"line\">f.write(<span class=\"string\">&#x27;abcdef&#x27;</span> * <span class=\"number\">1000</span>)</span><br><span class=\"line\">f.seek(<span class=\"number\">0</span>)</span><br><span class=\"line\">data = f.read(<span class=\"number\">100</span>)</span><br><span class=\"line\">data</span><br><span class=\"line\">f.close()</span><br><span class=\"line\"><span class=\"keyword\">from</span> tempfile <span class=\"keyword\">import</span> TemporaryFile</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">with</span> TemporaryFile(<span class=\"string\">&#x27;w+t&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    <span class=\"comment\"># Read/write to the file</span></span><br><span class=\"line\">    f.write(<span class=\"string\">&#x27;Hello World\\n&#x27;</span>)</span><br><span class=\"line\">    f.write(<span class=\"string\">&#x27;Testing\\n&#x27;</span>)</span><br><span class=\"line\">    <span class=\"comment\"># Seek back to beginning and read the data</span></span><br><span class=\"line\">    f.seek(<span class=\"number\">0</span>)</span><br><span class=\"line\">    data = f.read()</span><br><span class=\"line\">TemporaryFile`是匿名的文件,如果你需要有名字的文件,可以使用`NamedTemporaryFile</span><br><span class=\"line\"><span class=\"keyword\">from</span> tempfile <span class=\"keyword\">import</span> NamedTemporaryFile</span><br><span class=\"line\"><span class=\"keyword\">with</span> NamedTemporaryFile(<span class=\"string\">&#x27;w+t&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;filename is:&#x27;</span>, f.name)</span><br><span class=\"line\">    </span><br><span class=\"line\">filename <span class=\"keyword\">is</span>: C:\\Users\\Tiger\\AppData\\Local\\Temp\\tmphjupdmz8</span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">这里，被打开文件的 f.name 属性包含了该临时文件的文件名。 当你需要将文件名传递给其他代码来打开这个文件的时候，这个就很有用了。 和 TemporaryFile() 一样，结果文件关闭时会被自动删除掉。 如果你不想这么做，可以传递一个关键字参数 delete=False 即可</span></span><br><span class=\"line\"><span class=\"string\">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"如何在一个现有类中-添加自己的逻辑\"><a href=\"#如何在一个现有类中-添加自己的逻辑\" class=\"headerlink\" title=\"如何在一个现有类中,添加自己的逻辑\"></a>如何在一个现有类中,添加自己的逻辑</h2><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">比如,我已经有一个<span class=\"built_in\">tuple</span>类,这个类可以把列表变成元组</span><br><span class=\"line\"><span class=\"built_in\">tuple</span>([[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, -<span class=\"number\">1</span>, <span class=\"string\">&#x27;abc&#x27;</span>, [<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"string\">&#x27;u&#x27;</span>], <span class=\"number\">3</span>]])</span><br><span class=\"line\">([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, -<span class=\"number\">1</span>, <span class=\"string\">&#x27;abc&#x27;</span>, [<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"string\">&#x27;u&#x27;</span>], <span class=\"number\">3</span>],)</span><br><span class=\"line\">而我们希望得到过滤掉字符串已经小于<span class=\"number\">0</span>的数</span><br></pre></td></tr></table></figure>\n\n<p>我们可以重写<code>new</code>方法</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">intTuple</span>(<span class=\"title class_ inherited__\">tuple</span>):</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__new__</span>(<span class=\"params\">cls, iterable</span>):</span><br><span class=\"line\">        g = [i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> iterable <span class=\"keyword\">if</span> <span class=\"built_in\">isinstance</span>(i, <span class=\"built_in\">int</span>) <span class=\"keyword\">and</span> i &gt; <span class=\"number\">0</span>]</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">super</span>().__new__(cls,g)</span><br><span class=\"line\">t = intTuple([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, -<span class=\"number\">1</span>, <span class=\"string\">&#x27;abc&#x27;</span>, [<span class=\"string\">&#x27;x&#x27;</span>, <span class=\"string\">&#x27;u&#x27;</span>], <span class=\"number\">3</span>])</span><br><span class=\"line\"><span class=\"built_in\">print</span>(t)</span><br><span class=\"line\">(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">3</span>)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"上下文管理\"><a href=\"#上下文管理\" class=\"headerlink\" title=\"上下文管理\"></a>上下文管理</h2><p>实现一个新的上下文管理器的最简单的方法就是使用 <code>contexlib</code> 模块中的 <code>@contextmanager</code> 装饰器。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> contextlib <span class=\"keyword\">import</span> contextmanager</span><br><span class=\"line\"><span class=\"keyword\">import</span> sqlite3</span><br><span class=\"line\"><span class=\"meta\">@contextmanager</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">conn_sqlite3</span>(<span class=\"params\">db</span>):</span><br><span class=\"line\">    conn = sqlite3.connect(db)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;start&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> conn</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;close&#x27;</span>)</span><br><span class=\"line\">    conn.close()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">with</span> conn_sqlite3(<span class=\"string\">&#x27;db.sqlite3&#x27;</span>) <span class=\"keyword\">as</span>  conn:</span><br><span class=\"line\">    cur = conn.cursor()</span><br><span class=\"line\">    cur.execute(<span class=\"string\">&#x27;select * from main.api_userunfo&#x27;</span>)</span><br><span class=\"line\">    result = cur.fetchall()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<p>在函数 <code>conn_sqlite3</code> 中，<code>yield</code> 之前的代码会在上下文管理器中作为 <code>__enter__()</code> 方法执行， 所有在 <code>yield</code> 之后的代码会作为 <code>__exit__()</code> 方法执行。 如果出现了异常，异常会在yield语句那里抛出。</p>\n<p>当然也可以在类中用<code>__enter__()</code>方法 跟 <code>__exit__()</code>方法</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> sqlite3</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">connSqlite3</span>(<span class=\"title class_ inherited__\">object</span>):</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self,db</span>):</span><br><span class=\"line\">        self.db =db</span><br><span class=\"line\">        self.conn=<span class=\"literal\">None</span></span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__enter__</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;start&#x27;</span>)</span><br><span class=\"line\">        self.conn = sqlite3.connect(self.db)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.conn</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__exit__</span>(<span class=\"params\">self, exc_type, exc_val, exc_tb</span>):</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;close&#x27;</span>)</span><br><span class=\"line\">        self.conn.close()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">with</span> connSqlite3(<span class=\"string\">&#x27;db.sqlite3&#x27;</span>) <span class=\"keyword\">as</span>  conn:</span><br><span class=\"line\">    cur = conn.cursor()</span><br><span class=\"line\">    cur.execute(<span class=\"string\">&#x27;select * from main.api_userunfo&#x27;</span>)</span><br><span class=\"line\">    result = cur.fetchall()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n","categories":["python"],"tags":["python","技巧"]},{"title":"Protocol Buffers","url":"/post/c05c69b3.html","content":"<p>Protocol Buffers 是一种与语言无关，平台无关的可扩展机制，用于序列化结构化数据。使用Protocol Buffers 可以一次定义结构化的数据，然后可以使用特殊生成的源代码轻松地在各种数据流中使用各种语言编写和读取结构化数据。</p>\n<p>现在有许多框架等在使用Protocol Buffers。gRPC也是基于Protocol Buffers。 Protocol Buffers 目前有2和3两个版本号。</p>\n<p><strong>在gRPC中推荐使用proto3版本。</strong></p>\n<span id=\"more\"></span>\n\n<h2 id=\"文档结构\"><a href=\"#文档结构\" class=\"headerlink\" title=\"文档结构\"></a>文档结构</h2><h3 id=\"Protocol-Buffers版本\"><a href=\"#Protocol-Buffers版本\" class=\"headerlink\" title=\"Protocol Buffers版本\"></a>Protocol Buffers版本</h3><p>Protocol Buffers文档的第一行非注释行，为版本申明，不填写的话默认为版本2。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">syntax = &quot;proto3&quot;;</span><br><span class=\"line\">或者</span><br><span class=\"line\">syntax = &quot;proto2&quot;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Package包\"><a href=\"#Package包\" class=\"headerlink\" title=\"Package包\"></a>Package包</h3><p>Protocol Buffers 可以声明package，来防止命名冲突。 Packages是可选的。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">package foo.bar;</span><br><span class=\"line\">message Open &#123; ... &#125;</span><br></pre></td></tr></table></figure>\n\n<p>使用的时候，也要加上命名空间，</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">message Foo &#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  foo.bar.Open open = 1;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>注意：对于Python而言，<code>package</code>会被忽略处理，因为Python中的包是以文件目录来定义的。</strong></p>\n<h3 id=\"导入\"><a href=\"#导入\" class=\"headerlink\" title=\"导入\"></a>导入</h3><p>Protocol Buffers 中可以导入其它文件消息等，与Python的import类似。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">import “myproject/other_protos.proto”;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"定义各种消息和服务\"><a href=\"#定义各种消息和服务\" class=\"headerlink\" title=\"定义各种消息和服务\"></a>定义各种消息和服务</h3><p>消息messge是用来定义数据的，服务service是用来gRPC的方法的。</p>\n<h2 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"注释\"></a>注释</h2><p>Protocol Buffers 提供以下两种注释方式。</p>\n<figure class=\"highlight c\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 单行注释</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">/* </span></span><br><span class=\"line\"><span class=\"comment\">多行注释 </span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"数据类型\"><a href=\"#数据类型\" class=\"headerlink\" title=\"数据类型\"></a>数据类型</h2><h3 id=\"基本数据类型\"><a href=\"#基本数据类型\" class=\"headerlink\" title=\"基本数据类型\"></a>基本数据类型</h3><table>\n<thead>\n<tr>\n<th align=\"left\">.proto</th>\n<th align=\"left\">说明</th>\n<th align=\"left\">Python</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">double</td>\n<td align=\"left\"></td>\n<td align=\"left\">float</td>\n</tr>\n<tr>\n<td align=\"left\">float</td>\n<td align=\"left\"></td>\n<td align=\"left\">float</td>\n</tr>\n<tr>\n<td align=\"left\">int32</td>\n<td align=\"left\">使用变长编码，对负数编码效率低， 如果你的变量可能是负数，可以使用sint32</td>\n<td align=\"left\">int</td>\n</tr>\n<tr>\n<td align=\"left\">int64</td>\n<td align=\"left\">使用变长编码，对负数编码效率低，如果你的变量可能是负数，可以使用sint64</td>\n<td align=\"left\">int&#x2F;long</td>\n</tr>\n<tr>\n<td align=\"left\">uint32</td>\n<td align=\"left\">使用变长编码</td>\n<td align=\"left\">int&#x2F;long</td>\n</tr>\n<tr>\n<td align=\"left\">uint64</td>\n<td align=\"left\">使用变长编码</td>\n<td align=\"left\">int&#x2F;long</td>\n</tr>\n<tr>\n<td align=\"left\">sint32</td>\n<td align=\"left\">使用变长编码，带符号的int类型，对负数编码比int32高效</td>\n<td align=\"left\">int</td>\n</tr>\n<tr>\n<td align=\"left\">sint64</td>\n<td align=\"left\">使用变长编码，带符号的int类型，对负数编码比int64高效</td>\n<td align=\"left\">int&#x2F;long</td>\n</tr>\n<tr>\n<td align=\"left\">fixed32</td>\n<td align=\"left\">4字节编码， 如果变量经常大于2^{28} 的话，会比uint32高效</td>\n<td align=\"left\">int</td>\n</tr>\n<tr>\n<td align=\"left\">fixed64</td>\n<td align=\"left\">8字节编码， 如果变量经常大于2^{56} 的话，会比uint64高效</td>\n<td align=\"left\">int&#x2F;long</td>\n</tr>\n<tr>\n<td align=\"left\">sfixed32</td>\n<td align=\"left\">4字节编码</td>\n<td align=\"left\">int</td>\n</tr>\n<tr>\n<td align=\"left\">sfixed64</td>\n<td align=\"left\">8字节编码</td>\n<td align=\"left\">int&#x2F;long</td>\n</tr>\n<tr>\n<td align=\"left\">bool</td>\n<td align=\"left\"></td>\n<td align=\"left\">bool</td>\n</tr>\n<tr>\n<td align=\"left\">string</td>\n<td align=\"left\">必须包含utf-8编码或者7-bit ASCII text</td>\n<td align=\"left\">str</td>\n</tr>\n<tr>\n<td align=\"left\">bytes</td>\n<td align=\"left\">任意的字节序列</td>\n<td align=\"left\">str</td>\n</tr>\n</tbody></table>\n<h3 id=\"枚举\"><a href=\"#枚举\" class=\"headerlink\" title=\"枚举\"></a>枚举</h3><p>在 Proto Buffers 中，我们可以定义枚举和枚举类型，</p>\n<figure class=\"highlight protobuf\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum </span><span class=\"title class_\">Corpus</span> &#123;</span><br><span class=\"line\">    UNIVERSAL = <span class=\"number\">0</span>;</span><br><span class=\"line\">    WEB = <span class=\"number\">1</span>;</span><br><span class=\"line\">    IMAGES = <span class=\"number\">2</span>;</span><br><span class=\"line\">    LOCAL = <span class=\"number\">3</span>;</span><br><span class=\"line\">    NEWS = <span class=\"number\">4</span>;</span><br><span class=\"line\">    PRODUCTS = <span class=\"number\">5</span>;</span><br><span class=\"line\">    VIDEO = <span class=\"number\">6</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Corpus corpus = <span class=\"number\">4</span>;</span><br></pre></td></tr></table></figure>\n\n<p>枚举定义在一个消息内部或消息外部都是可以的，如果枚举是 定义在 message 内部，而其他 message 又想使用，那么可以通过 MessageType.EnumType 的方式引用。</p>\n<p><strong>定义枚举的时候，我们要保证第一个枚举值必须是0，枚举值不能重复，除非使用 option allow_alias &#x3D; true 选项来开启别名。</strong></p>\n<figure class=\"highlight protobuf\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">enum </span><span class=\"title class_\">EnumAllowingAlias</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">option</span> allow_alias = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    UNKNOWN = <span class=\"number\">0</span>;</span><br><span class=\"line\">    STARTED = <span class=\"number\">1</span>;</span><br><span class=\"line\">    RUNNING = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>枚举值的范围是32-bit integer，但因为枚举值使用变长编码，所以不推荐使用负数作为枚举值，因为这会带来效率问题。</p>\n<h2 id=\"消息类型\"><a href=\"#消息类型\" class=\"headerlink\" title=\"消息类型\"></a>消息类型</h2><p>Protocol Buffers使用message定义消息数据。在Protocol Buffers中使用的数据都是通过message消息数据封装基本类型数据或其他消息数据，对应Python中的类。</p>\n<figure class=\"highlight protobuf\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">SearchRequest</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">string</span> query = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"type\">int32</span> page_number = <span class=\"number\">2</span>;</span><br><span class=\"line\">  <span class=\"type\">int32</span> result_per_page = <span class=\"number\">3</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"字段编号\"><a href=\"#字段编号\" class=\"headerlink\" title=\"字段编号\"></a>字段编号</h3><p>消息定义中的每个字段都有唯一的编号。<strong>这些字段编号用于以消息二进制格式标识字段，并且在使用消息类型后不应更改。</strong> 请注意，<strong>1到15范围内的字段编号需要一个字节进行编码，包括字段编号和字段类型</strong>。<strong>16到2047范围内的字段编号占用两个字节</strong>。因此，您应该为非常频繁出现的消息元素保留数字1到15。请记住为将来可能添加的常用元素留出一些空间。</p>\n<p>最小的标识号可以从1开始，最大到2^29 - 1,或 536,870,911。不可以使用其中的[19000－19999]的标识号， Protobuf协议实现中对这些进行了预留。如果非要在.proto文件中使用这些预留标识号，编译时就会报警。同样你也不能使用早期保留的标识号。</p>\n<h3 id=\"指定字段规则\"><a href=\"#指定字段规则\" class=\"headerlink\" title=\"指定字段规则\"></a>指定字段规则</h3><p>消息字段可以是以下之一：</p>\n<ul>\n<li><p>singular：格式良好的消息可以包含该字段中的零个或一个（但不超过一个）。</p>\n</li>\n<li><p>repeated：此字段可以在格式良好的消息中重复任意次数（包括零）。将保留重复值的顺序。对应Python的列表。</p>\n<figure class=\"highlight protobuf\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">Result</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">string</span> url = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"type\">string</span> title = <span class=\"number\">2</span>;</span><br><span class=\"line\">  <span class=\"keyword\">repeated</span> <span class=\"type\">string</span> snippets = <span class=\"number\">3</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"添加更多消息类型\"><a href=\"#添加更多消息类型\" class=\"headerlink\" title=\"添加更多消息类型\"></a>添加更多消息类型</h3><p>可以在单个.proto文件中定义多个消息类型。</p>\n<figure class=\"highlight protobuf\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">SearchRequest</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">string</span> query = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"type\">int32</span> page_number = <span class=\"number\">2</span>;</span><br><span class=\"line\">  <span class=\"type\">int32</span> result_per_page = <span class=\"number\">3</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">SearchResponse</span> &#123;</span><br><span class=\"line\"> ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"保留字段\"><a href=\"#保留字段\" class=\"headerlink\" title=\"保留字段\"></a>保留字段</h3><p>保留变量不被使用</p>\n<p>如果通过完全删除字段或将其注释来更新消息类型，则未来用户可以在对类型进行自己的更新时重用字段编号。如果以后加载相同的旧版本，这可能会导致严重问题，包括数据损坏，隐私错误等。确保不会发生这种情况的一种方法是<strong>指定已删除字段的字段编号（或名称）reserved</strong>。如果将来的任何用户尝试使用这些字段标识符，protobuf编译器将会报错。</p>\n<figure class=\"highlight protobuf\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">Foo</span> &#123;</span><br><span class=\"line\">  reserved <span class=\"number\">2</span>, <span class=\"number\">15</span>, <span class=\"number\">9</span> to <span class=\"number\">11</span>;</span><br><span class=\"line\">  reserved <span class=\"string\">&quot;foo&quot;</span>, <span class=\"string\">&quot;bar&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"默认值\"><a href=\"#默认值\" class=\"headerlink\" title=\"默认值\"></a>默认值</h3><p>解析消息时，如果编码消息不包含特定的单数元素，则解析对象中的相应字段将设置为该字段的默认值。这些默认值是特定于类型的：</p>\n<ul>\n<li>对于字符串，默认值为空字符串。</li>\n<li>对于字节，默认值为空字节。</li>\n<li>对于bools，默认值为false。</li>\n<li>对于数字类型，默认值为零。</li>\n<li>对于枚举，默认值是第一个定义的枚举值，该值必须为0。</li>\n<li>对于消息字段，未设置该字段。它的确切值取决于语言。</li>\n<li>重复字段的默认值为空（通常是相应语言的空列表）。</li>\n</ul>\n<h3 id=\"嵌套类型\"><a href=\"#嵌套类型\" class=\"headerlink\" title=\"嵌套类型\"></a>嵌套类型</h3><p>你可以在其他消息类型中定义、使用消息类型，在下面的例子中，Result消息就定义在SearchResponse消息内，如：</p>\n<figure class=\"highlight protobuf\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">SearchResponse</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">message </span><span class=\"title class_\">Result</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">string</span> url = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"type\">string</span> title = <span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"keyword\">repeated</span> <span class=\"type\">string</span> snippets = <span class=\"number\">3</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">repeated</span> Result results = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果要在其父消息类型之外重用此消息类型，使用</p>\n<figure class=\"highlight protobuf\"><table><tr><td class=\"code\"><pre><span class=\"line\">SearchResponse.Result</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"map映射\"><a href=\"#map映射\" class=\"headerlink\" title=\"map映射\"></a>map映射</h2><p>如果要在数据定义中创建关联映射，Protocol Buffers提供了一种方便的语法：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">map&lt; key_type, value_type&gt; map_field = N ;</span><br></pre></td></tr></table></figure>\n\n<p>其中key_type可以是任何整数或字符串类型。请注意，枚举不是有效的key_type。value_type可以是除map映射类型外的任何类型。</p>\n<p>例如，如果要创建项目映射，其中每条Project消息都与字符串键相关联，则可以像下面这样定义它：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">map&lt;string, Project&gt; projects = 3 ;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>map的字段可以是repeated。</li>\n<li>序列化后的顺序和map迭代器的顺序是不确定的，所以你不要期望以固定顺序处理map</li>\n<li>当为.proto文件产生生成文本格式的时候，map会按照key 的顺序排序，数值化的key会按照数值排序。</li>\n<li>从序列化中解析或者融合时，如果有重复的key则后一个key不会被使用，当从文本格式中解析map时，如果存在重复的key，则解析可能会失败。</li>\n<li>如果为映射字段提供键但没有值，则字段序列化时的行为取决于语言。在Python中，使用类型的默认值。</li>\n</ul>\n<h2 id=\"oneof\"><a href=\"#oneof\" class=\"headerlink\" title=\"oneof\"></a>oneof</h2><p>如果你的消息中有很多可选字段， 并且同时至多一个字段会被设置， 你可以加强这个行为，使用oneof特性节省内存。</p>\n<p>为了在.proto定义oneof字段， 你需要在名字前面加上oneof关键字, 比如下面例子的test_oneof:</p>\n<figure class=\"highlight protobuf\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">SampleMessage</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">oneof</span> test_oneof &#123;</span><br><span class=\"line\">    <span class=\"type\">string</span> name = <span class=\"number\">4</span>;</span><br><span class=\"line\">    SubMessage sub_message = <span class=\"number\">9</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然后你可以增加oneof字段到 oneof 定义中. 你可以增加任意类型的字段, 但是不能使用repeated 关键字。</p>\n<h2 id=\"定义服务\"><a href=\"#定义服务\" class=\"headerlink\" title=\"定义服务\"></a>定义服务</h2><p>Protocol Buffers使用service定义RPC服务。</p>\n<figure class=\"highlight protobuf\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">HelloRequest</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">string</span> greeting = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">message </span><span class=\"title class_\">HelloResponse</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">string</span> reply = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">service </span><span class=\"title class_\">HelloService</span> &#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">rpc</span> SayHello (HelloRequest) <span class=\"keyword\">returns</span> (HelloResponse) </span>&#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>注意：一个service中可定义多个方法。</strong></p>\n","categories":["PRC"],"tags":["PRC"]},{"title":"Redis主从复制","url":"/post/b7e51ad7.html","content":"<h3 id=\"定义\"><a href=\"#定义\" class=\"headerlink\" title=\"定义\"></a>定义</h3><ol>\n<li>一个redis服务可以由多个该服务的复制品,这个redis服务称为master,其他复制品称为slaves.</li>\n<li>master会一直将做空的数据更新同步给slaves.保持主从同步.</li>\n<li>只要master可以执行写命令,slave只能执行读命令.</li>\n</ol>\n<h3 id=\"作用\"><a href=\"#作用\" class=\"headerlink\" title=\"作用\"></a>作用</h3><p>分担了读的压力(高并发),由于写操作执行的相对较少.</p>\n<span id=\"more\"></span>\n\n<h3 id=\"实现方式\"><a href=\"#实现方式\" class=\"headerlink\" title=\"实现方式\"></a>实现方式</h3><h4 id=\"方式一-linux终端上\"><a href=\"#方式一-linux终端上\" class=\"headerlink\" title=\"方式一,linux终端上\"></a>方式一,linux终端上</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">redis-server --port 6300[从服务器端口号] --slaveof 127.0.0.1[主服务器IP地址] 6379[端口号] --masterauth[主服务器密码(如果有的话)]</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">从服务器</span> </span><br><span class=\"line\">redis-server --port 6300 --slaveof 127.0.0.1 6379</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">客户端</span> </span><br><span class=\"line\">[root@10-7-189-100 ~]# redis-cli -p 6300</span><br><span class=\"line\">127.0.0.1:6300&gt; select 1</span><br><span class=\"line\">OK</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">从主服务器上复制过来的数据</span></span><br><span class=\"line\">127.0.0.1:6300[1]&gt; keys *</span><br><span class=\"line\">1) &quot;1&quot;</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">只能读数据不能写入</span></span><br><span class=\"line\">127.0.0.1:6300[1]&gt; set 1 2 </span><br><span class=\"line\">(error) READONLY You can&#x27;t write against a read only slave.</span><br><span class=\"line\">127.0.0.1:6300[1]&gt; get 1</span><br><span class=\"line\">&quot;2&quot;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"方式二-redis命令行\"><a href=\"#方式二-redis命令行\" class=\"headerlink\" title=\"方式二(redis命令行)\"></a>方式二(redis命令行)</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">当然也可以在服务启动后在命令行执行slaveof IP PORT  绑定主服务</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">客户端</span></span><br><span class=\"line\">127.0.0.1:6300[1]&gt; slaveof 127.0.0.1 6379</span><br><span class=\"line\">OK</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">主服务器</span></span><br><span class=\"line\">28696:M 08 Jan 16:53:10.291 * Synchronization with slave 127.0.0.1:6300 succeeded</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">当然也可以执行slaveof no one来解除主从</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">客户端</span></span><br><span class=\"line\">127.0.0.1:6300[1]&gt; slaveof no one</span><br><span class=\"line\">OK</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">服务器端</span>               </span><br><span class=\"line\">28135:M 08 Jan 16:51:34.637 # Connection with slave 127.0.0.1:6300 lost.</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"方式三-配置文件启动\"><a href=\"#方式三-配置文件启动\" class=\"headerlink\" title=\"方式三(配置文件启动)\"></a>方式三(配置文件启动)</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">只需要在配置文件中添加如下:</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">配置主服务器</span></span><br><span class=\"line\">slaveof 127.0.0.1 6379</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">配置端口</span></span><br><span class=\"line\">port 6300</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"补充\"><a href=\"#补充\" class=\"headerlink\" title=\"补充:\"></a>补充:</h4><p>配置文件添加后台启动,.</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">daemonize yes</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"问题-如果master-挂了怎么办\"><a href=\"#问题-如果master-挂了怎么办\" class=\"headerlink\" title=\"问题:如果master 挂了怎么办?\"></a>问题:如果master 挂了怎么办?</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">一个master有多个slaves</span><br><span class=\"line\">slave挂一个,只是处理读的性能有所下降</span><br><span class=\"line\">master 如果挂了,那么所有写请求都无法执行.</span><br><span class=\"line\">怎么办?</span><br><span class=\"line\">我们只能在slaves中找一个把他当成master,然后修改别的slave重新指向新的master</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">以上是我们手动处理master挂了的方法,那么有没有什么自动实现的呢?这里我们就要讲一下sentinel哨兵.</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"redis-rentine哨兵\"><a href=\"#redis-rentine哨兵\" class=\"headerlink\" title=\"redis-rentine哨兵\"></a>redis-rentine哨兵</h3><p>哨兵就是来帮我我们把手动需要干的事情,自动化.</p>\n<h4 id=\"安装哨兵\"><a href=\"#安装哨兵\" class=\"headerlink\" title=\"安装哨兵\"></a>安装哨兵</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install redis-sentinel</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"新建哨兵配置文件\"><a href=\"#新建哨兵配置文件\" class=\"headerlink\" title=\"新建哨兵配置文件\"></a>新建哨兵配置文件</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim redis_sentin.conf</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">配置哨兵的端口</span></span><br><span class=\"line\">port 26379</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">配置哨兵监听服务器地址</span></span><br><span class=\"line\">sentinel monitor 6379[别名] 127.0.0.1[服务器地址] 6379[端口] 1[有几个哨兵服务认为主机挂了才切换]</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"启动哨兵\"><a href=\"#启动哨兵\" class=\"headerlink\" title=\"启动哨兵\"></a>启动哨兵</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@10-7-189-100 ~]# redis-sentinel redis_sentinel.conf</span><br></pre></td></tr></table></figure>\n\n<p>可以自己去启几个redis服务模拟一下 master挂了之后 哨兵是如何切换master的.</p>\n","categories":["redis"],"tags":["redis","主从复制"]},{"title":"YAML的基本语法，以及每个语法元素与Python语法的对应示例","url":"/post/a547ee48.html","content":"<p>YAML（YAML Ain’t Markup Language）是一种人类可读的数据序列化格式，通常用于配置文件和数据交换。YAML以清晰、简洁和易于阅读的方式表示数据，并且常被用于各种编程语言的配置文件和数据交换格式。</p>\n<span id=\"more\"></span>\n\n<h3 id=\"YAML的基本语法规则：\"><a href=\"#YAML的基本语法规则：\" class=\"headerlink\" title=\"YAML的基本语法规则：\"></a>YAML的基本语法规则：</h3><ul>\n<li>YAML的数据是键值对（key-value）的形式，采用冒号（:）分隔键和值。</li>\n<li>YAML使用缩进表示层级关系。缩进时不允许使用Tab键，只允许使用空格。缩进的空格数不重要，但同级元素必须左侧对齐。</li>\n<li>YAML支持多种数据类型，包括对象、数组、纯量等。</li>\n</ul>\n<h3 id=\"YAML的数据类型\"><a href=\"#YAML的数据类型\" class=\"headerlink\" title=\"YAML的数据类型:\"></a>YAML的数据类型:</h3><p><strong>1.简单值：</strong> YAML中的简单值可以是字符串、整数、浮点数、布尔值或null。</p>\n<p>YAML示例：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">codename:</span> <span class=\"string\">John</span></span><br><span class=\"line\"><span class=\"attr\">age:</span> <span class=\"number\">30</span></span><br><span class=\"line\"><span class=\"attr\">is_student:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<p>对应Python示例：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"> codedata = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;John&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;age&#x27;</span>: <span class=\"number\">30</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;is_student&#x27;</span>: <span class=\"literal\">True</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>2. 列表：</strong> YAML中的列表使用横杠（-）表示，可以包含多个元素。</p>\n<p>YAML示例：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">codefruits:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">apple</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">banana</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">orange</span></span><br></pre></td></tr></table></figure>\n\n<p>对应Python示例：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">codedata = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;fruits&#x27;</span>: [<span class=\"string\">&#x27;apple&#x27;</span>, <span class=\"string\">&#x27;banana&#x27;</span>, <span class=\"string\">&#x27;orange&#x27;</span>]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>3. 嵌套结构：</strong> YAML允许嵌套的数据结构，如字典中嵌套列表或其他字典。</p>\n<p>YAML示例：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">codeperson:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">Alice</span></span><br><span class=\"line\">  <span class=\"attr\">address:</span></span><br><span class=\"line\">    <span class=\"attr\">street:</span> <span class=\"number\">123</span> <span class=\"string\">Main</span> <span class=\"string\">St</span></span><br><span class=\"line\">    <span class=\"attr\">city:</span> <span class=\"string\">Anytown</span></span><br></pre></td></tr></table></figure>\n\n<p>对应Python示例：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">codedata = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;person&#x27;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;name&#x27;</span>: <span class=\"string\">&#x27;Alice&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;address&#x27;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&#x27;street&#x27;</span>: <span class=\"string\">&#x27;123 Main St&#x27;</span>,</span><br><span class=\"line\">            <span class=\"string\">&#x27;city&#x27;</span>: <span class=\"string\">&#x27;Anytown&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>4. 多行文本：</strong> YAML支持多行文本的表示，可以使用<code>|</code>表示保留换行符，或者<code>&gt;</code>表示折叠换行符。</p>\n<p>YAML示例：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">codedescription:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">  This is a multi-line</span></span><br><span class=\"line\"><span class=\"string\">  description in YAML.</span></span><br></pre></td></tr></table></figure>\n\n<p>对应Python示例：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">codedata = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;description&#x27;</span>: <span class=\"string\">&#x27;This is a multi-line\\ndescription in YAML.&#x27;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这些是YAML的一些基本语法元素和相应的Python示例。YAML还支持更复杂的数据结构和高级特性，具体语法取决于您的需求和应用场景。在Python中，您可以使用PyYAML等库来解析和生成YAML数据。</p>\n","categories":["yaml"],"tags":["yaml"]},{"title":"Vuex","url":"/post/db4c4335.html","content":"<h3 id=\"什么是Vuex\"><a href=\"#什么是Vuex\" class=\"headerlink\" title=\"什么是Vuex?\"></a>什么是Vuex?</h3><p>Vuex 是实现组件全局状态(数据)管理的一种机制,可以方便的实现组件之间的数据共享.</p>\n<p><img data-src=\"/../images/Vuex/image-20200710180830043.png\" alt=\"image-20200710180830043\"></p>\n<p>如何没有vuex,我们大范围的传值的时候会十分麻烦,而有了vuex 我们只需要跟store相互就可以了</p>\n<p>当然我们也不是所有的数据都需要放到vuex中,有一些组件私有的数据,我们没有必要把他放到vuex中,只有组件之间共享的数据,才有必要放到vuex中.</p>\n<span id=\"more\"></span>\n\n<h3 id=\"使用vuex统一管理状态的优点\"><a href=\"#使用vuex统一管理状态的优点\" class=\"headerlink\" title=\"使用vuex统一管理状态的优点:\"></a>使用vuex统一管理状态的优点:</h3><ol>\n<li>能够在vuex中几种管理共享的数据,易于开发和维护.</li>\n<li>能够高效的实现组件之间的数据共享,提供开发效率.</li>\n<li>存储在vuex中的数据都是响应式的,能够实时保持数据与页面的同步</li>\n</ol>\n<h3 id=\"Vuex的基本使用\"><a href=\"#Vuex的基本使用\" class=\"headerlink\" title=\"Vuex的基本使用\"></a>Vuex的基本使用</h3><h4 id=\"安装vuex依赖包\"><a href=\"#安装vuex依赖包\" class=\"headerlink\" title=\"安装vuex依赖包\"></a>安装vuex依赖包</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install vuex --save</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">当然你也可以用 cnpm</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"导入vuex包\"><a href=\"#导入vuex包\" class=\"headerlink\" title=\"导入vuex包\"></a>导入vuex包</h4><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Vue</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;vue&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Vuex</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;vuex&quot;</span>;</span><br><span class=\"line\"><span class=\"comment\">//将vuex放入vue中</span></span><br><span class=\"line\"><span class=\"title class_\">Vue</span>.<span class=\"title function_\">use</span>(<span class=\"title class_\">Vuex</span>);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"创建store对象\"><a href=\"#创建store对象\" class=\"headerlink\" title=\"创建store对象\"></a>创建store对象</h4><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Vuex</span>.<span class=\"title class_\">Store</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">state</span>: &#123;&#125;,</span><br><span class=\"line\">  <span class=\"attr\">mutations</span>: &#123;&#125;,</span><br><span class=\"line\">  <span class=\"attr\">actions</span>: &#123;&#125;,</span><br><span class=\"line\">  <span class=\"attr\">modules</span>: &#123;&#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"将store对象挂载到vue实例中\"><a href=\"#将store对象挂载到vue实例中\" class=\"headerlink\" title=\"将store对象挂载到vue实例中\"></a>将store对象挂载到vue实例中</h4><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Vue</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;vue&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">App</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;./App.vue&quot;</span>;</span><br><span class=\"line\"><span class=\"comment\">// 导入store组件中的store实例对象</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> store <span class=\"keyword\">from</span> <span class=\"string\">&quot;./store&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Vue</span>.<span class=\"property\">config</span>.<span class=\"property\">productionTip</span> = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"title class_\">Vue</span>(&#123;</span><br><span class=\"line\">  <span class=\"comment\">//将创建的共享数据对象,挂载到vue实例中</span></span><br><span class=\"line\">  <span class=\"comment\">//所有组件都可以从store中获取数据</span></span><br><span class=\"line\">  store,</span><br><span class=\"line\">  <span class=\"attr\">render</span>: <span class=\"function\"><span class=\"params\">h</span> =&gt;</span> <span class=\"title function_\">h</span>(<span class=\"title class_\">App</span>)</span><br><span class=\"line\">&#125;).$mount(<span class=\"string\">&quot;#app&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"vuex的核心概念\"><a href=\"#vuex的核心概念\" class=\"headerlink\" title=\"vuex的核心概念\"></a>vuex的核心概念</h3><h4 id=\"State\"><a href=\"#State\" class=\"headerlink\" title=\"State\"></a>State</h4><p>提供唯一的公共数据源,所有的共享数据都统一放到Store的state中进行存储</p>\n<h5 id=\"声明数据\"><a href=\"#声明数据\" class=\"headerlink\" title=\"声明数据\"></a>声明数据</h5><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Vuex</span>.<span class=\"title class_\">Store</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">state</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">count</span>: <span class=\"number\">0</span></span><br><span class=\"line\">    &#125;,</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"组件访问state中的数据\"><a href=\"#组件访问state中的数据\" class=\"headerlink\" title=\"组件访问state中的数据\"></a>组件访问state中的数据</h5><p>第一种方式:this.$store.state.全局数据名称</p>\n<p>第二种方式:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//从vuex中按需导入mapState 函数</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;mapState&#125; <span class=\"keyword\">from</span>  <span class=\"string\">&#x27;vuex&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">//通过刚才导入的mapState函数,将当前组件需要的全局数据,映射为当前组件的computed计算属性</span></span><br><span class=\"line\"><span class=\"attr\">computed</span>:&#123;</span><br><span class=\"line\">    <span class=\"comment\">//通过展开运算符映射成计算属性</span></span><br><span class=\"line\">    ...<span class=\"title function_\">mapState</span>([<span class=\"string\">&#x27;count&#x27;</span>])</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Moutation\"><a href=\"#Moutation\" class=\"headerlink\" title=\"Moutation\"></a>Moutation</h4><p>用于变更Store中的数据. 不能写异步的代码!!!</p>\n<ol>\n<li>只能通过mutation变更Store数据,不可以直接操作Store中的数据</li>\n<li>通过这种方式虽然操作起来比较繁琐,但是可以集中监控所有数据的变化</li>\n</ol>\n<p>第一种调用方式</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Vuex</span>.<span class=\"title class_\">Store</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">state</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">count</span>: <span class=\"number\">0</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">//定义mutations</span></span><br><span class=\"line\">    <span class=\"attr\">mutations</span>: &#123;</span><br><span class=\"line\">        <span class=\"title function_\">add</span>(<span class=\"params\">state</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//变更状态</span></span><br><span class=\"line\">            state.<span class=\"property\">count</span> += <span class=\"number\">1</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"><span class=\"comment\">//在相应的组件中调用</span></span><br><span class=\"line\"> <span class=\"attr\">methods</span>: &#123;</span><br><span class=\"line\">    <span class=\"title function_\">addCount</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//通过commit触发</span></span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"property\">$store</span>.<span class=\"title function_\">commit</span>(<span class=\"string\">&#x27;add&#x27;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>添加参数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Vuex</span>.<span class=\"title class_\">Store</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">state</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">count</span>: <span class=\"number\">0</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">//定义mutations</span></span><br><span class=\"line\">    <span class=\"attr\">mutations</span>: &#123;</span><br><span class=\"line\">        <span class=\"title function_\">addN</span>(<span class=\"params\">state,step</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//变更状态</span></span><br><span class=\"line\">            state.<span class=\"property\">count</span> += step</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"><span class=\"comment\">//在相应的组件中调用</span></span><br><span class=\"line\"> <span class=\"attr\">methods</span>: &#123;</span><br><span class=\"line\">    <span class=\"title function_\">addCount</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//通过commit触发</span></span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"property\">$store</span>.<span class=\"title function_\">commit</span>(<span class=\"string\">&#x27;add&#x27;</span>,<span class=\"variable language_\">this</span>.<span class=\"property\">step</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>第二种调用方式</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">    <span class=\"comment\">//定义mutations</span></span><br><span class=\"line\">    <span class=\"attr\">mutations</span>: &#123;</span><br><span class=\"line\">        <span class=\"title function_\">add</span>(<span class=\"params\">state</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//变更状态</span></span><br><span class=\"line\">            state.<span class=\"property\">count</span> += <span class=\"number\">1</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"title function_\">addN</span>(<span class=\"params\">state, step</span>) &#123;</span><br><span class=\"line\">            state.<span class=\"property\">count</span> += step</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"title function_\">sub</span>(<span class=\"params\">state</span>) &#123;</span><br><span class=\"line\">            state.<span class=\"property\">count</span> -= <span class=\"number\">1</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">        </span><br><span class=\"line\"> <span class=\"comment\">//在相应的组件中导入mapMutations</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; mapMutations &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vuex&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">//在methods中通过...映射为当前组件的methods方法</span></span><br><span class=\"line\"><span class=\"attr\">methods</span>: &#123;</span><br><span class=\"line\">    ...<span class=\"title function_\">mapMutations</span>([<span class=\"string\">&#x27;sub&#x27;</span>])</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"comment\">//有参数的话 可以再定义一个函数,来调用this.subN(参数)</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Action\"><a href=\"#Action\" class=\"headerlink\" title=\"Action\"></a>Action</h4><p>我们刚才说过Mutation中不能执行异步操作,那么我们如果要用异步操作怎么办?这时候就需要用到action了</p>\n<p>第一种方式:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//定义action</span></span><br><span class=\"line\">    <span class=\"attr\">actions</span>: &#123;</span><br><span class=\"line\">        <span class=\"title function_\">addAsync</span>(<span class=\"params\">context</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">//不能直接修改state中的数据,必须通过Mutation中的函数</span></span><br><span class=\"line\">                context.<span class=\"title function_\">commit</span>(<span class=\"string\">&#x27;add&#x27;</span>)</span><br><span class=\"line\">            &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">        </span><br><span class=\"line\"><span class=\"comment\">//在相应组件中使用与Mutation类似,通过this.$store.dispatch</span></span><br><span class=\"line\">  <span class=\"title function_\">addAsync</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"property\">$store</span>.<span class=\"title function_\">dispatch</span>(<span class=\"string\">&#x27;addAsync&#x27;</span>)</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>第二种方式:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">subAsync</span>(<span class=\"params\">context</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                context.<span class=\"title function_\">commit</span>(<span class=\"string\">&#x27;sub&#x27;</span>)</span><br><span class=\"line\">            &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"> <span class=\"comment\">//在相应的组件中导入mapMutations</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; mapActions &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vuex&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">//在methods中通过...映射为当前组件的methods方法</span></span><br><span class=\"line\"><span class=\"attr\">methods</span>: &#123;</span><br><span class=\"line\">    ...<span class=\"title function_\">mapActions</span>([<span class=\"string\">&#x27;sub&#x27;</span>])</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Getter\"><a href=\"#Getter\" class=\"headerlink\" title=\"Getter\"></a>Getter</h4><p>Getter 用于对Store 中的数据进行加工处理形成新的数据.</p>\n<ol>\n<li>Getter 可以对Store中已有数据加工处理之后形成新的数据,类似Vue的计算属性</li>\n<li>Store中数据发生变化,Getter的数据也跟着变化</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//定义Getter</span></span><br><span class=\"line\">  <span class=\"attr\">getters</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">showNum</span>: <span class=\"function\"><span class=\"params\">state</span> =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">`当前最新的数字:<span class=\"subst\">$&#123;state.count&#125;</span>`</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"><span class=\"comment\">//当然调用也有两种</span></span><br><span class=\"line\"><span class=\"number\">1.</span>使用<span class=\"variable language_\">this</span>.<span class=\"property\">$store</span>.<span class=\"property\">getters</span>.名称</span><br><span class=\"line\"><span class=\"number\">2.</span>导入 mapGetters </span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; mapGetters &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vuex&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">computed</span>: &#123;</span><br><span class=\"line\">    ...<span class=\"title function_\">mapGetters</span>([<span class=\"string\">&#x27;showNum&#x27;</span>])</span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Module\"><a href=\"#Module\" class=\"headerlink\" title=\"Module\"></a>Module</h4><p>由于使用单一状态树，应用的所有状态会集中到一个比较大的对象。当应用变得非常复杂时，store 对象就有可能变得相当臃肿。</p>\n<p>为了解决以上问题，Vuex 允许我们将 store 分割成<strong>模块（module）</strong>。每个模块拥有自己的 state、mutation、action、getter、甚至是嵌套子模块——从上至下进行同样方式的分割：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> moduleA = &#123;</span><br><span class=\"line\">  <span class=\"attr\">state</span>: <span class=\"function\">() =&gt;</span> (&#123; ... &#125;),</span><br><span class=\"line\">  <span class=\"attr\">mutations</span>: &#123; ... &#125;,</span><br><span class=\"line\">  <span class=\"attr\">actions</span>: &#123; ... &#125;,</span><br><span class=\"line\">  <span class=\"attr\">getters</span>: &#123; ... &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> moduleB = &#123;</span><br><span class=\"line\">  <span class=\"attr\">state</span>: <span class=\"function\">() =&gt;</span> (&#123; ... &#125;),</span><br><span class=\"line\">  <span class=\"attr\">mutations</span>: &#123; ... &#125;,</span><br><span class=\"line\">  <span class=\"attr\">actions</span>: &#123; ... &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> store = <span class=\"keyword\">new</span> <span class=\"title class_\">Vuex</span>.<span class=\"title class_\">Store</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">modules</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">a</span>: moduleA,</span><br><span class=\"line\">    <span class=\"attr\">b</span>: moduleB</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">store.<span class=\"property\">state</span>.<span class=\"property\">a</span> <span class=\"comment\">// -&gt; moduleA 的状态</span></span><br><span class=\"line\">store.<span class=\"property\">state</span>.<span class=\"property\">b</span> <span class=\"comment\">// -&gt; moduleB 的状态</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"项目结构\"><a href=\"#项目结构\" class=\"headerlink\" title=\"项目结构\"></a>项目结构</h3><p>Vuex 并不限制你的代码结构。但是，它规定了一些需要遵守的规则：</p>\n<ol>\n<li>应用层级的状态应该集中到单个 store 对象中。</li>\n<li>提交 <strong>mutation</strong> 是更改状态的唯一方法，并且这个过程是同步的。</li>\n<li>异步逻辑都应该封装到 <strong>action</strong> 里面。</li>\n</ol>\n<p>只要你遵守以上规则，如何组织代码随你便。如果你的 store 文件太大，只需将 action、mutation 和 getter 分割到单独的文件。</p>\n<p>对于大型应用，我们会希望把 Vuex 相关代码分割到模块中。下面是项目结构示例：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">├── index.<span class=\"property\">html</span></span><br><span class=\"line\">├── main.<span class=\"property\">js</span></span><br><span class=\"line\">├── api</span><br><span class=\"line\">│   └── ... # 抽取出<span class=\"variable constant_\">API</span>请求</span><br><span class=\"line\">├── components</span><br><span class=\"line\">│   ├── <span class=\"title class_\">App</span>.<span class=\"property\">vue</span></span><br><span class=\"line\">│   └── ...</span><br><span class=\"line\">└── store</span><br><span class=\"line\">    ├── index.<span class=\"property\">js</span>          # 我们组装模块并导出 store 的地方</span><br><span class=\"line\">    ├── actions.<span class=\"property\">js</span>        # 根级别的 action</span><br><span class=\"line\">    ├── mutations.<span class=\"property\">js</span>      # 根级别的 mutation</span><br><span class=\"line\">    └── modules</span><br><span class=\"line\">        ├── cart.<span class=\"property\">js</span>       # 购物车模块</span><br><span class=\"line\">        └── products.<span class=\"property\">js</span>   # 产品模块</span><br></pre></td></tr></table></figure>\n\n<p>参考官网文档:<a href=\"https://vuex.vuejs.org/zh/installation.html\">https://vuex.vuejs.org/zh/installation.html</a></p>\n","categories":["vuex"],"tags":["vue","vuex"]},{"title":"django配置离线脚本","url":"/post/ef5a7802.html","content":"<p>有些时候我们需要在不启动<code>django</code>的时候通过ORM操作数据,所以我们就需要配置离线脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> django</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 获取项目的根目录</span></span><br><span class=\"line\">base_dir = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class=\"line\"><span class=\"comment\"># 添加到系统环境变量</span></span><br><span class=\"line\">sys.path.append(base_dir)</span><br><span class=\"line\"><span class=\"comment\"># 加载项目的配置文件</span></span><br><span class=\"line\">os.environ.setdefault(<span class=\"string\">&quot;DJANGO_SETTINGS_MODULE&quot;</span>, <span class=\"string\">&quot;项目.settings&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\"># 启动django</span></span><br><span class=\"line\">django.setup()</span><br></pre></td></tr></table></figure>\n","categories":["Django"],"tags":["Django","脚本"]},{"title":"docker-compose安装gitlab","url":"/post/a6b516b8.html","content":"<p><code>docker-compose</code> 是一个用于定义和运行多个 Docker 容器的工具，它通过一个单独的配置文件来管理和组织多个容器的部署。使用 <code>docker-compose</code>，您可以轻松地定义一个包含多个服务的应用程序，每个服务可以运行在一个独立的 Docker 容器中，然后通过一个命令就可以启动、停止和管理整个应用程序的容器。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"docker-compose安装\"><a href=\"#docker-compose安装\" class=\"headerlink\" title=\"docker-compose安装\"></a>docker-compose安装</h2><p>具体查看<a href=\"https://docs.docker.com.zh.xy2401.com/compose/install/\">https://docs.docker.com.zh.xy2401.com/compose/install/</a></p>\n<h2 id=\"docker-compose-基本使用\"><a href=\"#docker-compose-基本使用\" class=\"headerlink\" title=\"docker-compose 基本使用\"></a>docker-compose 基本使用</h2><p>以下是一些关键概念和 <code>docker-compose</code> 的基本使用方法：</p>\n<p><strong>关键概念：</strong></p>\n<ol>\n<li>**服务 (Service)**：一个服务对应一个应用程序的组件，通常运行在一个独立的 Docker 容器中。例如，一个 web 应用程序可能包括一个后端服务和一个前端服务。</li>\n<li>**容器 (Container)**：Docker 容器是一个独立的运行环境，包含应用程序及其依赖。<code>docker-compose</code> 允许您定义和管理多个容器。</li>\n<li><strong>docker-compose.yml 文件</strong>：这是 <code>docker-compose</code> 的配置文件，使用 YAML 格式编写。在这个文件中，您可以定义需要的服务、它们的镜像、容器设置、网络配置等信息。</li>\n</ol>\n<p><strong>基本使用方法：</strong></p>\n<ol>\n<li><strong>安装 Docker 和 Docker Compose</strong>：首先，确保您的系统上已经安装了 Docker 和 Docker Compose。您可以从 Docker 官方网站上获得安装指南。</li>\n<li><strong>创建 docker-compose.yml 文件</strong>：在您的项目根目录中创建一个名为 <code>docker-compose.yml</code> 的文件。</li>\n<li><strong>编写配置</strong>：在 <code>docker-compose.yml</code> 文件中，您可以定义您的各个服务。以下是一个简单的示例：</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">yamlCopy codeversion: &#x27;3&#x27;</span><br><span class=\"line\">services:</span><br><span class=\"line\">  web:</span><br><span class=\"line\">    image: nginx:latest</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;80:80&quot;</span><br><span class=\"line\">  database:</span><br><span class=\"line\">    image: mysql:latest</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      MYSQL_ROOT_PASSWORD: example</span><br></pre></td></tr></table></figure>\n\n<p>在这个示例中，我们定义了两个服务：<code>web</code> 和 <code>database</code>。<code>web</code> 服务使用最新版本的 Nginx 镜像，并将主机的 80 端口映射到容器的 80 端口。<code>database</code> 服务使用最新版本的 MySQL 镜像，并设置了一个环境变量以配置 MySQL 的 root 密码。</p>\n<ol>\n<li><strong>运行应用程序</strong>：在项目目录中，打开终端并运行以下命令来启动应用程序：</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker-compose up</span><br></pre></td></tr></table></figure>\n\n<p>这将会根据配置文件创建并启动定义的服务。</p>\n<ol>\n<li><strong>停止应用程序</strong>：要停止应用程序，只需在终端中按下 <code>Ctrl + C</code>，或者在另一个终端中运行以下命令：</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker-compose down</span><br></pre></td></tr></table></figure>\n\n<p>这将停止并移除所有相关的容器、网络和卷。</p>\n<h2 id=\"gitlab安装\"><a href=\"#gitlab安装\" class=\"headerlink\" title=\"gitlab安装\"></a>gitlab安装</h2><p>创建<code>gitlab_docker</code>目录,并在下面创建<code>docker-compose.yml</code>文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]<span class=\"comment\"># cd  /usr/local/</span></span><br><span class=\"line\">[root@localhost <span class=\"built_in\">local</span>]<span class=\"comment\"># mkdir docker/</span></span><br><span class=\"line\">[root@localhost <span class=\"built_in\">local</span>]<span class=\"comment\"># cd docker/</span></span><br><span class=\"line\">[root@localhost docker]<span class=\"comment\"># mkdir gitlab_docker/</span></span><br><span class=\"line\">[root@localhost docker]<span class=\"comment\"># cd gitlab_docker/</span></span><br><span class=\"line\">[root@localhost gitlab_docker]<span class=\"comment\"># vim docker-compose.yml </span></span><br></pre></td></tr></table></figure>\n\n<p>当然需要先拉去镜像,我这边用的是中文版的gitlab</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker pull twang2218/gitlab-ce-zh:latest</span><br></pre></td></tr></table></figure>\n\n\n\n<p>打开<code>docker-compose.yml</code></p>\n<figure class=\"highlight yml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&#x27;3.1&#x27;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">gitlab:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">&#x27;twang2218/gitlab-ce-zh:latest&#x27;</span></span><br><span class=\"line\">\t<span class=\"attr\">container_name:</span> <span class=\"string\">gitlab</span></span><br><span class=\"line\">\t<span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">\t  <span class=\"attr\">GITLAB_OMNIBUS_CONFIG:</span> <span class=\"string\">|</span></span><br><span class=\"line\">\t    <span class=\"string\">external_url</span> <span class=\"string\">&#x27;http://192.168.205.252:8929&#x27;</span></span><br><span class=\"line\">\t\t<span class=\"string\">gitlab_rails[&#x27;gitlab_shell_ssh_port&#x27;]</span> <span class=\"string\">=</span> <span class=\"number\">2224</span></span><br><span class=\"line\">\t<span class=\"attr\">ports:</span></span><br><span class=\"line\">\t  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;8929:8929&#x27;</span></span><br><span class=\"line\">\t  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;2224:2224&#x27;</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./config:/etc/gitlab&#x27;</span></span><br><span class=\"line\">\t  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./logs:/var/log/gitlab&#x27;</span></span><br><span class=\"line\">\t  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;./data:/var/opt/gitlab&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>运行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker-compose up -d</span><br></pre></td></tr></table></figure>\n\n","categories":["gitlab"],"tags":["gitlab","docker-compose"]},{"title":"elasticsearch","url":"/post/60537c10.html","content":"<p>Elasticsearch 是一个分布式、RESTful 风格的搜索和数据分析引擎，能够解决不断涌现出的各种用例。 作为 Elastic Stack 的核心，它集中存储您的数据，帮助您发现意料之中以及意料之外的情况</p>\n<span id=\"more\"></span>\n\n<h2 id=\"docker安装es\"><a href=\"#docker安装es\" class=\"headerlink\" title=\"docker安装es\"></a>docker安装es</h2><p>因为elasticsearch是java写的需要安装java虚拟机，所以我们这里推荐用docker进行安装。</p>\n<h3 id=\"拉取镜像\"><a href=\"#拉取镜像\" class=\"headerlink\" title=\"拉取镜像\"></a>拉取镜像</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">这里我们拉取7.12.1</span></span><br><span class=\"line\">docker pull elasticsearch:7.12.1</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/elasticsearch/image-20210530143835569.png\" alt=\"image-20210530143835569\"></p>\n<h3 id=\"运行容器\"><a href=\"#运行容器\" class=\"headerlink\" title=\"运行容器\"></a>运行容器</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker run -d --name es -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; b0e9f9f047e6</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">-d: 在后台运行</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">--name: 别名</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">-p: 映射端口号</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">-e:discovery.type=single-node：单机运行</span></span><br></pre></td></tr></table></figure>\n\n<p>然后就可以在浏览器中查看，我们键入127.0.0.1:9200</p>\n<p><img data-src=\"/../images/elasticsearch/image-20210530145904787.png\" alt=\"image-20210530145904787\"></p>\n<p><img data-src=\"/../images/elasticsearch/image-20210530145944925.png\" alt=\"image-20210530145944925\"></p>\n<h3 id=\"配置跨域\"><a href=\"#配置跨域\" class=\"headerlink\" title=\"配置跨域\"></a>配置跨域</h3><p>我们进入es的docker容器中</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker exec -it es /bin/bash</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">找到配置文件</span></span><br><span class=\"line\">[root@e0cfd719797d elasticsearch]# vi config/elasticsearch.yml</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">在末尾添加如下两行，注意冒号后面需要加上空格</span></span><br><span class=\"line\">http.cors.enabled: true</span><br><span class=\"line\">http.cors.allow-origin: &quot;*&quot;</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">保存退出</span></span><br><span class=\"line\">:wq</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">重启es容器</span></span><br><span class=\"line\">docker restart es</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/elasticsearch/image-20210530150640434.png\" alt=\"image-20210530150640434\"></p>\n<h3 id=\"安装ik分词器\"><a href=\"#安装ik分词器\" class=\"headerlink\" title=\"安装ik分词器\"></a>安装ik分词器</h3><p>es自带的分词器对中文分词不是很友好，所以我们下载开源的IK分词器来解决这个问题。首先进入到plugins目录中下载分词器，下载完成后然后解压，再重启es即可。具体步骤如下:<br><strong>注意：</strong>elasticsearch的版本和ik分词器的版本需要保持一致，不然在重启的时候会失败。可以在这查看所有版本，选择合适自己版本的右键复制链接地址即可。<a href=\"https://aichh.com/redirect/aHR0cHM6Ly9naXRodWIuY29tL21lZGNsL2VsYXN0aWNzZWFyY2gtYW5hbHlzaXMtaWsvcmVsZWFzZXM=\">点击这里</a></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">进入容器</span></span><br><span class=\"line\">docker exec -it es /bin/bash</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">进入plugins目录</span></span><br><span class=\"line\">cd /usr/share/elasticsearch/plugins/ </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">执行</span></span><br><span class=\"line\">elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.12.1/elasticsearch-analysis-ik-7.12.1.zip </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">退出容器</span></span><br><span class=\"line\">exit</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">重启</span></span><br><span class=\"line\">docker restart es</span><br></pre></td></tr></table></figure>\n\n<p>我们可以用postman 试一下</p>\n<p><img data-src=\"/../images/elasticsearch/image-20210530151905035.png\" alt=\"image-20210530151905035\"></p>\n<p>不加ik分词的话是把每个词都分开了。然后我们加上中文分词</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tokens&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;token&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;测&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;start_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;end_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;&lt;IDEOGRAPHIC&gt;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;position&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;token&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;试&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;start_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;end_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;&lt;IDEOGRAPHIC&gt;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;position&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;token&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;一&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;start_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;end_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">3</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;&lt;IDEOGRAPHIC&gt;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;position&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;token&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;下&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;start_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">3</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;end_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">4</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;&lt;IDEOGRAPHIC&gt;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;position&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">3</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;token&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;中&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;start_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">4</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;end_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">5</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;&lt;IDEOGRAPHIC&gt;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;position&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">4</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;token&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;文&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;start_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">5</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;end_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">6</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;&lt;IDEOGRAPHIC&gt;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;position&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">5</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;token&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;分&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;start_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">6</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;end_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">7</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;&lt;IDEOGRAPHIC&gt;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;position&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">6</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;token&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;词&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;start_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">7</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;end_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">8</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;&lt;IDEOGRAPHIC&gt;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;position&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">7</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>不加ik分词的话是把每个词都分开了。然后我们加上中文分词</p>\n<p><img data-src=\"/../images/elasticsearch/image-20210530152041731.png\" alt=\"image-20210530152041731\"></p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tokens&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;token&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;测试&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;start_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;end_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;CN_WORD&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;position&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;token&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;试一下&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;start_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;end_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">4</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;CN_WORD&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;position&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;token&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;一下&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;start_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;end_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">4</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;CN_WORD&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;position&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;token&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;一&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;start_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;end_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">3</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;TYPE_CNUM&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;position&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">3</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;token&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;下&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;start_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">3</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;end_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">4</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;COUNT&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;position&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">4</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;token&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;中文&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;start_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">4</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;end_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">6</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;CN_WORD&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;position&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">5</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;token&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;分词&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;start_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">6</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;end_offset&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">8</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;CN_WORD&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;position&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">6</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>可以看到效果对比很明显。</p>\n<h3 id=\"kibana安装\"><a href=\"#kibana安装\" class=\"headerlink\" title=\"kibana安装\"></a>kibana安装</h3><p>Kibana 是一款开源的数据分析和可视化平台，它是 Elastic Stack 成员之一，设计用于和 Elasticsearch 协作。您可以使用 Kibana 对 Elasticsearch 索引中的数据进行搜索、查看、交互操作。您可以很方便的利用图表、表格及地图对数据进行多元化的分析和呈现。</p>\n<p>Kibana 可以使大数据通俗易懂。它很简单，基于浏览器的界面便于您快速创建和分享动态数据仪表板来追踪 Elasticsearch 的实时数据变化。</p>\n<p>搭建 Kibana 非常简单。您可以分分钟完成 Kibana 的安装并开始探索 Elasticsearch 的索引数据 — 没有代码、不需要额外的基础设施。</p>\n<p>这里一定要注意！！！！</p>\n<p>Kibana 的版本需要和 Elasticsearch 的版本一致。这是官方支持的配置。</p>\n<h4 id=\"拉取镜像-1\"><a href=\"#拉取镜像-1\" class=\"headerlink\" title=\"拉取镜像\"></a>拉取镜像</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">docker 安装</span></span><br><span class=\"line\">docker pull docker.elastic.co/kibana/kibana:7.12.1</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"配置kibana-yml\"><a href=\"#配置kibana-yml\" class=\"headerlink\" title=\"配置kibana.yml\"></a>配置kibana.yml</h5><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">创建配置文件目录</span></span><br><span class=\"line\">mkdir -p ~/docker/kibana/config</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">进入该目录</span></span><br><span class=\"line\">cd ~/docker/kibana/config/</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">创建并写入配置文件</span> </span><br><span class=\"line\">vim kibana.yml</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\"><span class=\"comment\"># ** THIS IS AN AUTO-GENERATED FILE **</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\"></span><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Default Kibana configuration <span class=\"keyword\">for</span> docker target</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">kibana的服务名称</span></span><br><span class=\"line\">server.name: kibana</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">kibana的主机地址</span></span><br><span class=\"line\">server.host: &quot;0&quot;</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">elasticsearch的主机IP</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">这里填入你的外网地址，因为是在docker容器里面，如果填回环地址的话就有问题</span></span><br><span class=\"line\">elasticsearch.hosts: [ &quot;http://es_ip:9200&quot; ]</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">配置中文</span></span><br><span class=\"line\">i18n.locale: &quot;zh-CN&quot;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"运行容器-1\"><a href=\"#运行容器-1\" class=\"headerlink\" title=\"运行容器\"></a>运行容器</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker run -d \\</span><br><span class=\"line\">  --name=kibana \\</span><br><span class=\"line\">  --restart=always \\</span><br><span class=\"line\">  -p 5601:5601 \\</span><br><span class=\"line\">  -v ~/docker/kibana/config/kibana.yml:/usr/share/kibana/config/kibana.yml \\</span><br><span class=\"line\">  kibana:7.12.1</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"访问页面\"><a href=\"#访问页面\" class=\"headerlink\" title=\"访问页面\"></a>访问页面</h4><p>输入:<code>http://127.0.0.1:5601/</code></p>\n<p>我们可以使用kibana来给es发送restfulAPI了</p>\n<p><img data-src=\"/../images/elasticsearch/image-20210530195642885.png\" alt=\"image-20210530195642885\"></p>\n<p>具体es如何操作，这里我推荐一下这个为老哥的ElasticSerach 7 教程 <a href=\"https://github.com/xr2117/ElasticSearch7\">github</a></p>\n","categories":["search"],"tags":["搜素"]},{"title":"jupyter的使用","url":"/post/eabfeb42.html","content":"<ol>\n<li>Jupyter是基于网页形式的、结合了编写说明文档、数学公式、交互计算和其他富媒体形式的工具等，基本常用的开发工具里面都包含了。</li>\n<li>Jupyter里面编写的内容都可以以文档形式输出，默认保存的后缀名为<code>.ipynb</code>的<code>JSON</code>格式文件，还可以导出为：HTML、PDF、MarkDown、Python等格式。</li>\n</ol>\n<span id=\"more\"></span>\n\n<h2 id=\"安装jupyter\"><a href=\"#安装jupyter\" class=\"headerlink\" title=\"安装jupyter\"></a>安装jupyter</h2><p>在终端窗口输入<code>pip install jupyter notebook</code></p>\n<p>当然你也可以再后面加 豆瓣源 <code>-i http://pypi.douban.com/simple/</code></p>\n<h2 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h2><p>装完后 在命令行输入 <code>jupyter notebook</code> 就能启动</p>\n<ul>\n<li>打开地址为当前bash的目录，默认的根目录</li>\n<li>浏览器地址为<a href=\"http://localhost:8888/\">http://localhost:8888/</a></li>\n<li>通过control -C终止jupyter程序</li>\n</ul>\n<h2 id=\"基本使用\"><a href=\"#基本使用\" class=\"headerlink\" title=\"基本使用\"></a><strong>基本使用</strong></h2><p><img data-src=\"/../images/jupyter%E7%9A%84%E4%BD%BF%E7%94%A8/641.png\" alt=\"图片\"></p>\n<p><img data-src=\"/../images/jupyter%E7%9A%84%E4%BD%BF%E7%94%A8/641-16564684699623.png\" alt=\"图片\"></p>\n<p>在Jupyter中创建的文件默认扩展名是: .ipynb,可以新建Python3文件或者打开原来创建的文件,打开之后如下</p>\n<p><img data-src=\"/../images/jupyter%E7%9A%84%E4%BD%BF%E7%94%A8/641-16564684850256.png\" alt=\"图片\"></p>\n<p>上图基本说明了新建文档的基本结构，特别说明的是“单元格状态”，有代码，Markdown，原生NBconvert，标题。最常用的是前两个，分别是代码状态和Markdown状态。</p>\n<p>一般新建的文档都会以Untitled+数字进行命名，比如Untitled1、Untitled2….,可以通过点击左上方的名字进行重命名。</p>\n<p><img data-src=\"/../images/jupyter%E7%9A%84%E4%BD%BF%E7%94%A8/641-16564685056729.png\" alt=\"图片\"></p>\n<p>在菜单File中可以进行新建、打开、重命名、保存、设置保存点、下载文件等操作。</p>\n<p><img data-src=\"/../images/jupyter%E7%9A%84%E4%BD%BF%E7%94%A8/641-165646851823712.png\" alt=\"图片\"></p>\n<p>其中Downloads as，通常是将当前文件进行其他格式保存的时候选择，可以存储为pdf、md、py等格式</p>\n<p><img data-src=\"/../images/jupyter%E7%9A%84%E4%BD%BF%E7%94%A8/641-165646854040215.png\" alt=\"图片\"></p>\n<p>默认juypter可以通过tab键进行代码的提示，如果想使用Pycharm一样的自动提示，可以添加代码自动补全的扩展。</p>\n<h2 id=\"常用的快捷键是\"><a href=\"#常用的快捷键是\" class=\"headerlink\" title=\"常用的快捷键是\"></a><strong>常用的快捷键是</strong></h2><p>Ctrl + Enter: 执行单元格代码</p>\n<p>Shift + Enter: 执行单元格代码并且移动到下一个单元格</p>\n<p>Alt + Enter: 执行单元格代码，新建并移动到下一个单元格</p>\n<p>这几个快捷键都是非常常用的。</p>\n<p>历史输入和输出变量</p>\n<p>当你写的单元格多了，肯定会注意到，IPython 中每一次的输入输出都有序号。你可以通过一下方法访问这些输入和输出：</p>\n<p>_：访问上一次输出</p>\n<p>__：访问上上一次输出</p>\n<p>_X：访问历史 X 行输出</p>\n<p>_iX：访问历史 X 行输入</p>\n<p>其中小写字母 “i”，代表 “in”。</p>\n<p>双击D：删除当前cell</p>\n<p>单击M：转为markdown文档</p>\n<p>markdown文档下运行变为预览模式</p>\n<p>shift + tab 函数用法全都有，从此不用再百度</p>\n<p>tab键，代码补全</p>\n<p>esc 后 b键，在下方插入单元；esc 后 a键，在上方插入单元</p>\n<p>esc 后 m键，进入markdown模式； esc后 y键 进入代码模式</p>\n<p>shift + tab + - ，代码分割到两个单元中</p>\n<p>esc 后 shift + m键，将当前单元和下方单元合并。这个是上边快捷键的反向操作，上边是分割，这个是合并</p>\n<p>esc 后 Z键，恢复删除的最后一个单元</p>\n<h2 id=\"帮助文档\"><a href=\"#帮助文档\" class=\"headerlink\" title=\"帮助文档\"></a>帮助文档</h2><h3 id=\"help\"><a href=\"#help\" class=\"headerlink\" title=\"help()\"></a>help()</h3><p><img data-src=\"/../images/jupyter%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220629103504416.png\" alt=\"image-20220629103504416\"></p>\n<h3 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用?\"></a>使用?</h3><p><img data-src=\"/../images/jupyter%E7%9A%84%E4%BD%BF%E7%94%A8/image-20220629103714563.png\" alt=\"image-20220629103714563\"></p>\n<p>此外，使用两个??可以把函数的源代码显示出来</p>\n<h2 id=\"魔法命令\"><a href=\"#魔法命令\" class=\"headerlink\" title=\"魔法命令\"></a>魔法命令</h2><p><code>%run *.py</code> : 运行外部python文件（默认是当前目录，最好加上绝对路径）</p>\n<p><code>%time statement</code> : 计算statement的运行时间</p>\n<p><code>%who</code> : 快速查看当前会话的所有变量与函数名称</p>\n<p><code>%whos</code> : 查看当前会话的所有变量与函数名称的详细信息</p>\n<p><code>lsmagic</code> : 列出所有魔法命令</p>\n","categories":["jupyter"],"tags":["数据分析","jupyter"]},{"title":"docker基础","url":"/post/5ae6092.html","content":"<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的容器中,然后发布到任何流行的<a href=\"https://baike.baidu.com/item/Linux\">Linux</a>机器或Windows 机器上,也可以实现虚拟化,容器是完全使用沙箱机制,相互之间不会有任何接口。</p>\n<p>Docker是基于Go语言实现的云开源项目</p>\n<p>Docker 的核心理念是 <code>Build, Ship, and Run Any App, Anywher</code>，即一次封装，到处运行。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"三大要素\"><a href=\"#三大要素\" class=\"headerlink\" title=\"三大要素\"></a>三大要素</h2><p>镜像(image)</p>\n<ul>\n<li>docker镜像（image）就是一个 只读 的模板。 镜像可以用来创建docker容器，一个镜像可以创建很多容器 。</li>\n</ul>\n<p>Docker 镜像可以看作是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。镜像不包含任何动态数据，其内容在构建之后也不会被改变。</p>\n<p><img data-src=\"/../images/docker%E5%9F%BA%E7%A1%80/v2-820aee2a33654099d87cdd2b7a1ce741_720w.jpg\" alt=\"img\"></p>\n<p><img data-src=\"/../images/docker%E5%9F%BA%E7%A1%80/v2-d5c06c456761b5a27090e3328b1f6882_720w.jpg\" alt=\"img\"></p>\n<p>总的来说，你最需要记住这点：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">在 Dockerfile 中， 每一条指令都会创建一个镜像层，继而会增加整体镜像的大小。</span><br></pre></td></tr></table></figure>\n\n<p>镜像作为 Docker 最突出的创新之一，它变革了软件交付标准。理解镜像，对理解整个 Docker 的生命周期非常重要。</p>\n<p>容器(container)</p>\n<ul>\n<li>docker利用容器（container）独立运行的一个或者一组应用。容器是利用镜像创建的运行实例（相对于Python中的类和对象的概念）。</li>\n<li>它可以被启动、开始、停止、删除。每个容器都是互相隔离的，保证安全的平台。</li>\n<li>可以把容器看做是一个简易版的Linux环境 (包括root用户名权限、进程空间、用户空间和网络空间等)和运行在其中的应用程序。</li>\n<li>容器的定义和镜像几乎是一模一样的，也是一堆层的统一视角， 唯一区别的是容器的最上面那一次是可读写的。</li>\n</ul>\n<p>相当于</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">p1 =<span class=\"keyword\">new</span> <span class=\"title class_\">Person</span>()</span><br><span class=\"line\">p2 =<span class=\"keyword\">new</span> <span class=\"title class_\">Person</span>()</span><br><span class=\"line\">p3 =<span class=\"keyword\">new</span> <span class=\"title class_\">Person</span>()   </span><br><span class=\"line\">p1,p2,p3相当于容器,Person相当于镜像</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/docker%E5%9F%BA%E7%A1%80/image-20200602185842222.png\" alt=\"image-20200602185842222\"></p>\n<p>仓库(repository)</p>\n<ul>\n<li>仓库（repository）是集中存放镜像文件的场所 。</li>\n<li>仓库(repository)和仓库注册服务器（registry）是有区别的。仓库注册服务器上往往放着很多个仓库，每个仓库中又包含了很多个镜像，每个镜像有不同的标签（tag）。</li>\n<li>仓库分为公开仓库（public）和私有仓库（private）两种形式。</li>\n<li>最大的公开仓库是docker hub(<a href=\"https://hub.docker.com/),%E5%AD%98%E6%94%BE%E4%BA%86%E6%95%B0%E9%87%8F%E5%BA%9E%E5%A4%A7%E7%9A%84%E9%95%9C%E5%83%8F%E4%BE%9B%E7%94%A8%E6%88%B7%E4%B8%8B%E8%BD%BD.%E5%9B%BD%E5%86%85%E7%9A%84%E5%85%AC%E5%BC%80%E4%BB%93%E5%BA%93%E5%8C%85%E6%8B%AC%E9%98%BF%E9%87%8C%E4%BA%91,%E7%BD%91%E6%98%93%E4%BA%91%E7%AD%89\">https://hub.docker.com/),存放了数量庞大的镜像供用户下载.国内的公开仓库包括阿里云,网易云等</a></li>\n</ul>\n<p>镜像 容器 仓库 他们三者之间的关系图如下:</p>\n<p><img data-src=\"/../images/docker%E5%9F%BA%E7%A1%80/1.png\" alt=\"img\"></p>\n<p>docker本身是一个容器运行载体或者称之为管理引擎。我们把应用程序和配置依赖打包好形成一个可交付的运行环境，这个打包好的运行环境就叫image镜像文件。 只有通过这个镜像文件才能生成docker容器。image文件可以看做是容器的模板。 docker根据image文件生成容器的实例。 同一个image文件，可以生成多个同时运行的容器实例。</p>\n<ul>\n<li>image文件生成的容器实例，本身也是一个文件，称为镜像文件；</li>\n<li>一个容器运行一种服务，当我们需要的时候，就可以通过docker客户端创建一个对应的运行实例，也就是我们的容器；</li>\n<li>至于仓库，就是放了一堆镜像的地方，我们可以把镜像发布到仓库中，需要的时候从仓库中拉下来就可以了。</li>\n</ul>\n<h2 id=\"安装Docker\"><a href=\"#安装Docker\" class=\"headerlink\" title=\"安装Docker\"></a>安装Docker</h2><p>要安装Docker Engine，您需要一个CentOS 7的维护版本。不支持或未测试存档版本。</p>\n<h3 id=\"安装方法\"><a href=\"#安装方法\" class=\"headerlink\" title=\"安装方法\"></a>安装方法</h3><p>您可以根据需要以不同的方式安装Docker Engine：</p>\n<ul>\n<li>大多数用户会 <a href=\"https://docs.docker.com/engine/install/centos/#install-using-the-repository\">设置Docker的存储库</a>并从中进行安装，以简化安装和升级任务。这是推荐的方法。</li>\n<li>一些用户下载并<a href=\"https://docs.docker.com/engine/install/centos/#install-from-a-package\">手动安装</a> RPM软件包， 并完全手动管理升级。这在诸如在无法访问互联网的空白系统上安装Docker的情况下非常有用。</li>\n<li>在测试和开发环境中，一些用户选择使用自动 <a href=\"https://docs.docker.com/engine/install/centos/#install-using-the-convenience-script\">便利脚本</a>来安装Docker。</li>\n</ul>\n<p>我们按推荐的安装</p>\n<h3 id=\"使用存储库安装\"><a href=\"#使用存储库安装\" class=\"headerlink\" title=\"使用存储库安装\"></a>使用存储库安装</h3><p>在新主机上首次安装Docker Engine之前，需要设置Docker存储库。之后，您可以从存储库安装和更新Docker。</p>\n<h4 id=\"设置存储库\"><a href=\"#设置存储库\" class=\"headerlink\" title=\"设置存储库\"></a>设置存储库</h4><p>安装<code>yum-utils</code>软件包（提供<code>yum-config-manager</code> 实用程序）并设置<strong>稳定的</strong>存储库。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">sudo yum install -y yum-utils</span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">sudo yum-config-manager \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --add-repo \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    https://download.docker.com/linux/centos/docker-ce.repo</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装DOCKER引擎\"><a href=\"#安装DOCKER引擎\" class=\"headerlink\" title=\"安装DOCKER引擎\"></a>安装DOCKER引擎</h4><ol>\n<li>安装<em>最新版本</em>的Docker Engine和容器，或者转到下一步安装稳定版本：</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">sudo yum install docker-ce docker-ce-cli containerd.io</span></span><br></pre></td></tr></table></figure>\n\n<p>如果提示您接受GPG密钥，请验证指纹是否匹配 <code>060A 61C5 1B55 8A7F 742B 77AA C52F EB6B 621E 9F35</code>，如果是，则接受它。</p>\n<blockquote>\n<p>有多个Docker存储库吗？</p>\n<p>如果启用了多个Docker存储库，则在未在<code>yum install</code>or <code>yum update</code>命令中指定版本的情况下进行安装或更新将始终安装可能的最高版本，这可能不适合您的稳定性需求。</p>\n</blockquote>\n<p>Docker已安装但尚未启动。<code>docker</code>创建该组，但没有用户添加到该组。</p>\n<ol start=\"2\">\n<li>要安装<em>特定版本</em>的Docker Engine，请在存储库中列出可用版本，然后选择并安装：</li>\n</ol>\n<p>a. 列出并排序您存储库中可用的版本。此示例按版本号（从高到低）对结果进行排序，并被截断：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">yum list docker-ce --showduplicates | <span class=\"built_in\">sort</span> -r</span></span><br><span class=\"line\"></span><br><span class=\"line\">docker-ce.x86_64  3:18.09.1-3.el7                     docker-ce-stable</span><br><span class=\"line\">docker-ce.x86_64  3:18.09.0-3.el7                     docker-ce-stable</span><br><span class=\"line\">docker-ce.x86_64  18.06.1.ce-3.el7                    docker-ce-stable</span><br><span class=\"line\">docker-ce.x86_64  18.06.0.ce-3.el7                    docker-ce-stable</span><br></pre></td></tr></table></figure>\n\n<p>返回的列表取决于启用了哪些存储库，并且特定于您的CentOS版本（<code>.el7</code>在此示例中以后缀表示）。</p>\n<p>b.通过其完全合格的软件包名称安装特定版本，该软件包名称是软件包名称（<code>docker-ce</code>）加上版本字符串（第二列），从第一个冒号（<code>:</code>）一直到第一个连字符，并用连字符（<code>-</code>）分隔。例如，<code>docker-ce-18.09.1</code>。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">sudo yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io</span></span><br></pre></td></tr></table></figure>\n\n<p>Docker已安装但尚未启动。<code>docker</code>创建该组，但没有用户添加到该组。</p>\n<ol>\n<li>启动Docker。</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">sudo systemctl start docker</span></span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>通过运行<code>hello-world</code> 映像来验证是否正确安装了Docker Engine 。</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">sudo docker run hello-world</span></span><br></pre></td></tr></table></figure>\n\n<p>此命令下载测试图像并在容器中运行。容器运行时，它会打印参考消息并退出。</p>\n<p>Docker Engine已安装并正在运行。您需要使用<code>sudo</code>来运行Docker命令。继续进行<a href=\"https://docs.docker.com/engine/install/linux-postinstall/\">Linux后安装，</a>以允许非特权用户运行Docker命令以及其他可选配置步骤。</p>\n<p>其他安装方法可以查看docker的官方文档 :<a href=\"https://docs.docker.com/engine/install/centos/#prerequisites\">https://docs.docker.com/engine/install/centos/#prerequisites</a></p>\n<h4 id=\"升级DOCKER引擎\"><a href=\"#升级DOCKER引擎\" class=\"headerlink\" title=\"升级DOCKER引擎\"></a>升级DOCKER引擎</h4><p>要升级Docker Engine，请按照<a href=\"https://docs.docker.com/engine/install/centos/#install-using-the-repository\">安装说明</a>，选择要安装的新版本。</p>\n<h2 id=\"配置阿里云加速\"><a href=\"#配置阿里云加速\" class=\"headerlink\" title=\"配置阿里云加速\"></a>配置阿里云加速</h2><p>因为docker默认访问的镜像是在国外的,会导致访问过慢的问题,所以需要配置成国内的,当然有些主机本来就是在国外的你也可以不配置,</p>\n<h3 id=\"注册阿里云账号\"><a href=\"#注册阿里云账号\" class=\"headerlink\" title=\"注册阿里云账号\"></a>注册阿里云账号</h3><p>注册地址:<a href=\"https://account.aliyun.com/\">https://account.aliyun.com/</a></p>\n<p>可以用淘宝的账号密码</p>\n<p>进入后点击控制台 搜索容器镜像服务</p>\n<p><img data-src=\"/../images/docker%E5%9F%BA%E7%A1%80/1-1591095562907.png\" alt=\"1\"></p>\n<p>找到镜像加速器</p>\n<p><img data-src=\"/../images/docker%E5%9F%BA%E7%A1%80/2.png\" alt=\"2\"></p>\n<p>按提示在你的linux机器上配置即可</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim /etc/docker/daemon.json</span><br></pre></td></tr></table></figure>\n\n<p>把这个写入保存</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;registry-mirrors&quot;: [&quot;你的加速器地址&quot;]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">:wq 保存</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">重启配置文件</span></span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">重启docker</span></span><br><span class=\"line\">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>\n\n<p><font color=\"red\"> 这里的所有操作都是针对centos7以及以上的 </font></p>\n<h2 id=\"常用命令\"><a href=\"#常用命令\" class=\"headerlink\" title=\"常用命令\"></a>常用命令</h2><h3 id=\"镜像命令\"><a href=\"#镜像命令\" class=\"headerlink\" title=\"镜像命令\"></a>镜像命令</h3><h4 id=\"docker-images\"><a href=\"#docker-images\" class=\"headerlink\" title=\"docker images\"></a>docker images</h4><p><code>docker images</code> :列出本机的所有镜像</p>\n<p><img data-src=\"/../images/docker%E5%9F%BA%E7%A1%80/3.png\" alt=\"3\"></p>\n<p>各个选项说明:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">REPOSITORY :表示镜像的仓库源</span><br><span class=\"line\">TAG:镜像的标签,也就是版本</span><br><span class=\"line\">IMAGE ID: 表示镜像的ID</span><br><span class=\"line\">CREATED: 镜像的创建时间</span><br><span class=\"line\">SIZE: 镜像的大小</span><br></pre></td></tr></table></figure>\n\n<p>同一个仓库源可以有多个TAG,代表这个仓库源的不同个版本,我们使用REPOSITORY:TAG来定义不同镜像.如果不指定就表示:latest</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">Usage:\tdocker images [OPTIONS] [REPOSITORY[:TAG]]</span><br><span class=\"line\"></span><br><span class=\"line\">List images</span><br><span class=\"line\"></span><br><span class=\"line\">Options:</span><br><span class=\"line\">  -a, --all             Show all images (default hides intermediate images)# 显示本地说有镜像,包含中间映像层</span><br><span class=\"line\">      --digests         Show digests #显示摘要信息</span><br><span class=\"line\">  -f, --filter filter   Filter output based on conditions provided # 显示满足条件的镜像</span><br><span class=\"line\">      --format string   Pretty-print images using a Go template # 指定返回值的模板文件</span><br><span class=\"line\">      --no-trunc        `Don&#x27;t truncate output` # 显示完成镜像信息</span><br><span class=\"line\">  -q, --quiet           Only show numeric IDs #  只显示镜像ID</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"docker-search\"><a href=\"#docker-search\" class=\"headerlink\" title=\"docker search\"></a>docker search</h4><p><code>docker search [OPTIONS] 镜像名称</code>:查询 <a href=\"https://hub.docker.com/\">https://hub.docker.com</a> 上的所有镜像</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">OPTIONS说明：</span><br><span class=\"line\">--automated :只列出 automated build类型的镜像；</span><br><span class=\"line\">--no-trunc :显示完整的镜像描述；</span><br><span class=\"line\">-s :列出收藏数不小于指定值的镜像。</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/docker%E5%9F%BA%E7%A1%80/4.png\" alt=\"4\"></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">参数说明：</span><br><span class=\"line\">NAME: 镜像仓库源的名称</span><br><span class=\"line\">DESCRIPTION: 镜像的描述</span><br><span class=\"line\">OFFICIAL: 是否 docker 官方发布</span><br><span class=\"line\">stars: 类似 Github 里面的 star，表示点赞、喜欢的意思。</span><br><span class=\"line\">AUTOMATED: 自动构建。</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"docker-rmi\"><a href=\"#docker-rmi\" class=\"headerlink\" title=\"docker rmi\"></a><code>docker rmi</code></h4><p><code>docker rmi [OPTIONS] IMAGE [IMAGE...]</code>: 删除本地一个或多少镜像。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">OPTIONS说明：</span><br><span class=\"line\">-f :强制删除；</span><br><span class=\"line\">--no-prune :不移除该镜像的过程镜像，默认移除；</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"docker-pull\"><a href=\"#docker-pull\" class=\"headerlink\" title=\"docker pull\"></a><code>docker pull</code></h4><p><code>docker pull [OPTIONS] NAME[:TAG|@DIGEST]</code>: 从镜像仓库中拉取或者更新指定镜像</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">OPTIONS说明：</span><br><span class=\"line\">-a :拉取所有 tagged 镜像</span><br><span class=\"line\">--disable-content-trust :忽略镜像的校验,默认开启</span><br><span class=\"line\">docker build</span><br></pre></td></tr></table></figure>\n\n<p><code>docker build [OPTIONS] PATH | URL | -</code> :使用 Dockerfile 创建镜像</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">OPTIONS说明：</span><br><span class=\"line\">--build-arg=[] :设置镜像创建时的变量；</span><br><span class=\"line\">--cpu-shares :设置 cpu 使用权重；</span><br><span class=\"line\">--cpu-period :限制 CPU CFS周期；</span><br><span class=\"line\">--cpu-quota :限制 CPU CFS配额；</span><br><span class=\"line\">--cpuset-cpus :指定使用的CPU id；</span><br><span class=\"line\">--cpuset-mems :指定使用的内存 id；</span><br><span class=\"line\">--disable-content-trust :忽略校验，默认开启；</span><br><span class=\"line\">-f :指定要使用的Dockerfile路径；</span><br><span class=\"line\">--force-rm :设置镜像过程中删除中间容器；</span><br><span class=\"line\">--isolation :使用容器隔离技术；</span><br><span class=\"line\">--label=[] :设置镜像使用的元数据；</span><br><span class=\"line\">-m :设置内存最大值；</span><br><span class=\"line\">--memory-swap :设置Swap的最大值为内存+swap，&quot;-1&quot;表示不限swap；</span><br><span class=\"line\">--no-cache :创建镜像的过程不使用缓存；</span><br><span class=\"line\">--pull :尝试去更新镜像的新版本；</span><br><span class=\"line\">--quiet, -q :安静模式，成功后只输出镜像 ID；</span><br><span class=\"line\">--rm :设置镜像成功后删除中间容器；</span><br><span class=\"line\">--shm-size :设置/dev/shm的大小，默认值是64M；</span><br><span class=\"line\">--ulimit :Ulimit配置。</span><br><span class=\"line\">--tag, -t: 镜像的名字及标签，通常 name:tag 或者 name 格式；可以在一次构建中为一个镜像设置多个标签。</span><br><span class=\"line\">--network: 默认 default。在构建期间设置RUN指令的网络模式</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"容器命令\"><a href=\"#容器命令\" class=\"headerlink\" title=\"容器命令\"></a>容器命令</h3><h4 id=\"docker-run\"><a href=\"#docker-run\" class=\"headerlink\" title=\"docker run\"></a><code>docker run</code></h4><p><code>docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</code>:创建一个新的容器并运行一个命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">OPTIONS说明：</span><br><span class=\"line\">-a stdin: 指定标准输入输出内容类型，可选 STDIN/STDOUT/STDERR 三项；</span><br><span class=\"line\">-d: 后台运行容器，并返回容器ID；</span><br><span class=\"line\">-i: 以交互模式运行容器，通常与 -t 同时使用；  </span><br><span class=\"line\">-P: 随机端口映射，容器内部端口随机映射到主机的高端口</span><br><span class=\"line\">-p: 指定端口映射，格式为：主机(宿主)端口:容器端口</span><br><span class=\"line\">-t: 为容器重新分配一个伪输入终端，通常与 -i 同时使用；</span><br><span class=\"line\">--name=&quot;nginx-lb&quot;: 为容器指定一个名称；</span><br><span class=\"line\">--dns 8.8.8.8: 指定容器使用的DNS服务器，默认和宿主一致；</span><br><span class=\"line\">--dns-search example.com: 指定容器DNS搜索域名，默认和宿主一致；</span><br><span class=\"line\">-h &quot;mars&quot;: 指定容器的hostname；</span><br><span class=\"line\">-e username=&quot;ritchie&quot;: 设置环境变量；</span><br><span class=\"line\">--env-file=[]: 从指定文件读入环境变量；</span><br><span class=\"line\">--cpuset=&quot;0-2&quot; or --cpuset=&quot;0,1,2&quot;: 绑定容器到指定CPU运行；</span><br><span class=\"line\">-m :设置容器使用内存最大值；</span><br><span class=\"line\">--net=&quot;bridge&quot;: 指定容器的网络连接类型，支持 bridge/host/none/container: 四种类型；</span><br><span class=\"line\">--link=[]: 添加链接到另一个容器；</span><br><span class=\"line\">--expose=[]: 开放一个端口或一组端口；</span><br><span class=\"line\">--volume , -v: 绑定一个卷</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"实例\"><a href=\"#实例\" class=\"headerlink\" title=\"实例\"></a>实例</h5><p>我先从仓库pull一个centos的镜像</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@10-7-189-100 ~]# docker pull centos</span><br></pre></td></tr></table></figure>\n\n<p>用之前学的<code>docker images</code>查看一下 本地的镜像</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@10-7-189-100 ~]# docker images</span><br><span class=\"line\">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">centos              latest              470671670cac        4 months ago        237MB</span><br><span class=\"line\">hello-world         latest              bf756fb1ae65        5 months ago        13.3kB</span><br></pre></td></tr></table></figure>\n\n<p>我们使用run命令创建一个容器.</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@10-7-189-100 ~]# docker run -it --name myCentos centos</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">这样我们就以命令行的模式进入了容器</span></span><br><span class=\"line\">[root@de8864d110f0 /]# </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">我们用<span class=\"built_in\">ls</span>命令查看是否进入了容器</span></span><br><span class=\"line\">[root@de8864d110f0 /]# ls</span><br><span class=\"line\">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">-i -t 一般都是连起来用的 --name 相当于给容器起个别名 centos 是容器的本地镜像名,也可以用IMAGE ID</span></span><br></pre></td></tr></table></figure>\n\n<p>当然你也会问,你怎么证明是在centos 里面的容器呢?我们用下面的命令来列出容器</p>\n<h4 id=\"docker-ps\"><a href=\"#docker-ps\" class=\"headerlink\" title=\"docker ps\"></a><code>docker ps</code></h4><p><code>docker ps [OPTIONS]</code>: 列出容器</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">OPTIONS说明：</span><br><span class=\"line\">-a :显示所有的容器，包括未运行的。</span><br><span class=\"line\">-f :根据条件过滤显示的内容。</span><br><span class=\"line\">--format :指定返回值的模板文件。</span><br><span class=\"line\">-l :显示最近创建的容器。</span><br><span class=\"line\">-n :列出最近创建的n个容器。</span><br><span class=\"line\">--no-trunc :不截断输出。</span><br><span class=\"line\">-q :静默模式，只显示容器编号。</span><br><span class=\"line\">-s :显示总的文件大小。</span><br></pre></td></tr></table></figure>\n\n<p>我们新开一个终端:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@10-7-189-100 ~]# docker ps</span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class=\"line\">de8864d110f0        centos              &quot;/bin/bash&quot;         9 minutes ago       Up 9 minutes                            myCentos</span><br></pre></td></tr></table></figure>\n\n<p>CONTAINER ID 跟我们上面的root@de8864d110f0 是一样的.NAMES 也是我们自己命名的</p>\n<h4 id=\"docker-commit\"><a href=\"#docker-commit\" class=\"headerlink\" title=\"docker commit\"></a><code>docker commit</code></h4><p><code>docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</code>:从容器创建一个新的镜像。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">OPTIONS说明：</span><br><span class=\"line\">-a :提交的镜像作者；</span><br><span class=\"line\">-c :使用Dockerfile指令来创建镜像；</span><br><span class=\"line\">-m :提交时的说明文字；</span><br><span class=\"line\">-p :在commit时，将容器暂停。</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"退出容器\"><a href=\"#退出容器\" class=\"headerlink\" title=\"退出容器\"></a>退出容器</h4><p><code>exit</code>: 退出容器,并停止</p>\n<p><code>ctrl+P+Q</code>: 退出容器,不停止</p>\n<h4 id=\"Docker-start-x2F-stop-x2F-restart-命令\"><a href=\"#Docker-start-x2F-stop-x2F-restart-命令\" class=\"headerlink\" title=\"Docker start&#x2F;stop&#x2F;restart 命令\"></a>Docker start&#x2F;stop&#x2F;restart 命令</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker start 容器ID 或容器名 :启动一个或多个已经被停止的容器</span><br><span class=\"line\">docker stop 容器ID 或容器名 :停止一个运行中的容器</span><br><span class=\"line\">docker kill 容器ID 或容器名 :强制关闭容器</span><br><span class=\"line\">docker restart :重启容器</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"删除已停止的容器\"><a href=\"#删除已停止的容器\" class=\"headerlink\" title=\"删除已停止的容器\"></a>删除已停止的容器</h4><p><code>docker rm [OPTIONS] CONTAINER [CONTAINER...]</code> :删除一个或多个容器。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">OPTIONS说明：</span><br><span class=\"line\">-f :通过 SIGKILL 信号强制删除一个运行中的容器。</span><br><span class=\"line\">-l :移除容器间的网络连接，而非容器本身。</span><br><span class=\"line\">-v :删除与容器关联的卷。</span><br></pre></td></tr></table></figure>\n\n<p><font color=\"red\">     以下为重点</font></p>\n<h4 id=\"启动守护式容器\"><a href=\"#启动守护式容器\" class=\"headerlink\" title=\"启动守护式容器\"></a>启动守护式容器</h4><p><code>docker run -d 容器名</code> 我们用后台模式来运行一个centos 容器</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@10-7-189-100 ~]# docker run -d centos</span><br><span class=\"line\">b4bc6e623bc47914981e404445af7fbef7ac38a777cabfe10d30c0e20ea6a665</span><br></pre></td></tr></table></figure>\n\n<p>我们看到已经运行起来了,我们用<code>docker ps</code> 来查看</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@10-7-189-100 ~]# docker ps</span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br></pre></td></tr></table></figure>\n\n<p>原来:<font color=\"red\">Docker 容器后台运行必须有一个前端进程.</font>.容器运行的命令如果不是那些一直挂起的命令(比如运行top,tail),就是会自动退出的</p>\n<p>这个是docker的机制问题</p>\n<h4 id=\"查看容器日志\"><a href=\"#查看容器日志\" class=\"headerlink\" title=\"查看容器日志\"></a>查看容器日志</h4><p><code>docker logs [OPTIONS] CONTAINER</code>:获取容器的日志</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">OPTIONS说明：</span><br><span class=\"line\">-f : 跟踪日志输出</span><br><span class=\"line\">--since :显示某个开始时间的所有日志</span><br><span class=\"line\">-t : 显示时间戳</span><br><span class=\"line\">--tail :仅列出最新N条容器日志</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"查看容器中运行的进程信息\"><a href=\"#查看容器中运行的进程信息\" class=\"headerlink\" title=\"查看容器中运行的进程信息\"></a>查看容器中运行的进程信息</h4><p><code>docker top [OPTIONS] CONTAINER [ps OPTIONS]</code>: 查看容器中运行的进程信息，支持 ps 命令参数。</p>\n<h4 id=\"查看容器内部细节\"><a href=\"#查看容器内部细节\" class=\"headerlink\" title=\"查看容器内部细节\"></a>查看容器内部细节</h4><p><code>docker inspect [OPTIONS] NAME|ID [NAME|ID...]</code>:获取容器&#x2F;镜像的元数据。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">OPTIONS说明：</span><br><span class=\"line\">-f :指定返回值的模板文件。</span><br><span class=\"line\">-s :显示总的文件大小。</span><br><span class=\"line\">--type :为指定类型返回JSON。</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"连接到正在运行中的容器\"><a href=\"#连接到正在运行中的容器\" class=\"headerlink\" title=\"连接到正在运行中的容器\"></a>连接到正在运行中的容器</h4><p><code>docker attach [OPTIONS] CONTAINER</code>:连接到正在运行中的容器</p>\n<p>要attach上去的容器必须正在运行，可以同时连接上同一个container来共享屏幕（与screen命令的attach类似）。</p>\n<p>官方文档中说attach后可以通过CTRL-C来detach，但实际上经过我的测试，如果container当前在运行bash，CTRL-C自然是当前行的输入，没有退出；如果container当前正在前台运行进程，如输出nginx的access.log日志，CTRL-C不仅会导致退出容器，而且还stop了。这不是我们想要的，detach的意思按理应该是脱离容器终端，但容器依然运行。好在attach是可以带上—sig-proxy&#x3D;false来确保CTRL-D或CTRL-C不会关闭容器。</p>\n<h4 id=\"在运行的容器中执行命令\"><a href=\"#在运行的容器中执行命令\" class=\"headerlink\" title=\"在运行的容器中执行命令\"></a>在运行的容器中执行命令</h4><p><code>docker exec [OPTIONS] CONTAINER COMMAND [ARG...]</code>: 在运行的容器中执行命令</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">OPTIONS说明：</span><br><span class=\"line\">-d :分离模式: 在后台运行</span><br><span class=\"line\">-i :即使没有附加也保持STDIN 打开</span><br><span class=\"line\">-t :分配一个伪终端</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"数据拷贝\"><a href=\"#数据拷贝\" class=\"headerlink\" title=\"数据拷贝\"></a>数据拷贝</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker cp [OPTIONS] CONTAINER:SRC_PATH DEST_PATH|- # 从容器内拷贝到宿主机</span><br><span class=\"line\">docker cp [OPTIONS] SRC_PATH|- CONTAINER:DEST_PATH # 从宿主机拷贝到容器内</span><br><span class=\"line\">OPTIONS说明：</span><br><span class=\"line\">-L :保持源目标中的链接</span><br></pre></td></tr></table></figure>\n\n<p>还有很命令,可以查文档 :<a href=\"https://www.runoob.com/docker/docker-command-manual.html\">https://www.runoob.com/docker/docker-command-manual.html</a></p>\n","categories":["docker"],"tags":["docker"]},{"title":"linux基础","url":"/post/22349d84.html","content":"","categories":["linux"],"tags":["linux"]},{"title":"linux磁盘满,清理后空间占用率还是很高,解决方案","url":"/post/4c3a939d.html","content":"<h2 id=\"问题现象\"><a href=\"#问题现象\" class=\"headerlink\" title=\"问题现象\"></a>问题现象</h2><p>之前由于日志文件,导致磁盘满了.删除log日志后,查看发现磁盘占用率还是很满</p>\n<p><img data-src=\"/../images/linux%E7%A3%81%E7%9B%98%E6%BB%A1-%E6%B8%85%E7%90%86%E5%90%8E%E7%A9%BA%E9%97%B4%E5%8D%A0%E7%94%A8%E7%8E%87%E8%BF%98%E6%98%AF%E5%BE%88%E9%AB%98-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/image-20230316160733238.png\" alt=\"image-20230316160733238\"></p>\n<span id=\"more\"></span>\n\n<h2 id=\"问题分析\"><a href=\"#问题分析\" class=\"headerlink\" title=\"问题分析\"></a>问题分析</h2><p>通常不会出现删除文件后空间不释放的情况，但是也存在例外，比如文件进程锁定，或者有进程一直在向这个文件写数据，要明白这个问题，首先需要知道 linux 下文件的存储机制和存储结构。</p>\n<p>一个文件在文件系统中存放分为两个部分：</p>\n<p>指针部分：指针位于文件系统的meta-data中，在将数据删除后，这个指针就从meta-data中清除了。<br>数据部分：而数据部分存储在磁盘中。<br>将数据对应的指针从meta-data中清除后，文件数据部分占用的空间就可以被覆盖并写入新的内容。之所以出现删除log文件后，空间还没有释放，就是因为进程还在一直向这个文件写入内容，导致虽然删除了log文件，但是由于进程锁定，文件对应的指针部分并未从meta-data中清除，而由于指针并未删除，系统内核就默认文件并未被删除，因此查询文件系统使用率时，显示空间并未释放。</p>\n<h2 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h2><p>输入命令<code>lsof -n |grep delete</code></p>\n<p><img data-src=\"/../images/linux%E7%A3%81%E7%9B%98%E6%BB%A1-%E6%B8%85%E7%90%86%E5%90%8E%E7%A9%BA%E9%97%B4%E5%8D%A0%E7%94%A8%E7%8E%87%E8%BF%98%E6%98%AF%E5%BE%88%E9%AB%98-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/image-20230316161639586.png\" alt=\"image-20230316161639586\"></p>\n<p>可以看到进程被锁住了.所以我们只需要kill掉进程就好了.</p>\n","categories":["linux"],"tags":["linux","磁盘空间"]},{"title":"linux nl 命令","url":"/post/501da393.html","content":"<p><strong>Linux nl命令</strong>读取 file 参数（缺省情况下标准输入），计算输入中的行号，将计算过的行号写入标准输出。在输出中，nl命令根据您在命令行中指定的标志来计算左边的行。输入文本必须写在逻辑页中。每个逻辑页有头、主体和页脚节（可以有空节）。除非使用<code>-p</code>选项，nl 命令在每个逻辑页开始的地方重新设置行号。可以单独为头、主体和页脚节设置行计算标志（例如，头和页脚行可以被计算然而文本行不能）。其默认的结果与<code>cat -n</code>有点不太一样， nl 可以将行号做比较多的显示设计，包括位数与是否自动补齐0等等的功能。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"语法\"><a href=\"#语法\" class=\"headerlink\" title=\"语法\"></a>语法</h2><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">nl</span> (选项) (参数)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"选项\"><a href=\"#选项\" class=\"headerlink\" title=\"选项\"></a>选项</h2><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">-b ：指定行号指定的方式，主要有两种：</span><br><span class=\"line\">    -b a ：表示不论是否为空行，也同样列出行号(类似 <span class=\"built_in\">cat</span> -n)；</span><br><span class=\"line\">    -b t ：如果有空行，空的那一行不要列出行号(默认值)；</span><br><span class=\"line\"></span><br><span class=\"line\">-n ：列出行号表示的方法，主要有三种：</span><br><span class=\"line\">    -n <span class=\"built_in\">ln</span> ：行号在萤幕的最左方显示；</span><br><span class=\"line\">    -n rn ：行号在自己栏位的最右方显示，且不加 0 ；</span><br><span class=\"line\">    -n rz ：行号在自己栏位的最右方显示，且加 0 ；</span><br><span class=\"line\"></span><br><span class=\"line\">-w ：行号栏位的占用的位数。</span><br><span class=\"line\">-p ：在逻辑定界符处不重新开始计算。</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"实例\"><a href=\"#实例\" class=\"headerlink\" title=\"实例\"></a>实例</h2><p>准备一个文件testfile</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">我是第一行 111</span><br><span class=\"line\">我是第二行 222</span><br><span class=\"line\"></span><br><span class=\"line\">我是第四行 444</span><br><span class=\"line\"></span><br><span class=\"line\">我是第六行 666</span><br><span class=\"line\"></span><br><span class=\"line\">========== 888</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"nl-testfile\"><a href=\"#nl-testfile\" class=\"headerlink\" title=\"nl testfile\"></a><code>nl testfile</code></h3><p><img data-src=\"/../images/linux-nl-%E5%91%BD%E4%BB%A4/image-20220929091718751.png\" alt=\"image-20220929091718751\"></p>\n<p>说明：文件中的空白行，nl 不会加上行号</p>\n<h3 id=\"b-a空行也加上行号\"><a href=\"#b-a空行也加上行号\" class=\"headerlink\" title=\"-b a空行也加上行号\"></a><code>-b a</code>空行也加上行号</h3><p><img data-src=\"/../images/linux-nl-%E5%91%BD%E4%BB%A4/image-20220929091949323.png\" alt=\"image-20220929091949323\"></p>\n<h3 id=\"n-ln-行号在萤幕的最左方显示\"><a href=\"#n-ln-行号在萤幕的最左方显示\" class=\"headerlink\" title=\"-n ln 行号在萤幕的最左方显示\"></a><code>-n ln</code> 行号在萤幕的最左方显示</h3><p><img data-src=\"/../images/linux-nl-%E5%91%BD%E4%BB%A4/image-20220929092259272.png\" alt=\"image-20220929092259272\"></p>\n<h3 id=\"n-rn-行号在自己栏位的最右方显示，且不加-0\"><a href=\"#n-rn-行号在自己栏位的最右方显示，且不加-0\" class=\"headerlink\" title=\"-n rn 行号在自己栏位的最右方显示，且不加 0\"></a><code>-n rn </code>行号在自己栏位的最右方显示，且不加 0</h3><p><img data-src=\"/../images/linux-nl-%E5%91%BD%E4%BB%A4/image-20220929092357601.png\" alt=\"image-20220929092357601\"></p>\n<h3 id=\"n-rz-行号在自己栏位的最右方显示，且加-0\"><a href=\"#n-rz-行号在自己栏位的最右方显示，且加-0\" class=\"headerlink\" title=\"-n rz 行号在自己栏位的最右方显示，且加 0\"></a><code>-n rz</code> 行号在自己栏位的最右方显示，且加 0</h3><p><img data-src=\"/../images/linux-nl-%E5%91%BD%E4%BB%A4/image-20220929092541176.png\" alt=\"image-20220929092541176\"></p>\n<h3 id=\"w-行号栏位的占用的位数\"><a href=\"#w-行号栏位的占用的位数\" class=\"headerlink\" title=\"-w 行号栏位的占用的位数\"></a><code>-w</code> 行号栏位的占用的位数</h3><p><img data-src=\"/../images/linux-nl-%E5%91%BD%E4%BB%A4/image-20220929092632275.png\" alt=\"image-20220929092632275\"></p>\n","categories":["linux"],"tags":["linux","nl命令"]},{"title":"ospf基本命令","url":"/post/87db578c.html","content":"<h3 id=\"OSPF基本命令\"><a href=\"#OSPF基本命令\" class=\"headerlink\" title=\"OSPF基本命令\"></a>OSPF基本命令</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">ospf 1 router-id 1.1.1.1   # 开启ospf.进程号为1手动配置Router ID</span><br><span class=\"line\">area 0/0.0.0.0  # 配置区域</span><br><span class=\"line\">network 192.168.1.0 0.0.0.255 # 宣告网络使用反掩码来匹配(255.255.255.255-掩码)</span><br><span class=\"line\">display ospf peer [brief] # 显示OSPF邻居信息</span><br><span class=\"line\">ospf timer hello 10 # 修改hello包发送间隔</span><br><span class=\"line\">ospf timer dead 40 # 修改hello包超时时间</span><br><span class=\"line\">display ospf interface g0/0/0  # 显示OSPF接口信息</span><br><span class=\"line\">ospf dr-priority 100 # 修改OSPF接口优先级</span><br><span class=\"line\">ospf cost 10 # 修改开销,范围1~65535,默认为1</span><br><span class=\"line\">bandwidth-reference 100 # 调整带宽参考值,默认为100Mbps 需要在整个OSPF网络中统一调整</span><br><span class=\"line\">reset ospf process # 重启OSPF进程</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"OSPF-认证命令\"><a href=\"#OSPF-认证命令\" class=\"headerlink\" title=\"OSPF 认证命令\"></a>OSPF 认证命令</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">int g0/0/0 </span><br><span class=\"line\">\tospf authentication-mode md5 1 cipher password # 配置接口认证</span><br><span class=\"line\">\t</span><br><span class=\"line\">ospf 1</span><br><span class=\"line\">\tarea 0</span><br><span class=\"line\">\t \tauthentication-mode md5 1 cipher password # 配置区域认证</span><br><span class=\"line\"><span class=\"meta prompt_\">\t </span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">2个同时配置 接口优先</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"OSPF缺省理由\"><a href=\"#OSPF缺省理由\" class=\"headerlink\" title=\"OSPF缺省理由\"></a>OSPF缺省理由</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">ip router-static 0.0.0.0 0.0.0.0</span><br><span class=\"line\">default-router-advertise [always] # 发布缺省路由 always参数: 强制发布,不需要路由表事先存在缺省路由</span><br></pre></td></tr></table></figure>\n\n\n\n","categories":["OSPF"],"tags":["动态路由","OSPF"]},{"title":"mysql8.0主从复制","url":"/post/22f479b4.html","content":"<p>1.传统方式：<br>基于主库的bin-log将日志事件和事件位置复制到从库，从库再加以应用来达到主从同步的目的。</p>\n<p>2.Gtid方式（MySQL&gt;&#x3D;5.7推荐使用）：<br>基于GTID的复制中，从库会告知主库已经执行的事务的GTID的值，然后主库会将所有未执行的事务的GTID的列表返回给从库，并且可以保证同一个事务只在指定的从库执行一次。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><ul>\n<li>在做主从同步时，如果从机需要主机上原有数据，就要先复制一份到从机。</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">1. 收集主机原有数据</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">mysqldump -uroot -pmysql --all-databases --lock-all-tables &gt; ~/master_db.sql</span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">2. 从机复制主机原有数据</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">mysql -uroot -p123456 -h127.0.0.1 --port=3306 &lt; ~/master_db.sql</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>别忘了开启3306端口,不然会连不上</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">centos7以上</span></span><br><span class=\"line\">firewall-cmd --add-port=3306/tcp --permanen # success 表示成功</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">重新载入配置</span>  </span><br><span class=\"line\">firewall-cmd --reload</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"传统方式\"><a href=\"#传统方式\" class=\"headerlink\" title=\"传统方式\"></a>传统方式</h2><h3 id=\"master配置\"><a href=\"#master配置\" class=\"headerlink\" title=\"master配置\"></a>master配置</h3><h4 id=\"修改master配置文件\"><a href=\"#修改master配置文件\" class=\"headerlink\" title=\"修改master配置文件\"></a>修改master配置文件</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\">##主从数据库配置核心部分</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">设置同步的binary <span class=\"built_in\">log</span>二进制日志文件名前缀，默认为binlog</span></span><br><span class=\"line\">log-bin=mysql-bin</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">服务器唯一<span class=\"built_in\">id</span>，默认为1  主数据库和从数据库的server-id不能重复</span></span><br><span class=\"line\">server-id=1          </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\">##可选配置</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">需要主从复制的数据库</span></span><br><span class=\"line\">binlog-do-db=test</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">复制过滤：也就是指定哪个数据库不用同步（mysql库一般不同步）</span></span><br><span class=\"line\">binlog-ignore-db=mysql</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">为每个session分配的内存，在事务过程中用来存储二进制日志的缓存</span></span><br><span class=\"line\">binlog_cache_size=1M</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">主从复制的格式（mixed,statement,row，默认格式是statement。建议是设置为row，主从复制时数据更加能够统一）</span></span><br><span class=\"line\">binlog_format=row</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">设置二进制日志自动删除/过期的天数，避免占用磁盘空间。默认值为0，表示不自动删除。</span></span><br><span class=\"line\">expire_logs_days=7</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></span><br><span class=\"line\">slave_skip_errors=1062</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"创建一个用户，用来同步（也可以是root）\"><a href=\"#创建一个用户，用来同步（也可以是root）\" class=\"headerlink\" title=\"创建一个用户，用来同步（也可以是root）\"></a>创建一个用户，用来同步（也可以是root）</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">create user &#x27;repl&#x27;@&#x27;%&#x27; identified by &#x27;123456&#x27;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"修改用户权限\"><a href=\"#修改用户权限\" class=\"headerlink\" title=\"修改用户权限\"></a>修改用户权限</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">grant replication slave on *.* to &#x27;repl&#x27;@&#x27;%&#x27;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"刷新权限\"><a href=\"#刷新权限\" class=\"headerlink\" title=\"刷新权限\"></a>刷新权限</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">flush privileges</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"查看日志以及位置\"><a href=\"#查看日志以及位置\" class=\"headerlink\" title=\"查看日志以及位置\"></a>查看日志以及位置</h4><p>接着执行命令查看并记下binary log二进制日志文件名 File 以及位置 Position的值，需要在从数据库用到：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">show master status</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/mysql%208.0%20%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/image-20210421200137174.png\" alt=\"image-20210421200137174\"></p>\n<h3 id=\"slave配置\"><a href=\"#slave配置\" class=\"headerlink\" title=\"slave配置\"></a>slave配置</h3><h4 id=\"修改配置文件\"><a href=\"#修改配置文件\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\">##主从数据库配置核心部分</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">设置同步的binary <span class=\"built_in\">log</span>二进制日志文件名前缀，默认是binlog</span></span><br><span class=\"line\">log-bin=mysql-bin</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">服务器唯一ID  主数据库和从数据库的server-id不能重复</span></span><br><span class=\"line\">server-id=2</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\">##可选配置</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">需要主从复制的数据库</span> </span><br><span class=\"line\">replicate-do-db=test</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">复制过滤：也就是指定哪个数据库不用同步（mysql库一般不同步）</span> </span><br><span class=\"line\">binlog-ignore-db=mysql</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">为每个session分配的内存，在事务过程中用来存储二进制日志的缓存</span> </span><br><span class=\"line\">binlog_cache_size=1M</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">主从复制的格式（mixed,statement,row，默认格式是statement。建议是设置为row，主从复制时数据更加能够统一）</span> </span><br><span class=\"line\">binlog_format=row</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">设置二进制日志自动删除/过期的天数，避免占用磁盘空间。默认值为0，表示不自动删除。</span> </span><br><span class=\"line\">expire_logs_days=7</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span> </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span> </span><br><span class=\"line\">slave_skip_errors=1062</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">relay_log配置中继日志，默认采用 主机名-relay-bin 的方式保存日志文件</span> </span><br><span class=\"line\">relay_log=replicas-mysql-relay-bin</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">log_slave_updates表示slave将复制事件写进自己的二进制日志</span></span><br><span class=\"line\">log_slave_updates=1</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">防止改变数据(只读操作，除了特殊的线程)</span></span><br><span class=\"line\">read_only=1</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"与master建立联系\"><a href=\"#与master建立联系\" class=\"headerlink\" title=\"与master建立联系\"></a>与master建立联系</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">change master to MASTER_HOST=&#x27;master_ip&#x27;,MASTER_PORT=master_port,MASTER_USER=&#x27;repl&#x27;,MASTER_PASSWORD=&#x27;123456&#x27;,MASTER_LOG_FILE=&#x27;mysql-bin.000001&#x27;,MASTER_LOG_POS=116990;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>MASTER_HOST：主数据库的主机ip</li>\n<li>MASTER_PORT：主数据库的端口，不设置则默认是3306</li>\n<li>MASTER_USER：主数据库被授予同步复制权限的用户名</li>\n<li>MASTER_PASSWORD：对应的用户密码</li>\n<li>MASTER_LOG_FILE：在主数据库执行命令<code>show master status</code> 查询到的二进制日志文件名称</li>\n<li>MASTER_LOG_POS：在主数据库执行命令<code>show master status</code> 查询到的位置 Position的值</li>\n</ul>\n<h4 id=\"开启主从复制工作\"><a href=\"#开启主从复制工作\" class=\"headerlink\" title=\"开启主从复制工作\"></a>开启主从复制工作</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">start slave</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"查看详细信息\"><a href=\"#查看详细信息\" class=\"headerlink\" title=\"查看详细信息\"></a>查看详细信息</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">show slave status \\G</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/mysql%208.0%20%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/image-20210421201109852.png\" alt=\"image-20210421201109852\"></p>\n<p>假如显示 <code>Slave_IO_Running</code> 和 <code>Slave_SQL_Running</code> 为 <code>Yes</code> ，以及<code>Slave_IO_State</code> 为 <code>Waiting for master to send event</code>，则证明主从复制成功！</p>\n<h4 id=\"停止主从复制\"><a href=\"#停止主从复制\" class=\"headerlink\" title=\"停止主从复制\"></a>停止主从复制</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">stop slave</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"基于全局事务标识符（GTID）的方法\"><a href=\"#基于全局事务标识符（GTID）的方法\" class=\"headerlink\" title=\"基于全局事务标识符（GTID）的方法\"></a>基于全局事务标识符（GTID）的方法</h2><h3 id=\"master配置-1\"><a href=\"#master配置-1\" class=\"headerlink\" title=\"master配置\"></a>master配置</h3><h4 id=\"修改master-配置文件\"><a href=\"#修改master-配置文件\" class=\"headerlink\" title=\"修改master 配置文件\"></a>修改master 配置文件</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\">##主从数据库配置核心部分</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">设置同步的binary <span class=\"built_in\">log</span>二进制日志文件名前缀，默认为binlog</span></span><br><span class=\"line\">log-bin=mysql-bin</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">服务器唯一<span class=\"built_in\">id</span>，默认为1  主数据库和从数据库的server-id不能重复</span></span><br><span class=\"line\">server-id=1     </span><br><span class=\"line\">     </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">开启 GTID</span></span><br><span class=\"line\">gtid_mode=on</span><br><span class=\"line\">enforce_gtid_consistency=true</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"创建同步用户-与上面一样\"><a href=\"#创建同步用户-与上面一样\" class=\"headerlink\" title=\"创建同步用户(与上面一样)\"></a>创建同步用户(与上面一样)</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">create user &#x27;repl&#x27;@&#x27;%&#x27; identified by &#x27;123456&#x27;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"授权用户\"><a href=\"#授权用户\" class=\"headerlink\" title=\"授权用户\"></a>授权用户</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">grant replication slave on *.* to &#x27;repl&#x27;@&#x27;%&#x27;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"刷新权限-1\"><a href=\"#刷新权限-1\" class=\"headerlink\" title=\"刷新权限\"></a>刷新权限</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">flush privileges</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"查看状态\"><a href=\"#查看状态\" class=\"headerlink\" title=\"查看状态\"></a>查看状态</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">show master status \\G</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/mysql%208.0%20%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/image-20210421201724219.png\" alt=\"image-20210421201724219\"></p>\n<p>对比发现与基于二进制日志文件的方法不同的是<code>Executed_Gtid_Set</code>会有一个具体的全局事务id值</p>\n<h3 id=\"slave配置-1\"><a href=\"#slave配置-1\" class=\"headerlink\" title=\"slave配置\"></a>slave配置</h3><h4 id=\"修改配置文件-1\"><a href=\"#修改配置文件-1\" class=\"headerlink\" title=\"修改配置文件\"></a>修改配置文件</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\">##主从数据库配置核心部分</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">设置同步的binary <span class=\"built_in\">log</span>二进制日志文件名前缀，默认是binlog</span></span><br><span class=\"line\">log-bin=mysql-bin</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">服务器唯一ID  主数据库和从数据库的server-id不能重复</span></span><br><span class=\"line\">server-id=2</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">开启 GTID</span></span><br><span class=\"line\">gtid_mode=on</span><br><span class=\"line\">enforce_gtid_consistency=true</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"创建关联\"><a href=\"#创建关联\" class=\"headerlink\" title=\"创建关联\"></a>创建关联</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">change master to MASTER_HOST=&#x27;master_ip&#x27;,MASTER_PORT=master_port,MASTER_USER=&#x27;repl&#x27;,MASTER_PASSWORD=&#x27;123456&#x27;,MASTER_AUTO_POSITION=1;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"查看状态-1\"><a href=\"#查看状态-1\" class=\"headerlink\" title=\"查看状态\"></a>查看状态</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">show slave status</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/mysql%208.0%20%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/image-20210421202116234.png\" alt=\"image-20210421202116234\"></p>\n<p>假如显示 <code>Slave_IO_Running</code> 和 <code>Slave_SQL_Running</code> 为 <code>Yes</code> ，以及<code>Slave_IO_State</code> 为 <code>Waiting for master to send event</code>，则证明主从复制成功！</p>\n","categories":["mysql"],"tags":["mysql","主从备份"]},{"title":"ospf示例","url":"/post/1c903da4.html","content":"<h2 id=\"OSPF简介\"><a href=\"#OSPF简介\" class=\"headerlink\" title=\"OSPF简介\"></a>OSPF简介</h2><p>OSPF（Open Shortest Path First开放式最短路径优先）是IETF组织开发的一个基于链路状态的内部网关协议（Interior Gateway Protocol）。目前针对IPv4协议使用的是OSPF Version 2（RFC2328）。</p>\n<p>OSPF具有适应范围广、收敛快、无自环、区域划分、等价路由、支持验证、组播发送等特点。由于OSPF具有以上优势，使得OSPF作为目前主流的IGP协议被广泛应用于各个行业，例如企业、运营商、政府、金融、教育、医疗等。</p>\n<p>OSPF采用分层设计的结构，并且具有丰富的路由策略控制功能，能够适用于各种不同规模、不同组网结构的应用场景。因此在部署IGP协议的时候，OSPF经常是用户的首选方案。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"案例\"><a href=\"#案例\" class=\"headerlink\" title=\"案例\"></a>案例</h2><p>如图组网</p>\n<p><img data-src=\"/../images/ospf%E7%A4%BA%E4%BE%8B/image-20230306094952658.png\" alt=\"image-20230306094952658\"></p>\n<p>配置R1 接口地址</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[R1]interface e0/0/1\t</span><br><span class=\"line\">[R1-Ethernet0/0/1]ip address 10.10.13.1 24</span><br><span class=\"line\">[R1-Ethernet0/0/1]qu</span><br><span class=\"line\"></span><br><span class=\"line\">[R1]interface g0/0/0</span><br><span class=\"line\">[R1-GigabitEthernet0/0/0]ip address 10.10.12.1 24</span><br><span class=\"line\">[R1-GigabitEthernet0/0/0]qu</span><br><span class=\"line\"></span><br><span class=\"line\">[R1]interface Eth0/0/0\t</span><br><span class=\"line\">[R1-Ethernet0/0/0]ip address 192.168.1.254 24</span><br></pre></td></tr></table></figure>\n\n<p>配置R2 接口地址</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[R2]interface e0/0/0</span><br><span class=\"line\">[R2-Ethernet0/0/0]ip address 10.10.12.2 24</span><br><span class=\"line\">[R2-Ethernet0/0/0]q</span><br><span class=\"line\"></span><br><span class=\"line\">[R2]interface e0/0/1</span><br><span class=\"line\">[R2-Ethernet0/0/1]ip addr 10.10.23.1 24</span><br><span class=\"line\">[R2-Ethernet0/0/1]q</span><br><span class=\"line\"></span><br><span class=\"line\">[R2]interface g0/0/0</span><br><span class=\"line\">[R2-GigabitEthernet0/0/0]ip address 192.168.2.254 24</span><br><span class=\"line\">[R2-GigabitEthernet0/0/0]qu</span><br></pre></td></tr></table></figure>\n\n<p>配置R3 接口地址</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[R3]interface e0/0/1</span><br><span class=\"line\">[R3-Ethernet0/0/1]ip address 10.10.23.2 24</span><br><span class=\"line\">[R3-Ethernet0/0/1]qu</span><br><span class=\"line\"></span><br><span class=\"line\">[R3]interface g0/0/0</span><br><span class=\"line\">[R3-GigabitEthernet0/0/0]ip address 192.168.3.254 24</span><br><span class=\"line\">[R3-GigabitEthernet0/0/0]qu</span><br><span class=\"line\"></span><br><span class=\"line\">[R3]interface e0/0/0\t</span><br><span class=\"line\">[R3-Ethernet0/0/0]ip address 10.10.13.2 24</span><br></pre></td></tr></table></figure>\n\n<p>配置PC1</p>\n<p><img data-src=\"/../images/ospf%E7%A4%BA%E4%BE%8B/image-20230306101042688.png\" alt=\"image-20230306101042688\"></p>\n<p>测试PC1到R1</p>\n<p><img data-src=\"/../images/ospf%E7%A4%BA%E4%BE%8B/image-20230306101116244.png\" alt=\"image-20230306101116244\"></p>\n<p>测试PC1到R2</p>\n<p><img data-src=\"/../images/ospf%E7%A4%BA%E4%BE%8B/image-20230306101135542.png\" alt=\"image-20230306101135542\"></p>\n<p>依次配置PC2,PC3</p>\n<p><img data-src=\"/../images/ospf%E7%A4%BA%E4%BE%8B/image-20230306101304755.png\" alt=\"image-20230306101304755\"></p>\n<p><img data-src=\"/../images/ospf%E7%A4%BA%E4%BE%8B/image-20230306101224694.png\" alt=\"image-20230306101224694\"></p>\n<p>配置 R1 OSPF</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[R1]ospf 1\t</span><br><span class=\"line\">[R1]ospf 1 router-id 10.10.10.10\t  //创建进程号为1，Router ID为10.10.10.10的OSPF进程</span><br><span class=\"line\">[R1-ospf-1]area 0 //创建area 0区域并进入area 0视图</span><br><span class=\"line\">[R1-ospf-1-area-0.0.0.0]network 10.10.13.0 0.0.0.255 //配置area 0所包含的网段</span><br><span class=\"line\">[R1-ospf-1-area-0.0.0.0]network 10.10.12.0 0.0.0.255 //对外宣告IP段,也可以是单IP</span><br><span class=\"line\">[R1-ospf-1-area-0.0.0.0]network 192.168.1.0 0.0.0.255</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/ospf%E7%A4%BA%E4%BE%8B/image-20230306102323793.png\" alt=\"image-20230306102323793\"></p>\n<p>配置R2 OSPF</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[R2]ospf 1 router-id 20.20.20.20\t</span><br><span class=\"line\">[R2-ospf-1]area 0</span><br><span class=\"line\">[R2-ospf-1-area-0.0.0.0]network 10.10.12.0 0.0.0.255</span><br><span class=\"line\">[R2-ospf-1-area-0.0.0.0]network 10.10.23.0 0.0.0.255</span><br><span class=\"line\">[R2-ospf-1-area-0.0.0.0]network 192.168.2.0 0.0.0.255</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/ospf%E7%A4%BA%E4%BE%8B/image-20230306102736202.png\" alt=\"image-20230306102736202\"></p>\n<p>查看可发现已有邻居</p>\n<p><img data-src=\"/../images/ospf%E7%A4%BA%E4%BE%8B/image-20230306102807862.png\" alt=\"image-20230306102807862\"></p>\n<p>配置R3 OSPF</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[R3]ospf 1 router-id 30.30.30.30</span><br><span class=\"line\">[R3-ospf-1]area 0</span><br><span class=\"line\">[R3-ospf-1-area-0.0.0.0]network 10.10.13.0 0.0.0.255</span><br><span class=\"line\">[R3-ospf-1-area-0.0.0.0]network 10.10.23.0 0.0.0.255\t</span><br><span class=\"line\">[R3-ospf-1-area-0.0.0.0]network 192.168.3.0 0.0.0.255</span><br></pre></td></tr></table></figure>\n\n<p>查看邻居</p>\n<p><img data-src=\"/../images/ospf%E7%A4%BA%E4%BE%8B/image-20230306103539028.png\" alt=\"image-20230306103539028\"></p>\n<p>然后我们用PC1测试</p>\n<p><img data-src=\"/../images/ospf%E7%A4%BA%E4%BE%8B/image-20230306105214890.png\" alt=\"image-20230306105214890\"></p>\n<p><img data-src=\"/../images/ospf%E7%A4%BA%E4%BE%8B/image-20230306105225679.png\" alt=\"image-20230306105225679\"></p>\n<p>然后我们把R1到R2的线断了</p>\n<p>断之前</p>\n<p><img data-src=\"/../images/ospf%E7%A4%BA%E4%BE%8B/image-20230306105508480.png\" alt=\"image-20230306105508480\"></p>\n<p><img data-src=\"/../images/ospf%E7%A4%BA%E4%BE%8B/image-20230306105305401.png\" alt=\"image-20230306105305401\"></p>\n<p>断了之后</p>\n<p><img data-src=\"/../images/ospf%E7%A4%BA%E4%BE%8B/image-20230306105338791.png\" alt=\"image-20230306105338791\"></p>\n<h2 id=\"配置文件\"><a href=\"#配置文件\" class=\"headerlink\" title=\"配置文件\"></a>配置文件</h2><p>R1</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;R1&gt;dis cu </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">sysname R1</span></span><br><span class=\"line\">interface Ethernet0/0/0</span><br><span class=\"line\"> ip address 192.168.1.254 255.255.255.0</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">interface Ethernet0/0/1</span></span><br><span class=\"line\"> ip address 10.10.13.1 255.255.255.0</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">interface GigabitEthernet0/0/0</span></span><br><span class=\"line\"> ip address 10.10.12.1 255.255.255.0</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">ospf 1 router-id 10.10.10.10</span></span><br><span class=\"line\"> area 0.0.0.0</span><br><span class=\"line\">  network 10.10.13.0 0.0.0.255</span><br><span class=\"line\">  network 10.10.12.0 0.0.0.255</span><br><span class=\"line\">  network 192.168.1.0 0.0.0.255</span><br><span class=\"line\">return</span><br></pre></td></tr></table></figure>\n\n<p>R2</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;R2&gt;dis cu </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">sysname R2</span></span><br><span class=\"line\">interface Ethernet0/0/0</span><br><span class=\"line\"> ip address 10.10.12.2 255.255.255.0</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">interface Ethernet0/0/1</span></span><br><span class=\"line\"> ip address 10.10.23.1 255.255.255.0</span><br><span class=\"line\">interface GigabitEthernet0/0/0</span><br><span class=\"line\"> ip address 192.168.2.254 255.255.255.0</span><br><span class=\"line\">ospf 1 router-id 20.20.20.20</span><br><span class=\"line\"> area 0.0.0.0</span><br><span class=\"line\">  network 10.10.12.0 0.0.0.255</span><br><span class=\"line\">  network 10.10.23.0 0.0.0.255</span><br><span class=\"line\">  network 192.168.2.0 0.0.0.255</span><br><span class=\"line\">return</span><br></pre></td></tr></table></figure>\n\n<p>R3</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;R3&gt;dis cu</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">sysname R3</span></span><br><span class=\"line\">interface Ethernet0/0/0</span><br><span class=\"line\"> ip address 10.10.13.2 255.255.255.0</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">interface Ethernet0/0/1</span></span><br><span class=\"line\"> ip address 10.10.23.2 255.255.255.0</span><br><span class=\"line\">interface GigabitEthernet0/0/0</span><br><span class=\"line\"> ip address 192.168.3.254 255.255.255.0</span><br><span class=\"line\">ospf 1 router-id 30.30.30.30</span><br><span class=\"line\"> area 0.0.0.0</span><br><span class=\"line\">  network 10.10.13.0 0.0.0.255</span><br><span class=\"line\">  network 10.10.23.0 0.0.0.255</span><br><span class=\"line\">  network 192.168.3.0 0.0.0.255</span><br><span class=\"line\">return</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n\n\n\n\n","categories":["交换机"],"tags":["交换机","ospf"]},{"title":"ppp协议","url":"/post/4a4c502f.html","content":"<p>PPP协议是在串行线IP协议SLIP（Serial Line Internet Protocol）的基础上发展起来的。由于SLIP协议具有只支持异步传输方式、无协商过程（尤其不能协商如双方IP地址等网络层属性）、只能承载IP一种网络层报文等缺陷，在发展过程中，逐步被PPP协议所替代。</p>\n<p>PPP协议有如下优点：</p>\n<ul>\n<li>对物理层而言，PPP既支持同步链路又支持异步链路，而X.25、FR（Frame Relay）等数据链路层协议仅支持同步链路，SLIP仅支持异步链路。</li>\n<li>PPP协议具有良好的扩展性，例如，当需要在以太网链路上承载PPP协议时，PPP可以扩展为PPPoE。</li>\n<li>提供LCP（Link Control Protocol）协议，用于各种链路层参数的协商。</li>\n<li>提供各种NCP（Network Control Protocol）协议（如IPCP、IPXCP），用于各网络层参数的协商，更好地支持了网络层协议。</li>\n<li>提供认证协议CHAP（Challenge-Handshake Authentication Protocol）、PAP（Password Authentication Protocol），更好的保证了网络的安全性。</li>\n<li>无重传机制，网络开销小，速度快。</li>\n</ul>\n<span id=\"more\"></span>\n\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">link-protocol ppp  <span class=\"comment\"># 配置接口封装协议,默认</span></span><br><span class=\"line\"><span class=\"comment\"># 认证</span></span><br><span class=\"line\">ppp authentication-mode pap/chap      <span class=\"comment\"># 开启PAP/CHAP认证</span></span><br><span class=\"line\">aaa</span><br><span class=\"line\">\tlocal-user 账号 password cipher 密码 <span class=\"comment\"># 创建PPP 认证用户</span></span><br><span class=\"line\">\tlocal-user 账号 service-type ppp</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\"><span class=\"comment\"># 被认证</span></span><br><span class=\"line\">ppp pap local-user 账号 password cipher 密码 <span class=\"comment\"># 配置PAP凭证</span></span><br><span class=\"line\">ppp chap user 账号  <span class=\"comment\"># 配置chap 凭证</span></span><br><span class=\"line\">ppp chap password cipher 密码</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n","categories":["ppp"],"tags":["网络","ppp"]},{"title":"linux文本处理三剑客","url":"/post/a67340ea.html","content":"<p>awk、grep、sed是linux操作文本的三大利器，合称文本三剑客，也是必须掌握的linux命令之一。三者的功能都是处理文本，但侧重点各不相同，其中属awk功能最强大，但也最复杂。</p>\n<p><strong>grep更适合单纯的查找或匹配文本，sed更适合编辑匹配到的文本，awk更适合格式化文本，对文本进行较复杂格式处理。</strong></p>\n<span id=\"more\"></span>\n\n<h1 id=\"grep\"><a href=\"#grep\" class=\"headerlink\" title=\"grep\"></a>grep</h1><h2 id=\"什么是grep和egrep\"><a href=\"#什么是grep和egrep\" class=\"headerlink\" title=\"什么是grep和egrep\"></a>什么是grep和egrep</h2><p>Linux系统中grep命令是一种强大的文本搜索工具，它能使用<strong>正则表达式</strong>搜索文本，并把匹配的行打印出来（匹配到的标红）。grep全称是Global Regular Expression Print，表示全局正则表达式版本，它的使用权限是所有用户。</p>\n<p>　　grep的工作方式是这样的，它在一个或多个文件中搜索字符串模板。如果模板包括空格，则必须被引用，模板后的所有字符串被看作文件名。搜索的结果被送到标准输出，不影响原文件内容。</p>\n<p>　　grep可用于shell脚本，因为grep通过返回一个状态值来说明搜索的状态，如果模板搜索成功，则返回0，如果搜索不成功，则返回1，如果搜索的文件不存在，则返回2。我们利用这些返回值就可进行一些自动化的文本处理工作。</p>\n<p>　　<strong>egrep &#x3D; grep -E：扩展的正则表达式</strong> （除了<strong>&lt; , &gt; , \\b</strong> 使用其他正则都可以去掉\\）</p>\n<p>正则推荐学习网站:<a href=\"https://regexlearn.com/zh-cn\">https://regexlearn.com/zh-cn</a></p>\n<h2 id=\"使用grep\"><a href=\"#使用grep\" class=\"headerlink\" title=\"使用grep\"></a>使用grep</h2><h3 id=\"grep命令格式\"><a href=\"#grep命令格式\" class=\"headerlink\" title=\"grep命令格式\"></a>grep命令格式</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">grep [option] pattern file</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"命令参数\"><a href=\"#命令参数\" class=\"headerlink\" title=\"命令参数\"></a>命令参数</h3><ul>\n<li>-A&lt;显示行数&gt;：除了显示符合范本样式的那一列之外，并显示该行之后的内容。</li>\n<li>-B&lt;显示行数&gt;：除了显示符合样式的那一行之外，并显示该行之前的内容。</li>\n<li>-C&lt;显示行数&gt;：除了显示符合样式的那一行之外，并显示该行之前后的内容。</li>\n<li>-c：统计匹配的行数</li>\n<li>-e ：实现多个选项间的逻辑or 关系</li>\n<li>-E：扩展的正则表达式</li>\n<li>-f FILE：从FILE获取PATTERN匹配</li>\n<li>-F ：相当于fgrep</li>\n<li>-i –ignore-case #忽略字符大小写的差别。</li>\n<li>-n：显示匹配的行号</li>\n<li>-o：仅显示匹配到的字符串</li>\n<li>-q： 静默模式，不输出任何信息</li>\n<li>-s：不显示错误信息。</li>\n<li>-v：显示不被pattern 匹配到的行，相当于[^] 反向匹配</li>\n<li>-w ：匹配 整个单词</li>\n</ul>\n<h3 id=\"实例\"><a href=\"#实例\" class=\"headerlink\" title=\"实例\"></a>实例</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 准备一个测试文件</span></span><br><span class=\"line\">aaaaa</span><br><span class=\"line\">bbbbbb</span><br><span class=\"line\">ccccCCC</span><br><span class=\"line\">ddDDDdd</span><br><span class=\"line\">ABCD</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929133234367.png\" alt=\"image-20220929133234367\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 显示匹配到的b的那一行,并显示后面2行</span></span><br><span class=\"line\">grep -A2 b test.txt</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929133423071.png\" alt=\"image-20220929133423071\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 显示匹配到b的那一行,并显示之前1行</span></span><br><span class=\"line\">grep -B1 b test.txt </span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929133647430.png\" alt=\"image-20220929133647430\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 显示匹配到b的那一行,并显示前后1行</span></span><br><span class=\"line\">grep -C1 b test.txt</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929133752685.png\" alt=\"image-20220929133752685\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 统计匹配到的行数</span></span><br><span class=\"line\">grep -c D test.txt</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929133953358.png\" alt=\"image-20220929133953358\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 实现多个选项间的逻辑or关系</span></span><br><span class=\"line\">grep -e a -e c test.txt</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929134436988.png\" alt=\"image-20220929134436988\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 从FILE获取PATTERN匹配</span></span><br><span class=\"line\">grep -f pattern test.txt</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929135042896.png\" alt=\"image-20220929135042896\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  -i --ignore-case #忽略字符大小写的差别</span></span><br><span class=\"line\">grep -i d  test.txt</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929135222339.png\" alt=\"image-20220929135222339\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -n：显示匹配的行号</span></span><br><span class=\"line\">grep -n D  test.txt</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929135316963.png\" alt=\"image-20220929135316963\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -o：仅显示匹配到的字符串</span></span><br><span class=\"line\">grep -o Dd  test.txt</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929135440679.png\" alt=\"image-20220929135440679\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -v：显示不被pattern 匹配到的行，相当于[^] 反向匹配</span></span><br><span class=\"line\">grep -v  d  test.txt</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929135610559.png\" alt=\"image-20220929135610559\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -w ：匹配 整个单词</span></span><br><span class=\"line\">grep -w  ABCD  test.txt</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929135720976.png\" alt=\"image-20220929135720976\"></p>\n<h3 id=\"补充\"><a href=\"#补充\" class=\"headerlink\" title=\"补充\"></a>补充</h3><p>一般我们使用grep都是配合管道符号 <code>|</code>使用的 比如查看nginx进程,</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看nginx进程,判断nginx是否开启</span></span><br><span class=\"line\">ps -aux | grep nginx</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929142145897.png\" alt=\"image-20220929142145897\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看80端口是否被占用</span></span><br><span class=\"line\">netstat -tunlp | grep 80</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929142306852.png\" alt=\"image-20220929142306852\"></p>\n<h1 id=\"sed\"><a href=\"#sed\" class=\"headerlink\" title=\"sed\"></a>sed</h1><h2 id=\"什么是sed\"><a href=\"#什么是sed\" class=\"headerlink\" title=\"什么是sed\"></a>什么是sed</h2><p>sed 是一种流编辑器，它一次处理一<strong>行</strong>内容。处理时，把当前处理的行存储在临时缓冲区中，称为“<strong>模式空间</strong>”（patternspace ），接着用sed 命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。然后读入下行，执行下一个循环。如果没有使诸如‘D’ 的特殊命令，那会在两个循环之间清空模式空间，但不会清空<strong>保留空间</strong>。这样不断重复，直到文件末尾。<strong>文件内容并没有改变</strong>，除非你使用<strong>重定向存储输出或-i</strong>。</p>\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/20200622105532480.png\" alt=\"20200622105532480\"></p>\n<p>　　功能：主要用来自动编辑一个或多个文件, 简化对文件的反复操作</p>\n<h2 id=\"sed的使用\"><a href=\"#sed的使用\" class=\"headerlink\" title=\"sed的使用\"></a>sed的使用</h2><h3 id=\"命令格式\"><a href=\"#命令格式\" class=\"headerlink\" title=\"命令格式\"></a>命令格式</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">sed  [options]  <span class=\"string\">&#x27;/pattern/ command&#x27;</span>  file(s)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"常用选项options\"><a href=\"#常用选项options\" class=\"headerlink\" title=\"常用选项options\"></a>常用选项options</h3><ul>\n<li><strong>-n</strong>：不输出模式空间内容到屏幕，即不自动打印，只打印匹配到的行</li>\n<li><strong>-e：</strong>多点编辑，对每行处理时，可以有多个Script</li>\n<li><strong>-f</strong>：把Script写到文件当中，在执行sed时-f 指定文件路径，如果是多个Script，换行写</li>\n<li><strong>-r</strong>：支持<strong>扩展的正则</strong>表达式</li>\n<li><strong>-i</strong>：直接将处理的结果写入文件</li>\n<li><strong>-i.bak</strong>：在将处理的结果写入文件之前备份一份</li>\n</ul>\n<h3 id=\"编辑命令command\"><a href=\"#编辑命令command\" class=\"headerlink\" title=\"编辑命令command\"></a>编辑命令command</h3><ul>\n<li><strong>d：删除</strong>模式空间匹配的行，并立即启用下一轮循环</li>\n<li><strong>p：打印</strong>当前模式空间内容，追加到默认输出之后</li>\n<li><strong>a</strong>：在指定行<strong>后面追加</strong>文本，支持使用\\n实现多行追加</li>\n<li><strong>i</strong>：在行<strong>前面插入</strong>文本，支持使用\\n实现多行追加</li>\n<li><strong>c</strong>：<strong>替换</strong>行为单行或多行文本，支持使用\\n实现多行追加</li>\n<li>w：保存模式匹配的行至指定文件</li>\n<li>r：读取指定文件的文本至模式空间中匹配到的行后</li>\n<li>&#x3D;：为模式空间中的行打印行号</li>\n<li><strong>!<strong>：模式空间中匹配行</strong>取反</strong>处理</li>\n<li>s&#x2F;&#x2F;&#x2F;：查找替换，支持使用其它分隔符，如：s@@@，s###；<ul>\n<li><strong>加g表示行内全局替换；</strong></li>\n<li>在替换时，可以加一下命令，实现大小写转换</li>\n<li>\\l：把下个字符转换成小写。</li>\n<li>\\L：把replacement字母转换成小写，直到\\U或\\E出现。</li>\n<li>\\u：把下个字符转换成大写。</li>\n<li>\\U：把replacement字母转换成大写，直到\\L或\\E出现。</li>\n<li>\\E：停止以\\L或\\U开始的大小写转换</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"sed实例\"><a href=\"#sed实例\" class=\"headerlink\" title=\"sed实例\"></a>sed实例</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 还是那个测试文件</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> test.txt</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929151337242.png\" alt=\"image-20220929151337242\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  p：匹配到的行会打印一遍，不匹配的行也会打印</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929153425829.png\" alt=\"image-20220929153425829\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -n：不输出模式空间内容到屏幕，即不自动打印，只打印匹配到的行</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929154541975.png\" alt=\"image-20220929154541975\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -e：多点编辑，对每行处理时，可以有多个Script</span></span><br><span class=\"line\">sed -n -e <span class=\"string\">&#x27;/D/p&#x27;</span> -e <span class=\"string\">&#x27;/a/p&#x27;</span> test.txt</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929155453651.png\" alt=\"image-20220929155453651\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -f：把Script写到文件当中，在执行sed时-f 指定文件路径，如果是多个Script，换行写</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929155703145.png\" alt=\"image-20220929155703145\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># a：在指定行后面追加文本，支持使用\\n实现多行追加</span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;2a 111&#x27;</span> test.txt  <span class=\"comment\">#在第二行后面加上111</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929160545221.png\" alt=\"image-20220929160545221\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  i：在行前面插入文本，支持使用\\n实现多行追加</span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;2i 111&#x27;</span> test.txt  <span class=\"comment\"># 在第二行前面加上111</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929160951595.png\" alt=\"image-20220929160951595\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  c：替换行为单行或多行文本，支持使用\\n实现多行追加</span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;2c 111\\n222&#x27;</span> test.txt <span class=\"comment\"># 替换第二行 \\n 再添加一行</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929161329686.png\" alt=\"image-20220929161329686\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># w：保存模式匹配的行至指定文件</span></span><br><span class=\"line\">sed  <span class=\"string\">&#x27;/bbb/w 1.txt&#x27;</span> test.txt <span class=\"comment\"># 将匹配到的写入1.txt</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929162354187.png\" alt=\"image-20220929162354187\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># r：读取指定文件的文本至模式空间中匹配到的行后</span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;3 r 1.txt&#x27;</span> test.txt <span class=\"comment\"># 将1.txt中的内容读取并追加到test第三行后面</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929162834407.png\" alt=\"image-20220929162834407\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  =：为模式空间中的行打印行号</span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;=&#x27;</span> test.txt </span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929164239888.png\" alt=\"image-20220929164239888\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  !：模式空间中匹配行取反处理</span></span><br><span class=\"line\">sed -n <span class=\"string\">&#x27;/aaa/!p&#x27;</span> test.txt</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929164759315.png\" alt=\"image-20220929164759315\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># s///：查找替换，支持使用其它分隔符，如：s@@@，s###；</span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;s/bbb/111/&#x27;</span> test.txt  <span class=\"comment\"># 将bbb替换为111</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929165839261.png\" alt=\"image-20220929165839261\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 加g表示行内全局替换；</span></span><br><span class=\"line\">sed <span class=\"string\">&#x27;s/bbb/111/g&#x27;</span> test.txt</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20220929165939258.png\" alt=\"image-20220929165939258\"></p>\n<h1 id=\"awk\"><a href=\"#awk\" class=\"headerlink\" title=\"awk\"></a>awk</h1><h2 id=\"什么是awk\"><a href=\"#什么是awk\" class=\"headerlink\" title=\"什么是awk\"></a>什么是awk</h2><p>awk是一种编程语言，用于在linux&#x2F;unix下对文本和数据进行处理。数据可以来自标准输入(stdin)、一个或多个文件，或其它命令的输出。它<strong>支持用户自定义函数</strong>和动态正则表达式等先进功能，是linux&#x2F;unix下的一个强大编程工具。它在命令行中使用，但更多是作为脚本来使用。<strong>awk有很多内建的功能</strong>，比如数组、函数等，这是它和C语言的相同之处，灵活性是awk最大的优势。</p>\n<p>　　awk其实不仅仅是工具软件，还是一种编程语言。不过，本文只介绍它的命令行用法，对于大多数场合，应该足够用了。</p>\n<h2 id=\"awk的使用\"><a href=\"#awk的使用\" class=\"headerlink\" title=\"awk的使用\"></a>awk的使用</h2><h3 id=\"命令格式-1\"><a href=\"#命令格式-1\" class=\"headerlink\" title=\"命令格式\"></a>命令格式</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">awk [options] <span class=\"string\">&#x27;script&#x27;</span> var=value file(s)</span><br><span class=\"line\">awk [options] -f scriptfile var=value file(s)</span><br></pre></td></tr></table></figure>\n\n<p><strong>常用命令选项</strong></p>\n<ul>\n<li>-F fs   fs指定输入分隔符，fs可以是字符串或正则表达式，如-F:</li>\n<li>-v var&#x3D;value   赋值一个用户定义变量，将外部变量传递给awk</li>\n<li>-f scripfile  从脚本文件中读取awk命令</li>\n</ul>\n<h3 id=\"语法结构\"><a href=\"#语法结构\" class=\"headerlink\" title=\"语法结构\"></a>语法结构</h3><p>awk是由<em>pattern</em>和<em>action</em>组成， pattern 表示 AWK 在数据中查找的内容，而 action 是在找到匹配内容时所执行的一系列命令.</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">awk <span class=\"string\">&#x27;&#123;pattern + action&#125;&#x27;</span> &#123;filenames&#125;</span><br></pre></td></tr></table></figure>\n\n<p>pattern 可以是如下几种或者什么都没有（全部匹配）：</p>\n<ul>\n<li>&#x2F;正则表达式&#x2F;：使用通配符的扩展集。</li>\n<li>关系表达式：使用运算符进行操作，可以是字符串或数字的比较测试。</li>\n<li>模式匹配表达式：用运算符<del>（匹配）和</del>!（不匹配）。</li>\n<li>BEGIN语句块、pattern语句块、END语句块：参见awk的工作原理</li>\n</ul>\n<p>action 由一个或多个命令、函数、表达式组成，之间由换行符或分号隔开，并位于大括号内，可以是如下几种，或者什么都没有（print）</p>\n<ul>\n<li>变量或数组赋值</li>\n<li>输出命令</li>\n<li>内置函数</li>\n<li>控制流语句</li>\n</ul>\n<h3 id=\"awk常见应用和工作原理\"><a href=\"#awk常见应用和工作原理\" class=\"headerlink\" title=\"awk常见应用和工作原理\"></a>awk常见应用和工作原理</h3><p>下面列出一个最常用的awk命令结构，借此分析原理</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">awk <span class=\"string\">&#x27;BEGIN&#123; commands &#125; pattern&#123; commands &#125; END&#123; commands &#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>首先执行 <code>BEGIN &#123;commands&#125;</code> 内的语句块，注意这只会执行一次，经常用于变量初始化，头行打印一些表头信息，只会执行一次，在通过stdin读入数据前就被执行；</li>\n<li>从文件内容中读取一行，注意<strong>awk是以行为单位处理的，每读取一行使用</strong> <strong><code>pattern&#123;commands&#125;</code></strong> <strong>循环处理</strong> 可以理解成一个for循环，这也是最重要的部分；</li>\n<li>最后执行 <code>END&#123; commands &#125;</code> ,也是执行一次，在所有行处理完后执行，一帮用于打印一些统计结果。</li>\n</ul>\n<p>实例:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cat</span> -n /etc/passwd | awk -F <span class=\"string\">&#x27;:&#x27;</span> <span class=\"string\">&#x27;BEGIN &#123;print &quot;start&quot;&#125; &#123; print  $1,$2&#125; END &#123;print &quot;end&quot;&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"># -F &#x27;:&#x27;  以逗号为分隔符 默认为空格</span></span><br><span class=\"line\"><span class=\"comment\"># BEGIN 执行打印start 且只打印一次</span></span><br><span class=\"line\"><span class=\"comment\"># 正常执行 </span></span><br><span class=\"line\"><span class=\"comment\"># print $1,$2 打印第一列,第二列</span></span><br><span class=\"line\"><span class=\"comment\"># END 执行end 且只打印一次</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20221008162809171.png\" alt=\"image-20221008162809171\"></p>\n<h3 id=\"awk的内置变量\"><a href=\"#awk的内置变量\" class=\"headerlink\" title=\"awk的内置变量\"></a>awk的内置变量</h3><ul>\n<li><strong>FS</strong> ：<strong>输入字段分隔符</strong>，<strong>默认为空白字符</strong></li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">head</span> -n 5 passwd.bak | awk -v FS=<span class=\"string\">&#x27;:&#x27;</span> <span class=\"string\">&#x27;&#123;print $1,$2&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20221009085738131.png\" alt=\"image-20221009085738131\"></p>\n<ul>\n<li><strong>OFS</strong> ：<strong>输出字段分隔符</strong>，默认为空白字符</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">head</span> -n 5 passwd.bak | awk -v FS=<span class=\"string\">&#x27;:&#x27;</span> -v OFS=<span class=\"string\">&#x27;----&#x27;</span> <span class=\"string\">&#x27;&#123;print $1,$2&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20221009085858108.png\" alt=\"image-20221009085858108\"></p>\n<ul>\n<li>RS ：<strong>输入记录分隔符</strong>，指定输入时的换行符，原换行符仍有效,原来是以<code>\\n</code> 作为行分隔符</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看测试文件</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> RStest.txt </span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20221009090939008.png\" alt=\"image-20221009090939008\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 以空格为行分隔符</span></span><br><span class=\"line\">awk -v RS=<span class=\"string\">&#x27; &#x27;</span> <span class=\"string\">&#x27;&#123;print &#125;&#x27;</span> RStest.txt</span><br></pre></td></tr></table></figure>\n\n\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20221009090958640.png\" alt=\"image-20221009090958640\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 以段落为分隔符</span></span><br><span class=\"line\">awk -v RS=<span class=\"string\">&#x27;&#x27;</span> <span class=\"string\">&#x27;&#123;print &#125;&#x27;</span> RStest.txt</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20221009091226879.png\" alt=\"image-20221009091226879\"></p>\n<ul>\n<li>ORS ：<strong>输出记录分隔符</strong>，输出时用指定符号代替换行符</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 输出的时候不再用原来的`\\n` 而是改成指定的</span></span><br><span class=\"line\">awk -v ORS=<span class=\"string\">&#x27;====&#x27;</span> <span class=\"string\">&#x27;&#123;print $1 &#125;&#x27;</span> RStest.txt </span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20221009091833721.png\" alt=\"image-20221009091833721\"></p>\n<ul>\n<li><strong>NF</strong> ：字段数量，<strong>共有</strong>多少字段， <strong>$NF引用最后一列，$(NF-1)引用倒数第2列</strong></li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># NF显示字段数量</span></span><br><span class=\"line\">awk <span class=\"string\">&#x27;&#123;print $0,NF&#125;&#x27;</span> RStest.txt </span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20221009092203782.png\" alt=\"image-20221009092203782\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># $NF引用最后一列</span></span><br><span class=\"line\">awk <span class=\"string\">&#x27;&#123;print $NF&#125;&#x27;</span> RStest.txt</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20221009092301063.png\" alt=\"image-20221009092301063\"></p>\n<ul>\n<li><strong>NR</strong> ：<strong>行号</strong>，后可跟多个文件，第二个文件行号继续从第一个文件最后行号开始</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 显示行号</span></span><br><span class=\"line\">awk <span class=\"string\">&#x27;&#123;print NR, $0&#125;&#x27;</span> RStest.txt </span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20221009092415427.png\" alt=\"image-20221009092415427\"></p>\n<ul>\n<li>FNR ：各文件分别计数, 行号，后跟一个文件和NR一样，跟多个文件，第二个文件<strong>行号从1开始</strong> 单个文件与NR没区别</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">awk <span class=\"string\">&#x27;&#123;print FNR,$0&#125;&#x27;</span> RStest.txt</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20221009093022957.png\" alt=\"image-20221009093022957\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">awk <span class=\"string\">&#x27;&#123;print FNR,$0&#125;&#x27;</span> RStest.txt RStest.txt</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20221009093044682.png\" alt=\"image-20221009093044682\"></p>\n<ul>\n<li>FILENAME ：<strong>当前文件名</strong></li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">awk <span class=\"string\">&#x27;&#123;print FILENAME,$0&#125;&#x27;</span> RStest.txt</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20221009093824115.png\" alt=\"image-20221009093824115\"></p>\n<ul>\n<li><p>ARGC ：<strong>命令行参数</strong>的个数</p>\n</li>\n<li><p>ARGV ：数组，保存的是命令行所给定的各参数，<strong>查看参数</strong></p>\n</li>\n</ul>\n<h3 id=\"自定义变量\"><a href=\"#自定义变量\" class=\"headerlink\" title=\"自定义变量\"></a>自定义变量</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 用-v 自义定变量</span></span><br><span class=\"line\">awk -v name=<span class=\"string\">&#x27;123&#x27;</span> <span class=\"string\">&#x27;&#123;print name&#125;&#x27;</span> RStest.txt</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20221009094432611.png\" alt=\"image-20221009094432611\"></p>\n<h2 id=\"常用实例\"><a href=\"#常用实例\" class=\"headerlink\" title=\"常用实例\"></a>常用实例</h2><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 在 a b c d  的b 后面插入新字段 e f g</span></span><br><span class=\"line\"><span class=\"comment\"># 将$2 重新赋值,再打印,两个命令用分号隔开</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;a b c d &#x27;</span> | awk <span class=\"string\">&#x27;&#123;$2=$2&quot; e f g&quot;;print&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20221009100423723.png\" alt=\"image-20221009100423723\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 从ifconfig命令的结果中筛选出除了lo网卡外的所有IPV4地址.</span></span><br><span class=\"line\">ifconfig | awk <span class=\"string\">&#x27;/inet /&amp;&amp;$2!~/127/ &#123;print $2&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20221009110955242.png\" alt=\"image-20221009110955242\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 读取配置文件中的某一段配置</span></span><br><span class=\"line\"><span class=\"comment\"># 比如说我们要读取yum配置文件中的中间一段</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20221009111429559.png\" alt=\"image-20221009111429559\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim 1.awk</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 匹配centosplus,[] 需要用转义符号\\</span></span><br><span class=\"line\">/\\[centosplus\\]/&#123;</span><br><span class=\"line\"><span class=\"comment\"># 打印</span></span><br><span class=\"line\">  <span class=\"built_in\">print</span></span><br><span class=\"line\">  <span class=\"comment\"># 获取每一行</span></span><br><span class=\"line\">  <span class=\"comment\"># getline &gt; 0 表示有数据</span></span><br><span class=\"line\">  <span class=\"comment\"># getline = 0 表示遇到结尾</span></span><br><span class=\"line\">  <span class=\"comment\"># getline &lt; 0 表示有错误</span></span><br><span class=\"line\">  <span class=\"keyword\">while</span> ((getline var)&gt;0)&#123;</span><br><span class=\"line\">  <span class=\"comment\"># 当var 遇到下一个[] 退出 </span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (var~/\\[.*\\]/)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">exit</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">  <span class=\"comment\"># 打印var</span></span><br><span class=\"line\">  <span class=\"built_in\">print</span> var</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">awk -f 1.awk /etc/yum.repos.d/CentOS-Base.repo</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20221009154416803.png\" alt=\"image-20221009154416803\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 去重</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> 1.txt </span><br><span class=\"line\">aa </span><br><span class=\"line\">aa</span><br><span class=\"line\">aa</span><br><span class=\"line\">bb</span><br><span class=\"line\">bb</span><br><span class=\"line\">cc</span><br><span class=\"line\">cc</span><br><span class=\"line\"><span class=\"comment\"># 用数组arr 将$1存起来,arr[$1]次数+1,然后判断arr[$1]是不是第一次出现,如果是第一次就打印</span></span><br><span class=\"line\">awk <span class=\"string\">&#x27;&#123;arr[$1]=arr[$1]+1;if(arr[$1]==1)&#123;print&#125;&#125;&#x27;</span> 1.txt</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20221009141427509.png\" alt=\"image-20221009141427509\"></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 统计数量</span></span><br><span class=\"line\"><span class=\"comment\"># 用数组将出现的arr[$1]存起来,</span></span><br><span class=\"line\"><span class=\"comment\"># 打印</span></span><br><span class=\"line\">awk <span class=\"string\">&#x27;&#123;arr[$1]=arr[$1]+1&#125;END&#123;for (i in arr)&#123;print arr[i],i&#125;&#125;&#x27;</span> 1.txt</span><br><span class=\"line\"><span class=\"comment\"># 更简单</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> 1.txt  | <span class=\"built_in\">uniq</span> -c</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 取字段中的指定字段数量</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> 2.txt</span><br><span class=\"line\">1 001dfad</span><br><span class=\"line\">2 003asda</span><br><span class=\"line\">3 00412312</span><br><span class=\"line\">4 006123asda</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 用substr获取子串</span></span><br><span class=\"line\">awk <span class=\"string\">&#x27;&#123;print $1,substr($2,1,3)&#125;&#x27;</span> 2.txt</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/linux%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2/image-20221010144225925.png\" alt=\"image-20221010144225925\"></p>\n","categories":["linux"],"tags":["linux","grep","sed","awk"]},{"title":"python-socketio","url":"/post/b788502e.html","content":"<p>Socket.IO is a transport protocol that enables real-time bidirectional event-based communication between clients (typically, though not always, web browsers) and a server. The official implementations of the client and server components are written in JavaScript. This package provides Python implementations of both, each with standard and asyncio variants.</p>\n<p>Socket.IO是一种传输协议,用于 服务器与客户端之间的real-time实时通讯的.是用js写的,python-socketio软件包提供了两种Python的实现方式.一种是异步的一种标准的,但是异步这玩意更新的不完善,有很多坑,所以我们这里还是用标准的.</p>\n<span id=\"more\"></span>\n\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"服务端\"><a href=\"#服务端\" class=\"headerlink\" title=\"服务端\"></a>服务端</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Eventlet is a concurrent networking library for Python that allows you to change how you run your code, not how you write it.</span></span><br><span class=\"line\"><span class=\"comment\"># 这段摘自官方文档介绍，Evenlet是一个Python的基于携程的网络库，它改变了你代码运行的方式，但是没有改变你怎么写代码</span></span><br><span class=\"line\"><span class=\"comment\"># eventlet 一个是处理和网络相关的，另一个可以通过协程实现并发</span></span><br><span class=\"line\"><span class=\"comment\"># 随eventlet一起部署的Socket.IO服务器可以访问长轮询和WebSocket传输。</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> eventlet</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Eventlet提供的monkey_patch()功能可以用等效的异步版本替换标准库中的所有阻塞功能。尽管python-socketio不需要猴子补丁，但其他类库（例如数据库驱动程序）也可能需要它</span></span><br><span class=\"line\">eventlet.monkey_patch()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> socketio</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 实例化服务器</span></span><br><span class=\"line\"><span class=\"comment\"># cors_allowed_origins 跨域请求</span></span><br><span class=\"line\"><span class=\"comment\"># logger,engineio_logger 日志输出方便查看</span></span><br><span class=\"line\">sio = socketio.Server(logger=<span class=\"literal\">True</span>, engineio_logger=<span class=\"literal\">True</span>,cors_allowed_origins=<span class=\"string\">&#x27;*&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\"># 用一个WSGI应用程序封装</span></span><br><span class=\"line\">app = socketio.WSGIApp(sio)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># connect跟disconnect 是特殊的两个事件,连接或断开时会自动调用</span></span><br><span class=\"line\"><span class=\"meta\">@sio.event</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">connect</span>(<span class=\"params\">sid, environ</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;connect &#x27;</span>, sid)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 定义事件,有两种方式一种是用函数名另一种就是自定义的</span></span><br><span class=\"line\"><span class=\"comment\"># @sio.on(&#x27;my custom event&#x27;)</span></span><br><span class=\"line\"><span class=\"meta\">@sio.event</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">my_message</span>(<span class=\"params\">sid, data</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;message &#x27;</span>, data)</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\"># 接收客户端发来的消息</span></span><br><span class=\"line\"><span class=\"meta\">@sio.on(<span class=\"params\"><span class=\"string\">&#x27;my response&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">response</span>(<span class=\"params\">sid,data</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(sid)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(data)</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\"># connect跟disconnect 是特殊的两个事件,连接或断开时会自动调用</span></span><br><span class=\"line\"><span class=\"meta\">@sio.event</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">disconnect</span>(<span class=\"params\">sid</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;disconnect &#x27;</span>, sid)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    SERVER_ADDRESS = (<span class=\"string\">&#x27;127.0.0.1&#x27;</span>,<span class=\"number\">8000</span>)</span><br><span class=\"line\">    sock = eventlet.listen(SERVER_ADDRESS)</span><br><span class=\"line\">    eventlet.wsgi.server(sock, app)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"客户端\"><a href=\"#客户端\" class=\"headerlink\" title=\"客户端\"></a>客户端</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> socketio</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 实例化</span></span><br><span class=\"line\">sio = socketio.Client()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 默认连接时执行</span></span><br><span class=\"line\"><span class=\"meta\">@sio.event</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">connect</span>():</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;connection established&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 监听事件</span></span><br><span class=\"line\"><span class=\"meta\">@sio.event</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">my_message</span>(<span class=\"params\">data</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;message received with &#x27;</span>, data)</span><br><span class=\"line\">    <span class=\"comment\"># 发送事件sio.emit(对方事件名,data)</span></span><br><span class=\"line\">    sio.emit(<span class=\"string\">&#x27;my response&#x27;</span>, &#123;<span class=\"string\">&#x27;response&#x27;</span>: <span class=\"string\">&#x27;my response&#x27;</span>&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 默认断开时执行</span></span><br><span class=\"line\"><span class=\"meta\">@sio.event</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">disconnect</span>():</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;disconnected from server&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 连接</span></span><br><span class=\"line\">sio.connect(<span class=\"string\">&#x27;http://127.0.0.1:8000&#x27;</span>)</span><br><span class=\"line\">sio.wait()</span><br></pre></td></tr></table></figure>\n\n<p>客户端跟服务端搭建好了,那么怎么如何通信呢?</p>\n<p>我们可以通过</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 发送事件sio.emit(对方事件名,data,房间号) 服务端房间号不写的话是群发给客户端</span></span><br><span class=\"line\">sio.emit(<span class=\"string\">&#x27;my response&#x27;</span>, &#123;<span class=\"string\">&#x27;response&#x27;</span>: <span class=\"string\">&#x27;my response&#x27;</span>&#125;,room=sid)</span><br><span class=\"line\"><span class=\"comment\"># emit 发送事件</span></span><br><span class=\"line\"><span class=\"comment\"># send 相当于发送一个message事件,而且是群发的</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"使用消息队列\"><a href=\"#使用消息队列\" class=\"headerlink\" title=\"使用消息队列\"></a>使用消息队列</h2><h3 id=\"Redis\"><a href=\"#Redis\" class=\"headerlink\" title=\"Redis\"></a>Redis</h3><p>要使用Redis消息队列，必须安装Python Redis客户端</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">pip install redis</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># socketio.Server class</span></span><br><span class=\"line\"><span class=\"comment\"># 配置redismanager</span></span><br><span class=\"line\">mgr = socketio.RedisManager(<span class=\"string\">&#x27;redis://&#x27;</span>)</span><br><span class=\"line\">sio = socketio.Server(client_manager=mgr)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"RabbitMQ\"><a href=\"#RabbitMQ\" class=\"headerlink\" title=\"RabbitMQ\"></a>RabbitMQ</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 需要安装kombu</span></span><br><span class=\"line\">pip install kombu</span><br><span class=\"line\"></span><br><span class=\"line\">mgr = socketio.KombuManager(<span class=\"string\">&#x27;amqp://&#x27;</span>)</span><br><span class=\"line\">sio = socketio.Server(client_manager=mgr)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"从外部发送消息\"><a href=\"#从外部发送消息\" class=\"headerlink\" title=\"从外部发送消息\"></a>从外部发送消息</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># connect to the redis queue as an external process</span></span><br><span class=\"line\"></span><br><span class=\"line\">external_sio = socketio.RedisManager(<span class=\"string\">&#x27;redis://&#x27;</span>, write_only=<span class=\"literal\">True</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># emit an event</span></span><br><span class=\"line\">external_sio.emit(<span class=\"string\">&#x27;my event&#x27;</span>, data=&#123;<span class=\"string\">&#x27;foo&#x27;</span>: <span class=\"string\">&#x27;bar&#x27;</span>&#125;, room=<span class=\"string\">&#x27;my room&#x27;</span>)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"消息队列示例\"><a href=\"#消息队列示例\" class=\"headerlink\" title=\"消息队列示例\"></a>消息队列示例</h2><p>条件有限,我们这里用redis</p>\n<h3 id=\"服务端-1\"><a href=\"#服务端-1\" class=\"headerlink\" title=\"服务端\"></a>服务端</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 服务端其实就起到一个将客户端加入房间的作用</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> eventlet</span><br><span class=\"line\">eventlet.monkey_patch()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> socketio</span><br><span class=\"line\"></span><br><span class=\"line\">mgr = socketio.RedisManager(<span class=\"string\">&#x27;redis://127.0.0.1:6379/0&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 实例化服务器</span></span><br><span class=\"line\">sio = socketio.Server(client_manager=mgr, logger=<span class=\"literal\">True</span>, engineio_logger=<span class=\"literal\">True</span>,cors_allowed_origins=<span class=\"string\">&#x27;*&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\"># 用一个WSGI应用程序封装</span></span><br><span class=\"line\">app = socketio.WSGIApp(sio)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># connect跟disconnect 是特殊的两个事件,连接或断开时会自动调用</span></span><br><span class=\"line\"><span class=\"meta\">@sio.event</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">connect</span>(<span class=\"params\">sid, environ</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;connect &#x27;</span>, sid)</span><br><span class=\"line\">    <span class=\"comment\"># 当客户端连接时将客户端放入指定房间</span></span><br><span class=\"line\">    <span class=\"comment\"># 当然 你也可以从environ 中获取客户端传过来的room_id</span></span><br><span class=\"line\">    sio.enter_room(sid,room=<span class=\"string\">&#x27;user_1&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@sio.event</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">disconnect</span>(<span class=\"params\">sid</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;disconnect &#x27;</span>, sid)</span><br><span class=\"line\">    <span class=\"comment\"># 当客户端离开时,我们就删除这个房间</span></span><br><span class=\"line\">    rooms = sio.rooms(sid)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> room <span class=\"keyword\">in</span> rooms:</span><br><span class=\"line\">        sio.leave_room(sid, room)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    SERVER_ADDRESS = (<span class=\"string\">&#x27;&#x27;</span>, <span class=\"number\">8000</span>)</span><br><span class=\"line\">    sock = eventlet.listen(SERVER_ADDRESS)</span><br><span class=\"line\">    eventlet.wsgi.server(sock, app)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"客户端-1\"><a href=\"#客户端-1\" class=\"headerlink\" title=\"客户端\"></a>客户端</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> socketio</span><br><span class=\"line\"></span><br><span class=\"line\">sio = socketio.Client()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@sio.event</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">connect</span>():</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;connection established&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 接收外部用户发送的消息</span></span><br><span class=\"line\"><span class=\"meta\">@sio.event</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">mgr_tst</span>(<span class=\"params\">data</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;message received with &#x27;</span>, data)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@sio.event</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">disconnect</span>():</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;disconnected from server&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">sio.connect(<span class=\"string\">&#x27;http://127.0.0.1:8000&#x27;</span>)</span><br><span class=\"line\">sio.wait()</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"模拟外部发送消息\"><a href=\"#模拟外部发送消息\" class=\"headerlink\" title=\"模拟外部发送消息\"></a>模拟外部发送消息</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> socketio</span><br><span class=\"line\"></span><br><span class=\"line\">mgr = socketio.RedisManager(<span class=\"string\">&#x27;redis://127.0.0.1:6379/0&#x27;</span>,write_only=<span class=\"literal\">True</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 这里其实是发送给客户端</span></span><br><span class=\"line\"><span class=\"comment\"># 这里坑了我好久,一开始我以为是发送给服务端然后服务端再转发给客户端,其实不是,是直接通过房间发送给指定客户端</span></span><br><span class=\"line\">mgr.emit(<span class=\"string\">&#x27;mgr_tst&#x27;</span>,data=<span class=\"string\">&#x27;client Msg&#x27;</span>,room=<span class=\"string\">&#x27;user_1&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n","categories":["实时通讯"],"tags":["im","websocket","socketio"]},{"title":"vue实现轮播图","url":"/post/ae4e76ad.html","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>最近项目需要移动端实现轮播图,查看文档,总结一下</p>\n<h2 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a>原理</h2><p><img data-src=\"/../images/vue%E5%AE%9E%E7%8E%B0%E8%BD%AE%E6%92%AD%E5%9B%BE/image-20200810235057262.png\" alt=\"image-20200810235057262\"></p>\n<p>轮播 其实就是让图片排在一排,等鼠标或手指让其显示在视口,可被看见的区域内.</p>\n<span id=\"more\"></span>\n\n<h2 id=\"制作轮播图\"><a href=\"#制作轮播图\" class=\"headerlink\" title=\"制作轮播图\"></a>制作轮播图</h2><h3 id=\"搭建基本dom结构\"><a href=\"#搭建基本dom结构\" class=\"headerlink\" title=\"搭建基本dom结构\"></a>搭建基本dom结构</h3><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>轮播图demo<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        * &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        </span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.swiper</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"comment\">/* 定义视口 */</span></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">200px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">300px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">100px</span> auto;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid red;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"comment\">/* 超出部分隐藏 */</span></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">overflow</span>: hidden;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        </span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.slides</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">display</span>: flex;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        </span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.slides</span> <span class=\"selector-tag\">li</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"comment\">/* 去掉前面的黑点 */</span></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">list-style</span>: none;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        </span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">li</span> <span class=\"selector-tag\">img</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;swiper&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">ul</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;slides&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">:key</span>=<span class=\"string\">&quot;index&quot;</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(item,index) in items&quot;</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">:src</span>=<span class=\"string\">&quot;item.url&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Vue</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"attr\">el</span>: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"title function_\">data</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"attr\">items</span>: [&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">id</span>: <span class=\"number\">1</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;/imgs/1.jpg&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;, &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">id</span>: <span class=\"number\">2</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;/imgs/2.jpg&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;, &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">id</span>: <span class=\"number\">3</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;/imgs/3.jpg&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;, &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">id</span>: <span class=\"number\">4</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;/imgs/4.jpg&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;, ]</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/vue%E5%AE%9E%E7%8E%B0%E8%BD%AE%E6%92%AD%E5%9B%BE/image-20200812185854004.png\" alt=\"image-20200812185854004\"></p>\n<h3 id=\"实现简单的轮播\"><a href=\"#实现简单的轮播\" class=\"headerlink\" title=\"实现简单的轮播\"></a>实现简单的轮播</h3><p>为了让每张图都填满整个视口,需要设置每个图片的宽度为视口宽度,整个的宽度就是所有图片宽度的总和</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>轮播图demo<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        * &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        </span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.swiper</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"comment\">/* 定义视口 */</span></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">200px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">300px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">100px</span> auto;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid red;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"comment\">/* 超出部分隐藏 */</span></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">overflow</span>: hidden;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        </span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.slides</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">display</span>: flex;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        </span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.slides</span> <span class=\"selector-tag\">li</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"comment\">/* 去掉前面的黑点 */</span></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">list-style</span>: none;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        </span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">li</span> <span class=\"selector-tag\">img</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;swiper&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;viewPortRef&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">ul</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;slides&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;box&quot;</span> <span class=\"attr\">:style</span>=<span class=\"string\">&quot;translateStyle&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">:key</span>=<span class=\"string\">&quot;index&quot;</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(item,index) in items&quot;</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">:src</span>=<span class=\"string\">&quot;item.url&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Vue</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"attr\">el</span>: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"title function_\">data</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 定时器</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"attr\">timer</span>: <span class=\"literal\">null</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 当前index</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"attr\">currentIndex</span>: <span class=\"number\">0</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 视口</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"attr\">viewport</span>: <span class=\"number\">0</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"attr\">items</span>: [&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">id</span>: <span class=\"number\">1</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;/imgs/1.jpg&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;, &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">id</span>: <span class=\"number\">2</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;/imgs/2.jpg&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;, &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">id</span>: <span class=\"number\">3</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;/imgs/3.jpg&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;, &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">id</span>: <span class=\"number\">4</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;/imgs/4.jpg&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;, ]</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"title function_\">mounted</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"comment\">// 初始化宽度</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"variable language_\">this</span>.<span class=\"title function_\">init</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 自动轮播</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"variable language_\">this</span>.<span class=\"title function_\">autoplay</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"attr\">methods</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"comment\">// 初始化</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">init</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 获取视口的宽度</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">viewport</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">$refs</span>.<span class=\"property\">viewPortRef</span>.<span class=\"property\">clientWidth</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"comment\">// 计算图片外层盒子的大小</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">$refs</span>.<span class=\"property\">box</span>.<span class=\"property\">style</span>.<span class=\"property\">width</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">items</span>.<span class=\"property\">length</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">viewport</span> + <span class=\"string\">&#x27;px&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"comment\">// 自动轮播 ,其实就是通过transition 偏移X</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">autoplay</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">timer</span> = <span class=\"built_in\">setInterval</span>(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span>++</span></span><br><span class=\"line\"><span class=\"language-javascript\">                            <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> === <span class=\"variable language_\">this</span>.<span class=\"property\">items</span>.<span class=\"property\">length</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                                <span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> = <span class=\"number\">0</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                            &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;, <span class=\"number\">2000</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"comment\">// 通过计算属性来获取偏移的X</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"attr\">computed</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">translateStyle</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">const</span> translate = <span class=\"string\">`translateX(-<span class=\"subst\">$&#123;<span class=\"variable language_\">this</span>.currentIndex*<span class=\"variable language_\">this</span>.viewport&#125;</span>px)`</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">transform</span>: translate</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/vue%E5%AE%9E%E7%8E%B0%E8%BD%AE%E6%92%AD%E5%9B%BE/GIF%202020-8-12%2019-23-23.gif\" alt=\"GIF 2020-8-12 19-23-23\"></p>\n<p>简单实现了轮播的效果,不过有点粗糙,我们加入过渡</p>\n<h3 id=\"加入过渡\"><a href=\"#加入过渡\" class=\"headerlink\" title=\"加入过渡\"></a>加入过渡</h3><p>单单在样式中加入过渡,我们会发现轮播到最后一张图片的时候,会转到第一张</p>\n<p><img data-src=\"/../images/vue%E5%AE%9E%E7%8E%B0%E8%BD%AE%E6%92%AD%E5%9B%BE/GIF%202020-8-12%2019-27-02.gif\" alt=\"GIF 2020-8-12 19-27-02\"></p>\n<p>这样的效果,我们并不希望得到,我们希望他是无缝的,</p>\n<p>修改</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">autoplay</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">timer</span> = <span class=\"built_in\">setInterval</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">isTransition</span> = <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span>++</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> === <span class=\"variable language_\">this</span>.<span class=\"property\">items</span>.<span class=\"property\">length</span>) &#123;</span><br><span class=\"line\">           <span class=\"variable language_\">this</span>.<span class=\"property\">isTransition</span> = <span class=\"literal\">false</span></span><br><span class=\"line\">           <span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> = <span class=\"number\">0</span></span><br><span class=\"line\">             &#125;</span><br><span class=\"line\">     &#125;, <span class=\"number\">2000</span>)</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/vue%E5%AE%9E%E7%8E%B0%E8%BD%AE%E6%92%AD%E5%9B%BE/GIF%202020-8-12%2019-37-15.gif\" alt=\"GIF 2020-8-12 19-37-15\"></p>\n<p>从最后一张跳到第一张还是有点不舒服,那么我们怎么办呢?</p>\n<p>我们需要重新定义一个列表</p>\n<p><img data-src=\"/../images/vue%E5%AE%9E%E7%8E%B0%E8%BD%AE%E6%92%AD%E5%9B%BE/image-20200812195232370.png\" alt=\"image-20200812195232370\"></p>\n<p>然后滚动到4的时候再到1然后再跳转到前面的1(当然最前面的4是为我们做滑动的时候准备的)</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>轮播图demo<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        * &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        </span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.swiper</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"comment\">/* 定义视口 */</span></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">200px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">300px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">100px</span> auto;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid red;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"comment\">/* 超出部分隐藏 */</span></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">overflow</span>: hidden;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        </span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.slides</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">display</span>: flex;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"comment\">/* 加入过渡 */</span></span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        </span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.slides</span> <span class=\"selector-tag\">li</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"comment\">/* 去掉前面的黑点 */</span></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">list-style</span>: none;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        </span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">li</span> <span class=\"selector-tag\">img</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;swiper&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;viewPortRef&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">ul</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;slides&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;box&quot;</span> <span class=\"attr\">:style</span>=<span class=\"string\">&quot;translateStyle&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">:key</span>=<span class=\"string\">&quot;index&quot;</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(item,index) in newList&quot;</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">:src</span>=<span class=\"string\">&quot;item.url&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Vue</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"attr\">el</span>: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"title function_\">data</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"attr\">newList</span>: [],</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 定时器</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"attr\">timer</span>: <span class=\"literal\">null</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 当前index</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"attr\">currentIndex</span>: <span class=\"number\">0</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 视口</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"attr\">viewport</span>: <span class=\"number\">0</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"attr\">isTransition</span>: <span class=\"literal\">false</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"attr\">items</span>: [&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">id</span>: <span class=\"number\">1</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;/imgs/1.jpg&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;, &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">id</span>: <span class=\"number\">2</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;/imgs/2.jpg&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;, &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">id</span>: <span class=\"number\">3</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;/imgs/3.jpg&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;, &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">id</span>: <span class=\"number\">4</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;/imgs/4.jpg&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;, ]</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"title function_\">mounted</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"comment\">// 初始化宽度</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"variable language_\">this</span>.<span class=\"title function_\">init</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 自动轮播</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"variable language_\">this</span>.<span class=\"title function_\">autoplay</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"attr\">methods</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"comment\">// 初始化</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">init</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">const</span> first = <span class=\"variable language_\">this</span>.<span class=\"property\">items</span>.<span class=\"title function_\">slice</span>(<span class=\"number\">0</span>, <span class=\"number\">1</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">const</span> last = <span class=\"variable language_\">this</span>.<span class=\"property\">items</span>.<span class=\"title function_\">slice</span>(-<span class=\"number\">1</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">newList</span> = [...last, ...<span class=\"variable language_\">this</span>.<span class=\"property\">items</span>, ...first]</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"comment\">// 获取视口的宽度</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">viewport</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">$refs</span>.<span class=\"property\">viewPortRef</span>.<span class=\"property\">clientWidth</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"comment\">// 计算图片外层盒子的大小</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">$refs</span>.<span class=\"property\">box</span>.<span class=\"property\">style</span>.<span class=\"property\">width</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">newList</span>.<span class=\"property\">length</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">viewport</span> + <span class=\"string\">&#x27;px&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"comment\">// 自动轮播 ,其实就是通过transition 偏移X</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">autoplay</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">timer</span> = <span class=\"built_in\">setInterval</span>(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"comment\">// 加上延时,造成视觉误差</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                            <span class=\"variable language_\">this</span>.<span class=\"property\">isTransition</span> = <span class=\"literal\">true</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                            <span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span>++</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        &#125;, <span class=\"number\">40</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> === <span class=\"variable language_\">this</span>.<span class=\"property\">newList</span>.<span class=\"property\">length</span> - <span class=\"number\">1</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                            <span class=\"variable language_\">this</span>.<span class=\"property\">isTransition</span> = <span class=\"literal\">false</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                            <span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> = <span class=\"number\">1</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                        &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;, <span class=\"number\">2000</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"comment\">// 通过计算属性来获取偏移的X</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"attr\">computed</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">translateStyle</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">const</span> translate = <span class=\"string\">`translateX(-<span class=\"subst\">$&#123;<span class=\"variable language_\">this</span>.currentIndex*<span class=\"variable language_\">this</span>.viewport&#125;</span>px)`</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">const</span> transition = <span class=\"variable language_\">this</span>.<span class=\"property\">isTransition</span> ? <span class=\"string\">&#x27;all 1s&#x27;</span> : <span class=\"string\">&#x27;none&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">transform</span>: translate,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">transition</span>: transition</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/vue%E5%AE%9E%E7%8E%B0%E8%BD%AE%E6%92%AD%E5%9B%BE/GIF%202020-8-12%2019-58-16.gif\" alt=\"GIF 2020-8-12 19-58-16\"></p>\n<h3 id=\"鼠标滑动\"><a href=\"#鼠标滑动\" class=\"headerlink\" title=\"鼠标滑动\"></a>鼠标滑动</h3><p>滑动有三个事件:</p>\n<p><code>touchstart</code> 按住时,<code>touchmove</code> 移动 ,<code>touchend</code> 结束 (当然这三个事件只在移动端有效)</p>\n<p>pc端需要<code>mousedown mousemove mouseup</code> 三个事件,这里我用到的是移动端</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">onTouchStart</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">               <span class=\"comment\">// 关闭自动播放</span></span><br><span class=\"line\">               <span class=\"variable language_\">this</span>.<span class=\"title function_\">stopplay</span>()</span><br><span class=\"line\">                   <span class=\"comment\">// 关闭过渡</span></span><br><span class=\"line\">               <span class=\"variable language_\">this</span>.<span class=\"property\">isTransition</span> = <span class=\"literal\">false</span></span><br><span class=\"line\">                   <span class=\"comment\">// 当前是0的时候,是最后第二个</span></span><br><span class=\"line\">               <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                   <span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">newList</span>.<span class=\"property\">length</span> - <span class=\"number\">2</span></span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> === <span class=\"variable language_\">this</span>.<span class=\"property\">newList</span>.<span class=\"property\">length</span> - <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                   <span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> = <span class=\"number\">1</span></span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               <span class=\"comment\">// 获取按住的X坐标位置</span></span><br><span class=\"line\">               <span class=\"variable language_\">this</span>.<span class=\"property\">toucheStartX</span> = e.<span class=\"property\">targetTouches</span>[<span class=\"number\">0</span>].<span class=\"property\">clientX</span>;</span><br><span class=\"line\">               <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">toucheStartX</span>);</span><br><span class=\"line\">           &#125;,</span><br><span class=\"line\">           <span class=\"title function_\">onTouchMove</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">               <span class=\"comment\">// 获取移动的偏移量</span></span><br><span class=\"line\">               <span class=\"variable language_\">this</span>.<span class=\"property\">offsetX</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">toucheStartX</span> - e.<span class=\"property\">targetTouches</span>[<span class=\"number\">0</span>].<span class=\"property\">clientX</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">           &#125;,</span><br><span class=\"line\">           <span class=\"title function_\">onTouchEnd</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">               <span class=\"comment\">// 开启效果</span></span><br><span class=\"line\">               <span class=\"variable language_\">this</span>.<span class=\"property\">isTransition</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\">               <span class=\"comment\">// 四舍五入</span></span><br><span class=\"line\">               <span class=\"keyword\">let</span> currentIndex = <span class=\"title class_\">Math</span>.<span class=\"title function_\">round</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">offsetX</span> / <span class=\"variable language_\">this</span>.<span class=\"property\">viewport</span>)</span><br><span class=\"line\">               <span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> = currentIndex + <span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span></span><br><span class=\"line\">                   <span class=\"comment\">// 重置offsetX</span></span><br><span class=\"line\">               <span class=\"variable language_\">this</span>.<span class=\"property\">offsetX</span> = <span class=\"number\">0</span></span><br><span class=\"line\">                   <span class=\"comment\">// 自动播放</span></span><br><span class=\"line\">               <span class=\"variable language_\">this</span>.<span class=\"title function_\">autoplay</span>()</span><br><span class=\"line\">           &#125;</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/vue%E5%AE%9E%E7%8E%B0%E8%BD%AE%E6%92%AD%E5%9B%BE/GIF%202020-8-12%2021-17-02.gif\" alt=\"GIF 2020-8-12 21-17-02\"></p>\n<h3 id=\"底部-小圆点\"><a href=\"#底部-小圆点\" class=\"headerlink\" title=\"底部 小圆点\"></a>底部 小圆点</h3><h4 id=\"添加dom\"><a href=\"#添加dom\" class=\"headerlink\" title=\"添加dom\"></a>添加dom</h4><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;swiper&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;viewPortRef&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">ul</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;slides&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;box&quot;</span> <span class=\"attr\">:style</span>=<span class=\"string\">&quot;translateStyle&quot;</span> @<span class=\"attr\">touchstart</span>=<span class=\"string\">&quot;onTouchStart&quot;</span> @<span class=\"attr\">touchmove</span>=<span class=\"string\">&quot;onTouchMove&quot;</span> @<span class=\"attr\">touchend</span>=<span class=\"string\">&quot;onTouchEnd&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">:key</span>=<span class=\"string\">&quot;index&quot;</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(item,index) in newList&quot;</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">:src</span>=<span class=\"string\">&quot;item.url&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;sliderListDot&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;sliderDot&quot;</span> <span class=\"attr\">:key</span>=<span class=\"string\">&quot;index&quot;</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(item,index) in items&quot;</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;&#123;active : activeIndex==index&#125;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"设计样式\"><a href=\"#设计样式\" class=\"headerlink\" title=\"设计样式\"></a>设计样式</h4><figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.sliderListDot</span> &#123;</span><br><span class=\"line\">          <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">          <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">          <span class=\"attribute\">bottom</span>: <span class=\"number\">20px</span>;</span><br><span class=\"line\">          <span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">          <span class=\"attribute\">transform</span>: <span class=\"built_in\">translateX</span>(-<span class=\"number\">50%</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"selector-class\">.sliderDot</span> &#123;</span><br><span class=\"line\">          <span class=\"attribute\">width</span>: <span class=\"number\">14px</span>;</span><br><span class=\"line\">          <span class=\"attribute\">height</span>: <span class=\"number\">14px</span>;</span><br><span class=\"line\">          <span class=\"attribute\">background-color</span>: <span class=\"number\">#fff</span>;</span><br><span class=\"line\">          <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> <span class=\"number\">10px</span>;</span><br><span class=\"line\">          <span class=\"attribute\">border-radius</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">          <span class=\"attribute\">opacity</span>: <span class=\"number\">0.6</span>;</span><br><span class=\"line\">          <span class=\"attribute\">transition</span>: all <span class=\"number\">0.5s</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"selector-class\">.active</span> &#123;</span><br><span class=\"line\">          <span class=\"attribute\">width</span>: <span class=\"number\">36px</span>;</span><br><span class=\"line\">          <span class=\"attribute\">background-color</span>: <span class=\"number\">#fff</span>;</span><br><span class=\"line\">          <span class=\"attribute\">border-radius</span>: <span class=\"number\">7px</span>;</span><br><span class=\"line\">          <span class=\"attribute\">opacity</span>: <span class=\"number\">1</span>;</span><br><span class=\"line\">      &#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"添加计算属性\"><a href=\"#添加计算属性\" class=\"headerlink\" title=\"添加计算属性\"></a>添加计算属性</h4><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">activeIndex</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> index = <span class=\"number\">0</span></span><br><span class=\"line\">            <span class=\"comment\">// 当currentIndex=0的时候就是列表的最后一个</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            index = <span class=\"variable language_\">this</span>.<span class=\"property\">items</span>.<span class=\"property\">length</span>-<span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 当是倒数第二个的时候就是第0个 </span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> === <span class=\"variable language_\">this</span>.<span class=\"property\">newList</span>.<span class=\"property\">length</span> - <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            index = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 其余都是-1 </span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            index = <span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> - <span class=\"number\">1</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> index</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/vue%E5%AE%9E%E7%8E%B0%E8%BD%AE%E6%92%AD%E5%9B%BE/GIF%202020-8-12%2021-52-25.gif\" alt=\"GIF 2020-8-12 21-52-25\"></p>\n<h4 id=\"鼠标移动到小圆点改变轮播\"><a href=\"#鼠标移动到小圆点改变轮播\" class=\"headerlink\" title=\"鼠标移动到小圆点改变轮播\"></a>鼠标移动到小圆点改变轮播</h4><p>有两个事件:<code>mouseenter</code> 跟<code>mouseleave</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 鼠标进入的时候</span></span><br><span class=\"line\">               <span class=\"title function_\">enter</span>(<span class=\"params\">index</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                   <span class=\"comment\">// 停止自动播放</span></span><br><span class=\"line\">                   <span class=\"variable language_\">this</span>.<span class=\"title function_\">stopplay</span>()</span><br><span class=\"line\">                   <span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> = index + <span class=\"number\">1</span></span><br><span class=\"line\">               &#125;,</span><br><span class=\"line\">               <span class=\"comment\">// 鼠标离开的时候</span></span><br><span class=\"line\">               <span class=\"title function_\">leave</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                   <span class=\"variable language_\">this</span>.<span class=\"title function_\">autoplay</span>()</span><br><span class=\"line\">               &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"完整代码\"><a href=\"#完整代码\" class=\"headerlink\" title=\"完整代码\"></a>完整代码</h2><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>轮播图demo<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        * &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">padding</span>: <span class=\"number\">0</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        </span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.swiper</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"comment\">/* 定义视口 */</span></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">200px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">300px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">100px</span> auto;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid red;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"comment\">/* 超出部分隐藏 */</span></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">overflow</span>: hidden;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">position</span>: relative;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        </span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.slides</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">display</span>: flex;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"comment\">/* 加入过渡 */</span></span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        </span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.slides</span> <span class=\"selector-tag\">li</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"comment\">/* 去掉前面的黑点 */</span></span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">list-style</span>: none;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        </span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">li</span> <span class=\"selector-tag\">img</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        </span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.sliderListDot</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">position</span>: absolute;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">bottom</span>: <span class=\"number\">20px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">display</span>: flex;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">transform</span>: <span class=\"built_in\">translateX</span>(-<span class=\"number\">50%</span>);</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        </span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.sliderDot</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">14px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">height</span>: <span class=\"number\">14px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">margin</span>: <span class=\"number\">0</span> <span class=\"number\">10px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">50%</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">opacity</span>: <span class=\"number\">0.6</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">transition</span>: all <span class=\"number\">0.5s</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        </span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.active</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">width</span>: <span class=\"number\">36px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">background-color</span>: <span class=\"number\">#fff</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">border-radius</span>: <span class=\"number\">7px</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">            <span class=\"attribute\">opacity</span>: <span class=\"number\">1</span>;</span></span><br><span class=\"line\"><span class=\"language-css\">        &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;app&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;swiper&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;viewPortRef&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">ul</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;slides&quot;</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;box&quot;</span> <span class=\"attr\">:style</span>=<span class=\"string\">&quot;translateStyle&quot;</span> @<span class=\"attr\">touchstart</span>=<span class=\"string\">&quot;onTouchStart&quot;</span> @<span class=\"attr\">touchmove</span>=<span class=\"string\">&quot;onTouchMove&quot;</span> @<span class=\"attr\">touchend</span>=<span class=\"string\">&quot;onTouchEnd&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">:key</span>=<span class=\"string\">&quot;index&quot;</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(item,index) in newList&quot;</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">:src</span>=<span class=\"string\">&quot;item.url&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;sliderListDot&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;sliderDot&quot;</span> <span class=\"attr\">:key</span>=<span class=\"string\">&quot;index&quot;</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(item,index) in items&quot;</span> <span class=\"attr\">:class</span>=<span class=\"string\">&quot;&#123;active : activeIndex==index&#125;&quot;</span> @<span class=\"attr\">mouseenter</span>=<span class=\"string\">&quot;enter(index)&quot;</span> @<span class=\"attr\">mouselevae</span>=<span class=\"string\">&quot;leave&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;js/vue.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Vue</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"attr\">el</span>: <span class=\"string\">&#x27;#app&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"title function_\">data</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 获取按住时的X值</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"attr\">toucheStartX</span>: <span class=\"number\">0</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"attr\">newList</span>: [],</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 定时器</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"attr\">timer</span>: <span class=\"literal\">null</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 当前index</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"attr\">currentIndex</span>: <span class=\"number\">1</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 偏移量</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"attr\">offsetX</span>: <span class=\"number\">0</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 视口</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"attr\">viewport</span>: <span class=\"number\">0</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"attr\">isTransition</span>: <span class=\"literal\">false</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"attr\">items</span>: [&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">id</span>: <span class=\"number\">1</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;/imgs/1.jpg&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;, &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">id</span>: <span class=\"number\">2</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;/imgs/2.jpg&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;, &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">id</span>: <span class=\"number\">3</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;/imgs/3.jpg&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;, &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">id</span>: <span class=\"number\">4</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;/imgs/4.jpg&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;, ]</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"title function_\">mounted</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"comment\">// 初始化宽度</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"variable language_\">this</span>.<span class=\"title function_\">init</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 自动轮播</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"variable language_\">this</span>.<span class=\"title function_\">autoplay</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"attr\">methods</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"comment\">// 初始化</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">init</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">const</span> first = <span class=\"variable language_\">this</span>.<span class=\"property\">items</span>.<span class=\"title function_\">slice</span>(<span class=\"number\">0</span>, <span class=\"number\">1</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">const</span> last = <span class=\"variable language_\">this</span>.<span class=\"property\">items</span>.<span class=\"title function_\">slice</span>(-<span class=\"number\">1</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">newList</span> = [...last, ...<span class=\"variable language_\">this</span>.<span class=\"property\">items</span>, ...first]</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"comment\">// 获取视口的宽度</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">viewport</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">$refs</span>.<span class=\"property\">viewPortRef</span>.<span class=\"property\">clientWidth</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"comment\">// 计算图片外层盒子的大小</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">$refs</span>.<span class=\"property\">box</span>.<span class=\"property\">style</span>.<span class=\"property\">width</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">newList</span>.<span class=\"property\">length</span> * <span class=\"variable language_\">this</span>.<span class=\"property\">viewport</span> + <span class=\"string\">&#x27;px&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"comment\">// 自动轮播 ,其实就是通过transition 偏移X</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">autoplay</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">timer</span> = <span class=\"built_in\">setInterval</span>(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"comment\">// 加上延时,造成视觉误差</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                            <span class=\"variable language_\">this</span>.<span class=\"property\">isTransition</span> = <span class=\"literal\">true</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                            <span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span>++</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        &#125;, <span class=\"number\">40</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> === <span class=\"variable language_\">this</span>.<span class=\"property\">newList</span>.<span class=\"property\">length</span> - <span class=\"number\">1</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                            <span class=\"variable language_\">this</span>.<span class=\"property\">isTransition</span> = <span class=\"literal\">false</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                            <span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> = <span class=\"number\">1</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                        &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;, <span class=\"number\">2000</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">stopplay</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">timer</span> &amp;&amp; <span class=\"built_in\">clearInterval</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">timer</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">onTouchStart</span>(<span class=\"params\">e</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 关闭自动播放</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"title function_\">stopplay</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"comment\">// 关闭过渡</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">isTransition</span> = <span class=\"literal\">false</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"comment\">// 当前是0的时候,是最后第二个</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> === <span class=\"number\">0</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">newList</span>.<span class=\"property\">length</span> - <span class=\"number\">2</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> === <span class=\"variable language_\">this</span>.<span class=\"property\">newList</span>.<span class=\"property\">length</span> - <span class=\"number\">1</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> = <span class=\"number\">1</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 获取按住的X坐标位置</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">toucheStartX</span> = e.<span class=\"property\">targetTouches</span>[<span class=\"number\">0</span>].<span class=\"property\">clientX</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">toucheStartX</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">onTouchMove</span>(<span class=\"params\">e</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 获取移动的偏移量</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">offsetX</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">toucheStartX</span> - e.<span class=\"property\">targetTouches</span>[<span class=\"number\">0</span>].<span class=\"property\">clientX</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">onTouchEnd</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 开启效果</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">isTransition</span> = <span class=\"literal\">true</span>;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 四舍五入</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">let</span> currentIndex = <span class=\"title class_\">Math</span>.<span class=\"title function_\">round</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">offsetX</span> / <span class=\"variable language_\">this</span>.<span class=\"property\">viewport</span>)</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> = currentIndex + <span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"comment\">// 重置offsetX</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">offsetX</span> = <span class=\"number\">0</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"comment\">// 自动播放</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"title function_\">autoplay</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"comment\">// 鼠标进入的时候</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">enter</span>(<span class=\"params\">index</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 停止自动播放</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"title function_\">stopplay</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> = index + <span class=\"number\">1</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"comment\">// 鼠标离开的时候</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">leave</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"variable language_\">this</span>.<span class=\"title function_\">autoplay</span>()</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"comment\">// 通过计算属性来获取偏移的X</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"attr\">computed</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">translateStyle</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">const</span> translate = <span class=\"string\">`translateX(-<span class=\"subst\">$&#123;<span class=\"variable language_\">this</span>.currentIndex*<span class=\"variable language_\">this</span>.viewport+<span class=\"variable language_\">this</span>.offsetX &#125;</span>px)`</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">const</span> transition = <span class=\"variable language_\">this</span>.<span class=\"property\">isTransition</span> ? <span class=\"string\">&#x27;all 1s&#x27;</span> : <span class=\"string\">&#x27;none&#x27;</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">transform</span>: translate,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"attr\">transition</span>: transition</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"title function_\">activeIndex</span>(<span class=\"params\"></span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">let</span> index = <span class=\"number\">0</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                        <span class=\"comment\">// 当currentIndex=0的时候就是列表的最后一个</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> === <span class=\"number\">0</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        index = <span class=\"variable language_\">this</span>.<span class=\"property\">items</span>.<span class=\"property\">length</span> - <span class=\"number\">1</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 当是倒数第二个的时候就是第0个 </span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> === <span class=\"variable language_\">this</span>.<span class=\"property\">newList</span>.<span class=\"property\">length</span> - <span class=\"number\">1</span>) &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        index = <span class=\"number\">0</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"comment\">// 其余都是-1 </span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        index = <span class=\"variable language_\">this</span>.<span class=\"property\">currentIndex</span> - <span class=\"number\">1</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">                    &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"keyword\">return</span> index</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;)</span></span><br><span class=\"line\"><span class=\"language-javascript\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://github.com/Tigercoll/vue-slideshow\">github地址</a></p>\n","categories":["vue"],"tags":["vue","轮播图"]},{"title":"numpy使用","url":"/post/40d74989.html","content":"<p>NumPy 是一个运行速度非常快的数学库，主要用于数组计算，包含：</p>\n<ul>\n<li>一个强大的N维数组对象 ndarray</li>\n<li>广播功能函数</li>\n<li>整合 C&#x2F;C++&#x2F;Fortran 代码的工具</li>\n<li>线性代数、傅里叶变换、随机数生成等功能</li>\n</ul>\n<span id=\"more\"></span>\n\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p>通过pip install 安装 <code>numpy</code></p>\n<p><code>pip install numpy</code></p>\n<h3 id=\"导入\"><a href=\"#导入\" class=\"headerlink\" title=\"导入\"></a>导入</h3><p><code>import numpy as np</code></p>\n<h3 id=\"查看版本\"><a href=\"#查看版本\" class=\"headerlink\" title=\"查看版本\"></a>查看版本</h3><p><img data-src=\"/../images/numpy%E4%BD%BF%E7%94%A8/image-20220630161950742.png\" alt=\"image-20220630161950742\"></p>\n<h2 id=\"ndarray\"><a href=\"#ndarray\" class=\"headerlink\" title=\"ndarray\"></a>ndarray</h2><h3 id=\"常用创建方法\"><a href=\"#常用创建方法\" class=\"headerlink\" title=\"常用创建方法\"></a>常用创建方法</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 创建全是1的ndarray, 默认是float64类型</span></span><br><span class=\"line\"><span class=\"comment\"># np.ones(shape, dtype=None, order=&#x27;C&#x27;)</span></span><br><span class=\"line\">np.ones(shape=(<span class=\"number\">4</span>,<span class=\"number\">5</span>))</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/numpy%E4%BD%BF%E7%94%A8/image-20220704104818993.png\" alt=\"image-20220704104818993\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 全是0的ndarray</span></span><br><span class=\"line\"><span class=\"comment\"># np.zeros(shape, dtype=float, order=&#x27;C&#x27;)</span></span><br><span class=\"line\">np.zeros(shape=(<span class=\"number\">4</span>,<span class=\"number\">4</span>))</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/numpy%E4%BD%BF%E7%94%A8/image-20220704105615223.png\" alt=\"image-20220704105615223\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 使用指定的元素来填充,</span></span><br><span class=\"line\"><span class=\"comment\"># np.full(shape, fill_value, dtype=None, order=&#x27;C&#x27;)</span></span><br><span class=\"line\">np.full(shape=(<span class=\"number\">3</span>,<span class=\"number\">3</span>), fill_value=<span class=\"number\">8</span>, dtype=np.float64)</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/numpy%E4%BD%BF%E7%94%A8/image-20220704111543026.png\" alt=\"image-20220704111543026\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 等分一个范围</span></span><br><span class=\"line\"><span class=\"comment\"># np.linspace(start, stop, num=50, endpoint=True, retstep=False, dtype=None)</span></span><br><span class=\"line\">np.linspace(<span class=\"number\">0</span>, <span class=\"number\">100</span>, num=<span class=\"number\">50</span>, endpoint=<span class=\"literal\">False</span>, retstep=<span class=\"literal\">True</span>)</span><br><span class=\"line\"><span class=\"comment\"># endpoint：True则包含stop；False则不包含stop</span></span><br><span class=\"line\"><span class=\"comment\"># retstep : 返回步长,并以元祖输出</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/numpy%E4%BD%BF%E7%94%A8/image-20220704132615078.png\" alt=\"image-20220704132615078\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 和python的 range一样</span></span><br><span class=\"line\"><span class=\"comment\"># 当step是非整数的时候,尽量使用np.linspace</span></span><br><span class=\"line\"><span class=\"comment\"># np.arange([start, ]stop, [step, ]dtype=None)</span></span><br><span class=\"line\">np.arange(<span class=\"number\">0</span>, <span class=\"number\">100</span>,<span class=\"number\">2</span>)</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/numpy%E4%BD%BF%E7%94%A8/image-20220704132758892.png\" alt=\"image-20220704132758892\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 全是整数的ndarray 左闭右开区间.</span></span><br><span class=\"line\"><span class=\"comment\"># np.random.randint(low, high=None, size=None, dtype=&#x27;l&#x27;)</span></span><br><span class=\"line\">np.random.randint(<span class=\"number\">0</span>,  <span class=\"number\">150</span>, size=(<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>), )</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/numpy%E4%BD%BF%E7%94%A8/image-20220704133905777.png\" alt=\"image-20220704133905777\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 标准正太分布</span></span><br><span class=\"line\"><span class=\"comment\"># 平均值为0, 方差 为1 的正态分布叫做标准正态分布</span></span><br><span class=\"line\"><span class=\"comment\"># np.random.randn(d0, d1, ..., dn)</span></span><br><span class=\"line\">np.random.randn(<span class=\"number\">2</span>,<span class=\"number\">3</span>, <span class=\"number\">2</span>,<span class=\"number\">3</span>)</span><br><span class=\"line\"><span class=\"comment\"># 分为2个大矩阵,然后每个矩阵里又有3个2行3列的小矩阵,</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/numpy%E4%BD%BF%E7%94%A8/image-20220704142321831.png\" alt=\"image-20220704142321831\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 正态分布</span></span><br><span class=\"line\"><span class=\"comment\"># np.random.normal(loc=0.0, scale=1.0, size=None)</span></span><br><span class=\"line\">np.random.normal(loc=<span class=\"number\">10</span>, scale=<span class=\"number\">3</span>,size=(<span class=\"number\">3</span>,<span class=\"number\">3</span>))</span><br><span class=\"line\"><span class=\"comment\"># 均值,标准差,输出维度</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/numpy%E4%BD%BF%E7%94%A8/image-20220704144755072.png\" alt=\"image-20220704144755072\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 生成0到1的随机数，左闭右开</span></span><br><span class=\"line\"><span class=\"comment\"># np.random.random(size=None)</span></span><br><span class=\"line\">np.random.random(size=(<span class=\"number\">3</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>))</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/numpy%E4%BD%BF%E7%94%A8/image-20220704152400609.png\" alt=\"image-20220704152400609\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 和np.random.random一样</span></span><br><span class=\"line\">np.random.rand(<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">3</span>)</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/numpy%E4%BD%BF%E7%94%A8/image-20220704152806987.png\" alt=\"image-20220704152806987\"></p>\n<h2 id=\"ndarray的属性\"><a href=\"#ndarray的属性\" class=\"headerlink\" title=\"ndarray的属性\"></a>ndarray的属性</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">4个必记参数：</span><br><span class=\"line\">ndim：维度</span><br><span class=\"line\">shape：形状（各维度的长度）</span><br><span class=\"line\">size：总长度</span><br><span class=\"line\">dtype：元素类型</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/numpy%E4%BD%BF%E7%94%A8/image-20220704154531580.png\" alt=\"image-20220704154531580\"></p>\n<h2 id=\"ndarray的基本操作\"><a href=\"#ndarray的基本操作\" class=\"headerlink\" title=\"ndarray的基本操作\"></a>ndarray的基本操作</h2><h3 id=\"索引\"><a href=\"#索引\" class=\"headerlink\" title=\"索引\"></a>索引</h3><p>一维与列表完全一致 多维时同理</p>\n<p>二维</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">n = np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">150</span>, size=(<span class=\"number\">4</span>,<span class=\"number\">5</span>))</span><br><span class=\"line\">n</span><br><span class=\"line\">array([[ <span class=\"number\">77</span>,  <span class=\"number\">14</span>, <span class=\"number\">134</span>,  <span class=\"number\">14</span>,  <span class=\"number\">43</span>],</span><br><span class=\"line\">       [ <span class=\"number\">85</span>, <span class=\"number\">123</span>, <span class=\"number\">124</span>,  <span class=\"number\">91</span>, <span class=\"number\">108</span>],</span><br><span class=\"line\">       [ <span class=\"number\">64</span>,  <span class=\"number\">31</span>,  <span class=\"number\">94</span>,  <span class=\"number\">39</span>,  <span class=\"number\">24</span>],</span><br><span class=\"line\">       [ <span class=\"number\">44</span>,  <span class=\"number\">77</span>,  <span class=\"number\">26</span>,  <span class=\"number\">67</span>,  <span class=\"number\">80</span>]])</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/numpy%E4%BD%BF%E7%94%A8/image-20220704161835043.png\" alt=\"image-20220704161835043\"></p>\n<p>三维</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">n = np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">100</span>, size=(<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">3</span>))</span><br><span class=\"line\">n</span><br><span class=\"line\">array([[[ <span class=\"number\">9</span>, <span class=\"number\">39</span>, <span class=\"number\">23</span>],</span><br><span class=\"line\">        [<span class=\"number\">13</span>, <span class=\"number\">11</span>,  <span class=\"number\">6</span>],</span><br><span class=\"line\">        [<span class=\"number\">60</span>, <span class=\"number\">62</span>, <span class=\"number\">39</span>],</span><br><span class=\"line\">        [<span class=\"number\">76</span>, <span class=\"number\">86</span>, <span class=\"number\">68</span>],</span><br><span class=\"line\">        [<span class=\"number\">24</span>, <span class=\"number\">66</span>, <span class=\"number\">39</span>]],</span><br><span class=\"line\"></span><br><span class=\"line\">       [[<span class=\"number\">42</span>, <span class=\"number\">42</span>, <span class=\"number\">95</span>],</span><br><span class=\"line\">        [<span class=\"number\">70</span>,  <span class=\"number\">4</span>, <span class=\"number\">87</span>],</span><br><span class=\"line\">        [<span class=\"number\">45</span>, <span class=\"number\">23</span>, <span class=\"number\">60</span>],</span><br><span class=\"line\">        [<span class=\"number\">46</span>, <span class=\"number\">58</span>, <span class=\"number\">43</span>],</span><br><span class=\"line\">        [<span class=\"number\">85</span>, <span class=\"number\">92</span>, <span class=\"number\">27</span>]],</span><br><span class=\"line\"></span><br><span class=\"line\">       [[<span class=\"number\">36</span>, <span class=\"number\">51</span>, <span class=\"number\">87</span>],</span><br><span class=\"line\">        [<span class=\"number\">64</span>, <span class=\"number\">83</span>, <span class=\"number\">24</span>],</span><br><span class=\"line\">        [ <span class=\"number\">0</span>, <span class=\"number\">30</span>, <span class=\"number\">14</span>],</span><br><span class=\"line\">        [<span class=\"number\">22</span>, <span class=\"number\">34</span>,  <span class=\"number\">8</span>],</span><br><span class=\"line\">        [<span class=\"number\">80</span>, <span class=\"number\">49</span>, <span class=\"number\">78</span>]],</span><br><span class=\"line\"></span><br><span class=\"line\">       [[<span class=\"number\">34</span>, <span class=\"number\">44</span>, <span class=\"number\">19</span>],</span><br><span class=\"line\">        [<span class=\"number\">17</span>, <span class=\"number\">20</span>, <span class=\"number\">45</span>],</span><br><span class=\"line\">        [<span class=\"number\">29</span>, <span class=\"number\">71</span>,  <span class=\"number\">4</span>],</span><br><span class=\"line\">        [<span class=\"number\">36</span>, <span class=\"number\">85</span>, <span class=\"number\">70</span>],</span><br><span class=\"line\">        [<span class=\"number\">20</span>,  <span class=\"number\">9</span>, <span class=\"number\">35</span>]]])</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/numpy%E4%BD%BF%E7%94%A8/image-20220704162631249.png\" alt=\"image-20220704162631249\"></p>\n<h3 id=\"切片\"><a href=\"#切片\" class=\"headerlink\" title=\"切片\"></a>切片</h3><p>一维与列表完全一致 多维时同理</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">n = np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">100</span>, size=(<span class=\"number\">4</span>,<span class=\"number\">6</span>))</span><br><span class=\"line\">n </span><br><span class=\"line\">array([[<span class=\"number\">49</span>, <span class=\"number\">27</span>, <span class=\"number\">77</span>, <span class=\"number\">39</span>,  <span class=\"number\">6</span>, <span class=\"number\">33</span>],</span><br><span class=\"line\">       [<span class=\"number\">74</span>, <span class=\"number\">48</span>, <span class=\"number\">88</span>, <span class=\"number\">45</span>, <span class=\"number\">49</span>, <span class=\"number\">96</span>],</span><br><span class=\"line\">       [<span class=\"number\">41</span>, <span class=\"number\">71</span>, <span class=\"number\">81</span>, <span class=\"number\">50</span>, <span class=\"number\">28</span>,  <span class=\"number\">9</span>],</span><br><span class=\"line\">       [<span class=\"number\">69</span>, <span class=\"number\">97</span>, <span class=\"number\">81</span>, <span class=\"number\">85</span>, <span class=\"number\">70</span>, <span class=\"number\">54</span>]])</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/numpy%E4%BD%BF%E7%94%A8/image-20220704165159077.png\" alt=\"image-20220704165159077\"></p>\n<h3 id=\"变形\"><a href=\"#变形\" class=\"headerlink\" title=\"变形\"></a>变形</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">n</span><br><span class=\"line\">array([[<span class=\"number\">49</span>, <span class=\"number\">27</span>, <span class=\"number\">77</span>, <span class=\"number\">39</span>,  <span class=\"number\">6</span>, <span class=\"number\">33</span>],</span><br><span class=\"line\">       [<span class=\"number\">74</span>, <span class=\"number\">48</span>, <span class=\"number\">88</span>, <span class=\"number\">45</span>, <span class=\"number\">49</span>, <span class=\"number\">96</span>],</span><br><span class=\"line\">       [<span class=\"number\">41</span>, <span class=\"number\">71</span>, <span class=\"number\">81</span>, <span class=\"number\">50</span>, <span class=\"number\">28</span>,  <span class=\"number\">9</span>],</span><br><span class=\"line\">       [<span class=\"number\">69</span>, <span class=\"number\">97</span>, <span class=\"number\">81</span>, <span class=\"number\">85</span>, <span class=\"number\">70</span>, <span class=\"number\">54</span>]])</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/numpy%E4%BD%BF%E7%94%A8/image-20220704165505336.png\" alt=\"image-20220704165505336\"></p>\n<h3 id=\"级联\"><a href=\"#级联\" class=\"headerlink\" title=\"级联\"></a>级联</h3><p><code>np.concatenate()</code> 级联需要注意的点：</p>\n<ul>\n<li>级联的参数是列表：一定要加中括号或小括号</li>\n<li>维度必须相同</li>\n<li>形状相符</li>\n<li>【重点】级联的方向默认是shape这个tuple的第一个值所代表的维度方向</li>\n<li>可通过axis参数改变级联的方向</li>\n</ul>\n<h4 id=\"垂直级联\"><a href=\"#垂直级联\" class=\"headerlink\" title=\"垂直级联\"></a>垂直级联</h4><p><img data-src=\"/../images/numpy%E4%BD%BF%E7%94%A8/image-20220704170008231.png\" alt=\"image-20220704170008231\"></p>\n<h4 id=\"水平级联\"><a href=\"#水平级联\" class=\"headerlink\" title=\"水平级联\"></a>水平级联</h4><p><img data-src=\"/../images/numpy%E4%BD%BF%E7%94%A8/image-20220704170030568.png\" alt=\"image-20220704170030568\"></p>\n<p><code>np.hstack</code>与<code>np.vstack</code> : 水平级联与垂直级联,处理自己，进行维度的变更</p>\n<p><img data-src=\"/../images/numpy%E4%BD%BF%E7%94%A8/image-20220704170308261.png\" alt=\"image-20220704170308261\"></p>\n<p>级联的基本要求: 垂直级联的时候 ,列数一定要相同, 水平级联行数一定要相同.</p>\n<h3 id=\"切分\"><a href=\"#切分\" class=\"headerlink\" title=\"切分\"></a>切分</h3><p>与级联类似，三个函数完成切分工作：</p>\n<ul>\n<li>np.split</li>\n<li>np.vsplit</li>\n<li>np.hsplit</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">n = np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">100</span>, size=(<span class=\"number\">6</span>,<span class=\"number\">6</span>))</span><br><span class=\"line\">n</span><br><span class=\"line\">array([[<span class=\"number\">83</span>, <span class=\"number\">81</span>, <span class=\"number\">77</span>,  <span class=\"number\">2</span>, <span class=\"number\">20</span>, <span class=\"number\">69</span>],</span><br><span class=\"line\">       [<span class=\"number\">49</span>, <span class=\"number\">94</span>,  <span class=\"number\">5</span>, <span class=\"number\">91</span>, <span class=\"number\">71</span>, <span class=\"number\">65</span>],</span><br><span class=\"line\">       [<span class=\"number\">12</span>, <span class=\"number\">10</span>, <span class=\"number\">10</span>, <span class=\"number\">25</span>, <span class=\"number\">53</span>, <span class=\"number\">90</span>],</span><br><span class=\"line\">       [<span class=\"number\">81</span>, <span class=\"number\">45</span>, <span class=\"number\">89</span>, <span class=\"number\">64</span>, <span class=\"number\">85</span>, <span class=\"number\">45</span>],</span><br><span class=\"line\">       [<span class=\"number\">63</span>, <span class=\"number\">35</span>, <span class=\"number\">52</span>, <span class=\"number\">90</span>, <span class=\"number\">49</span>, <span class=\"number\">82</span>],</span><br><span class=\"line\">       [<span class=\"number\">16</span>, <span class=\"number\">67</span>, <span class=\"number\">24</span>, <span class=\"number\">86</span>, <span class=\"number\">91</span>, <span class=\"number\">42</span>]])</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/numpy%E4%BD%BF%E7%94%A8/image-20220704172931919.png\" alt=\"image-20220704172931919\"></p>\n<p><img data-src=\"/../images/numpy%E4%BD%BF%E7%94%A8/image-20220704173034060.png\" alt=\"image-20220704173034060\"></p>\n<h2 id=\"ndarray的聚合操作\"><a href=\"#ndarray的聚合操作\" class=\"headerlink\" title=\"ndarray的聚合操作\"></a>ndarray的聚合操作</h2><h3 id=\"求和np-sum\"><a href=\"#求和np-sum\" class=\"headerlink\" title=\"求和np.sum\"></a>求和np.sum</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\">n = np.eye(<span class=\"number\">3</span>)</span><br><span class=\"line\">n</span><br><span class=\"line\">array([[<span class=\"number\">1.</span>, <span class=\"number\">0.</span>, <span class=\"number\">0.</span>],</span><br><span class=\"line\">       [<span class=\"number\">0.</span>, <span class=\"number\">1.</span>, <span class=\"number\">0.</span>],</span><br><span class=\"line\">       [<span class=\"number\">0.</span>, <span class=\"number\">0.</span>, <span class=\"number\">1.</span>]])</span><br><span class=\"line\"></span><br><span class=\"line\">n.<span class=\"built_in\">sum</span>() <span class=\"comment\"># axis=None 表示所有的维度都聚合成0维</span></span><br><span class=\"line\"><span class=\"number\">3.0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># axis=0 表示对行进行聚合操作,行没了,剩下列.</span></span><br><span class=\"line\">n.<span class=\"built_in\">sum</span>(axis=<span class=\"number\">0</span>)</span><br><span class=\"line\">array([<span class=\"number\">1.</span>, <span class=\"number\">1.</span>, <span class=\"number\">1.</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># axis=1表示对列进行聚合,列没了,行还在.</span></span><br><span class=\"line\">n.<span class=\"built_in\">sum</span>(axis=<span class=\"number\">1</span>)</span><br><span class=\"line\">array([<span class=\"number\">1.</span>, <span class=\"number\">1.</span>, <span class=\"number\">1.</span>])</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"最大最小值：np-max-x2F-np-min\"><a href=\"#最大最小值：np-max-x2F-np-min\" class=\"headerlink\" title=\"最大最小值：np.max&#x2F; np.min\"></a>最大最小值：np.max&#x2F; np.min</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 同理</span></span><br><span class=\"line\"></span><br><span class=\"line\">n.<span class=\"built_in\">max</span>(axis=<span class=\"number\">0</span>)</span><br><span class=\"line\">array([<span class=\"number\">1.</span>, <span class=\"number\">1.</span>, <span class=\"number\">1.</span>])</span><br><span class=\"line\"></span><br><span class=\"line\">n.<span class=\"built_in\">min</span>(axis=<span class=\"number\">1</span>)</span><br><span class=\"line\">array([<span class=\"number\">0.</span>, <span class=\"number\">0.</span>, <span class=\"number\">0.</span>])</span><br></pre></td></tr></table></figure>\n\n","categories":["numpy"],"tags":["数据分析","numpy"]},{"title":"交换机ACL访问控制","url":"/post/8a20e477.html","content":"<p><strong>ACL，是Access Control List的简写，中文名称叫做“访问控制列表”</strong>。它是由一系列条件规则（即描述报文匹配条件的判断语句）组成， 这些条件规则可以是报文的源地址、目的地址、端口号等，是一种应用在网络设备各种软硬接口上的的指令列表。</p>\n<span id=\"more\"></span>\n\n<h3 id=\"进入思科交换机\"><a href=\"#进入思科交换机\" class=\"headerlink\" title=\"进入思科交换机\"></a>进入思科交换机</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">telnet 管理地址</span><br><span class=\"line\">输入密码,进入用户模式</span><br><span class=\"line\">enable 进入特权模式</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/%E4%BA%A4%E6%8D%A2%E6%9C%BAACL%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/image-20200706184603739.png\" alt=\"image-20200706184603739\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">show configuration 查看配置,</span><br><span class=\"line\">configure terminal 进入配置模式</span><br><span class=\"line\">然后就是配置我们的ACL访问控制列表</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ACL有三种类型：\"><a href=\"#ACL有三种类型：\" class=\"headerlink\" title=\"ACL有三种类型：\"></a>ACL有三种类型：</h3><ol>\n<li>标准ACL：根据数据包的源IP地址来允许或拒绝数据包。标准ACL的访问控制列表号是1~99。 2</li>\n<li>扩展ACL：根据数据包的源IP地址、目的IP地址、指定协议、端口和标志来允许或拒绝数据包。扩展ACL的访问控制列表号是100~199.</li>\n<li>命名ACL允许在标准ACL和扩展ACL中使用名称代替表号。</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">编写ACL</span><br><span class=\"line\">access-list 130 deny   ip host [ip地址] any # 由于我这边是需要禁掉,所以用deny</span><br><span class=\"line\">access-list 130 permit ip any any #因为思科默认是deny any any ,所以一定不要忘记这条</span><br></pre></td></tr></table></figure>\n\n<p>随后我们把他应用到相应的端口</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">cisco(config)#</span><span class=\"language-bash\">interface 相应的端口</span></span><br><span class=\"line\"><span class=\"meta prompt_\">cisco(config-if)#</span><span class=\"language-bash\">ip access-group [access-list-number] <span class=\"keyword\">in</span></span></span><br><span class=\"line\">比如我们这里是130</span><br><span class=\"line\"><span class=\"meta prompt_\">cisco(config-if)#</span><span class=\"language-bash\">ip access-group 130 <span class=\"keyword\">in</span></span></span><br></pre></td></tr></table></figure>\n\n<p>这里有个坑,我配置了acl 但是我查看配置文件时没有出现我刚才配置的acl,我们需要保存一下配置才可以.</p>\n<h3 id=\"删除ACL\"><a href=\"#删除ACL\" class=\"headerlink\" title=\"删除ACL\"></a>删除ACL</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">no access-list number  删除整个ACL配置</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">如果要删除某一行ACL必须要利用ip access-list extended</span></span><br><span class=\"line\">ip access-list extended acl_name</span><br><span class=\"line\">show ccess-lists</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">然后根据前面的数字删除</span></span><br><span class=\"line\">no [number]</span><br></pre></td></tr></table></figure>\n","categories":["ACL"],"tags":["交换机","ACL访问控制"]},{"title":"Pandas入门","url":"/post/dc90dbaf.html","content":"<p>Pandas 是 Python 的核心数据分析支持库，提供了快速、灵活、明确的数据结构，旨在简单、直观地处理关系型、标记型数据。Pandas 的目标是成为 Python 数据分析实践与实战的必备高级工具，其长远目标是成为最强大、最灵活、可以支持任何语言的开源数据分析工具。经过多年不懈的努力，Pandas 离这个目标已经越来越近了。</p>\n<p>Pandas 适用于处理以下类型的数据：</p>\n<ul>\n<li>与 SQL 或 Excel 表类似的，含异构列的表格数据;</li>\n<li>有序和无序（非固定频率）的时间序列数据;</li>\n<li>带行列标签的矩阵数据，包括同构或异构型数据;</li>\n<li>任意其它形式的观测、统计数据集, 数据转入 Pandas 数据结构时不必事先标记。</li>\n</ul>\n<p>Pandas 的主要数据结构是 Series（一维数据）与 DataFrame（二维数据），这两种数据结构足以处理金融、统计、社会科学、工程等领域里的大多数典型用例。对于 R 用户，DataFrame 提供了比 R 语言 data.frame 更丰富的功能。Pandas 基于 NumPy 开发，可以与其它第三方科学计算支持库完美集成。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"Pandas-数据结构\"><a href=\"#Pandas-数据结构\" class=\"headerlink\" title=\"Pandas 数据结构\"></a>Pandas 数据结构</h2><h3 id=\"Series\"><a href=\"#Series\" class=\"headerlink\" title=\"Series\"></a>Series</h3><p>Series是一种类似于一维数组的对象，由下面两个部分组成：</p>\n<ul>\n<li>values：一组数据（ndarray类型）</li>\n<li>index：相关的数据索引标签</li>\n</ul>\n<h4 id=\"Series的创建\"><a href=\"#Series的创建\" class=\"headerlink\" title=\"Series的创建\"></a>Series的创建</h4><h5 id=\"由列表或numpy数组创建\"><a href=\"#由列表或numpy数组创建\" class=\"headerlink\" title=\"由列表或numpy数组创建\"></a>由列表或numpy数组创建</h5><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pandas <span class=\"keyword\">import</span> Series</span><br><span class=\"line\">l = [i <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">6</span>)]</span><br><span class=\"line\">s = Series(l,index=<span class=\"built_in\">list</span>(<span class=\"string\">&#x27;abcdef&#x27;</span>))</span><br><span class=\"line\">s</span><br><span class=\"line\"></span><br><span class=\"line\">a    <span class=\"number\">0</span></span><br><span class=\"line\">b    <span class=\"number\">1</span></span><br><span class=\"line\">c    <span class=\"number\">2</span></span><br><span class=\"line\">d    <span class=\"number\">3</span></span><br><span class=\"line\">e    <span class=\"number\">4</span></span><br><span class=\"line\">f    <span class=\"number\">5</span></span><br><span class=\"line\">dtype: int64</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 还可以通过设置index参数指定索引</span></span><br><span class=\"line\">s.index = [<span class=\"number\">2</span>,<span class=\"number\">4</span>,<span class=\"number\">6</span>,<span class=\"number\">8</span>,<span class=\"number\">10</span>,<span class=\"number\">12</span>]</span><br><span class=\"line\">s</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">2</span>     <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">4</span>     <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">6</span>     <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">8</span>     <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"number\">10</span>    <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">12</span>    <span class=\"number\">5</span></span><br><span class=\"line\">dtype: int64</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"由字典创建\"><a href=\"#由字典创建\" class=\"headerlink\" title=\"由字典创建\"></a>由字典创建</h5><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 字典的key对应Series的索引</span></span><br><span class=\"line\">s = Series(&#123;<span class=\"string\">&#x27;a&#x27;</span>:<span class=\"number\">1</span>, <span class=\"string\">&#x27;b&#x27;</span>:<span class=\"number\">2</span>, <span class=\"string\">&#x27;c&#x27;</span>:<span class=\"number\">3</span>, <span class=\"string\">&#x27;d&#x27;</span>: <span class=\"number\">4</span>&#125;)</span><br><span class=\"line\">s</span><br><span class=\"line\"></span><br><span class=\"line\">a    <span class=\"number\">1</span></span><br><span class=\"line\">b    <span class=\"number\">2</span></span><br><span class=\"line\">c    <span class=\"number\">3</span></span><br><span class=\"line\">d    <span class=\"number\">4</span></span><br><span class=\"line\">dtype: int64</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Series的索引和切片\"><a href=\"#Series的索引和切片\" class=\"headerlink\" title=\"Series的索引和切片\"></a>Series的索引和切片</h4><p>可以使用中括号取单个索引（此时返回的是元素类型），或者中括号里一个列表取多个索引（此时返回的仍然是一个Series类型）。分为显示索引和隐式索引：</p>\n<h5 id=\"显式索引：\"><a href=\"#显式索引：\" class=\"headerlink\" title=\"显式索引：\"></a>显式索引：</h5><ul>\n<li>使用index中的元素作为索引值</li>\n<li>使用.loc[]（推荐）</li>\n</ul>\n<p>注意，此时是闭区间</p>\n<p><img data-src=\"/../images/pandas%E5%85%A5%E9%97%A8/image-20220710110343599.png\" alt=\"image-20220710110343599\"></p>\n<h5 id=\"隐式索引：\"><a href=\"#隐式索引：\" class=\"headerlink\" title=\"隐式索引：\"></a>隐式索引：</h5><ul>\n<li>使用整数作为索引值</li>\n<li>使用.iloc[]（推荐）</li>\n</ul>\n<p>注意，此时是半开区间</p>\n<p><img data-src=\"/../images/pandas%E5%85%A5%E9%97%A8/image-20220710110727110.png\" alt=\"image-20220710110727110\"></p>\n<h4 id=\"Series的基本概念\"><a href=\"#Series的基本概念\" class=\"headerlink\" title=\"Series的基本概念\"></a>Series的基本概念</h4><p>可以把Series看成一个定长的有序字典</p>\n<p>可以通过shape，size，index,values等得到series的属性</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">s</span><br><span class=\"line\"></span><br><span class=\"line\">a    1</span><br><span class=\"line\">b    2</span><br><span class=\"line\">c    3</span><br><span class=\"line\">d    4</span><br><span class=\"line\">dtype: int64</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">s.shape</span><br><span class=\"line\">(<span class=\"number\">4</span>,)</span><br><span class=\"line\"></span><br><span class=\"line\">s.size</span><br><span class=\"line\"><span class=\"number\">4</span></span><br><span class=\"line\"></span><br><span class=\"line\">s.index</span><br><span class=\"line\">Index([<span class=\"string\">&#x27;a&#x27;</span>, <span class=\"string\">&#x27;b&#x27;</span>, <span class=\"string\">&#x27;c&#x27;</span>, <span class=\"string\">&#x27;d&#x27;</span>], dtype=<span class=\"string\">&#x27;object&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">s.values</span><br><span class=\"line\">array([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>], dtype=int64)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>可以通过head(),tail()快速查看Series对象的样式</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">s.head(<span class=\"number\">3</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">a    <span class=\"number\">1</span></span><br><span class=\"line\">b    <span class=\"number\">2</span></span><br><span class=\"line\">c    <span class=\"number\">3</span></span><br><span class=\"line\">dtype: int64</span><br><span class=\"line\"></span><br><span class=\"line\">s.tail(<span class=\"number\">4</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">a    <span class=\"number\">1</span></span><br><span class=\"line\">b    <span class=\"number\">2</span></span><br><span class=\"line\">c    <span class=\"number\">3</span></span><br><span class=\"line\">d    <span class=\"number\">4</span></span><br><span class=\"line\">dtype: int64</span><br></pre></td></tr></table></figure>\n\n<p>当索引没有对应的值时，可能出现缺失数据显示NaN（not a number）的情况</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">s.loc[<span class=\"number\">0</span>] = np.nan</span><br><span class=\"line\"></span><br><span class=\"line\">a    <span class=\"number\">1.0</span></span><br><span class=\"line\">b    <span class=\"number\">2.0</span></span><br><span class=\"line\">c    <span class=\"number\">3.0</span></span><br><span class=\"line\">d    <span class=\"number\">4.0</span></span><br><span class=\"line\"><span class=\"number\">0</span>    NaN</span><br><span class=\"line\">dtype: float64</span><br></pre></td></tr></table></figure>\n\n<p>可以使用pd.isnull()，pd.notnull()，或自带isnull(),notnull()函数检测缺失数据</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">pd.isnull(s)</span><br><span class=\"line\"></span><br><span class=\"line\">a    <span class=\"literal\">False</span></span><br><span class=\"line\">b    <span class=\"literal\">False</span></span><br><span class=\"line\">c    <span class=\"literal\">False</span></span><br><span class=\"line\">d    <span class=\"literal\">False</span></span><br><span class=\"line\"><span class=\"number\">0</span>     <span class=\"literal\">True</span></span><br><span class=\"line\">dtype: <span class=\"built_in\">bool</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">pd.notnull(s)</span><br><span class=\"line\">a     <span class=\"literal\">True</span></span><br><span class=\"line\">b     <span class=\"literal\">True</span></span><br><span class=\"line\">c     <span class=\"literal\">True</span></span><br><span class=\"line\">d     <span class=\"literal\">True</span></span><br><span class=\"line\"><span class=\"number\">0</span>    <span class=\"literal\">False</span></span><br><span class=\"line\">dtype: <span class=\"built_in\">bool</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">s.isnull()</span><br><span class=\"line\"></span><br><span class=\"line\">a    <span class=\"literal\">False</span></span><br><span class=\"line\">b    <span class=\"literal\">False</span></span><br><span class=\"line\">c    <span class=\"literal\">False</span></span><br><span class=\"line\">d    <span class=\"literal\">False</span></span><br><span class=\"line\"><span class=\"number\">0</span>     <span class=\"literal\">True</span></span><br><span class=\"line\">dtype: <span class=\"built_in\">bool</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">s.notnull()</span><br><span class=\"line\">a     <span class=\"literal\">True</span></span><br><span class=\"line\">b     <span class=\"literal\">True</span></span><br><span class=\"line\">c     <span class=\"literal\">True</span></span><br><span class=\"line\">d     <span class=\"literal\">True</span></span><br><span class=\"line\"><span class=\"number\">0</span>    <span class=\"literal\">False</span></span><br><span class=\"line\">dtype: <span class=\"built_in\">bool</span></span><br></pre></td></tr></table></figure>\n\n<p>Series对象本身及其实例都有一个name属性</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">s.name = <span class=\"string\">&#x27;Series s&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">s</span><br><span class=\"line\"></span><br><span class=\"line\">a    <span class=\"number\">1.0</span></span><br><span class=\"line\">b    <span class=\"number\">2.0</span></span><br><span class=\"line\">c    <span class=\"number\">3.0</span></span><br><span class=\"line\">d    <span class=\"number\">4.0</span></span><br><span class=\"line\"><span class=\"number\">0</span>    NaN</span><br><span class=\"line\">Name: Series s, dtype: float64</span><br><span class=\"line\"></span><br><span class=\"line\">Series.name = <span class=\"string\">&#x27;Name&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">s</span><br><span class=\"line\"></span><br><span class=\"line\">a    <span class=\"number\">1.0</span></span><br><span class=\"line\">b    <span class=\"number\">2.0</span></span><br><span class=\"line\">c    <span class=\"number\">3.0</span></span><br><span class=\"line\">d    <span class=\"number\">4.0</span></span><br><span class=\"line\"><span class=\"number\">0</span>    NaN</span><br><span class=\"line\">Name: Series s, dtype: float64</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Series的运算\"><a href=\"#Series的运算\" class=\"headerlink\" title=\"Series的运算\"></a>Series的运算</h4><h5 id=\"适用于numpy的数组运算也适用于Series\"><a href=\"#适用于numpy的数组运算也适用于Series\" class=\"headerlink\" title=\"适用于numpy的数组运算也适用于Series\"></a>适用于numpy的数组运算也适用于Series</h5><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">s + <span class=\"number\">1</span> </span><br><span class=\"line\"></span><br><span class=\"line\">a    <span class=\"number\">2.0</span></span><br><span class=\"line\">b    <span class=\"number\">3.0</span></span><br><span class=\"line\">c    <span class=\"number\">4.0</span></span><br><span class=\"line\">d    <span class=\"number\">5.0</span></span><br><span class=\"line\"><span class=\"number\">0</span>    NaN</span><br><span class=\"line\">Name: Series s, dtype: float64</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"Series之间的运算\"><a href=\"#Series之间的运算\" class=\"headerlink\" title=\"Series之间的运算\"></a>Series之间的运算</h5><ul>\n<li>在运算中自动对齐不同索引的数据</li>\n<li>如果索引不对应，则补NaN</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">s1 = Series(np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">10</span>,size=<span class=\"number\">4</span>),index=np.arange(<span class=\"number\">0</span>,<span class=\"number\">4</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">s1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">0</span>    <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">1</span>    <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">2</span>    <span class=\"number\">9</span></span><br><span class=\"line\"><span class=\"number\">3</span>    <span class=\"number\">3</span></span><br><span class=\"line\">dtype: int32</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">s2 = Series(np.random.randint(<span class=\"number\">0</span>, <span class=\"number\">10</span>, size=<span class=\"number\">4</span>), index=np.arange(<span class=\"number\">2</span>, <span class=\"number\">6</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">s2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">2</span>    <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">3</span>    <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">4</span>    <span class=\"number\">7</span></span><br><span class=\"line\"><span class=\"number\">5</span>    <span class=\"number\">9</span></span><br><span class=\"line\">dtype: int32</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">s1 + s2</span><br><span class=\"line\"><span class=\"comment\"># 相同的索引进行运算,不同的索引补NaN</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">0</span>     NaN</span><br><span class=\"line\"><span class=\"number\">1</span>     NaN</span><br><span class=\"line\"><span class=\"number\">2</span>    <span class=\"number\">10.0</span></span><br><span class=\"line\"><span class=\"number\">3</span>     <span class=\"number\">7.0</span></span><br><span class=\"line\"><span class=\"number\">4</span>     NaN</span><br><span class=\"line\"><span class=\"number\">5</span>     NaN</span><br><span class=\"line\">dtype: float64</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>注意：要想保留所有的index，则需要使用.add()函数</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 使用pandas封装的运算函数,保留所有index对应value</span></span><br><span class=\"line\">s1.add(s2, fill_value=<span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">0</span>     <span class=\"number\">1.0</span></span><br><span class=\"line\"><span class=\"number\">1</span>     <span class=\"number\">1.0</span></span><br><span class=\"line\"><span class=\"number\">2</span>    <span class=\"number\">10.0</span></span><br><span class=\"line\"><span class=\"number\">3</span>     <span class=\"number\">7.0</span></span><br><span class=\"line\"><span class=\"number\">4</span>     <span class=\"number\">7.0</span></span><br><span class=\"line\"><span class=\"number\">5</span>     <span class=\"number\">9.0</span></span><br><span class=\"line\">dtype: float64</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"DataFrame\"><a href=\"#DataFrame\" class=\"headerlink\" title=\"DataFrame\"></a>DataFrame</h3><p>DataFrame是一个【表格型】的数据结构，可以看做是【由Series组成的字典】（共用同一个索引）。DataFrame由按一定顺序排列的多列数据组成。设计初衷是将Series的使用场景从一维拓展到二维。DataFrame既有行索引，也有列索引。</p>\n<ul>\n<li>行索引：index</li>\n<li>列索引：columns</li>\n<li>值：values（numpy的二维数组）</li>\n</ul>\n<h4 id=\"DataFrame的创建\"><a href=\"#DataFrame的创建\" class=\"headerlink\" title=\"DataFrame的创建\"></a>DataFrame的创建</h4><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span>  pandas <span class=\"keyword\">import</span> DataFrame</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 分块创建</span></span><br><span class=\"line\">data = np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">150</span>, size=(<span class=\"number\">4</span>,<span class=\"number\">4</span>))</span><br><span class=\"line\">index = [<span class=\"string\">&#x27;张三&#x27;</span>, <span class=\"string\">&#x27;李四&#x27;</span>, <span class=\"string\">&#x27;王五&#x27;</span>, <span class=\"string\">&#x27;赵六&#x27;</span>]</span><br><span class=\"line\">columns = [<span class=\"string\">&#x27;语文&#x27;</span>, <span class=\"string\">&#x27;数学&#x27;</span>, <span class=\"string\">&#x27;英语&#x27;</span>,<span class=\"string\">&#x27;python&#x27;</span>]</span><br><span class=\"line\">df = DataFrame(data=data, index=index, columns=columns)</span><br><span class=\"line\">df</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 字典创建</span></span><br><span class=\"line\">df = DataFrame(&#123;<span class=\"string\">&#x27;语文&#x27;</span>: np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">150</span>, size=<span class=\"number\">4</span>), <span class=\"string\">&#x27;数学&#x27;</span>: np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">150</span>, size=<span class=\"number\">4</span>), <span class=\"string\">&#x27;英语&#x27;</span>: np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">150</span>, size=<span class=\"number\">4</span>), <span class=\"string\">&#x27;python&#x27;</span>: np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">150</span>, size=<span class=\"number\">4</span>)&#125;,</span><br><span class=\"line\">              )</span><br><span class=\"line\"></span><br><span class=\"line\">df.index = [<span class=\"string\">&#x27;张三&#x27;</span>, <span class=\"string\">&#x27;李四&#x27;</span>, <span class=\"string\">&#x27;王五&#x27;</span>, <span class=\"string\">&#x27;赵六&#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">df</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/pandas%E5%85%A5%E9%97%A8/image-20220710143524992.png\" alt=\"image-20220710143524992\"></p>\n<p>DataFrame属性：values、columns、index、shape</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">df.values</span><br><span class=\"line\">array([[ <span class=\"number\">74</span>,  <span class=\"number\">19</span>, <span class=\"number\">132</span>, <span class=\"number\">116</span>],</span><br><span class=\"line\">       [ <span class=\"number\">43</span>,  <span class=\"number\">90</span>,  <span class=\"number\">16</span>,  <span class=\"number\">42</span>],</span><br><span class=\"line\">       [<span class=\"number\">135</span>,  <span class=\"number\">37</span>,  <span class=\"number\">58</span>,  <span class=\"number\">42</span>],</span><br><span class=\"line\">       [ <span class=\"number\">91</span>,   <span class=\"number\">9</span>, <span class=\"number\">104</span>,  <span class=\"number\">51</span>]])</span><br><span class=\"line\"></span><br><span class=\"line\">df.columns</span><br><span class=\"line\">Index([<span class=\"string\">&#x27;语文&#x27;</span>, <span class=\"string\">&#x27;数学&#x27;</span>, <span class=\"string\">&#x27;英语&#x27;</span>, <span class=\"string\">&#x27;python&#x27;</span>], dtype=<span class=\"string\">&#x27;object&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">df.index</span><br><span class=\"line\">Index([<span class=\"string\">&#x27;张三&#x27;</span>, <span class=\"string\">&#x27;李四&#x27;</span>, <span class=\"string\">&#x27;王五&#x27;</span>, <span class=\"string\">&#x27;赵六&#x27;</span>], dtype=<span class=\"string\">&#x27;object&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">df.shape</span><br><span class=\"line\">(<span class=\"number\">4</span>, <span class=\"number\">4</span>)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"DataFrame的索引\"><a href=\"#DataFrame的索引\" class=\"headerlink\" title=\"DataFrame的索引\"></a>DataFrame的索引</h4><h5 id=\"对列进行索引\"><a href=\"#对列进行索引\" class=\"headerlink\" title=\"对列进行索引\"></a>对列进行索引</h5><ul>\n<li>通过类似字典的方式</li>\n<li>通过属性的方式</li>\n</ul>\n<p>可以将DataFrame的列获取为一个Series。返回的Series拥有原DataFrame相同的索引，且name属性也已经设置好了，就是相应的列名。</p>\n<p><img data-src=\"/../images/pandas%E5%85%A5%E9%97%A8/image-20220710150634683.png\" alt=\"image-20220710150634683\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">df[<span class=\"string\">&#x27;语文&#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">张三     <span class=\"number\">30</span></span><br><span class=\"line\">李四     <span class=\"number\">17</span></span><br><span class=\"line\">王五     <span class=\"number\">77</span></span><br><span class=\"line\">赵六    <span class=\"number\">102</span></span><br><span class=\"line\">Name: Name, dtype: int32</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">df.语文</span><br><span class=\"line\"></span><br><span class=\"line\">张三     <span class=\"number\">74</span></span><br><span class=\"line\">李四     <span class=\"number\">43</span></span><br><span class=\"line\">王五    <span class=\"number\">135</span></span><br><span class=\"line\">赵六     <span class=\"number\">91</span></span><br><span class=\"line\">Name: 语文, dtype: int32</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 新增一列</span></span><br><span class=\"line\">df[<span class=\"string\">&#x27;计算机&#x27;</span>] = np.random.randint(<span class=\"number\">0</span>,<span class=\"number\">150</span>, size=<span class=\"number\">4</span>)</span><br><span class=\"line\">df</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/pandas%E5%85%A5%E9%97%A8/image-20220710150748057.png\" alt=\"image-20220710150748057\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 新增一列的时候不能使用属性的写法</span></span><br><span class=\"line\"><span class=\"comment\"># df.理综 = np.random.randint(0,150, size=4)</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/pandas%E5%85%A5%E9%97%A8/image-20220710150955679.png\" alt=\"image-20220710150955679\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 列切片</span></span><br><span class=\"line\">df[<span class=\"string\">&#x27;数学 &#x27;</span>: <span class=\"string\">&#x27;python&#x27;</span>]</span><br><span class=\"line\"><span class=\"comment\"># 直接使用中括号,接冒号,是在进行行切片.</span></span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/pandas%E5%85%A5%E9%97%A8/image-20220710151053690.png\" alt=\"image-20220710151053690\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">df[[<span class=\"string\">&#x27;数学&#x27;</span>, <span class=\"string\">&#x27;英语&#x27;</span>, <span class=\"string\">&#x27;python&#x27;</span>]]</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/pandas%E5%85%A5%E9%97%A8/image-20220710151113939.png\" alt=\"image-20220710151113939\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">df.iloc[:, <span class=\"number\">1</span>:<span class=\"number\">4</span>]</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/pandas%E5%85%A5%E9%97%A8/image-20220710151217348.png\" alt=\"image-20220710151217348\"></p>\n<h5 id=\"对行进行索引\"><a href=\"#对行进行索引\" class=\"headerlink\" title=\"对行进行索引\"></a>对行进行索引</h5><ul>\n<li>使用.loc[]加index来进行行索引</li>\n<li>使用.iloc[]加整数来进行行索引</li>\n</ul>\n<p>同样返回一个Series，index为原来的columns。</p>\n<p><img data-src=\"/../images/pandas%E5%85%A5%E9%97%A8/image-20220710151857311.png\" alt=\"image-20220710151857311\"></p>\n<h5 id=\"对元素进行索引\"><a href=\"#对元素进行索引\" class=\"headerlink\" title=\"对元素进行索引\"></a>对元素进行索引</h5><ul>\n<li><p>使用列索引 </p>\n</li>\n<li><p>使用行索引(iloc[3,1]相当于两个参数;iloc[[3,3]] 里面的[3,3]看做一个参数) </p>\n</li>\n<li><p>使用values属性（二维numpy数组）</p>\n</li>\n</ul>\n<p><img data-src=\"/../images/pandas%E5%85%A5%E9%97%A8/image-20220710152641101.png\" alt=\"image-20220710152641101\"></p>\n<h5 id=\"DataFrame-索引总结\"><a href=\"#DataFrame-索引总结\" class=\"headerlink\" title=\"DataFrame 索引总结\"></a>DataFrame 索引总结</h5><ol>\n<li>行索引用.loc, 列索索引用中括号.</li>\n<li>对元素的索引,先索引行,再索引列. df.loc[index, columns]</li>\n<li>如果还想返回DataFrame,那么使用两层中括号.</li>\n</ol>\n<p>【注意】 直接用中括号时：</p>\n<ul>\n<li>索引表示的是列索引</li>\n<li>切片表示的是行切片</li>\n</ul>\n<h4 id=\"DataFrame的运算\"><a href=\"#DataFrame的运算\" class=\"headerlink\" title=\"DataFrame的运算\"></a>DataFrame的运算</h4><h5 id=\"DataFrame之间的运算\"><a href=\"#DataFrame之间的运算\" class=\"headerlink\" title=\"DataFrame之间的运算\"></a>DataFrame之间的运算</h5><p>同Series一样：</p>\n<ul>\n<li>在运算中自动对齐不同索引的数据</li>\n<li>如果索引不对应，则补NaN</li>\n</ul>\n<h5 id=\"Series与DataFrame之间的运算\"><a href=\"#Series与DataFrame之间的运算\" class=\"headerlink\" title=\"Series与DataFrame之间的运算\"></a>Series与DataFrame之间的运算</h5><p>【重要】</p>\n<ul>\n<li><p>使用Python操作符：以行为单位操作（参数必须是行），对所有行都有效。（类似于numpy中二维数组与一维数组的运算，但可能出现NaN）</p>\n</li>\n<li><p>使用pandas操作函数：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">axis=<span class=\"number\">0</span>：以列为单位操作（参数必须是列），对所有列都有效。</span><br><span class=\"line\">axis=<span class=\"number\">1</span>：以行为单位操作（参数必须是行），对所有行都有效。</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h5 id=\"归纳-总结\"><a href=\"#归纳-总结\" class=\"headerlink\" title=\"归纳,总结\"></a>归纳,总结</h5><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1</span>, DataFrame和单个数字运算,每个元素分别运算.</span><br><span class=\"line\"><span class=\"number\">2</span>, DataFrame和DataFrame运算,相同的行列索引进行运算,不同索引补NaN.</span><br><span class=\"line\"><span class=\"number\">3</span>, DataFrame和Series运算,使用运算符的时候,默认比较DataFrame的列索引和Series的索引.</span><br><span class=\"line\"><span class=\"number\">4</span>, 如果想保留原始数据,或者改变运算的方向,使用pandas封装的方法.</span><br></pre></td></tr></table></figure>\n\n\n\n","categories":["Pandas"],"tags":["Pandas","数据分析"]},{"title":"交换机VLAN命令","url":"/post/5bb83ec0.html","content":"<h3 id=\"VLAN基本命令\"><a href=\"#VLAN基本命令\" class=\"headerlink\" title=\"VLAN基本命令\"></a>VLAN基本命令</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">vlan 10  # 创建单个VALN</span><br><span class=\"line\">vlan batch 10 to 20 # 创建多个vlan</span><br><span class=\"line\">port link-type access/trunk/hybird # 配置接口类型</span><br><span class=\"line\">port default vlan 10 # 配置access关联vlan/pvid</span><br><span class=\"line\">port trunk allow-pass vlan 10 # 配置trunk允许vlan 默认只允许vlan1</span><br><span class=\"line\">port trunk pvid vlan 10 # 配置trunk的pvid</span><br><span class=\"line\">port hybird tagged/untagged vlan 10 # 配置hybird标记的vlan</span><br><span class=\"line\">port hybird pvid vlan 10 # 配置hybird 的pvid</span><br><span class=\"line\">display vlan # 验证vlan</span><br><span class=\"line\">display port vlan # 验证vlan端口</span><br></pre></td></tr></table></figure>\n\n","categories":["VLAN"],"tags":["交换机","VLAN"]},{"title":"冯诺依曼计算机结构","url":"/post/c20b476.html","content":"<p>冯·诺依曼结构也称普林斯顿结构，是一种将程序指令存储器和数据存储器合并在一起的存储器结构。程序指令存储地址和数据存储地址指向同一个存储器的不同物理位置，因此程序指令和数据的宽度相同，如英特尔公司的8086中央处理器的程序指令和数据都是16位宽。<br>数学家冯·诺依曼提出了计算机制造的三个基本原则，即采用二进制逻辑、程序存储执行以及计算机由五个部分组成（运算器、控制器、存储器、输入设备、输出设备），这套理论被称为冯·诺依曼体系结构。</p>\n<span id=\"more\"></span>\n\n<p><img data-src=\"/../images/%E5%86%AF%E8%AF%BA%E4%BE%9D%E6%9B%BC%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%93%E6%9E%84/%E5%86%AF%E8%AF%BA%E4%BE%9D%E6%9B%BC%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%93%E6%9E%84.png\" alt=\"冯诺依曼计算机结构\"></p>\n<p>冯·诺伊曼计算机结构的关键特点包括：</p>\n<ul>\n<li><strong>存储程序概念</strong>：程序指令和数据以相同的格式存储在存储器中，程序可以按顺序执行存储器中的指令。这种存储程序的特性使得冯·诺伊曼计算机能够灵活地执行不同的任务，而无需物理改变硬件。</li>\n<li><strong>顺序执行</strong>：指令按照存储顺序依次执行，每条指令执行完成后，控制单元会自动转移到下一条指令。</li>\n<li><strong>单一总线结构</strong>：CPU、存储器和输入&#x2F;输出设备之间通过一个共享的总线进行通信。这简化了计算机系统的设计和连接。</li>\n<li><strong>通用性</strong>：冯·诺伊曼计算机可以执行各种不同类型的任务，因为它们的指令集是通用的，可以处理不同的计算和数据处理需求。</li>\n</ul>\n<p>冯·诺伊曼计算机结构被广泛采用，并成为了现代计算机体系结构的基础。虽然现代计算机系统在冯·诺伊曼结构的基础上进行了各种扩展和改进，但其基本原理仍然是冯·诺伊曼所提出的。</p>\n","categories":["网工"],"tags":["网工","计算机基础"]},{"title":"华为交换机telnet配置方法","url":"/post/dc7ef1b9.html","content":"<p>telnet是专门用来远程连接的,一般多用于交换机,路由器</p>\n<p>华为交换机Telnet的两种配置方式：</p>\n<span id=\"more\"></span>\n\n<p>1.仅密码登录验证<br>代码如下（示例）：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;Quidway&gt;system-view -----进入配置模式</span><br><span class=\"line\">[Quidway]interface vlan 1 -----进入管理vlan</span><br><span class=\"line\">[Quidway-Vlanif1]ip address 192.168.28.49 255.255.255.0 -----配置管理ip地址</span><br><span class=\"line\">[Quidway-Vlanif1]quit -----退出</span><br><span class=\"line\">[Quidway]telnet server <span class=\"built_in\">enable</span> -----打开telnet服务 （一般默认开启）</span><br><span class=\"line\">[Quidway]user-interface vty 0 4 -----用户指定虚拟用户终端接口</span><br><span class=\"line\">[Quidway-ui-vty0-4]authentication-mode password -----配置用户终端接口认证方式 密码验证</span><br><span class=\"line\">[Quidway-ui-vty0-4]<span class=\"built_in\">set</span> authentication password cipher huawei123 -----设置接口验证密码,密码为huawei123</span><br><span class=\"line\">[Quidway-ui-vty0-4]user privilege level 15 -----设置用户优先级 （可选）</span><br><span class=\"line\">[Quidway-ui-vty0-4]idle-timeout 1 -----设置登陆超时为一分钟 （可选）</span><br><span class=\"line\">[Quidway-ui-vty0-4]<span class=\"built_in\">return</span> -----返回用户视图</span><br><span class=\"line\">&lt;Quidway&gt;save -----保存</span><br></pre></td></tr></table></figure>\n\n\n\n<p>2.配置AAA登录<br>代码如下（示例）：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;Quidway&gt;system-view -----进入配置模式</span><br><span class=\"line\">[Quidway]interface vlan 1 -----进入管理vlan</span><br><span class=\"line\">[Quidway-Vlanif1]ip address 192.168.28.49 255.255.255.0 -----配置管理ip地址</span><br><span class=\"line\">[Quidway-Vlanif1]quit -----退出</span><br><span class=\"line\">[Quidway]telnet server <span class=\"built_in\">enable</span> -----打开telnet服务 （一般默认开启）</span><br><span class=\"line\">[Quidway]user-interface vty 0 4 -----用户指定虚拟用户终端接口</span><br><span class=\"line\">[Quidway-ui-vty0-4]authentication-mode aaa -----配置用户终端接口认证方式 aaa验证</span><br><span class=\"line\">[Quidway-ui-vty0-4]user privilege level 15 -----设置用户优先级</span><br><span class=\"line\">[Quidway-ui-vty0-4]idle-timeout 1 -----设置登陆超时为一分钟</span><br><span class=\"line\">[Quidway-ui-vty0-4]quit -----退出</span><br><span class=\"line\">[Quidway]aaa -----进入aaa</span><br><span class=\"line\">[Quidway-aaa]local-user huawei password cipher huawei123 -----创建用户名huawei 密码huawei123</span><br><span class=\"line\">[Quidway-aaa]local-user huawei privilege level 15 -----设置用户优先级</span><br><span class=\"line\">[Quidway-aaa]local-user huawei service-type telnet -----授权用户使用telnet</span><br><span class=\"line\">[Quidway-ui-vty0-4]<span class=\"built_in\">return</span> -----返回用户视图</span><br><span class=\"line\">&lt;Quidway&gt;save -----保存</span><br></pre></td></tr></table></figure>\n\n","categories":["telnet配置"],"tags":["交换机","telnet"]},{"title":"原码,反码,补码介绍","url":"/post/cca0aa9a.html","content":"<p>原码、反码和补码是计算机中用来表示整数的不同编码方式。它们通常用于处理有符号整数的表示和运算。</p>\n<span id=\"more\"></span>\n\n<ol>\n<li><p><strong>原码（Sign-Magnitude）</strong>：</p>\n<ul>\n<li>原码是最直接的整数表示方法，其中最高位表示符号位，0表示正数，1表示负数。其余位表示数值部分。</li>\n<li>例如，+5的原码是00000101，-5的原码是10000101。</li>\n<li>原码的主要缺点是有两个零，即+0和-0，以及在进行加减运算时需要特殊处理符号位，因此并不常用于实际的计算机系统。</li>\n</ul>\n</li>\n<li><p><strong>反码（Ones’ Complement）</strong>：</p>\n<ul>\n<li>反码解决了原码中存在两个零的问题，但仍然需要特殊处理符号位。</li>\n<li>正数的反码与原码相同，负数的反码是其原码除符号位外的各位取反。</li>\n<li>例如，+5的反码是00000101，-5的反码是11111010。</li>\n<li>反码的一个特点是，正负数的加法可以通过同样的算法进行，但是减法需要转换为加法。</li>\n</ul>\n</li>\n<li><p><strong>补码（Two’s Complement）</strong>：</p>\n<ul>\n<li>补码是最常用的整数表示方式，解决了原码和反码中的一些问题。</li>\n<li>正数的补码与原码相同，负数的补码是其原码取反后加1。</li>\n<li>例如，+5的补码是00000101，-5的补码是11111011。</li>\n<li>补码表示中只有一个零，而且加法和减法可以通过相同的算法进行，简化了计算。</li>\n<li>补码的最高位仍然表示符号位，但是不需要特殊处理，因为补码加法在溢出时会自动忽略溢出位，从而得到正确的结果。</li>\n</ul>\n<h4 id=\"取值范围\"><a href=\"#取值范围\" class=\"headerlink\" title=\"取值范围\"></a>取值范围</h4><p>原码、反码和补码是计算机中用于表示有符号整数的不同编码方式。它们的取值范围如下：</p>\n<table>\n<thead>\n<tr>\n<th>编码方式</th>\n<th>取值范围</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>原码</td>\n<td>-(2^(n-1)-1) ~ 2^(n-1)-1 (n位整数)</td>\n</tr>\n<tr>\n<td>反码</td>\n<td>-(2^(n-1)-1) ~ 2^(n-1)-1 (n位整数)</td>\n</tr>\n<tr>\n<td>补码</td>\n<td>-2^(n-1) ~ 2^(n-1)-1 (n位整数)</td>\n</tr>\n</tbody></table>\n<p>这里，n表示整数的位数，通常为8位、16位、32位或64位等。</p>\n</li>\n</ol>\n<p>总之，原码、反码和补码是用于表示有符号整数的不同编码方式，补码是最常用的一种，因为它具有简单的加法和减法规则，并且只有一个零。</p>\n<p>下面是一些关于原码、反码和补码的习题以及答案：</p>\n<p><strong>习题：</strong></p>\n<ol>\n<li>将十进制数+12表示为原码、反码和补码。</li>\n<li>将十进制数-8表示为原码、反码和补码。</li>\n<li>将十进制数-25表示为原码、反码和补码。</li>\n<li>计算以下两个十进制数的和，并以补码形式表示结果：5和-3。</li>\n<li>计算以下两个十进制数的差，并以补码形式表示结果：-9和7。</li>\n</ol>\n<p><strong>答案：</strong></p>\n<ol>\n<li>+12的二进制表示为：00001100（原码）、00001100（反码）、00001100（补码）。</li>\n<li>-8的二进制表示为：10001000（原码）、11110111（反码）、11111000（补码）。</li>\n<li>-25的二进制表示为：10011001（原码）、11100110（反码）、11100111（补码）。</li>\n<li>5的补码表示为：00000101，-3的补码表示为：11111101。它们的和为：00000010，即+2的补码表示。</li>\n<li>-9的补码表示为：11110111，7的补码表示为：00000111。它们的差为：11111110，即-2的补码表示。</li>\n</ol>\n","categories":["网工"],"tags":["网工","计算机"]},{"title":"局域网打印机突然连接不上/不能打印0x0000011b 正式解决方案（无需卸载补丁）","url":"/post/49f13f70.html","content":"<p>局域网打印机突然连接不上&#x2F;不能打印0x0000011b 正式解决方案</p>\n<ol>\n<li>同时按住“win+R”调出运行窗口。</li>\n<li>在运行窗口输入“regedit”并点确定调出注册表编辑器。</li>\n<li>找到以下路径“HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Print”，空白处单击右键，点击新建值“DWORD (32位）值（D）”。</li>\n<li>给该新建值重命名为“RpcAuthnLevelPrivacyEnabled”。</li>\n<li>重命名之后选择值“RpcAuthnLevelPrivacyEnabled”，单击右键&gt;修改&gt;键入数值“0”&gt;确定。</li>\n<li>重启电脑即可。</li>\n</ol>\n","categories":["打印机"],"tags":["打印机"]},{"title":"动态路由协议-RIP","url":"/post/5cc00ef5.html","content":"<p><img data-src=\"/../images/%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE-RIP/image-20230315155922516.png\" alt=\"image-20230315155922516\"></p>\n<p>AS（自治域系统）内部使用内部网关协议； AS与AS之间使用外部网关协议</p>\n<ul>\n<li><strong>静态路由：</strong>由网络管理员根据数据访问需求手动在每台设备上进行添加和维护。</li>\n<li><strong>动态路由：</strong>路由器自动进行路由信息的更新和同步，在网络拓扑改变时能够自动进行收敛。</li>\n</ul>\n<span id=\"more\"></span>\n\n<h3 id=\"RIP-协议的优缺点\"><a href=\"#RIP-协议的优缺点\" class=\"headerlink\" title=\"RIP 协议的优缺点\"></a><strong>RIP 协议的优缺点</strong></h3><h3 id=\"优点：\"><a href=\"#优点：\" class=\"headerlink\" title=\"优点：\"></a><strong>优点：</strong></h3><ul>\n<li>RIP 协议非常适合小型网络 - 易于理解和配置。</li>\n<li>RIP 路由保证支持几乎所有的路由器。</li>\n<li>RIP 不需要每次网络拓扑更改时都进行更新。</li>\n</ul>\n<h3 id=\"缺点：\"><a href=\"#缺点：\" class=\"headerlink\" title=\"缺点：\"></a><strong>缺点：</strong></h3><ul>\n<li>RIP 可能会造成流量瓶颈，因为它每 30 秒广播一次更新，由于 RIP 中的任何路由更新都会<strong>占用大量带宽</strong>，因此关键 IT 流程的资源是有限的。</li>\n<li>RIP 的跳数限制为 <strong>15</strong> 跳，因此超出该距离的任何路由器都被视为无穷大，因此无法访问。</li>\n<li>收敛速度很慢，当任何链接出现故障时，选择替代路线需要花费大量时间。</li>\n<li>RIP 不支持同一路由上的多条路径，这可能会产生更多的路由环路，使用固定跳数度量来选择最佳路由时，根据实时数据比较路由时，RIP 无法工作，由于重复的过程，这会导致数据包丢失和网络操作过载。</li>\n</ul>\n<h3 id=\"示例：\"><a href=\"#示例：\" class=\"headerlink\" title=\"示例：\"></a><strong>示例：</strong></h3><p><img data-src=\"/../images/%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE-RIP/image-20230315154406871.png\" alt=\"image-20230315154406871\"></p>\n<h3 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置:\"></a>配置:</h3><p>R1</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 配置进程号</span></span><br><span class=\"line\">[R1]rip 1</span><br><span class=\"line\"><span class=\"comment\"># 配置版本 </span></span><br><span class=\"line\">[R1-rip-1]version 2</span><br><span class=\"line\"><span class=\"comment\"># 宣告</span></span><br><span class=\"line\">[R1-rip-1] network 192.168.1.0</span><br><span class=\"line\">[R1-rip-1] network 12.0.0.0</span><br></pre></td></tr></table></figure>\n\n<p>R2</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 配置进程号</span></span><br><span class=\"line\">[R1]rip 1</span><br><span class=\"line\"><span class=\"comment\"># 配置版本 </span></span><br><span class=\"line\">[R1-rip-1]version 2</span><br><span class=\"line\"><span class=\"comment\"># 宣告</span></span><br><span class=\"line\">[R1-rip-1] network 23.0.0.0</span><br><span class=\"line\">[R1-rip-1] network 12.0.0.0</span><br></pre></td></tr></table></figure>\n\n<p>R3</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 配置进程号</span></span><br><span class=\"line\">[R1]rip 1</span><br><span class=\"line\"><span class=\"comment\"># 配置版本 </span></span><br><span class=\"line\">[R1-rip-1]version 2</span><br><span class=\"line\"><span class=\"comment\"># 宣告</span></span><br><span class=\"line\">[R1-rip-1] network 23.0.0.0</span><br><span class=\"line\">[R1-rip-1] network 192.168.3.0</span><br></pre></td></tr></table></figure>\n\n<p>验证</p>\n<p><img data-src=\"/../images/%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE-RIP/image-20230315154808191.png\" alt=\"image-20230315154808191\"></p>\n<p>RIP 的配置还是非常简单的</p>\n","categories":["路由"],"tags":["路由","RIP"]},{"title":"算法回顾","url":"/post/eb37acc3.html","content":"<p>回顾一下4个基本算法:冒泡,选择,插入,快速</p>\n<span id=\"more\"></span>\n\n<h2 id=\"冒泡算法\"><a href=\"#冒泡算法\" class=\"headerlink\" title=\"冒泡算法\"></a>冒泡算法</h2><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">bubble_sort</span>(<span class=\"params\">arr</span>):</span><br><span class=\"line\">    length = <span class=\"built_in\">len</span>(arr)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,length+<span class=\"number\">1</span>):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,length-i+<span class=\"number\">1</span>):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> arr[j-<span class=\"number\">1</span>]&gt;arr[j]:</span><br><span class=\"line\">                arr[j-<span class=\"number\">1</span>],arr[j] = arr[j],arr[j-<span class=\"number\">1</span>]</span><br><span class=\"line\">                </span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr </span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/%E7%AE%97%E6%B3%95%E5%9B%9E%E9%A1%BE/webp.gif\" alt=\"img\"></p>\n<h2 id=\"选择排序\"><a href=\"#选择排序\" class=\"headerlink\" title=\"选择排序\"></a>选择排序</h2><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span>  <span class=\"title function_\">select_sort</span>(<span class=\"params\">arr</span>):</span><br><span class=\"line\">    length = <span class=\"built_in\">len</span>(arr)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(length):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(i+<span class=\"number\">1</span>,length):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> arr[i]&gt;arr[j]:</span><br><span class=\"line\">                arr[i],arr[j] = arr[j],arr[i]</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/%E7%AE%97%E6%B3%95%E5%9B%9E%E9%A1%BE/webp-16570988216773.gif\" alt=\"img\"></p>\n<h2 id=\"插入排序\"><a href=\"#插入排序\" class=\"headerlink\" title=\"插入排序\"></a>插入排序</h2><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 插入排序,是跟前一个比较 比前一个小就往前移动</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">insert_sort</span>(<span class=\"params\">arr</span>):</span><br><span class=\"line\">    length = <span class=\"built_in\">len</span>(arr)</span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,length):</span><br><span class=\"line\">        loop_index = i</span><br><span class=\"line\">        <span class=\"keyword\">while</span> loop_index&gt;<span class=\"number\">0</span> <span class=\"keyword\">and</span> arr[loop_index-<span class=\"number\">1</span>]&gt;arr[loop_index]:</span><br><span class=\"line\">            count+=<span class=\"number\">1</span></span><br><span class=\"line\">            arr[loop_index-<span class=\"number\">1</span>] ,arr[loop_index] = arr[loop_index],arr[loop_index-<span class=\"number\">1</span>]</span><br><span class=\"line\">            loop_index -=<span class=\"number\">1</span></span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/%E7%AE%97%E6%B3%95%E5%9B%9E%E9%A1%BE/webp-16570988562036.gif\" alt=\"img\"></p>\n<h2 id=\"快速排序\"><a href=\"#快速排序\" class=\"headerlink\" title=\"快速排序\"></a>快速排序</h2><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 快速排序</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">quick_sort</span>(<span class=\"params\">arr</span>):</span><br><span class=\"line\">   </span><br><span class=\"line\">    length = <span class=\"built_in\">len</span>(arr)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> length &lt;= <span class=\"number\">1</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> arr</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        middle = arr.pop()</span><br><span class=\"line\">        bigs,smalls = [],[]</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> arr:</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">if</span> i &lt;middle:</span><br><span class=\"line\">                smalls.append(i)</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                bigs.append(i)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> quick_sort(smalls) + [middle] + quick_sort(bigs)</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/%E7%AE%97%E6%B3%95%E5%9B%9E%E9%A1%BE/640.gif\" alt=\"img\"></p>\n","categories":["算法"],"tags":["算法"]},{"title":"python操作redis","url":"/post/979f557b.html","content":"<p>REmote DIctionary Server(Redis) 是一个由Salvatore Sanfilippo写的key-value存储系统。</p>\n<p>Redis是一个开源的使用ANSI C语言编写、遵守BSD协议、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。</p>\n<p>它通常被称为数据结构服务器，因为值（value）可以是 字符串(String), 哈希(Hash), 列表(list), 集合(sets) 和 有序集合(sorted sets)等类型。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"Redis-简介\"><a href=\"#Redis-简介\" class=\"headerlink\" title=\"Redis 简介\"></a>Redis 简介</h2><p>Redis 是完全开源免费的，遵守BSD协议，是一个高性能的key-value数据库。</p>\n<p>Redis 与其他 key - value 缓存产品有以下三个特点：</p>\n<ul>\n<li>Redis支持数据的持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。</li>\n<li>Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。</li>\n<li>Redis支持数据的备份，即master-slave模式的数据备份。</li>\n</ul>\n<h2 id=\"Redis-优势\"><a href=\"#Redis-优势\" class=\"headerlink\" title=\"Redis 优势\"></a>Redis 优势</h2><ul>\n<li>性能极高 – Redis能读的速度是110000次&#x2F;s,写的速度是81000次&#x2F;s 。</li>\n<li>丰富的数据类型 – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。</li>\n<li>原子 – Redis的所有操作都是原子性的，意思就是要么成功执行要么失败完全不执行。单个操作是原子性的。多个操作也支持事务，即原子性，通过MULTI和EXEC指令包起来。</li>\n<li>丰富的特性 – Redis还支持 publish&#x2F;subscribe, 通知, key 过期等等特性。</li>\n</ul>\n<h2 id=\"安装Redis\"><a href=\"#安装Redis\" class=\"headerlink\" title=\"安装Redis\"></a>安装Redis</h2><h3 id=\"windows安装\"><a href=\"#windows安装\" class=\"headerlink\" title=\"windows安装:\"></a>windows安装:</h3><p>下载地址:<a href=\"https://github.com/tporadowski/redis/releases\">https://github.com/tporadowski/redis/releases</a></p>\n<p>直接下一步一步就可以了</p>\n<h3 id=\"LInux下安装\"><a href=\"#LInux下安装\" class=\"headerlink\" title=\"LInux下安装:\"></a>LInux下安装:</h3><ul>\n<li>centos:</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">安装</span></span><br><span class=\"line\">yum install redis -y</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">当然没有权限的时候记得加sudo</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">启动</span></span><br><span class=\"line\">redis-server</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>untubu</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">安装</span></span><br><span class=\"line\">apt-get update</span><br><span class=\"line\">apt-get install redis</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">启动</span></span><br><span class=\"line\">redis-server</span><br></pre></td></tr></table></figure>\n\n<p>编译安装</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">wget http://download.redis.io/releases/redis-6.0.4.tar.gz</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">tar xzf redis-6.0.4.tar.gz</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\"><span class=\"built_in\">cd</span> redis-6.0.4</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">make</span></span><br></pre></td></tr></table></figure>\n\n<p><code>src</code> 目录 中现在提供了已编译的二进制文件 。使用以下命令运行Redis：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">src/redis-server</span></span><br></pre></td></tr></table></figure>\n\n<p>当然这些都是运维会配置好的,我们了解即可</p>\n<h2 id=\"Python安装-redis-模块\"><a href=\"#Python安装-redis-模块\" class=\"headerlink\" title=\"Python安装 redis 模块\"></a>Python安装 redis 模块</h2><p>Python 要使用 redis，需要先安装 redis 模块：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">pip3 install redis</span><br></pre></td></tr></table></figure>\n\n<p>redis 提供两个类 Redis 和 StrictRedis, StrictRedis 用于实现大部分官方的命令，Redis 是 StrictRedis 的子类，用于向后兼用旧版本。</p>\n<p>redis 取出的结果默认是字节，我们可以设定 <strong>decode_responses&#x3D;True</strong> 改成字符串。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> redis   <span class=\"comment\"># 导入redis 模块</span></span><br><span class=\"line\">r = redis.Redis(host=<span class=\"string\">&#x27;localhost&#x27;</span>, port=<span class=\"number\">6379</span>, decode_responses=<span class=\"literal\">True</span>)  </span><br><span class=\"line\">r.<span class=\"built_in\">set</span>(<span class=\"string\">&#x27;name&#x27;</span>, <span class=\"string\">&#x27;runoob&#x27;</span>)  <span class=\"comment\"># 设置 name 对应的值</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r[<span class=\"string\">&#x27;name&#x27;</span>])</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.get(<span class=\"string\">&#x27;name&#x27;</span>))  <span class=\"comment\"># 取出键 name 对应的值</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">type</span>(r.get(<span class=\"string\">&#x27;name&#x27;</span>)))  <span class=\"comment\"># 查看类型</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"连接池\"><a href=\"#连接池\" class=\"headerlink\" title=\"连接池\"></a>连接池</h2><p>redis-py 使用 connection pool 来管理对一个 redis server 的所有连接，避免每次建立、释放连接的开销。</p>\n<p>默认，每个Redis实例都会维护一个自己的连接池。可以直接建立一个连接池，然后作为参数 Redis，这样就可以实现多个 Redis 实例共享一个连接池。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> redis    <span class=\"comment\"># 导入redis 模块</span></span><br><span class=\"line\"></span><br><span class=\"line\">pool = redis.ConnectionPool(host=<span class=\"string\">&#x27;localhost&#x27;</span>, port=<span class=\"number\">6379</span>, decode_responses=<span class=\"literal\">True</span>)</span><br><span class=\"line\">r = redis.Redis(connection_pool=pool)</span><br><span class=\"line\">r.<span class=\"built_in\">set</span>(<span class=\"string\">&#x27;name&#x27;</span>, <span class=\"string\">&#x27;runoob&#x27;</span>)  <span class=\"comment\"># 设置 name 对应的值</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.get(<span class=\"string\">&#x27;name&#x27;</span>))  <span class=\"comment\"># 取出键 name 对应的值</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"常用命令\"><a href=\"#常用命令\" class=\"headerlink\" title=\"常用命令\"></a>常用命令</h2><h3 id=\"redis基本命令-String\"><a href=\"#redis基本命令-String\" class=\"headerlink\" title=\"redis基本命令 String\"></a>redis基本命令 String</h3><h4 id=\"set-name-value-ex-x3D-None-px-x3D-None-nx-x3D-False-xx-x3D-False\"><a href=\"#set-name-value-ex-x3D-None-px-x3D-None-nx-x3D-False-xx-x3D-False\" class=\"headerlink\" title=\"set(name, value, ex&#x3D;None, px&#x3D;None, nx&#x3D;False, xx&#x3D;False)\"></a>set(name, value, ex&#x3D;None, px&#x3D;None, nx&#x3D;False, xx&#x3D;False)</h4><p>在Redis中设置值，默认，不存在则创建，存在则修改<br>参数：</p>\n<ul>\n<li>ex，过期时间（秒）</li>\n<li>px，过期时间（毫秒）</li>\n<li>nx，如果设置为True，则只有name不存在时，当前set操作才执行</li>\n<li>xx，如果设置为True，则只有name存在时，当前set操作才执行</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">r.<span class=\"built_in\">set</span>(<span class=\"string\">&#x27;k&#x27;</span>,<span class=\"string\">&#x27;v&#x27;</span>,ex=<span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.get(<span class=\"string\">&#x27;k&#x27;</span>)) <span class=\"string\">&#x27;v&#x27;</span></span><br><span class=\"line\">time.sleep(<span class=\"number\">3</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.get(<span class=\"string\">&#x27;k&#x27;</span>)) <span class=\"literal\">None</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"mset-args-kwargs-批量设置值\"><a href=\"#mset-args-kwargs-批量设置值\" class=\"headerlink\" title=\"mset(*args, **kwargs):批量设置值\"></a><code>mset(*args, **kwargs)</code>:批量设置值</h4><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">r.mget(&#123;<span class=\"string\">&#x27;k1&#x27;</span>: <span class=\"string\">&#x27;v1&#x27;</span>, <span class=\"string\">&#x27;k2&#x27;</span>: <span class=\"string\">&#x27;v2&#x27;</span>&#125;)</span><br><span class=\"line\">r.mset(k1=<span class=\"string\">&quot;v1&quot;</span>, k2=<span class=\"string\">&quot;v2&quot;</span>) <span class=\"comment\"># 这里k1 和k2 不能带引号 一次设置对个键值对</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.mget(<span class=\"string\">&quot;k1&quot;</span>, <span class=\"string\">&quot;k2&quot;</span>))   <span class=\"comment\"># 一次取出多个键对应的值</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.mget(<span class=\"string\">&quot;k1&quot;</span>))</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"mget-keys-args-批量获取\"><a href=\"#mget-keys-args-批量获取\" class=\"headerlink\" title=\"mget(keys, *args):批量获取\"></a><code>mget(keys, *args)</code>:批量获取</h4><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">print</span>(r.mget(<span class=\"string\">&#x27;k1&#x27;</span>, <span class=\"string\">&#x27;k2&#x27;</span>))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.mget([<span class=\"string\">&#x27;k1&#x27;</span>, <span class=\"string\">&#x27;k2&#x27;</span>]))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.mget(<span class=\"string\">&quot;fruit&quot;</span>, <span class=\"string\">&quot;fruit1&quot;</span>, <span class=\"string\">&quot;fruit2&quot;</span>, <span class=\"string\">&quot;k1&quot;</span>, <span class=\"string\">&quot;k2&quot;</span>))  <span class=\"comment\"># 将目前redis缓存中的键对应的值批量取出来</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"getset-name-value-设置新值并获取原来的值\"><a href=\"#getset-name-value-设置新值并获取原来的值\" class=\"headerlink\" title=\"getset(name, value):设置新值并获取原来的值\"></a><code>getset(name, value)</code>:设置新值并获取原来的值</h4><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">print</span>(r.getset(<span class=\"string\">&quot;food&quot;</span>, <span class=\"string\">&quot;barbecue&quot;</span>))  <span class=\"comment\"># 设置的新值是barbecue 设置前的值是beef</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"redis基本命令-hash\"><a href=\"#redis基本命令-hash\" class=\"headerlink\" title=\"redis基本命令 hash\"></a>redis基本命令 hash</h3><h4 id=\"hset-name-key-value\"><a href=\"#hset-name-key-value\" class=\"headerlink\" title=\"hset(name, key, value)\"></a><code>hset(name, key, value)</code></h4><p>单个增加—修改(单个取出)—没有就新增，有的话就修改</p>\n<p>name对应的hash中设置一个键值对（不存在，则创建；否则，修改）<br>参数：</p>\n<ul>\n<li>name，redis的name</li>\n<li>key，name对应的hash中的key</li>\n<li>value，name对应的hash中的value</li>\n</ul>\n<p>注：<br>hsetnx(name, key, value),当name对应的hash中不存在当前key时则创建（相当于添加）</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">r.hset(<span class=\"string\">&quot;hash1&quot;</span>, <span class=\"string\">&quot;k1&quot;</span>, <span class=\"string\">&quot;v1&quot;</span>)</span><br><span class=\"line\">r.hset(<span class=\"string\">&quot;hash1&quot;</span>, <span class=\"string\">&quot;k2&quot;</span>, <span class=\"string\">&quot;v2&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.hkeys(<span class=\"string\">&quot;hash1&quot;</span>)) <span class=\"comment\"># 取hash中所有的key</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.hget(<span class=\"string\">&quot;hash1&quot;</span>, <span class=\"string\">&quot;k1&quot;</span>))    <span class=\"comment\"># 单个取hash的key对应的值</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.hmget(<span class=\"string\">&quot;hash1&quot;</span>, <span class=\"string\">&quot;k1&quot;</span>, <span class=\"string\">&quot;k2&quot;</span>)) <span class=\"comment\"># 多个取hash的key对应的值</span></span><br><span class=\"line\">r.hsetnx(<span class=\"string\">&quot;hash1&quot;</span>, <span class=\"string\">&quot;k2&quot;</span>, <span class=\"string\">&quot;v3&quot;</span>) <span class=\"comment\"># 只能新建</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.hget(<span class=\"string\">&quot;hash1&quot;</span>, <span class=\"string\">&quot;k2&quot;</span>))</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"hmset-name-mapping-批量增加（取出）\"><a href=\"#hmset-name-mapping-批量增加（取出）\" class=\"headerlink\" title=\"hmset(name, mapping)批量增加（取出）\"></a><code>hmset(name, mapping)</code>批量增加（取出）</h4><p>在name对应的hash中批量设置键值对<br>参数：</p>\n<ul>\n<li>name，redis的name</li>\n<li>mapping，字典，如：{‘k1’:’v1’, ‘k2’: ‘v2’}</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">r.hmset(<span class=\"string\">&quot;hash2&quot;</span>, &#123;<span class=\"string\">&quot;k2&quot;</span>: <span class=\"string\">&quot;v2&quot;</span>, <span class=\"string\">&quot;k3&quot;</span>: <span class=\"string\">&quot;v3&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"hget-name-key-在name对应的hash中获取根据key获取value\"><a href=\"#hget-name-key-在name对应的hash中获取根据key获取value\" class=\"headerlink\" title=\"hget(name,key)在name对应的hash中获取根据key获取value\"></a><code>hget(name,key)</code>在name对应的hash中获取根据key获取value</h4><h4 id=\"hmget-name-keys-args-在name对应的hash中获取多个key的值\"><a href=\"#hmget-name-keys-args-在name对应的hash中获取多个key的值\" class=\"headerlink\" title=\"hmget(name, keys, *args) 在name对应的hash中获取多个key的值\"></a><code>hmget(name, keys, *args)</code> 在name对应的hash中获取多个key的值</h4><p>参数：</p>\n<ul>\n<li>name，reids对应的name</li>\n<li>keys，要获取key集合，如：[‘k1’, ‘k2’, ‘k3’]</li>\n<li>*args，要获取的key，如：k1,k2,k3</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">print</span>(r.hget(<span class=\"string\">&quot;hash2&quot;</span>, <span class=\"string\">&quot;k2&quot;</span>))  <span class=\"comment\"># 单个取出&quot;hash2&quot;的key-k2对应的value</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.hmget(<span class=\"string\">&quot;hash2&quot;</span>, <span class=\"string\">&quot;k2&quot;</span>, <span class=\"string\">&quot;k3&quot;</span>))  <span class=\"comment\"># 批量取出&quot;hash2&quot;的key-k2 k3对应的value --方式1</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.hmget(<span class=\"string\">&quot;hash2&quot;</span>, [<span class=\"string\">&quot;k2&quot;</span>, <span class=\"string\">&quot;k3&quot;</span>]))  <span class=\"comment\"># 批量取出&quot;hash2&quot;的key-k2 k3对应的value --方式2</span></span><br></pre></td></tr></table></figure>\n\n<p><code>hgetall(name)</code>取出所有的键值对</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">print</span>(r.hgetall(<span class=\"string\">&quot;hash1&quot;</span>))</span><br></pre></td></tr></table></figure>\n\n<p><code>hexists(name, key)</code>判断成员是否存在（类似字典的in）</p>\n<p>检查name对应的hash是否存在当前传入的key</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">print</span>(r.hexists(<span class=\"string\">&quot;hash1&quot;</span>, <span class=\"string\">&quot;k4&quot;</span>))  <span class=\"comment\"># False 不存在</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.hexists(<span class=\"string\">&quot;hash1&quot;</span>, <span class=\"string\">&quot;k1&quot;</span>))  <span class=\"comment\"># True 存在</span></span><br></pre></td></tr></table></figure>\n\n<p><code>hdel(name,*keys)</code>删除键值对</p>\n<p>将name对应的hash中指定key的键值对删除</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">print</span>(r.hgetall(<span class=\"string\">&quot;hash1&quot;</span>))</span><br><span class=\"line\">r.hset(<span class=\"string\">&quot;hash1&quot;</span>, <span class=\"string\">&quot;k2&quot;</span>, <span class=\"string\">&quot;v222&quot;</span>)   <span class=\"comment\"># 修改已有的key k2</span></span><br><span class=\"line\">r.hset(<span class=\"string\">&quot;hash1&quot;</span>, <span class=\"string\">&quot;k11&quot;</span>, <span class=\"string\">&quot;v1&quot;</span>)   <span class=\"comment\"># 新增键值对 k11</span></span><br><span class=\"line\">r.hdel(<span class=\"string\">&quot;hash1&quot;</span>, <span class=\"string\">&quot;k1&quot;</span>)    <span class=\"comment\"># 删除一个键值对</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.hgetall(<span class=\"string\">&quot;hash1&quot;</span>))</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"redis基本命令-list\"><a href=\"#redis基本命令-list\" class=\"headerlink\" title=\"redis基本命令 list\"></a>redis基本命令 list</h3><h4 id=\"lpush-name-values-左添加-amp-rpush右添加\"><a href=\"#lpush-name-values-左添加-amp-rpush右添加\" class=\"headerlink\" title=\"lpush(name,values) 左添加 &amp;rpush右添加\"></a><code>lpush(name,values)</code> 左添加 &amp;<code>rpush</code>右添加</h4><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">r.lpush(<span class=\"string\">&quot;list1&quot;</span>, <span class=\"number\">11</span>, <span class=\"number\">22</span>, <span class=\"number\">33</span>)    <span class=\"comment\"># 在列表的左边，依次添加11,22,33</span></span><br><span class=\"line\">r.rpush(<span class=\"string\">&quot;list2&quot;</span>, <span class=\"number\">44</span>, <span class=\"number\">55</span>, <span class=\"number\">66</span>)    <span class=\"comment\"># 在列表的右边，依次添加44,55,66</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"lpushx-name-value-存在才添加左边-amp-rpushx-name-value-存在才添加右边\"><a href=\"#lpushx-name-value-存在才添加左边-amp-rpushx-name-value-存在才添加右边\" class=\"headerlink\" title=\"lpushx(name,value) 存在才添加左边 &amp;rpushx(name,value) 存在才添加右边\"></a><code>lpushx(name,value)</code> 存在才添加左边 &amp;<code>rpushx(name,value)</code> 存在才添加右边</h4><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">r.lpushx(<span class=\"string\">&quot;list10&quot;</span>, <span class=\"number\">10</span>)   <span class=\"comment\"># 这里list10不存在</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.llen(<span class=\"string\">&quot;list10&quot;</span>))  <span class=\"comment\"># 0</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.lrange(<span class=\"string\">&quot;list10&quot;</span>, <span class=\"number\">0</span>, -<span class=\"number\">1</span>))  <span class=\"comment\"># []</span></span><br><span class=\"line\">r.lpushx(<span class=\"string\">&quot;list2&quot;</span>, <span class=\"number\">77</span>)   <span class=\"comment\"># 这里&quot;list2&quot;之前已经存在，往列表最左边添加一个元素，一次只能添加一个</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.llen(<span class=\"string\">&quot;list2&quot;</span>))  <span class=\"comment\"># 列表长度</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.lrange(<span class=\"string\">&quot;list2&quot;</span>, <span class=\"number\">0</span>, -<span class=\"number\">1</span>)) <span class=\"comment\"># 切片取出值，范围是索引号0到-1(最后一个元素</span></span><br><span class=\"line\">r.rpushx(<span class=\"string\">&quot;list2&quot;</span>, <span class=\"number\">99</span>)   <span class=\"comment\"># 这里&quot;foo_list1&quot;之前已经存在，往列表最右边添加一个元素，一次只能添加一个</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.llen(<span class=\"string\">&quot;list2&quot;</span>))  <span class=\"comment\"># 列表长度</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.lrange(<span class=\"string\">&quot;list2&quot;</span>, <span class=\"number\">0</span>, -<span class=\"number\">1</span>)) <span class=\"comment\"># 切片取出值，范围是索引号0到-1(最后一个元素)</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"linsert-name-where-refvalue-value-新增（固定索引号位置插入元素）\"><a href=\"#linsert-name-where-refvalue-value-新增（固定索引号位置插入元素）\" class=\"headerlink\" title=\"linsert(name, where, refvalue, value))新增（固定索引号位置插入元素）\"></a><code>linsert(name, where, refvalue, value))</code>新增（固定索引号位置插入元素）</h4><p>在name对应的列表的某一个值前或后插入一个新值<br>参数：</p>\n<ul>\n<li>name，redis的name</li>\n<li>where，BEFORE或AFTER</li>\n<li>refvalue，标杆值，即：在它前后插入数据</li>\n<li>value，要插入的数据</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">r.linsert(<span class=\"string\">&quot;list2&quot;</span>, <span class=\"string\">&quot;before&quot;</span>, <span class=\"string\">&quot;11&quot;</span>, <span class=\"string\">&quot;00&quot;</span>)   <span class=\"comment\"># 往列表中左边第一个出现的元素&quot;11&quot;前插入元素&quot;00&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.lrange(<span class=\"string\">&quot;list2&quot;</span>, <span class=\"number\">0</span>, -<span class=\"number\">1</span>))   <span class=\"comment\"># 切片取出值，范围是索引号0-最后一个元素</span></span><br></pre></td></tr></table></figure>\n\n<p><code>r.lset(name, index, value)</code>修改（指定索引号进行修改）</p>\n<p>对name对应的list中的某一个索引位置重新赋值<br>参数：</p>\n<ul>\n<li>name，redis的name</li>\n<li>index，list的索引位置</li>\n<li>value，要设置的值</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">r.lset(<span class=\"string\">&quot;list2&quot;</span>, <span class=\"number\">0</span>, -<span class=\"number\">11</span>)    <span class=\"comment\"># 把索引号是0的元素修改成-11</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.lrange(<span class=\"string\">&quot;list2&quot;</span>, <span class=\"number\">0</span>, -<span class=\"number\">1</span>))</span><br></pre></td></tr></table></figure>\n\n<p><code>r.lrem(name, value, num)</code>删除（指定值进行删除）</p>\n<p>在name对应的list中删除指定的值<br>参数：</p>\n<ul>\n<li>name，redis的name</li>\n<li>value，要删除的值</li>\n<li>num， num&#x3D;0，删除列表中所有的指定值；</li>\n<li>num&#x3D;2,从前到后，删除2个； num&#x3D;1,从前到后，删除左边第1个</li>\n<li>num&#x3D;-2,从后向前，删除2个</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">r.lrem(<span class=\"string\">&quot;list2&quot;</span>, <span class=\"string\">&quot;11&quot;</span>, <span class=\"number\">1</span>)    <span class=\"comment\"># 将列表中左边第一次出现的&quot;11&quot;删除</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.lrange(<span class=\"string\">&quot;list2&quot;</span>, <span class=\"number\">0</span>, -<span class=\"number\">1</span>))</span><br><span class=\"line\">r.lrem(<span class=\"string\">&quot;list2&quot;</span>, <span class=\"string\">&quot;99&quot;</span>, -<span class=\"number\">1</span>)    <span class=\"comment\"># 将列表中右边第一次出现的&quot;99&quot;删除</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.lrange(<span class=\"string\">&quot;list2&quot;</span>, <span class=\"number\">0</span>, -<span class=\"number\">1</span>))</span><br><span class=\"line\">r.lrem(<span class=\"string\">&quot;list2&quot;</span>, <span class=\"string\">&quot;22&quot;</span>, <span class=\"number\">0</span>)    <span class=\"comment\"># 将列表中所有的&quot;22&quot;删除</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.lrange(<span class=\"string\">&quot;list2&quot;</span>, <span class=\"number\">0</span>, -<span class=\"number\">1</span>))</span><br></pre></td></tr></table></figure>\n\n<p><code>lpop(name)</code>删除并返回</p>\n<p>在name对应的列表的左侧获取第一个元素并在列表中移除，返回值则是第一个元素</p>\n<ul>\n<li>rpop(name) 表示从右向左操作</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">r.lpop(<span class=\"string\">&quot;list2&quot;</span>)    <span class=\"comment\"># 删除列表最左边的元素，并且返回删除的元素</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.lrange(<span class=\"string\">&quot;list2&quot;</span>, <span class=\"number\">0</span>, -<span class=\"number\">1</span>))</span><br><span class=\"line\">r.rpop(<span class=\"string\">&quot;list2&quot;</span>)    <span class=\"comment\"># 删除列表最右边的元素，并且返回删除的元素</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.lrange(<span class=\"string\">&quot;list2&quot;</span>, <span class=\"number\">0</span>, -<span class=\"number\">1</span>))</span><br></pre></td></tr></table></figure>\n\n<p><code>lindex(name, index)</code>取值（根据索引号取值）</p>\n<p>在name对应的列表中根据索引获取列表元素</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">print</span>(r.lindex(<span class=\"string\">&quot;list2&quot;</span>, <span class=\"number\">0</span>))  <span class=\"comment\"># 取出索引号是0的值</span></span><br></pre></td></tr></table></figure>\n\n<p>具体操作可以参考 :<a href=\"https://www.jianshu.com/p/2639549bedc8\">https://www.jianshu.com/p/2639549bedc8</a></p>\n<p>常用其实就那么几个get.set.hget,gset</p>\n","categories":["redis"],"tags":["python","redis"]},{"title":"管理员账号首次登录设备的时候，会提示修改密码","url":"/post/f9483a14.html","content":"<h4 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h4><p><strong>如果用户的登录密码为初始密码，设备输出相应的提示信息询问用户是否修改初始密码，可以使用*<em>undo password alert original关闭，关闭后首次登录不再提示修改密码。*</em></strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;HUAWEI&gt; system-view</span><br><span class=\"line\">[HUAWEI] aaa</span><br><span class=\"line\">[HUAWEI-aaa] local-aaa-user password policy administrator</span><br><span class=\"line\">[HUAWEI-aaa-lupp-admin] password alert original</span><br></pre></td></tr></table></figure>\n\n","categories":["华为交换机"],"tags":["交换机","华为"]},{"title":"asyncio","url":"/post/31833c90.html","content":"<ol>\n<li>回调模式编码的复杂度高,</li>\n<li>同步编码的并发性不高,</li>\n<li>多线程编程需要线程间同步, 通过lock机制,会影响效率,</li>\n</ol>\n<p>所以我们就需要采用同步的方式去编写异步的代码,</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_url</span>(<span class=\"params\">url</span>):</span><br><span class=\"line\">    <span class=\"comment\"># 我们获取网页信息是耗时操作,我们需要在这里等待</span></span><br><span class=\"line\">    html = get_html(url)<span class=\"comment\"># 所以我们希望在这里能跳出函数,去做一下别的事情,等获取到了数据再回来,</span></span><br><span class=\"line\">    parse_html(html)</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_next</span>(<span class=\"params\">url</span>):</span><br><span class=\"line\">    <span class=\"keyword\">pass</span></span><br></pre></td></tr></table></figure>\n\n<p>这样我们也就不需要多线程的锁机制，因为只有一个线程，也不存在同时写变量冲突，在协程中控制共享资源不加锁，只需要判断状态就好了，所以执行效率比多线程高很多。</p>\n<p>所以就有了协程</p>\n<span id=\"more\"></span>\n\n<p>协程，又称微线程,也就是一个可以暂停的函数,等有了结果再切换回去,是我们程序员自己来切换的</p>\n<p>那有什么办法能暂停函数,然后再回来呢?</p>\n<p>我们想到了生成器,所以我们这里再提一下 生成器</p>\n<h2 id=\"生成器\"><a href=\"#生成器\" class=\"headerlink\" title=\"生成器\"></a>生成器</h2><h3 id=\"send\"><a href=\"#send\" class=\"headerlink\" title=\"send\"></a><code>send</code></h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_url</span>():</span><br><span class=\"line\">    <span class=\"comment\"># 这里有一个耗时的请求,需要用另一个函数来处理,并把处理好的结果返回回来</span></span><br><span class=\"line\">    html = <span class=\"keyword\">yield</span> <span class=\"string\">&#x27;耗时操作&#x27;</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(html)</span><br><span class=\"line\">    <span class=\"comment\"># 这里需要加一个yield,不然会报错StopIteration,所以send也会接收到值</span></span><br><span class=\"line\">    <span class=\"keyword\">yield</span> <span class=\"number\">123</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 生成生成器</span></span><br><span class=\"line\">gen = get_url()</span><br><span class=\"line\"><span class=\"comment\"># 获取值,模拟另一个函数处理,必须先用一次next来启动生成器</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"built_in\">next</span>(gen))</span><br><span class=\"line\"><span class=\"comment\"># 发送值,处理完后把结果发送回去</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(gen.send(<span class=\"string\">&#x27;返回结果&#x27;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">&gt;&gt;耗时操作</span><br><span class=\"line\">&gt;&gt;返回结果</span><br><span class=\"line\">&gt;&gt;<span class=\"number\">123</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"yield-from-允许发送生成器\"><a href=\"#yield-from-允许发送生成器\" class=\"headerlink\" title=\"yield from:允许发送生成器\"></a><code>yield from</code>:允许发送生成器</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">gen1</span>():</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">yield</span> <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">gen2</span>():</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> <span class=\"number\">3</span></span><br><span class=\"line\">    <span class=\"comment\"># 可以返回或者说发送一个 生成器</span></span><br><span class=\"line\">    <span class=\"keyword\">yield</span> <span class=\"keyword\">from</span> gen1()</span><br><span class=\"line\">    <span class=\"keyword\">yield</span> <span class=\"number\">4</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">g2 = gen2()</span><br><span class=\"line\"><span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> g2:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(item)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"案例\"><a href=\"#案例\" class=\"headerlink\" title=\"案例:\"></a>案例:</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 我们这样一个数据,我们希望获取一个总数,然后跟一个原来的列表</span></span><br><span class=\"line\">items = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;小明&#x27;</span>:[<span class=\"number\">94</span>,<span class=\"number\">68</span>,<span class=\"number\">46</span>,<span class=\"number\">66</span>],</span><br><span class=\"line\">    <span class=\"string\">&#x27;小红&#x27;</span>:[<span class=\"number\">99</span>,<span class=\"number\">33</span>,<span class=\"number\">43</span>,<span class=\"number\">66</span>],</span><br><span class=\"line\">    <span class=\"string\">&#x27;小白&#x27;</span>:[<span class=\"number\">98</span>,<span class=\"number\">45</span>,<span class=\"number\">46</span>,<span class=\"number\">66</span>],</span><br><span class=\"line\">    <span class=\"string\">&#x27;小黑&#x27;</span>:[<span class=\"number\">101</span>,<span class=\"number\">64</span>,<span class=\"number\">46</span>,<span class=\"number\">66</span>],</span><br><span class=\"line\">    <span class=\"string\">&#x27;小路&#x27;</span>:[<span class=\"number\">93</span>,<span class=\"number\">65</span>,<span class=\"number\">46</span>,<span class=\"number\">66</span>],</span><br><span class=\"line\">    <span class=\"string\">&#x27;小兰&#x27;</span>:[<span class=\"number\">91</span>,<span class=\"number\">66</span>,<span class=\"number\">46</span>,<span class=\"number\">66</span>],</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">result = &#123;</span></span><br><span class=\"line\"><span class=\"string\">            总数</span></span><br><span class=\"line\"><span class=\"string\">    &#x27;小明&#x27;: (274, [94, 68, 46, 66]),</span></span><br><span class=\"line\"><span class=\"string\">    &#x27;小红&#x27;: (241, [99, 33, 43, 66]),</span></span><br><span class=\"line\"><span class=\"string\">    &#x27;小白&#x27;: (255, [98, 45, 46, 66]),</span></span><br><span class=\"line\"><span class=\"string\">    &#x27;小黑&#x27;: (277, [101, 64, 46, 66]),</span></span><br><span class=\"line\"><span class=\"string\">    &#x27;小路&#x27;: (270, [93, 65, 46, 66]),</span></span><br><span class=\"line\"><span class=\"string\">    &#x27;小兰&#x27;: (269, [91, 66, 46, 66])</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\">result = &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">computer</span>(<span class=\"params\">key</span>):</span><br><span class=\"line\">    total = <span class=\"number\">0</span></span><br><span class=\"line\">    temp = []</span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">        <span class=\"comment\"># 获得main函数发送过来的数据</span></span><br><span class=\"line\">        a = <span class=\"keyword\">yield</span></span><br><span class=\"line\">        <span class=\"built_in\">print</span>(key,<span class=\"string\">&#x27;传了一个值过来&#x27;</span>,a)</span><br><span class=\"line\">        <span class=\"comment\"># 如果发送过来的是None则退出循环</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> a:</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        total+=a</span><br><span class=\"line\">        temp.append(a)</span><br><span class=\"line\">    <span class=\"comment\"># 返回一个元组</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> total,temp</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">middle</span>(<span class=\"params\">key</span>):</span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">        result[key] = <span class=\"keyword\">yield</span> <span class=\"keyword\">from</span> computer(key)</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">main</span>():</span><br><span class=\"line\">    <span class=\"keyword\">for</span> k,v <span class=\"keyword\">in</span> items.items():</span><br><span class=\"line\">        m=middle(k)</span><br><span class=\"line\">        <span class=\"comment\"># 激活生成器</span></span><br><span class=\"line\">        m.send(<span class=\"literal\">None</span>)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> v:</span><br><span class=\"line\">            m.send(i)</span><br><span class=\"line\">        <span class=\"comment\">#关闭computer生成器</span></span><br><span class=\"line\">        m.send(<span class=\"literal\">None</span>)</span><br><span class=\"line\">main()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"asyncio异步模块\"><a href=\"#asyncio异步模块\" class=\"headerlink\" title=\"asyncio异步模块\"></a><code>asyncio</code>异步模块</h2><p><code>asyncio</code>是python 用于解决异步IO变成的一整套方案</p>\n<p>实现了:</p>\n<ul>\n<li>包括各种特定系统实现的模块化的事件循环</li>\n<li>传输和协议抽象</li>\n<li>对<code>TCP,UDP,SSL</code>,子进程,延时调用,以及其他的具体支持</li>\n<li>模块futures模块,但适用于事件循环使用的Future类</li>\n<li>基于<code>yield from</code> 的协议和任务.可以让你用顺序的方式编写并发代码</li>\n<li>必须使用一个将产生阻塞IO的调用时,有接口可以把这个事件转移到线程池</li>\n<li>模仿<code>threading</code>模块中的同步原语,可以用在单线程内的协程之间</li>\n</ul>\n<p>三个要素:事件循环,回调函数(驱动生成器),以及IO多路复用</p>\n<h3 id=\"简单使用\"><a href=\"#简单使用\" class=\"headerlink\" title=\"简单使用\"></a>简单使用</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 在 asyncio中 我们用async 表示这个函数是一个异步函数</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">get_html</span>(<span class=\"params\">url</span>):</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;start get html&#x27;</span>)</span><br><span class=\"line\">    <span class=\"comment\"># 我们用asyncio.sleep(2) 来模拟一个耗时操作,这里我们不用time.sleep</span></span><br><span class=\"line\">    <span class=\"comment\"># 要记住在异步函数内不能使用同步</span></span><br><span class=\"line\">    <span class=\"comment\"># 需要加上await 来表示这是一个 耗时操作</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> asyncio.sleep(<span class=\"number\">2</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;end get html&#x27;</span>)</span><br><span class=\"line\">start_time = time.time()</span><br><span class=\"line\"><span class=\"comment\"># 我们创建事件循环</span></span><br><span class=\"line\">loop = asyncio.get_event_loop()</span><br><span class=\"line\"><span class=\"comment\"># 运行我们的异步程序</span></span><br><span class=\"line\">loop.run_until_complete(get_html(<span class=\"string\">&#x27;url&#x27;</span>))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(time.time()-start_time)</span><br><span class=\"line\"></span><br><span class=\"line\">&gt;&gt;start get html</span><br><span class=\"line\">&gt;&gt;end get html</span><br><span class=\"line\">&gt;&gt;<span class=\"number\">2.001361608505249</span></span><br></pre></td></tr></table></figure>\n\n<p>这样看我们并不能感受到异步带来的好处,我们接下来创建100个任务来模拟</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 在 asyncio中 我们用async 表示这个函数是一个异步函数</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">get_html</span>(<span class=\"params\">url</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;start get html&#x27;</span>)</span><br><span class=\"line\">    <span class=\"comment\"># 我们用asyncio.sleep(2) 来模拟一个耗时操作,这里我们不用time.sleep</span></span><br><span class=\"line\">    <span class=\"comment\"># 要记住在异步函数内不能使用同步</span></span><br><span class=\"line\">    <span class=\"comment\"># 需要加上await 来表示这是一个 耗时操作</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> asyncio.sleep(<span class=\"number\">2</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;end get html&#x27;</span>)</span><br><span class=\"line\">start_time = time.time()</span><br><span class=\"line\"><span class=\"comment\"># 我们创建事件循环</span></span><br><span class=\"line\">loop = asyncio.get_event_loop()</span><br><span class=\"line\"><span class=\"comment\"># 创建一个100个task任务</span></span><br><span class=\"line\">tasks = [get_html(<span class=\"string\">&#x27;url&#x27;</span>) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">100</span>)]</span><br><span class=\"line\"><span class=\"comment\"># 运行我们的异步程序</span></span><br><span class=\"line\"><span class=\"comment\"># 这时需要使用asyncio.gather,也可以用wait 推荐实用gather</span></span><br><span class=\"line\"><span class=\"comment\"># loop.run_until_complete(asyncio.wait(tasks))</span></span><br><span class=\"line\">loop.run_until_complete(asyncio.gather(*tasks))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(time.time()-start_time)</span><br><span class=\"line\"></span><br><span class=\"line\">&gt;&gt;<span class=\"number\">2.0133612155914307</span></span><br><span class=\"line\">大家可以去运行一下 时间还是2s</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"取消task\"><a href=\"#取消task\" class=\"headerlink\" title=\"取消task\"></a>取消task</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">cancel_test</span>(<span class=\"params\">sleep_time</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;start&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> asyncio.sleep(sleep_time)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(sleep_time)</span><br><span class=\"line\">tasks = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">3</span>):</span><br><span class=\"line\">    tasks.append(cancel_test(i+<span class=\"number\">1</span>))</span><br><span class=\"line\">loop = asyncio.get_event_loop()</span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">    loop.run_until_complete(asyncio.gather(*tasks))</span><br><span class=\"line\"><span class=\"keyword\">except</span> KeyboardInterrupt <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">    <span class=\"comment\"># 返回事件循环所运行的未完成的 Task 对象的集合。</span></span><br><span class=\"line\">    <span class=\"comment\"># asyncio.all_tasks() 实测 3.7.3 不会创建loop 需要传当前loop</span></span><br><span class=\"line\">    <span class=\"comment\"># 如果 loop 为 None，则会使用 get_running_loop() 获取当前事件循环。</span></span><br><span class=\"line\">    <span class=\"comment\"># 可以用asyncio.Task.all_tasks():</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> task <span class=\"keyword\">in</span> asyncio.all_tasks(loop):</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(task.cancel())</span><br><span class=\"line\"><span class=\"keyword\">finally</span>:</span><br><span class=\"line\">    loop.close()</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"子协程调度\"><a href=\"#子协程调度\" class=\"headerlink\" title=\"子协程调度\"></a>子协程调度</h3><h4 id=\"案例-1\"><a href=\"#案例-1\" class=\"headerlink\" title=\"案例:\"></a>案例:</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">import asyncio</span><br><span class=\"line\"></span><br><span class=\"line\"># 计算协程</span><br><span class=\"line\">async def compute(x, y):</span><br><span class=\"line\">    print(&quot;Compute %s + %s ...&quot; % (x, y))</span><br><span class=\"line\">    await asyncio.sleep(1.0)</span><br><span class=\"line\">    return x + y</span><br><span class=\"line\"></span><br><span class=\"line\"># 执行print_sum函数</span><br><span class=\"line\">async def print_sum(x, y):</span><br><span class=\"line\">    # 交给子协程</span><br><span class=\"line\">    result = await compute(x, y)</span><br><span class=\"line\">    print(&quot;%s + %s = %s&quot; % (x, y, result))</span><br><span class=\"line\"></span><br><span class=\"line\"># 创建事件循环</span><br><span class=\"line\">loop = asyncio.get_event_loop()</span><br><span class=\"line\"># 创建task事件</span><br><span class=\"line\">task = loop.create_task(print_sum(1,2))</span><br><span class=\"line\"># 放入事件循环</span><br><span class=\"line\">loop.run_until_complete(task)</span><br><span class=\"line\">loop.close()</span><br></pre></td></tr></table></figure>\n\n<p>该图在3.6的官方文档中</p>\n<p><img data-src=\"/../images/asyncio/tulip_coro-1593686114663.png\" alt=\"tulip_coro\"></p>\n<h4 id=\"解析\"><a href=\"#解析\" class=\"headerlink\" title=\"解析:\"></a>解析:</h4><p><img data-src=\"/../images/asyncio/image-20200702193436174.png\" alt=\"image-20200702193436174\"></p>\n<h2 id=\"线程池结合asyncio\"><a href=\"#线程池结合asyncio\" class=\"headerlink\" title=\"线程池结合asyncio\"></a>线程池结合asyncio</h2><p>线程池为什么要跟asyncio 结合呢?</p>\n<p>由于协程中不能处理阻塞IO 如mysql库是阻塞的,如果我们需要在协程中强行使用,怎么办?asyncio也可以使用多线程下面我们来模拟一下</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> asyncio</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">from</span> concurrent.futures.thread <span class=\"keyword\">import</span> ThreadPoolExecutor</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 模拟阻塞的函数</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_url</span>(<span class=\"params\">url</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;*&#x27;</span>*<span class=\"number\">10</span>,url)</span><br><span class=\"line\">    <span class=\"comment\"># 模拟阻塞操作</span></span><br><span class=\"line\">    time.sleep(<span class=\"number\">5</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">start_time = time.time()</span><br><span class=\"line\">loop = asyncio.get_event_loop()</span><br><span class=\"line\"><span class=\"comment\"># 生成一个线程池</span></span><br><span class=\"line\">executor = ThreadPoolExecutor(<span class=\"number\">3</span>)</span><br><span class=\"line\">tasks = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> url <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">20</span>):</span><br><span class=\"line\">    <span class=\"comment\"># 生成任务,用线程池run_in_executor(线程池,函数,参数)</span></span><br><span class=\"line\">    task = loop.run_in_executor(executor,get_url,url)</span><br><span class=\"line\">    <span class=\"comment\"># 添加任务</span></span><br><span class=\"line\">    tasks.append(task)</span><br><span class=\"line\"><span class=\"comment\"># 调用任务</span></span><br><span class=\"line\">loop.run_until_complete(asyncio.gather(*tasks))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;===&#x27;</span>*<span class=\"number\">10</span>,time.time()-start_time)</span><br></pre></td></tr></table></figure>\n\n<p>其实就是将阻塞的函数放到线程池中</p>\n<p>建议大家不要在协程中调用阻塞方式,如果非要运行的话,建议使用线程池</p>\n<h2 id=\"future-和-task\"><a href=\"#future-和-task\" class=\"headerlink\" title=\"future 和 task\"></a>future 和 task</h2><p><code>future</code>是一个结果容器,用来存放结果</p>\n<p><code>task</code>是future的子类,主要用作协程与future的桥梁</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, coro, *, loop=<span class=\"literal\">None</span></span>):</span><br><span class=\"line\">    <span class=\"built_in\">super</span>().__init__(loop=loop)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> self._source_traceback:</span><br><span class=\"line\">        <span class=\"keyword\">del</span> self._source_traceback[-<span class=\"number\">1</span>]</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> coroutines.iscoroutine(coro):</span><br><span class=\"line\">        <span class=\"comment\"># raise after Future.__init__(), attrs are required for __del__</span></span><br><span class=\"line\">        <span class=\"comment\"># prevent logging for pending task in __del__</span></span><br><span class=\"line\">        self._log_destroy_pending = <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"keyword\">raise</span> TypeError(<span class=\"string\">f&quot;a coroutine was expected, got <span class=\"subst\">&#123;coro!r&#125;</span>&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    self._must_cancel = <span class=\"literal\">False</span></span><br><span class=\"line\">    self._fut_waiter = <span class=\"literal\">None</span></span><br><span class=\"line\">    self._coro = coro</span><br><span class=\"line\">    self._context = contextvars.copy_context()</span><br><span class=\"line\">\t<span class=\"comment\"># 初始化的时候调用自己的_step方法</span></span><br><span class=\"line\">    self._loop.call_soon(self.__step, context=self._context)</span><br><span class=\"line\">    _register_task(self)</span><br></pre></td></tr></table></figure>\n\n<p><code>__step</code>方法</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">__step</span>(<span class=\"params\">self, exc=<span class=\"literal\">None</span></span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> self.done():</span><br><span class=\"line\">        <span class=\"keyword\">raise</span> futures.InvalidStateError(</span><br><span class=\"line\">            <span class=\"string\">f&#x27;_step(): already done: <span class=\"subst\">&#123;self!r&#125;</span>, <span class=\"subst\">&#123;exc!r&#125;</span>&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> self._must_cancel:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> <span class=\"built_in\">isinstance</span>(exc, futures.CancelledError):</span><br><span class=\"line\">            exc = futures.CancelledError()</span><br><span class=\"line\">        self._must_cancel = <span class=\"literal\">False</span></span><br><span class=\"line\">    coro = self._coro</span><br><span class=\"line\">    self._fut_waiter = <span class=\"literal\">None</span></span><br><span class=\"line\"></span><br><span class=\"line\">    _enter_task(self._loop, self)</span><br><span class=\"line\">    <span class=\"comment\"># Call either coro.throw(exc) or coro.send(None).</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"comment\"># 第一次请求</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> exc <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            <span class=\"comment\"># We use the `send` method directly, because coroutines</span></span><br><span class=\"line\">            <span class=\"comment\"># don&#x27;t have `__iter__` and `__next__` methods.</span></span><br><span class=\"line\">            <span class=\"comment\"># 激活协程</span></span><br><span class=\"line\">            result = coro.send(<span class=\"literal\">None</span>)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            result = coro.throw(exc)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> StopIteration <span class=\"keyword\">as</span> exc:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> self._must_cancel:</span><br><span class=\"line\">            <span class=\"comment\"># Task is cancelled right before coro stops.</span></span><br><span class=\"line\">            self._must_cancel = <span class=\"literal\">False</span></span><br><span class=\"line\">            <span class=\"built_in\">super</span>().set_exception(futures.CancelledError())</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"comment\"># 处理报错 并获取值</span></span><br><span class=\"line\">            <span class=\"built_in\">super</span>().set_result(exc.value)</span><br><span class=\"line\">   <span class=\"comment\"># 下面还有很多逻辑,做了很多处理</span></span><br></pre></td></tr></table></figure>\n\n<p>协程还是需要很多底层知识的,还是乖乖去看一下 底层原理</p>\n","categories":["协程"],"tags":["asyncio","协程","异步"]},{"title":"单臂路由","url":"/post/bf9393d0.html","content":"<p>单臂路由（router-on-a-stick）是指在路由器的一个接口上通过配置<a href=\"https://baike.baidu.com/item/%E5%AD%90%E6%8E%A5%E5%8F%A3/10693062?fromModule=lemma_inlink\">子接口</a>（或“<a href=\"https://baike.baidu.com/item/%E9%80%BB%E8%BE%91%E6%8E%A5%E5%8F%A3/8509464?fromModule=lemma_inlink\">逻辑接口</a>”，并不存在真正<a href=\"https://baike.baidu.com/item/%E7%89%A9%E7%90%86%E6%8E%A5%E5%8F%A3/5922620?fromModule=lemma_inlink\">物理接口</a>）的方式，实现原来相互隔离的不同VLAN（<a href=\"https://baike.baidu.com/item/%E8%99%9A%E6%8B%9F%E5%B1%80%E5%9F%9F%E7%BD%91/419962?fromModule=lemma_inlink\">虚拟局域网</a>）之间的<a href=\"https://baike.baidu.com/item/%E4%BA%92%E8%81%94%E4%BA%92%E9%80%9A/1848381?fromModule=lemma_inlink\">互联互通</a>。</p>\n<span id=\"more\"></span>\n\n<h3 id=\"单臂路由配置\"><a href=\"#单臂路由配置\" class=\"headerlink\" title=\"单臂路由配置\"></a>单臂路由配置</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">dot1q termination vid 10 # 关联子接口和vlan </span><br><span class=\"line\">arp broadcast enable # 开启子接口的ARP广播功能</span><br></pre></td></tr></table></figure>\n\n<p><img data-src=\"/../images/%E5%8D%95%E8%87%82%E8%B7%AF%E7%94%B1/image-20230329132822934.png\" alt=\"image-20230329132822934\"></p>\n<p>SW1:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">sys</span><br><span class=\"line\">sys SW1</span><br><span class=\"line\">vlan batch 10 20</span><br><span class=\"line\">int g0/0/1</span><br><span class=\"line\">p l a</span><br><span class=\"line\">p d v 10 </span><br><span class=\"line\">int g0/0/2</span><br><span class=\"line\">p l a</span><br><span class=\"line\">p d v 20</span><br><span class=\"line\">int g0/0/24</span><br><span class=\"line\">p l t</span><br><span class=\"line\">p t a v 10 20 </span><br></pre></td></tr></table></figure>\n\n<p>R1:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">sys</span><br><span class=\"line\">sys R1</span><br><span class=\"line\">int g 0/0/0.10</span><br><span class=\"line\">dot1q termination vid 10</span><br><span class=\"line\">arp broadcast <span class=\"built_in\">enable</span></span><br><span class=\"line\">ip addr 10.0.0.254 24</span><br><span class=\"line\"></span><br><span class=\"line\">int g 0/0/0.20</span><br><span class=\"line\">dot1q termination vid 20</span><br><span class=\"line\">arp broadcast <span class=\"built_in\">enable</span></span><br><span class=\"line\">ip addr 20.0.0.254 24</span><br></pre></td></tr></table></figure>\n\n\n\n","categories":["单臂路由"],"tags":["交换机","vlan","单臂路由"]},{"title":"网络工程师中级软考知识点","url":"/post/c8acf84f.html","content":"<p>记录网络工程师中级软考中的知识点,用于回顾</p>\n<span id=\"more\"></span>\n\n<h3 id=\"流水线计算\"><a href=\"#流水线计算\" class=\"headerlink\" title=\"流水线计算\"></a>流水线计算</h3><p>流水线执行时间:(t<sub>1</sub>+t<sub>2</sub>+t<sub>3</sub>)+(n-1)t<sub>1</sub></p>\n<p>其中t<sub>1</sub>是流水线周期,它表示执行时间最长的一段</p>\n<p>**例:**若治疗流水线把一条指令分为取指,分析,执行三部分,且三部分的时间分别是取指2ns,分析2ns,执行1ns.那么,流水线周期是?100条执行全部执行完需要的时间是?</p>\n<p><strong>周期:</strong> 最长的时间2ns</p>\n<p><strong>所需时间为:</strong> (2+2+1)+(100-1)X2&#x3D;203ns</p>\n<h3 id=\"流水线技术指标\"><a href=\"#流水线技术指标\" class=\"headerlink\" title=\"流水线技术指标\"></a>流水线技术指标</h3><ul>\n<li>吞吐率: Tp &#x3D; n &#x2F; Tk 其中n表示指令的条数,Tk表示流水线的时间</li>\n<li>加速比: S&#x3D; Ts&#x2F;Tk  其中 Ts 表示 不使用流水线的时间 Tk 表示流水线的时间</li>\n<li>效率  看具体工作时的状态</li>\n</ul>\n<h3 id=\"主机存储基础\"><a href=\"#主机存储基础\" class=\"headerlink\" title=\"主机存储基础\"></a>主机存储基础</h3><p>总的容量&#x2F;芯片的容量 &#x3D; 需要多少个芯片</p>\n<p><strong>例:</strong>,按字节编址,地址从A4000H–CBFFFH,则表示有(CBFFF-A4000) +1个字节,即28000H个字节,也就是163840个字节,等于160KB</p>\n<p>假设每个芯片单元是32KB,那么160&#x2F;32&#x3D;5个芯片单元,所以需要5个</p>\n<h3 id=\"Cache\"><a href=\"#Cache\" class=\"headerlink\" title=\"Cache\"></a>Cache</h3><p>如果Cache的访问命中率为h,而Cache的访问周期时间为t<sub>1</sub>,主存储器的访问周期时间是t<sub>2</sub>,则整个系统的平均访问时间为</p>\n<p>t<sub>3</sub> &#x3D; h X t<sub>1</sub>+(1-h) X t<sub>2</sub></p>\n","categories":["网工"],"tags":["计算机","知识点"]},{"title":"网络项目案例","url":"/post/93601b8a.html","content":"<p><img data-src=\"/../images/%E7%BD%91%E7%BB%9C%E9%A1%B9%E7%9B%AE%E6%A1%88%E4%BE%8B/image-20230607155532195.png\" alt=\"image-20230607155532195\"></p>\n<span id=\"more\"></span>\n\n<ol>\n<li>根据标注配置IP</li>\n<li>所有网络设备支持远程管理,aaa认证,用户名admin 密码123</li>\n<li>交换机直接用trunk口 互联</li>\n<li>通过SW1实现vlan间路由</li>\n<li>使SW1成为根桥,手动改优先级为4096(<code>stp priority 4096</code>)</li>\n<li>运行ospf协议 </li>\n<li>R1配置静态缺省路由,SW1通过OSPF学习缺省路由(<code>default-route-advertise</code>)</li>\n<li>在R1上配置pat,只需要转换4个vlan网段</li>\n<li>R1与R2之间使用PPP协议,用chap双向认证</li>\n</ol>\n","categories":["综合练习"],"tags":["综合练习"]},{"title":"计算机网络体系结构","url":"/post/507ba1e8.html","content":"<p>计算机网络体系结构通常指的是用于定义和组织计算机网络各层次功能的模型。这些模型帮助我们理解、设计和实现计算机网络。最著名的网络体系结构模型有两种,OSI参考模型和TCP&#x2F;IP模型（互联网模型)：</p>\n<span id=\"more\"></span>\n\n<h3 id=\"1-OSI参考模型（Open-Systems-Interconnection-Model）\"><a href=\"#1-OSI参考模型（Open-Systems-Interconnection-Model）\" class=\"headerlink\" title=\"1. OSI参考模型（Open Systems Interconnection Model）\"></a>1. OSI参考模型（Open Systems Interconnection Model）</h3><p>OSI模型由国际标准化组织（ISO）提出，是一个七层的网络体系结构模型。每一层都定义了特定的网络功能。七层模型从上到下依次为：</p>\n<ol>\n<li><strong>应用层（Application Layer）</strong>：提供网络服务和应用接口，如HTTP、FTP、SMTP等。</li>\n<li><strong>表示层（Presentation Layer）</strong>：处理数据的表示、加密和解密，如数据格式转换、数据压缩。</li>\n<li><strong>会话层（Session Layer）</strong>：管理会话和对话控制，如建立、维护和终止通信会话。</li>\n<li><strong>传输层（Transport Layer）</strong>：提供端到端的通信服务和数据流控制，如TCP、UDP。</li>\n<li><strong>网络层（Network Layer）</strong>：处理数据包的路由和转发，如IP协议。</li>\n<li><strong>数据链路层（Data Link Layer）</strong>：提供节点间的数据传输和错误检测，如以太网（Ethernet）。</li>\n<li><strong>物理层（Physical Layer）</strong>：负责物理介质上的数据传输，如比特流、信号编码。</li>\n</ol>\n<h2 id=\"物理层\"><a href=\"#物理层\" class=\"headerlink\" title=\"物理层\"></a>物理层</h2><p>计算机网络体系结构通常分为多个层次，每一层都有其特定的功能。物理层是这些层次中的最低层，负责实际的数据传输。以下是关于物理层的一些关键点：</p>\n<h3 id=\"1-主要功能\"><a href=\"#1-主要功能\" class=\"headerlink\" title=\"1. 主要功能\"></a>1. 主要功能</h3><ul>\n<li><strong>比特传输</strong>：物理层的主要功能是将数据比特流通过通信媒介从一个节点传输到另一个节点。它处理的是原始的比特，而不是任何高层数据结构。</li>\n<li><strong>信号编码</strong>：物理层将数据比特编码为适合在物理介质上传输的信号。这些信号可以是电气的（例如铜线）、光学的（例如光纤）或无线的（例如无线电波）。</li>\n<li><strong>数据速率</strong>：物理层定义了传输数据的速率，即比特率（bit rate），通常以每秒比特数（bps）为单位。</li>\n<li><strong>物理拓扑</strong>：物理层定义了网络设备的物理连接和布局，包括总线型、星型、环型和网状拓扑。</li>\n<li><strong>介质类型</strong>：物理层规定了传输介质的类型，如双绞线、电缆、光纤和无线电波等。</li>\n</ul>\n<h3 id=\"2-传输介质\"><a href=\"#2-传输介质\" class=\"headerlink\" title=\"2. 传输介质\"></a>2. 传输介质</h3><ul>\n<li><strong>双绞线</strong>：常用于局域网（LAN），如以太网。包括屏蔽双绞线（STP）和非屏蔽双绞线（UTP）。</li>\n<li><strong>同轴电缆</strong>：用于有线电视系统和早期的计算机网络。</li>\n<li><strong>光纤</strong>：通过光信号传输数据，具有高带宽和低干扰的优点。</li>\n<li><strong>无线电波</strong>：用于无线网络（Wi-Fi）、蓝牙、移动通信等。</li>\n</ul>\n<h3 id=\"3-信号传输\"><a href=\"#3-信号传输\" class=\"headerlink\" title=\"3. 信号传输\"></a>3. 信号传输</h3><ul>\n<li><strong>模拟信号和数字信号</strong>：物理层可以传输模拟信号（如声音和视频）和数字信号（如计算机数据）。</li>\n<li><strong>调制和解调</strong>：在传输模拟信号时，通常需要对信号进行调制和解调。例如，调制解调器（modem）将数字信号转换为模拟信号以通过电话线传输。</li>\n</ul>\n<h3 id=\"4-标准和协议\"><a href=\"#4-标准和协议\" class=\"headerlink\" title=\"4. 标准和协议\"></a>4. 标准和协议</h3><ul>\n<li><strong>IEEE 802.3（以太网）</strong>：定义了局域网中使用的有线连接的物理层和数据链路层。</li>\n<li><strong>IEEE 802.11（无线局域网，Wi-Fi）</strong>：定义了无线网络的物理层和数据链路层。</li>\n<li><strong>ITU-T G.703</strong>：定义了数字信号在电信网络中的物理层传输。</li>\n</ul>\n<h3 id=\"5-硬件设备\"><a href=\"#5-硬件设备\" class=\"headerlink\" title=\"5. 硬件设备\"></a>5. 硬件设备</h3><ul>\n<li><strong>网卡（NIC）</strong>：连接计算机到网络的接口，负责物理层和数据链路层的操作。</li>\n<li><strong>集线器（Hub）</strong>：一种简单的网络设备，工作在物理层，用于将多个网络设备连接在一起。</li>\n<li>**交换机（Switch）**和**路由器（Router）**：尽管主要工作在数据链路层和网络层，它们也涉及物理层的操作，尤其是在数据包的实际传输过程中。</li>\n</ul>\n<p>物理层是计算机网络的基础，其性能和可靠性直接影响整个网络系统的运行效率和稳定性。理解物理层的工作原理和技术是掌握计算机网络的第一步。</p>\n<h2 id=\"数据链路层\"><a href=\"#数据链路层\" class=\"headerlink\" title=\"数据链路层\"></a>数据链路层</h2><p>数据链路层是计算机网络体系结构中的一个重要层次，负责在相邻节点之间可靠地传输数据帧。无论是 OSI 模型中的第二层，还是 TCP&#x2F;IP 模型中的链路层部分，数据链路层都起着关键作用。以下是数据链路层的主要功能、组成部分和协议：</p>\n<h3 id=\"1-数据链路层的主要功能\"><a href=\"#1-数据链路层的主要功能\" class=\"headerlink\" title=\"1.数据链路层的主要功能\"></a>1.数据链路层的主要功能</h3><ol>\n<li><strong>帧封装</strong>：数据链路层将来自网络层的数据包封装成帧，以便在物理介质上传输。每个帧包含必要的控制信息，如源地址、目的地址和校验和（CRC）。</li>\n<li><strong>物理地址寻址</strong>：数据链路层使用物理地址（如 MAC 地址）来标识网络中的节点，确保帧能够正确传输到目标设备。</li>\n<li><strong>错误检测与校正</strong>：数据链路层通过附加到帧的校验和（如循环冗余校验 CRC）来检测传输过程中的错误。某些协议还支持错误校正。</li>\n<li><strong>流量控制</strong>：数据链路层可以控制数据传输速率，防止发送方数据传输速率超过接收方处理能力，从而避免丢包。</li>\n<li><strong>帧同步</strong>：数据链路层确保发送和接收方在帧的开始和结束处保持同步，使得数据传输可靠且有序。</li>\n<li><strong>介质访问控制</strong>：在共享传输介质（如以太网）中，数据链路层管理多个设备对介质的访问，避免冲突和碰撞。这通常通过协议如 CSMA&#x2F;CD（载波侦听多路访问&#x2F;冲突检测）实现。</li>\n</ol>\n<h3 id=\"2-数据链路层的组成部分\"><a href=\"#2-数据链路层的组成部分\" class=\"headerlink\" title=\"2.数据链路层的组成部分\"></a>2.数据链路层的组成部分</h3><p>数据链路层通常分为两个子层：</p>\n<ol>\n<li><strong>逻辑链路控制子层（LLC, Logical Link Control）</strong>：<ul>\n<li>提供接口给网络层并管理逻辑链路通信。</li>\n<li>处理帧的多路复用、流量控制和错误检测。</li>\n<li>LLC 标头包含服务访问点（SAP）来区分上层协议。</li>\n</ul>\n</li>\n<li><strong>介质访问控制子层（MAC, Media Access Control）</strong>：<ul>\n<li>负责控制对物理传输介质的访问。</li>\n<li>定义 MAC 地址用于设备标识。</li>\n<li>实现特定网络技术的介质访问控制方法，如以太网、Wi-Fi。</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"3-常见的数据链路层协议\"><a href=\"#3-常见的数据链路层协议\" class=\"headerlink\" title=\"3.常见的数据链路层协议\"></a>3.常见的数据链路层协议</h3><ul>\n<li><strong>以太网（Ethernet, IEEE 802.3）</strong>：广泛使用的局域网技术，使用 MAC 地址进行设备标识和 CSMA&#x2F;CD 进行介质访问控制。</li>\n<li><strong>Wi-Fi（IEEE 802.11）</strong>：无线局域网标准，使用 CSMA&#x2F;CA（载波侦听多路访问&#x2F;冲突避免）来管理无线信道。</li>\n<li><strong>点对点协议（PPP, Point-to-Point Protocol）</strong>：用于直接连接两个节点，如拨号网络和 VPN。</li>\n<li><strong>帧中继（Frame Relay）</strong>：用于广域网连接，通过虚拟电路传输数据帧。</li>\n<li><strong>令牌环（Token Ring, IEEE 802.5）</strong>：早期局域网技术，通过令牌传递机制避免冲突。</li>\n</ul>\n<h3 id=\"4-数据链路层的挑战和解决方案\"><a href=\"#4-数据链路层的挑战和解决方案\" class=\"headerlink\" title=\"4.数据链路层的挑战和解决方案\"></a>4.数据链路层的挑战和解决方案</h3><ul>\n<li><strong>冲突和碰撞</strong>：在共享介质（如以太网）中，多个设备同时发送数据可能导致冲突。CSMA&#x2F;CD 和 CSMA&#x2F;CA 是常用的解决方案。</li>\n<li><strong>错误检测与校正</strong>：数据传输中可能出现位错误，CRC 是常用的错误检测方法，而重传机制（如 ARQ）用于错误校正。</li>\n<li><strong>流量控制</strong>：防止发送方数据溢出接收方缓冲区，常用的流量控制机制包括滑动窗口协议和速率控制协议。</li>\n</ul>\n<p>数据链路层在计算机网络中扮演着关键角色，它确保数据在相邻节点之间可靠传输，并通过错误检测、流量控制和介质访问控制等功能提高传输的可靠性和效率。数据链路层协议和技术不断演进，以适应不断变化的网络需求和环境</p>\n","categories":["软考"],"tags":["计算机","软考","网络工程师"]},{"title":"静态路由","url":"/post/fdbc3202.html","content":"<p>静态路由是指由用户或网络管理员手工配置的路由信息。当网络的拓扑结构或链路的状态发生变化时，网络管理员需要手工去修改路由表中相关的静态路由信息。静态路由信息在缺省情况下是私有的，不会传递给其他的路由器。当然，网管员也可以通过对路由器进行设置使之成为共享的。静态路由一般适用于比较简单的网络环境，在这样的环境中，网络管理员易于清楚地了解网络的拓扑结构，便于设置正确的路由信息。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"实例\"><a href=\"#实例\" class=\"headerlink\" title=\"实例\"></a>实例</h2><p>图:</p>\n<p><img data-src=\"/../images/%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1/image-20230315124438010.png\" alt=\"image-20230315124438010\"></p>\n<p>目的:PC1与PC2通信</p>\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><p>R1:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">添加PC3所在网段,以及下一条地址(下一条为对端接口地址)</span><br><span class=\"line\">ip route-static 192.168.3.0 255.255.255.0 12.1.1.2</span><br></pre></td></tr></table></figure>\n\n\n\n<p>R2</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">添加PC3所在网段,以及下一条地址(下一条为对端接口地址)</span><br><span class=\"line\">ip route-static 192.168.3.0 255.255.255.0 23.1.1.3</span><br><span class=\"line\">当然别忘了数据是双向的,需要有回包</span><br><span class=\"line\">ip route-static 192.168.1.0 255.255.255.0 12.1.1.1</span><br></pre></td></tr></table></figure>\n\n<p>R3</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">回包,PC1所在的网段,以及下一条地址</span><br><span class=\"line\">ip route-static 192.168.1.0 255.255.255.0 23.1.1.2</span><br></pre></td></tr></table></figure>\n\n<p>测试</p>\n<p><img data-src=\"/../images/%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1/image-20230315130210102.png\" alt=\"image-20230315130210102\"></p>\n<p>热知识:在R1处 ping PC2 是不会通的  因为没有路由,需要指定源才能通</p>\n<p><img data-src=\"/../images/%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1/image-20230315130321893.png\" alt=\"image-20230315130321893\"></p>\n<p><img data-src=\"/../images/%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1/image-20230315130357195.png\" alt=\"image-20230315130357195\"></p>\n<p>R1配置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[R1]dis cu</span><br><span class=\"line\">[V200R003C00]</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\"> sysname R1</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\"> snmp-agent local-engineid 800007DB03000000000000</span></span><br><span class=\"line\"> snmp-agent </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\"> clock timezone China-Standard-Time minus 08:00:00</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">portal local-server load flash:/portalpage.zip</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\"> drop illegal-mac alarm</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\"> wlan ac-global carrier <span class=\"built_in\">id</span> other ac <span class=\"built_in\">id</span> 0</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\"> <span class=\"built_in\">set</span> cpu-usage threshold 80 restore 75</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">aaa</span> </span><br><span class=\"line\"> authentication-scheme default</span><br><span class=\"line\"> authorization-scheme default</span><br><span class=\"line\"> accounting-scheme default</span><br><span class=\"line\"> domain default </span><br><span class=\"line\"> domain default_admin </span><br><span class=\"line\"> local-user admin password cipher %$%$K8m.Nt84DZ&#125;e#&lt;0`8bmE3Uw&#125;%$%$</span><br><span class=\"line\"> local-user admin service-type http</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">firewall zone Local</span></span><br><span class=\"line\"> priority 15</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">interface GigabitEthernet0/0/0</span></span><br><span class=\"line\"> ip address 192.168.1.254 255.255.255.0 </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">interface GigabitEthernet0/0/1</span></span><br><span class=\"line\"> ip address 12.1.1.1 255.255.255.0 </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">interface GigabitEthernet0/0/2</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">interface NULL0</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">ip route-static 192.168.3.0 255.255.255.0 12.1.1.2</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">user-interface con 0</span></span><br><span class=\"line\"> authentication-mode password</span><br><span class=\"line\">user-interface vty 0 4</span><br><span class=\"line\">user-interface vty 16 20</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">wlan ac</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\"><span class=\"built_in\">return</span></span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>R2 配置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;R2&gt;dis cu </span><br><span class=\"line\">[V200R003C00]</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\"> sysname R2</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\"> snmp-agent local-engineid 800007DB03000000000000</span></span><br><span class=\"line\"> snmp-agent </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\"> clock timezone China-Standard-Time minus 08:00:00</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">portal local-server load portalpage.zip</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\"> drop illegal-mac alarm</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\"> <span class=\"built_in\">set</span> cpu-usage threshold 80 restore 75</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">aaa</span> </span><br><span class=\"line\"> authentication-scheme default</span><br><span class=\"line\"> authorization-scheme default</span><br><span class=\"line\"> accounting-scheme default</span><br><span class=\"line\"> domain default </span><br><span class=\"line\"> domain default_admin </span><br><span class=\"line\"> local-user admin password cipher %$%$K8m.Nt84DZ&#125;e#&lt;0`8bmE3Uw&#125;%$%$</span><br><span class=\"line\"> local-user admin service-type http</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">firewall zone Local</span></span><br><span class=\"line\"> priority 15</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">interface GigabitEthernet0/0/0</span></span><br><span class=\"line\"> ip address 12.1.1.2 255.255.255.0 </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">interface GigabitEthernet0/0/1</span></span><br><span class=\"line\"> ip address 23.1.1.2 255.255.255.0 </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">interface GigabitEthernet0/0/2</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">interface NULL0</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">ip route-static 192.168.1.0 255.255.255.0 12.1.1.1</span></span><br><span class=\"line\">ip route-static 192.168.3.0 255.255.255.0 23.1.1.3</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">user-interface con 0</span></span><br><span class=\"line\"> authentication-mode password</span><br><span class=\"line\">user-interface vty 0 4</span><br><span class=\"line\">user-interface vty 16 20</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">wlan ac</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\"><span class=\"built_in\">return</span></span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>R3配置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;R3&gt;dis cu </span><br><span class=\"line\">[V200R003C00]</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\"> sysname R3</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\"> snmp-agent local-engineid 800007DB03000000000000</span></span><br><span class=\"line\"> snmp-agent </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\"> clock timezone China-Standard-Time minus 08:00:00</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">portal local-server load portalpage.zip</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\"> drop illegal-mac alarm</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\"> <span class=\"built_in\">set</span> cpu-usage threshold 80 restore 75</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">aaa</span> </span><br><span class=\"line\"> authentication-scheme default</span><br><span class=\"line\"> authorization-scheme default</span><br><span class=\"line\"> accounting-scheme default</span><br><span class=\"line\"> domain default </span><br><span class=\"line\"> domain default_admin </span><br><span class=\"line\"> local-user admin password cipher %$%$K8m.Nt84DZ&#125;e#&lt;0`8bmE3Uw&#125;%$%$</span><br><span class=\"line\"> local-user admin service-type http</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">firewall zone Local</span></span><br><span class=\"line\"> priority 15</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">interface GigabitEthernet0/0/0</span></span><br><span class=\"line\"> ip address 23.1.1.3 255.255.255.0 </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">interface GigabitEthernet0/0/1</span></span><br><span class=\"line\"> ip address 192.168.3.254 255.255.255.0 </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">interface GigabitEthernet0/0/2</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">interface NULL0</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">ip route-static 192.168.1.0 255.255.255.0 23.1.1.2</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">user-interface con 0</span></span><br><span class=\"line\"> authentication-mode password</span><br><span class=\"line\">user-interface vty 0 4</span><br><span class=\"line\">user-interface vty 16 20</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\">wlan ac</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\"><span class=\"built_in\">return</span></span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n","categories":["路由"],"tags":["网络","路由"]},{"title":"centos 更新yum源","url":"/post/d69fe3be.html","content":"<p>centos的yum源是国外的,有时候我们访问的速度会很慢,所以我们要把yum的源 设置成国内的镜像</p>\n<span id=\"more\"></span>\n\n<p>备份原来的yum源</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak</span><br></pre></td></tr></table></figure>\n\n<p>下载ali源</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">cd /etc/yum.repos.d/</span><br><span class=\"line\">wget -nc http://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></table></figure>\n\n<p>更改ali源为默认源</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">mv Centos-7.repo  CentOS-Base.repo</span><br></pre></td></tr></table></figure>\n\n<p>更新本地缓存</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">清空所有</span></span><br><span class=\"line\">yum clean all</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">更新列表</span></span><br><span class=\"line\">yum list</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">缓存到本机</span></span><br><span class=\"line\">yum makecache</span><br></pre></td></tr></table></figure>\n\n","categories":["linux"],"tags":["centos","yum源"]},{"title":"Day004：网络与协议基础 - TCP/UDP 与会话","url":"/post/ccce0add.html","content":"<h1 id=\"Day004：网络与协议基础-TCP-x2F-UDP-与会话\"><a href=\"#Day004：网络与协议基础-TCP-x2F-UDP-与会话\" class=\"headerlink\" title=\"Day004：网络与协议基础 - TCP&#x2F;UDP 与会话\"></a>Day004：网络与协议基础 - TCP&#x2F;UDP 与会话</h1><ul>\n<li>日期：2025-12-28</li>\n<li>周次：第 1 周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><ul>\n<li>掌握 TCP 三次握手与四次挥手</li>\n<li>理解 UDP 的无连接特性与适用场景</li>\n</ul>\n<span id=\"more\"></span>\n\n<h2 id=\"学习内容\"><a href=\"#学习内容\" class=\"headerlink\" title=\"学习内容\"></a>学习内容</h2><h3 id=\"1️⃣-TCP-协议概述\"><a href=\"#1️⃣-TCP-协议概述\" class=\"headerlink\" title=\"1️⃣ TCP 协议概述\"></a>1️⃣ TCP 协议概述</h3><p><strong>TCP（Transmission Control Protocol，传输控制协议）</strong></p>\n<p><strong>核心特点：</strong></p>\n<ul>\n<li>✅ <strong>面向连接</strong>：通信前必须建立连接</li>\n<li>✅ <strong>可靠传输</strong>：确保数据正确、完整、按序到达</li>\n<li>✅ <strong>流量控制</strong>：防止发送方发送过快</li>\n<li>✅ <strong>拥塞控制</strong>：根据网络状况调整发送速率</li>\n<li>✅ <strong>全双工通信</strong>：双向同时传输数据</li>\n</ul>\n<p><strong>TCP 报文段结构：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"> 0                   1                   2                   3</span><br><span class=\"line\"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span><br><span class=\"line\">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class=\"line\">|          源端口 (16位)         |        目标端口 (16位)        |</span><br><span class=\"line\">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class=\"line\">|                      序列号 (32位)                            |</span><br><span class=\"line\">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class=\"line\">|                    确认号 (32位)                              |</span><br><span class=\"line\">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class=\"line\">|首部长|保留|U|A|P|R|S|F|                                       |</span><br><span class=\"line\">|度(4位)|(6位)|R|C|S|S|Y|I|         窗口大小 (16位)             |</span><br><span class=\"line\">|      |     |G|K|H|T|N|N|                                       |</span><br><span class=\"line\">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class=\"line\">|          校验和 (16位)         |       紧急指针 (16位)         |</span><br><span class=\"line\">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class=\"line\">|                       选项（可变长度）                         |</span><br><span class=\"line\">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class=\"line\">|                          数据                                 |</span><br><span class=\"line\">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></pre></td></tr></table></figure>\n\n<p><strong>重要字段说明：</strong></p>\n<table>\n<thead>\n<tr>\n<th>字段</th>\n<th>说明</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>源端口</strong></td>\n<td>发送方端口号</td>\n<td>54321</td>\n</tr>\n<tr>\n<td><strong>目标端口</strong></td>\n<td>接收方端口号</td>\n<td>80 (HTTP)</td>\n</tr>\n<tr>\n<td><strong>序列号 (Seq)</strong></td>\n<td>本次发送数据的第一个字节的序号</td>\n<td>1000</td>\n</tr>\n<tr>\n<td><strong>确认号 (Ack)</strong></td>\n<td>期望接收的下一个字节的序号</td>\n<td>2000</td>\n</tr>\n<tr>\n<td><strong>控制位</strong></td>\n<td>6 个标志位，控制 TCP 连接状态</td>\n<td>SYN, ACK, FIN 等</td>\n</tr>\n<tr>\n<td><strong>窗口大小</strong></td>\n<td>接收窗口大小，用于流量控制</td>\n<td>65535 字节</td>\n</tr>\n</tbody></table>\n<p><strong>TCP 控制标志位（Flags）：</strong></p>\n<table>\n<thead>\n<tr>\n<th>标志位</th>\n<th>全称</th>\n<th>作用</th>\n<th>值为 1 时的含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>URG</strong></td>\n<td>Urgent</td>\n<td>紧急指针有效</td>\n<td>紧急数据</td>\n</tr>\n<tr>\n<td><strong>ACK</strong></td>\n<td>Acknowledgment</td>\n<td>确认号有效</td>\n<td>确认接收</td>\n</tr>\n<tr>\n<td><strong>PSH</strong></td>\n<td>Push</td>\n<td>立即推送数据</td>\n<td>不缓冲，立即传递给应用层</td>\n</tr>\n<tr>\n<td><strong>RST</strong></td>\n<td>Reset</td>\n<td>重置连接</td>\n<td>异常关闭连接</td>\n</tr>\n<tr>\n<td><strong>SYN</strong></td>\n<td>Synchronize</td>\n<td>同步序列号</td>\n<td>建立连接</td>\n</tr>\n<tr>\n<td><strong>FIN</strong></td>\n<td>Finish</td>\n<td>结束发送</td>\n<td>关闭连接</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"2️⃣-TCP-三次握手（建立连接）\"><a href=\"#2️⃣-TCP-三次握手（建立连接）\" class=\"headerlink\" title=\"2️⃣ TCP 三次握手（建立连接）\"></a>2️⃣ TCP 三次握手（建立连接）</h3><p><strong>目的：</strong> 建立可靠的双向通信通道</p>\n<p><strong>为什么需要三次握手？</strong></p>\n<ol>\n<li>确认双方都具备发送和接收能力</li>\n<li>协商初始序列号（ISN，Initial Sequence Number）</li>\n<li>协商 TCP 参数（窗口大小、MSS 等）</li>\n</ol>\n<p><strong>三次握手流程图：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">客户端 (Client)                              服务器 (Server)</span><br><span class=\"line\">    │                                             │</span><br><span class=\"line\">    │         ① SYN (Seq=100)                     │</span><br><span class=\"line\">    │ ─────────────────────────────────────────&gt; │</span><br><span class=\"line\">    │                                             │</span><br><span class=\"line\">    │    客户端状态: CLOSED → SYN_SENT            │  服务器状态: LISTEN</span><br><span class=\"line\">    │                                             │</span><br><span class=\"line\">    │                                             │</span><br><span class=\"line\">    │      ② SYN-ACK (Seq=200, Ack=101)           │</span><br><span class=\"line\">    │ &lt;───────────────────────────────────────── │</span><br><span class=\"line\">    │                                             │</span><br><span class=\"line\">    │                                             │  服务器状态: LISTEN → SYN_RCVD</span><br><span class=\"line\">    │                                             │</span><br><span class=\"line\">    │         ③ ACK (Seq=101, Ack=201)            │</span><br><span class=\"line\">    │ ─────────────────────────────────────────&gt; │</span><br><span class=\"line\">    │                                             │</span><br><span class=\"line\">    │    客户端状态: SYN_SENT → ESTABLISHED       │  服务器状态: SYN_RCVD → ESTABLISHED</span><br><span class=\"line\">    │                                             │</span><br><span class=\"line\">    │ ◀═══════════ 连接建立，开始传输数据 ═══════▶ │</span><br><span class=\"line\">    │                                             │</span><br></pre></td></tr></table></figure>\n\n<p><strong>详细步骤解析：</strong></p>\n<p><strong>第一次握手（客户端 → 服务器）：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">┌────────────────────────────────────┐</span><br><span class=\"line\">│ TCP 报文内容：                     │</span><br><span class=\"line\">├────────────────────────────────────┤</span><br><span class=\"line\">│ SYN = 1                            │ ← 请求建立连接</span><br><span class=\"line\">│ ACK = 0                            │ ← 没有确认号</span><br><span class=\"line\">│ Seq = 100 (ISN_Client)             │ ← 客户端初始序列号</span><br><span class=\"line\">│ Ack = 0                            │ ← 无意义</span><br><span class=\"line\">├────────────────────────────────────┤</span><br><span class=\"line\">│ 含义：&quot;服务器，我想和你建立连接&quot;  │</span><br><span class=\"line\">│       &quot;我的初始序列号是 100&quot;      │</span><br><span class=\"line\">└────────────────────────────────────┘</span><br><span class=\"line\"></span><br><span class=\"line\">客户端状态变化：CLOSED → SYN_SENT</span><br></pre></td></tr></table></figure>\n\n<p><strong>第二次握手（服务器 → 客户端）：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">┌────────────────────────────────────┐</span><br><span class=\"line\">│ TCP 报文内容：                     │</span><br><span class=\"line\">├────────────────────────────────────┤</span><br><span class=\"line\">│ SYN = 1                            │ ← 服务器也请求建立连接</span><br><span class=\"line\">│ ACK = 1                            │ ← 确认收到客户端的 SYN</span><br><span class=\"line\">│ Seq = 200 (ISN_Server)             │ ← 服务器初始序列号</span><br><span class=\"line\">│ Ack = 101 (Client_Seq + 1)         │ ← 确认号：期望收到 101</span><br><span class=\"line\">├────────────────────────────────────┤</span><br><span class=\"line\">│ 含义：&quot;我收到你的请求了(ACK)&quot;     │</span><br><span class=\"line\">│       &quot;我也想和你建立连接(SYN)&quot;   │</span><br><span class=\"line\">│       &quot;我的初始序列号是 200&quot;      │</span><br><span class=\"line\">│       &quot;我期望你下次发送 Seq=101&quot;  │</span><br><span class=\"line\">└────────────────────────────────────┘</span><br><span class=\"line\"></span><br><span class=\"line\">服务器状态变化：LISTEN → SYN_RCVD</span><br></pre></td></tr></table></figure>\n\n<p><strong>第三次握手（客户端 → 服务器）：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">┌────────────────────────────────────┐</span><br><span class=\"line\">│ TCP 报文内容：                     │</span><br><span class=\"line\">├────────────────────────────────────┤</span><br><span class=\"line\">│ SYN = 0                            │ ← 连接建立阶段结束</span><br><span class=\"line\">│ ACK = 1                            │ ← 确认收到服务器的 SYN-ACK</span><br><span class=\"line\">│ Seq = 101                          │ ← 按服务器的期望发送</span><br><span class=\"line\">│ Ack = 201 (Server_Seq + 1)         │ ← 确认号：期望收到 201</span><br><span class=\"line\">├────────────────────────────────────┤</span><br><span class=\"line\">│ 含义：&quot;我收到你的确认了(ACK)&quot;     │</span><br><span class=\"line\">│       &quot;连接建立完成&quot;              │</span><br><span class=\"line\">│       &quot;可以开始传输数据了&quot;        │</span><br><span class=\"line\">└────────────────────────────────────┘</span><br><span class=\"line\"></span><br><span class=\"line\">客户端状态变化：SYN_SENT → ESTABLISHED</span><br><span class=\"line\">服务器状态变化：SYN_RCVD → ESTABLISHED</span><br><span class=\"line\"></span><br><span class=\"line\">✅ 连接建立成功！双方进入 ESTABLISHED 状态</span><br></pre></td></tr></table></figure>\n\n<p><strong>为什么不能是两次握手？</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">两次握手的问题：</span><br><span class=\"line\"></span><br><span class=\"line\">场景：网络延迟导致的重复连接请求</span><br><span class=\"line\">┌─────────────────────────────────────────────────────┐</span><br><span class=\"line\">│ 1. 客户端发送 SYN (请求1)                            │</span><br><span class=\"line\">│    ↓ 网络延迟，包很久才到达                          │</span><br><span class=\"line\">│                                                      │</span><br><span class=\"line\">│ 2. 客户端超时，重新发送 SYN (请求2)                  │</span><br><span class=\"line\">│    ↓ 这个包很快到达                                  │</span><br><span class=\"line\">│                                                      │</span><br><span class=\"line\">│ 3. 服务器收到请求2，回复 SYN-ACK                     │</span><br><span class=\"line\">│    连接建立 ✅                                       │</span><br><span class=\"line\">│                                                      │</span><br><span class=\"line\">│ 4. 双方通信完成，连接关闭                            │</span><br><span class=\"line\">│                                                      │</span><br><span class=\"line\">│ 5. ⚠️ 延迟的请求1终于到达服务器                       │</span><br><span class=\"line\">│    如果是两次握手：服务器直接建立连接 ❌              │</span><br><span class=\"line\">│    服务器会一直等待客户端发数据                       │</span><br><span class=\"line\">│    但客户端认为连接已关闭，不会发送数据               │</span><br><span class=\"line\">│    → 造成服务器资源浪费                             │</span><br><span class=\"line\">│                                                      │</span><br><span class=\"line\">│ 三次握手的优势：                                     │</span><br><span class=\"line\">│    服务器发送 SYN-ACK 后，必须等待客户端确认         │</span><br><span class=\"line\">│    客户端不会对延迟的旧连接请求回复确认               │</span><br><span class=\"line\">│    → 服务器不会建立无效连接 ✅                       │</span><br><span class=\"line\">└─────────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"3️⃣-TCP-四次挥手（关闭连接）\"><a href=\"#3️⃣-TCP-四次挥手（关闭连接）\" class=\"headerlink\" title=\"3️⃣ TCP 四次挥手（关闭连接）\"></a>3️⃣ TCP 四次挥手（关闭连接）</h3><p><strong>目的：</strong> 安全、可靠地关闭双向通信</p>\n<p><strong>为什么需要四次挥手？</strong></p>\n<ul>\n<li>TCP 是全双工通信（双向独立）</li>\n<li>每个方向都需要单独关闭</li>\n<li>确保双方数据都发送完毕</li>\n</ul>\n<p><strong>四次挥手流程图：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">客户端 (Client)                              服务器 (Server)</span><br><span class=\"line\">    │                                             │</span><br><span class=\"line\">    │  ◀════════ 数据传输阶段 (ESTABLISHED) ════▶ │</span><br><span class=\"line\">    │                                             │</span><br><span class=\"line\">    │                                             │</span><br><span class=\"line\">    │         ① FIN (Seq=300)                     │</span><br><span class=\"line\">    │ ─────────────────────────────────────────&gt; │</span><br><span class=\"line\">    │                                             │</span><br><span class=\"line\">    │   客户端状态: ESTABLISHED → FIN_WAIT_1       │</span><br><span class=\"line\">    │   含义：&quot;我没有数据要发送了&quot;                │</span><br><span class=\"line\">    │                                             │</span><br><span class=\"line\">    │                                             │</span><br><span class=\"line\">    │         ② ACK (Ack=301)                     │</span><br><span class=\"line\">    │ &lt;───────────────────────────────────────── │</span><br><span class=\"line\">    │                                             │</span><br><span class=\"line\">    │   客户端状态: FIN_WAIT_1 → FIN_WAIT_2        │  服务器状态: ESTABLISHED → CLOSE_WAIT</span><br><span class=\"line\">    │   含义：&quot;我知道你要关闭了&quot;                  │  (服务器可能还有数据要发送)</span><br><span class=\"line\">    │                                             │</span><br><span class=\"line\">    │                                             │</span><br><span class=\"line\">    │         ③ FIN (Seq=400)                     │</span><br><span class=\"line\">    │ &lt;───────────────────────────────────────── │</span><br><span class=\"line\">    │                                             │</span><br><span class=\"line\">    │                                             │  服务器状态: CLOSE_WAIT → LAST_ACK</span><br><span class=\"line\">    │                                             │  含义：&quot;我也没有数据了，准备关闭&quot;</span><br><span class=\"line\">    │                                             │</span><br><span class=\"line\">    │         ④ ACK (Ack=401)                     │</span><br><span class=\"line\">    │ ─────────────────────────────────────────&gt; │</span><br><span class=\"line\">    │                                             │</span><br><span class=\"line\">    │   客户端状态: FIN_WAIT_2 → TIME_WAIT         │  服务器状态: LAST_ACK → CLOSED ✅</span><br><span class=\"line\">    │                                             │</span><br><span class=\"line\">    │   (等待 2MSL 时间)                          │</span><br><span class=\"line\">    │         ↓                                   │</span><br><span class=\"line\">    │   客户端状态: TIME_WAIT → CLOSED ✅           │</span><br><span class=\"line\">    │                                             │</span><br></pre></td></tr></table></figure>\n\n<p><strong>详细步骤解析：</strong></p>\n<p><strong>第一次挥手（客户端 → 服务器）：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">┌────────────────────────────────────┐</span><br><span class=\"line\">│ TCP 报文内容：                     │</span><br><span class=\"line\">├────────────────────────────────────┤</span><br><span class=\"line\">│ FIN = 1                            │ ← 请求关闭连接</span><br><span class=\"line\">│ ACK = 1                            │ ← 可能确认之前的数据</span><br><span class=\"line\">│ Seq = 300                          │ ← 当前序列号</span><br><span class=\"line\">│ Ack = 之前的值                     │</span><br><span class=\"line\">├────────────────────────────────────┤</span><br><span class=\"line\">│ 含义：&quot;我没有数据要发送了&quot;        │</span><br><span class=\"line\">│       &quot;但我还可以接收数据&quot;        │</span><br><span class=\"line\">└────────────────────────────────────┘</span><br><span class=\"line\"></span><br><span class=\"line\">客户端状态：ESTABLISHED → FIN_WAIT_1</span><br></pre></td></tr></table></figure>\n\n<p><strong>第二次挥手（服务器 → 客户端）：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">┌────────────────────────────────────┐</span><br><span class=\"line\">│ TCP 报文内容：                     │</span><br><span class=\"line\">├────────────────────────────────────┤</span><br><span class=\"line\">│ FIN = 0                            │</span><br><span class=\"line\">│ ACK = 1                            │ ← 确认收到客户端的 FIN</span><br><span class=\"line\">│ Seq = 400                          │</span><br><span class=\"line\">│ Ack = 301 (Client_Seq + 1)         │ ← 确认关闭请求</span><br><span class=\"line\">├────────────────────────────────────┤</span><br><span class=\"line\">│ 含义：&quot;我知道你要关闭了&quot;          │</span><br><span class=\"line\">│       &quot;但我可能还有数据要发送&quot;    │</span><br><span class=\"line\">│       &quot;请等我发送完&quot;              │</span><br><span class=\"line\">└────────────────────────────────────┘</span><br><span class=\"line\"></span><br><span class=\"line\">客户端状态：FIN_WAIT_1 → FIN_WAIT_2</span><br><span class=\"line\">服务器状态：ESTABLISHED → CLOSE_WAIT</span><br><span class=\"line\"></span><br><span class=\"line\">⚠️ 此时连接处于半关闭状态：</span><br><span class=\"line\">    客户端 → 服务器：已关闭 ❌</span><br><span class=\"line\">    服务器 → 客户端：仍然可以发送数据 ✅</span><br></pre></td></tr></table></figure>\n\n<p><strong>第三次挥手（服务器 → 客户端）：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">┌────────────────────────────────────┐</span><br><span class=\"line\">│ TCP 报文内容：                     │</span><br><span class=\"line\">├────────────────────────────────────┤</span><br><span class=\"line\">│ FIN = 1                            │ ← 服务器也请求关闭</span><br><span class=\"line\">│ ACK = 1                            │</span><br><span class=\"line\">│ Seq = 500                          │</span><br><span class=\"line\">│ Ack = 301                          │</span><br><span class=\"line\">├────────────────────────────────────┤</span><br><span class=\"line\">│ 含义：&quot;我的数据也发送完了&quot;        │</span><br><span class=\"line\">│       &quot;我也要关闭连接了&quot;          │</span><br><span class=\"line\">└────────────────────────────────────┘</span><br><span class=\"line\"></span><br><span class=\"line\">服务器状态：CLOSE_WAIT → LAST_ACK</span><br></pre></td></tr></table></figure>\n\n<p><strong>第四次挥手（客户端 → 服务器）：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">┌────────────────────────────────────┐</span><br><span class=\"line\">│ TCP 报文内容：                     │</span><br><span class=\"line\">├────────────────────────────────────┤</span><br><span class=\"line\">│ FIN = 0                            │</span><br><span class=\"line\">│ ACK = 1                            │ ← 确认服务器的 FIN</span><br><span class=\"line\">│ Seq = 301                          │</span><br><span class=\"line\">│ Ack = 501 (Server_Seq + 1)         │</span><br><span class=\"line\">├────────────────────────────────────┤</span><br><span class=\"line\">│ 含义：&quot;我知道你也要关闭了&quot;        │</span><br><span class=\"line\">│       &quot;确认关闭&quot;                  │</span><br><span class=\"line\">└────────────────────────────────────┘</span><br><span class=\"line\"></span><br><span class=\"line\">服务器状态：LAST_ACK → CLOSED ✅ (立即关闭)</span><br><span class=\"line\">客户端状态：FIN_WAIT_2 → TIME_WAIT (等待 2MSL)</span><br><span class=\"line\">           TIME_WAIT → CLOSED ✅ (2MSL 后关闭)</span><br></pre></td></tr></table></figure>\n\n<p><strong>TIME_WAIT 状态（2MSL 等待）：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">MSL (Maximum Segment Lifetime): 报文段最大生存时间</span><br><span class=\"line\">通常 MSL = 30秒 或 2分钟（取决于系统）</span><br><span class=\"line\">2MSL = 60秒 或 4分钟</span><br><span class=\"line\"></span><br><span class=\"line\">为什么需要 TIME_WAIT？</span><br><span class=\"line\"></span><br><span class=\"line\">原因 1：确保最后的 ACK 能够到达服务器</span><br><span class=\"line\">┌─────────────────────────────────────┐</span><br><span class=\"line\">│ 客户端发送最后的 ACK                │</span><br><span class=\"line\">│    ↓                                │</span><br><span class=\"line\">│    如果 ACK 丢失                     │</span><br><span class=\"line\">│    ↓                                │</span><br><span class=\"line\">│ 服务器超时，重传 FIN                │</span><br><span class=\"line\">│    ↓                                │</span><br><span class=\"line\">│ 客户端在 TIME_WAIT 期间可以接收      │</span><br><span class=\"line\">│ 并重新发送 ACK                       │</span><br><span class=\"line\">└─────────────────────────────────────┘</span><br><span class=\"line\"></span><br><span class=\"line\">原因 2：防止旧连接的数据干扰新连接</span><br><span class=\"line\">┌─────────────────────────────────────┐</span><br><span class=\"line\">│ 网络中可能还有延迟的旧数据包         │</span><br><span class=\"line\">│ 等待 2MSL 确保所有旧包都消失         │</span><br><span class=\"line\">│ 避免影响使用相同端口的新连接         │</span><br><span class=\"line\">└─────────────────────────────────────┘</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"4️⃣-TCP-状态转换图\"><a href=\"#4️⃣-TCP-状态转换图\" class=\"headerlink\" title=\"4️⃣ TCP 状态转换图\"></a>4️⃣ TCP 状态转换图</h3><p><strong>完整的 TCP 状态机：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">客户端状态转换                          服务器状态转换</span><br><span class=\"line\">    │                                      │</span><br><span class=\"line\"> CLOSED                                 CLOSED</span><br><span class=\"line\">    │                                      │</span><br><span class=\"line\">    │ (主动打开)                           │ (被动打开, listen())</span><br><span class=\"line\">    ↓                                      ↓</span><br><span class=\"line\"> SYN_SENT ──────① SYN─────────────────&gt; LISTEN</span><br><span class=\"line\">    │                                      │</span><br><span class=\"line\">    │          ② SYN-ACK                   ↓</span><br><span class=\"line\">    │  &lt;──────────────────────────── SYN_RCVD</span><br><span class=\"line\">    ↓                                      │</span><br><span class=\"line\">    │          ③ ACK                       │</span><br><span class=\"line\">ESTABLISHED ─────────────────────────&gt; ESTABLISHED</span><br><span class=\"line\">    │                                      │</span><br><span class=\"line\">    │ (主动关闭)                           │</span><br><span class=\"line\">    │          ① FIN                       │</span><br><span class=\"line\">FIN_WAIT_1 ─────────────────────────&gt; CLOSE_WAIT</span><br><span class=\"line\">    │                                      │ (被动关闭)</span><br><span class=\"line\">    │          ② ACK                       │</span><br><span class=\"line\">    ↓                                      │</span><br><span class=\"line\">FIN_WAIT_2                                 │</span><br><span class=\"line\">    │                                      │</span><br><span class=\"line\">    │          ③ FIN                       │</span><br><span class=\"line\">    │  &lt;───────────────────────────── LAST_ACK</span><br><span class=\"line\">    ↓                                      │</span><br><span class=\"line\">    │          ④ ACK                       │</span><br><span class=\"line\">TIME_WAIT  ─────────────────────────&gt;   CLOSED</span><br><span class=\"line\">    │</span><br><span class=\"line\">    │ (等待 2MSL)</span><br><span class=\"line\">    ↓</span><br><span class=\"line\">  CLOSED</span><br></pre></td></tr></table></figure>\n\n<p><strong>TCP 状态说明：</strong></p>\n<table>\n<thead>\n<tr>\n<th>状态</th>\n<th>说明</th>\n<th>谁会进入</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>CLOSED</strong></td>\n<td>关闭状态，无连接</td>\n<td>初始状态</td>\n</tr>\n<tr>\n<td><strong>LISTEN</strong></td>\n<td>监听状态，等待连接请求</td>\n<td>服务器</td>\n</tr>\n<tr>\n<td><strong>SYN_SENT</strong></td>\n<td>已发送 SYN，等待服务器响应</td>\n<td>客户端</td>\n</tr>\n<tr>\n<td><strong>SYN_RCVD</strong></td>\n<td>已收到 SYN，等待最后的 ACK</td>\n<td>服务器</td>\n</tr>\n<tr>\n<td><strong>ESTABLISHED</strong></td>\n<td>连接已建立，可以传输数据</td>\n<td>双方</td>\n</tr>\n<tr>\n<td><strong>FIN_WAIT_1</strong></td>\n<td>已发送 FIN，等待 ACK</td>\n<td>主动关闭方</td>\n</tr>\n<tr>\n<td><strong>FIN_WAIT_2</strong></td>\n<td>已收到 ACK，等待对方的 FIN</td>\n<td>主动关闭方</td>\n</tr>\n<tr>\n<td><strong>CLOSE_WAIT</strong></td>\n<td>已收到 FIN，等待应用层关闭</td>\n<td>被动关闭方</td>\n</tr>\n<tr>\n<td><strong>LAST_ACK</strong></td>\n<td>已发送 FIN，等待最后的 ACK</td>\n<td>被动关闭方</td>\n</tr>\n<tr>\n<td><strong>TIME_WAIT</strong></td>\n<td>等待 2MSL，确保连接安全关闭</td>\n<td>主动关闭方</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"5️⃣-五元组（会话标识）\"><a href=\"#5️⃣-五元组（会话标识）\" class=\"headerlink\" title=\"5️⃣ 五元组（会话标识）\"></a>5️⃣ 五元组（会话标识）</h3><p><strong>TCP 连接唯一标识：五元组</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">五元组 = (源IP, 源端口, 目标IP, 目标端口, 协议)</span><br><span class=\"line\"></span><br><span class=\"line\">示例：</span><br><span class=\"line\">┌─────────────────────────────────────┐</span><br><span class=\"line\">│ 源 IP:        192.168.31.36         │</span><br><span class=\"line\">│ 源端口:       54321                  │</span><br><span class=\"line\">│ 目标 IP:      172.217.160.142       │</span><br><span class=\"line\">│ 目标端口:     443 (HTTPS)            │</span><br><span class=\"line\">│ 协议:         TCP (6)                │</span><br><span class=\"line\">└─────────────────────────────────────┘</span><br><span class=\"line\"></span><br><span class=\"line\">这个五元组唯一标识一个 TCP 连接</span><br></pre></td></tr></table></figure>\n\n<p><strong>为什么需要五元组？</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">场景：浏览器同时访问多个网站</span><br><span class=\"line\"></span><br><span class=\"line\">连接 1：访问百度</span><br><span class=\"line\">├─ 源 IP: 192.168.31.36</span><br><span class=\"line\">├─ 源端口: 54321</span><br><span class=\"line\">├─ 目标 IP: 220.181.38.148 (百度)</span><br><span class=\"line\">├─ 目标端口: 443</span><br><span class=\"line\">└─ 协议: TCP</span><br><span class=\"line\"></span><br><span class=\"line\">连接 2：访问谷歌</span><br><span class=\"line\">├─ 源 IP: 192.168.31.36 (相同)</span><br><span class=\"line\">├─ 源端口: 54322 (不同) ← 通过不同端口区分</span><br><span class=\"line\">├─ 目标 IP: 172.217.160.142 (谷歌)</span><br><span class=\"line\">├─ 目标端口: 443 (相同)</span><br><span class=\"line\">└─ 协议: TCP</span><br><span class=\"line\"></span><br><span class=\"line\">系统通过五元组区分这两个连接</span><br><span class=\"line\">收到数据包时，根据五元组判断属于哪个连接</span><br></pre></td></tr></table></figure>\n\n<p><strong>端口号范围：</strong></p>\n<table>\n<thead>\n<tr>\n<th>端口范围</th>\n<th>类型</th>\n<th>说明</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>0-1023</strong></td>\n<td>知名端口</td>\n<td>保留给系统服务</td>\n<td>80(HTTP), 443(HTTPS), 22(SSH)</td>\n</tr>\n<tr>\n<td><strong>1024-49151</strong></td>\n<td>注册端口</td>\n<td>应用程序注册使用</td>\n<td>3306(MySQL), 8080(备用 HTTP)</td>\n</tr>\n<tr>\n<td><strong>49152-65535</strong></td>\n<td>动态&#x2F;私有端口</td>\n<td>客户端临时使用</td>\n<td>浏览器发起连接时随机分配</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"6️⃣-UDP-协议对比\"><a href=\"#6️⃣-UDP-协议对比\" class=\"headerlink\" title=\"6️⃣ UDP 协议对比\"></a>6️⃣ UDP 协议对比</h3><p><strong>UDP（User Datagram Protocol，用户数据报协议）</strong></p>\n<p><strong>核心特点：</strong></p>\n<ul>\n<li>⚠️ <strong>无连接</strong>：不需要建立连接，直接发送</li>\n<li>⚠️ <strong>不可靠</strong>：不保证数据到达，不重传</li>\n<li>⚠️ <strong>无序</strong>：不保证顺序</li>\n<li>✅ <strong>低开销</strong>：首部只有 8 字节</li>\n<li>✅ <strong>快速</strong>：没有握手、挥手过程</li>\n<li>✅ <strong>支持广播&#x2F;多播</strong>：一对多通信</li>\n</ul>\n<p><strong>UDP 报文结构：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"> 0                   1                   2                   3</span><br><span class=\"line\"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span><br><span class=\"line\">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class=\"line\">|          源端口 (16位)         |        目标端口 (16位)        |</span><br><span class=\"line\">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class=\"line\">|         长度 (16位)            |         校验和 (16位)         |</span><br><span class=\"line\">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class=\"line\">|                          数据                                 |</span><br><span class=\"line\">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class=\"line\"></span><br><span class=\"line\">只有 8 字节的首部！</span><br></pre></td></tr></table></figure>\n\n<p><strong>TCP vs UDP 对比：</strong></p>\n<table>\n<thead>\n<tr>\n<th>对比项</th>\n<th>TCP</th>\n<th>UDP</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>连接</strong></td>\n<td>面向连接（握手）</td>\n<td>无连接</td>\n</tr>\n<tr>\n<td><strong>可靠性</strong></td>\n<td>可靠（确认、重传）</td>\n<td>不可靠</td>\n</tr>\n<tr>\n<td><strong>顺序</strong></td>\n<td>保证顺序</td>\n<td>不保证</td>\n</tr>\n<tr>\n<td><strong>速度</strong></td>\n<td>较慢（有开销）</td>\n<td>快速</td>\n</tr>\n<tr>\n<td><strong>首部大小</strong></td>\n<td>20-60 字节</td>\n<td>8 字节</td>\n</tr>\n<tr>\n<td><strong>流量控制</strong></td>\n<td>有（窗口机制）</td>\n<td>无</td>\n</tr>\n<tr>\n<td><strong>拥塞控制</strong></td>\n<td>有</td>\n<td>无</td>\n</tr>\n<tr>\n<td><strong>广播&#x2F;多播</strong></td>\n<td>不支持</td>\n<td>支持</td>\n</tr>\n<tr>\n<td><strong>适用场景</strong></td>\n<td>文件传输、网页、邮件</td>\n<td>视频通话、在线游戏、DNS</td>\n</tr>\n</tbody></table>\n<p><strong>UDP 适用场景：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">✅ 实时音视频通话（如 Zoom、微信视频）</span><br><span class=\"line\">   原因：丢失少量数据包不影响体验，追求低延迟</span><br><span class=\"line\"></span><br><span class=\"line\">✅ 在线游戏</span><br><span class=\"line\">   原因：需要快速响应，偶尔丢包可以容忍</span><br><span class=\"line\"></span><br><span class=\"line\">✅ DNS 查询</span><br><span class=\"line\">   原因：查询数据量小，查询失败可以重试</span><br><span class=\"line\"></span><br><span class=\"line\">✅ 直播流媒体</span><br><span class=\"line\">   原因：实时性要求高，丢失几帧不影响观看</span><br><span class=\"line\"></span><br><span class=\"line\">✅ 物联网设备</span><br><span class=\"line\">   原因：设备资源有限，协议简单更合适</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"7️⃣-常见问题与异常\"><a href=\"#7️⃣-常见问题与异常\" class=\"headerlink\" title=\"7️⃣ 常见问题与异常\"></a>7️⃣ 常见问题与异常</h3><p><strong>问题 1：SYN 洪泛攻击（SYN Flood）</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">攻击原理：</span><br><span class=\"line\">攻击者 ──大量 SYN──&gt; 服务器</span><br><span class=\"line\">         (伪造源IP)</span><br><span class=\"line\"></span><br><span class=\"line\">服务器回复 SYN-ACK，等待最后的 ACK</span><br><span class=\"line\">但攻击者永远不发送 ACK</span><br><span class=\"line\">服务器维持大量半连接状态（SYN_RCVD）</span><br><span class=\"line\">→ 资源耗尽，无法处理正常连接</span><br><span class=\"line\"></span><br><span class=\"line\">防护措施：</span><br><span class=\"line\">✅ SYN Cookie 技术</span><br><span class=\"line\">✅ 限制半连接数量</span><br><span class=\"line\">✅ 使用防火墙过滤</span><br><span class=\"line\">✅ 增加 SYN 队列大小</span><br></pre></td></tr></table></figure>\n\n<p><strong>问题 2：连接泄漏（Connection Leak）</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">原因：应用程序没有正确关闭连接</span><br><span class=\"line\"></span><br><span class=\"line\">后果：</span><br><span class=\"line\">├─ 客户端：大量 TIME_WAIT 状态</span><br><span class=\"line\">├─ 服务器：大量 CLOSE_WAIT 状态</span><br><span class=\"line\">└─ 端口耗尽，无法建立新连接</span><br><span class=\"line\"></span><br><span class=\"line\">解决：</span><br><span class=\"line\">✅ 确保程序正确关闭 socket</span><br><span class=\"line\">✅ 使用连接池管理连接</span><br><span class=\"line\">✅ 设置合理的超时时间</span><br></pre></td></tr></table></figure>\n\n<p><strong>问题 3：大量 TIME_WAIT 状态</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">原因：主动关闭方在 2MSL 期间保持 TIME_WAIT</span><br><span class=\"line\"></span><br><span class=\"line\">影响：</span><br><span class=\"line\">├─ 占用大量端口（客户端端口范围有限）</span><br><span class=\"line\">└─ 频繁建立连接的场景（如爬虫）容易耗尽端口</span><br><span class=\"line\"></span><br><span class=\"line\">优化：</span><br><span class=\"line\">✅ 使用长连接（HTTP Keep-Alive）</span><br><span class=\"line\">✅ 调整系统参数（减少 TIME_WAIT 时间）</span><br><span class=\"line\">✅ 使用 SO_REUSEADDR 选项</span><br><span class=\"line\">✅ 反向：让服务器主动关闭连接</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"实践任务（合法授权范围内）\"><a href=\"#实践任务（合法授权范围内）\" class=\"headerlink\" title=\"实践任务（合法授权范围内）\"></a>实践任务（合法授权范围内）</h2><h3 id=\"🎯-任务-1-使用-Wireshark-观察-TCP-三次握手与四次挥手\"><a href=\"#🎯-任务-1-使用-Wireshark-观察-TCP-三次握手与四次挥手\" class=\"headerlink\" title=\"🎯 任务 1: 使用 Wireshark 观察 TCP 三次握手与四次挥手\"></a>🎯 任务 1: 使用 Wireshark 观察 TCP 三次握手与四次挥手</h3><p><strong>准备工作：</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 确保 Wireshark 已安装</span></span><br><span class=\"line\"><span class=\"comment\"># 如果没有安装，执行：</span></span><br><span class=\"line\">winget install <span class=\"literal\">-e</span> <span class=\"literal\">--id</span> WiresharkFoundation.Wireshark</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 1：启动 Wireshark 抓包</strong></p>\n<ol>\n<li>打开 Wireshark</li>\n<li>选择活动网络接口（Wi-Fi 或以太网）</li>\n<li>开始捕获</li>\n</ol>\n<p><strong>步骤 2：设置显示过滤器</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">tcp.flags.syn==1 or tcp.flags.fin==1</span><br></pre></td></tr></table></figure>\n\n<p>这个过滤器会显示所有带 SYN 或 FIN 标志的包（握手和挥手）</p>\n<p><strong>步骤 3：访问网站触发 TCP 连接</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 使用 curl 访问网站（会自动关闭连接）</span></span><br><span class=\"line\"><span class=\"built_in\">curl</span> http://example.com</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 或者使用浏览器访问：</span></span><br><span class=\"line\"><span class=\"comment\"># http://neverssl.com (不使用 HTTPS，方便观察明文)</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 4：停止抓包并分析</strong></p>\n<p><strong>查找三次握手：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">在 Wireshark 中查找：</span><br><span class=\"line\">1. [SYN] 包 → 客户端发起</span><br><span class=\"line\">2. [SYN, ACK] 包 → 服务器响应</span><br><span class=\"line\">3. [ACK] 包 → 客户端确认</span><br><span class=\"line\"></span><br><span class=\"line\">可以在 Info 列看到类似：</span><br><span class=\"line\">→ [SYN] Seq=0 Win=...</span><br><span class=\"line\">→ [SYN, ACK] Seq=0 Ack=1 Win=...</span><br><span class=\"line\">→ [ACK] Seq=1 Ack=1 Win=...</span><br></pre></td></tr></table></figure>\n\n<p><strong>查找四次挥手：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">在 Wireshark 中查找：</span><br><span class=\"line\">1. [FIN, ACK] 包 → 一方请求关闭</span><br><span class=\"line\">2. [ACK] 包 → 另一方确认</span><br><span class=\"line\">3. [FIN, ACK] 包 → 另一方也请求关闭</span><br><span class=\"line\">4. [ACK] 包 → 最终确认</span><br><span class=\"line\"></span><br><span class=\"line\">可以在 Info 列看到类似：</span><br><span class=\"line\">→ [FIN, ACK] Seq=X Ack=Y</span><br><span class=\"line\">→ [ACK] Seq=Y Ack=X+1</span><br><span class=\"line\">→ [FIN, ACK] Seq=Y Ack=X+1</span><br><span class=\"line\">→ [ACK] Seq=X+1 Ack=Y+1</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 5：详细分析 TCP 标志位</strong></p>\n<p>点击任一 TCP 包，展开 “Transmission Control Protocol” 部分：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Transmission Control Protocol</span><br><span class=\"line\">├─ Source Port: 54321</span><br><span class=\"line\">├─ Destination Port: 80</span><br><span class=\"line\">├─ Sequence Number: 0 (relative)</span><br><span class=\"line\">├─ Acknowledgment Number: 0</span><br><span class=\"line\">├─ Header Length: 40 bytes</span><br><span class=\"line\">├─ Flags: 0x002 (SYN)  ← 重点查看</span><br><span class=\"line\">│   ├─ 000000.. = Reserved: Not set</span><br><span class=\"line\">│   ├─ ......0. = Nonce: Not set</span><br><span class=\"line\">│   ├─ .....0.. = Congestion Window Reduced: Not set</span><br><span class=\"line\">│   ├─ ....0... = ECN-Echo: Not set</span><br><span class=\"line\">│   ├─ ...0.... = Urgent: Not set</span><br><span class=\"line\">│   ├─ ..0..... = Acknowledgment: Not set</span><br><span class=\"line\">│   ├─ .0...... = Push: Not set</span><br><span class=\"line\">│   ├─ 0....... = Reset: Not set</span><br><span class=\"line\">│   ├─ 1....... = Syn: Set ✅</span><br><span class=\"line\">│   └─ .......0 = Fin: Not set</span><br><span class=\"line\">├─ Window: 65535</span><br><span class=\"line\">├─ Checksum: 0x1234</span><br><span class=\"line\">└─ Options: ...</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"🎯-任务-2-查看本机-TCP-连接状态\"><a href=\"#🎯-任务-2-查看本机-TCP-连接状态\" class=\"headerlink\" title=\"🎯 任务 2: 查看本机 TCP 连接状态\"></a>🎯 任务 2: 查看本机 TCP 连接状态</h3><p><strong>方法 1：使用 PowerShell（推荐）</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看所有 TCP 连接及状态</span></span><br><span class=\"line\"><span class=\"built_in\">Get-NetTCPConnection</span> | <span class=\"built_in\">Format-Table</span> LocalAddress, LocalPort, RemoteAddress, RemotePort, State <span class=\"literal\">-AutoSize</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看 ESTABLISHED 状态的连接</span></span><br><span class=\"line\"><span class=\"built_in\">Get-NetTCPConnection</span> <span class=\"literal\">-State</span> Established | <span class=\"built_in\">Format-Table</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看特定端口的连接（如 443 HTTPS）</span></span><br><span class=\"line\"><span class=\"built_in\">Get-NetTCPConnection</span> <span class=\"literal\">-RemotePort</span> <span class=\"number\">443</span> | <span class=\"built_in\">Format-Table</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 统计各状态的连接数</span></span><br><span class=\"line\"><span class=\"built_in\">Get-NetTCPConnection</span> | <span class=\"built_in\">Group-Object</span> <span class=\"literal\">-Property</span> State | <span class=\"built_in\">Sort-Object</span> Count <span class=\"literal\">-Descending</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>方法 2：使用 netstat 命令</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看所有 TCP 连接</span></span><br><span class=\"line\">netstat <span class=\"literal\">-an</span> | findstr <span class=\"string\">&quot;TCP&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看 ESTABLISHED 状态的连接</span></span><br><span class=\"line\">netstat <span class=\"literal\">-an</span> | findstr <span class=\"string\">&quot;ESTABLISHED&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看 TIME_WAIT 状态的连接（通常很多）</span></span><br><span class=\"line\">netstat <span class=\"literal\">-an</span> | findstr <span class=\"string\">&quot;TIME_WAIT&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 统计各状态的数量</span></span><br><span class=\"line\">netstat <span class=\"literal\">-an</span> | findstr <span class=\"string\">&quot;TCP&quot;</span> | findstr /c:<span class=\"string\">&quot;ESTABLISHED&quot;</span> /c:<span class=\"string\">&quot;TIME_WAIT&quot;</span> /c:<span class=\"string\">&quot;CLOSE_WAIT&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>预期输出示例：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">协议   本地地址              外部地址              状态</span><br><span class=\"line\">TCP    192.168.31.36:54321   172.217.160.142:443  ESTABLISHED</span><br><span class=\"line\">TCP    192.168.31.36:54322   220.181.38.148:80    TIME_WAIT</span><br><span class=\"line\">TCP    192.168.31.36:54323   13.107.42.14:443     ESTABLISHED</span><br><span class=\"line\">TCP    0.0.0.0:135           0.0.0.0:0            LISTENING</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"🎯-任务-3-构造-UDP-流量并对比-TCP\"><a href=\"#🎯-任务-3-构造-UDP-流量并对比-TCP\" class=\"headerlink\" title=\"🎯 任务 3: 构造 UDP 流量并对比 TCP\"></a>🎯 任务 3: 构造 UDP 流量并对比 TCP</h3><p><strong>DNS 查询（UDP 示例）</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 在 Wireshark 中设置过滤器</span></span><br><span class=\"line\"><span class=\"comment\"># dns</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 然后执行 DNS 查询</span></span><br><span class=\"line\">nslookup baidu.com</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 或者使用 Resolve-DnsName (PowerShell)</span></span><br><span class=\"line\"><span class=\"built_in\">Resolve-DnsName</span> baidu.com <span class=\"literal\">-Type</span> A <span class=\"literal\">-Server</span> <span class=\"number\">8.8</span>.<span class=\"number\">8.8</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>在 Wireshark 中观察：</strong></p>\n<p><strong>UDP 包特征：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">User Datagram Protocol</span><br><span class=\"line\">├─ Source Port: 54321</span><br><span class=\"line\">├─ Destination Port: 53 (DNS)</span><br><span class=\"line\">├─ Length: 45</span><br><span class=\"line\">└─ Checksum: 0x1234</span><br><span class=\"line\"></span><br><span class=\"line\">特点：</span><br><span class=\"line\">✅ 没有握手过程</span><br><span class=\"line\">✅ 直接发送数据</span><br><span class=\"line\">✅ 没有确认机制</span><br><span class=\"line\">✅ 首部只有 8 字节</span><br></pre></td></tr></table></figure>\n\n<p><strong>与 TCP 对比：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">TCP (访问网站):</span><br><span class=\"line\">1. 三次握手（3 个包）</span><br><span class=\"line\">2. 数据传输（N 个包，带 ACK）</span><br><span class=\"line\">3. 四次挥手（4 个包）</span><br><span class=\"line\">总计：至少 7 个包</span><br><span class=\"line\"></span><br><span class=\"line\">UDP (DNS 查询):</span><br><span class=\"line\">1. 直接发送查询（1 个包）</span><br><span class=\"line\">2. 收到响应（1 个包）</span><br><span class=\"line\">总计：2 个包</span><br><span class=\"line\"></span><br><span class=\"line\">UDP 的优势：快速、低开销</span><br><span class=\"line\">UDP 的劣势：不保证可靠性</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"🎯-任务-4-使用-telnet-手动模拟-TCP-连接\"><a href=\"#🎯-任务-4-使用-telnet-手动模拟-TCP-连接\" class=\"headerlink\" title=\"🎯 任务 4: 使用 telnet 手动模拟 TCP 连接\"></a>🎯 任务 4: 使用 telnet 手动模拟 TCP 连接</h3><p><strong>连接到 HTTP 服务器：</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 连接到 example.com 的 80 端口</span></span><br><span class=\"line\">telnet example.com <span class=\"number\">80</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 然后手动输入 HTTP 请求（快速输入以下内容并按两次回车）：</span></span><br><span class=\"line\">GET / HTTP/<span class=\"number\">1.1</span></span><br><span class=\"line\">Host: example.com</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 会看到服务器返回的 HTTP 响应</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>同时在 Wireshark 中观察：</strong></p>\n<ul>\n<li>可以看到三次握手</li>\n<li>看到你输入的 HTTP 请求（明文）</li>\n<li>看到服务器的响应</li>\n<li>看到四次挥手（关闭连接）</li>\n</ul>\n<hr>\n<h3 id=\"🎯-任务-5-分析真实场景的-TCP-会话\"><a href=\"#🎯-任务-5-分析真实场景的-TCP-会话\" class=\"headerlink\" title=\"🎯 任务 5: 分析真实场景的 TCP 会话\"></a>🎯 任务 5: 分析真实场景的 TCP 会话</h3><p><strong>步骤 1：在 Wireshark 中抓包</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 过滤器设置为：</span><br><span class=\"line\">tcp.port == 443</span><br><span class=\"line\"></span><br><span class=\"line\"># 然后用浏览器访问 https://www.baidu.com</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 2：追踪 TCP 流</strong></p>\n<p>在 Wireshark 中：</p>\n<ol>\n<li>右键点击任一属于该连接的包</li>\n<li>选择 “Follow” → “TCP Stream”</li>\n<li>会打开一个新窗口显示完整的会话内容</li>\n</ol>\n<p><strong>步骤 3：提取五元组信息</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">在包详情中查找：</span><br><span class=\"line\">┌─────────────────────────────────────┐</span><br><span class=\"line\">│ Internet Protocol Version 4         │</span><br><span class=\"line\">│ ├─ Source: 192.168.31.36            │ ← 源 IP</span><br><span class=\"line\">│ └─ Destination: 220.181.38.148      │ ← 目标 IP</span><br><span class=\"line\">│                                     │</span><br><span class=\"line\">│ Transmission Control Protocol       │</span><br><span class=\"line\">│ ├─ Source Port: 54321               │ ← 源端口</span><br><span class=\"line\">│ ├─ Destination Port: 443            │ ← 目标端口</span><br><span class=\"line\">│ └─ ...                              │</span><br><span class=\"line\">└─────────────────────────────────────┘</span><br><span class=\"line\"></span><br><span class=\"line\">协议：TCP (传输层协议号 6)</span><br><span class=\"line\"></span><br><span class=\"line\">五元组：</span><br><span class=\"line\">(192.168.31.36, 54321, 220.181.38.148, 443, TCP)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"📊-实践任务总结检查清单\"><a href=\"#📊-实践任务总结检查清单\" class=\"headerlink\" title=\"📊 实践任务总结检查清单\"></a>📊 实践任务总结检查清单</h3><p>完成以下任务后，在对应项打勾：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> ✅ 使用 Wireshark 捕获 TCP 三次握手</li>\n<li><input disabled=\"\" type=\"checkbox\"> ✅ 在 Wireshark 中识别 SYN、SYN-ACK、ACK 包</li>\n<li><input disabled=\"\" type=\"checkbox\"> ✅ 使用 Wireshark 捕获 TCP 四次挥手</li>\n<li><input disabled=\"\" type=\"checkbox\"> ✅ 在 Wireshark 中识别 FIN、ACK 包</li>\n<li><input disabled=\"\" type=\"checkbox\"> ✅ 使用 <code>Get-NetTCPConnection</code> 查看本机连接状态</li>\n<li><input disabled=\"\" type=\"checkbox\"> ✅ 观察 TIME_WAIT、ESTABLISHED 等状态</li>\n<li><input disabled=\"\" type=\"checkbox\"> ✅ 使用 Wireshark 捕获 UDP 流量（DNS 查询）</li>\n<li><input disabled=\"\" type=\"checkbox\"> ✅ 对比 TCP 和 UDP 的包结构差异</li>\n<li><input disabled=\"\" type=\"checkbox\"> ✅ 从抓包中提取五元组信息</li>\n<li><input disabled=\"\" type=\"checkbox\"> ✅ 理解 TCP 标志位的含义</li>\n</ul>\n<hr>\n<h2 id=\"巩固练习（题与复盘）\"><a href=\"#巩固练习（题与复盘）\" class=\"headerlink\" title=\"巩固练习（题与复盘）\"></a>巩固练习（题与复盘）</h2><h3 id=\"📝-练习-1-为什么有些应用更适合-UDP？举例说明\"><a href=\"#📝-练习-1-为什么有些应用更适合-UDP？举例说明\" class=\"headerlink\" title=\"📝 练习 1: 为什么有些应用更适合 UDP？举例说明\"></a>📝 练习 1: 为什么有些应用更适合 UDP？举例说明</h3><p><strong>题目：</strong> 分析为什么某些应用选择 UDP 而不是 TCP？请举出 3 个例子并说明原因。</p>\n<hr>\n<p><strong>答案：</strong></p>\n<p><strong>示例 1：实时音视频通话（Zoom、微信视频、Skype）</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">为什么用 UDP？</span><br><span class=\"line\">├─ 实时性要求：延迟必须低于 200ms 才有良好体验</span><br><span class=\"line\">├─ TCP 的问题：</span><br><span class=\"line\">│   ├─ 握手延迟：建立连接需要 1.5 RTT</span><br><span class=\"line\">│   ├─ 重传机制：丢包会触发重传，导致延迟增加</span><br><span class=\"line\">│   └─ 队头阻塞：一个包丢失会阻塞后续包</span><br><span class=\"line\">├─ UDP 的优势：</span><br><span class=\"line\">│   ├─ 无连接：立即发送，无建立延迟</span><br><span class=\"line\">│   ├─ 不重传：丢失的音视频帧直接跳过</span><br><span class=\"line\">│   └─ 低延迟：平均延迟更低</span><br><span class=\"line\">└─ 容忍度：丢失少量帧不影响通话质量（人耳/眼不敏感）</span><br><span class=\"line\"></span><br><span class=\"line\">实际表现：</span><br><span class=\"line\">丢包 1-2%：几乎无感知 ✅</span><br><span class=\"line\">丢包 5%：偶尔卡顿，但可以接受</span><br><span class=\"line\">丢包 10%：明显卡顿，但仍能通话</span><br><span class=\"line\">延迟 200ms+ with TCP：无法正常对话 ❌</span><br></pre></td></tr></table></figure>\n\n<p><strong>示例 2：在线游戏（PUBG、王者荣耀、CS:GO）</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">为什么用 UDP？</span><br><span class=\"line\">├─ 对实时性的极致要求：</span><br><span class=\"line\">│   └─ 射击游戏需要 &lt;50ms 延迟才有良好体验</span><br><span class=\"line\">├─ TCP 的问题：</span><br><span class=\"line\">│   ├─ 重传导致延迟抖动</span><br><span class=\"line\">│   ├─ 拥塞控制降低发送速率</span><br><span class=\"line\">│   └─ 玩家位置、动作的旧数据没有价值</span><br><span class=\"line\">├─ UDP 的优势：</span><br><span class=\"line\">│   ├─ 最新状态优先：旧的位置更新直接丢弃</span><br><span class=\"line\">│   ├─ 稳定低延迟：不会因丢包触发重传</span><br><span class=\"line\">│   └─ 应用层控制：游戏自己实现可靠性（关键数据）</span><br><span class=\"line\">└─ 游戏设计：</span><br><span class=\"line\">    ├─ 关键数据（伤害、击杀）：应用层确认重传</span><br><span class=\"line\">    ├─ 非关键数据（位置更新）：丢了就丢了，用下一帧</span><br><span class=\"line\">    └─ 客户端预测 + 服务器校正机制</span><br><span class=\"line\"></span><br><span class=\"line\">网络策略：</span><br><span class=\"line\">状态更新：UDP（每秒 20-60 次）</span><br><span class=\"line\">关键事件：UDP + 应用层重传确认</span><br></pre></td></tr></table></figure>\n\n<p><strong>示例 3：DNS 查询</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">为什么用 UDP？</span><br><span class=\"line\">├─ 数据量小：</span><br><span class=\"line\">│   └─ DNS 查询通常 &lt;512 字节，单个 UDP 包足够</span><br><span class=\"line\">├─ TCP 的浪费：</span><br><span class=\"line\">│   ├─ 三次握手：需要 3 个包</span><br><span class=\"line\">│   ├─ 查询请求：1 个包</span><br><span class=\"line\">│   ├─ 查询响应：1 个包</span><br><span class=\"line\">│   ├─ 四次挥手：4 个包</span><br><span class=\"line\">│   └─ 总计：9 个包</span><br><span class=\"line\">├─ UDP 的高效：</span><br><span class=\"line\">│   ├─ 查询请求：1 个包</span><br><span class=\"line\">│   ├─ 查询响应：1 个包</span><br><span class=\"line\">│   └─ 总计：2 个包</span><br><span class=\"line\">└─ 失败处理简单：</span><br><span class=\"line\">    └─ 如果无响应，客户端重新发送查询即可</span><br><span class=\"line\"></span><br><span class=\"line\">性能对比：</span><br><span class=\"line\">TCP DNS 查询：需要 1.5 RTT (握手) + 1 RTT (查询) = 2.5 RTT</span><br><span class=\"line\">UDP DNS 查询：需要 1 RTT (查询)</span><br><span class=\"line\">效率提升：60%</span><br><span class=\"line\"></span><br><span class=\"line\">注意：大响应（&gt;512 字节）会降级到 TCP</span><br></pre></td></tr></table></figure>\n\n<p><strong>示例 4：流媒体直播（IPTV、网络直播）</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">为什么用 UDP（或 RTP over UDP）？</span><br><span class=\"line\">├─ 实时性：直播延迟通常 2-5 秒</span><br><span class=\"line\">├─ TCP 的问题：</span><br><span class=\"line\">│   ├─ 丢包重传会增加延迟</span><br><span class=\"line\">│   ├─ 观众看到的画面会越来越延迟</span><br><span class=\"line\">│   └─ 缓冲区积压</span><br><span class=\"line\">├─ UDP 的优势：</span><br><span class=\"line\">│   ├─ 丢失几帧不影响观看体验</span><br><span class=\"line\">│   ├─ 保持稳定的延迟</span><br><span class=\"line\">│   └─ 支持多播（一对多）</span><br><span class=\"line\">└─ 容错机制：</span><br><span class=\"line\">    ├─ 视频编码：I 帧、P 帧冗余</span><br><span class=\"line\">    ├─ FEC（前向纠错）</span><br><span class=\"line\">    └─ 视频缓冲</span><br><span class=\"line\"></span><br><span class=\"line\">多播优势：</span><br><span class=\"line\">服务器发送 1 份数据 → 网络设备复制 → 多个观众接收</span><br><span class=\"line\">TCP 无法实现多播</span><br></pre></td></tr></table></figure>\n\n<hr>\n<p><strong>总结：UDP 适用场景的共同特点</strong></p>\n<table>\n<thead>\n<tr>\n<th>特点</th>\n<th>说明</th>\n<th>示例应用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>实时性要求高</strong></td>\n<td>延迟比可靠性更重要</td>\n<td>音视频通话、游戏</td>\n</tr>\n<tr>\n<td><strong>数据时效性</strong></td>\n<td>旧数据价值低</td>\n<td>游戏位置更新、直播</td>\n</tr>\n<tr>\n<td><strong>小数据量</strong></td>\n<td>单包可以容纳</td>\n<td>DNS、DHCP、NTP</td>\n</tr>\n<tr>\n<td><strong>可容忍丢包</strong></td>\n<td>丢失少量数据不影响整体</td>\n<td>视频流、语音</td>\n</tr>\n<tr>\n<td><strong>需要广播&#x2F;多播</strong></td>\n<td>一对多通信</td>\n<td>IPTV、局域网发现</td>\n</tr>\n<tr>\n<td><strong>应用层自己实现可靠性</strong></td>\n<td>对关键数据选择性确认</td>\n<td>QUIC、游戏协议</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"📝-练习-2-从抓包中提取一个-TCP-会话的五元组\"><a href=\"#📝-练习-2-从抓包中提取一个-TCP-会话的五元组\" class=\"headerlink\" title=\"📝 练习 2: 从抓包中提取一个 TCP 会话的五元组\"></a>📝 练习 2: 从抓包中提取一个 TCP 会话的五元组</h3><p><strong>题目：</strong> 假设在 Wireshark 中捕获了以下 TCP 包，请提取五元组信息。</p>\n<p><strong>抓包信息：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Frame 100: 74 bytes on wire</span><br><span class=\"line\">Ethernet II</span><br><span class=\"line\">├─ Destination: 38:3d:5b:0c:92:1c</span><br><span class=\"line\">├─ Source: c8:15:4e:a8:d3:fb</span><br><span class=\"line\">└─ Type: IPv4 (0x0800)</span><br><span class=\"line\"></span><br><span class=\"line\">Internet Protocol Version 4</span><br><span class=\"line\">├─ Source: 192.168.31.36</span><br><span class=\"line\">├─ Destination: 220.181.38.148</span><br><span class=\"line\">├─ Protocol: TCP (6)</span><br><span class=\"line\">└─ ...</span><br><span class=\"line\"></span><br><span class=\"line\">Transmission Control Protocol</span><br><span class=\"line\">├─ Source Port: 54321</span><br><span class=\"line\">├─ Destination Port: 443</span><br><span class=\"line\">├─ Sequence Number: 1000</span><br><span class=\"line\">├─ Acknowledgment Number: 2000</span><br><span class=\"line\">├─ Flags: 0x018 (PSH, ACK)</span><br><span class=\"line\">└─ ...</span><br></pre></td></tr></table></figure>\n\n<hr>\n<p><strong>答案：</strong></p>\n<p><strong>提取的五元组：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">┌─────────────────────────────────────┐</span><br><span class=\"line\">│ TCP 连接五元组                      │</span><br><span class=\"line\">├─────────────────────────────────────┤</span><br><span class=\"line\">│ ① 源 IP 地址:    192.168.31.36      │ ← 发送方 IP</span><br><span class=\"line\">│ ② 源端口:        54321              │ ← 发送方端口（动态端口）</span><br><span class=\"line\">│ ③ 目标 IP 地址:  220.181.38.148     │ ← 接收方 IP（百度）</span><br><span class=\"line\">│ ④ 目标端口:      443                │ ← 接收方端口（HTTPS）</span><br><span class=\"line\">│ ⑤ 传输层协议:    TCP (6)            │ ← 协议类型</span><br><span class=\"line\">└─────────────────────────────────────┘</span><br><span class=\"line\"></span><br><span class=\"line\">五元组表示：</span><br><span class=\"line\">(192.168.31.36:54321, 220.181.38.148:443, TCP)</span><br></pre></td></tr></table></figure>\n\n<p><strong>字段解释：</strong></p>\n<table>\n<thead>\n<tr>\n<th>字段</th>\n<th>值</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>源 IP</strong></td>\n<td>192.168.31.36</td>\n<td>本机 IP（私有地址）</td>\n</tr>\n<tr>\n<td><strong>源端口</strong></td>\n<td>54321</td>\n<td>客户端随机分配的端口（49152-65535 范围）</td>\n</tr>\n<tr>\n<td><strong>目标 IP</strong></td>\n<td>220.181.38.148</td>\n<td>百度服务器 IP</td>\n</tr>\n<tr>\n<td><strong>目标端口</strong></td>\n<td>443</td>\n<td>HTTPS 服务（标准端口）</td>\n</tr>\n<tr>\n<td><strong>协议</strong></td>\n<td>TCP (6)</td>\n<td>传输层协议（IP 协议号 6）</td>\n</tr>\n</tbody></table>\n<p><strong>连接方向判断：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">客户端 → 服务器：</span><br><span class=\"line\">└─ 源端口 &gt; 1024（动态端口）</span><br><span class=\"line\">   目标端口 = 443（标准服务端口）</span><br><span class=\"line\">   → 这是客户端发起的连接</span><br><span class=\"line\"></span><br><span class=\"line\">服务器 → 客户端的回复包：</span><br><span class=\"line\">└─ 源端口 = 443</span><br><span class=\"line\">   目标端口 = 54321</span><br><span class=\"line\">   → 五元组相同（但源和目标交换）</span><br></pre></td></tr></table></figure>\n\n<p><strong>五元组的唯一性：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">场景：同时访问多个 HTTPS 网站</span><br><span class=\"line\"></span><br><span class=\"line\">连接 1: (192.168.31.36:54321, 220.181.38.148:443, TCP) → 百度</span><br><span class=\"line\">连接 2: (192.168.31.36:54322, 172.217.160.142:443, TCP) → Google</span><br><span class=\"line\">连接 3: (192.168.31.36:54323, 220.181.38.148:443, TCP) → 百度新连接</span><br><span class=\"line\"></span><br><span class=\"line\">虽然有相同的源 IP、目标 IP、目标端口</span><br><span class=\"line\">但源端口不同 → 五元组不同 → 不同的连接</span><br></pre></td></tr></table></figure>\n\n<p><strong>在 Wireshark 中快速查看五元组：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">方法 1：查看包详情</span><br><span class=\"line\">展开 IP 层 → 看源和目标 IP</span><br><span class=\"line\">展开 TCP 层 → 看源和目标端口</span><br><span class=\"line\"></span><br><span class=\"line\">方法 2：使用统计功能</span><br><span class=\"line\">Statistics → Conversations → TCP</span><br><span class=\"line\">会列出所有 TCP 会话及其五元组信息</span><br><span class=\"line\"></span><br><span class=\"line\">方法 3：使用过滤器</span><br><span class=\"line\">tcp.stream eq 0  # 查看第一个 TCP 流的所有包</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"📝-练习-3-分析异常-TCP-连接状态\"><a href=\"#📝-练习-3-分析异常-TCP-连接状态\" class=\"headerlink\" title=\"📝 练习 3: 分析异常 TCP 连接状态\"></a>📝 练习 3: 分析异常 TCP 连接状态</h3><p><strong>题目：</strong> 服务器上出现大量 CLOSE_WAIT 状态的连接，可能是什么原因？如何排查？</p>\n<hr>\n<p><strong>答案：</strong></p>\n<p><strong>CLOSE_WAIT 状态说明：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">TCP 四次挥手中的状态：</span><br><span class=\"line\">1. 客户端发送 FIN → 服务器收到</span><br><span class=\"line\">2. 服务器回复 ACK → 进入 CLOSE_WAIT 状态 ⚠️</span><br><span class=\"line\">3. 服务器应该发送 FIN → 完成关闭</span><br><span class=\"line\">4. 但如果应用程序没有关闭 socket → 一直停留在 CLOSE_WAIT</span><br><span class=\"line\"></span><br><span class=\"line\">正常情况：CLOSE_WAIT 状态应该很快（几毫秒内）过渡到 LAST_ACK</span><br><span class=\"line\">异常情况：大量连接长时间停留在 CLOSE_WAIT → 应用程序问题</span><br></pre></td></tr></table></figure>\n\n<p><strong>可能的原因：</strong></p>\n<p><strong>原因 1：应用程序未正确关闭 socket</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 错误的代码示例（Python）</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">handle_client</span>(<span class=\"params\">conn</span>):</span><br><span class=\"line\">    data = conn.recv(<span class=\"number\">1024</span>)</span><br><span class=\"line\">    process_data(data)</span><br><span class=\"line\">    <span class=\"comment\"># ❌ 忘记调用 conn.close()</span></span><br><span class=\"line\">    <span class=\"comment\"># 导致连接一直停留在 CLOSE_WAIT</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 正确的代码</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">handle_client</span>(<span class=\"params\">conn</span>):</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        data = conn.recv(<span class=\"number\">1024</span>)</span><br><span class=\"line\">        process_data(data)</span><br><span class=\"line\">    <span class=\"keyword\">finally</span>:</span><br><span class=\"line\">        conn.close()  <span class=\"comment\"># ✅ 确保关闭</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>原因 2：应用程序异常退出</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">场景：</span><br><span class=\"line\">1. 客户端正常关闭连接（发送 FIN）</span><br><span class=\"line\">2. 服务器接收到 FIN，回复 ACK（进入 CLOSE_WAIT）</span><br><span class=\"line\">3. 应用程序处理数据时抛出异常</span><br><span class=\"line\">4. 异常未被捕获，线程/进程崩溃</span><br><span class=\"line\">5. socket 未被正确关闭 → CLOSE_WAIT 泄漏</span><br></pre></td></tr></table></figure>\n\n<p><strong>原因 3：应用程序逻辑阻塞</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">场景：</span><br><span class=\"line\">1. 客户端关闭连接</span><br><span class=\"line\">2. 服务器进入 CLOSE_WAIT</span><br><span class=\"line\">3. 应用程序正在执行长时间操作（数据库查询、文件 I/O）</span><br><span class=\"line\">4. 应用程序尚未检测到连接关闭</span><br><span class=\"line\">5. 长时间停留在 CLOSE_WAIT</span><br><span class=\"line\"></span><br><span class=\"line\">问题：缺少超时机制或定期检查连接状态</span><br></pre></td></tr></table></figure>\n\n<p><strong>排查步骤：</strong></p>\n<p><strong>步骤 1：查看 CLOSE_WAIT 数量</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Windows</span></span><br><span class=\"line\"><span class=\"built_in\">Get-NetTCPConnection</span> <span class=\"literal\">-State</span> CloseWait | <span class=\"built_in\">Measure-Object</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Linux</span></span><br><span class=\"line\">netstat <span class=\"literal\">-an</span> | grep CLOSE_WAIT | wc <span class=\"literal\">-l</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 2：找出占用 CLOSE_WAIT 的进程</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Windows</span></span><br><span class=\"line\"><span class=\"built_in\">Get-NetTCPConnection</span> <span class=\"literal\">-State</span> CloseWait |</span><br><span class=\"line\">    <span class=\"built_in\">Select-Object</span> LocalPort, RemoteAddress, RemotePort, OwningProcess |</span><br><span class=\"line\">    <span class=\"built_in\">ForEach-Object</span> &#123;</span><br><span class=\"line\">        <span class=\"variable\">$_</span> | <span class=\"built_in\">Add-Member</span> <span class=\"literal\">-NotePropertyName</span> ProcessName <span class=\"literal\">-NotePropertyValue</span> (<span class=\"built_in\">Get-Process</span> <span class=\"literal\">-Id</span> <span class=\"variable\">$_</span>.OwningProcess).ProcessName <span class=\"literal\">-PassThru</span></span><br><span class=\"line\">    &#125; | <span class=\"built_in\">Format-Table</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Linux</span></span><br><span class=\"line\">netstat <span class=\"literal\">-anp</span> | grep CLOSE_WAIT</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 3：检查应用程序日志</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">查找：</span><br><span class=\"line\">✅ 异常堆栈（未捕获的异常）</span><br><span class=\"line\">✅ 连接关闭日志（是否存在）</span><br><span class=\"line\">✅ 资源泄漏相关警告</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 4：使用 strace&#x2F;Process Monitor 跟踪</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Linux: 跟踪系统调用</span></span><br><span class=\"line\">strace -p &lt;PID&gt; -e trace=close,shutdown</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Windows: 使用 Process Monitor</span></span><br><span class=\"line\"><span class=\"comment\"># 过滤 TCP Close 操作</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>解决方案：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">✅ 代码层面：</span><br><span class=\"line\">   ├─ 使用 try-finally 确保 socket 关闭</span><br><span class=\"line\">   ├─ 使用 with 语句（Python）或 using（C#）</span><br><span class=\"line\">   ├─ 设置 socket 超时</span><br><span class=\"line\">   └─ 捕获并处理所有异常</span><br><span class=\"line\"></span><br><span class=\"line\">✅ 架构层面：</span><br><span class=\"line\">   ├─ 使用连接池管理连接</span><br><span class=\"line\">   ├─ 实现心跳检测机制</span><br><span class=\"line\">   ├─ 设置空闲连接超时</span><br><span class=\"line\">   └─ 监控 CLOSE_WAIT 数量，告警</span><br><span class=\"line\"></span><br><span class=\"line\">✅ 系统层面（临时措施）：</span><br><span class=\"line\">   ├─ 重启应用程序释放连接</span><br><span class=\"line\">   ├─ 调整 TCP 参数（不推荐，治标不治本）</span><br><span class=\"line\">   └─ 增加文件描述符限制</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"📝-练习-4-理解-TCP-序列号\"><a href=\"#📝-练习-4-理解-TCP-序列号\" class=\"headerlink\" title=\"📝 练习 4: 理解 TCP 序列号\"></a>📝 练习 4: 理解 TCP 序列号</h3><p><strong>题目：</strong> 三次握手时，客户端发送 SYN (Seq&#x3D;1000)，服务器回复 SYN-ACK (Seq&#x3D;2000, Ack&#x3D;1001)。客户端接下来应该发送什么？如果客户端要发送 100 字节数据，序列号如何变化？</p>\n<hr>\n<p><strong>答案：</strong></p>\n<p><strong>第三次握手（客户端发送）：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">TCP 报文：</span><br><span class=\"line\">├─ Flags: ACK = 1</span><br><span class=\"line\">├─ Seq = 1001  ← 按服务器期望的序号</span><br><span class=\"line\">├─ Ack = 2001  ← 服务器 Seq + 1</span><br><span class=\"line\">└─ Data: 无（或者携带应用层数据）</span><br><span class=\"line\"></span><br><span class=\"line\">解释：</span><br><span class=\"line\">服务器的 Ack=1001 表示&quot;期望收到 Seq=1001 的数据&quot;</span><br><span class=\"line\">所以客户端下一个包的 Seq 必须是 1001</span><br></pre></td></tr></table></figure>\n\n<p><strong>发送 100 字节数据后：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">数据包 1：</span><br><span class=\"line\">├─ Seq = 1001</span><br><span class=\"line\">├─ Ack = 2001</span><br><span class=\"line\">├─ Data: 100 字节</span><br><span class=\"line\">└─ 实际占用序列号：1001-1100</span><br><span class=\"line\"></span><br><span class=\"line\">服务器回复 ACK：</span><br><span class=\"line\">├─ Seq = 2001（服务器还没发数据）</span><br><span class=\"line\">├─ Ack = 1101  ← 1001 + 100 = 1101</span><br><span class=\"line\">└─ 含义：&quot;我收到了 1001-1100，期望下一个是 1101&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">客户端下一个包：</span><br><span class=\"line\">├─ Seq = 1101  ← 必须从 1101 开始</span><br><span class=\"line\">└─ ...</span><br></pre></td></tr></table></figure>\n\n<p><strong>序列号计算规则：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">规则：</span><br><span class=\"line\">1. 初始序列号（ISN）：SYN 包中协商</span><br><span class=\"line\">2. 数据传输：Seq 增加 = 发送的字节数</span><br><span class=\"line\">3. ACK 确认：Ack = 对方 Seq + 对方数据字节数</span><br><span class=\"line\">4. SYN 和 FIN 各占用 1 个序列号（虽然不传输实际数据）</span><br><span class=\"line\"></span><br><span class=\"line\">示例流程：</span><br><span class=\"line\">┌──────────────────────────────────────┐</span><br><span class=\"line\">│ 客户端                  服务器        │</span><br><span class=\"line\">├──────────────────────────────────────┤</span><br><span class=\"line\">│ SYN (Seq=1000)      →                │</span><br><span class=\"line\">│                     ← SYN-ACK        │</span><br><span class=\"line\">│                       (Seq=2000,     │</span><br><span class=\"line\">│                        Ack=1001)     │</span><br><span class=\"line\">│ ACK (Seq=1001,      →                │</span><br><span class=\"line\">│      Ack=2001)                       │</span><br><span class=\"line\">│ ─────── 连接建立 ────────             │</span><br><span class=\"line\">│ PSH,ACK (Seq=1001,  →                │</span><br><span class=\"line\">│          Ack=2001,                   │</span><br><span class=\"line\">│          Len=100)                    │</span><br><span class=\"line\">│                     ← ACK            │</span><br><span class=\"line\">│                       (Seq=2001,     │</span><br><span class=\"line\">│                        Ack=1101)     │</span><br><span class=\"line\">│ PSH,ACK (Seq=1101,  →                │</span><br><span class=\"line\">│          Ack=2001,                   │</span><br><span class=\"line\">│          Len=50)                     │</span><br><span class=\"line\">│                     ← ACK            │</span><br><span class=\"line\">│                       (Seq=2001,     │</span><br><span class=\"line\">│                        Ack=1151)     │</span><br><span class=\"line\">└──────────────────────────────────────┘</span><br><span class=\"line\"></span><br><span class=\"line\">注意：</span><br><span class=\"line\">- SYN 占用 1 个序列号（1000 → 1001）</span><br><span class=\"line\">- 100 字节数据占用 100 个序列号（1001 → 1101）</span><br><span class=\"line\">- 50 字节数据占用 50 个序列号（1101 → 1151）</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"评估标准（达成判定）\"><a href=\"#评估标准（达成判定）\" class=\"headerlink\" title=\"评估标准（达成判定）\"></a>评估标准（达成判定）</h2><ul>\n<li>✅ 能准确解释握手&#x2F;挥手报文字段及顺序</li>\n<li>✅ 能清晰区分 TCP 与 UDP 的差异</li>\n</ul>\n<h2 id=\"学习成果达成情况\"><a href=\"#学习成果达成情况\" class=\"headerlink\" title=\"学习成果达成情况\"></a>学习成果达成情况</h2><h3 id=\"📊-实践任务完成记录\"><a href=\"#📊-实践任务完成记录\" class=\"headerlink\" title=\"📊 实践任务完成记录\"></a>📊 实践任务完成记录</h3><h4 id=\"任务-1-查看本机-TCP-连接状态-✅\"><a href=\"#任务-1-查看本机-TCP-连接状态-✅\" class=\"headerlink\" title=\"任务 1: 查看本机 TCP 连接状态 ✅\"></a><strong>任务 1: 查看本机 TCP 连接状态</strong> ✅</h4><p><strong>执行命令：</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Get-NetTCPConnection</span> | <span class=\"built_in\">Group-Object</span> <span class=\"literal\">-Property</span> State | <span class=\"built_in\">Sort-Object</span> Count <span class=\"literal\">-Descending</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>输出结果：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Count Name        说明</span><br><span class=\"line\">----- ----        -----</span><br><span class=\"line\">  290 Established  已建立的连接（正常数据传输）</span><br><span class=\"line\">  226 Bound        绑定到本地地址但未连接</span><br><span class=\"line\">  212 TimeWait     主动关闭方等待 2MSL</span><br><span class=\"line\">   61 Listen       监听状态（服务器等待连接）</span><br><span class=\"line\">   29 CloseWait    被动关闭方，等待应用程序关闭 ⚠️</span><br><span class=\"line\">    2 SynSent      已发送 SYN，等待响应</span><br><span class=\"line\">    1 FinWait1     已发送 FIN，等待 ACK</span><br></pre></td></tr></table></figure>\n\n<p><strong>关键发现：</strong></p>\n<ol>\n<li><p><strong>Established (290 个)</strong> - 正常</p>\n<ul>\n<li>主要是本地进程间通信（127.0.0.1）</li>\n<li>部分是与外网服务器的连接</li>\n</ul>\n</li>\n<li><p><strong>TimeWait (212 个)</strong> - 正常</p>\n<ul>\n<li>主动关闭连接后的等待状态</li>\n<li>说明系统频繁建立和关闭连接</li>\n<li>这是正常现象，会在 2MSL 后自动清理</li>\n</ul>\n</li>\n<li><p><strong>CloseWait (29 个)</strong> - 需要关注 ⚠️</p>\n<ul>\n<li>表示远程端已关闭连接</li>\n<li>但本地应用程序尚未关闭 socket</li>\n<li>如果数量持续增长，可能存在连接泄漏</li>\n</ul>\n</li>\n</ol>\n<p><strong>示例连接分析：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">五元组示例 1 (本地通信):</span><br><span class=\"line\">├─ 源 IP: 127.0.0.1</span><br><span class=\"line\">├─ 源端口: 64498</span><br><span class=\"line\">├─ 目标 IP: 127.0.0.1</span><br><span class=\"line\">├─ 目标端口: 64497</span><br><span class=\"line\">├─ 协议: TCP</span><br><span class=\"line\">└─ 状态: ESTABLISHED</span><br><span class=\"line\"></span><br><span class=\"line\">五元组示例 2 (外网连接):</span><br><span class=\"line\">├─ 源 IP: 192.168.31.36 (本机)</span><br><span class=\"line\">├─ 源端口: 63283</span><br><span class=\"line\">├─ 目标 IP: 209.141.48.237 (外网服务器)</span><br><span class=\"line\">├─ 目标端口: 443 (HTTPS)</span><br><span class=\"line\">├─ 协议: TCP</span><br><span class=\"line\">└─ 状态: ESTABLISHED</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"任务-2-使用-Wireshark-观察-TCP-三次握手-待完成\"><a href=\"#任务-2-使用-Wireshark-观察-TCP-三次握手-待完成\" class=\"headerlink\" title=\"任务 2: 使用 Wireshark 观察 TCP 三次握手 (待完成)\"></a><strong>任务 2: 使用 Wireshark 观察 TCP 三次握手</strong> (待完成)</h4><p><strong>步骤：</strong></p>\n<ol>\n<li>✅ 打开 Wireshark，选择网络接口</li>\n<li>✅ 设置过滤器：<code>tcp.flags.syn==1 or tcp.flags.fin==1</code></li>\n<li>✅ 访问网站：<code>curl http://example.com</code></li>\n<li>✅ 停止抓包并分析</li>\n</ol>\n<p><strong>预期观察到：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">三次握手：</span><br><span class=\"line\">1. [SYN] 客户端 → 服务器</span><br><span class=\"line\">   ├─ Seq = X (初始序列号)</span><br><span class=\"line\">   ├─ Ack = 0</span><br><span class=\"line\">   └─ Flags: SYN</span><br><span class=\"line\"></span><br><span class=\"line\">2. [SYN, ACK] 服务器 → 客户端</span><br><span class=\"line\">   ├─ Seq = Y (服务器初始序列号)</span><br><span class=\"line\">   ├─ Ack = X + 1</span><br><span class=\"line\">   └─ Flags: SYN, ACK</span><br><span class=\"line\"></span><br><span class=\"line\">3. [ACK] 客户端 → 服务器</span><br><span class=\"line\">   ├─ Seq = X + 1</span><br><span class=\"line\">   ├─ Ack = Y + 1</span><br><span class=\"line\">   └─ Flags: ACK</span><br><span class=\"line\"></span><br><span class=\"line\">连接建立！双方进入 ESTABLISHED 状态</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"任务-3-使用-Wireshark-观察-TCP-四次挥手-待完成\"><a href=\"#任务-3-使用-Wireshark-观察-TCP-四次挥手-待完成\" class=\"headerlink\" title=\"任务 3: 使用 Wireshark 观察 TCP 四次挥手 (待完成)\"></a><strong>任务 3: 使用 Wireshark 观察 TCP 四次挥手</strong> (待完成)</h4><p><strong>预期观察到：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">四次挥手：</span><br><span class=\"line\">1. [FIN, ACK] 客户端 → 服务器</span><br><span class=\"line\">   ├─ Seq = M</span><br><span class=\"line\">   ├─ Ack = N</span><br><span class=\"line\">   └─ Flags: FIN, ACK</span><br><span class=\"line\"></span><br><span class=\"line\">2. [ACK] 服务器 → 客户端</span><br><span class=\"line\">   ├─ Seq = N</span><br><span class=\"line\">   ├─ Ack = M + 1</span><br><span class=\"line\">   └─ Flags: ACK</span><br><span class=\"line\"></span><br><span class=\"line\">3. [FIN, ACK] 服务器 → 客户端</span><br><span class=\"line\">   ├─ Seq = N</span><br><span class=\"line\">   ├─ Ack = M + 1</span><br><span class=\"line\">   └─ Flags: FIN, ACK</span><br><span class=\"line\"></span><br><span class=\"line\">4. [ACK] 客户端 → 服务器</span><br><span class=\"line\">   ├─ Seq = M + 1</span><br><span class=\"line\">   ├─ Ack = N + 1</span><br><span class=\"line\">   └─ Flags: ACK</span><br><span class=\"line\"></span><br><span class=\"line\">连接关闭！</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"任务-4-UDP-流量对比-待完成\"><a href=\"#任务-4-UDP-流量对比-待完成\" class=\"headerlink\" title=\"任务 4: UDP 流量对比 (待完成)\"></a><strong>任务 4: UDP 流量对比</strong> (待完成)</h4><p><strong>DNS 查询示例：</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 在 Wireshark 中设置过滤器：dns</span></span><br><span class=\"line\">nslookup baidu.com <span class=\"number\">8.8</span>.<span class=\"number\">8.8</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>预期对比：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">TCP 连接（访问网站）：</span><br><span class=\"line\">├─ 三次握手：3 个包</span><br><span class=\"line\">├─ 数据传输：N 个包（每个都有 ACK）</span><br><span class=\"line\">├─ 四次挥手：4 个包</span><br><span class=\"line\">└─ 总计：至少 7+ 个包</span><br><span class=\"line\"></span><br><span class=\"line\">UDP 查询（DNS）：</span><br><span class=\"line\">├─ 查询请求：1 个包</span><br><span class=\"line\">├─ 查询响应：1 个包</span><br><span class=\"line\">└─ 总计：2 个包</span><br><span class=\"line\"></span><br><span class=\"line\">UDP 优势：</span><br><span class=\"line\">✅ 无建立连接开销</span><br><span class=\"line\">✅ 数据包少</span><br><span class=\"line\">✅ 延迟低</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"💡-核心知识点掌握\"><a href=\"#💡-核心知识点掌握\" class=\"headerlink\" title=\"💡 核心知识点掌握\"></a>💡 核心知识点掌握</h3><h4 id=\"1-TCP-三次握手-✅\"><a href=\"#1-TCP-三次握手-✅\" class=\"headerlink\" title=\"1. TCP 三次握手 ✅\"></a><strong>1. TCP 三次握手</strong> ✅</h4><p><strong>为什么需要三次？</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">目的：</span><br><span class=\"line\">✅ 确认双方收发能力</span><br><span class=\"line\">✅ 协商初始序列号（ISN）</span><br><span class=\"line\">✅ 协商 TCP 参数（窗口大小、MSS）</span><br><span class=\"line\">✅ 防止旧连接请求导致的资源浪费</span><br><span class=\"line\"></span><br><span class=\"line\">两次握手的问题：</span><br><span class=\"line\">❌ 无法防止旧的重复连接请求</span><br><span class=\"line\">❌ 服务器无法确认客户端的接收能力</span><br><span class=\"line\"></span><br><span class=\"line\">四次握手：</span><br><span class=\"line\">❌ 没有必要，三次已经足够</span><br></pre></td></tr></table></figure>\n\n<p><strong>流程记忆口诀：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">客户端：&quot;你好，我想连接&quot; (SYN)</span><br><span class=\"line\">服务器：&quot;好的，我也想连接&quot; (SYN-ACK)</span><br><span class=\"line\">客户端：&quot;收到，开始吧&quot; (ACK)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"2-TCP-四次挥手-✅\"><a href=\"#2-TCP-四次挥手-✅\" class=\"headerlink\" title=\"2. TCP 四次挥手 ✅\"></a><strong>2. TCP 四次挥手</strong> ✅</h4><p><strong>为什么需要四次？</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">原因：</span><br><span class=\"line\">✅ TCP 是全双工通信</span><br><span class=\"line\">✅ 每个方向需要独立关闭</span><br><span class=\"line\">✅ 确保双方数据都发送完毕</span><br><span class=\"line\"></span><br><span class=\"line\">场景说明：</span><br><span class=\"line\">1. 客户端：&quot;我没数据要发了&quot; (FIN)</span><br><span class=\"line\">2. 服务器：&quot;知道了&quot; (ACK)</span><br><span class=\"line\">   [服务器可能还有数据要发]</span><br><span class=\"line\">3. 服务器：&quot;我也发完了&quot; (FIN)</span><br><span class=\"line\">4. 客户端：&quot;知道了，再见&quot; (ACK)</span><br></pre></td></tr></table></figure>\n\n<p><strong>为什么不能三次？</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">如果合并步骤 2 和 3：</span><br><span class=\"line\">客户端发送 FIN 后，服务器可能还有数据要发送</span><br><span class=\"line\">如果立即回复 FIN，就无法发送剩余数据</span><br><span class=\"line\">所以需要先 ACK（我知道了），等发完数据再 FIN（我也关闭）</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"3-TIME-WAIT-状态的意义-✅\"><a href=\"#3-TIME-WAIT-状态的意义-✅\" class=\"headerlink\" title=\"3. TIME_WAIT 状态的意义 ✅\"></a><strong>3. TIME_WAIT 状态的意义</strong> ✅</h4><p><strong>为什么需要等待 2MSL？</strong></p>\n<p><strong>原因 1：确保最后的 ACK 能到达</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">场景：</span><br><span class=\"line\">1. 客户端发送最后的 ACK</span><br><span class=\"line\">2. 如果 ACK 丢失</span><br><span class=\"line\">3. 服务器超时重传 FIN</span><br><span class=\"line\">4. 客户端需要在 TIME_WAIT 状态接收并重发 ACK</span><br><span class=\"line\"></span><br><span class=\"line\">如果没有 TIME_WAIT：</span><br><span class=\"line\">客户端已关闭 → 收到服务器的 FIN 重传 → 发送 RST</span><br><span class=\"line\">→ 服务器异常关闭</span><br></pre></td></tr></table></figure>\n\n<p><strong>原因 2：防止旧连接干扰</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">场景：</span><br><span class=\"line\">1. 连接关闭后，网络中可能还有延迟的旧数据包</span><br><span class=\"line\">2. 如果立即使用相同的五元组建立新连接</span><br><span class=\"line\">3. 旧数据包可能被新连接接收</span><br><span class=\"line\">4. 导致数据混乱</span><br><span class=\"line\"></span><br><span class=\"line\">2MSL 确保：</span><br><span class=\"line\">所有旧数据包都已消失（MSL = 30秒 或 2分钟）</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"4-TCP-vs-UDP-的选择-✅\"><a href=\"#4-TCP-vs-UDP-的选择-✅\" class=\"headerlink\" title=\"4. TCP vs UDP 的选择 ✅\"></a><strong>4. TCP vs UDP 的选择</strong> ✅</h4><p><strong>决策树：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">需要可靠传输？</span><br><span class=\"line\">├─ 是 → 需要保证数据完整性？</span><br><span class=\"line\">│   ├─ 是 → 使用 TCP ✅</span><br><span class=\"line\">│   │   └─ 场景：文件传输、网页、邮件</span><br><span class=\"line\">│   └─ 否 → 可以容忍少量丢失？</span><br><span class=\"line\">│       ├─ 是 → 使用 UDP ✅</span><br><span class=\"line\">│       │   └─ 场景：实时音视频、游戏</span><br><span class=\"line\">│       └─ 否 → 使用 TCP</span><br><span class=\"line\">└─ 否 → 实时性要求高？</span><br><span class=\"line\">    ├─ 是 → 使用 UDP ✅</span><br><span class=\"line\">    │   └─ 场景：DNS、NTP、DHCP</span><br><span class=\"line\">    └─ 否 → 根据其他因素决定</span><br></pre></td></tr></table></figure>\n\n<p><strong>快速判断表：</strong></p>\n<table>\n<thead>\n<tr>\n<th>需求</th>\n<th>选择</th>\n<th>典型应用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>文件必须完整</td>\n<td>TCP</td>\n<td>HTTP 下载、FTP</td>\n</tr>\n<tr>\n<td>网页必须完整显示</td>\n<td>TCP</td>\n<td>HTTPS、HTTP</td>\n</tr>\n<tr>\n<td>邮件不能丢失</td>\n<td>TCP</td>\n<td>SMTP、POP3、IMAP</td>\n</tr>\n<tr>\n<td>视频通话（实时）</td>\n<td>UDP</td>\n<td>Zoom、微信视频</td>\n</tr>\n<tr>\n<td>游戏（低延迟）</td>\n<td>UDP</td>\n<td>在线游戏</td>\n</tr>\n<tr>\n<td>快速查询</td>\n<td>UDP</td>\n<td>DNS、NTP</td>\n</tr>\n<tr>\n<td>直播（实时）</td>\n<td>UDP</td>\n<td>RTMP、HLS</td>\n</tr>\n</tbody></table>\n<hr>\n<h4 id=\"5-五元组的作用-✅\"><a href=\"#5-五元组的作用-✅\" class=\"headerlink\" title=\"5. 五元组的作用 ✅\"></a><strong>5. 五元组的作用</strong> ✅</h4><p><strong>唯一标识一个连接：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">五元组 = (源IP, 源端口, 目标IP, 目标端口, 协议)</span><br><span class=\"line\"></span><br><span class=\"line\">系统如何区分多个连接：</span><br><span class=\"line\">场景：同时访问 10 个网站，都是 HTTPS (443)</span><br><span class=\"line\"></span><br><span class=\"line\">连接 1: (192.168.31.36, 54321, IP1, 443, TCP)</span><br><span class=\"line\">连接 2: (192.168.31.36, 54322, IP2, 443, TCP)</span><br><span class=\"line\">连接 3: (192.168.31.36, 54323, IP3, 443, TCP)</span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">虽然源IP、目标端口、协议都相同</span><br><span class=\"line\">但源端口不同 → 五元组不同 → 不同的连接</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"🔍-实践收获与反思\"><a href=\"#🔍-实践收获与反思\" class=\"headerlink\" title=\"🔍 实践收获与反思\"></a>🔍 实践收获与反思</h3><p><strong>关键理解：</strong></p>\n<ol>\n<li><p><strong>TCP 的可靠性是有代价的</strong></p>\n<ul>\n<li>三次握手增加延迟（1.5 RTT）</li>\n<li>每个数据包都需要确认</li>\n<li>重传机制增加延迟</li>\n<li>适合文件传输、网页等不能出错的场景</li>\n</ul>\n</li>\n<li><p><strong>UDP 的”不可靠”是设计选择</strong></p>\n<ul>\n<li>不是缺陷，而是为了性能</li>\n<li>应用层可以选择性实现可靠性（如 QUIC）</li>\n<li>适合实时通信、快速查询等场景</li>\n</ul>\n</li>\n<li><p><strong>TIME_WAIT 不是问题，而是保护</strong></p>\n<ul>\n<li>确保连接安全关闭</li>\n<li>防止旧数据干扰新连接</li>\n<li>大量 TIME_WAIT 说明连接频繁（可以优化，但不一定是问题）</li>\n</ul>\n</li>\n<li><p><strong>CLOSE_WAIT 才需要关注</strong></p>\n<ul>\n<li>表示应用程序没有正确关闭连接</li>\n<li>可能导致连接泄漏</li>\n<li>需要检查代码逻辑</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h3 id=\"📖-与前几天学习的联系\"><a href=\"#📖-与前几天学习的联系\" class=\"headerlink\" title=\"📖 与前几天学习的联系\"></a>📖 与前几天学习的联系</h3><p><strong>Day001: OSI 模型</strong></p>\n<ul>\n<li>✅ TCP&#x2F;UDP 工作在传输层（第 4 层）</li>\n<li>✅ 负责端到端的数据传输</li>\n</ul>\n<p><strong>Day002: MAC 与 ARP</strong></p>\n<ul>\n<li>✅ 数据链路层使用 MAC 地址</li>\n<li>✅ ARP 将 IP 映射到 MAC</li>\n<li>✅ TCP 包最终封装在以太网帧中传输</li>\n</ul>\n<p><strong>Day003: IP 与路由</strong></p>\n<ul>\n<li>✅ 网络层的 IP 负责寻址和路由</li>\n<li>✅ TCP 依赖 IP 层传输数据</li>\n<li>✅ 五元组中的 IP 地址来自网络层</li>\n</ul>\n<p><strong>协议栈协作：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">应用层：HTTP/HTTPS 请求</span><br><span class=\"line\">    ↓</span><br><span class=\"line\">传输层：TCP 三次握手 + 可靠传输 ← 本次学习</span><br><span class=\"line\">    ├─ 端口号识别应用</span><br><span class=\"line\">    ├─ 序列号保证顺序</span><br><span class=\"line\">    └─ 确认号保证可靠</span><br><span class=\"line\">    ↓</span><br><span class=\"line\">网络层：IP 路由选择 (Day003)</span><br><span class=\"line\">    ├─ 查路由表</span><br><span class=\"line\">    └─ 确定下一跳</span><br><span class=\"line\">    ↓</span><br><span class=\"line\">数据链路层：ARP + MAC 地址 (Day002)</span><br><span class=\"line\">    ├─ ARP 获取 MAC</span><br><span class=\"line\">    └─ 封装以太网帧</span><br><span class=\"line\">    ↓</span><br><span class=\"line\">物理层：电信号传输</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"🎓-学习成果评估\"><a href=\"#🎓-学习成果评估\" class=\"headerlink\" title=\"🎓 学习成果评估\"></a>🎓 学习成果评估</h3><table>\n<thead>\n<tr>\n<th>评估标准</th>\n<th>达成情况</th>\n<th>证据</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>能准确解释三次握手</strong></td>\n<td>✅ 达成</td>\n<td>理解了 SYN、SYN-ACK、ACK 的作用和顺序</td>\n</tr>\n<tr>\n<td><strong>能准确解释四次挥手</strong></td>\n<td>✅ 达成</td>\n<td>理解了全双工关闭和 TIME_WAIT 的必要性</td>\n</tr>\n<tr>\n<td><strong>能区分 TCP 与 UDP</strong></td>\n<td>✅ 达成</td>\n<td>掌握了两者的特点和适用场景</td>\n</tr>\n<tr>\n<td><strong>能提取五元组</strong></td>\n<td>✅ 达成</td>\n<td>能从抓包中识别连接的五元组</td>\n</tr>\n<tr>\n<td><strong>理解 TCP 状态机</strong></td>\n<td>✅ 达成</td>\n<td>能解释各种 TCP 状态的含义</td>\n</tr>\n<tr>\n<td><strong>能分析异常连接</strong></td>\n<td>✅ 达成</td>\n<td>能判断 CLOSE_WAIT 等异常状态的原因</td>\n</tr>\n</tbody></table>\n<hr>\n<p><strong>学习日期：</strong> 2025-12-26<br><strong>完成时间：</strong> ⏰ 约 3 小时<br><strong>学习效果：</strong> ⭐⭐⭐⭐⭐ (5&#x2F;5)</p>\n<p><strong>下一步计划：</strong></p>\n<ul>\n<li>📝 Day005: 深入 HTTP&#x2F;HTTPS 协议</li>\n<li>🔍 使用 Wireshark 实际抓包验证三次握手和四次挥手</li>\n<li>💻 编写简单的 TCP 客户端和服务器程序（Python&#x2F;C#）</li>\n</ul>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day005：网络与协议基础 - DNS 工作流","url":"/post/c822c636.html","content":"<h1 id=\"Day005：网络与协议基础-DNS-工作流\"><a href=\"#Day005：网络与协议基础-DNS-工作流\" class=\"headerlink\" title=\"Day005：网络与协议基础 - DNS 工作流\"></a>Day005：网络与协议基础 - DNS 工作流</h1><ul>\n<li>日期：2025-12-29</li>\n<li>周次：第 1 周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><ul>\n<li>理解 DNS 的“分层命名 + 分布式数据库”设计，以及一次解析从本机到权威服务器的关键环节</li>\n<li>熟悉常见记录类型：A&#x2F;AAAA&#x2F;CNAME&#x2F;MX&#x2F;TXT&#x2F;NS&#x2F;SOA</li>\n<li>能在 Windows 上用 <code>nslookup</code> &#x2F; <code>Resolve-DnsName</code> 做查询，并能用 Wireshark 抓包解释一次完整的 DNS 查询与响应</li>\n<li>理解缓存与 TTL、递归与迭代、失败场景（NXDOMAIN&#x2F;SERVFAIL&#x2F;超时）含义</li>\n</ul>\n<span id=\"more\"></span>\n\n<h2 id=\"学习内容\"><a href=\"#学习内容\" class=\"headerlink\" title=\"学习内容\"></a>学习内容</h2><h3 id=\"1️⃣-DNS-在“上网”里扮演什么角色\"><a href=\"#1️⃣-DNS-在“上网”里扮演什么角色\" class=\"headerlink\" title=\"1️⃣ DNS 在“上网”里扮演什么角色\"></a>1️⃣ DNS 在“上网”里扮演什么角色</h3><p>DNS（Domain Name System）是把“人类可读的域名”映射为“机器可路由的 IP 地址”的系统。</p>\n<p>你每天打开网页时，典型顺序是：</p>\n<ol>\n<li><strong>DNS 解析</strong>：<code>www.example.com</code> → IP</li>\n<li><strong>建立连接</strong>：对该 IP 发起 TCP&#x2F;TLS&#x2F;HTTP</li>\n<li><strong>应用层交互</strong>：请求页面&#x2F;接口</li>\n</ol>\n<p>因此，DNS 的问题会表现为：</p>\n<ul>\n<li>浏览器提示“找不到服务器 &#x2F; 无法解析域名”（解析失败）</li>\n<li>Ping 不通域名，但 Ping IP 可以（DNS 问题更可能）</li>\n</ul>\n<h3 id=\"2️⃣-递归解析-vs-迭代解析（非常关键）\"><a href=\"#2️⃣-递归解析-vs-迭代解析（非常关键）\" class=\"headerlink\" title=\"2️⃣ 递归解析 vs 迭代解析（非常关键）\"></a>2️⃣ 递归解析 vs 迭代解析（非常关键）</h3><p>把角色分清楚：</p>\n<ul>\n<li><strong>客户端（Stub Resolver）</strong>：你电脑上的解析器（由系统&#x2F;浏览器调用）</li>\n<li><strong>递归解析器（Recursive Resolver）</strong>：通常是你配置的 DNS 服务器（运营商&#x2F;路由器&#x2F;公司&#x2F;公共 DNS）</li>\n<li><strong>根服务器（Root）&#x2F; 顶级域（TLD）&#x2F; 权威服务器（Authoritative）</strong>：负责逐级指引和最终回答</li>\n</ul>\n<p><strong>客户端通常发起的是“递归查询”</strong>：</p>\n<ul>\n<li>“请你给我最终答案，不要让我自己去问根&#x2F;TLD&#x2F;权威。”</li>\n</ul>\n<p><strong>递归解析器对外通常做“迭代查询”</strong>：</p>\n<ul>\n<li>先问根：“.com 的权威在哪？”</li>\n<li>再问 TLD：”example.com 的权威在哪？”</li>\n<li>再问权威：”<a href=\"http://www.example.com/\">www.example.com</a> 的 A&#x2F;AAAA 是多少？”</li>\n</ul>\n<p>你在 Wireshark 里抓包时，很多时候只能看到 <strong>客户端 ↔ 递归解析器</strong> 这一跳。</p>\n<h3 id=\"3️⃣-DNS-报文与字段：抓包时看什么\"><a href=\"#3️⃣-DNS-报文与字段：抓包时看什么\" class=\"headerlink\" title=\"3️⃣ DNS 报文与字段：抓包时看什么\"></a>3️⃣ DNS 报文与字段：抓包时看什么</h3><p>DNS 既可以走 UDP（默认 53 端口）也可以走 TCP：</p>\n<ul>\n<li><strong>UDP 53</strong>：大多数查询（快）</li>\n<li><strong>TCP 53</strong>：响应太大需要截断&#x2F;重试（TC&#x3D;1），或进行区域传送（AXFR，通常只允许内部）</li>\n</ul>\n<p>在 Wireshark 里建议重点看：</p>\n<ul>\n<li><strong>Transaction ID</strong>：查询与响应的“配对 ID”</li>\n<li><strong>Flags</strong>：<ul>\n<li><code>QR</code>（Query&#x2F;Response）</li>\n<li><code>RD</code>（Recursion Desired，客户端希望递归）</li>\n<li><code>RA</code>（Recursion Available，服务器支持递归）</li>\n<li><code>RCODE</code>（返回码：NOERROR&#x2F;NXDOMAIN&#x2F;SERVFAIL…）</li>\n</ul>\n</li>\n<li><strong>Questions</strong>：查询的域名 + 类型（A&#x2F;AAAA…）</li>\n<li><strong>Answers</strong>：返回记录（含 TTL）</li>\n<li><strong>Authority &#x2F; Additional</strong>：权威信息、附加信息（比如 NS + glue 记录）</li>\n</ul>\n<h3 id=\"4️⃣-常见记录类型速查\"><a href=\"#4️⃣-常见记录类型速查\" class=\"headerlink\" title=\"4️⃣ 常见记录类型速查\"></a>4️⃣ 常见记录类型速查</h3><table>\n<thead>\n<tr>\n<th>类型</th>\n<th>作用</th>\n<th>你会在什么场景看到</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>A</td>\n<td>域名 → IPv4</td>\n<td>most common</td>\n</tr>\n<tr>\n<td>AAAA</td>\n<td>域名 → IPv6</td>\n<td>IPv6 环境</td>\n</tr>\n<tr>\n<td>CNAME</td>\n<td>别名 → 正式名</td>\n<td>CDN、统一入口（如 <code>www</code> 指向 <code>xxx.cdn.net</code>）</td>\n</tr>\n<tr>\n<td>MX</td>\n<td>邮件服务器</td>\n<td>邮件系统</td>\n</tr>\n<tr>\n<td>TXT</td>\n<td>文本记录</td>\n<td>SPF&#x2F;DKIM&#x2F;站点验证&#x2F;一些验证 token</td>\n</tr>\n<tr>\n<td>NS</td>\n<td>指定某域的权威 DNS</td>\n<td>委派关系</td>\n</tr>\n<tr>\n<td>SOA</td>\n<td>区域起始授权信息</td>\n<td>区域版本、刷新时间等</td>\n</tr>\n</tbody></table>\n<blockquote>\n<p>记忆要点：<strong>CNAME 不能和同名的 A&#x2F;AAAA 同时存在</strong>（同一名字要么别名，要么地址）。</p>\n</blockquote>\n<h3 id=\"5️⃣-缓存与-TTL：为什么“改了解析不生效”\"><a href=\"#5️⃣-缓存与-TTL：为什么“改了解析不生效”\" class=\"headerlink\" title=\"5️⃣ 缓存与 TTL：为什么“改了解析不生效”\"></a>5️⃣ 缓存与 TTL：为什么“改了解析不生效”</h3><p>DNS 会大量缓存：</p>\n<ul>\n<li>你的电脑可能缓存</li>\n<li>浏览器&#x2F;应用可能缓存</li>\n<li>递归解析器一定会缓存</li>\n</ul>\n<p>每条记录都带 <strong>TTL（Time To Live）</strong>，表示“缓存能保留多久”。</p>\n<p>因此：</p>\n<ul>\n<li>权威服务器更新记录后，旧缓存需要等待 TTL 过期才会刷新</li>\n<li>排查时常用方式：换一个递归解析器、清本机缓存、或者直接查询权威</li>\n</ul>\n<h2 id=\"实践任务（合法授权范围内）\"><a href=\"#实践任务（合法授权范围内）\" class=\"headerlink\" title=\"实践任务（合法授权范围内）\"></a>实践任务（合法授权范围内）</h2><blockquote>\n<p>目标：在 Windows 上完成一次 DNS A&#x2F;AAAA&#x2F;CNAME&#x2F;TXT 查询，并用 Wireshark 抓包解释一条请求与响应。</p>\n</blockquote>\n<h3 id=\"推荐练习域名清单（A-x2F-AAAA-x2F-TXT）\"><a href=\"#推荐练习域名清单（A-x2F-AAAA-x2F-TXT）\" class=\"headerlink\" title=\"推荐练习域名清单（A &#x2F; AAAA &#x2F; TXT）\"></a>推荐练习域名清单（A &#x2F; AAAA &#x2F; TXT）</h3><blockquote>\n<p>说明：不同网络&#x2F;地区&#x2F;CDN 策略会导致结果不同；如果某域名查不到 AAAA 属于正常现象（不一定是你操作错）。</p>\n</blockquote>\n<p><strong>A（IPv4）常见稳定样本：</strong></p>\n<ul>\n<li><code>example.com</code></li>\n<li><code>www.cloudflare.com</code></li>\n<li><code>www.microsoft.com</code></li>\n<li><code>www.bing.com</code></li>\n</ul>\n<p><strong>AAAA（IPv6）常见样本：</strong></p>\n<ul>\n<li><code>ipv6.google.com</code></li>\n<li><code>www.cloudflare.com</code></li>\n<li><code>one.one.one.one</code></li>\n<li><code>www.facebook.com</code></li>\n</ul>\n<p><strong>TXT（文本记录）常见样本（常含 SPF&#x2F;验证信息）：</strong></p>\n<ul>\n<li><code>google.com</code></li>\n<li><code>microsoft.com</code></li>\n<li><code>cloudflare.com</code></li>\n<li><code>github.com</code></li>\n</ul>\n<p><strong>一键复制的 PowerShell 查询示例：</strong></p>\n<ul>\n<li><code>Resolve-DnsName example.com -Type A</code></li>\n<li><code>Resolve-DnsName ipv6.google.com -Type AAAA</code></li>\n<li><code>Resolve-DnsName google.com -Type TXT</code></li>\n</ul>\n<h3 id=\"任务-1：用-nslookup-做基础查询\"><a href=\"#任务-1：用-nslookup-做基础查询\" class=\"headerlink\" title=\"任务 1：用 nslookup 做基础查询\"></a>任务 1：用 <code>nslookup</code> 做基础查询</h3><p>在 PowerShell 里执行（示例域名可换成你常用网站）：</p>\n<ul>\n<li>查询 A 记录：<ul>\n<li><code>nslookup www.bing.com</code></li>\n</ul>\n</li>\n<li>指定类型查询：<ul>\n<li><code>nslookup -type=AAAA www.bing.com</code></li>\n<li><code>nslookup -type=CNAME www.bing.com</code></li>\n<li><code>nslookup -type=TXT microsoft.com</code></li>\n</ul>\n</li>\n</ul>\n<p>记录：</p>\n<ul>\n<li>Server 是谁（你正在使用哪个递归 DNS）</li>\n<li>Name &#x2F; Address &#x2F; canonical name（CNAME）结果</li>\n</ul>\n<h3 id=\"任务-2：用-Resolve-DnsName（更强，推荐）\"><a href=\"#任务-2：用-Resolve-DnsName（更强，推荐）\" class=\"headerlink\" title=\"任务 2：用 Resolve-DnsName（更强，推荐）\"></a>任务 2：用 <code>Resolve-DnsName</code>（更强，推荐）</h3><p>PowerShell 示例：</p>\n<ul>\n<li><code>Resolve-DnsName www.bing.com</code></li>\n<li><code>Resolve-DnsName www.bing.com -Type A</code></li>\n<li><code>Resolve-DnsName www.bing.com -Type AAAA</code></li>\n<li><code>Resolve-DnsName microsoft.com -Type TXT</code></li>\n</ul>\n<p>指定某个 DNS 服务器（例如公共 DNS，只用于学习测试）：</p>\n<ul>\n<li><code>Resolve-DnsName www.bing.com -Type A -Server 1.1.1.1</code></li>\n</ul>\n<p>你可以对比不同递归解析器返回的结果是否一致、TTL 是否不同。</p>\n<h3 id=\"任务-3：清理本机-DNS-缓存并复查\"><a href=\"#任务-3：清理本机-DNS-缓存并复查\" class=\"headerlink\" title=\"任务 3：清理本机 DNS 缓存并复查\"></a>任务 3：清理本机 DNS 缓存并复查</h3><p>执行：</p>\n<ul>\n<li><code>ipconfig /displaydns</code>（查看缓存）</li>\n<li><code>ipconfig /flushdns</code>（清空缓存）</li>\n</ul>\n<p>再执行一遍 <code>Resolve-DnsName</code>，观察输出是否变化。</p>\n<h3 id=\"任务-4：Wireshark-抓包并解释一次查询\"><a href=\"#任务-4：Wireshark-抓包并解释一次查询\" class=\"headerlink\" title=\"任务 4：Wireshark 抓包并解释一次查询\"></a>任务 4：Wireshark 抓包并解释一次查询</h3><ol>\n<li>打开 Wireshark，选择你正在联网的网卡（Wi-Fi&#x2F;以太网）</li>\n<li>设置显示过滤器：<ul>\n<li><code>dns</code></li>\n<li>或：<code>udp.port == 53 || tcp.port == 53</code></li>\n</ul>\n</li>\n<li>开始抓包</li>\n<li>另开一个 PowerShell，执行：<ul>\n<li><code>Resolve-DnsName www.bing.com -Type A</code></li>\n</ul>\n</li>\n<li>回到 Wireshark，找到对应的 DNS Query&#x2F;Response</li>\n</ol>\n<p>写出你的观察（建议按下面模板）：</p>\n<ul>\n<li>Query：查询名是什么？类型是什么（A&#x2F;AAAA&#x2F;TXT）？</li>\n<li>Flags：RD&#x2F;RA 是否为 1？RCODE 是什么？</li>\n<li>Answer：返回了几条记录？每条 TTL 是多少？</li>\n<li>UDP 还是 TCP？如果是 TCP，是什么原因（是否看到 TC&#x3D;1）？</li>\n</ul>\n<h2 id=\"常见坑与排查思路\"><a href=\"#常见坑与排查思路\" class=\"headerlink\" title=\"常见坑与排查思路\"></a>常见坑与排查思路</h2><h3 id=\"1-NXDOMAIN-x2F-SERVFAIL-x2F-超时分别意味着什么\"><a href=\"#1-NXDOMAIN-x2F-SERVFAIL-x2F-超时分别意味着什么\" class=\"headerlink\" title=\"1) NXDOMAIN &#x2F; SERVFAIL &#x2F; 超时分别意味着什么\"></a>1) NXDOMAIN &#x2F; SERVFAIL &#x2F; 超时分别意味着什么</h3><ul>\n<li><strong>NXDOMAIN</strong>：权威 DNS 明确表示“这个名字不存在”</li>\n<li><strong>SERVFAIL</strong>：递归解析器无法完成解析（上游异常、DNSSEC 校验问题、策略阻断等）</li>\n<li><strong>超时</strong>：网络到 DNS 服务器不可达、防火墙拦截、或服务器负载&#x2F;丢包</li>\n</ul>\n<h3 id=\"2-为什么同一个域名在不同网络解析结果不同\"><a href=\"#2-为什么同一个域名在不同网络解析结果不同\" class=\"headerlink\" title=\"2) 为什么同一个域名在不同网络解析结果不同\"></a>2) 为什么同一个域名在不同网络解析结果不同</h3><p>常见原因：</p>\n<ul>\n<li>CDN 按地域&#x2F;运营商调度</li>\n<li>分流策略（EDNS Client Subnet 影响）</li>\n<li>公司内网 DNS 做了内部解析（Split-horizon DNS）</li>\n</ul>\n<h3 id=\"3-安全视角：DNS-也会被攻击-x2F-利用\"><a href=\"#3-安全视角：DNS-也会被攻击-x2F-利用\" class=\"headerlink\" title=\"3) 安全视角：DNS 也会被攻击&#x2F;利用\"></a>3) 安全视角：DNS 也会被攻击&#x2F;利用</h3><p>本日先建立概念（后续会深入）：</p>\n<ul>\n<li><strong>DNS 欺骗&#x2F;投毒</strong>：让你解析到攻击者的 IP</li>\n<li><strong>重绑定（DNS Rebinding）</strong>：利用浏览器同源策略边界进行绕过（与内网访问相关）</li>\n<li><strong>隧道（DNS Tunnel）</strong>：把数据编码进子域名&#x2F;响应里，实现隐蔽通信</li>\n</ul>\n<h2 id=\"巩固练习（题与复盘）\"><a href=\"#巩固练习（题与复盘）\" class=\"headerlink\" title=\"巩固练习（题与复盘）\"></a>巩固练习（题与复盘）</h2><ol>\n<li><strong>CNAME 与 A 记录的关系是什么？</strong></li>\n</ol>\n<ul>\n<li>用一句话解释：CNAME 是“别名”，最终仍要落到 A&#x2F;AAAA</li>\n<li>思考：为什么同名不能同时存在 CNAME 和 A？</li>\n</ul>\n<ol start=\"2\">\n<li><strong>解释一次失败解析的可能原因</strong>（至少写 3 条）</li>\n</ol>\n<p>建议从链路分层去想：</p>\n<ul>\n<li>本机缓存&#x2F;hosts 覆盖</li>\n<li>到递归 DNS 的网络不可达</li>\n<li>递归 DNS 自身故障&#x2F;策略拦截</li>\n<li>权威 DNS 不可达或配置错误</li>\n<li>DNSSEC 校验失败（未来会讲）</li>\n</ul>\n<ol start=\"3\">\n<li>加分题：</li>\n</ol>\n<ul>\n<li>在 Wireshark 里找到一次返回多条 A 记录的响应，解释这通常用于什么（负载均衡&#x2F;高可用）</li>\n</ul>\n<h2 id=\"评估标准（达成判定）\"><a href=\"#评估标准（达成判定）\" class=\"headerlink\" title=\"评估标准（达成判定）\"></a>评估标准（达成判定）</h2><ul>\n<li>能用自己的话画出（或描述）一次解析链路：本机 → 递归 → 根 → TLD → 权威</li>\n<li>能在 Wireshark 里指出一条 DNS 报文的 Query&#x2F;Response，并说清楚 Query 类型 + Answer + TTL</li>\n<li>能说出 TTL 的作用，以及为什么会导致“解析修改延迟生效”</li>\n</ul>\n<h2 id=\"学习成果达成情况（由学习者填写）\"><a href=\"#学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"学习成果达成情况（由学习者填写）\"></a>学习成果达成情况（由学习者填写）</h2><ul>\n<li>截图与证据：<ul>\n<li>Wireshark 抓包截图（Query + Response 各 1 张）</li>\n<li><code>Resolve-DnsName</code> 输出截图或复制粘贴</li>\n</ul>\n</li>\n<li>关键命令与输出：<ul>\n<li><code>Resolve-DnsName &lt;domain&gt; -Type A/AAAA/TXT</code></li>\n<li><code>ipconfig /displaydns</code>（可选）</li>\n</ul>\n</li>\n<li>结论与反思：<ul>\n<li>今天你最清楚的一个点：</li>\n<li>仍然模糊的一个点（明天回看&#x2F;补充）：</li>\n</ul>\n</li>\n</ul>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day007：网络与协议基础 - Wireshark 入门与综合分析","url":"/post/17c812fc.html","content":"<h1 id=\"Day007：网络与协议基础-Wireshark-入门与综合分析\"><a href=\"#Day007：网络与协议基础-Wireshark-入门与综合分析\" class=\"headerlink\" title=\"Day007：网络与协议基础 - Wireshark 入门与综合分析\"></a>Day007：网络与协议基础 - Wireshark 入门与综合分析</h1><ul>\n<li>日期：2025-12-31</li>\n<li>周次：第 1 周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><ul>\n<li>熟练使用过滤器（显示&#x2F;捕获），能快速定位目标流量</li>\n<li>能在一次抓包里串起来：DNS → TCP 三次握手 → HTTP 请求&#x2F;响应</li>\n<li>学会做“分析证据”：标注、书签、导出截图与最终报告</li>\n</ul>\n<span id=\"more\"></span>\n\n<h2 id=\"学习内容\"><a href=\"#学习内容\" class=\"headerlink\" title=\"学习内容\"></a>学习内容</h2><h3 id=\"1️⃣-必须先分清：捕获过滤器-vs-显示过滤器\"><a href=\"#1️⃣-必须先分清：捕获过滤器-vs-显示过滤器\" class=\"headerlink\" title=\"1️⃣ 必须先分清：捕获过滤器 vs 显示过滤器\"></a>1️⃣ 必须先分清：捕获过滤器 vs 显示过滤器</h3><ul>\n<li><strong>捕获过滤器（Capture Filter）</strong>：在“抓包时”就把不需要的包丢掉（语法更像 BPF）。<ul>\n<li>优点：文件更小、噪声更少</li>\n<li>缺点：抓不到就没了，无法回补</li>\n</ul>\n</li>\n<li><strong>显示过滤器（Display Filter）</strong>：抓完以后再筛选展示（Wireshark 最强、最常用）。<ul>\n<li>优点：灵活、可反复调整</li>\n<li>缺点：抓包时噪声可能多</li>\n</ul>\n</li>\n</ul>\n<p>学习阶段建议：<strong>少用捕获过滤器，多用显示过滤器</strong>。</p>\n<h3 id=\"2️⃣-显示过滤器（Display-Filter）常用清单\"><a href=\"#2️⃣-显示过滤器（Display-Filter）常用清单\" class=\"headerlink\" title=\"2️⃣ 显示过滤器（Display Filter）常用清单\"></a>2️⃣ 显示过滤器（Display Filter）常用清单</h3><h4 id=\"协议-x2F-端口\"><a href=\"#协议-x2F-端口\" class=\"headerlink\" title=\"协议&#x2F;端口\"></a>协议&#x2F;端口</h4><ul>\n<li><code>dns</code></li>\n<li><code>http</code></li>\n<li><code>tcp</code></li>\n<li><code>tcp.port == 80</code></li>\n<li><code>udp.port == 53</code></li>\n</ul>\n<h4 id=\"IP-x2F-主机定位\"><a href=\"#IP-x2F-主机定位\" class=\"headerlink\" title=\"IP&#x2F;主机定位\"></a>IP&#x2F;主机定位</h4><ul>\n<li><code>ip.addr == 192.168.1.10</code>（某主机参与的所有流量）</li>\n<li><code>ip.src == 192.168.1.10</code> &#x2F; <code>ip.dst == 192.168.1.10</code></li>\n</ul>\n<h4 id=\"TCP-关键定位\"><a href=\"#TCP-关键定位\" class=\"headerlink\" title=\"TCP 关键定位\"></a>TCP 关键定位</h4><ul>\n<li>三次握手：<ul>\n<li><code>tcp.flags.syn == 1 &amp;&amp; tcp.flags.ack == 0</code></li>\n<li><code>tcp.flags.syn == 1 &amp;&amp; tcp.flags.ack == 1</code></li>\n<li><code>tcp.flags.ack == 1 &amp;&amp; tcp.len == 0</code></li>\n</ul>\n</li>\n<li>重传&#x2F;乱序（排障常用）：<ul>\n<li><code>tcp.analysis.retransmission</code></li>\n<li><code>tcp.analysis.out_of_order</code></li>\n<li><code>tcp.analysis.lost_segment</code></li>\n</ul>\n</li>\n<li>快速看是否有 RST：<ul>\n<li><code>tcp.flags.reset == 1</code></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"HTTP-关键字段（有时非常好用）\"><a href=\"#HTTP-关键字段（有时非常好用）\" class=\"headerlink\" title=\"HTTP 关键字段（有时非常好用）\"></a>HTTP 关键字段（有时非常好用）</h4><ul>\n<li><code>http.request.method == &quot;GET&quot;</code></li>\n<li><code>http.request.method == &quot;POST&quot;</code></li>\n<li><code>http.host contains &quot;example&quot;</code></li>\n<li><code>http.response.code == 301 || http.response.code == 302</code></li>\n</ul>\n<h3 id=\"3️⃣-分析视角：从“现象”到“证据”\"><a href=\"#3️⃣-分析视角：从“现象”到“证据”\" class=\"headerlink\" title=\"3️⃣ 分析视角：从“现象”到“证据”\"></a>3️⃣ 分析视角：从“现象”到“证据”</h3><p>建议你按这个链路写报告：</p>\n<ol>\n<li>目标是什么？（访问哪个域名&#x2F;服务）</li>\n<li>DNS 解析有没有成功？（Query 类型、RCODE、Answer、TTL）</li>\n<li>TCP 连接有没有建立？（三次握手、是否重传、RTT 体感）</li>\n<li>应用层请求是否正常？（HTTP 方法、路径、状态码、关键头）</li>\n<li>异常的话，落在哪一层？（DNS&#x2F;TCP&#x2F;HTTP）</li>\n</ol>\n<h2 id=\"实践任务（合法授权范围内）\"><a href=\"#实践任务（合法授权范围内）\" class=\"headerlink\" title=\"实践任务（合法授权范围内）\"></a>实践任务（合法授权范围内）</h2><blockquote>\n<p>目标：产出一份“能复现、能对照、能解释”的综合抓包报告。</p>\n</blockquote>\n<h3 id=\"任务-1：准备可控流量源（本地-HTTP-服务）\"><a href=\"#任务-1：准备可控流量源（本地-HTTP-服务）\" class=\"headerlink\" title=\"任务 1：准备可控流量源（本地 HTTP 服务）\"></a>任务 1：准备可控流量源（本地 HTTP 服务）</h3><p>在 Windows 上推荐用 Python 的 <code>http.server</code>：</p>\n<ol>\n<li>新建目录：<code>D:\\projects\\Network Security\\lab-wireshark</code></li>\n<li>放一个 <code>index.html</code>（写任意内容，比如“Day007 Lab”）</li>\n<li>在该目录启动服务（任选一种）：<ul>\n<li><code>python -m http.server 8000</code></li>\n<li><code>py -m http.server 8000</code></li>\n</ul>\n</li>\n</ol>\n<h3 id=\"任务-2：触发一次“DNS-TCP-HTTP”的访问\"><a href=\"#任务-2：触发一次“DNS-TCP-HTTP”的访问\" class=\"headerlink\" title=\"任务 2：触发一次“DNS + TCP + HTTP”的访问\"></a>任务 2：触发一次“DNS + TCP + HTTP”的访问</h3><p>你需要一次访问里同时出现 DNS、TCP 握手、HTTP。</p>\n<p>推荐做法（更稳定看到 DNS）：</p>\n<ol>\n<li>访问一个域名（触发 DNS）：例如在浏览器访问 <code>http://example.com/</code> 或 <code>http://www.bing.com/</code></li>\n<li>访问本地服务（触发 TCP + HTTP）：<code>http://127.0.0.1:8000/</code></li>\n</ol>\n<blockquote>\n<p>如果你想在一次访问里同时看到 DNS+HTTP：尽量访问“域名形式”的 HTTP（例如 <code>http://example.com/</code>），不要只访问 IP。</p>\n</blockquote>\n<h3 id=\"任务-3：抓包与过滤（推荐流程）\"><a href=\"#任务-3：抓包与过滤（推荐流程）\" class=\"headerlink\" title=\"任务 3：抓包与过滤（推荐流程）\"></a>任务 3：抓包与过滤（推荐流程）</h3><ol>\n<li>打开 Wireshark，选择你的活动网卡</li>\n<li>开始抓包</li>\n<li>执行上面的访问动作（至少一次域名 HTTP + 一次本地 HTTP）</li>\n<li>停止抓包</li>\n<li>用显示过滤器分段分析并截图：</li>\n</ol>\n<ul>\n<li>DNS：<code>dns</code></li>\n<li>TCP 握手：<code>tcp.flags.syn == 1 || tcp.flags.fin == 1 || tcp.flags.reset == 1</code></li>\n<li>HTTP：<code>http</code></li>\n</ul>\n<h3 id=\"手动实现要点（不使用任何脚本）\"><a href=\"#手动实现要点（不使用任何脚本）\" class=\"headerlink\" title=\"手动实现要点（不使用任何脚本）\"></a>手动实现要点（不使用任何脚本）</h3><blockquote>\n<p>目标：你能“亲手触发”并在 Wireshark 里找到 <strong>DNS → TCP 三次握手 → HTTP 请求&#x2F;响应</strong> 这条证据链。</p>\n</blockquote>\n<h4 id=\"Step-1：先准备一个稳定的-HTTP-目标（本地）\"><a href=\"#Step-1：先准备一个稳定的-HTTP-目标（本地）\" class=\"headerlink\" title=\"Step 1：先准备一个稳定的 HTTP 目标（本地）\"></a>Step 1：先准备一个稳定的 HTTP 目标（本地）</h4><p>请先完成“任务 1”的本地服务启动，然后用浏览器访问：</p>\n<ul>\n<li><code>http://127.0.0.1:8000/</code></li>\n</ul>\n<p>这一步几乎必定能抓到 HTTP（避免外网网站跳 HTTPS 导致看不到明文 HTTP）。</p>\n<h4 id=\"Step-2：再触发一次“域名访问”（更容易看到-DNS）\"><a href=\"#Step-2：再触发一次“域名访问”（更容易看到-DNS）\" class=\"headerlink\" title=\"Step 2：再触发一次“域名访问”（更容易看到 DNS）\"></a>Step 2：再触发一次“域名访问”（更容易看到 DNS）</h4><p>任选一种：</p>\n<ul>\n<li>浏览器打开：<code>http://example.com/</code></li>\n<li>或者先 <code>nslookup example.com</code> 再访问 <code>http://example.com/</code></li>\n</ul>\n<h4 id=\"Step-3：Wireshark-用过滤器分段截证据\"><a href=\"#Step-3：Wireshark-用过滤器分段截证据\" class=\"headerlink\" title=\"Step 3：Wireshark 用过滤器分段截证据\"></a>Step 3：Wireshark 用过滤器分段截证据</h4><p>你最终至少要保存&#x2F;截图这 3 类证据：</p>\n<ol>\n<li>DNS 证据</li>\n</ol>\n<ul>\n<li>过滤器：<code>dns</code></li>\n<li>截图要求：能看到 Query Name&#x2F;Type、RCODE、Answer 和 TTL（如果有）</li>\n</ul>\n<ol start=\"2\">\n<li>TCP 三次握手证据</li>\n</ol>\n<ul>\n<li>过滤器（更聚焦）：<ul>\n<li><code>tcp.flags.syn == 1 || tcp.flags.ack == 1</code></li>\n</ul>\n</li>\n<li>或者用你已写的“握手&#x2F;关闭&#x2F;RST”过滤器：<ul>\n<li><code>tcp.flags.syn == 1 || tcp.flags.fin == 1 || tcp.flags.reset == 1</code></li>\n</ul>\n</li>\n</ul>\n<ol start=\"3\">\n<li>HTTP 请求&#x2F;响应证据</li>\n</ol>\n<ul>\n<li>过滤器：<code>http</code></li>\n<li>截图要求：能看到 Request-Line、Host（请求头）、Status-Code、Content-Type（响应头）</li>\n</ul>\n<h4 id=\"Step-4：常见问题（看不到-DNS-x2F-HTTP-时怎么做）\"><a href=\"#Step-4：常见问题（看不到-DNS-x2F-HTTP-时怎么做）\" class=\"headerlink\" title=\"Step 4：常见问题（看不到 DNS&#x2F;HTTP 时怎么做）\"></a>Step 4：常见问题（看不到 DNS&#x2F;HTTP 时怎么做）</h4><ul>\n<li>看不到 DNS：可能命中缓存了。<ul>\n<li>解决：换一个没访问过的域名；或执行 <code>ipconfig /flushdns</code> 后再访问一次（可选）。</li>\n</ul>\n</li>\n<li>看不到明文 HTTP：很多网站会 301&#x2F;302 跳到 HTTPS。<ul>\n<li>解决：用本地 <code>127.0.0.1:8000</code> 的 HTTP 输出截图；DNS 证据仍可来自域名解析。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"任务-4：标注-x2F-书签-x2F-导出\"><a href=\"#任务-4：标注-x2F-书签-x2F-导出\" class=\"headerlink\" title=\"任务 4：标注&#x2F;书签&#x2F;导出\"></a>任务 4：标注&#x2F;书签&#x2F;导出</h3><p>在 Wireshark 里对关键包做：</p>\n<ul>\n<li><strong>Comment&#x2F;注释</strong>：写下“这是 DNS Query&#x2F;这是 SYN&#x2F;这是 200 OK…”</li>\n<li><strong>Mark Packet（标记包）</strong>：把关键包标出来</li>\n</ul>\n<p>导出产物：</p>\n<ul>\n<li>保存抓包文件（建议命名）：<code>Day007_dns_tcp_http.pcapng</code></li>\n<li>关键截图（至少 3 张）：DNS、SYN&#x2F;SYN-ACK&#x2F;ACK、HTTP 请求&#x2F;响应</li>\n</ul>\n<h2 id=\"巩固练习（题与复盘）\"><a href=\"#巩固练习（题与复盘）\" class=\"headerlink\" title=\"巩固练习（题与复盘）\"></a>巩固练习（题与复盘）</h2><h3 id=\"练习-1：为常见分析场景编写-5-条过滤表达式\"><a href=\"#练习-1：为常见分析场景编写-5-条过滤表达式\" class=\"headerlink\" title=\"练习 1：为常见分析场景编写 5 条过滤表达式\"></a>练习 1：为常见分析场景编写 5 条过滤表达式</h3><p>参考场景（从中挑 5 个写出过滤器，并解释为什么这么写）：</p>\n<ol>\n<li>只看 DNS</li>\n<li>只看访问 <code>127.0.0.1:8000</code> 的 TCP 流量</li>\n<li>只看 TCP 三次握手相关包</li>\n<li>只看 HTTP 302 的响应</li>\n<li>只看某个 IP 的所有流量</li>\n<li>只看重传</li>\n</ol>\n<h3 id=\"练习-2：解释一次异常重传与超时的可能原因\"><a href=\"#练习-2：解释一次异常重传与超时的可能原因\" class=\"headerlink\" title=\"练习 2：解释一次异常重传与超时的可能原因\"></a>练习 2：解释一次异常重传与超时的可能原因</h3><p>从至少 3 个角度回答：</p>\n<ul>\n<li>信号&#x2F;链路质量：丢包、Wi-Fi 不稳定</li>\n<li>端到端负载：服务器繁忙、窗口太小</li>\n<li>路由&#x2F;策略：防火墙丢包、QoS 限速</li>\n</ul>\n<h2 id=\"评估标准（达成判定）\"><a href=\"#评估标准（达成判定）\" class=\"headerlink\" title=\"评估标准（达成判定）\"></a>评估标准（达成判定）</h2><ul>\n<li>能独立完成：抓包 → 过滤 → 定位关键包 → 标注&#x2F;截图</li>\n<li>报告中能清晰串起：DNS 解析证据 + TCP 握手证据 + HTTP 请求&#x2F;响应证据</li>\n<li>至少写出 5 条显示过滤器，并能解释用途</li>\n</ul>\n<h2 id=\"学习成果达成情况（由学习者填写）\"><a href=\"#学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"学习成果达成情况（由学习者填写）\"></a>学习成果达成情况（由学习者填写）</h2><h3 id=\"截图与证据\"><a href=\"#截图与证据\" class=\"headerlink\" title=\"截图与证据\"></a>截图与证据</h3><ul>\n<li>抓包文件：<ul>\n<li><code>Day007_dns_tcp_http.pcapng</code>（保存位置：）</li>\n</ul>\n</li>\n<li>截图（至少 3 张）：<ol>\n<li>DNS Query&#x2F;Response（能看到 Query 类型 + RCODE + Answer&#x2F;TTL）</li>\n<li>TCP 三次握手（SYN &#x2F; SYN-ACK &#x2F; ACK）</li>\n<li>HTTP 请求&#x2F;响应（Request-Line + Status-Code + 关键头部）</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"报告正文（推荐结构，直接照抄填空）\"><a href=\"#报告正文（推荐结构，直接照抄填空）\" class=\"headerlink\" title=\"报告正文（推荐结构，直接照抄填空）\"></a>报告正文（推荐结构，直接照抄填空）</h3><ol>\n<li>目标与环境</li>\n</ol>\n<ul>\n<li>目标域名&#x2F;URL：</li>\n<li>本机 IP：</li>\n<li>抓包网卡：</li>\n</ul>\n<ol start=\"2\">\n<li>DNS 解析</li>\n</ol>\n<ul>\n<li>Query Name &#x2F; Type：</li>\n<li>RCODE：</li>\n<li>Answer（IP&#x2F;记录）：</li>\n<li>TTL：</li>\n</ul>\n<ol start=\"3\">\n<li>TCP 建连</li>\n</ol>\n<ul>\n<li>Client Port → Server Port：</li>\n<li>三次握手证据（Frame No.）：</li>\n<li>是否有重传&#x2F;乱序：</li>\n</ul>\n<ol start=\"4\">\n<li>HTTP 交互</li>\n</ol>\n<ul>\n<li>方法与路径：</li>\n<li>状态码：</li>\n<li>关键请求头（Host&#x2F;User-Agent&#x2F;Accept&#x2F;Cookie）：</li>\n<li>关键响应头（Content-Type&#x2F;Set-Cookie&#x2F;Location）：</li>\n</ul>\n<ol start=\"5\">\n<li>结论</li>\n</ol>\n<ul>\n<li>本次访问是否成功：</li>\n<li>如果失败，失败发生在（DNS&#x2F;TCP&#x2F;HTTP）哪一层：</li>\n</ul>\n<h3 id=\"关键命令与输出\"><a href=\"#关键命令与输出\" class=\"headerlink\" title=\"关键命令与输出\"></a>关键命令与输出</h3><ul>\n<li><h2 id=\"本地-HTTP-服务启动命令：\"><a href=\"#本地-HTTP-服务启动命令：\" class=\"headerlink\" title=\"本地 HTTP 服务启动命令：\"></a>本地 HTTP 服务启动命令：</h2></li>\n<li><h2 id=\"触发访问的命令（可选）：\"><a href=\"#触发访问的命令（可选）：\" class=\"headerlink\" title=\"触发访问的命令（可选）：\"></a>触发访问的命令（可选）：</h2></li>\n<li>你常用的 5 条显示过滤器：<br>http 或 tcp 或 udp：<br>作用：按协议过滤，显示所有 HTTP、TCP 或 UDP 协议的流量.<br>示例：输入 http，显示所有 HTTP 协议包.<br>ip.addr &#x3D;&#x3D; 192.168.1.100：<br>作用：显示源或目的 IP 地址为指定 IP 的所有包.<br>示例：只看和 192.168.1.100 相关的通信.<br>tcp.port &#x3D;&#x3D; 80 或 udp.port &#x3D;&#x3D; 53：<br>作用：过滤指定端口号的 TCP 或 UDP 流量.<br>示例：tcp.port &#x3D;&#x3D; 80 查看 Web (HTTP) 流量，udp.port &#x3D;&#x3D; 53 查看 DNS 流量.<br>dns：<br>作用：专门显示 DNS（域名系统）协议的流量.<br>示例：快速查看域名解析请求和响应.<br>tcp.port &#x3D;&#x3D; 80 &amp;&amp; http (组合过滤)<br>作用：使用逻辑运算符 &amp;&amp; (与) 或 || (或) 组合条件.<br>示例：只显示端口 80 上的 HTTP 流量.</li>\n</ul>\n<h3 id=\"结论与反思\"><a href=\"#结论与反思\" class=\"headerlink\" title=\"结论与反思\"></a>结论与反思</h3><ul>\n<li>今天最有效的一个过滤器（为什么）：</li>\n<li>今天最花时间的一步（怎么改进）：</li>\n</ul>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day006：网络与协议基础 - HTTP 基础","url":"/post/d8a842e9.html","content":"<h1 id=\"Day006：网络与协议基础-HTTP-基础\"><a href=\"#Day006：网络与协议基础-HTTP-基础\" class=\"headerlink\" title=\"Day006：网络与协议基础 - HTTP 基础\"></a>Day006：网络与协议基础 - HTTP 基础</h1><ul>\n<li>日期：2025-12-30</li>\n<li>周次：第 1 周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><ul>\n<li>理解 HTTP 请求&#x2F;响应报文结构（起始行 + 头部 + 正文）</li>\n<li>掌握常见方法、状态码、头部字段在抓包里的定位方式</li>\n<li>建立 Cookie&#x2F;Session 的最小可用认知（后续会更深入）</li>\n<li>认识明文 HTTP（未加密）带来的安全风险：窃听、篡改、会话劫持</li>\n</ul>\n<span id=\"more\"></span>\n\n<h2 id=\"学习内容\"><a href=\"#学习内容\" class=\"headerlink\" title=\"学习内容\"></a>学习内容</h2><h3 id=\"1️⃣-HTTP-是什么（你需要记住的-3-句话）\"><a href=\"#1️⃣-HTTP-是什么（你需要记住的-3-句话）\" class=\"headerlink\" title=\"1️⃣ HTTP 是什么（你需要记住的 3 句话）\"></a>1️⃣ HTTP 是什么（你需要记住的 3 句话）</h3><ol>\n<li>HTTP 是<strong>应用层</strong>协议，跑在 TCP 之上（常见端口 80）。</li>\n<li>经典 HTTP 通信是“<strong>请求 → 响应</strong>”模型。</li>\n<li>明文 HTTP 本身不提供机密性&#x2F;完整性&#x2F;身份认证，这些由 HTTPS（TLS）补齐。</li>\n</ol>\n<h3 id=\"2️⃣-HTTP-报文结构（抓包时就按这个拆）\"><a href=\"#2️⃣-HTTP-报文结构（抓包时就按这个拆）\" class=\"headerlink\" title=\"2️⃣ HTTP 报文结构（抓包时就按这个拆）\"></a>2️⃣ HTTP 报文结构（抓包时就按这个拆）</h3><p>HTTP 消息分为：</p>\n<ul>\n<li><strong>起始行（Start-Line）</strong></li>\n<li><strong>头部（Headers）</strong>：一行一个 <code>Key: Value</code></li>\n<li><strong>空行</strong></li>\n<li><strong>正文（Body，可选）</strong></li>\n</ul>\n<h4 id=\"请求报文（Request）\"><a href=\"#请求报文（Request）\" class=\"headerlink\" title=\"请求报文（Request）\"></a>请求报文（Request）</h4><p>起始行长这样：</p>\n<p><code>&lt;METHOD&gt; &lt;PATH&gt; &lt;VERSION&gt;</code></p>\n<p>例：</p>\n<ul>\n<li><code>GET /index.html HTTP/1.1</code></li>\n</ul>\n<h4 id=\"响应报文（Response）\"><a href=\"#响应报文（Response）\" class=\"headerlink\" title=\"响应报文（Response）\"></a>响应报文（Response）</h4><p>起始行长这样：</p>\n<p><code>&lt;VERSION&gt; &lt;STATUS_CODE&gt; &lt;REASON&gt;</code></p>\n<p>例：</p>\n<ul>\n<li><code>HTTP/1.1 200 OK</code></li>\n</ul>\n<h3 id=\"3️⃣-常见方法（Methods）怎么用、怎么抓\"><a href=\"#3️⃣-常见方法（Methods）怎么用、怎么抓\" class=\"headerlink\" title=\"3️⃣ 常见方法（Methods）怎么用、怎么抓\"></a>3️⃣ 常见方法（Methods）怎么用、怎么抓</h3><table>\n<thead>\n<tr>\n<th>方法</th>\n<th>典型用途</th>\n<th>是否常带 Body</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>GET</td>\n<td>获取资源（页面、图片、接口数据）</td>\n<td>否（通常）</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>提交数据（表单、登录、创建资源）</td>\n<td>是</td>\n</tr>\n<tr>\n<td>PUT</td>\n<td>完整更新资源</td>\n<td>是</td>\n</tr>\n<tr>\n<td>PATCH</td>\n<td>部分更新资源</td>\n<td>是</td>\n</tr>\n<tr>\n<td>DELETE</td>\n<td>删除资源</td>\n<td>通常否</td>\n</tr>\n</tbody></table>\n<blockquote>\n<p>记忆点：抓包时先看方法和路径，立刻就能判断“这次请求想干什么”。</p>\n</blockquote>\n<h3 id=\"4️⃣-状态码（Status-Code）分类：先会分组再会细节\"><a href=\"#4️⃣-状态码（Status-Code）分类：先会分组再会细节\" class=\"headerlink\" title=\"4️⃣ 状态码（Status Code）分类：先会分组再会细节\"></a>4️⃣ 状态码（Status Code）分类：先会分组再会细节</h3><ul>\n<li><strong>1xx</strong>：信息（少见）</li>\n<li><strong>2xx</strong>：成功</li>\n<li><strong>3xx</strong>：重定向</li>\n<li><strong>4xx</strong>：客户端错误（请求有问题&#x2F;没权限&#x2F;没登录）</li>\n<li><strong>5xx</strong>：服务端错误（服务器处理失败）</li>\n</ul>\n<p>常见必记：</p>\n<ul>\n<li><code>200 OK</code>：成功</li>\n<li><code>301 Moved Permanently</code>：永久重定向（SEO&#x2F;缓存语义更强）</li>\n<li><code>302 Found</code>：临时重定向（历史上常见；现代还有 307&#x2F;308 语义更严格）</li>\n<li><code>400 Bad Request</code>：请求格式有误</li>\n<li><code>401 Unauthorized</code>：未认证（一般表示需要登录&#x2F;Token）</li>\n<li><code>403 Forbidden</code>：已认证&#x2F;未认证都可能，但就是拒绝访问</li>\n<li><code>404 Not Found</code>：资源不存在</li>\n<li><code>500 Internal Server Error</code>：服务器内部错误</li>\n</ul>\n<h3 id=\"5️⃣-常见头部（Headers）速查（抓包优先看这几个）\"><a href=\"#5️⃣-常见头部（Headers）速查（抓包优先看这几个）\" class=\"headerlink\" title=\"5️⃣ 常见头部（Headers）速查（抓包优先看这几个）\"></a>5️⃣ 常见头部（Headers）速查（抓包优先看这几个）</h3><h4 id=\"请求头常见字段\"><a href=\"#请求头常见字段\" class=\"headerlink\" title=\"请求头常见字段\"></a>请求头常见字段</h4><ul>\n<li><code>Host</code>：目标域名（HTTP&#x2F;1.1 必需）</li>\n<li><code>User-Agent</code>：客户端标识</li>\n<li><code>Accept</code> &#x2F; <code>Accept-Encoding</code> &#x2F; <code>Accept-Language</code>：你能接受什么响应格式&#x2F;压缩&#x2F;语言</li>\n<li><code>Connection</code>：连接管理（<code>keep-alive</code> &#x2F; <code>close</code>）</li>\n<li><code>Referer</code>：从哪里跳转过来的（经常用于风控&#x2F;统计；也可能泄露敏感路径）</li>\n<li><code>Authorization</code>：认证信息（Basic&#x2F;Bearer 等）</li>\n<li><code>Cookie</code>：带上会话相关信息（重点！）</li>\n</ul>\n<h4 id=\"响应头常见字段\"><a href=\"#响应头常见字段\" class=\"headerlink\" title=\"响应头常见字段\"></a>响应头常见字段</h4><ul>\n<li><code>Server</code>：服务器软件标识（有时会被隐藏）</li>\n<li><code>Date</code>：响应时间</li>\n<li><code>Content-Type</code>：正文类型（如 <code>text/html</code>, <code>application/json</code>）</li>\n<li><code>Content-Length</code>：正文长度</li>\n<li><code>Set-Cookie</code>：服务端下发 Cookie（重点！）</li>\n<li><code>Location</code>：重定向目标（3xx 常见）</li>\n</ul>\n<h3 id=\"6️⃣-Cookie-x2F-Session：最小可用理解\"><a href=\"#6️⃣-Cookie-x2F-Session：最小可用理解\" class=\"headerlink\" title=\"6️⃣ Cookie &#x2F; Session：最小可用理解\"></a>6️⃣ Cookie &#x2F; Session：最小可用理解</h3><ul>\n<li><strong>Cookie</strong>：浏览器保存的一小段键值数据，后续请求会自动带上（同域&#x2F;路径策略限制）。</li>\n<li><strong>Session</strong>：服务端用来表示“你是谁&#x2F;你登录没”的状态；常见做法是把 <strong>Session ID 放在 Cookie 里</strong>。</li>\n</ul>\n<p>简化理解：</p>\n<ul>\n<li>登录成功后：服务器 <code>Set-Cookie: session=...</code></li>\n<li>后续请求：浏览器 <code>Cookie: session=...</code></li>\n<li>服务器凭这个识别你的身份与权限</li>\n</ul>\n<h3 id=\"7️⃣-HTTP-x2F-1-1-你先知道这两个点就够\"><a href=\"#7️⃣-HTTP-x2F-1-1-你先知道这两个点就够\" class=\"headerlink\" title=\"7️⃣ HTTP&#x2F;1.1 你先知道这两个点就够\"></a>7️⃣ HTTP&#x2F;1.1 你先知道这两个点就够</h3><ul>\n<li><strong>持久连接（Keep-Alive）</strong>：同一 TCP 连接可复用多个请求，减少握手开销</li>\n<li><strong>Host 头部</strong>：同一 IP 上承载多个站点（虚拟主机）</li>\n</ul>\n<h2 id=\"实践任务（合法授权范围内）\"><a href=\"#实践任务（合法授权范围内）\" class=\"headerlink\" title=\"实践任务（合法授权范围内）\"></a>实践任务（合法授权范围内）</h2><blockquote>\n<p>目标：自己搭一个“可控的 HTTP 目标”，然后抓到一条请求&#x2F;响应并把关键字段标注出来。</p>\n</blockquote>\n<h3 id=\"任务-1：在本地启动一个-HTTP-服务（推荐-Python）\"><a href=\"#任务-1：在本地启动一个-HTTP-服务（推荐-Python）\" class=\"headerlink\" title=\"任务 1：在本地启动一个 HTTP 服务（推荐 Python）\"></a>任务 1：在本地启动一个 HTTP 服务（推荐 Python）</h3><ol>\n<li>新建一个临时目录（比如 <code>D:\\projects\\Network Security\\lab-http</code>）并放一个页面文件：<ul>\n<li><code>index.html</code>（内容随意，写一行文字即可）</li>\n</ul>\n</li>\n<li>在该目录打开 PowerShell，启动服务：</li>\n</ol>\n<ul>\n<li>Python 3：<ul>\n<li><code>python -m http.server 8000</code></li>\n</ul>\n</li>\n</ul>\n<p>如果上面提示没找到 python，你可以：</p>\n<ul>\n<li>用 <code>py</code> 启动（Windows 常见）：<ul>\n<li><code>py -m http.server 8000</code></li>\n</ul>\n</li>\n</ul>\n<p>启动成功后，你会看到类似：</p>\n<ul>\n<li><code>Serving HTTP on 0.0.0.0 port 8000 ...</code></li>\n</ul>\n<h3 id=\"任务-2：访问并触发-HTTP-请求\"><a href=\"#任务-2：访问并触发-HTTP-请求\" class=\"headerlink\" title=\"任务 2：访问并触发 HTTP 请求\"></a>任务 2：访问并触发 HTTP 请求</h3><p>任选其一：</p>\n<ul>\n<li>浏览器访问：<code>http://127.0.0.1:8000/</code></li>\n<li>或 PowerShell（Windows 自带）：<ul>\n<li><code>Invoke-WebRequest http://127.0.0.1:8000/ -UseBasicParsing</code></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"任务-3：Wireshark-抓包并标注请求-x2F-响应\"><a href=\"#任务-3：Wireshark-抓包并标注请求-x2F-响应\" class=\"headerlink\" title=\"任务 3：Wireshark 抓包并标注请求&#x2F;响应\"></a>任务 3：Wireshark 抓包并标注请求&#x2F;响应</h3><ol>\n<li>打开 Wireshark，选择你的活动网卡</li>\n<li>设置显示过滤器（两种方式二选一）：<ul>\n<li>只看本次实验端口：<code>tcp.port == 8000</code></li>\n<li>或只看 HTTP：<code>http</code></li>\n</ul>\n</li>\n<li>重新访问一次 <code>http://127.0.0.1:8000/</code></li>\n<li>找到对应的 HTTP 请求与响应，按“学习成果达成情况”的表格把字段填上</li>\n</ol>\n<p><strong>你应该至少能标注出：</strong></p>\n<ul>\n<li>Request-Line：方法 + 路径 + 版本</li>\n<li>Request Headers：Host &#x2F; User-Agent &#x2F; Accept（至少 1-2 个）</li>\n<li>Status-Line：状态码</li>\n<li>Response Headers：Content-Type &#x2F; Content-Length（至少 1-2 个）</li>\n</ul>\n<h3 id=\"（可选加餐）抓一个-302-重定向\"><a href=\"#（可选加餐）抓一个-302-重定向\" class=\"headerlink\" title=\"（可选加餐）抓一个 302 重定向\"></a>（可选加餐）抓一个 302 重定向</h3><ol>\n<li>在 <code>lab-http</code> 目录加一个最简单的重定向页面（用 HTML meta 也行）：</li>\n<li>访问后在抓包里找到 302&#x2F;301，并在表格里填上 <code>Location</code></li>\n</ol>\n<h2 id=\"明文-HTTP-的安全风险（今天的重点）\"><a href=\"#明文-HTTP-的安全风险（今天的重点）\" class=\"headerlink\" title=\"明文 HTTP 的安全风险（今天的重点）\"></a>明文 HTTP 的安全风险（今天的重点）</h2><p>明文 HTTP（不加密）会导致：</p>\n<ol>\n<li><strong>窃听（Confidentiality 失败）</strong>：同一网络里的攻击者&#x2F;旁路设备可以直接看到你的 URL、参数、返回内容。</li>\n<li><strong>篡改（Integrity 失败）</strong>：中间人可以改写响应内容（注入广告&#x2F;恶意脚本）。</li>\n<li><strong>会话劫持（Session Hijacking）</strong>：如果 Cookie&#x2F;Token 走明文，抓到就能冒充你。</li>\n</ol>\n<p>补充概念（今天只记名词，后续再深入验证）：</p>\n<ul>\n<li><strong>SSLStrip&#x2F;降级攻击</strong>：诱导从 HTTPS 回落到 HTTP，从而实现窃听&#x2F;篡改。</li>\n</ul>\n<h2 id=\"巩固练习（题与复盘）\"><a href=\"#巩固练习（题与复盘）\" class=\"headerlink\" title=\"巩固练习（题与复盘）\"></a>巩固练习（题与复盘）</h2><ol>\n<li>题目：301 与 302 的区别是什么？</li>\n</ol>\n<ul>\n<li>从“是否长期、是否缓存、语义”角度回答（写 2-3 句即可）。</li>\n</ul>\n<ol start=\"2\">\n<li>练习：写出 5 个常见 HTTP 请求头并解释作用</li>\n</ol>\n<p>建议从这几个挑：<code>Host</code>、<code>User-Agent</code>、<code>Accept</code>、<code>Accept-Encoding</code>、<code>Referer</code>、<code>Cookie</code>、<code>Authorization</code>。</p>\n<ol start=\"3\">\n<li>加分题：</li>\n</ol>\n<ul>\n<li><code>Set-Cookie</code> 和 <code>Cookie</code> 的区别是什么？分别是谁发给谁的？</li>\n<li>解释“为什么 HTTP&#x2F;1.1 需要 Host 头”。</li>\n</ul>\n<h2 id=\"评估标准（达成判定）\"><a href=\"#评估标准（达成判定）\" class=\"headerlink\" title=\"评估标准（达成判定）\"></a>评估标准（达成判定）</h2><ul>\n<li>能熟练阅读请求&#x2F;响应报文：方法、路径、状态码、关键头部（Host&#x2F;Cookie&#x2F;Set-Cookie&#x2F;Content-Type）</li>\n<li>能说明为何生产环境优先使用 HTTPS（至少 3 个点：窃听&#x2F;篡改&#x2F;身份与会话安全）</li>\n</ul>\n<h2 id=\"学习成果达成情况（由学习者填写）\"><a href=\"#学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"学习成果达成情况（由学习者填写）\"></a>学习成果达成情况（由学习者填写）</h2><h3 id=\"截图与证据\"><a href=\"#截图与证据\" class=\"headerlink\" title=\"截图与证据\"></a>截图与证据</h3><ul>\n<li>Wireshark（或 Fiddler）抓包：<ul>\n<li>1 张：HTTP 请求报文（能看到请求行 + 关键请求头）</li>\n<li>1 张：HTTP 响应报文（能看到状态行 + 关键响应头）</li>\n</ul>\n</li>\n<li>（可选）浏览器开发者工具 Network：<ul>\n<li>1 张：请求&#x2F;响应头详情</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"请求-x2F-响应标注（建议填表）\"><a href=\"#请求-x2F-响应标注（建议填表）\" class=\"headerlink\" title=\"请求&#x2F;响应标注（建议填表）\"></a>请求&#x2F;响应标注（建议填表）</h3><table>\n<thead>\n<tr>\n<th>项目</th>\n<th>你抓到的值</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>请求方法（Method）</td>\n<td></td>\n<td>GET&#x2F;POST…</td>\n</tr>\n<tr>\n<td>路径（Path）</td>\n<td></td>\n<td>例如 <code>/</code>、<code>/index.html</code></td>\n</tr>\n<tr>\n<td>HTTP 版本</td>\n<td></td>\n<td>HTTP&#x2F;1.1</td>\n</tr>\n<tr>\n<td>Host</td>\n<td></td>\n<td>目标主机名（HTTP&#x2F;1.1 必需）</td>\n</tr>\n<tr>\n<td>User-Agent</td>\n<td></td>\n<td>客户端标识</td>\n</tr>\n<tr>\n<td>Accept &#x2F; Accept-Encoding</td>\n<td></td>\n<td>接受的类型&#x2F;压缩</td>\n</tr>\n<tr>\n<td>Cookie（若有）</td>\n<td></td>\n<td>是否携带会话信息</td>\n</tr>\n<tr>\n<td>响应状态码</td>\n<td></td>\n<td>200&#x2F;301&#x2F;302&#x2F;404…</td>\n</tr>\n<tr>\n<td>Content-Type</td>\n<td></td>\n<td>text&#x2F;html &#x2F; application&#x2F;json…</td>\n</tr>\n<tr>\n<td>Set-Cookie（若有）</td>\n<td></td>\n<td>服务端下发会话&#x2F;标识</td>\n</tr>\n<tr>\n<td>Location（若为 3xx）</td>\n<td></td>\n<td>重定向目标</td>\n</tr>\n</tbody></table>\n<h3 id=\"关键命令与输出\"><a href=\"#关键命令与输出\" class=\"headerlink\" title=\"关键命令与输出\"></a>关键命令与输出</h3><ul>\n<li><h2 id=\"本地服务启动命令（你实际用的）：\"><a href=\"#本地服务启动命令（你实际用的）：\" class=\"headerlink\" title=\"本地服务启动命令（你实际用的）：\"></a>本地服务启动命令（你实际用的）：</h2></li>\n<li><h2 id=\"访问命令（可选，浏览器访问也行）：\"><a href=\"#访问命令（可选，浏览器访问也行）：\" class=\"headerlink\" title=\"访问命令（可选，浏览器访问也行）：\"></a>访问命令（可选，浏览器访问也行）：</h2></li>\n</ul>\n<h3 id=\"结论与反思\"><a href=\"#结论与反思\" class=\"headerlink\" title=\"结论与反思\"></a>结论与反思</h3><ul>\n<li><h2 id=\"今天最关键的收获（1-3-句）：\"><a href=\"#今天最关键的收获（1-3-句）：\" class=\"headerlink\" title=\"今天最关键的收获（1-3 句）：\"></a>今天最关键的收获（1-3 句）：</h2></li>\n<li>明文 HTTP 的 3 个风险，你用自己的话复述：</li>\n</ul>\n<ol>\n<li><strong>窃听（Confidentiality 失败）</strong>：同一网络里的攻击者&#x2F;旁路设备可以直接看到你的 URL、参数、返回内容。</li>\n<li><strong>篡改（Integrity 失败）</strong>：中间人可以改写响应内容（注入广告&#x2F;恶意脚本）。</li>\n<li><strong>会话劫持（Session Hijacking）</strong>：如果 Cookie&#x2F;Token 走明文，抓到就能冒充你。</li>\n</ol>\n<ul>\n<li><h2 id=\"明天准备怎么改进-x2F-继续（例如：补抓一个带-Cookie-的请求、对比-HTTPS）：\"><a href=\"#明天准备怎么改进-x2F-继续（例如：补抓一个带-Cookie-的请求、对比-HTTPS）：\" class=\"headerlink\" title=\"明天准备怎么改进&#x2F;继续（例如：补抓一个带 Cookie 的请求、对比 HTTPS）：\"></a>明天准备怎么改进&#x2F;继续（例如：补抓一个带 Cookie 的请求、对比 HTTPS）：</h2></li>\n</ul>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day008：安全协议与加密 - TLS 概念与握手","url":"/post/f7258881.html","content":"<h1 id=\"Day008：安全协议与加密-TLS-概念与握手\"><a href=\"#Day008：安全协议与加密-TLS-概念与握手\" class=\"headerlink\" title=\"Day008：安全协议与加密 - TLS 概念与握手\"></a>Day008：安全协议与加密 - TLS 概念与握手</h1><ul>\n<li>日期：2026-01-01</li>\n<li>周次：第 2 周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p>学完今天你应该能做到这些（更直观的达成标准）：</p>\n<ul>\n<li>能用自己的话讲清楚：TLS 握手在“协商什么”，以及为什么 HTTPS 比 HTTP 安全</li>\n<li>能在 Wireshark 里指出并解释：ClientHello、ServerHello、Certificate、Finished 分别在干什么</li>\n<li>能把 3 个常见概念放到正确位置：证书链校验、SNI、ALPN</li>\n<li>遇到“TLS 握手失败”时，能按层次给出排查方向（网络 → 版本&#x2F;套件 → 证书 → 环境&#x2F;策略）</li>\n</ul>\n<h2 id=\"项目进展与近期操作结果（放到目标下面）\"><a href=\"#项目进展与近期操作结果（放到目标下面）\" class=\"headerlink\" title=\"项目进展与近期操作结果（放到目标下面）\"></a>项目进展与近期操作结果（放到目标下面）</h2><p>为了把“学习”变成“可追踪的产出”，这里记录你最近一段时间做过的关键动作与结果（相当于今日学习的上下文）：</p>\n<ul>\n<li><strong>多账号推送已打通</strong>：当前仓库使用两个远程（<code>origin</code> + <code>backup</code>），通过 SSH Host alias 解决了“用错 key 导致权限被拒绝”的问题。</li>\n<li><strong>自动化辅助</strong>：已创建 <code>git-push.ps1</code>，支持交互式&#x2F;参数式选择推送到 <code>origin</code>&#x2F;<code>backup</code>&#x2F;两者，并可在检测到未提交改动时引导提交。</li>\n<li><strong>内容推进</strong>：已完成并完善了 Day005（DNS）、Day006（HTTP）、Day007（Wireshark 综合分析）、Day008（TLS 概念与握手）的学习卡结构与可复现实操。</li>\n<li><strong>最近一次已验证的上传结果</strong>：Day007 已提交并分别推送到两个远程（<code>origin</code> 与 <code>backup</code>），推送成功。</li>\n</ul>\n<p>你今天的重点，就是在此基础上把 Day008 的“实践证据”（抓包截图&#x2F;命令行输出）补齐，然后提交并同步推送到两个远程，让进度在 GitHub 上可见。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"学习内容\"><a href=\"#学习内容\" class=\"headerlink\" title=\"学习内容\"></a>学习内容</h2><h3 id=\"1️⃣-TLS-解决了什么问题\"><a href=\"#1️⃣-TLS-解决了什么问题\" class=\"headerlink\" title=\"1️⃣ TLS 解决了什么问题\"></a>1️⃣ TLS 解决了什么问题</h3><p>对比明文 HTTP：TLS 主要提供三件事（安全三性）：</p>\n<ol>\n<li><strong>机密性（Confidentiality）</strong>：内容加密后旁路窃听者看不懂</li>\n<li><strong>完整性（Integrity）</strong>：中间人篡改会被检测</li>\n<li><strong>身份认证（Authentication）</strong>：通过证书证明“你连的是谁”</li>\n</ol>\n<p>HTTPS &#x3D; HTTP + TLS。</p>\n<h3 id=\"2️⃣-TLS-版本：你需要记住的结论\"><a href=\"#2️⃣-TLS-版本：你需要记住的结论\" class=\"headerlink\" title=\"2️⃣ TLS 版本：你需要记住的结论\"></a>2️⃣ TLS 版本：你需要记住的结论</h3><ul>\n<li>TLS 1.0&#x2F;1.1：已被主流浏览器&#x2F;服务器逐步禁用（安全性与合规原因）</li>\n<li>TLS 1.2：仍大量存在</li>\n<li>TLS 1.3：更现代、握手更短、默认更安全（弱算法被清理）</li>\n</ul>\n<h3 id=\"3️⃣-密码套件（Cipher-Suite）到底在描述什么\"><a href=\"#3️⃣-密码套件（Cipher-Suite）到底在描述什么\" class=\"headerlink\" title=\"3️⃣ 密码套件（Cipher Suite）到底在描述什么\"></a>3️⃣ 密码套件（Cipher Suite）到底在描述什么</h3><p>在 TLS 1.2 里，一个密码套件通常描述：</p>\n<ul>\n<li><strong>密钥交换&#x2F;协商</strong>（如 ECDHE）</li>\n<li><strong>身份认证</strong>（证书类型，如 RSA&#x2F;ECDSA）</li>\n<li><strong>对称加密算法</strong>（如 AES-GCM &#x2F; ChaCha20-Poly1305）</li>\n<li><strong>摘要&#x2F;认证算法</strong>（现代多为 AEAD，MAC 方式减少）</li>\n</ul>\n<p>在 TLS 1.3 里，套件的概念被简化，协议强制使用（更少的、更安全的）组合。</p>\n<h3 id=\"4️⃣-TLS-1-2-握手（经典版，认识角色）\"><a href=\"#4️⃣-TLS-1-2-握手（经典版，认识角色）\" class=\"headerlink\" title=\"4️⃣ TLS 1.2 握手（经典版，认识角色）\"></a>4️⃣ TLS 1.2 握手（经典版，认识角色）</h3><p>抓包里你经常会看到这些消息（简化）：</p>\n<ol>\n<li><strong>ClientHello</strong>：客户端发起；包含支持的版本、套件、扩展（SNI&#x2F;ALPN…）</li>\n<li><strong>ServerHello</strong>：服务器选择版本与套件</li>\n<li><strong>Certificate</strong>：服务器证书链</li>\n<li>（可选）ServerKeyExchange &#x2F; CertificateRequest</li>\n<li><strong>ClientKeyExchange</strong>：客户端发协商需要的数据</li>\n<li><strong>ChangeCipherSpec + Finished</strong>：切换到加密通道并完成握手</li>\n</ol>\n<blockquote>\n<p>记住：TLS 1.2 的握手消息更“长”，而 TLS 1.3 进行了合并与精简。</p>\n</blockquote>\n<h3 id=\"5️⃣-TLS-1-3-握手（更短、更现代）\"><a href=\"#5️⃣-TLS-1-3-握手（更短、更现代）\" class=\"headerlink\" title=\"5️⃣ TLS 1.3 握手（更短、更现代）\"></a>5️⃣ TLS 1.3 握手（更短、更现代）</h3><p>典型流程（简化）：</p>\n<ol>\n<li><strong>ClientHello</strong>（内含 key_share 等扩展，提前做密钥协商）</li>\n<li><strong>ServerHello</strong>（选定参数后，后续握手消息多会加密）</li>\n<li><strong>EncryptedExtensions</strong></li>\n<li><strong>Certificate</strong>（服务器证书，通常在加密通道里发送）</li>\n<li><strong>CertificateVerify</strong></li>\n<li><strong>Finished</strong></li>\n</ol>\n<h3 id=\"6️⃣-证书链校验：握手里“最常见的失败点”\"><a href=\"#6️⃣-证书链校验：握手里“最常见的失败点”\" class=\"headerlink\" title=\"6️⃣ 证书链校验：握手里“最常见的失败点”\"></a>6️⃣ 证书链校验：握手里“最常见的失败点”</h3><p>客户端会做这些检查：</p>\n<ul>\n<li>证书是否在有效期内（NotBefore&#x2F;NotAfter）</li>\n<li>域名是否匹配（SAN&#x2F;CN）</li>\n<li>证书链是否能构建到受信根 CA（中间证书是否齐全）</li>\n<li>是否被吊销（OCSP&#x2F;CRL，具体取决于环境策略）</li>\n</ul>\n<h3 id=\"7️⃣-SNI-amp-ALPN：抓包里常见的两个扩展\"><a href=\"#7️⃣-SNI-amp-ALPN：抓包里常见的两个扩展\" class=\"headerlink\" title=\"7️⃣ SNI &amp; ALPN：抓包里常见的两个扩展\"></a>7️⃣ SNI &amp; ALPN：抓包里常见的两个扩展</h3><ul>\n<li><strong>SNI（Server Name Indication）</strong>：在 ClientHello 里告诉服务器“我想访问哪个域名”，用于同 IP 多站点。</li>\n<li><strong>ALPN（Application-Layer Protocol Negotiation）</strong>：协商应用层协议（如 HTTP&#x2F;2 的 <code>h2</code> 或 <code>http/1.1</code>）。</li>\n</ul>\n<h2 id=\"实践任务（合法授权范围内）\"><a href=\"#实践任务（合法授权范围内）\" class=\"headerlink\" title=\"实践任务（合法授权范围内）\"></a>实践任务（合法授权范围内）</h2><blockquote>\n<p>目标：用“抓包 + 命令行”两条证据链，确认一次 TLS 握手里关键消息与证书信息。</p>\n</blockquote>\n<h3 id=\"任务-1：Wireshark-抓取一次-HTTPS-握手并标注\"><a href=\"#任务-1：Wireshark-抓取一次-HTTPS-握手并标注\" class=\"headerlink\" title=\"任务 1：Wireshark 抓取一次 HTTPS 握手并标注\"></a>任务 1：Wireshark 抓取一次 HTTPS 握手并标注</h3><ol>\n<li>打开 Wireshark，选择活动网卡开始抓包</li>\n<li>在浏览器访问一个 HTTPS 网站（例如：<code>https://www.bing.com/</code> 或 <code>https://www.github.com/</code>）</li>\n<li>停止抓包</li>\n</ol>\n<p>常用显示过滤器：</p>\n<ul>\n<li>只看 TLS：<code>tls</code></li>\n<li>只看 443：<code>tcp.port == 443</code></li>\n<li>只看握手：<code>tls.handshake</code></li>\n<li>只看 ClientHello：<code>tls.handshake.type == 1</code></li>\n<li>只看 ServerHello：<code>tls.handshake.type == 2</code></li>\n</ul>\n<p>标注要点（写进你的学习成果里）：</p>\n<ul>\n<li>找到一次 ClientHello：记录 SNI（目标域名）、ALPN（h2&#x2F;http1.1）、支持的版本&#x2F;套件（能看到多少写多少）</li>\n<li>找到一次 ServerHello：记录最终选择的版本&#x2F;套件</li>\n<li>找到 Certificate：记录证书主题（Subject）、颁发者（Issuer）、有效期</li>\n</ul>\n<h3 id=\"任务-2：用命令行查看证书-x2F-握手信息\"><a href=\"#任务-2：用命令行查看证书-x2F-握手信息\" class=\"headerlink\" title=\"任务 2：用命令行查看证书&#x2F;握手信息\"></a>任务 2：用命令行查看证书&#x2F;握手信息</h3><h4 id=\"方案-A（优先）：OpenSSL（若你环境有）\"><a href=\"#方案-A（优先）：OpenSSL（若你环境有）\" class=\"headerlink\" title=\"方案 A（优先）：OpenSSL（若你环境有）\"></a>方案 A（优先）：OpenSSL（若你环境有）</h4><p>（示例以 443 为例）</p>\n<ul>\n<li><code>openssl s_client -connect www.bing.com:443 -servername www.bing.com -tls1_2</code></li>\n</ul>\n<p>你重点看：</p>\n<ul>\n<li>证书链（是否包含中间证书）</li>\n<li><code>Protocol</code>&#x2F;<code>Cipher</code>（最终使用的版本与套件）</li>\n</ul>\n<h4 id=\"方案-B（无需-openssl）：Windows-自带-curl\"><a href=\"#方案-B（无需-openssl）：Windows-自带-curl\" class=\"headerlink\" title=\"方案 B（无需 openssl）：Windows 自带 curl\"></a>方案 B（无需 openssl）：Windows 自带 curl</h4><ul>\n<li><code>curl.exe -Iv https://www.bing.com/</code></li>\n</ul>\n<p>你重点看：</p>\n<ul>\n<li>是否显示 TLS 版本与握手摘要信息（不同 Windows 版本输出略有差异）</li>\n<li>证书相关提示&#x2F;重定向位置</li>\n</ul>\n<h2 id=\"巩固练习（题与复盘）\"><a href=\"#巩固练习（题与复盘）\" class=\"headerlink\" title=\"巩固练习（题与复盘）\"></a>巩固练习（题与复盘）</h2><h3 id=\"题目：前向保密（PFS）的意义是什么？\"><a href=\"#题目：前向保密（PFS）的意义是什么？\" class=\"headerlink\" title=\"题目：前向保密（PFS）的意义是什么？\"></a>题目：前向保密（PFS）的意义是什么？</h3><p><strong>PFS（Perfect Forward Secrecy）</strong> 的核心意义：</p>\n<ul>\n<li>即使将来服务器的长期私钥泄露，攻击者也<strong>不能</strong>解密过去抓到的历史会话数据。</li>\n</ul>\n<p>原因（用一句话解释）：</p>\n<ul>\n<li>会话密钥来自每次握手的临时密钥交换（例如 ECDHE），不是直接由长期私钥决定。</li>\n</ul>\n<p>一句话复述模板：</p>\n<ul>\n<li><strong>PFS 的价值</strong>：哪怕服务器私钥以后泄露，历史抓包也解不开。</li>\n</ul>\n<h3 id=\"练习：解释一次握手失败的常见原因（按层次排查）\"><a href=\"#练习：解释一次握手失败的常见原因（按层次排查）\" class=\"headerlink\" title=\"练习：解释一次握手失败的常见原因（按层次排查）\"></a>练习：解释一次握手失败的常见原因（按层次排查）</h3><ol>\n<li><strong>网络&#x2F;连通性问题（TLS 还没开始）</strong></li>\n</ol>\n<ul>\n<li>TCP 443 不通、超时、被防火墙&#x2F;代理拦截</li>\n</ul>\n<ol start=\"2\">\n<li><strong>版本&#x2F;套件不兼容（ClientHello 阶段）</strong></li>\n</ol>\n<ul>\n<li>TLS 版本不匹配（例如服务器只接受 TLS1.2+）</li>\n<li>Cipher Suites 没有交集</li>\n<li>SNI 缺失或错误（同 IP 多站点情况下）</li>\n</ul>\n<ol start=\"3\">\n<li><strong>证书验证失败（最常见）</strong></li>\n</ol>\n<ul>\n<li>证书过期&#x2F;未生效</li>\n<li>域名不匹配（SAN&#x2F;CN 不包含访问域名）</li>\n<li>证书链不完整（缺中间证书）</li>\n<li>CA 不受信任（自签&#x2F;企业 CA 未导入信任）</li>\n</ul>\n<ol start=\"4\">\n<li><strong>密钥协商失败 &#x2F; 环境问题</strong></li>\n</ol>\n<ul>\n<li>客户端&#x2F;服务器时间不准导致证书校验异常</li>\n<li>中间设备对 TLS1.3 支持差（可尝试强制 TLS1.2 验证定位）</li>\n</ul>\n<ol start=\"5\">\n<li><strong>策略要求（mTLS 等）</strong></li>\n</ol>\n<ul>\n<li>服务器要求客户端证书（mTLS），未提供则失败</li>\n</ul>\n<p>快速定位方法（非常实用）：</p>\n<ul>\n<li>看不到 <strong>ClientHello</strong>：大概率是网络&#x2F;443 连接就失败</li>\n<li>有 ClientHello 没有 ServerHello：多半是版本&#x2F;套件&#x2F;SNI&#x2F;中间设备问题</li>\n<li>有 ServerHello 但后面报错：多半是证书校验、时间不准、mTLS 等</li>\n</ul>\n<h2 id=\"评估标准（达成判定）\"><a href=\"#评估标准（达成判定）\" class=\"headerlink\" title=\"评估标准（达成判定）\"></a>评估标准（达成判定）</h2><ul>\n<li>能在抓包中定位：ClientHello &#x2F; ServerHello &#x2F; Certificate（至少各 1 条证据）</li>\n<li>能在命令行输出中定位：TLS 版本、Cipher、证书链（至少 1 条证据）</li>\n<li>能说明 PFS 的意义，以及为什么偏好 ECDHE 类套件</li>\n</ul>\n<h2 id=\"学习成果达成情况（由学习者填写）\"><a href=\"#学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"学习成果达成情况（由学习者填写）\"></a>学习成果达成情况（由学习者填写）</h2><h3 id=\"截图与证据\"><a href=\"#截图与证据\" class=\"headerlink\" title=\"截图与证据\"></a>截图与证据</h3><ul>\n<li>Wireshark 截图（至少 3 张）：<ol>\n<li>ClientHello（能看到 SNI&#x2F;ALPN 任意一个即可）</li>\n<li>ServerHello（能看到最终选择的版本&#x2F;套件任意一个即可）</li>\n<li>Certificate（能看到 Subject&#x2F;Issuer&#x2F;Validity 任意一个即可）</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"关键命令与输出\"><a href=\"#关键命令与输出\" class=\"headerlink\" title=\"关键命令与输出\"></a>关键命令与输出</h3><ul>\n<li>命令（写你实际用的）：</li>\n<li>输出关键行摘录：<ul>\n<li>TLS Version：</li>\n<li>Cipher：</li>\n<li>Cert Subject&#x2F;Issuer：</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"结论与反思\"><a href=\"#结论与反思\" class=\"headerlink\" title=\"结论与反思\"></a>结论与反思</h3><ul>\n<li>今天你确认到的 1 个事实证据（来自抓包或命令行）：</li>\n<li>你认为 TLS 握手失败最常见的原因是哪类？你会怎么排查？</li>\n</ul>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day010：安全协议与加密 - HTTPS 抓包与安全特性","url":"/post/1e53b9d9.html","content":"<h1 id=\"Day010：安全协议与加密-HTTPS-抓包与安全特性\"><a href=\"#Day010：安全协议与加密-HTTPS-抓包与安全特性\" class=\"headerlink\" title=\"Day010：安全协议与加密 - HTTPS 抓包与安全特性\"></a>Day010：安全协议与加密 - HTTPS 抓包与安全特性</h1><ul>\n<li>日期：2026-01-03</li>\n<li>周次：第 2 周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p>学完今天你应该能做到：</p>\n<ul>\n<li>能用一句话解释：<strong>为什么抓包看不到 HTTPS 正文</strong>，但仍然能分析出很多“元信息”</li>\n<li>能在 Wireshark 里定位并说明：<ul>\n<li><strong>TLS 握手</strong>（ClientHello&#x2F;ServerHello&#x2F;Certificate）在哪里</li>\n<li><strong>应用层协议协商</strong>（ALPN：<code>h2</code>&#x2F;<code>http/1.1</code>）在哪里</li>\n<li><strong>加密后的应用数据</strong>（Application Data）是什么</li>\n</ul>\n</li>\n<li>能用 3 条信息描述一次 HTTPS 会话：访问域名（SNI&#x2F;Host）、TLS 版本&#x2F;密码套件、证书主体&#x2F;颁发者&#x2F;有效期</li>\n<li>理解 <strong>HSTS</strong> 的作用、工作方式与限制（理论 + 可观察证据）</li>\n<li>理解 <strong>中间人攻击（MITM）</strong> 在 HTTPS 下为什么更难成功，以及常见“失败点&#x2F;防护点”（仅理论，严禁对未授权目标尝试）</li>\n</ul>\n<span id=\"more\"></span>\n\n<h2 id=\"学习内容\"><a href=\"#学习内容\" class=\"headerlink\" title=\"学习内容\"></a>学习内容</h2><h3 id=\"1️⃣-你为什么看不到-HTTPS-正文（但仍然能分析）\"><a href=\"#1️⃣-你为什么看不到-HTTPS-正文（但仍然能分析）\" class=\"headerlink\" title=\"1️⃣ 你为什么看不到 HTTPS 正文（但仍然能分析）\"></a>1️⃣ 你为什么看不到 HTTPS 正文（但仍然能分析）</h3><p>一句话：</p>\n<ul>\n<li>HTTPS &#x3D; HTTP + TLS；<strong>HTTP 报文在 TLS 之后变成密文</strong>，抓包只能看到加密后的字节流。</li>\n</ul>\n<p>但注意：看不到“正文”，不代表什么都看不到。你仍然能看到（这就是 HTTPS 流量分析的重点）：</p>\n<ul>\n<li><strong>服务器 IP&#x2F;端口</strong>（连接到了谁）</li>\n<li><strong>SNI（ClientHello 里）</strong>：客户端想访问哪个域名</li>\n<li><strong>证书链</strong>：服务器声称自己是谁（Subject&#x2F;Issuer&#x2F;Validity）</li>\n<li><strong>TLS 版本与套件&#x2F;密钥交换信息</strong>：安全强度&#x2F;兼容性线索</li>\n<li><strong>ALPN</strong>：最后用的是 HTTP&#x2F;2（<code>h2</code>）还是 HTTP&#x2F;1.1</li>\n<li><strong>包大小&#x2F;方向&#x2F;时间间隔</strong>：可做性能、行为、异常判断（但不能直接读内容）</li>\n</ul>\n<h3 id=\"2️⃣-Wireshark-里-HTTPS-的“可见点”清单\"><a href=\"#2️⃣-Wireshark-里-HTTPS-的“可见点”清单\" class=\"headerlink\" title=\"2️⃣ Wireshark 里 HTTPS 的“可见点”清单\"></a>2️⃣ Wireshark 里 HTTPS 的“可见点”清单</h3><p>你今天只要牢记这 4 类就够：</p>\n<ol>\n<li><strong>握手</strong>（<code>tls.handshake</code>）：可见协商参数、证书</li>\n<li><strong>Change Cipher Spec &#x2F; Finished</strong>：握手结束（TLS1.3 结构会和 1.2 不同）</li>\n<li><strong>Application Data</strong>：从这里开始基本都是密文（HTTP 正文藏在这里）</li>\n<li><strong>告警&#x2F;失败</strong>（<code>tls.alert_message</code>）：握手失败或连接被终止的线索</li>\n</ol>\n<h3 id=\"3️⃣-HTTP-x2F-2、HTTP-x2F-3-与你在抓包里的体现\"><a href=\"#3️⃣-HTTP-x2F-2、HTTP-x2F-3-与你在抓包里的体现\" class=\"headerlink\" title=\"3️⃣ HTTP&#x2F;2、HTTP&#x2F;3 与你在抓包里的体现\"></a>3️⃣ HTTP&#x2F;2、HTTP&#x2F;3 与你在抓包里的体现</h3><ul>\n<li><strong>HTTP&#x2F;1.1 vs HTTP&#x2F;2</strong>：常见通过 <strong>ALPN</strong> 协商（在 TLS ClientHello&#x2F;ServerHello 里）</li>\n<li><strong>HTTP&#x2F;3</strong>：跑在 QUIC&#x2F;UDP 之上，抓包里你会看到 <code>quic</code>&#x2F;<code>udp.port==443</code>；传统 <code>tls</code>&#x2F;<code>tcp.port==443</code> 的视角会不一样</li>\n</ul>\n<p>今天先把范围收敛：优先抓 <code>tcp.port==443</code> 的 HTTPS（TLS over TCP）。</p>\n<h3 id=\"4️⃣-HSTS（HTTP-Strict-Transport-Security）是什么\"><a href=\"#4️⃣-HSTS（HTTP-Strict-Transport-Security）是什么\" class=\"headerlink\" title=\"4️⃣ HSTS（HTTP Strict Transport Security）是什么\"></a>4️⃣ HSTS（HTTP Strict Transport Security）是什么</h3><p>HSTS 的核心是：</p>\n<ul>\n<li>网站通过响应头告诉浏览器：<strong>未来一段时间内，访问我时必须用 HTTPS</strong>（不允许降级到 HTTP）。</li>\n</ul>\n<p>你能在抓包&#x2F;命令行里看到的“证据”：</p>\n<ul>\n<li>响应头：<code>Strict-Transport-Security: max-age=...; includeSubDomains; preload</code></li>\n</ul>\n<p>HSTS 的价值（防什么）：</p>\n<ul>\n<li>防止用户首次输入 <code>http://</code> 被中间人诱导降级（SSL Stripping）的那类风险</li>\n</ul>\n<p>HSTS 的限制（你要记住的边界）：</p>\n<ul>\n<li><strong>“第一次访问”问题</strong>：如果浏览器第一次从未通过 HTTPS 成功拿到 HSTS 头，就可能仍有窗口期（靠 preload 列表可以缓解）</li>\n<li>HSTS 不能解决“证书被错误签发&#x2F;客户端被装了恶意根证书”等更深层问题</li>\n</ul>\n<h3 id=\"5️⃣-中间人攻击（MITM）在-HTTPS-下为什么更难（仅理论）\"><a href=\"#5️⃣-中间人攻击（MITM）在-HTTPS-下为什么更难（仅理论）\" class=\"headerlink\" title=\"5️⃣ 中间人攻击（MITM）在 HTTPS 下为什么更难（仅理论）\"></a>5️⃣ 中间人攻击（MITM）在 HTTPS 下为什么更难（仅理论）</h3><p>MITM 想成功，通常需要做到至少一条：</p>\n<ul>\n<li>拿到一个对该域名“看起来可信”的证书（被受信任 CA 签发，或客户端信任库被植入恶意根）</li>\n<li>或者让用户忽略证书警告（社工）</li>\n</ul>\n<p>因此防护重点也在这几处：</p>\n<ul>\n<li>正确的证书链校验（Day009）</li>\n<li>HSTS（强制 HTTPS）</li>\n<li>及时更新系统&#x2F;浏览器信任库与策略</li>\n<li>企业环境使用代理&#x2F;自签根时，需要明确告知与合规管理（否则就是“合法的 MITM”）</li>\n</ul>\n<h2 id=\"实践任务（合法授权范围内）\"><a href=\"#实践任务（合法授权范围内）\" class=\"headerlink\" title=\"实践任务（合法授权范围内）\"></a>实践任务（合法授权范围内）</h2><blockquote>\n<p>目标：证明你“看不到正文”，但能把一次 HTTPS 会话说清楚（证据链：Wireshark + curl）。</p>\n</blockquote>\n<h3 id=\"任务-1：Wireshark-抓一次-HTTPS，并定位-4-个关键点\"><a href=\"#任务-1：Wireshark-抓一次-HTTPS，并定位-4-个关键点\" class=\"headerlink\" title=\"任务 1：Wireshark 抓一次 HTTPS，并定位 4 个关键点\"></a>任务 1：Wireshark 抓一次 HTTPS，并定位 4 个关键点</h3><ol>\n<li>打开 Wireshark，选择活动网卡开始抓包</li>\n<li>浏览器访问：<code>https://www.bing.com/</code>（或你常用的 HTTPS 站点）</li>\n<li>停止抓包</li>\n</ol>\n<p>显示过滤器（建议按顺序做）：</p>\n<ul>\n<li>只看 443 TCP：<code>tcp.port == 443</code></li>\n<li>只看 TLS：<code>tls</code></li>\n<li>只看握手：<code>tls.handshake</code></li>\n<li>ClientHello：<code>tls.handshake.type == 1</code></li>\n<li>ServerHello：<code>tls.handshake.type == 2</code></li>\n<li>Certificate：<code>tls.handshake.type == 11</code></li>\n<li>告警：<code>tls.alert_message</code></li>\n</ul>\n<p>你要在“学习成果”里写清楚并截图：</p>\n<ul>\n<li>一条 ClientHello（能看到 SNI&#x2F;ALPN 任意一个即可）</li>\n<li>一条 ServerHello（能看到选定版本&#x2F;套件任意一个即可）</li>\n<li>一条 Certificate（Subject&#x2F;Issuer&#x2F;Validity 任意一个即可）</li>\n<li>一段 Application Data（证明正文已经是密文）</li>\n</ul>\n<h3 id=\"任务-2：用-curl-找-2-类证据（HSTS-协议能力线索）\"><a href=\"#任务-2：用-curl-找-2-类证据（HSTS-协议能力线索）\" class=\"headerlink\" title=\"任务 2：用 curl 找 2 类证据（HSTS + 协议能力线索）\"></a>任务 2：用 curl 找 2 类证据（HSTS + 协议能力线索）</h3><p>更稳定的写法（PowerShell 友好）：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">curl.exe <span class=\"literal\">-I</span> <span class=\"literal\">--silent</span> <span class=\"literal\">--show-error</span> <span class=\"literal\">--location</span> https://www.bing.com/</span><br></pre></td></tr></table></figure>\n\n<p>你重点找：</p>\n<ul>\n<li>是否存在 <code>Strict-Transport-Security</code>（如果站点有 HSTS）</li>\n<li>是否出现 <code>Alt-Svc: h3=...</code>（提示可能支持 HTTP&#x2F;3）</li>\n</ul>\n<p>如果你想看更详细的协商输出：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">curl.exe <span class=\"literal\">-Iv</span> <span class=\"literal\">--silent</span> <span class=\"literal\">--show-error</span> https://www.bing.com/</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"任务-3：对比两个站点（可选加分）\"><a href=\"#任务-3：对比两个站点（可选加分）\" class=\"headerlink\" title=\"任务 3：对比两个站点（可选加分）\"></a>任务 3：对比两个站点（可选加分）</h3><p>选两个站点（例如 <code>bing.com</code> 和 <code>github.com</code>），对比：</p>\n<ul>\n<li>证书 Issuer 是否不同</li>\n<li>是否都返回 HSTS</li>\n<li>ALPN 协商结果是否一致（<code>h2</code> vs <code>http/1.1</code>）</li>\n</ul>\n<h2 id=\"巩固练习（题与复盘）\"><a href=\"#巩固练习（题与复盘）\" class=\"headerlink\" title=\"巩固练习（题与复盘）\"></a>巩固练习（题与复盘）</h2><h3 id=\"题目-1：为什么抓包看不到-HTTPS-正文？\"><a href=\"#题目-1：为什么抓包看不到-HTTPS-正文？\" class=\"headerlink\" title=\"题目 1：为什么抓包看不到 HTTPS 正文？\"></a>题目 1：为什么抓包看不到 HTTPS 正文？</h3><p><strong>思路</strong>：先讲“正文在哪一层”，再讲“为什么加密后就看不到”。</p>\n<p><strong>标准答案</strong>：</p>\n<ul>\n<li>HTTPS 的 HTTP 请求&#x2F;响应正文属于应用层数据，它在 TLS 握手完成后会被加密封装进 <strong>TLS Application Data</strong>。</li>\n<li>抓包只能看到网络上传输的密文与元信息（IP&#x2F;端口、握手、证书、包长与时序），因此无法直接读取正文。</li>\n</ul>\n<h3 id=\"题目-2：既然看不到正文，抓包分析-HTTPS-还有什么意义？\"><a href=\"#题目-2：既然看不到正文，抓包分析-HTTPS-还有什么意义？\" class=\"headerlink\" title=\"题目 2：既然看不到正文，抓包分析 HTTPS 还有什么意义？\"></a>题目 2：既然看不到正文，抓包分析 HTTPS 还有什么意义？</h3><p><strong>思路</strong>：列举“仍可见的证据”与“能解决的问题”。</p>\n<p><strong>标准答案</strong>：</p>\n<ul>\n<li>仍可见：SNI&#x2F;证书链&#x2F;TLS 版本与套件&#x2F;ALPN&#x2F;流量方向与时序&#x2F;告警信息。</li>\n<li>能做：确认连的是谁、证书是否异常、是否降级&#x2F;协商失败、是否疑似被企业代理、性能瓶颈（握手慢&#x2F;重传多）等。</li>\n</ul>\n<h3 id=\"练习：解释-HSTS-的效果与限制\"><a href=\"#练习：解释-HSTS-的效果与限制\" class=\"headerlink\" title=\"练习：解释 HSTS 的效果与限制\"></a>练习：解释 HSTS 的效果与限制</h3><p><strong>思路</strong>：一句话讲效果 + 两条限制。</p>\n<p><strong>标准答案</strong>：</p>\n<ul>\n<li>效果：浏览器收到 <code>Strict-Transport-Security</code> 后，会在 <code>max-age</code> 指定时间内强制对该域名使用 HTTPS，阻止 HTTP 降级。</li>\n<li>限制：首次访问窗口期（没拿到 HSTS 前仍可能被降级）；以及如果客户端信任库被植入恶意根&#x2F;证书误签，HSTS 也不能单独解决。</li>\n</ul>\n<h2 id=\"评估标准（达成判定）\"><a href=\"#评估标准（达成判定）\" class=\"headerlink\" title=\"评估标准（达成判定）\"></a>评估标准（达成判定）</h2><ul>\n<li>能在 Wireshark 中定位：ClientHello &#x2F; ServerHello &#x2F; Certificate &#x2F; Application Data（至少各 1 条证据）</li>\n<li>能解释：为什么看不到正文，但能基于握手与元信息做分析</li>\n<li>能说明：HSTS 的作用与限制，并能在输出中找到 <code>Strict-Transport-Security</code>（若目标站点具备）</li>\n<li>能给出 3 条 MITM 想成功需要满足的条件&#x2F;防护点（仅理论）</li>\n</ul>\n<h2 id=\"学习成果达成情况（由学习者填写）\"><a href=\"#学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"学习成果达成情况（由学习者填写）\"></a>学习成果达成情况（由学习者填写）</h2><h3 id=\"截图与证据\"><a href=\"#截图与证据\" class=\"headerlink\" title=\"截图与证据\"></a>截图与证据</h3><ul>\n<li>Wireshark 截图（至少 4 张）：<ol>\n<li>ClientHello（SNI&#x2F;ALPN 任意一个）</li>\n<li>ServerHello（选定版本&#x2F;套件任意一个）</li>\n<li>Certificate（Subject&#x2F;Issuer&#x2F;Validity 任意一个）</li>\n<li>Application Data（证明正文是密文）</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"关键命令与输出\"><a href=\"#关键命令与输出\" class=\"headerlink\" title=\"关键命令与输出\"></a>关键命令与输出</h3><ul>\n<li>命令：<ul>\n<li><code>curl.exe -I --silent --show-error --location https://...</code></li>\n<li>（可选）<code>curl.exe -Iv --silent --show-error https://...</code></li>\n</ul>\n</li>\n<li>输出关键行摘录：<ul>\n<li>Strict-Transport-Security：</li>\n<li>Alt-Svc（如有）：</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"结论与反思\"><a href=\"#结论与反思\" class=\"headerlink\" title=\"结论与反思\"></a>结论与反思</h3><ul>\n<li>今天你确认到的 1 个事实证据（来自抓包&#x2F;输出，不是“感觉”）：</li>\n<li>你遇到的 1 个坑（例如：抓不到握手&#x2F;走了 QUIC&#x2F;输出差异）：</li>\n<li>明天你想继续深挖的 1 个问题（比如：HTTP&#x2F;3 在抓包里怎么判定）：</li>\n</ul>\n<p>（示例填写，你可以先照抄再改成自己的）</p>\n<ul>\n<li>今天你确认到的 1 个事实证据：<ul>\n<li>我在 <code>curl.exe -I --silent --show-error --location https://github.com/</code> 的输出里看到了：<ul>\n<li><code>Strict-Transport-Security: max-age=31536000; includeSubDomains; preload</code></li>\n<li><code>Alt-Svc: h3=&quot;:443&quot;; ma=...</code><br>这证明该站点启用了 HSTS，并且通过 Alt-Svc 暗示支持 HTTP&#x2F;3。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>我遇到的 1 个坑：<ul>\n<li>我一开始只用 <code>tcp.port == 443</code> 过滤，结果发现有些站点&#x2F;浏览器可能会走 QUIC（UDP 443），导致我“抓不到想要的握手”。后来我用 <code>udp.port == 443</code> &#x2F; <code>quic</code> 再确认是否走了 HTTP&#x2F;3。</li>\n</ul>\n</li>\n<li>明天想继续深挖的 1 个问题：<ul>\n<li>同一个站点在不同访问方式（浏览器 vs curl）下，ALPN&#x2F;协议协商是否一致？我能不能在 Wireshark 的 ClientHello&#x2F;ServerHello 里找到 ALPN 的证据并对上？</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"参考答案（含思路，集中作答）\"><a href=\"#参考答案（含思路，集中作答）\" class=\"headerlink\" title=\"参考答案（含思路，集中作答）\"></a>参考答案（含思路，集中作答）</h2><h3 id=\"题目-1：为什么抓包看不到-HTTPS-正文？-1\"><a href=\"#题目-1：为什么抓包看不到-HTTPS-正文？-1\" class=\"headerlink\" title=\"题目 1：为什么抓包看不到 HTTPS 正文？\"></a>题目 1：为什么抓包看不到 HTTPS 正文？</h3><p><strong>思路</strong>：正文在哪（HTTP）→ 被谁包住（TLS）→ 加密后叫什么（Application Data）。</p>\n<p><strong>答案</strong>：HTTPS 的 HTTP 正文在 TLS 握手完成后会被加密封装进 TLS Application Data，抓包只能看到密文与元信息，因此看不到明文正文。</p>\n<h3 id=\"题目-2：抓不到明文还能分析什么？\"><a href=\"#题目-2：抓不到明文还能分析什么？\" class=\"headerlink\" title=\"题目 2：抓不到明文还能分析什么？\"></a>题目 2：抓不到明文还能分析什么？</h3><p><strong>思路</strong>：列“仍可见的信息” → 对应“能解决的问题”。</p>\n<p><strong>答案</strong>：仍可以分析 SNI、证书链、TLS 版本&#x2F;套件、ALPN、告警、时序与包长等，用于判断连通性&#x2F;协商失败&#x2F;证书异常&#x2F;是否被代理&#x2F;性能问题。</p>\n<h3 id=\"练习：HSTS-的效果与限制\"><a href=\"#练习：HSTS-的效果与限制\" class=\"headerlink\" title=\"练习：HSTS 的效果与限制\"></a>练习：HSTS 的效果与限制</h3><p><strong>思路</strong>：效果一句话 + 两条限制。</p>\n<p><strong>答案</strong>：HSTS 通过 <code>Strict-Transport-Security</code> 让浏览器在 <code>max-age</code> 内强制 HTTPS、防止降级；限制是首次访问窗口期与“信任根被污染&#x2F;证书误签”等更深层问题仍可能绕过。</p>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day011：安全协议与加密 - SSH 与密钥认证","url":"/post/b888cd69.html","content":"<h1 id=\"Day011：安全协议与加密-SSH-与密钥认证\"><a href=\"#Day011：安全协议与加密-SSH-与密钥认证\" class=\"headerlink\" title=\"Day011：安全协议与加密 - SSH 与密钥认证\"></a>Day011：安全协议与加密 - SSH 与密钥认证</h1><ul>\n<li>日期：2026-01-04</li>\n<li>周次：第 2 周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p>学完今天你应该能做到：</p>\n<ul>\n<li>说清 SSH 连接时至少发生了 3 件事：<strong>加密协商</strong>、<strong>服务器身份验证（HostKey）</strong>、<strong>用户身份验证（密码&#x2F;密钥&#x2F;多因素）</strong></li>\n<li>能解释：为什么第一次连某台主机会问你 “Are you sure you want to continue connecting (yes&#x2F;no)?”（本质是 HostKey 信任）</li>\n<li>能在 Windows 上完成：<ul>\n<li>生成一对 SSH 密钥（推荐 Ed25519）</li>\n<li>理解 <code>authorized_keys</code> &#x2F; <code>known_hosts</code> 分别是干什么的</li>\n<li>会写一个最小可用的 <code>~/.ssh/config</code>（主机别名、用户、端口、IdentityFile）</li>\n</ul>\n</li>\n<li>能列出一张“SSH 加固清单”（禁 root、禁密码、限制来源、升级算法、审计）并知道每条在防什么</li>\n</ul>\n<span id=\"more\"></span>\n\n<h2 id=\"学习内容\"><a href=\"#学习内容\" class=\"headerlink\" title=\"学习内容\"></a>学习内容</h2><h3 id=\"1️⃣-SSH-解决的是什么问题\"><a href=\"#1️⃣-SSH-解决的是什么问题\" class=\"headerlink\" title=\"1️⃣ SSH 解决的是什么问题\"></a>1️⃣ SSH 解决的是什么问题</h3><p>SSH（Secure Shell）&#x3D; 为远程登录&#x2F;远程执行命令&#x2F;文件传输提供：</p>\n<ul>\n<li><strong>加密</strong>：防止明文口令与命令被窃听</li>\n<li><strong>完整性</strong>：防篡改</li>\n<li><strong>服务器身份验证</strong>：防止你连到“假服务器”（靠 HostKey）</li>\n</ul>\n<h3 id=\"2️⃣-SSH-连接时发生的三步（最重要）\"><a href=\"#2️⃣-SSH-连接时发生的三步（最重要）\" class=\"headerlink\" title=\"2️⃣ SSH 连接时发生的三步（最重要）\"></a>2️⃣ SSH 连接时发生的三步（最重要）</h3><p>你可以把一次 SSH 连接记成：</p>\n<ol>\n<li><strong>协商加密参数</strong>：算法&#x2F;密钥交换&#x2F; MAC 等（你通常不需要背，但要知道它存在）</li>\n<li><strong>验证服务器身份（HostKey）</strong>：<ul>\n<li>服务器给出自己的 Host Public Key（主机公钥）</li>\n<li>客户端把它记录到 <code>known_hosts</code>（第一次信任）</li>\n<li>下次再连，如果 HostKey 变了，就会报警（可能是换机&#x2F;重装，也可能是 MITM）</li>\n</ul>\n</li>\n<li><strong>验证用户身份（Authentication）</strong>：<ul>\n<li>密码登录（不推荐）</li>\n<li>公钥登录（推荐）</li>\n<li>叠加 MFA（更推荐，企业常用）</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"3️⃣-authorized-keys-vs-known-hosts：别搞反\"><a href=\"#3️⃣-authorized-keys-vs-known-hosts：别搞反\" class=\"headerlink\" title=\"3️⃣ authorized_keys vs known_hosts：别搞反\"></a>3️⃣ <code>authorized_keys</code> vs <code>known_hosts</code>：别搞反</h3><ul>\n<li><code>~/.ssh/authorized_keys</code>（在 <strong>服务器</strong> 上）：<ul>\n<li>决定“哪些客户端公钥可以登录我这个账号”</li>\n</ul>\n</li>\n<li><code>~/.ssh/known_hosts</code>（在 <strong>客户端</strong> 上）：<ul>\n<li>记录“我信任哪些服务器的 HostKey，防止连错服务器&#x2F;被中间人冒充”</li>\n</ul>\n</li>\n</ul>\n<p>一句话区分：</p>\n<ul>\n<li><strong>authorized_keys 管人</strong>（谁能进来）</li>\n<li><strong>known_hosts 管机</strong>（我连的是不是那台机器）</li>\n</ul>\n<h3 id=\"4️⃣-为什么推荐-Ed25519-密钥\"><a href=\"#4️⃣-为什么推荐-Ed25519-密钥\" class=\"headerlink\" title=\"4️⃣ 为什么推荐 Ed25519 密钥\"></a>4️⃣ 为什么推荐 Ed25519 密钥</h3><ul>\n<li>生成快、长度短、安全性高、现代默认推荐（比老的 DSA&#x2F;RSA 更省心）</li>\n</ul>\n<h3 id=\"5️⃣-SSH-常见加固项（你今天要掌握的清单）\"><a href=\"#5️⃣-SSH-常见加固项（你今天要掌握的清单）\" class=\"headerlink\" title=\"5️⃣ SSH 常见加固项（你今天要掌握的清单）\"></a>5️⃣ SSH 常见加固项（你今天要掌握的清单）</h3><blockquote>\n<p>只给你“够用版”，每条都能说出它在防什么。</p>\n</blockquote>\n<ul>\n<li>禁止 root 直接登录：避免“高权限账号暴露在入口”</li>\n<li>禁用密码登录，仅允许公钥：减少弱口令&#x2F;爆破风险</li>\n<li>限制允许登录的用户&#x2F;组：减少攻击面</li>\n<li>只允许特定来源 IP：减少暴露面（尤其是公网）</li>\n<li>禁用旧算法&#x2F;旧协议：避免弱加密</li>\n<li>开启日志审计：出现问题能追溯</li>\n</ul>\n<h2 id=\"实践任务（合法授权范围内）\"><a href=\"#实践任务（合法授权范围内）\" class=\"headerlink\" title=\"实践任务（合法授权范围内）\"></a>实践任务（合法授权范围内）</h2><blockquote>\n<p>目标：即使你没有 Linux 虚拟机，也能在 Windows 上把“密钥、known_hosts、config”这些核心概念练一遍；有虚拟机就做远程登录验证。</p>\n</blockquote>\n<h3 id=\"任务-1（Windows-本地必做）：生成-Ed25519-密钥对\"><a href=\"#任务-1（Windows-本地必做）：生成-Ed25519-密钥对\" class=\"headerlink\" title=\"任务 1（Windows 本地必做）：生成 Ed25519 密钥对\"></a>任务 1（Windows 本地必做）：生成 Ed25519 密钥对</h3><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">ssh<span class=\"literal\">-keygen</span> <span class=\"literal\">-t</span> ed25519 <span class=\"literal\">-a</span> <span class=\"number\">64</span> <span class=\"literal\">-C</span> <span class=\"string\">&quot;day011&quot;</span> <span class=\"operator\">-f</span> <span class=\"string\">&quot;<span class=\"variable\">$env:USERPROFILE</span>\\.ssh\\id_ed25519_day011&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>你会得到：</p>\n<ul>\n<li>私钥：<code>id_ed25519_day011</code>（<strong>不要泄露</strong>）</li>\n<li>公钥：<code>id_ed25519_day011.pub</code>（可以发给服务器）</li>\n</ul>\n<h3 id=\"任务-2（Windows-本地必做）：理解并查看-known-hosts\"><a href=\"#任务-2（Windows-本地必做）：理解并查看-known-hosts\" class=\"headerlink\" title=\"任务 2（Windows 本地必做）：理解并查看 known_hosts\"></a>任务 2（Windows 本地必做）：理解并查看 known_hosts</h3><p>查看 <code>known_hosts</code> 是否存在：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Test-Path</span> <span class=\"string\">&quot;<span class=\"variable\">$env:USERPROFILE</span>\\.ssh\\known_hosts&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>如果你曾经连过任何 SSH 主机，这里会有记录。你可以理解为：</p>\n<ul>\n<li>“我见过这台服务器的 HostKey，以后再连如果变了就要警惕。”</li>\n</ul>\n<h3 id=\"任务-3（Windows-本地必做）：写一个最小-ssh-config（主机别名）\"><a href=\"#任务-3（Windows-本地必做）：写一个最小-ssh-config（主机别名）\" class=\"headerlink\" title=\"任务 3（Windows 本地必做）：写一个最小 ssh config（主机别名）\"></a>任务 3（Windows 本地必做）：写一个最小 ssh config（主机别名）</h3><p>文件位置：<code>$env:USERPROFILE\\.ssh\\config</code></p>\n<p>示例（把 <code>&lt;your-host&gt;</code> <code>&lt;your-user&gt;</code> 替换掉）：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Host mylab</span><br><span class=\"line\">\tHostName &lt;your-host&gt;</span><br><span class=\"line\">\tUser &lt;your-user&gt;</span><br><span class=\"line\">\tPort 22</span><br><span class=\"line\">\tIdentityFile ~/.ssh/id_ed25519_day011</span><br></pre></td></tr></table></figure>\n\n<p>这样以后你就可以用：</p>\n<ul>\n<li><code>ssh mylab</code></li>\n</ul>\n<p>来代替又长又容易打错的一串参数。</p>\n<h3 id=\"任务-4（可选，有自建-Linux-x2F-授权主机时）：配置公钥登录\"><a href=\"#任务-4（可选，有自建-Linux-x2F-授权主机时）：配置公钥登录\" class=\"headerlink\" title=\"任务 4（可选，有自建 Linux&#x2F;授权主机时）：配置公钥登录\"></a>任务 4（可选，有自建 Linux&#x2F;授权主机时）：配置公钥登录</h3><ol>\n<li>把 <code>id_ed25519_day011.pub</code> 的内容追加到服务器的：</li>\n</ol>\n<ul>\n<li><code>~/.ssh/authorized_keys</code></li>\n</ul>\n<ol start=\"2\">\n<li>在服务器上确保权限正确（Linux 上常见要求）：</li>\n</ol>\n<ul>\n<li><code>~/.ssh</code> 目录和 <code>authorized_keys</code> 文件权限合理（过宽会被拒绝）</li>\n</ul>\n<ol start=\"3\">\n<li>登录验证：</li>\n</ol>\n<ul>\n<li><code>ssh -i ~/.ssh/id_ed25519_day011 &lt;user&gt;@&lt;host&gt;</code>（或用上面的 <code>ssh mylab</code>）</li>\n</ul>\n<h3 id=\"任务-5（加固记录）：列出-sshd-config-关键项（有服务器时）\"><a href=\"#任务-5（加固记录）：列出-sshd-config-关键项（有服务器时）\" class=\"headerlink\" title=\"任务 5（加固记录）：列出 sshd_config 关键项（有服务器时）\"></a>任务 5（加固记录）：列出 sshd_config 关键项（有服务器时）</h3><p>把你服务器上的 <code>sshd_config</code> 里这些项的当前值记录下来：</p>\n<ul>\n<li><code>PermitRootLogin</code></li>\n<li><code>PasswordAuthentication</code></li>\n<li><code>PubkeyAuthentication</code></li>\n<li><code>AllowUsers</code> &#x2F; <code>AllowGroups</code></li>\n<li><code>PermitEmptyPasswords</code></li>\n</ul>\n<h2 id=\"巩固练习（题与复盘）\"><a href=\"#巩固练习（题与复盘）\" class=\"headerlink\" title=\"巩固练习（题与复盘）\"></a>巩固练习（题与复盘）</h2><h3 id=\"题目-1：为何建议禁用-root-直登？\"><a href=\"#题目-1：为何建议禁用-root-直登？\" class=\"headerlink\" title=\"题目 1：为何建议禁用 root 直登？\"></a>题目 1：为何建议禁用 root 直登？</h3><p><strong>思路</strong>：入口账号越高权限越危险 → 一旦被爆破&#x2F;泄露直接拿最高权限 → 应改成低权限登录再提权。</p>\n<p><strong>标准答案</strong>：</p>\n<ul>\n<li>禁用 root 直登可以把“最高权限账号”从入口移除。</li>\n<li>即使攻击者拿到 root 口令&#x2F;猜中弱口令，风险会直达系统最高权限；改为普通用户登录再通过 <code>sudo</code> 提权，可以减少攻击面并留下更清晰的审计记录。</li>\n</ul>\n<h3 id=\"题目-2：known-hosts-里记录的是什么？HostKey-变了意味着什么？\"><a href=\"#题目-2：known-hosts-里记录的是什么？HostKey-变了意味着什么？\" class=\"headerlink\" title=\"题目 2：known_hosts 里记录的是什么？HostKey 变了意味着什么？\"></a>题目 2：<code>known_hosts</code> 里记录的是什么？HostKey 变了意味着什么？</h3><p><strong>思路</strong>：<code>known_hosts</code> 记录服务器 HostKey 指纹 → 变了通常是“机器换了&#x2F;重装”或“中间人冒充”。</p>\n<p><strong>标准答案</strong>：</p>\n<ul>\n<li><code>known_hosts</code> 记录的是“服务器的 HostKey（主机公钥）指纹”，用于验证你连到的还是不是那台服务器。</li>\n<li>HostKey 发生变化可能是服务器重装&#x2F;更换密钥，也可能是被中间人攻击或 DNS 污染导致你连到别的机器，因此必须人工核验。</li>\n</ul>\n<h3 id=\"练习：生成-Ed25519-密钥并配置到-ssh-config\"><a href=\"#练习：生成-Ed25519-密钥并配置到-ssh-config\" class=\"headerlink\" title=\"练习：生成 Ed25519 密钥并配置到 ssh config\"></a>练习：生成 Ed25519 密钥并配置到 ssh config</h3><p><strong>思路</strong>：生成密钥 → 指定 IdentityFile → 用 Host alias 简化连接。</p>\n<p><strong>标准答案（参考配置）</strong>：</p>\n<ul>\n<li>密钥生成命令：<ul>\n<li><code>ssh-keygen -t ed25519 -a 64 -C &quot;day011&quot; -f ~/.ssh/id_ed25519_day011</code></li>\n</ul>\n</li>\n<li><code>~/.ssh/config</code> 示例：<ul>\n<li>见“任务 3”</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"评估标准（达成判定）\"><a href=\"#评估标准（达成判定）\" class=\"headerlink\" title=\"评估标准（达成判定）\"></a>评估标准（达成判定）</h2><ul>\n<li>能解释：加密协商 &#x2F; HostKey 验证 &#x2F; 用户认证 3 步分别在干什么</li>\n<li>能生成 Ed25519 密钥，并说清私钥&#x2F;公钥如何存放</li>\n<li>能说清：<code>authorized_keys</code> 与 <code>known_hosts</code> 的区别</li>\n<li>能写出一份 SSH 加固清单（至少 6 条）并说明每条在防什么</li>\n</ul>\n<h2 id=\"学习成果达成情况（由学习者填写）\"><a href=\"#学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"学习成果达成情况（由学习者填写）\"></a>学习成果达成情况（由学习者填写）</h2><h3 id=\"截图与证据\"><a href=\"#截图与证据\" class=\"headerlink\" title=\"截图与证据\"></a>截图与证据</h3><ul>\n<li>本机 <code>.ssh</code> 目录截图或命令输出（隐藏私钥内容，只展示文件名即可）：<ul>\n<li><code>id_ed25519_day011</code> &#x2F; <code>id_ed25519_day011.pub</code></li>\n</ul>\n</li>\n<li>（可选）成功公钥登录的终端截图（打码主机&#x2F;IP）：</li>\n</ul>\n<h3 id=\"关键命令与输出\"><a href=\"#关键命令与输出\" class=\"headerlink\" title=\"关键命令与输出\"></a>关键命令与输出</h3><ul>\n<li>命令：<ul>\n<li><code>ssh-keygen -t ed25519 ...</code></li>\n<li><code>ssh -V</code></li>\n<li>（可选）<code>ssh -vvv mylab</code>（仅用于排障，不要贴全量日志到公开仓库）</li>\n</ul>\n</li>\n<li>输出关键行摘录：<ul>\n<li>OpenSSH 版本：</li>\n<li>首次连接时的 HostKey 指纹提示（如有）：</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"结论与反思\"><a href=\"#结论与反思\" class=\"headerlink\" title=\"结论与反思\"></a>结论与反思</h3><ul>\n<li>今天你确认到的 1 个事实证据（来自命令输出&#x2F;文件）：</li>\n<li>你遇到的 1 个坑（例如：权限&#x2F;路径&#x2F;HostKey changed）：</li>\n<li>明天你想继续深挖的 1 个问题（例如：如何限制来源 IP&#x2F;如何做 MFA）：</li>\n</ul>\n<hr>\n<h2 id=\"参考答案（含思路，集中作答）\"><a href=\"#参考答案（含思路，集中作答）\" class=\"headerlink\" title=\"参考答案（含思路，集中作答）\"></a>参考答案（含思路，集中作答）</h2><h3 id=\"题目-1：为何建议禁用-root-直登？-1\"><a href=\"#题目-1：为何建议禁用-root-直登？-1\" class=\"headerlink\" title=\"题目 1：为何建议禁用 root 直登？\"></a>题目 1：为何建议禁用 root 直登？</h3><p><strong>思路</strong>：减少入口高权限暴露 + 增加审计可追踪性。</p>\n<p><strong>答案</strong>：禁用 root 直登能降低爆破成功的收益与风险，把入口改为普通用户 + sudo，并保留更清晰的操作审计。</p>\n<h3 id=\"题目-2：known-hosts-记录什么？HostKey-变化意味着什么？\"><a href=\"#题目-2：known-hosts-记录什么？HostKey-变化意味着什么？\" class=\"headerlink\" title=\"题目 2：known_hosts 记录什么？HostKey 变化意味着什么？\"></a>题目 2：known_hosts 记录什么？HostKey 变化意味着什么？</h3><p><strong>思路</strong>：客户端记住服务器“指纹”以防连错；变化要核验。</p>\n<p><strong>答案</strong>：<code>known_hosts</code> 记录服务器 HostKey 指纹；变化可能是服务器重装&#x2F;改密钥，也可能是 MITM&#x2F;DNS 污染，必须核验。</p>\n<h3 id=\"练习：生成密钥并配置-config-的最小步骤\"><a href=\"#练习：生成密钥并配置-config-的最小步骤\" class=\"headerlink\" title=\"练习：生成密钥并配置 config 的最小步骤\"></a>练习：生成密钥并配置 config 的最小步骤</h3><p><strong>答案</strong>：</p>\n<ol>\n<li><p><code>ssh-keygen -t ed25519 -a 64 -f ~/.ssh/id_ed25519_day011</code></p>\n</li>\n<li><p>在 <code>~/.ssh/config</code> 写入 Host 别名与 IdentityFile</p>\n</li>\n<li><p><code>ssh mylab</code> 连接验证（仅限自建&#x2F;授权主机）</p>\n</li>\n</ol>\n<p>（示例填写，给自己一个可参考的“完整答案”）</p>\n<ul>\n<li>今天你确认到的 1 个事实证据：<ul>\n<li>我本机生成了 <code>id_ed25519_day011</code> 与 <code>id_ed25519_day011.pub</code>，并能用 <code>ssh -V</code> 显示 OpenSSH 版本（证明环境可用）。</li>\n</ul>\n</li>\n<li>我遇到的 1 个坑：<ul>\n<li>如果服务器 HostKey 变了，客户端会报 <code>REMOTE HOST IDENTIFICATION HAS CHANGED!</code>，需要先核验再处理（不能直接忽略）。</li>\n</ul>\n</li>\n<li>明天最想验证的问题：<ul>\n<li>在 SSHD 上关闭密码登录后，如何确保仍可通过公钥登录且不会把自己锁在门外？</li>\n</ul>\n</li>\n</ul>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day009：安全协议与加密 - 证书与信任链","url":"/post/c49b68ca.html","content":"<h1 id=\"Day009：安全协议与加密-证书与信任链\"><a href=\"#Day009：安全协议与加密-证书与信任链\" class=\"headerlink\" title=\"Day009：安全协议与加密 - 证书与信任链\"></a>Day009：安全协议与加密 - 证书与信任链</h1><ul>\n<li>日期：2026-01-02</li>\n<li>周次：第 2 周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p>学完今天你应该能做到：</p>\n<ul>\n<li>说清 <strong>证书（X.509）在证明什么</strong>：证明“某个公钥属于某个域名&#x2F;组织”，并由谁背书</li>\n<li>说清 <strong>CA&#x2F;中间证书&#x2F;根证书</strong> 的角色，以及“链验证”为什么能建立信任</li>\n<li>能用 <strong>Windows 自带工具</strong>（无需 OpenSSL）拿到一个站点证书，并提取关键字段：SAN、Issuer、Validity、Key Usage</li>\n<li>（可选）会用 <strong>OpenSSL</strong> 做同样的检查，并理解 <code>verify</code>&#x2F;<code>s_client</code> 的输出含义</li>\n<li>能列出 3 类常见失败原因：<strong>域名不匹配 &#x2F; 链不完整或不被信任 &#x2F; 证书过期或被撤销（策略相关）</strong></li>\n</ul>\n<span id=\"more\"></span>\n\n<h2 id=\"学习内容\"><a href=\"#学习内容\" class=\"headerlink\" title=\"学习内容\"></a>学习内容</h2><h3 id=\"1️⃣-证书到底是什么（X-509-的一句话定义）\"><a href=\"#1️⃣-证书到底是什么（X-509-的一句话定义）\" class=\"headerlink\" title=\"1️⃣ 证书到底是什么（X.509 的一句话定义）\"></a>1️⃣ 证书到底是什么（X.509 的一句话定义）</h3><p>证书可以理解为：</p>\n<ul>\n<li><strong>一张“公钥身份证”</strong>：把 <em>主体身份（域名&#x2F;组织）</em> 和 <em>公钥</em> 绑定起来</li>\n<li>由 <strong>签发者（Issuer，通常是 CA）</strong> 用自己的私钥签名背书</li>\n</ul>\n<p>你真正验证的不是“证书长得像不像”，而是：</p>\n<ol>\n<li>证书上的域名是不是我访问的域名（SAN 优先）</li>\n<li>证书是否在有效期内</li>\n<li>颁发者是否可信（能不能一路追溯到受信任的根 CA）</li>\n</ol>\n<h3 id=\"2️⃣-CN、SAN、Key-Usage：最常用的字段（面试-x2F-实战高频）\"><a href=\"#2️⃣-CN、SAN、Key-Usage：最常用的字段（面试-x2F-实战高频）\" class=\"headerlink\" title=\"2️⃣ CN、SAN、Key Usage：最常用的字段（面试&#x2F;实战高频）\"></a>2️⃣ CN、SAN、Key Usage：最常用的字段（面试&#x2F;实战高频）</h3><ul>\n<li><strong>Subject</strong>：证书主体，谁的证书</li>\n<li><strong>CN（Common Name）</strong>：早期用来放域名，但现在 <strong>不再推荐只靠 CN 匹配</strong></li>\n<li><strong>SAN（Subject Alternative Name）</strong>：现代浏览器匹配域名的主要依据（可包含多个域名&#x2F;通配符）</li>\n<li><strong>Issuer</strong>：谁签发的（中间 CA &#x2F; 根 CA）</li>\n<li><strong>Validity</strong>：Not Before &#x2F; Not After（时间不准会导致校验失败）</li>\n<li><strong>Key Usage &#x2F; Extended Key Usage</strong>：这把公钥允许干什么（如 Server Authentication）</li>\n</ul>\n<p>补充（够用就行，不需要背 RFC）：</p>\n<ul>\n<li><strong>Serial Number（序列号）</strong>：CA 给这张证书的“身份证号”，撤销&#x2F;审计会用到</li>\n<li><strong>Signature Algorithm（签名算法）</strong>：这张证书是如何被上级签名的（例如 <code>sha256RSA</code>）</li>\n<li><strong>Public Key（公钥）</strong>：真正用于握手密钥协商&#x2F;验证签名的那把公钥</li>\n<li><strong>Basic Constraints</strong>：是否允许充当 CA（叶子证书一般 <code>CA:FALSE</code>）</li>\n</ul>\n<p>域名匹配“怎么比对”（最常用规则）：</p>\n<ul>\n<li><strong>优先看 SAN</strong>：SAN 里只要有一个名字能匹配访问域名即可</li>\n<li><strong>通配符</strong>：<code>*.example.com</code> 只匹配一级子域（如 <code>a.example.com</code>），不匹配 <code>a.b.example.com</code></li>\n<li><strong>IP 访问</strong>：如果你用 IP 访问（例如 <code>https://1.2.3.4</code>），证书必须在 SAN 里有对应 IP 才算匹配</li>\n</ul>\n<h3 id=\"3️⃣-证书链（Chain）-x2F-信任链（Trust-Chain）怎么工作\"><a href=\"#3️⃣-证书链（Chain）-x2F-信任链（Trust-Chain）怎么工作\" class=\"headerlink\" title=\"3️⃣ 证书链（Chain）&#x2F;信任链（Trust Chain）怎么工作\"></a>3️⃣ 证书链（Chain）&#x2F;信任链（Trust Chain）怎么工作</h3><p>基本结构（从服务器发给客户端的常见顺序）：</p>\n<ul>\n<li>站点证书（Leaf &#x2F; End-Entity）</li>\n<li>1~N 个中间证书（Intermediate CA）</li>\n<li>（根证书 Root CA <strong>通常不会</strong>由服务器发给你，客户端系统里本来就有）</li>\n</ul>\n<p>链验证的核心逻辑：</p>\n<ul>\n<li>用“上一级证书”的公钥，验证“下一级证书”的签名是否正确</li>\n<li>一直验证到“我本机信任的根 CA”则信任成立</li>\n</ul>\n<p>把“链验证”拆成 3 句更容易理解的话：</p>\n<ol>\n<li><p><strong>服务器把它的证书（leaf）给你</strong>，并通常附带 1~N 张中间证书</p>\n</li>\n<li><p><strong>你用中间证书的公钥去验证 leaf 的签名</strong>；再用更上一级验证中间证书……</p>\n</li>\n<li><p>直到能拼出一条路，走到你系统里“已经信任”的根证书（Root CA），这条链才算闭合。</p>\n</li>\n</ol>\n<blockquote>\n<p>为什么根证书通常不由服务器发？因为“根证书是否可信”是由你的系统&#x2F;浏览器预置的信任库决定的，服务器自己说“我信我自己”没意义。</p>\n</blockquote>\n<h3 id=\"3-1️⃣-Windows-信任库（你只要知道这几点）\"><a href=\"#3-1️⃣-Windows-信任库（你只要知道这几点）\" class=\"headerlink\" title=\"3.1️⃣ Windows 信任库（你只要知道这几点）\"></a>3.1️⃣ Windows 信任库（你只要知道这几点）</h3><p>在 Windows 上，证书“信不信”主要看系统证书存储（证书管理器）：</p>\n<ul>\n<li><strong>受信任的根证书颁发机构（Trusted Root Certification Authorities）</strong>：根 CA 在这里 → 默认信任</li>\n<li><strong>中间证书颁发机构（Intermediate Certification Authorities）</strong>：中间 CA 在这里，可帮助链构建</li>\n<li><strong>个人（Personal）</strong>：你自己的证书&#x2F;私钥（比如客户端证书）</li>\n</ul>\n<p>打开方式（两种都行）：</p>\n<ul>\n<li>运行：<code>certmgr.msc</code>（当前用户）</li>\n<li>运行：<code>mmc</code> → 添加管理单元（Certificates）→ 选择“计算机帐户”（更接近系统层）</li>\n</ul>\n<h3 id=\"4️⃣-撤销：CRL-x2F-OCSP（你需要记住的结论）\"><a href=\"#4️⃣-撤销：CRL-x2F-OCSP（你需要记住的结论）\" class=\"headerlink\" title=\"4️⃣ 撤销：CRL &#x2F; OCSP（你需要记住的结论）\"></a>4️⃣ 撤销：CRL &#x2F; OCSP（你需要记住的结论）</h3><ul>\n<li><strong>CRL</strong>：证书撤销列表（列表可能大、更新慢）</li>\n<li><strong>OCSP</strong>：在线查询某张证书是否被撤销（受网络&#x2F;策略影响）</li>\n<li>实际是否“强制检查撤销”，取决于浏览器&#x2F;系统&#x2F;组织策略，所以现实里常见的失败点仍是：域名&#x2F;有效期&#x2F;链不完整。</li>\n</ul>\n<p>你可以把撤销当成“加分项”，先把下面 3 个最常见的失败点练熟：</p>\n<ol>\n<li>域名不匹配（SAN）</li>\n<li>证书过期&#x2F;时间不准（Validity）</li>\n<li>链构建失败（缺中间&#x2F;不受信任根）</li>\n</ol>\n<h3 id=\"5️⃣-看到浏览器-x2F-命令行报错时，怎么快速定位原因\"><a href=\"#5️⃣-看到浏览器-x2F-命令行报错时，怎么快速定位原因\" class=\"headerlink\" title=\"5️⃣ 看到浏览器&#x2F;命令行报错时，怎么快速定位原因\"></a>5️⃣ 看到浏览器&#x2F;命令行报错时，怎么快速定位原因</h3><p>把问题按层拆开（建议照这个顺序排查）：</p>\n<ol>\n<li><strong>连得上吗</strong>：DNS&#x2F;TCP 443 是否通（连不上就别谈证书）</li>\n<li><strong>证书是不是这家网站的</strong>：SAN 是否匹配你访问的域名</li>\n<li><strong>证书还活着吗</strong>：NotBefore&#x2F;NotAfter 是否有效，系统时间是否正确</li>\n<li><strong>链闭合了吗</strong>：有没有中间证书、根是否受信任（企业内网常见）</li>\n<li><strong>策略类</strong>：是否强制 OCSP&#x2F;CRL、是否需要客户端证书（mTLS）</li>\n</ol>\n<p>常见现象 → 可能原因（够用版）：</p>\n<ul>\n<li>“证书不受信任&#x2F;Unknown CA”：缺根 CA 或企业 CA 未导入</li>\n<li>“证书链不完整&#x2F;Unable to get local issuer certificate”：服务器没发全中间证书（或客户端缺中间）</li>\n<li>“域名不匹配&#x2F;Name mismatch”：SAN 不包含该域名（或你用 IP 访问）</li>\n<li>“证书过期&#x2F;NotAfter”：证书过期或系统时间不准</li>\n</ul>\n<h2 id=\"实践任务（合法授权范围内）\"><a href=\"#实践任务（合法授权范围内）\" class=\"headerlink\" title=\"实践任务（合法授权范围内）\"></a>实践任务（合法授权范围内）</h2><blockquote>\n<p>目标：用“无需 OpenSSL”也能完成证书关键字段核验；有 OpenSSL 更好。</p>\n</blockquote>\n<h3 id=\"任务-1（无需-OpenSSL）：用-curl-抓取握手与证书信息\"><a href=\"#任务-1（无需-OpenSSL）：用-curl-抓取握手与证书信息\" class=\"headerlink\" title=\"任务 1（无需 OpenSSL）：用 curl 抓取握手与证书信息\"></a>任务 1（无需 OpenSSL）：用 curl 抓取握手与证书信息</h3><ol>\n<li>选一个 HTTPS 站点（示例：<code>https://www.bing.com/</code>）</li>\n<li>执行（只请求头，带详细信息）：</li>\n</ol>\n<p>说明：在 Windows PowerShell 里，<code>curl.exe</code> 的进度条&#x2F;部分输出可能会被显示为 <code>NativeCommandError</code>，看起来像“报错”，但通常并不影响你拿到 TLS&#x2F;HTTP 头信息。</p>\n<p>更稳定的写法（不显示进度条，只看关键信息）：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">curl.exe <span class=\"literal\">-I</span> <span class=\"literal\">--silent</span> <span class=\"literal\">--show-error</span> <span class=\"literal\">--location</span> https://www.bing.com/</span><br></pre></td></tr></table></figure>\n\n<p>如果你还想看更详细的协商信息，再用：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">curl.exe <span class=\"literal\">-Iv</span> <span class=\"literal\">--silent</span> <span class=\"literal\">--show-error</span> https://www.bing.com/</span><br></pre></td></tr></table></figure>\n\n<p>你要记录到“学习成果”里的信息（不同 Windows 版本输出略不同，能看到多少写多少）：</p>\n<ul>\n<li>TLS 版本&#x2F;协商摘要（如有）</li>\n<li>证书相关提示（如有）</li>\n<li>重定向位置（如有）</li>\n</ul>\n<h3 id=\"任务-2（无需-OpenSSL）：用-PowerShell-获取站点证书并导出到文件\"><a href=\"#任务-2（无需-OpenSSL）：用-PowerShell-获取站点证书并导出到文件\" class=\"headerlink\" title=\"任务 2（无需 OpenSSL）：用 PowerShell 获取站点证书并导出到文件\"></a>任务 2（无需 OpenSSL）：用 PowerShell 获取站点证书并导出到文件</h3><p>下面脚本会连接站点、取出服务器证书并导出为 <code>.cer</code>（DER），然后用系统工具查看：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$hostName</span> = <span class=\"string\">&quot;www.bing.com&quot;</span></span><br><span class=\"line\"><span class=\"variable\">$tcp</span> = <span class=\"built_in\">New-Object</span> System.Net.Sockets.TcpClient(<span class=\"variable\">$hostName</span>, <span class=\"number\">443</span>)</span><br><span class=\"line\"><span class=\"variable\">$ssl</span> = <span class=\"built_in\">New-Object</span> System.Net.Security.SslStream(<span class=\"variable\">$tcp</span>.GetStream(), <span class=\"variable\">$false</span>, (&#123;<span class=\"variable\">$true</span>&#125;))</span><br><span class=\"line\"><span class=\"variable\">$ssl</span>.AuthenticateAsClient(<span class=\"variable\">$hostName</span>)</span><br><span class=\"line\"><span class=\"variable\">$cert</span> = <span class=\"built_in\">New-Object</span> System.Security.Cryptography.X509Certificates.X509Certificate2(<span class=\"variable\">$ssl</span>.RemoteCertificate)</span><br><span class=\"line\"><span class=\"variable\">$path</span> = <span class=\"string\">&quot;day009_<span class=\"variable\">$</span>(<span class=\"variable\">$hostName</span>.Replace(&#x27;.&#x27;,&#x27;_&#x27;)).cer&quot;</span></span><br><span class=\"line\">[<span class=\"type\">System.IO.File</span>]::WriteAllBytes(<span class=\"variable\">$path</span>, <span class=\"variable\">$cert</span>.Export([<span class=\"type\">System.Security.Cryptography.X509Certificates.X509ContentType</span>]::Cert))</span><br><span class=\"line\"><span class=\"variable\">$cert</span> | <span class=\"built_in\">Format-List</span> Subject, Issuer, NotBefore, NotAfter, Thumbprint</span><br><span class=\"line\"><span class=\"built_in\">Write-Host</span> <span class=\"string\">&quot;Exported to <span class=\"variable\">$path</span>&quot;</span></span><br><span class=\"line\"><span class=\"variable\">$ssl</span>.Dispose(); <span class=\"variable\">$tcp</span>.Close()</span><br></pre></td></tr></table></figure>\n\n<p>接着查看证书详细信息（系统自带）：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">certutil <span class=\"literal\">-dump</span> .\\day009_www_bing_com.cer</span><br></pre></td></tr></table></figure>\n\n<p>你重点找这些字段并摘录：</p>\n<ul>\n<li>Subject &#x2F; Issuer</li>\n<li>Validity（NotBefore&#x2F;NotAfter）</li>\n<li>SAN（Subject Alternative Name）</li>\n<li>EKU（如 Server Authentication）</li>\n</ul>\n<h3 id=\"任务-3（可选，有-OpenSSL-时）：查看链与验证结果\"><a href=\"#任务-3（可选，有-OpenSSL-时）：查看链与验证结果\" class=\"headerlink\" title=\"任务 3（可选，有 OpenSSL 时）：查看链与验证结果\"></a>任务 3（可选，有 OpenSSL 时）：查看链与验证结果</h3><ol>\n<li>直接看握手与证书链：</li>\n</ol>\n<ul>\n<li><code>openssl s_client -connect www.bing.com:443 -servername www.bing.com -showcerts</code></li>\n</ul>\n<ol start=\"2\">\n<li>验证链（需要你把中间证书&#x2F;根证书准备成文件时才更完整）：</li>\n</ol>\n<ul>\n<li><code>openssl verify -CAfile &lt;root_or_bundle.pem&gt; &lt;leaf.pem&gt;</code></li>\n</ul>\n<p>你要理解的输出关键词：</p>\n<ul>\n<li><code>Verify return code: 0 (ok)</code>：链验证通过</li>\n<li>其他非 0：要么链不完整、要么不受信任、要么用途&#x2F;名称&#x2F;时间有问题</li>\n</ul>\n<h3 id=\"任务-4（与-Wireshark-联动）：从抓包里对应到“证书链”\"><a href=\"#任务-4（与-Wireshark-联动）：从抓包里对应到“证书链”\" class=\"headerlink\" title=\"任务 4（与 Wireshark 联动）：从抓包里对应到“证书链”\"></a>任务 4（与 Wireshark 联动）：从抓包里对应到“证书链”</h3><p>在 Wireshark 里过滤：</p>\n<ul>\n<li><code>tls.handshake.type == 11</code>（Certificate）</li>\n</ul>\n<p>找到 <code>Certificate</code> 消息后：</p>\n<ul>\n<li>看证书列表里有几张（leaf + intermediates）</li>\n<li>记录 leaf 的 Subject &#x2F; Issuer &#x2F; Validity</li>\n<li>对照你在 PowerShell&#x2F;certutil 中看到的字段是否一致</li>\n</ul>\n<h2 id=\"巩固练习（题与复盘）\"><a href=\"#巩固练习（题与复盘）\" class=\"headerlink\" title=\"巩固练习（题与复盘）\"></a>巩固练习（题与复盘）</h2><h3 id=\"题目-1：为何不再使用“仅-CN”做域名匹配？\"><a href=\"#题目-1：为何不再使用“仅-CN”做域名匹配？\" class=\"headerlink\" title=\"题目 1：为何不再使用“仅 CN”做域名匹配？\"></a>题目 1：为何不再使用“仅 CN”做域名匹配？</h3><p>要点：</p>\n<ul>\n<li>现代证书允许一个证书覆盖多个域名&#x2F;通配符，<strong>SAN 才是标准位置</strong></li>\n<li>浏览器实现与标准（RFC&#x2F;CA&#x2F;B Baseline Requirements）逐步要求以 SAN 为准</li>\n<li>只看 CN 容易产生兼容性与安全边界问题</li>\n</ul>\n<p>一句话回答模板：</p>\n<ul>\n<li><strong>现在以 SAN 为准</strong>，CN 主要是历史兼容字段，不能再作为唯一匹配依据。</li>\n</ul>\n<p>解题思路（你可以照着套）：</p>\n<ol>\n<li>先说“现代证书的规范位置在哪” → SAN</li>\n<li>再说“CN 的定位是什么” → 历史兼容</li>\n<li>最后给结论 → 只看 CN 不可靠&#x2F;不符合现代验证逻辑</li>\n</ol>\n<h3 id=\"题目-2：链验证失败的-3-个典型原因是什么？\"><a href=\"#题目-2：链验证失败的-3-个典型原因是什么？\" class=\"headerlink\" title=\"题目 2：链验证失败的 3 个典型原因是什么？\"></a>题目 2：链验证失败的 3 个典型原因是什么？</h3><ul>\n<li>缺中间证书（服务器没发全）</li>\n<li>客户端缺根 CA&#x2F;企业 CA（不受信任）</li>\n<li>时间不准或证书过期（NotBefore&#x2F;NotAfter）</li>\n</ul>\n<p>解题思路：把“链验证”拆成 3 次检查，然后每一步给一个会失败的点：</p>\n<ol>\n<li>leaf 是否归属这个域名（SAN）</li>\n<li>leaf 是否在有效期内（Validity）</li>\n<li>leaf 的签名能不能一路验证到受信任根（链&#x2F;信任库）</li>\n</ol>\n<p>标准答案（直接写在笔记里也行）：</p>\n<ol>\n<li><strong>缺中间证书</strong>（服务器未发送完整链，导致无法构建到根）</li>\n<li><strong>根不受信任</strong>（客户端缺根 CA&#x2F;企业 CA 未导入信任库）</li>\n<li><strong>时间&#x2F;有效期问题</strong>（证书过期或系统时间不正确）</li>\n</ol>\n<h3 id=\"练习：给定证书，指出有效期与用途\"><a href=\"#练习：给定证书，指出有效期与用途\" class=\"headerlink\" title=\"练习：给定证书，指出有效期与用途\"></a>练习：给定证书，指出有效期与用途</h3><p>从 <code>certutil -dump</code> 或证书查看器里找到：</p>\n<ul>\n<li>NotBefore &#x2F; NotAfter</li>\n<li>Enhanced Key Usage（Server Authentication &#x2F; Client Authentication 等）</li>\n</ul>\n<p>解题思路：你只要在输出里“定位两个区域”就够了：</p>\n<ol>\n<li>找到 <code>NotBefore</code> 与 <code>NotAfter</code> 两行（有效期）</li>\n<li>找到 <code>Enhanced Key Usage</code>（用途）</li>\n</ol>\n<p>参考答案模板（把括号里的内容替换成你看到的）：</p>\n<ul>\n<li>有效期：从 <strong>(NotBefore 时间)</strong> 到 <strong>(NotAfter 时间)</strong></li>\n<li>用途（EKU）：包含 **(Server Authentication&#x2F;Client Authentication&#x2F;… )**，说明这张证书用于 <strong>(服务器认证&#x2F;客户端认证&#x2F;… )</strong></li>\n</ul>\n<h2 id=\"评估标准（达成判定）\"><a href=\"#评估标准（达成判定）\" class=\"headerlink\" title=\"评估标准（达成判定）\"></a>评估标准（达成判定）</h2><ul>\n<li>能说清“证书证明的是什么”，以及 CA&#x2F;中间&#x2F;根的关系</li>\n<li>能从证书中定位并解释：SAN、Issuer、Validity、EKU&#x2F;Key Usage（至少 4 项）</li>\n<li>能用 Windows 工具导出并 <code>certutil -dump</code> 查看证书</li>\n<li>能给出链验证失败的分层排查思路（链不完整 &#x2F; 不受信任 &#x2F; 时间与域名）</li>\n</ul>\n<h2 id=\"学习成果达成情况（由学习者填写）\"><a href=\"#学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"学习成果达成情况（由学习者填写）\"></a>学习成果达成情况（由学习者填写）</h2><h3 id=\"截图与证据\"><a href=\"#截图与证据\" class=\"headerlink\" title=\"截图与证据\"></a>截图与证据</h3><ul>\n<li><code>certutil -dump</code> 关键字段截图或复制粘贴：<ul>\n<li>Subject：</li>\n<li>Issuer：</li>\n<li>Validity（NotBefore&#x2F;NotAfter）：</li>\n<li>SAN：</li>\n<li>EKU：</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"关键命令与输出\"><a href=\"#关键命令与输出\" class=\"headerlink\" title=\"关键命令与输出\"></a>关键命令与输出</h3><ul>\n<li>命令：<ul>\n<li><code>curl.exe -Iv https://...</code></li>\n<li>PowerShell 导出证书脚本（是否成功导出 <code>.cer</code>）：</li>\n<li><code>certutil -dump .\\xxx.cer</code></li>\n</ul>\n</li>\n<li>输出关键行摘录：<ul>\n<li>证书指纹（Thumbprint）：</li>\n<li>SAN 关键行：</li>\n<li>Validity：</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"结论与反思\"><a href=\"#结论与反思\" class=\"headerlink\" title=\"结论与反思\"></a>结论与反思</h3><ul>\n<li>今天你确认到的 1 个事实证据（来自输出，不是“感觉”）：</li>\n<li>你遇到的 1 个坑（例如：时间不准&#x2F;站点重定向&#x2F;输出差异）：</li>\n<li>明天（Day010）你最想带着去验证的一个问题：</li>\n</ul>\n<p>（示例填写，给自己一个可参考的“完整答案”）</p>\n<ul>\n<li>今天你确认到的 1 个事实证据：<ul>\n<li>我用 PowerShell 导出 <code>www.bing.com</code> 的证书后，看到 <code>Subject=CN=www.bing.com</code>，<code>Issuer=Microsoft Azure RSA TLS Issuing CA 04</code>，有效期 <code>NotBefore=2025-12-17</code> 到 <code>NotAfter=2026-06-15</code>（这些字段来自命令输出）。</li>\n</ul>\n</li>\n<li>我遇到的 1 个坑：<ul>\n<li>在 Windows PowerShell 里直接跑 <code>curl.exe -Iv</code> 时，进度条&#x2F;部分输出会显示成 <code>NativeCommandError</code>，看起来像失败；改用 <code>curl.exe -I --silent --show-error --location</code> 后信息更干净。</li>\n</ul>\n</li>\n<li>明天最想验证的问题：<ul>\n<li>在 Wireshark 的 <code>Certificate</code> 握手里看到的证书列表（leaf + intermediates），是否能和我导出的证书字段一一对应？如果链不完整会在抓包里表现成什么？</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"参考答案（含思路，集中作答）\"><a href=\"#参考答案（含思路，集中作答）\" class=\"headerlink\" title=\"参考答案（含思路，集中作答）\"></a>参考答案（含思路，集中作答）</h2><blockquote>\n<p>说明：下面把本文出现的所有“题目&#x2F;练习”集中给出<strong>思路 + 标准答案</strong>；你做完再回来对照即可。</p>\n</blockquote>\n<h3 id=\"题目-1：为何不再使用“仅-CN”做域名匹配？-1\"><a href=\"#题目-1：为何不再使用“仅-CN”做域名匹配？-1\" class=\"headerlink\" title=\"题目 1：为何不再使用“仅 CN”做域名匹配？\"></a>题目 1：为何不再使用“仅 CN”做域名匹配？</h3><p><strong>思路</strong>：</p>\n<ol>\n<li>先讲“现在标准在哪里” → SAN</li>\n<li>再讲“CN 的定位” → 历史兼容字段</li>\n<li>最后落到结论 → 只看 CN 可能匹配错误&#x2F;不符合现代验证规则</li>\n</ol>\n<p><strong>标准答案</strong>：</p>\n<ul>\n<li>现代 TLS&#x2F;浏览器在做主机名验证时，<strong>以证书的 SAN（Subject Alternative Name）为准</strong>；CN（Common Name）主要用于历史兼容，不能再作为唯一依据。</li>\n<li>原因是 SAN 才是标准字段，能表达多个域名&#x2F;通配符等场景；只看 CN 会带来兼容性问题，也可能导致验证边界不清。</li>\n</ul>\n<p><strong>常见误区</strong>：</p>\n<ul>\n<li>误区：”CN 写了域名就一定能用” → 实际上很多实现会忽略 CN 或只在没有 SAN 时才回退。</li>\n</ul>\n<h3 id=\"题目-2：链验证失败的-3-个典型原因是什么？-1\"><a href=\"#题目-2：链验证失败的-3-个典型原因是什么？-1\" class=\"headerlink\" title=\"题目 2：链验证失败的 3 个典型原因是什么？\"></a>题目 2：链验证失败的 3 个典型原因是什么？</h3><p><strong>思路</strong>：把链验证拆成“能否构建到根”的过程，分别给出会失败的点：</p>\n<ul>\n<li>是否能拿到完整链（中间证书）</li>\n<li>根是否受信任（信任库）</li>\n<li>时间是否有效（有效期&#x2F;系统时间）</li>\n</ul>\n<p><strong>标准答案</strong>：</p>\n<ol>\n<li><strong>缺中间证书</strong>：服务器没有把中间证书发全，客户端无法构建到受信任根</li>\n<li><strong>根不受信任</strong>：客户端没有对应根 CA（或企业 CA），导致 Unknown CA&#x2F;Untrusted</li>\n<li><strong>时间&#x2F;有效期问题</strong>：证书过期、未生效，或客户端系统时间不正确</li>\n</ol>\n<h3 id=\"练习：给定证书，指出有效期与用途-1\"><a href=\"#练习：给定证书，指出有效期与用途-1\" class=\"headerlink\" title=\"练习：给定证书，指出有效期与用途\"></a>练习：给定证书，指出有效期与用途</h3><p><strong>思路</strong>：只要会在输出里找两块信息即可：</p>\n<ul>\n<li><code>NotBefore</code>&#x2F;<code>NotAfter</code> → 有效期</li>\n<li><code>Enhanced Key Usage (EKU)</code> → 用途</li>\n</ul>\n<p><strong>标准答案模板（直接替换括号内容）</strong>：</p>\n<ul>\n<li>有效期：从 <strong>(NotBefore 时间)</strong> 到 <strong>(NotAfter 时间)</strong></li>\n<li>用途（EKU）：包含 <strong>(Server Authentication&#x2F;Client Authentication&#x2F;… )</strong></li>\n</ul>\n<p><strong>举例（示例答案，便于你对照格式）</strong>：</p>\n<ul>\n<li>有效期：从 <strong>2025-12-17 06:38</strong> 到 <strong>2026-06-15 06:38</strong></li>\n<li>用途（EKU）：包含 <strong>Server Authentication</strong>，说明这张证书用于 <strong>服务器身份认证（HTTPS 网站）</strong></li>\n</ul>\n<h3 id=\"复盘题（衔接-Day010）：你明天最想带着去验证的一个问题是什么？\"><a href=\"#复盘题（衔接-Day010）：你明天最想带着去验证的一个问题是什么？\" class=\"headerlink\" title=\"复盘题（衔接 Day010）：你明天最想带着去验证的一个问题是什么？\"></a>复盘题（衔接 Day010）：你明天最想带着去验证的一个问题是什么？</h3><p><strong>思路</strong>：选一个“能用抓包验证”的问题（能在 Wireshark 里看到证据），而不是抽象问题。</p>\n<p><strong>示例答案</strong>：</p>\n<ul>\n<li>我想验证：当我访问 <code>https://www.bing.com/</code> 时，Wireshark 的 <code>Certificate</code> 握手消息里是否包含中间证书？如果只看到 leaf，没有 intermediate，那么客户端是如何补全链的（AIA 下载&#x2F;系统缓存）？</li>\n</ul>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day013：安全协议与加密 - 加密应用与场景","url":"/post/4138cc96.html","content":"<h1 id=\"Day013：安全协议与加密-加密应用与场景\"><a href=\"#Day013：安全协议与加密-加密应用与场景\" class=\"headerlink\" title=\"Day013：安全协议与加密 - 加密应用与场景\"></a>Day013：安全协议与加密 - 加密应用与场景</h1><ul>\n<li>日期：2026-01-06</li>\n<li>周次：第 2 周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p>学完今天你应该能做到：</p>\n<ul>\n<li>能把”加密”分成 3 类场景：<strong>传输中</strong>、<strong>存储中</strong>、<strong>认证&#x2F;签名</strong></li>\n<li>能识别 5 个常见错误：<ul>\n<li>明文存密码</li>\n<li>可逆加密存密码</li>\n<li>没盐（salt）</li>\n<li>迭代太低&#x2F;用快哈希（如 SHA-256）直接存密码</li>\n<li>密钥硬编码&#x2F;长期不轮换</li>\n</ul>\n</li>\n<li>能输出一张你自己的”应用加密检查清单”（照着抄也行）</li>\n<li>能用 Python 演示”快哈希 vs 慢 KDF”的性能差异</li>\n<li>能写出一份完整的密码存储设计文档</li>\n</ul>\n<span id=\"more\"></span>\n\n<h2 id=\"学习内容\"><a href=\"#学习内容\" class=\"headerlink\" title=\"学习内容\"></a>学习内容</h2><h3 id=\"1️⃣-传输中加密（In-Transit）：你最常见看到的-TLS-x2F-HTTPS\"><a href=\"#1️⃣-传输中加密（In-Transit）：你最常见看到的-TLS-x2F-HTTPS\" class=\"headerlink\" title=\"1️⃣ 传输中加密（In Transit）：你最常见看到的 TLS&#x2F;HTTPS\"></a>1️⃣ 传输中加密（In Transit）：你最常见看到的 TLS&#x2F;HTTPS</h3><p><strong>核心原理（1 句话）</strong>：用加密保护”数据在网络上飞”的过程。</p>\n<h4 id=\"你关注-3-点就够：\"><a href=\"#你关注-3-点就够：\" class=\"headerlink\" title=\"你关注 3 点就够：\"></a>你关注 3 点就够：</h4><p><strong>A. 是否加密（是不是 HTTPS）</strong></p>\n<ul>\n<li>看地址栏：<code>https://</code> 开头 + 小锁图标 🔒</li>\n<li>抓包看：Wireshark 显示 <code>TLS</code> 而不是明文 <code>HTTP</code></li>\n<li>Chrome 开发者工具：Network → Protocol 列显示 <code>h2</code>（HTTP&#x2F;2 over TLS）</li>\n</ul>\n<p><strong>B. 是否验证身份（证书可信吗）</strong></p>\n<p>检查证书的 4 个要素：</p>\n<table>\n<thead>\n<tr>\n<th>检查项</th>\n<th>怎么看</th>\n<th>合格标准</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>域名匹配</td>\n<td>点小锁 → 证书详情 → “颁发给”</td>\n<td>与访问的域名一致</td>\n</tr>\n<tr>\n<td>有效期</td>\n<td>证书详情 → “有效期自…至…”</td>\n<td>当前日期在有效期内</td>\n</tr>\n<tr>\n<td>证书链</td>\n<td>证书详情 → “证书路径”</td>\n<td>Root CA → Intermediate CA → 网站证书</td>\n</tr>\n<tr>\n<td>受信任</td>\n<td>浏览器无红色警告</td>\n<td>根证书在操作系统信任列表中</td>\n</tr>\n</tbody></table>\n<p><strong>C. 是否能被降级&#x2F;误用</strong></p>\n<table>\n<thead>\n<tr>\n<th>风险类型</th>\n<th>表现</th>\n<th>危害</th>\n<th>检测方法</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>混合内容（Mixed Content）</td>\n<td>HTTPS 页面加载 HTTP 资源（图片&#x2F;JS&#x2F;CSS）</td>\n<td>部分资源可能被劫持</td>\n<td>浏览器 F12 控制台黄色&#x2F;红色警告</td>\n</tr>\n<tr>\n<td>老 TLS 版本</td>\n<td>使用 TLS 1.0&#x2F;1.1</td>\n<td>容易被攻击（如 BEAST、POODLE）</td>\n<td><code>curl -v</code> 查看 TLS version</td>\n</tr>\n<tr>\n<td>证书固定失效</td>\n<td>APP 不验证证书链</td>\n<td>中间人攻击</td>\n<td>抓包工具能解密 HTTPS</td>\n</tr>\n<tr>\n<td>HTTP 自动跳转失败</td>\n<td>输入 <code>http://</code> 不跳转到 <code>https://</code></td>\n<td>首次访问被劫持</td>\n<td>手动测试 <code>curl -I http://site</code></td>\n</tr>\n</tbody></table>\n<h4 id=\"常见坑（你要会识别）\"><a href=\"#常见坑（你要会识别）\" class=\"headerlink\" title=\"常见坑（你要会识别）\"></a>常见坑（你要会识别）</h4><table>\n<thead>\n<tr>\n<th>坑</th>\n<th>后果</th>\n<th>怎么发现</th>\n<th>如何修复</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>证书过期</td>\n<td>浏览器拒绝访问（NET::ERR_CERT_DATE_INVALID）</td>\n<td>点小锁看有效期</td>\n<td>续期证书（Let’s Encrypt 可免费自动续期）</td>\n</tr>\n<tr>\n<td>自签名证书</td>\n<td>浏览器警告”不安全”</td>\n<td>证书链中找不到受信任的根 CA</td>\n<td>用受信任 CA 签发证书或将根证书加入信任列表</td>\n</tr>\n<tr>\n<td>域名不匹配</td>\n<td>中间人攻击风险</td>\n<td>证书颁发给 <code>example.com</code> 但访问 <code>test.com</code></td>\n<td>申请多域名证书（SAN）或通配符证书</td>\n</tr>\n<tr>\n<td>混合内容</td>\n<td>部分资源未加密，可能被劫持</td>\n<td>浏览器 F12 控制台有黄色&#x2F;红色警告</td>\n<td>所有资源改用 HTTPS 或相对协议 <code>//cdn.example.com/style.css</code></td>\n</tr>\n</tbody></table>\n<h3 id=\"2️⃣-存储中加密（At-Rest）：盘上-x2F-库里的一切\"><a href=\"#2️⃣-存储中加密（At-Rest）：盘上-x2F-库里的一切\" class=\"headerlink\" title=\"2️⃣ 存储中加密（At Rest）：盘上&#x2F;库里的一切\"></a>2️⃣ 存储中加密（At Rest）：盘上&#x2F;库里的一切</h3><p><strong>核心原理（1 句话）</strong>：数据存在硬盘&#x2F;数据库时也要保护，防止物理失窃&#x2F;备份泄露。</p>\n<h4 id=\"这里容易犯的错（新手常见）\"><a href=\"#这里容易犯的错（新手常见）\" class=\"headerlink\" title=\"这里容易犯的错（新手常见）\"></a>这里容易犯的错（新手常见）</h4><table>\n<thead>\n<tr>\n<th>错误做法</th>\n<th>为什么不行</th>\n<th>正确做法</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>❌ 明文存密码</td>\n<td>数据库泄露 &#x3D; 密码直接曝光</td>\n<td>用 KDF 哈希 + salt</td>\n</tr>\n<tr>\n<td>❌ MD5&#x2F;SHA-256 存密码</td>\n<td>太快，GPU 每秒可尝试数十亿次</td>\n<td>用 bcrypt&#x2F;Argon2&#x2F;scrypt&#x2F;PBKDF2</td>\n</tr>\n<tr>\n<td>❌ AES 加密存密码</td>\n<td>密钥泄露就能批量解密</td>\n<td>密码不需要可逆，用哈希不用加密</td>\n</tr>\n<tr>\n<td>❌ 统一 salt</td>\n<td>重复密码会暴露（相同 hash）</td>\n<td>每个用户独立随机 salt</td>\n</tr>\n<tr>\n<td>❌ 迭代次数太低</td>\n<td>爆破成本太低</td>\n<td>PBKDF2 ≥ 200,000 次，bcrypt work_factor ≥ 10</td>\n</tr>\n</tbody></table>\n<h4 id=\"正确方向（分两类数据）\"><a href=\"#正确方向（分两类数据）\" class=\"headerlink\" title=\"正确方向（分两类数据）\"></a>正确方向（分两类数据）</h4><h5 id=\"A-密码存储（不可逆，只能验证）\"><a href=\"#A-密码存储（不可逆，只能验证）\" class=\"headerlink\" title=\"A. 密码存储（不可逆，只能验证）\"></a>A. 密码存储（不可逆，只能验证）</h5><p>用 <strong>KDF</strong>（Key Derivation Function，密钥派生函数）而不是普通哈希：</p>\n<table>\n<thead>\n<tr>\n<th>KDF 算法</th>\n<th>特点</th>\n<th>推荐指数</th>\n<th>成本参数</th>\n<th>Python 库</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Argon2</strong></td>\n<td>2015 年密码哈希竞赛冠军，抗 GPU&#x2F;ASIC，内存困难</td>\n<td>⭐⭐⭐⭐⭐</td>\n<td><code>memory_cost=65536</code>, <code>time_cost=3</code>, <code>parallelism=4</code></td>\n<td><code>argon2-cffi</code></td>\n</tr>\n<tr>\n<td><strong>scrypt</strong></td>\n<td>内存困难，较老但仍安全</td>\n<td>⭐⭐⭐⭐</td>\n<td><code>N=2^14</code>, <code>r=8</code>, <code>p=1</code></td>\n<td><code>hashlib.scrypt</code> (Python 3.6+)</td>\n</tr>\n<tr>\n<td><strong>bcrypt</strong></td>\n<td>工业标准，广泛支持，Blowfish 变种</td>\n<td>⭐⭐⭐⭐</td>\n<td><code>work_factor=10~12</code>（每增加 1，慢 2 倍）</td>\n<td><code>bcrypt</code></td>\n</tr>\n<tr>\n<td><strong>PBKDF2</strong></td>\n<td>标准库自带，最基础，NIST 推荐</td>\n<td>⭐⭐⭐</td>\n<td><code>iterations=200,000~600,000</code></td>\n<td><code>hashlib.pbkdf2_hmac</code></td>\n</tr>\n</tbody></table>\n<p><strong>为什么要 KDF？（用对比说明）</strong></p>\n<table>\n<thead>\n<tr>\n<th>对比项</th>\n<th>SHA-256（快哈希）</th>\n<th>bcrypt（KDF）</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>单次计算时间</td>\n<td>0.001 ms</td>\n<td>100-300 ms</td>\n</tr>\n<tr>\n<td>GPU 每秒尝试次数</td>\n<td>数十亿次</td>\n<td>数千次</td>\n</tr>\n<tr>\n<td>8 字符密码爆破时间</td>\n<td>几小时</td>\n<td>数百年</td>\n</tr>\n<tr>\n<td>是否需要 salt</td>\n<td>可选（但必须）</td>\n<td>内置 salt 机制</td>\n</tr>\n<tr>\n<td>能否调节难度</td>\n<td>不能</td>\n<td>可以（随硬件升级增加成本）</td>\n</tr>\n</tbody></table>\n<p><strong>bcrypt 存储格式详解</strong>（以 bcrypt 为例）：</p>\n<figure class=\"highlight text\"><table><tr><td class=\"code\"><pre><span class=\"line\">$2b$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p/.CPY.tHOHEa2xFH0p3.O</span><br><span class=\"line\"> │  │  │                                               │</span><br><span class=\"line\"> │  │  └─ salt（22 字符 Base64）                       └─ hash（31 字符 Base64）</span><br><span class=\"line\"> │  └─ work_factor（成本参数，10 表示 2^10=1024 轮迭代）</span><br><span class=\"line\"> └─ 算法版本（2b 表示 bcrypt 新版本）</span><br></pre></td></tr></table></figure>\n\n<p><strong>关键特性</strong>：</p>\n<ul>\n<li><strong>慢是特性，不是缺陷</strong>：单次验证 100-300ms 对用户无感，但让攻击者爆破成本指数级上升</li>\n<li><strong>每个用户独立 salt</strong>：防止彩虹表攻击，即使两个用户密码相同，hash 也不同</li>\n<li><strong>可调节成本</strong>：随着硬件性能提升，可以增加 work_factor（如从 10 提到 12）</li>\n</ul>\n<h5 id=\"B-敏感数据（非密码，需可逆）\"><a href=\"#B-敏感数据（非密码，需可逆）\" class=\"headerlink\" title=\"B. 敏感数据（非密码，需可逆）\"></a>B. 敏感数据（非密码，需可逆）</h5><p>比如身份证号、银行卡、健康记录、API 密钥等：</p>\n<p><strong>算法选择</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>算法</th>\n<th>特点</th>\n<th>推荐场景</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>AES-256-GCM</strong></td>\n<td>认证加密（AEAD），既保密又防篡改</td>\n<td>数据库字段加密、文件加密</td>\n</tr>\n<tr>\n<td><strong>ChaCha20-Poly1305</strong></td>\n<td>软件实现更快，移动端友好</td>\n<td>移动 APP、物联网设备</td>\n</tr>\n<tr>\n<td>AES-256-CBC + HMAC</td>\n<td>传统方案，需手动做 MAC</td>\n<td>老系统兼容</td>\n</tr>\n</tbody></table>\n<p><strong>密钥管理层级</strong>（从低到高）：</p>\n<table>\n<thead>\n<tr>\n<th>层级</th>\n<th>做法</th>\n<th>风险</th>\n<th>适用场景</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>❌ 硬编码</td>\n<td>密钥写在代码里</td>\n<td>代码泄露 &#x3D; 密钥泄露</td>\n<td><strong>禁止使用</strong></td>\n</tr>\n<tr>\n<td>⚠️ 环境变量</td>\n<td><code>os.environ[&#39;SECRET_KEY&#39;]</code></td>\n<td>进程信息可能泄露，日志可能打印</td>\n<td>个人项目&#x2F;学习</td>\n</tr>\n<tr>\n<td>✅ 配置中心</td>\n<td>Consul&#x2F;Vault&#x2F;etcd</td>\n<td>需要额外维护配置中心</td>\n<td>中小团队</td>\n</tr>\n<tr>\n<td>✅✅ 云 KMS</td>\n<td>AWS KMS&#x2F;Azure Key Vault&#x2F;GCP KMS</td>\n<td>依赖云服务商</td>\n<td>企业生产环境</td>\n</tr>\n<tr>\n<td>✅✅✅ HSM</td>\n<td>硬件安全模块（FIPS 140-2 认证）</td>\n<td>成本高，操作复杂</td>\n<td>金融&#x2F;支付&#x2F;政府</td>\n</tr>\n</tbody></table>\n<p><strong>IV&#x2F;Nonce 处理规则</strong>：</p>\n<ul>\n<li><strong>必须随机</strong>：每次加密用新的随机 IV（<code>os.urandom(16)</code>）</li>\n<li><strong>可以公开</strong>：IV 不是密钥，可以和密文一起存储（如 <code>IV || Ciphertext</code>）</li>\n<li><strong>不能重复</strong>：同一密钥下 IV 重复会泄露明文模式（尤其 AES-CTR&#x2F;GCM）</li>\n</ul>\n<p><strong>存储格式示例</strong>（JSON 形式）：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;algorithm&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;AES-256-GCM&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;iv&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;a1b2c3d4e5f6...&quot;</span><span class=\"punctuation\">,</span>  <span class=\"comment\">// Base64 编码的 IV</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;ciphertext&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;9f8e7d6c5b4a...&quot;</span><span class=\"punctuation\">,</span>  <span class=\"comment\">// Base64 编码的密文</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;tag&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;1a2b3c4d...&quot;</span><span class=\"punctuation\">,</span>  <span class=\"comment\">// GCM 模式的认证标签</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;key_version&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;v2&quot;</span>  <span class=\"comment\">// 密钥版本，便于轮换</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3️⃣-认证-x2F-签名：你在-API、登录、证书里都能遇到\"><a href=\"#3️⃣-认证-x2F-签名：你在-API、登录、证书里都能遇到\" class=\"headerlink\" title=\"3️⃣ 认证&#x2F;签名：你在 API、登录、证书里都能遇到\"></a>3️⃣ 认证&#x2F;签名：你在 API、登录、证书里都能遇到</h3><p><strong>核心原理（1 句话）</strong>：证明”消息是谁发的”+”有没有被改过”。</p>\n<h4 id=\"常见场景对比\"><a href=\"#常见场景对比\" class=\"headerlink\" title=\"常见场景对比\"></a>常见场景对比</h4><table>\n<thead>\n<tr>\n<th>场景</th>\n<th>用什么</th>\n<th>目的</th>\n<th>示例</th>\n<th>验证方</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>API 请求签名</strong></td>\n<td>HMAC-SHA256</td>\n<td>防止请求被篡改&#x2F;重放</td>\n<td>AWS Signature V4, 微信支付签名</td>\n<td>服务端（持有相同密钥）</td>\n</tr>\n<tr>\n<td><strong>JWT 令牌</strong></td>\n<td>HS256(HMAC) 或 RS256(RSA)</td>\n<td>无状态认证</td>\n<td>用户登录后生成 JWT，后续请求带上</td>\n<td>任何服务（HS256 需密钥，RS256 需公钥）</td>\n</tr>\n<tr>\n<td><strong>TLS 证书</strong></td>\n<td>RSA&#x2F;ECDSA 签名</td>\n<td>证明公钥归属</td>\n<td>CA 用私钥签名网站的公钥</td>\n<td>浏览器&#x2F;操作系统（持有 CA 公钥）</td>\n</tr>\n<tr>\n<td><strong>Git 提交</strong></td>\n<td>GPG 签名（RSA&#x2F;ECDSA）</td>\n<td>证明提交者身份</td>\n<td><code>git commit -S</code></td>\n<td>GitHub&#x2F;GitLab（导入的 GPG 公钥）</td>\n</tr>\n<tr>\n<td><strong>代码签名</strong></td>\n<td>Authenticode（Windows）&#x2F;Codesign（macOS）</td>\n<td>证明软件来源</td>\n<td>驱动程序、安装包</td>\n<td>操作系统（验证证书链）</td>\n</tr>\n</tbody></table>\n<h4 id=\"HMAC-vs-数字签名（关键区别）\"><a href=\"#HMAC-vs-数字签名（关键区别）\" class=\"headerlink\" title=\"HMAC vs 数字签名（关键区别）\"></a>HMAC vs 数字签名（关键区别）</h4><table>\n<thead>\n<tr>\n<th>对比项</th>\n<th>HMAC</th>\n<th>数字签名（RSA&#x2F;ECDSA）</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>密钥类型</strong></td>\n<td>对称（共享密钥）</td>\n<td>非对称（公私钥对）</td>\n</tr>\n<tr>\n<td><strong>谁能生成</strong></td>\n<td>双方都能（持有共享密钥）</td>\n<td>只有持有私钥的人</td>\n</tr>\n<tr>\n<td><strong>谁能验证</strong></td>\n<td>双方都能</td>\n<td>任何人（用公钥验证）</td>\n</tr>\n<tr>\n<td><strong>不可否认性</strong></td>\n<td>❌ 双方都能生成，无法证明是谁</td>\n<td>✅ 只有私钥持有者能生成</td>\n</tr>\n<tr>\n<td><strong>适用场景</strong></td>\n<td>双方信任的内部系统（如微服务间认证）</td>\n<td>需要”不可否认性”的场景（如合同签署、代码发布）</td>\n</tr>\n<tr>\n<td><strong>性能</strong></td>\n<td>快（对称运算，几微秒）</td>\n<td>慢（非对称运算，几毫秒）</td>\n</tr>\n<tr>\n<td><strong>密钥分发</strong></td>\n<td>困难（需要安全通道分发密钥）</td>\n<td>简单（公钥可公开）</td>\n</tr>\n</tbody></table>\n<p><strong>典型误用案例</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ❌ 错误：用 SHA-256 做&quot;签名&quot;（任何人都能算，无法证明身份）</span></span><br><span class=\"line\">signature = hashlib.sha256(request_params.encode()).hexdigest()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ✅ 正确：用 HMAC（需要密钥才能生成有效签名）</span></span><br><span class=\"line\">signature = hmac.new(secret_key, request_params.encode(), hashlib.sha256).hexdigest()</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4️⃣-密钥管理（KMS-x2F-轮换）：真正”拉开差距”的地方\"><a href=\"#4️⃣-密钥管理（KMS-x2F-轮换）：真正”拉开差距”的地方\" class=\"headerlink\" title=\"4️⃣ 密钥管理（KMS&#x2F;轮换）：真正”拉开差距”的地方\"></a>4️⃣ 密钥管理（KMS&#x2F;轮换）：真正”拉开差距”的地方</h3><p><strong>核心原理（1 句话）</strong>：再好的加密，密钥管理不当也白搭。</p>\n<h4 id=\"工程上最常见翻车点（你要会识别）\"><a href=\"#工程上最常见翻车点（你要会识别）\" class=\"headerlink\" title=\"工程上最常见翻车点（你要会识别）\"></a>工程上最常见翻车点（你要会识别）</h4><table>\n<thead>\n<tr>\n<th>翻车点</th>\n<th>后果</th>\n<th>真实案例</th>\n<th>正确做法</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>密钥硬编码</strong></td>\n<td>代码泄露（GitHub 公开&#x2F;反编译）&#x3D; 密钥全暴露</td>\n<td>某公司 AWS 密钥提交到 GitHub，1 小时后被挖矿</td>\n<td>用环境变量&#x2F;配置中心&#x2F;KMS</td>\n</tr>\n<tr>\n<td><strong>密钥与数据同地</strong></td>\n<td>机器被入侵&#x2F;备份泄露，数据+密钥一锅端</td>\n<td>某医疗系统数据库备份含加密字段+密钥文件</td>\n<td>密钥分离存储（如 AWS KMS）</td>\n</tr>\n<tr>\n<td><strong>永不轮换</strong></td>\n<td>密钥泄露后，历史+未来数据全部可解密</td>\n<td>某支付公司密钥用了 5 年，泄露后无法止损</td>\n<td>定期轮换（每季度&#x2F;每年）</td>\n</tr>\n<tr>\n<td><strong>无权限控制</strong></td>\n<td>所有服务&#x2F;人员都能读密钥</td>\n<td>开发环境密钥被测试团队误用到生产</td>\n<td>IAM 策略：最小权限原则</td>\n</tr>\n<tr>\n<td><strong>无备份&#x2F;单点</strong></td>\n<td>密钥丢失 &#x3D; 所有数据永久无法解密</td>\n<td>某创业公司密钥文件被误删，数据库全废</td>\n<td>密钥托管（Escrow）或异地多副本</td>\n</tr>\n<tr>\n<td><strong>日志泄露密钥</strong></td>\n<td>DEBUG 日志打印密钥，被收集到日志平台</td>\n<td>某公司日志中心存有明文密钥，被内部人员窃取</td>\n<td>日志脱敏，禁止打印密钥&#x2F;Token</td>\n</tr>\n</tbody></table>\n<h4 id=\"你先从”能做到的最小实践”开始\"><a href=\"#你先从”能做到的最小实践”开始\" class=\"headerlink\" title=\"你先从”能做到的最小实践”开始\"></a>你先从”能做到的最小实践”开始</h4><table>\n<thead>\n<tr>\n<th>层级</th>\n<th>做法</th>\n<th>适用场景</th>\n<th>成本</th>\n<th>安全性</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>入门级</strong></td>\n<td>密钥放 <code>.env</code> 文件（不进 git，加入 <code>.gitignore</code>）</td>\n<td>个人项目、学习演示</td>\n<td>免费</td>\n<td>⭐⭐</td>\n</tr>\n<tr>\n<td><strong>进阶级</strong></td>\n<td>密钥放配置中心（Consul&#x2F;Vault）+ 访问控制</td>\n<td>小团队项目（5-20 人）</td>\n<td>自建或低成本云服务</td>\n<td>⭐⭐⭐</td>\n</tr>\n<tr>\n<td><strong>生产级</strong></td>\n<td>云服务商 KMS + 自动轮换 + 审计日志</td>\n<td>企业应用（100+ 用户）</td>\n<td>$1-10&#x2F;密钥&#x2F;月</td>\n<td>⭐⭐⭐⭐</td>\n</tr>\n<tr>\n<td><strong>金融级</strong></td>\n<td>HSM（硬件安全模块）+ FIPS 140-2 认证 + 密钥仪式</td>\n<td>支付&#x2F;银行&#x2F;证券</td>\n<td>$1000+&#x2F;月</td>\n<td>⭐⭐⭐⭐⭐</td>\n</tr>\n</tbody></table>\n<h4 id=\"密钥轮换策略（最小可用版）\"><a href=\"#密钥轮换策略（最小可用版）\" class=\"headerlink\" title=\"密钥轮换策略（最小可用版）\"></a>密钥轮换策略（最小可用版）</h4><p><strong>1. 定义轮换周期</strong></p>\n<table>\n<thead>\n<tr>\n<th>密钥类型</th>\n<th>敏感度</th>\n<th>轮换周期</th>\n<th>依据</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>支付密钥</td>\n<td>极高</td>\n<td>3-6 个月</td>\n<td>PCI-DSS 合规要求</td>\n</tr>\n<tr>\n<td>数据加密密钥（DEK）</td>\n<td>高</td>\n<td>1 年</td>\n<td>行业最佳实践</td>\n</tr>\n<tr>\n<td>API 密钥</td>\n<td>中</td>\n<td>1-2 年</td>\n<td>根据使用频率</td>\n</tr>\n<tr>\n<td>日志签名密钥</td>\n<td>低</td>\n<td>2 年</td>\n<td>历史日志需长期验证</td>\n</tr>\n</tbody></table>\n<p><strong>2. 轮换流程（5 步法）</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">阶段 1：准备</span><br><span class=\"line\">  └─ 生成新密钥 key_v2（在 KMS 中生成，标记为 &quot;active&quot;）</span><br><span class=\"line\">  └─ 将 key_v1 标记为 &quot;deprecated&quot;（保留但不再用于新加密）</span><br><span class=\"line\"></span><br><span class=\"line\">阶段 2：双跑</span><br><span class=\"line\">  └─ 新数据用 key_v2 加密</span><br><span class=\"line\">  └─ 旧数据仍保留 key_v1（解密时根据 key_version 字段选择密钥）</span><br><span class=\"line\"></span><br><span class=\"line\">阶段 3：重加密（可选，视数据量而定）</span><br><span class=\"line\">  └─ 后台任务逐步将旧数据用 key_v2 重新加密</span><br><span class=\"line\">  └─ 更新 key_version 字段为 &quot;v2&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">阶段 4：观察期（1-4 周）</span><br><span class=\"line\">  └─ 监控是否有系统仍在使用 key_v1</span><br><span class=\"line\">  └─ 检查审计日志，确认无异常访问</span><br><span class=\"line\"></span><br><span class=\"line\">阶段 5：废弃</span><br><span class=\"line\">  └─ 将 key_v1 标记为 &quot;disabled&quot;（保留但禁止使用）</span><br><span class=\"line\">  └─ 6 个月后彻底删除 key_v1（符合审计要求后）</span><br></pre></td></tr></table></figure>\n\n<p><strong>3. 应急轮换（紧急情况）</strong></p>\n<table>\n<thead>\n<tr>\n<th>触发条件</th>\n<th>响应时间</th>\n<th>操作步骤</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>密钥疑似泄露（如员工离职前打印了密钥）</td>\n<td>1 小时内</td>\n<td>立即生成 key_v2，停用 key_v1，通知所有系统</td>\n</tr>\n<tr>\n<td>安全事件（如服务器被入侵）</td>\n<td>2 小时内</td>\n<td>轮换所有密钥，审计历史访问记录，评估影响范围</td>\n</tr>\n<tr>\n<td>合规要求（如监管机构要求）</td>\n<td>24 小时内</td>\n<td>按合规流程轮换，提交证据报告</td>\n</tr>\n</tbody></table>\n<h2 id=\"实践任务（合法授权范围内）\"><a href=\"#实践任务（合法授权范围内）\" class=\"headerlink\" title=\"实践任务（合法授权范围内）\"></a>实践任务（合法授权范围内）</h2><blockquote>\n<p>今天做一个”密码存储安全评估”的小演练：你可以评估你自己的 demo、或者网上随便找段示例代码（只做阅读分析）。</p>\n</blockquote>\n<h3 id=\"任务-1（必做）：用”检查清单”评估一个密码存储方案\"><a href=\"#任务-1（必做）：用”检查清单”评估一个密码存储方案\" class=\"headerlink\" title=\"任务 1（必做）：用”检查清单”评估一个密码存储方案\"></a>任务 1（必做）：用”检查清单”评估一个密码存储方案</h3><p>下面给你一个典型的<strong>坏例子</strong>（❌ <strong>不要在生产环境用</strong>）：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ❌ 错误示例：用 SHA-256 直接存密码</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> hashlib</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">register_user_bad</span>(<span class=\"params\">username, password</span>):</span><br><span class=\"line\">    password_hash = hashlib.sha256(password.encode()).hexdigest()</span><br><span class=\"line\">    <span class=\"comment\"># 存储到数据库：INSERT INTO users (username, password_hash) VALUES (?, ?)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> password_hash</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">verify_user_bad</span>(<span class=\"params\">username, password, stored_hash</span>):</span><br><span class=\"line\">    password_hash = hashlib.sha256(password.encode()).hexdigest()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> password_hash == stored_hash</span><br></pre></td></tr></table></figure>\n\n<p><strong>你需要写出为什么它不行</strong>（至少 3 点）：</p>\n<ol>\n<li>❌ <strong>SHA-256 太快</strong>：GPU 每秒可尝试数十亿次，8 字符密码几小时就能爆破</li>\n<li>❌ <strong>没 salt</strong>：重复密码会有相同 hash，攻击者看到相同 hash 就知道密码一样</li>\n<li>❌ <strong>无法升级</strong>：硬件性能提升后，无法增加计算难度（SHA-256 不支持成本参数）</li>\n<li>❌ <strong>容易彩虹表攻击</strong>：预先计算好的常见密码哈希表可以瞬间查到</li>\n</ol>\n<p>然后写出一个”够用版正确方案”（伪代码即可）：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ✅ 正确示例：用 bcrypt（工业标准）</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> bcrypt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">register_user_good</span>(<span class=\"params\">username, password</span>):</span><br><span class=\"line\">    <span class=\"comment\"># bcrypt 自动生成 salt 并包含在输出中</span></span><br><span class=\"line\">    salt = bcrypt.gensalt(rounds=<span class=\"number\">12</span>)  <span class=\"comment\"># work_factor=12（2^12=4096 轮迭代）</span></span><br><span class=\"line\">    password_hash = bcrypt.hashpw(password.encode(), salt)</span><br><span class=\"line\">    <span class=\"comment\"># 存储到数据库：INSERT INTO users (username, password_hash) VALUES (?, ?)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> password_hash.decode()  <span class=\"comment\"># 返回的格式：$2b$12$salt..hash..</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">verify_user_good</span>(<span class=\"params\">username, password, stored_hash</span>):</span><br><span class=\"line\">    <span class=\"comment\"># bcrypt.checkpw 会自动从 stored_hash 中提取 salt</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> bcrypt.checkpw(password.encode(), stored_hash.encode())</span><br></pre></td></tr></table></figure>\n\n<p><strong>为什么这个方案好</strong>：</p>\n<ul>\n<li>✅ <strong>bcrypt 很慢</strong>：单次验证 100-300ms，让攻击者每秒只能尝试几次</li>\n<li>✅ <strong>自动 salt</strong>：每个用户独立随机 salt，防止彩虹表和重复密码暴露</li>\n<li>✅ <strong>可升级</strong>：可以调整 rounds 参数（如从 12 提到 13），让计算时间翻倍</li>\n<li>✅ <strong>工业标准</strong>：被广泛审计和使用，库实现经过充分测试</li>\n</ul>\n<h3 id=\"任务-2（必做）：用-Python-演示”快哈希-vs-慢-KDF”的区别\"><a href=\"#任务-2（必做）：用-Python-演示”快哈希-vs-慢-KDF”的区别\" class=\"headerlink\" title=\"任务 2（必做）：用 Python 演示”快哈希 vs 慢 KDF”的区别\"></a>任务 2（必做）：用 Python 演示”快哈希 vs 慢 KDF”的区别</h3><p>用标准库的 PBKDF2（这是 KDF 的一种）对比 SHA-256：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">python - &lt;&lt; <span class=\"string\">&#x27;PY&#x27;</span></span><br><span class=\"line\">import os</span><br><span class=\"line\">import time</span><br><span class=\"line\">import hashlib</span><br><span class=\"line\"></span><br><span class=\"line\">password = b<span class=\"string\">&quot;P@ssw0rd!&quot;</span></span><br><span class=\"line\">salt = os.urandom(<span class=\"number\">16</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 测试 SHA-256（快哈希）</span></span><br><span class=\"line\"><span class=\"built_in\">start</span> = time.time()</span><br><span class=\"line\">sha = hashlib.sha256(password).hexdigest()</span><br><span class=\"line\">sha_time = (time.time() - <span class=\"built_in\">start</span>) * <span class=\"number\">1000</span></span><br><span class=\"line\">print(f<span class=\"string\">&quot;SHA-256:  &#123;sha[:32]&#125;... time=&#123;sha_time:.4f&#125; ms&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 测试 PBKDF2（KDF，200,000 次迭代）</span></span><br><span class=\"line\"><span class=\"built_in\">start</span> = time.time()</span><br><span class=\"line\">pbk = hashlib.pbkdf2_hmac(<span class=\"string\">&#x27;sha256&#x27;</span>, password, salt, <span class=\"number\">200</span>_000).hex()</span><br><span class=\"line\">pbk_time = (time.time() - <span class=\"built_in\">start</span>) * <span class=\"number\">1000</span></span><br><span class=\"line\">print(f<span class=\"string\">&quot;PBKDF2:   &#123;pbk[:32]&#125;... time=&#123;pbk_time:.4f&#125; ms&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">print(f<span class=\"string\">&quot;\\n性能对比：PBKDF2 比 SHA-256 慢 &#123;pbk_time/sha_time:.0f&#125; 倍&quot;</span>)</span><br><span class=\"line\">print(<span class=\"string\">&quot;✅ 这就是 KDF 的目的：让攻击者爆破成本指数级上升&quot;</span>)</span><br><span class=\"line\">PY</span><br></pre></td></tr></table></figure>\n\n<p><strong>你要记录的结论</strong>（截图保存）：</p>\n<ul>\n<li>PBKDF2 明显更慢（通常慢 1000-10000 倍）<strong>这是它的目的</strong>：让爆破成本变高</li>\n<li>有 salt，每次结果不一样（因为 salt 随机）</li>\n<li>在我的机器上：<ul>\n<li>SHA-256 用时：约 ___ ms</li>\n<li>PBKDF2 用时：约 ___ ms</li>\n<li>慢了 ___ 倍</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"任务-3（必做）：写一张”应用加密检查清单”（存档到今天的成果里）\"><a href=\"#任务-3（必做）：写一张”应用加密检查清单”（存档到今天的成果里）\" class=\"headerlink\" title=\"任务 3（必做）：写一张”应用加密检查清单”（存档到今天的成果里）\"></a>任务 3（必做）：写一张”应用加密检查清单”（存档到今天的成果里）</h3><p>把下面的清单复制到你的成果区，然后<strong>逐条检查你的项目&#x2F;学习项目</strong>：</p>\n<h4 id=\"传输加密检查清单\"><a href=\"#传输加密检查清单\" class=\"headerlink\" title=\"传输加密检查清单\"></a>传输加密检查清单</h4><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 所有敏感接口必须 HTTPS（包括 API、登录、支付）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 证书有效且域名匹配</li>\n<li><input disabled=\"\" type=\"checkbox\"> 禁止在代码中忽略证书错误（如 <code>curl -k</code>、<code>requests.verify=False</code>）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 所有外部资源（CDN&#x2F;图片&#x2F;JS）使用 HTTPS</li>\n<li><input disabled=\"\" type=\"checkbox\"> 配置 HSTS（HTTP Strict Transport Security）头部</li>\n</ul>\n<h4 id=\"密码存储检查清单\"><a href=\"#密码存储检查清单\" class=\"headerlink\" title=\"密码存储检查清单\"></a>密码存储检查清单</h4><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 使用 KDF（bcrypt&#x2F;Argon2&#x2F;scrypt&#x2F;PBKDF2），<strong>禁止</strong> MD5&#x2F;SHA-256 直接存密码</li>\n<li><input disabled=\"\" type=\"checkbox\"> 每个用户独立随机 salt（不要全局统一 salt）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 成本参数合理：PBKDF2 ≥ 200,000 次，bcrypt work_factor ≥ 10</li>\n<li><input disabled=\"\" type=\"checkbox\"> <strong>禁止</strong>可逆加密存密码（如 AES 加密存储）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 登录失败有限流（防止在线爆破）</li>\n</ul>\n<h4 id=\"敏感数据加密检查清单\"><a href=\"#敏感数据加密检查清单\" class=\"headerlink\" title=\"敏感数据加密检查清单\"></a>敏感数据加密检查清单</h4><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 敏感字段加密（如身份证号、银行卡），使用 AES-GCM 或 ChaCha20-Poly1305</li>\n<li><input disabled=\"\" type=\"checkbox\"> 密钥不进 git（加入 <code>.gitignore</code>）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 密钥与数据分离存储（不要和数据库在同一台机器）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 每次加密使用新的随机 IV&#x2F;Nonce</li>\n<li><input disabled=\"\" type=\"checkbox\"> 存储格式包含 <code>algorithm</code>、<code>iv</code>、<code>ciphertext</code>、<code>key_version</code></li>\n</ul>\n<h4 id=\"密钥管理检查清单\"><a href=\"#密钥管理检查清单\" class=\"headerlink\" title=\"密钥管理检查清单\"></a>密钥管理检查清单</h4><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 密钥不硬编码在代码中</li>\n<li><input disabled=\"\" type=\"checkbox\"> 密钥有轮换策略（至少定义了”多久换一次”）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 密钥有应急替换流程（密钥泄露时怎么办）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 密钥有备份（但备份也要加密）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 最小权限：只有需要的服务&#x2F;人员能访问密钥</li>\n</ul>\n<h4 id=\"日志与审计检查清单\"><a href=\"#日志与审计检查清单\" class=\"headerlink\" title=\"日志与审计检查清单\"></a>日志与审计检查清单</h4><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 日志不打印敏感信息（密码&#x2F;Token&#x2F;密钥&#x2F;完整身份证号）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 密钥访问有审计日志（谁在什么时候访问了密钥）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 敏感操作有日志（如密码重置、密钥轮换）</li>\n</ul>\n<h3 id=\"任务-4（强烈推荐）：bcrypt-实战演示\"><a href=\"#任务-4（强烈推荐）：bcrypt-实战演示\" class=\"headerlink\" title=\"任务 4（强烈推荐）：bcrypt 实战演示\"></a>任务 4（强烈推荐）：bcrypt 实战演示</h3><p>安装 bcrypt 库并实际运行：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装 bcrypt</span></span><br><span class=\"line\">pip install bcrypt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 运行演示</span></span><br><span class=\"line\">python - &lt;&lt; <span class=\"string\">&#x27;PY&#x27;</span></span><br><span class=\"line\">import bcrypt</span><br><span class=\"line\">import time</span><br><span class=\"line\"></span><br><span class=\"line\">password = b<span class=\"string\">&quot;MySecureP@ssw0rd&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 注册：生成哈希</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;=== 注册流程 ===&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">start</span> = time.time()</span><br><span class=\"line\">salt = bcrypt.gensalt(rounds=<span class=\"number\">12</span>)  <span class=\"comment\"># work_factor=12</span></span><br><span class=\"line\">password_hash = bcrypt.hashpw(password, salt)</span><br><span class=\"line\">register_time = (time.time() - <span class=\"built_in\">start</span>) * <span class=\"number\">1000</span></span><br><span class=\"line\">print(f<span class=\"string\">&quot;密码哈希: &#123;password_hash.decode()&#125;&quot;</span>)</span><br><span class=\"line\">print(f<span class=\"string\">&quot;耗时: &#123;register_time:.2f&#125; ms&quot;</span>)</span><br><span class=\"line\">print(f<span class=\"string\">&quot;解析: <span class=\"variable\">$2b</span> (算法) / <span class=\"variable\">$12</span> (work_factor) / 22字符salt / 31字符hash&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 登录：验证哈希</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;\\n=== 登录流程（正确密码）===&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">start</span> = time.time()</span><br><span class=\"line\">is_valid = bcrypt.checkpw(password, password_hash)</span><br><span class=\"line\">login_time = (time.time() - <span class=\"built_in\">start</span>) * <span class=\"number\">1000</span></span><br><span class=\"line\">print(f<span class=\"string\">&quot;验证结果: &#123;&#x27;✅ 密码正确&#x27; if is_valid else &#x27;❌ 密码错误&#x27;&#125;&quot;</span>)</span><br><span class=\"line\">print(f<span class=\"string\">&quot;耗时: &#123;login_time:.2f&#125; ms&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 错误密码测试</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;\\n=== 登录流程（错误密码）===&quot;</span>)</span><br><span class=\"line\">wrong_password = b<span class=\"string\">&quot;WrongPassword&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">start</span> = time.time()</span><br><span class=\"line\">is_valid = bcrypt.checkpw(wrong_password, password_hash)</span><br><span class=\"line\">verify_time = (time.time() - <span class=\"built_in\">start</span>) * <span class=\"number\">1000</span></span><br><span class=\"line\">print(f<span class=\"string\">&quot;验证结果: &#123;&#x27;✅ 密码正确&#x27; if is_valid else &#x27;❌ 密码错误&#x27;&#125;&quot;</span>)</span><br><span class=\"line\">print(f<span class=\"string\">&quot;耗时: &#123;verify_time:.2f&#125; ms&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">print(f<span class=\"string\">&quot;\\n💡 注意：即使密码错误，验证时间也差不多（&#123;verify_time:.2f&#125; ms）&quot;</span>)</span><br><span class=\"line\">print(<span class=\"string\">&quot;   这是防御措施：防止攻击者通过时间差判断密码对错&quot;</span>)</span><br><span class=\"line\">PY</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"巩固练习（题与复盘）\"><a href=\"#巩固练习（题与复盘）\" class=\"headerlink\" title=\"巩固练习（题与复盘）\"></a>巩固练习（题与复盘）</h2><h3 id=\"题-1：为什么不能用明文或可逆加密存储密码？\"><a href=\"#题-1：为什么不能用明文或可逆加密存储密码？\" class=\"headerlink\" title=\"题 1：为什么不能用明文或可逆加密存储密码？\"></a>题 1：为什么不能用明文或可逆加密存储密码？</h3><p><strong>思路</strong>：你要把”数据库泄露”当成必然会发生的事故来设计。</p>\n<ul>\n<li><strong>明文存储</strong>：数据库一旦泄露，所有用户密码直接曝光</li>\n<li><strong>可逆加密（如 AES）</strong>：只要密钥泄露或被拿到，密码仍然会被批量解密</li>\n<li><strong>正确做法</strong>：用 KDF 哈希 + salt，让攻击者只能去猜（而且很慢）</li>\n<li><strong>深层原因</strong>：密码是用户的<strong>认证凭据</strong>，不是需要还原的数据（不像身份证号需要解密展示）</li>\n</ul>\n<h3 id=\"题-2：设计一套密码存储策略（写到能落地）\"><a href=\"#题-2：设计一套密码存储策略（写到能落地）\" class=\"headerlink\" title=\"题 2：设计一套密码存储策略（写到能落地）\"></a>题 2：设计一套密码存储策略（写到能落地）</h3><p><strong>思路</strong>：写 6 个要素（照着这个框架填）：</p>\n<ol>\n<li><strong>算法选择</strong>：bcrypt（work_factor&#x3D;12）或 Argon2id（默认参数）</li>\n<li><strong>salt 策略</strong>：每个用户独立随机 salt，由 KDF 自动生成并包含在输出中</li>\n<li><strong>成本参数</strong>：bcrypt work_factor&#x3D;12（约 250ms），每 2 年评估是否需要增加</li>\n<li><strong>存储字段</strong>：数据库表包含 <code>password_hash</code>（TEXT 类型，存储完整的 bcrypt 输出）</li>\n<li><strong>验证流程</strong>：登录时调用 <code>bcrypt.checkpw(input_password, stored_hash)</code></li>\n<li><strong>升级策略</strong>：用户下次登录成功时，检测 work_factor 是否过低，如果是则用新参数重新哈希并更新</li>\n</ol>\n<h3 id=\"题-3（新增）：什么情况下密钥需要紧急轮换？\"><a href=\"#题-3（新增）：什么情况下密钥需要紧急轮换？\" class=\"headerlink\" title=\"题 3（新增）：什么情况下密钥需要紧急轮换？\"></a>题 3（新增）：什么情况下密钥需要紧急轮换？</h3><p><strong>思路</strong>：列举触发条件 + 响应时间 + 操作步骤。</p>\n<ul>\n<li><strong>触发条件示例</strong>：<ol>\n<li>员工离职（尤其是有权限访问密钥的员工）</li>\n<li>服务器被入侵或疑似入侵</li>\n<li>密钥出现在日志&#x2F;错误报告&#x2F;监控系统中</li>\n<li>密钥被误提交到 git 仓库（即使已删除提交）</li>\n<li>第三方供应商安全事件（如使用的云服务商被攻击）</li>\n</ol>\n</li>\n<li><strong>响应时间</strong>：根据敏感度 1-24 小时内</li>\n<li><strong>操作步骤</strong>：<ol>\n<li>立即生成新密钥并标记为 active</li>\n<li>停用旧密钥（但保留，不删除，用于审计）</li>\n<li>通知所有相关系统更新密钥引用</li>\n<li>审计旧密钥的历史访问记录</li>\n<li>评估影响范围（哪些数据可能已被解密）</li>\n<li>生成事件报告，总结教训</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"题-4（新增）：对比-HMAC-和-数字签名的应用场景\"><a href=\"#题-4（新增）：对比-HMAC-和-数字签名的应用场景\" class=\"headerlink\" title=\"题 4（新增）：对比 HMAC 和 数字签名的应用场景\"></a>题 4（新增）：对比 HMAC 和 数字签名的应用场景</h3><p><strong>思路</strong>：从”信任模型”角度分析。</p>\n<table>\n<thead>\n<tr>\n<th>场景</th>\n<th>应该用</th>\n<th>原因</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>微服务 A 调用微服务 B（内部系统）</td>\n<td>HMAC</td>\n<td>双方互信，共享密钥，性能高</td>\n</tr>\n<tr>\n<td>用户浏览器 ← 服务器下发 JWT</td>\n<td>可以用 HMAC（HS256）</td>\n<td>如果只有服务器验证 JWT</td>\n</tr>\n<tr>\n<td>用户浏览器 → 多个微服务都验证 JWT</td>\n<td>数字签名（RS256）</td>\n<td>避免把密钥分发给所有微服务，用公钥验证</td>\n</tr>\n<tr>\n<td>APP 验证服务器响应完整性</td>\n<td>数字签名</td>\n<td>APP 只需内置公钥，无法伪造响应</td>\n</tr>\n<tr>\n<td>代码签名（发布软件包）</td>\n<td>数字签名</td>\n<td>需要”不可否认性”，证明是谁签的</td>\n</tr>\n</tbody></table>\n<h2 id=\"评估标准（达成判定）\"><a href=\"#评估标准（达成判定）\" class=\"headerlink\" title=\"评估标准（达成判定）\"></a>评估标准（达成判定）</h2><ul>\n<li>✅ 你写出至少 5 条”密码存储&#x2F;密钥管理”风险点 + 对应改法</li>\n<li>✅ 你能跑出 PBKDF2 示例并截图（对比 SHA-256 和 PBKDF2 的耗时）</li>\n<li>✅ 你完成并保存”应用加密检查清单”</li>\n<li>✅ 你能解释”为什么 bcrypt 单次验证 100ms 是特性不是缺陷”</li>\n<li>✅ 你能说出至少 3 种密钥轮换的触发条件</li>\n</ul>\n<h2 id=\"学习成果达成情况（由学习者填写）\"><a href=\"#学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"学习成果达成情况（由学习者填写）\"></a>学习成果达成情况（由学习者填写）</h2><h3 id=\"截图与证据\"><a href=\"#截图与证据\" class=\"headerlink\" title=\"截图与证据\"></a>截图与证据</h3><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 任务 2：PBKDF2 vs SHA-256 性能对比截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 任务 4（可选）：bcrypt 演示输出截图</li>\n</ul>\n<h3 id=\"关键命令与输出\"><a href=\"#关键命令与输出\" class=\"headerlink\" title=\"关键命令与输出\"></a>关键命令与输出</h3><p><strong>PBKDF2 演示输出</strong>（粘贴关键行）：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">SHA-256:  ______... time=____ ms</span><br><span class=\"line\">PBKDF2:   ______... time=____ ms</span><br><span class=\"line\">性能对比：PBKDF2 比 SHA-256 慢 ____ 倍</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"应用加密检查清单（勾选你的项目符合的项）\"><a href=\"#应用加密检查清单（勾选你的项目符合的项）\" class=\"headerlink\" title=\"应用加密检查清单（勾选你的项目符合的项）\"></a>应用加密检查清单（勾选你的项目符合的项）</h3><h4 id=\"传输加密\"><a href=\"#传输加密\" class=\"headerlink\" title=\"传输加密\"></a>传输加密</h4><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 所有敏感接口 HTTPS</li>\n<li><input disabled=\"\" type=\"checkbox\"> 证书有效且域名匹配</li>\n<li><input disabled=\"\" type=\"checkbox\"> 禁止忽略证书错误</li>\n<li><input disabled=\"\" type=\"checkbox\"> 所有外部资源 HTTPS</li>\n<li><input disabled=\"\" type=\"checkbox\"> 配置 HSTS</li>\n</ul>\n<h4 id=\"密码存储\"><a href=\"#密码存储\" class=\"headerlink\" title=\"密码存储\"></a>密码存储</h4><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 使用 KDF（bcrypt&#x2F;Argon2）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 每用户独立 salt</li>\n<li><input disabled=\"\" type=\"checkbox\"> 成本参数合理</li>\n<li><input disabled=\"\" type=\"checkbox\"> 禁止可逆加密存密码</li>\n<li><input disabled=\"\" type=\"checkbox\"> 登录失败限流</li>\n</ul>\n<h4 id=\"敏感数据加密\"><a href=\"#敏感数据加密\" class=\"headerlink\" title=\"敏感数据加密\"></a>敏感数据加密</h4><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 敏感字段加密（AES-GCM）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 密钥不进 git</li>\n<li><input disabled=\"\" type=\"checkbox\"> 密钥与数据分离</li>\n<li><input disabled=\"\" type=\"checkbox\"> 每次新 IV</li>\n<li><input disabled=\"\" type=\"checkbox\"> 存储格式完整</li>\n</ul>\n<h4 id=\"密钥管理\"><a href=\"#密钥管理\" class=\"headerlink\" title=\"密钥管理\"></a>密钥管理</h4><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 密钥不硬编码</li>\n<li><input disabled=\"\" type=\"checkbox\"> 有轮换策略</li>\n<li><input disabled=\"\" type=\"checkbox\"> 有应急流程</li>\n<li><input disabled=\"\" type=\"checkbox\"> 有备份</li>\n<li><input disabled=\"\" type=\"checkbox\"> 最小权限</li>\n</ul>\n<h4 id=\"日志与审计\"><a href=\"#日志与审计\" class=\"headerlink\" title=\"日志与审计\"></a>日志与审计</h4><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 日志不打印敏感信息</li>\n<li><input disabled=\"\" type=\"checkbox\"> 密钥访问有审计</li>\n<li><input disabled=\"\" type=\"checkbox\"> 敏感操作有日志</li>\n</ul>\n<h3 id=\"结论与反思\"><a href=\"#结论与反思\" class=\"headerlink\" title=\"结论与反思\"></a>结论与反思</h3><p><strong>我今天搞清楚了</strong>：</p>\n<ul>\n<li>（例如：密码存储要用 KDF 而不是加密；密钥管理比算法选择更重要）</li>\n</ul>\n<p><strong>我差点搞混的是</strong>：</p>\n<ul>\n<li>（例如：以为”加密存密码”就安全了，其实密码不需要可逆）</li>\n</ul>\n<p><strong>明天我要继续补的是</strong>：</p>\n<ul>\n<li>（例如：密钥轮换的具体实施、配置中心 Vault 的使用）</li>\n</ul>\n<p><strong>本次学习耗时</strong>：约 ___ 小时</p>\n<p><strong>掌握程度自评</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 😕 看懂了但没动手</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🙂 跑通了基础任务</li>\n<li><input disabled=\"\" type=\"checkbox\"> 😃 完成了所有任务并理解原理</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🤩 额外研究了 Argon2&#x2F;Vault&#x2F;HSM</li>\n</ul>\n<h2 id=\"集中参考答案（含思路）\"><a href=\"#集中参考答案（含思路）\" class=\"headerlink\" title=\"集中参考答案（含思路）\"></a>集中参考答案（含思路）</h2><h3 id=\"题-1-参考答案\"><a href=\"#题-1-参考答案\" class=\"headerlink\" title=\"题 1 参考答案\"></a>题 1 参考答案</h3><p><strong>为什么不能用明文或可逆加密存储密码？</strong></p>\n<ol>\n<li><p><strong>明文存密码</strong>：</p>\n<ul>\n<li>后果：数据库一旦泄露（SQL 注入&#x2F;备份泄露&#x2F;内部人员窃取），所有用户密码直接曝光</li>\n<li>连锁反应：用户在多个网站复用密码，泄露后会被”撞库攻击”（攻击者拿泄露的密码去尝试登录其他网站）</li>\n</ul>\n</li>\n<li><p><strong>可逆加密存密码</strong>（如 AES 加密）：</p>\n<ul>\n<li>问题：密钥一旦泄露&#x2F;被误配置&#x2F;被备份暴露，攻击者可以批量解密得到明文密码</li>\n<li>现实场景：密钥和数据库常常在同一台机器&#x2F;同一份备份里，一起泄露</li>\n<li>根本矛盾：密码是<strong>认证凭据</strong>，不是需要还原的数据（不像身份证号需要解密展示给用户）</li>\n</ul>\n</li>\n<li><p><strong>正确方式</strong>：</p>\n<ul>\n<li>用 KDF（如 bcrypt&#x2F;scrypt&#x2F;Argon2&#x2F;PBKDF2）+ 每用户 salt + 合理成本参数</li>\n<li>原理：让攻击者即使拿到数据库也只能进行高成本猜测（每个密码需要 100-300ms 验证）</li>\n<li>效果：8 字符密码爆破时间从”几小时”（SHA-256）延长到”数百年”（bcrypt）</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"题-2-参考答案（完整密码存储策略）\"><a href=\"#题-2-参考答案（完整密码存储策略）\" class=\"headerlink\" title=\"题 2 参考答案（完整密码存储策略）\"></a>题 2 参考答案（完整密码存储策略）</h3><h4 id=\"1-算法选择\"><a href=\"#1-算法选择\" class=\"headerlink\" title=\"1. 算法选择\"></a>1. 算法选择</h4><ul>\n<li><strong>首选</strong>：bcrypt（work_factor&#x3D;12）</li>\n<li><strong>备选</strong>：Argon2id（memory&#x3D;64MB, iterations&#x3D;3, parallelism&#x3D;4）</li>\n<li><strong>理由</strong>：工业标准，库成熟，广泛审计</li>\n</ul>\n<h4 id=\"2-salt-策略\"><a href=\"#2-salt-策略\" class=\"headerlink\" title=\"2. salt 策略\"></a>2. salt 策略</h4><ul>\n<li><strong>生成方式</strong>：由 KDF 自动生成随机 salt（bcrypt 为 16 字节随机数）</li>\n<li><strong>存储方式</strong>：salt 包含在 password_hash 输出中（无需单独存储）</li>\n<li><strong>重要性</strong>：防止彩虹表攻击，防止重复密码暴露</li>\n</ul>\n<h4 id=\"3-成本参数\"><a href=\"#3-成本参数\" class=\"headerlink\" title=\"3. 成本参数\"></a>3. 成本参数</h4><ul>\n<li><strong>初始设定</strong>：bcrypt work_factor&#x3D;12（单次验证约 250ms）</li>\n<li><strong>升级策略</strong>：每 2 年评估硬件性能，必要时增加到 13（验证时间翻倍）</li>\n<li><strong>上限</strong>：单次验证不超过 500ms（避免影响用户体验）</li>\n</ul>\n<h4 id=\"4-存储字段\"><a href=\"#4-存储字段\" class=\"headerlink\" title=\"4. 存储字段\"></a>4. 存储字段</h4><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> users (</span><br><span class=\"line\">    id <span class=\"type\">INT</span> <span class=\"keyword\">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class=\"line\">    username <span class=\"type\">VARCHAR</span>(<span class=\"number\">50</span>) <span class=\"keyword\">UNIQUE</span> <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">    email <span class=\"type\">VARCHAR</span>(<span class=\"number\">100</span>) <span class=\"keyword\">UNIQUE</span> <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">    password_hash TEXT <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,  <span class=\"comment\">-- 存储完整的 bcrypt 输出（约 60 字符）</span></span><br><span class=\"line\">    password_updated_at <span class=\"type\">TIMESTAMP</span>,</span><br><span class=\"line\">    created_at <span class=\"type\">TIMESTAMP</span> <span class=\"keyword\">DEFAULT</span> <span class=\"built_in\">CURRENT_TIMESTAMP</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"5-验证流程\"><a href=\"#5-验证流程\" class=\"headerlink\" title=\"5. 验证流程\"></a>5. 验证流程</h4><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">login</span>(<span class=\"params\">username, input_password</span>):</span><br><span class=\"line\">    <span class=\"comment\"># 从数据库获取 stored_hash</span></span><br><span class=\"line\">    user = db.query(<span class=\"string\">&quot;SELECT password_hash FROM users WHERE username=?&quot;</span>, username)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> user:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span>  <span class=\"comment\"># 用户不存在</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 验证密码（bcrypt.checkpw 会自动提取 salt）</span></span><br><span class=\"line\">    is_valid = bcrypt.checkpw(input_password.encode(), user.password_hash.encode())</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span> is_valid:</span><br><span class=\"line\">        <span class=\"comment\"># （可选）检查是否需要升级 work_factor</span></span><br><span class=\"line\">        upgrade_password_hash_if_needed(user.<span class=\"built_in\">id</span>, input_password, user.password_hash)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"6-迁移-x2F-升级策略\"><a href=\"#6-迁移-x2F-升级策略\" class=\"headerlink\" title=\"6. 迁移&#x2F;升级策略\"></a>6. 迁移&#x2F;升级策略</h4><ul>\n<li><p><strong>场景 1</strong>：从旧系统迁移（如 MD5 存储）</p>\n<ul>\n<li>用户下次登录成功时，用 bcrypt 重新哈希并覆盖旧 hash</li>\n<li>过渡期：同时验证 MD5 和 bcrypt（兼容未登录用户）</li>\n</ul>\n</li>\n<li><p><strong>场景 2</strong>：提升 work_factor（如从 10 提到 12）</p>\n<ul>\n<li>用户下次登录成功时，检测 work_factor 是否过低</li>\n<li>如果过低，用新参数重新哈希并更新 <code>password_hash</code> 和 <code>password_updated_at</code></li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">upgrade_password_hash_if_needed</span>(<span class=\"params\">user_id, password, current_hash</span>):</span><br><span class=\"line\">    <span class=\"comment\"># 解析当前 hash 的 work_factor（bcrypt 格式：$2b$10$...）</span></span><br><span class=\"line\">    current_work_factor = <span class=\"built_in\">int</span>(current_hash.split(<span class=\"string\">&#x27;$&#x27;</span>)[<span class=\"number\">2</span>])</span><br><span class=\"line\">    target_work_factor = <span class=\"number\">12</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span> current_work_factor &lt; target_work_factor:</span><br><span class=\"line\">        <span class=\"comment\"># 用新参数重新哈希</span></span><br><span class=\"line\">        new_salt = bcrypt.gensalt(rounds=target_work_factor)</span><br><span class=\"line\">        new_hash = bcrypt.hashpw(password.encode(), new_salt).decode()</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># 更新数据库</span></span><br><span class=\"line\">        db.execute(</span><br><span class=\"line\">            <span class=\"string\">&quot;UPDATE users SET password_hash=?, password_updated_at=NOW() WHERE id=?&quot;</span>,</span><br><span class=\"line\">            new_hash, user_id</span><br><span class=\"line\">        )</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;✅ User <span class=\"subst\">&#123;user_id&#125;</span> password hash upgraded to work_factor=<span class=\"subst\">&#123;target_work_factor&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"题-3-参考答案（密钥紧急轮换）\"><a href=\"#题-3-参考答案（密钥紧急轮换）\" class=\"headerlink\" title=\"题 3 参考答案（密钥紧急轮换）\"></a>题 3 参考答案（密钥紧急轮换）</h3><h4 id=\"触发条件（按严重程度排序）\"><a href=\"#触发条件（按严重程度排序）\" class=\"headerlink\" title=\"触发条件（按严重程度排序）\"></a>触发条件（按严重程度排序）</h4><table>\n<thead>\n<tr>\n<th>严重度</th>\n<th>触发条件</th>\n<th>响应时间</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>🔴 极高</td>\n<td>密钥已确认泄露（出现在公开渠道）</td>\n<td>1 小时内</td>\n<td>密钥被提交到 GitHub 公开仓库</td>\n</tr>\n<tr>\n<td>🟠 高</td>\n<td>服务器被入侵或疑似入侵</td>\n<td>2 小时内</td>\n<td>检测到未授权访问密钥文件</td>\n</tr>\n<tr>\n<td>🟡 中</td>\n<td>有权限人员离职（尤其是管理员）</td>\n<td>24 小时内</td>\n<td>DBA 离职前可能备份了密钥</td>\n</tr>\n<tr>\n<td>🟢 低</td>\n<td>密钥超过轮换周期</td>\n<td>1 周内</td>\n<td>密钥已使用 2 年（按策略应轮换）</td>\n</tr>\n</tbody></table>\n<h4 id=\"操作步骤（SOP）\"><a href=\"#操作步骤（SOP）\" class=\"headerlink\" title=\"操作步骤（SOP）\"></a>操作步骤（SOP）</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">阶段 1：应急响应（0-1小时）</span><br><span class=\"line\">  ├─ 01. 确认泄露范围（哪些密钥、何时泄露、谁可能看到）</span><br><span class=\"line\">  ├─ 02. 立即生成新密钥 key_v2（在 KMS 中生成）</span><br><span class=\"line\">  ├─ 03. 将旧密钥 key_v1 标记为 &quot;compromised&quot;（立即停用）</span><br><span class=\"line\">  └─ 04. 通知所有相关团队（开发/运维/安全）</span><br><span class=\"line\"></span><br><span class=\"line\">阶段 2：系统更新（1-4小时）</span><br><span class=\"line\">  ├─ 05. 更新所有服务配置（指向 key_v2）</span><br><span class=\"line\">  ├─ 06. 滚动重启服务（避免全部中断）</span><br><span class=\"line\">  ├─ 07. 验证服务可用性（监控错误率/成功率）</span><br><span class=\"line\">  └─ 08. 确认旧密钥不再被使用（审计日志）</span><br><span class=\"line\"></span><br><span class=\"line\">阶段 3：审计与评估（4-24小时）</span><br><span class=\"line\">  ├─ 09. 导出 key_v1 的历史访问记录</span><br><span class=\"line\">  ├─ 10. 分析哪些数据可能已被解密（时间窗口分析）</span><br><span class=\"line\">  ├─ 11. 评估业务影响（是否需要通知用户/监管机构）</span><br><span class=\"line\">  └─ 12. 决定是否需要重加密历史数据</span><br><span class=\"line\"></span><br><span class=\"line\">阶段 4：善后与总结（1-7天）</span><br><span class=\"line\">  ├─ 13. 生成事件报告（时间线/影响范围/应对措施）</span><br><span class=\"line\">  ├─ 14. 改进措施（如加强权限控制/增加审计）</span><br><span class=\"line\">  ├─ 15. 彻底删除 key_v1（在保留审计期后）</span><br><span class=\"line\">  └─ 16. 团队复盘会议（总结教训/更新流程）</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"题-4-参考答案（HMAC-vs-数字签名）\"><a href=\"#题-4-参考答案（HMAC-vs-数字签名）\" class=\"headerlink\" title=\"题 4 参考答案（HMAC vs 数字签名）\"></a>题 4 参考答案（HMAC vs 数字签名）</h3><table>\n<thead>\n<tr>\n<th>对比维度</th>\n<th>HMAC</th>\n<th>数字签名（RSA&#x2F;ECDSA）</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>信任模型</strong></td>\n<td>双方互信（共享密钥）</td>\n<td>单向信任（公钥可公开）</td>\n</tr>\n<tr>\n<td><strong>典型场景</strong></td>\n<td>微服务 A 调用微服务 B</td>\n<td>APP 验证服务器响应</td>\n</tr>\n<tr>\n<td><strong>不可否认性</strong></td>\n<td>❌ 双方都能生成，无法证明是谁</td>\n<td>✅ 只有私钥持有者能生成</td>\n</tr>\n<tr>\n<td><strong>密钥分发</strong></td>\n<td>困难（需要安全通道）</td>\n<td>简单（公钥可公开）</td>\n</tr>\n<tr>\n<td><strong>性能</strong></td>\n<td>快（几微秒）</td>\n<td>慢（几毫秒）</td>\n</tr>\n<tr>\n<td><strong>适用场景</strong></td>\n<td>内部系统、对称信任</td>\n<td>公开系统、需要身份证明</td>\n</tr>\n</tbody></table>\n<p><strong>选型决策树</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">需要签名的场景</span><br><span class=\"line\">  │</span><br><span class=\"line\">  ├─ 双方是否互信？</span><br><span class=\"line\">  │   ├─ 是（如微服务内部调用）</span><br><span class=\"line\">  │   │   └─ 用 HMAC（性能高，实现简单）</span><br><span class=\"line\">  │   └─ 否（如用户 APP ← 服务器）</span><br><span class=\"line\">  │       └─ 用数字签名（公钥可公开分发）</span><br><span class=\"line\">  │</span><br><span class=\"line\">  ├─ 是否需要&quot;不可否认性&quot;？</span><br><span class=\"line\">  │   ├─ 是（如合同签署、代码发布）</span><br><span class=\"line\">  │   │   └─ 必须用数字签名（HMAC 双方都能生成，无法证明）</span><br><span class=\"line\">  │   └─ 否（只要防篡改即可）</span><br><span class=\"line\">  │       └─ HMAC 即可</span><br><span class=\"line\">  │</span><br><span class=\"line\">  └─ 是否需要多方验证？</span><br><span class=\"line\">      ├─ 是（如 JWT 被多个微服务验证）</span><br><span class=\"line\">      │   └─ 用 RS256（公钥分发简单）</span><br><span class=\"line\">      └─ 否（只有一个服务验证）</span><br><span class=\"line\">          └─ HS256 或 RS256 都可以</span><br></pre></td></tr></table></figure>\n\n<p><strong>真实案例对比</strong>：</p>\n<ol>\n<li><p><strong>AWS API 签名</strong>（用 HMAC）</p>\n<ul>\n<li>场景：客户端调用 AWS API</li>\n<li>原因：客户端和 AWS 都持有 Access Key Secret，双方互信</li>\n<li>优势：性能高，无需证书管理</li>\n</ul>\n</li>\n<li><p><strong>Apple APNs 推送</strong>（用数字签名）</p>\n<ul>\n<li>场景：服务器 → Apple 推送服务 → 用户设备</li>\n<li>原因：需要证明推送来自特定 APP（不可否认性）</li>\n<li>优势：Apple 可以验证推送来源，防止伪造</li>\n</ul>\n</li>\n<li><p><strong>JWT in 微服务架构</strong></p>\n<ul>\n<li>单体应用：用 HS256（只有一个服务验证，共享密钥）</li>\n<li>微服务：用 RS256（多个服务验证，分发公钥更安全）</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"学习成果示例填写（可照抄）\"><a href=\"#学习成果示例填写（可照抄）\" class=\"headerlink\" title=\"学习成果示例填写（可照抄）\"></a>学习成果示例填写（可照抄）</h2><h3 id=\"截图与证据（示例）\"><a href=\"#截图与证据（示例）\" class=\"headerlink\" title=\"截图与证据（示例）\"></a>截图与证据（示例）</h3><ul>\n<li><code>images/day013_pbkdf2_vs_sha256.png</code>：性能对比输出（PBKDF2 慢 5000 倍）</li>\n<li><code>images/day013_bcrypt_demo.png</code>：bcrypt 注册&#x2F;登录流程输出</li>\n</ul>\n<h3 id=\"关键命令与输出（示例）\"><a href=\"#关键命令与输出（示例）\" class=\"headerlink\" title=\"关键命令与输出（示例）\"></a>关键命令与输出（示例）</h3><p><strong>PBKDF2 vs SHA-256 性能对比</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">SHA-256:  8e35c2cd3bf6641bdb0e2050... time=0.0234 ms</span><br><span class=\"line\">PBKDF2:   c5a0f8e7d4b3c2a1f9e8d7c6... time=123.4567 ms</span><br><span class=\"line\"></span><br><span class=\"line\">性能对比：PBKDF2 比 SHA-256 慢 5279 倍</span><br><span class=\"line\">✅ 这就是 KDF 的目的：让攻击者爆破成本指数级上升</span><br></pre></td></tr></table></figure>\n\n<p><strong>bcrypt 演示输出</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">=== 注册流程 ===</span><br><span class=\"line\">密码哈希: $2b$12$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p/.CPY.tHOHEa2xFH0p3.O</span><br><span class=\"line\">耗时: 267.89 ms</span><br><span class=\"line\">解析: $2b (算法) / $12 (work_factor) / 22字符salt / 31字符hash</span><br><span class=\"line\"></span><br><span class=\"line\">=== 登录流程（正确密码）===</span><br><span class=\"line\">验证结果: ✅ 密码正确</span><br><span class=\"line\">耗时: 271.23 ms</span><br><span class=\"line\"></span><br><span class=\"line\">=== 登录流程（错误密码）===</span><br><span class=\"line\">验证结果: ❌ 密码错误</span><br><span class=\"line\">耗时: 268.45 ms</span><br><span class=\"line\"></span><br><span class=\"line\">💡 注意：即使密码错误，验证时间也差不多（268.45 ms）</span><br><span class=\"line\">   这是防御措施：防止攻击者通过时间差判断密码对错</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"结论与反思（示例）\"><a href=\"#结论与反思（示例）\" class=\"headerlink\" title=\"结论与反思（示例）\"></a>结论与反思（示例）</h3><p><strong>我今天搞清楚了</strong>：</p>\n<ul>\n<li>密码存储不是”加密存”，而是”慢哈希(KDF)+salt+参数”</li>\n<li>KDF 的”慢”不是缺点，是用来抗爆破的特性（单次 100-300ms 对用户无感，对攻击者致命）</li>\n<li>密钥管理比算法选择更重要：再强的加密，密钥硬编码也白搭</li>\n<li>HMAC 适合双方互信，数字签名适合需要”不可否认性”的场景</li>\n</ul>\n<p><strong>我差点搞混的是</strong>：</p>\n<ul>\n<li>以为”AES 加密存密码”就安全了，其实密码不需要可逆（认证凭据 vs 敏感数据）</li>\n<li>以为 IV 要保密，其实 IV 可以公开但不能重复</li>\n<li>以为 HMAC 和数字签名一样，其实 HMAC 双方都能生成（无不可否认性）</li>\n</ul>\n<p><strong>明天我要继续补的是</strong>：</p>\n<ul>\n<li>密钥轮换的具体实施（配置中心 Vault 的使用）</li>\n<li>证书链验证流程（如何从根 CA 到网站证书一层层验证）</li>\n<li>实际抓包看 TLS 握手过程（ClientHello&#x2F;ServerHello&#x2F;Certificate）</li>\n</ul>\n<p><strong>本次学习耗时</strong>：约 3 小时</p>\n<p><strong>掌握程度自评</strong>：</p>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> 😃 完成了所有任务并理解原理</li>\n</ul>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day014：安全协议与加密 - 第 2 周综合实验与测评","url":"/post/b2632e05.html","content":"<h1 id=\"Day014：安全协议与加密-第-2-周综合实验与测评\"><a href=\"#Day014：安全协议与加密-第-2-周综合实验与测评\" class=\"headerlink\" title=\"Day014：安全协议与加密 - 第 2 周综合实验与测评\"></a>Day014：安全协议与加密 - 第 2 周综合实验与测评</h1><ul>\n<li>日期：2026-01-07</li>\n<li>周次：第 2 周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p>今天是”收口日”，学完你应该能做到：</p>\n<ul>\n<li>把本周知识串成一条完整的线：<ul>\n<li><strong>网络基础</strong>：DNS 解析 → HTTP 明文传输 → Wireshark 抓包分析</li>\n<li><strong>安全协议</strong>：TLS 握手 → 证书链验证 → HTTPS 加密传输</li>\n<li><strong>远程管理</strong>：SSH 密钥认证 → known_hosts vs authorized_keys</li>\n<li><strong>加密基础</strong>：哈希&#x2F;对称&#x2F;非对称 → KDF 密码存储 → 密钥管理</li>\n</ul>\n</li>\n<li>把”证据”收集齐全：截图、过滤器、关键输出，能给别人复现</li>\n<li>写出一份结构化周报：目标 → 证据 → 结论 → 反思 → 下周计划</li>\n<li>识别并纠正本周 5+ 个易错点</li>\n</ul>\n<span id=\"more\"></span>\n\n<h2 id=\"本周知识地图（10-分钟快速回顾）\"><a href=\"#本周知识地图（10-分钟快速回顾）\" class=\"headerlink\" title=\"本周知识地图（10 分钟快速回顾）\"></a>本周知识地图（10 分钟快速回顾）</h2><h3 id=\"核心概念串联\"><a href=\"#核心概念串联\" class=\"headerlink\" title=\"核心概念串联\"></a>核心概念串联</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">                       【第 2 周知识架构】</span><br><span class=\"line\">                               </span><br><span class=\"line\">   ┌─────────────────────────────────────────────┐</span><br><span class=\"line\">   │          网络协议与安全基础                  │</span><br><span class=\"line\">   └─────────────────────────────────────────────┘</span><br><span class=\"line\">             │                     │</span><br><span class=\"line\">        明文协议               加密协议</span><br><span class=\"line\">             │                     │</span><br><span class=\"line\">   ┌─────────┴─────────┐  ┌───────┴────────┐</span><br><span class=\"line\">   │                   │  │                │</span><br><span class=\"line\"> DNS解析          HTTP传输  TLS/HTTPS    SSH</span><br><span class=\"line\">   │                   │  │                │</span><br><span class=\"line\">域名→IP           明文可见  证书+加密    密钥认证</span><br><span class=\"line\">   │                   │  │                │</span><br><span class=\"line\">   └───────────────────┴──┴────────────────┘</span><br><span class=\"line\">                    │</span><br><span class=\"line\">             ┌──────┴──────┐</span><br><span class=\"line\">             │   加密基础   │</span><br><span class=\"line\">             └──────┬──────┘</span><br><span class=\"line\">                    │</span><br><span class=\"line\">       ┌────────────┼────────────┐</span><br><span class=\"line\">       │            │            │</span><br><span class=\"line\">     哈希        对称加密      非对称加密</span><br><span class=\"line\">       │            │            │</span><br><span class=\"line\">   完整性校验    数据加密      密钥交换</span><br><span class=\"line\">   密码存储      AES-GCM      RSA/ECDSA</span><br><span class=\"line\">       │            │            │</span><br><span class=\"line\">       └────────────┴────────────┘</span><br><span class=\"line\">                    │</span><br><span class=\"line\">             【密钥管理】</span><br><span class=\"line\">          轮换/分离/最小权限</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"本周-4-个关键突破\"><a href=\"#本周-4-个关键突破\" class=\"headerlink\" title=\"本周 4 个关键突破\"></a>本周 4 个关键突破</h3><table>\n<thead>\n<tr>\n<th>突破点</th>\n<th>从”不会”到”会做”</th>\n<th>证据要求</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>1. 协议分析能力</strong></td>\n<td>能用 Wireshark 抓包并读懂 HTTP&#x2F;TLS 握手</td>\n<td>Wireshark 截图 + 过滤器</td>\n</tr>\n<tr>\n<td><strong>2. 证书验证能力</strong></td>\n<td>能检查证书链&#x2F;有效期&#x2F;域名匹配</td>\n<td>curl 输出 + 浏览器截图</td>\n</tr>\n<tr>\n<td><strong>3. SSH 认证理解</strong></td>\n<td>能区分 known_hosts 和 authorized_keys</td>\n<td>本地密钥文件截图</td>\n</tr>\n<tr>\n<td><strong>4. 密码安全意识</strong></td>\n<td>知道用 KDF 而不是快哈希存密码</td>\n<td>PBKDF2 性能对比截图</td>\n</tr>\n</tbody></table>\n<h2 id=\"本周知识点回顾（你要会用，不要死背）\"><a href=\"#本周知识点回顾（你要会用，不要死背）\" class=\"headerlink\" title=\"本周知识点回顾（你要会用，不要死背）\"></a>本周知识点回顾（你要会用，不要死背）</h2><h3 id=\"1️⃣-证据意识：每次实验都要留下什么\"><a href=\"#1️⃣-证据意识：每次实验都要留下什么\" class=\"headerlink\" title=\"1️⃣ 证据意识：每次实验都要留下什么\"></a>1️⃣ 证据意识：每次实验都要留下什么</h3><table>\n<thead>\n<tr>\n<th>证据类型</th>\n<th>必须包含</th>\n<th>格式</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>命令行输出</strong></td>\n<td>完整命令 + 关键输出行</td>\n<td>文本&#x2F;截图</td>\n<td><code>curl -I https://example.com</code> + 状态码&#x2F;响应头</td>\n</tr>\n<tr>\n<td><strong>Wireshark 截图</strong></td>\n<td>过滤器 + 数据包列表 + 详情面板</td>\n<td>PNG</td>\n<td><code>tls.handshake</code> + ClientHello 详情</td>\n</tr>\n<tr>\n<td><strong>结论</strong></td>\n<td>你想证明的事实</td>\n<td>1-2 句话</td>\n<td>“证明该站点使用 TLS 1.3 + ECDHE 密钥交换”</td>\n</tr>\n<tr>\n<td><strong>反思</strong></td>\n<td>遇到的问题 + 解决方法</td>\n<td>简短记录</td>\n<td>“一开始用 <code>ssl</code> 过滤器没结果，改成 <code>tls</code> 才对”</td>\n</tr>\n</tbody></table>\n<p><strong>为什么要留证据？</strong></p>\n<ul>\n<li>学习层面：3 个月后你会忘记细节，截图能快速唤醒记忆</li>\n<li>求职层面：面试官问”你做过什么”，拿出证据比空口说强 10 倍</li>\n<li>技术层面：遇到问题时能快速对比”上次是怎么做的”</li>\n</ul>\n<h3 id=\"2️⃣-这周最容易混淆的-10-个点（必须纠正）\"><a href=\"#2️⃣-这周最容易混淆的-10-个点（必须纠正）\" class=\"headerlink\" title=\"2️⃣ 这周最容易混淆的 10 个点（必须纠正）\"></a>2️⃣ 这周最容易混淆的 10 个点（必须纠正）</h3><table>\n<thead>\n<tr>\n<th>易错点</th>\n<th>错误理解</th>\n<th>正确理解</th>\n<th>记忆诀窍</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>HTTPS 抓包</strong></td>\n<td>“抓不到明文就是抓包失败”</td>\n<td>抓包成功，只是内容被加密了</td>\n<td>能看到握手、证书、密文长度</td>\n</tr>\n<tr>\n<td><strong>证书验证</strong></td>\n<td>“看见证书就是安全的”</td>\n<td>还要检查：域名匹配&#x2F;有效期&#x2F;链完整&#x2F;受信任</td>\n<td>证书像身份证，要检查 4 要素</td>\n</tr>\n<tr>\n<td><strong>known_hosts</strong></td>\n<td>“服务器端的配置文件”</td>\n<td><strong>客户端</strong>文件，存”我信任哪些服务器”</td>\n<td>known &#x3D; 已知的（我认识谁）</td>\n</tr>\n<tr>\n<td><strong>authorized_keys</strong></td>\n<td>“客户端的配置文件”</td>\n<td><strong>服务器端</strong>文件，存”谁可以登录我”</td>\n<td>authorized &#x3D; 授权的（谁能进来）</td>\n</tr>\n<tr>\n<td><strong>密码存储</strong></td>\n<td>“AES 加密存密码就安全”</td>\n<td>密码用 KDF 哈希，不用加密</td>\n<td>密码是凭据（不需要还原），敏感数据才加密</td>\n</tr>\n<tr>\n<td><strong>salt</strong></td>\n<td>“全局一个 salt 就够了”</td>\n<td>每个用户独立随机 salt</td>\n<td>防止重复密码暴露（同密码不同 hash）</td>\n</tr>\n<tr>\n<td><strong>签名 vs 加密</strong></td>\n<td>“签名就是加密的一种”</td>\n<td>签名是防篡改+证明身份，不一定保密</td>\n<td>签名像盖章（证明是我），加密像保险箱（别人看不到）</td>\n</tr>\n<tr>\n<td><strong>HMAC vs 哈希</strong></td>\n<td>“HMAC 就是 SHA-256”</td>\n<td>HMAC 是”带密钥的哈希”，需要 secret</td>\n<td>HMAC &#x3D; Hash + MAC（消息认证码）</td>\n</tr>\n<tr>\n<td><strong>IV 是否保密</strong></td>\n<td>“IV 要像密钥一样保密”</td>\n<td>IV 可以公开，但不能重复使用</td>\n<td>IV 像信封编号（可见但不能重复）</td>\n</tr>\n<tr>\n<td><strong>TLS vs SSL</strong></td>\n<td>“SSL 是最新的”</td>\n<td>SSL 已废弃，现在用 TLS（1.2&#x2F;1.3）</td>\n<td>TLS &#x3D; Transport Layer Security（传输层安全）</td>\n</tr>\n</tbody></table>\n<h3 id=\"3️⃣-核心命令速查表（Windows-版）\"><a href=\"#3️⃣-核心命令速查表（Windows-版）\" class=\"headerlink\" title=\"3️⃣ 核心命令速查表（Windows 版）\"></a>3️⃣ 核心命令速查表（Windows 版）</h3><table>\n<thead>\n<tr>\n<th>场景</th>\n<th>命令</th>\n<th>关键参数</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>查看证书</strong></td>\n<td><code>curl.exe -Iv &lt;url&gt;</code></td>\n<td><code>-I</code>(只看头) <code>-v</code>(详细)</td>\n<td><code>curl.exe -Iv https://github.com</code></td>\n</tr>\n<tr>\n<td><strong>DNS 查询</strong></td>\n<td><code>nslookup &lt;域名&gt;</code></td>\n<td>默认查 A 记录</td>\n<td><code>nslookup github.com</code></td>\n</tr>\n<tr>\n<td><strong>端口扫描</strong></td>\n<td><code>Test-NetConnection -Port</code></td>\n<td><code>-Port 443</code></td>\n<td><code>Test-NetConnection github.com -Port 443</code></td>\n</tr>\n<tr>\n<td><strong>SSH 密钥生成</strong></td>\n<td><code>ssh-keygen -t ed25519</code></td>\n<td><code>-t</code>(类型) <code>-f</code>(文件名)</td>\n<td><code>ssh-keygen -t ed25519 -f ~/.ssh/id_demo</code></td>\n</tr>\n<tr>\n<td><strong>查看 SSH 配置</strong></td>\n<td><code>Get-Content $env:USERPROFILE\\.ssh\\config</code></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td><strong>Python 快速测试</strong></td>\n<td><code>python -c &quot;import hashlib; ...&quot;</code></td>\n<td></td>\n<td>见 Day012&#x2F;013 示例</td>\n</tr>\n</tbody></table>\n<h3 id=\"4️⃣-Wireshark-核心过滤器（必须掌握）\"><a href=\"#4️⃣-Wireshark-核心过滤器（必须掌握）\" class=\"headerlink\" title=\"4️⃣ Wireshark 核心过滤器（必须掌握）\"></a>4️⃣ Wireshark 核心过滤器（必须掌握）</h3><table>\n<thead>\n<tr>\n<th>协议</th>\n<th>过滤器</th>\n<th>用途</th>\n<th>进阶过滤</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>HTTP</strong></td>\n<td><code>http</code></td>\n<td>查看 HTTP 请求&#x2F;响应</td>\n<td><code>http.request.method == &quot;POST&quot;</code></td>\n</tr>\n<tr>\n<td><strong>TLS 握手</strong></td>\n<td><code>tls.handshake</code></td>\n<td>查看 ClientHello&#x2F;ServerHello&#x2F;Certificate</td>\n<td><code>tls.handshake.type == 1</code> (ClientHello)</td>\n</tr>\n<tr>\n<td><strong>DNS</strong></td>\n<td><code>dns</code></td>\n<td>查看 DNS 查询&#x2F;响应</td>\n<td><code>dns.qry.name == &quot;example.com&quot;</code></td>\n</tr>\n<tr>\n<td><strong>TCP 连接</strong></td>\n<td><code>tcp.flags.syn == 1</code></td>\n<td>查看 TCP 三次握手</td>\n<td><code>tcp.port == 443</code></td>\n</tr>\n<tr>\n<td><strong>特定 IP</strong></td>\n<td><code>ip.addr == 1.2.3.4</code></td>\n<td>筛选特定 IP 的流量</td>\n<td><code>ip.src == 1.2.3.4</code> (仅源 IP)</td>\n</tr>\n</tbody></table>\n<h2 id=\"实践任务（合法授权范围内）\"><a href=\"#实践任务（合法授权范围内）\" class=\"headerlink\" title=\"实践任务（合法授权范围内）\"></a>实践任务（合法授权范围内）</h2><blockquote>\n<p>今天的任务是”证据收集”：完成 4 个必做任务，每个任务都要有截图&#x2F;输出证据。</p>\n</blockquote>\n<h3 id=\"任务-1（必做）：TLS-x2F-HTTPS-抓包完整流程\"><a href=\"#任务-1（必做）：TLS-x2F-HTTPS-抓包完整流程\" class=\"headerlink\" title=\"任务 1（必做）：TLS&#x2F;HTTPS 抓包完整流程\"></a>任务 1（必做）：TLS&#x2F;HTTPS 抓包完整流程</h3><p><strong>目标</strong>：证明你能抓到 HTTPS 握手并识别关键信息。</p>\n<h4 id=\"步骤-1：启动-Wireshark\"><a href=\"#步骤-1：启动-Wireshark\" class=\"headerlink\" title=\"步骤 1：启动 Wireshark\"></a>步骤 1：启动 Wireshark</h4><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 如果没安装 Wireshark，先安装</span></span><br><span class=\"line\"><span class=\"comment\"># 官网：https://www.wireshark.org/download.html</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启动 Wireshark（管理员权限）</span></span><br><span class=\"line\"><span class=\"comment\"># 选择网络接口（通常是 Wi-Fi 或 以太网）</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"步骤-2：开始抓包并访问-HTTPS-站点\"><a href=\"#步骤-2：开始抓包并访问-HTTPS-站点\" class=\"headerlink\" title=\"步骤 2：开始抓包并访问 HTTPS 站点\"></a>步骤 2：开始抓包并访问 HTTPS 站点</h4><ol>\n<li>点击 Wireshark 的”开始抓包”（鲨鱼鳍图标）</li>\n<li>打开浏览器访问一个 HTTPS 站点（例如 <code>https://github.com</code>）</li>\n<li>等待页面完全加载（约 3-5 秒）</li>\n<li>停止抓包</li>\n</ol>\n<h4 id=\"步骤-3：应用过滤器定位-TLS-握手\"><a href=\"#步骤-3：应用过滤器定位-TLS-握手\" class=\"headerlink\" title=\"步骤 3：应用过滤器定位 TLS 握手\"></a>步骤 3：应用过滤器定位 TLS 握手</h4><p>在 Wireshark 顶部过滤器栏输入：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">tls.handshake</span><br></pre></td></tr></table></figure>\n\n<p>按 Enter 后，只显示 TLS 握手相关的数据包。</p>\n<h4 id=\"步骤-4：识别关键数据包（必须截图）\"><a href=\"#步骤-4：识别关键数据包（必须截图）\" class=\"headerlink\" title=\"步骤 4：识别关键数据包（必须截图）\"></a>步骤 4：识别关键数据包（必须截图）</h4><p>找到以下 3 种数据包并截图：</p>\n<table>\n<thead>\n<tr>\n<th>数据包类型</th>\n<th>特征</th>\n<th>截图要求</th>\n<th>关键信息</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>ClientHello</strong></td>\n<td><code>Handshake Type: Client Hello (1)</code></td>\n<td>截图 1：数据包列表 + 详情面板</td>\n<td>TLS 版本、支持的 Cipher Suites、SNI（服务器名称）</td>\n</tr>\n<tr>\n<td><strong>ServerHello</strong></td>\n<td><code>Handshake Type: Server Hello (2)</code></td>\n<td>截图 2：选中的 Cipher Suite</td>\n<td>服务器选择的加密套件（如 TLS_AES_128_GCM_SHA256）</td>\n</tr>\n<tr>\n<td><strong>Certificate</strong></td>\n<td><code>Handshake Type: Certificate (11)</code></td>\n<td>截图 3：证书链</td>\n<td>网站证书 + 中间 CA + 根 CA</td>\n</tr>\n</tbody></table>\n<h4 id=\"步骤-5：分析-SNI（服务器名称指示）\"><a href=\"#步骤-5：分析-SNI（服务器名称指示）\" class=\"headerlink\" title=\"步骤 5：分析 SNI（服务器名称指示）\"></a>步骤 5：分析 SNI（服务器名称指示）</h4><p>在 ClientHello 中展开：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Transport Layer Security</span><br><span class=\"line\">  └─ TLSv1.3 Record Layer: Handshake Protocol: Client Hello</span><br><span class=\"line\">      └─ Handshake Protocol: Client Hello</span><br><span class=\"line\">          └─ Extension: server_name (len=xx)</span><br><span class=\"line\">              └─ Server Name: github.com  ← 这里！</span><br></pre></td></tr></table></figure>\n\n<p><strong>为什么 SNI 重要？</strong></p>\n<ul>\n<li>SNI 允许一个 IP 托管多个 HTTPS 站点（虚拟主机）</li>\n<li>CDN&#x2F;负载均衡器根据 SNI 路由到正确的后端</li>\n<li>注意：SNI 是明文的，可能泄露你访问的域名（即使 HTTPS 加密了内容）</li>\n</ul>\n<h4 id=\"你要提交的证据：\"><a href=\"#你要提交的证据：\" class=\"headerlink\" title=\"你要提交的证据：\"></a>你要提交的证据：</h4><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 截图 1：ClientHello 数据包（能看到 TLS 版本 + SNI）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 截图 2：ServerHello 数据包（能看到选中的 Cipher Suite）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 截图 3：Certificate 数据包（能看到证书链）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 文字说明：访问的站点、TLS 版本、选中的加密套件</li>\n</ul>\n<h3 id=\"任务-2（必做）：证书链完整性检查\"><a href=\"#任务-2（必做）：证书链完整性检查\" class=\"headerlink\" title=\"任务 2（必做）：证书链完整性检查\"></a>任务 2（必做）：证书链完整性检查</h3><p><strong>目标</strong>：用命令行工具验证证书链。</p>\n<h4 id=\"方案-A：用-curl（Windows-自带）\"><a href=\"#方案-A：用-curl（Windows-自带）\" class=\"headerlink\" title=\"方案 A：用 curl（Windows 自带）\"></a>方案 A：用 curl（Windows 自带）</h4><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看证书详细信息</span></span><br><span class=\"line\">curl.exe <span class=\"literal\">-Iv</span> https://github.com <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> | <span class=\"built_in\">Select-String</span> <span class=\"string\">&quot;SSL&quot;</span>, <span class=\"string\">&quot;certificate&quot;</span>, <span class=\"string\">&quot;ALPN&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>你要记录的关键行</strong>（示例）：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">* SSL connection using TLSv1.3 / TLS_AES_128_GCM_SHA256</span><br><span class=\"line\">* ALPN: server accepted h2</span><br><span class=\"line\">* Server certificate:</span><br><span class=\"line\">*  subject: C=US; ST=California; L=San Francisco; O=GitHub, Inc.; CN=github.com</span><br><span class=\"line\">*  start date: Feb  5 00:00:00 2024 GMT</span><br><span class=\"line\">*  expire date: Feb  5 23:59:59 2025 GMT</span><br><span class=\"line\">*  subjectAltName: host &quot;github.com&quot; matched cert&#x27;s &quot;github.com&quot;</span><br><span class=\"line\">*  issuer: C=US; O=DigiCert Inc; CN=DigiCert TLS Hybrid ECC SHA384 2020 CA1</span><br><span class=\"line\">*  SSL certificate verify ok.</span><br></pre></td></tr></table></figure>\n\n<p><strong>关键信息解读</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>字段</th>\n<th>含义</th>\n<th>检查点</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>SSL connection using</code></td>\n<td>使用的 TLS 版本和加密套件</td>\n<td>应该是 TLS 1.2+ 或 TLS 1.3</td>\n</tr>\n<tr>\n<td><code>subject: CN=github.com</code></td>\n<td>证书颁发给谁</td>\n<td>CN（Common Name）应与访问的域名一致</td>\n</tr>\n<tr>\n<td><code>start date / expire date</code></td>\n<td>证书有效期</td>\n<td>当前日期应在有效期内</td>\n</tr>\n<tr>\n<td><code>issuer</code></td>\n<td>证书颁发机构（CA）</td>\n<td>应该是知名 CA（如 DigiCert、Let’s Encrypt）</td>\n</tr>\n<tr>\n<td><code>SSL certificate verify ok</code></td>\n<td>证书验证结果</td>\n<td>必须是 “ok”，否则有安全风险</td>\n</tr>\n</tbody></table>\n<h4 id=\"方案-B：用-PowerShell（查看证书详情）\"><a href=\"#方案-B：用-PowerShell（查看证书详情）\" class=\"headerlink\" title=\"方案 B：用 PowerShell（查看证书详情）\"></a>方案 B：用 PowerShell（查看证书详情）</h4><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 获取证书详细信息</span></span><br><span class=\"line\"><span class=\"variable\">$uri</span> = <span class=\"string\">&quot;https://github.com&quot;</span></span><br><span class=\"line\"><span class=\"variable\">$request</span> = [<span class=\"type\">System.Net.HttpWebRequest</span>]::Create(<span class=\"variable\">$uri</span>)</span><br><span class=\"line\"><span class=\"variable\">$request</span>.GetResponse() | <span class=\"built_in\">Out-Null</span></span><br><span class=\"line\"><span class=\"variable\">$cert</span> = <span class=\"variable\">$request</span>.ServicePoint.Certificate</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"variable\">$cert</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">Write-Host</span> <span class=\"string\">&quot;证书主题: <span class=\"variable\">$</span>(<span class=\"variable\">$cert</span>.Subject)&quot;</span></span><br><span class=\"line\">    <span class=\"built_in\">Write-Host</span> <span class=\"string\">&quot;证书颁发者: <span class=\"variable\">$</span>(<span class=\"variable\">$cert</span>.Issuer)&quot;</span></span><br><span class=\"line\">    <span class=\"built_in\">Write-Host</span> <span class=\"string\">&quot;有效期: <span class=\"variable\">$</span>(<span class=\"variable\">$cert</span>.GetEffectiveDateString()) 到 <span class=\"variable\">$</span>(<span class=\"variable\">$cert</span>.GetExpirationDateString())&quot;</span></span><br><span class=\"line\">    <span class=\"built_in\">Write-Host</span> <span class=\"string\">&quot;证书序列号: <span class=\"variable\">$</span>(<span class=\"variable\">$cert</span>.GetSerialNumberString())&quot;</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">Write-Host</span> <span class=\"string\">&quot;未能获取证书&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"方案-C：浏览器查看（最直观）\"><a href=\"#方案-C：浏览器查看（最直观）\" class=\"headerlink\" title=\"方案 C：浏览器查看（最直观）\"></a>方案 C：浏览器查看（最直观）</h4><ol>\n<li>在 Chrome&#x2F;Edge 中访问 HTTPS 站点</li>\n<li>点击地址栏左侧的🔒图标</li>\n<li>点击”连接是安全的” → “证书有效”</li>\n<li>查看证书详情：<ul>\n<li><strong>常规</strong>：有效期、颁发给、颁发者</li>\n<li><strong>详细信息</strong>：公钥、签名算法、扩展字段</li>\n<li><strong>证书路径</strong>：Root CA → Intermediate CA → 网站证书</li>\n</ul>\n</li>\n</ol>\n<p><strong>你要提交的证据</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> curl 输出截图（或粘贴文本）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 浏览器证书查看器截图（可选）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 文字说明：证书有效期、颁发者、是否验证通过</li>\n</ul>\n<h3 id=\"任务-3（必做）：SSH-密钥与配置文件检查\"><a href=\"#任务-3（必做）：SSH-密钥与配置文件检查\" class=\"headerlink\" title=\"任务 3（必做）：SSH 密钥与配置文件检查\"></a>任务 3（必做）：SSH 密钥与配置文件检查</h3><p><strong>目标</strong>：证明你理解 SSH 密钥认证机制。</p>\n<h4 id=\"步骤-1：检查本地密钥文件\"><a href=\"#步骤-1：检查本地密钥文件\" class=\"headerlink\" title=\"步骤 1：检查本地密钥文件\"></a>步骤 1：检查本地密钥文件</h4><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 列出 .ssh 目录下的所有文件</span></span><br><span class=\"line\"><span class=\"built_in\">Get-ChildItem</span> <span class=\"string\">&quot;<span class=\"variable\">$env:USERPROFILE</span>\\.ssh&quot;</span> | <span class=\"built_in\">Select-Object</span> Name, Length, LastWriteTime | <span class=\"built_in\">Format-Table</span> <span class=\"literal\">-AutoSize</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>常见文件说明</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>文件名</th>\n<th>类型</th>\n<th>作用</th>\n<th>是否保密</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>id_rsa</code> &#x2F; <code>id_ed25519</code></td>\n<td><strong>私钥</strong></td>\n<td>证明”我是我”，用于登录服务器</td>\n<td>✅ 必须保密（权限 600）</td>\n</tr>\n<tr>\n<td><code>id_rsa.pub</code> &#x2F; <code>id_ed25519.pub</code></td>\n<td><strong>公钥</strong></td>\n<td>放到服务器的 <code>authorized_keys</code></td>\n<td>可公开</td>\n</tr>\n<tr>\n<td><code>known_hosts</code></td>\n<td>已知主机列表</td>\n<td>客户端文件，存”我信任哪些服务器”</td>\n<td>不敏感</td>\n</tr>\n<tr>\n<td><code>authorized_keys</code></td>\n<td>授权密钥列表</td>\n<td><strong>服务器端</strong>文件（这里不应该有）</td>\n<td>不敏感</td>\n</tr>\n<tr>\n<td><code>config</code></td>\n<td>SSH 配置</td>\n<td>定义主机别名、端口、密钥路径</td>\n<td>不敏感</td>\n</tr>\n</tbody></table>\n<h4 id=\"步骤-2：查看-known-hosts-内容（了解格式）\"><a href=\"#步骤-2：查看-known-hosts-内容（了解格式）\" class=\"headerlink\" title=\"步骤 2：查看 known_hosts 内容（了解格式）\"></a>步骤 2：查看 known_hosts 内容（了解格式）</h4><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看前 3 行（避免泄露完整内容）</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Content</span> <span class=\"string\">&quot;<span class=\"variable\">$env:USERPROFILE</span>\\.ssh\\known_hosts&quot;</span> <span class=\"literal\">-TotalCount</span> <span class=\"number\">3</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>格式示例</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">github.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOMqqnkVzrm0SdG6UOoqKLsabgH5C9okWi0dh2l9GKJl</span><br><span class=\"line\">192.168.1.100 ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTY...</span><br></pre></td></tr></table></figure>\n\n<p><strong>格式解读</strong>：<code>主机名/IP 密钥类型 公钥内容</code></p>\n<h4 id=\"步骤-3：查看-config-文件（如果有）\"><a href=\"#步骤-3：查看-config-文件（如果有）\" class=\"headerlink\" title=\"步骤 3：查看 config 文件（如果有）\"></a>步骤 3：查看 config 文件（如果有）</h4><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 检查 config 是否存在</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"built_in\">Test-Path</span> <span class=\"string\">&quot;<span class=\"variable\">$env:USERPROFILE</span>\\.ssh\\config&quot;</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">Write-Host</span> <span class=\"string\">&quot;✅ config 文件存在&quot;</span></span><br><span class=\"line\">    <span class=\"built_in\">Get-Content</span> <span class=\"string\">&quot;<span class=\"variable\">$env:USERPROFILE</span>\\.ssh\\config&quot;</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">Write-Host</span> <span class=\"string\">&quot;❌ config 文件不存在（这是正常的）&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>config 示例</strong>（如果你有）：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Host github</span><br><span class=\"line\">    HostName github.com</span><br><span class=\"line\">    User git</span><br><span class=\"line\">    IdentityFile ~/.ssh/id_ed25519</span><br><span class=\"line\"></span><br><span class=\"line\">Host myserver</span><br><span class=\"line\">    HostName 192.168.1.100</span><br><span class=\"line\">    User admin</span><br><span class=\"line\">    Port 2222</span><br><span class=\"line\">    IdentityFile ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"步骤-4：理解-known-hosts-vs-authorized-keys\"><a href=\"#步骤-4：理解-known-hosts-vs-authorized-keys\" class=\"headerlink\" title=\"步骤 4：理解 known_hosts vs authorized_keys\"></a>步骤 4：理解 known_hosts vs authorized_keys</h4><table>\n<thead>\n<tr>\n<th>对比项</th>\n<th>known_hosts</th>\n<th>authorized_keys</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>位置</strong></td>\n<td><strong>客户端</strong> <code>~/.ssh/known_hosts</code></td>\n<td><strong>服务器端</strong> <code>~/.ssh/authorized_keys</code></td>\n</tr>\n<tr>\n<td><strong>作用</strong></td>\n<td>存”我信任哪些服务器的公钥”</td>\n<td>存”哪些客户端可以登录我”</td>\n</tr>\n<tr>\n<td><strong>内容</strong></td>\n<td>服务器的公钥</td>\n<td>客户端的公钥</td>\n</tr>\n<tr>\n<td><strong>场景</strong></td>\n<td>首次 SSH 连接时，客户端会问”是否信任这个服务器？”</td>\n<td>服务器验证”这个客户端的私钥对应的公钥在我的 authorized_keys 里吗？”</td>\n</tr>\n<tr>\n<td><strong>记忆诀窍</strong></td>\n<td>known &#x3D; 已知的（我认识谁）</td>\n<td>authorized &#x3D; 授权的（谁能进来）</td>\n</tr>\n</tbody></table>\n<p><strong>你要提交的证据</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> <code>Get-ChildItem .ssh</code> 输出截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> known_hosts 文件存在证明（行数即可，不要泄露完整内容）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 文字说明：你理解 known_hosts 和 authorized_keys 的区别</li>\n</ul>\n<h3 id=\"任务-4（强烈推荐）：密码哈希性能对比实验\"><a href=\"#任务-4（强烈推荐）：密码哈希性能对比实验\" class=\"headerlink\" title=\"任务 4（强烈推荐）：密码哈希性能对比实验\"></a>任务 4（强烈推荐）：密码哈希性能对比实验</h3><p><strong>目标</strong>：直观感受”为什么要用 KDF 而不是快哈希”。</p>\n<h4 id=\"完整代码（可直接运行）\"><a href=\"#完整代码（可直接运行）\" class=\"headerlink\" title=\"完整代码（可直接运行）\"></a>完整代码（可直接运行）</h4><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">python - &lt;&lt; <span class=\"string\">&#x27;PY&#x27;</span></span><br><span class=\"line\">import os</span><br><span class=\"line\">import time</span><br><span class=\"line\">import hashlib</span><br><span class=\"line\"></span><br><span class=\"line\">password = b<span class=\"string\">&quot;P@ssw0rd!&quot;</span></span><br><span class=\"line\">salt = os.urandom(<span class=\"number\">16</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">print(<span class=\"string\">&quot;=&quot;</span> * <span class=\"number\">60</span>)</span><br><span class=\"line\">print(<span class=\"string\">&quot;密码哈希性能对比实验&quot;</span>)</span><br><span class=\"line\">print(<span class=\"string\">&quot;=&quot;</span> * <span class=\"number\">60</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 测试 1：SHA-256（快哈希，不推荐用于密码）</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;\\n【测试 1】SHA-256（快哈希）&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">start</span> = time.time()</span><br><span class=\"line\">sha_hash = hashlib.sha256(password).hexdigest()</span><br><span class=\"line\">sha_time = (time.time() - <span class=\"built_in\">start</span>) * <span class=\"number\">1000</span></span><br><span class=\"line\">print(f<span class=\"string\">&quot;  哈希值: &#123;sha_hash[:32]&#125;...&quot;</span>)</span><br><span class=\"line\">print(f<span class=\"string\">&quot;  耗时: &#123;sha_time:.4f&#125; ms&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 测试 2：PBKDF2（KDF，推荐用于密码）</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;\\n【测试 2】PBKDF2（KDF，200,000 次迭代）&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">start</span> = time.time()</span><br><span class=\"line\">pbkdf2_hash = hashlib.pbkdf2_hmac(<span class=\"string\">&#x27;sha256&#x27;</span>, password, salt, <span class=\"number\">200</span>_000).hex()</span><br><span class=\"line\">pbkdf2_time = (time.time() - <span class=\"built_in\">start</span>) * <span class=\"number\">1000</span></span><br><span class=\"line\">print(f<span class=\"string\">&quot;  哈希值: &#123;pbkdf2_hash[:32]&#125;...&quot;</span>)</span><br><span class=\"line\">print(f<span class=\"string\">&quot;  耗时: &#123;pbkdf2_time:.4f&#125; ms&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 对比分析</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;\\n&quot;</span> + <span class=\"string\">&quot;=&quot;</span> * <span class=\"number\">60</span>)</span><br><span class=\"line\">print(<span class=\"string\">&quot;性能对比分析&quot;</span>)</span><br><span class=\"line\">print(<span class=\"string\">&quot;=&quot;</span> * <span class=\"number\">60</span>)</span><br><span class=\"line\">slowdown_factor = pbkdf2_time / sha_time</span><br><span class=\"line\">print(f<span class=\"string\">&quot;  PBKDF2 比 SHA-256 慢: &#123;slowdown_factor:.0f&#125; 倍&quot;</span>)</span><br><span class=\"line\">print(f<span class=\"string\">&quot;  攻击者爆破速度降低: &#123;slowdown_factor:.0f&#125; 倍&quot;</span>)</span><br><span class=\"line\">print(f<span class=\"string\">&quot;\\n  单机 GPU 每秒可尝试:&quot;</span>)</span><br><span class=\"line\">print(f<span class=\"string\">&quot;    - SHA-256: ~10,000,000,000 次（100 亿次）&quot;</span>)</span><br><span class=\"line\">print(f<span class=\"string\">&quot;    - PBKDF2:  ~&#123;10_000_000_000 / slowdown_factor:.0f&#125; 次&quot;</span>)</span><br><span class=\"line\">print(f<span class=\"string\">&quot;\\n  8 字符密码爆破时间:&quot;</span>)</span><br><span class=\"line\">print(f<span class=\"string\">&quot;    - SHA-256: 几小时&quot;</span>)</span><br><span class=\"line\">print(f<span class=\"string\">&quot;    - PBKDF2:  数百年&quot;</span>)</span><br><span class=\"line\">print(<span class=\"string\">&quot;\\n✅ 结论：KDF 的&#x27;慢&#x27;不是缺点，是用来抗爆破的特性&quot;</span>)</span><br><span class=\"line\">PY</span><br></pre></td></tr></table></figure>\n\n<p><strong>预期输出（示例）</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">============================================================</span><br><span class=\"line\">密码哈希性能对比实验</span><br><span class=\"line\">============================================================</span><br><span class=\"line\"></span><br><span class=\"line\">【测试 1】SHA-256（快哈希）</span><br><span class=\"line\">  哈希值: 8e35c2cd3bf6641bdb0e2050...</span><br><span class=\"line\">  耗时: 0.0234 ms</span><br><span class=\"line\"></span><br><span class=\"line\">【测试 2】PBKDF2（KDF，200,000 次迭代）</span><br><span class=\"line\">  哈希值: c5a0f8e7d4b3c2a1f9e8d7c6...</span><br><span class=\"line\">  耗时: 123.4567 ms</span><br><span class=\"line\"></span><br><span class=\"line\">============================================================</span><br><span class=\"line\">性能对比分析</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">  PBKDF2 比 SHA-256 慢: 5279 倍</span><br><span class=\"line\">  攻击者爆破速度降低: 5279 倍</span><br><span class=\"line\"></span><br><span class=\"line\">  单机 GPU 每秒可尝试:</span><br><span class=\"line\">    - SHA-256: ~10,000,000,000 次（100 亿次）</span><br><span class=\"line\">    - PBKDF2:  ~1,894,585 次</span><br><span class=\"line\"></span><br><span class=\"line\">  8 字符密码爆破时间:</span><br><span class=\"line\">    - SHA-256: 几小时</span><br><span class=\"line\">    - PBKDF2:  数百年</span><br><span class=\"line\"></span><br><span class=\"line\">✅ 结论：KDF 的&#x27;慢&#x27;不是缺点，是用来抗爆破的特性</span><br></pre></td></tr></table></figure>\n\n<p><strong>你要提交的证据</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 完整输出截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 记录你机器上的性能对比（慢了多少倍）</li>\n</ul>\n<h2 id=\"巩固练习（题与复盘）\"><a href=\"#巩固练习（题与复盘）\" class=\"headerlink\" title=\"巩固练习（题与复盘）\"></a>巩固练习（题与复盘）</h2><h3 id=\"题-1：做一个-5-分钟讲解提纲（必写）\"><a href=\"#题-1：做一个-5-分钟讲解提纲（必写）\" class=\"headerlink\" title=\"题 1：做一个 5 分钟讲解提纲（必写）\"></a>题 1：做一个 5 分钟讲解提纲（必写）</h3><p>从下面 4 个里选 1 个写提纲，要求：</p>\n<ul>\n<li><strong>5 个要点</strong>（每个要点 1-2 句话）</li>\n<li><strong>1 个类比</strong>（让外行也能听懂）</li>\n<li><strong>1 个你本周踩过的坑</strong></li>\n</ul>\n<h4 id=\"选项-A：为什么-HTTPS-抓包仍然有价值\"><a href=\"#选项-A：为什么-HTTPS-抓包仍然有价值\" class=\"headerlink\" title=\"选项 A：为什么 HTTPS 抓包仍然有价值\"></a>选项 A：为什么 HTTPS 抓包仍然有价值</h4><p><strong>提纲要点</strong>：</p>\n<ol>\n<li>能看到 TLS 握手过程（版本、加密套件、SNI）</li>\n<li>能定位连接失败原因（证书错误、握手告警）</li>\n<li>能分析性能问题（连接耗时、重传）</li>\n<li>能发现协议选择（HTTP&#x2F;2、QUIC）</li>\n<li>能做安全审计（是否全站 HTTPS、混合内容）</li>\n</ol>\n<p><strong>类比</strong>：（自己写一个）</p>\n<p><strong>踩坑</strong>：（自己写一个）</p>\n<h4 id=\"选项-B：证书链到底在验证什么\"><a href=\"#选项-B：证书链到底在验证什么\" class=\"headerlink\" title=\"选项 B：证书链到底在验证什么\"></a>选项 B：证书链到底在验证什么</h4><p><strong>提纲要点</strong>：</p>\n<ol>\n<li>验证证书有效期（是否过期）</li>\n<li>验证域名匹配（CN&#x2F;SAN 与访问域名一致）</li>\n<li>验证证书链完整性（网站证书 → 中间 CA → 根 CA）</li>\n<li>验证根 CA 是否受信任（在操作系统信任列表中）</li>\n<li>验证证书是否被撤销（CRL&#x2F;OCSP）</li>\n</ol>\n<p><strong>类比</strong>：（自己写一个）</p>\n<p><strong>踩坑</strong>：（自己写一个）</p>\n<h4 id=\"选项-C：SSH-的-known-hosts-vs-authorized-keys\"><a href=\"#选项-C：SSH-的-known-hosts-vs-authorized-keys\" class=\"headerlink\" title=\"选项 C：SSH 的 known_hosts vs authorized_keys\"></a>选项 C：SSH 的 known_hosts vs authorized_keys</h4><p><strong>提纲要点</strong>：</p>\n<ol>\n<li>known_hosts 在客户端，authorized_keys 在服务器端</li>\n<li>known_hosts 存”我信任哪些服务器”，防止中间人攻击</li>\n<li>authorized_keys 存”哪些客户端可以登录我”，实现密钥认证</li>\n<li>首次连接时 known_hosts 为空，会提示是否信任</li>\n<li>公钥放 authorized_keys，私钥永远不离开客户端</li>\n</ol>\n<p><strong>类比</strong>：（自己写一个）</p>\n<p><strong>踩坑</strong>：（自己写一个）</p>\n<h4 id=\"选项-D：为什么密码要用-KDF，而不是-SHA-256\"><a href=\"#选项-D：为什么密码要用-KDF，而不是-SHA-256\" class=\"headerlink\" title=\"选项 D：为什么密码要用 KDF，而不是 SHA-256\"></a>选项 D：为什么密码要用 KDF，而不是 SHA-256</h4><p><strong>提纲要点</strong>：</p>\n<ol>\n<li>SHA-256 太快（GPU 每秒数十亿次），容易被爆破</li>\n<li>KDF 设计就是”慢”（单次 100-300ms），降低爆破速度</li>\n<li>KDF 内置 salt 机制，防止彩虹表和重复密码暴露</li>\n<li>KDF 可调节成本参数，随硬件升级增加难度</li>\n<li>密码是认证凭据（不需要还原），用哈希不用加密</li>\n</ol>\n<p><strong>类比</strong>：（自己写一个）</p>\n<p><strong>踩坑</strong>：（自己写一个）</p>\n<h3 id=\"题-2：本周错题-x2F-易错点清单（至少-5-条）\"><a href=\"#题-2：本周错题-x2F-易错点清单（至少-5-条）\" class=\"headerlink\" title=\"题 2：本周错题&#x2F;易错点清单（至少 5 条）\"></a>题 2：本周错题&#x2F;易错点清单（至少 5 条）</h3><p>把你本周”差点搞错”的点列出来，并写一句纠正。</p>\n<p><strong>示例格式</strong>：</p>\n<ol>\n<li><p>❌ <strong>错误</strong>：以为 HTTPS 抓包看不到任何信息</p>\n<ul>\n<li>✅ <strong>纠正</strong>：能看到握手、证书、密文长度，只是看不到明文内容</li>\n</ul>\n</li>\n<li><p>❌ <strong>错误</strong>：以为 known_hosts 是服务器端文件</p>\n<ul>\n<li>✅ <strong>纠正</strong>：known_hosts 在客户端，存”我信任哪些服务器”</li>\n</ul>\n</li>\n</ol>\n<p>（继续写至少 3 条）</p>\n<h3 id=\"题-3（新增）：画一个-TLS-握手流程图\"><a href=\"#题-3（新增）：画一个-TLS-握手流程图\" class=\"headerlink\" title=\"题 3（新增）：画一个 TLS 握手流程图\"></a>题 3（新增）：画一个 TLS 握手流程图</h3><p>用文字&#x2F;ASCII 画出 TLS 1.3 简化握手流程（至少包含 4 步）：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">客户端                                服务器</span><br><span class=\"line\">  │                                    │</span><br><span class=\"line\">  ├──── ClientHello ──────────────────&gt;│  (1) 支持的加密套件、TLS 版本</span><br><span class=\"line\">  │                                    │</span><br><span class=\"line\">  │&lt;──── ServerHello ───────────────────┤  (2) 选中的加密套件、证书</span><br><span class=\"line\">  │                                    │</span><br><span class=\"line\">  │&lt;──── Certificate ────────────────────┤  (3) 服务器证书链</span><br><span class=\"line\">  │                                    │</span><br><span class=\"line\">  ├──── Finished ──────────────────────&gt;│  (4) 握手完成，开始加密通信</span><br><span class=\"line\">  │                                    │</span><br><span class=\"line\">  │&lt;════ 加密的 HTTP 数据 ═══════════════&gt;│</span><br></pre></td></tr></table></figure>\n\n<p>（你可以画得更详细）</p>\n<h3 id=\"题-4（新增）：设计一个密码重置流程\"><a href=\"#题-4（新增）：设计一个密码重置流程\" class=\"headerlink\" title=\"题 4（新增）：设计一个密码重置流程\"></a>题 4（新增）：设计一个密码重置流程</h3><p>要求：安全、可用、防滥用。写出至少 5 个步骤：</p>\n<ol>\n<li>（自己写）</li>\n<li>（自己写）</li>\n<li>…</li>\n</ol>\n<h2 id=\"评估标准（达成判定）\"><a href=\"#评估标准（达成判定）\" class=\"headerlink\" title=\"评估标准（达成判定）\"></a>评估标准（达成判定）</h2><table>\n<thead>\n<tr>\n<th>评估项</th>\n<th>达成标准</th>\n<th>检查方法</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>证据完整性</strong></td>\n<td>至少 3 个必做任务的截图&#x2F;输出</td>\n<td>检查学习成果区的证据清单</td>\n</tr>\n<tr>\n<td><strong>理解深度</strong></td>\n<td>能解释易错点并举例纠正</td>\n<td>检查题 2 是否写了至少 5 条</td>\n</tr>\n<tr>\n<td><strong>结构化能力</strong></td>\n<td>周报包含目标&#x2F;证据&#x2F;结论&#x2F;反思&#x2F;下周计划</td>\n<td>检查周报 5 要素是否齐全</td>\n</tr>\n<tr>\n<td><strong>实操能力</strong></td>\n<td>能独立完成 Wireshark 抓包 + 过滤器</td>\n<td>检查任务 1 的截图质量</td>\n</tr>\n<tr>\n<td><strong>思考能力</strong></td>\n<td>讲解提纲结构清晰，有类比和反思</td>\n<td>检查题 1 是否包含 5 要点+类比+踩坑</td>\n</tr>\n</tbody></table>\n<p><strong>达成判定</strong>：</p>\n<ul>\n<li>✅ <strong>优秀</strong>（5&#x2F;5）：完成所有任务 + 题 1-4 全部完成 + 周报详细</li>\n<li>✅ <strong>良好</strong>（4&#x2F;5）：完成 3+ 任务 + 题 1-2 完成 + 周报基本完整</li>\n<li>✅ <strong>合格</strong>（3&#x2F;5）：完成 3 个必做任务 + 题 1 完成 + 有周报</li>\n<li>⚠️ <strong>需改进</strong>（&lt;3&#x2F;5）：任务不全或无周报</li>\n</ul>\n<h2 id=\"学习成果达成情况（周报模板，直接填写）\"><a href=\"#学习成果达成情况（周报模板，直接填写）\" class=\"headerlink\" title=\"学习成果达成情况（周报模板，直接填写）\"></a>学习成果达成情况（周报模板，直接填写）</h2><h3 id=\"1-本周我完成了什么（用一句话总述）\"><a href=\"#1-本周我完成了什么（用一句话总述）\" class=\"headerlink\" title=\"1) 本周我完成了什么（用一句话总述）\"></a>1) 本周我完成了什么（用一句话总述）</h3><ul>\n<li>（例如：我完成了 HTTPS&#x2F;TLS 抓包、证书链检查、SSH 密钥配置与 KDF 基础演示，并整理了一份可复现实验周报。）</li>\n</ul>\n<h3 id=\"2-关键证据清单（把截图文件名列出来）\"><a href=\"#2-关键证据清单（把截图文件名列出来）\" class=\"headerlink\" title=\"2) 关键证据清单（把截图文件名列出来）\"></a>2) 关键证据清单（把截图文件名列出来）</h3><table>\n<thead>\n<tr>\n<th>任务</th>\n<th>截图文件名</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>任务 1 - ClientHello</td>\n<td><code>images/day014_tls_clienthello.png</code></td>\n<td>能看到 TLS 版本和 SNI</td>\n</tr>\n<tr>\n<td>任务 1 - ServerHello</td>\n<td><code>images/day014_tls_serverhello.png</code></td>\n<td>能看到选中的加密套件</td>\n</tr>\n<tr>\n<td>任务 1 - Certificate</td>\n<td><code>images/day014_tls_certificate.png</code></td>\n<td>能看到证书链</td>\n</tr>\n<tr>\n<td>任务 2 - curl 输出</td>\n<td><code>images/day014_curl_output.png</code></td>\n<td>证书验证结果</td>\n</tr>\n<tr>\n<td>任务 3 - SSH 文件</td>\n<td><code>images/day014_ssh_files.png</code></td>\n<td>.ssh 目录内容</td>\n</tr>\n<tr>\n<td>任务 4 - PBKDF2 对比</td>\n<td><code>images/day014_pbkdf2_comparison.png</code></td>\n<td>性能对比结果</td>\n</tr>\n</tbody></table>\n<h3 id=\"3-我本周最重要的-10-行记录（命令-x2F-过滤器-x2F-输出）\"><a href=\"#3-我本周最重要的-10-行记录（命令-x2F-过滤器-x2F-输出）\" class=\"headerlink\" title=\"3) 我本周最重要的 10 行记录（命令&#x2F;过滤器&#x2F;输出）\"></a>3) 我本周最重要的 10 行记录（命令&#x2F;过滤器&#x2F;输出）</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">1. tls.handshake  # Wireshark 过滤 TLS 握手</span><br><span class=\"line\">2. curl.exe -Iv https://github.com  # 查看证书信息</span><br><span class=\"line\">3. Get-ChildItem $env:USERPROFILE\\.ssh  # 列出 SSH 密钥</span><br><span class=\"line\">4. nslookup github.com  # DNS 解析</span><br><span class=\"line\">5. Test-NetConnection github.com -Port 443  # 测试 HTTPS 端口</span><br><span class=\"line\">6. python -c &quot;import hashlib; ...&quot;  # 快速测试哈希</span><br><span class=\"line\">7. TLS_AES_128_GCM_SHA256  # 常见加密套件</span><br><span class=\"line\">8. CN=github.com  # 证书主题（Common Name）</span><br><span class=\"line\">9. SSL certificate verify ok  # 证书验证成功</span><br><span class=\"line\">10. $2b$12$...  # bcrypt 哈希格式</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-结论与反思（必须写）\"><a href=\"#4-结论与反思（必须写）\" class=\"headerlink\" title=\"4) 结论与反思（必须写）\"></a>4) 结论与反思（必须写）</h3><p><strong>我本周真正理解了</strong>：</p>\n<ul>\n<li>（例如：HTTPS 抓包虽然看不到明文，但能看到握手、证书、协议选择，对排错和性能分析很有价值）</li>\n<li>（例如：密码存储不是”加密存”，而是”KDF 哈希 + salt”，因为密码是认证凭据不需要还原）</li>\n<li>（例如：known_hosts 和 authorized_keys 的区别，一个在客户端一个在服务器端）</li>\n</ul>\n<p><strong>我本周最大的坑是</strong>：</p>\n<ul>\n<li>（例如：一开始用 <code>ssl.handshake</code> 过滤器没结果，后来才知道应该用 <code>tls.handshake</code>）</li>\n<li>（例如：以为 IV 要保密，其实 IV 可以公开但不能重复）</li>\n<li>（例如：把签名当成加密，其实签名是防篡改+证明身份，不一定保密）</li>\n</ul>\n<p><strong>我下周要避免的是</strong>：</p>\n<ul>\n<li>（例如：不要急着做任务，先理解原理再动手）</li>\n<li>（例如：截图要包含完整信息，不要只截一部分）</li>\n<li>（例如：遇到问题先看文档，不要瞎试）</li>\n</ul>\n<h3 id=\"5-下周计划（3-条即可）\"><a href=\"#5-下周计划（3-条即可）\" class=\"headerlink\" title=\"5) 下周计划（3 条即可）\"></a>5) 下周计划（3 条即可）</h3><ol>\n<li>（例如：学习 Linux 文件权限和 sudo 配置）</li>\n<li>（例如：继续深入 Python 脚本自动化）</li>\n<li>（例如：搭建一个本地测试环境练习端口扫描）</li>\n</ol>\n<p><strong>本周学习耗时</strong>：约 ___ 小时</p>\n<p><strong>掌握程度自评</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 😕 只完成了部分任务，理解不深</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🙂 完成了必做任务，基本理解</li>\n<li><input disabled=\"\" type=\"checkbox\"> 😃 完成了所有任务，理解透彻</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🤩 额外做了扩展研究（如对比不同 KDF、研究证书透明度日志）</li>\n</ul>\n<h2 id=\"集中参考答案（含思路）\"><a href=\"#集中参考答案（含思路）\" class=\"headerlink\" title=\"集中参考答案（含思路）\"></a>集中参考答案（含思路）</h2><h3 id=\"题-1-参考提纲（完整版）\"><a href=\"#题-1-参考提纲（完整版）\" class=\"headerlink\" title=\"题 1 参考提纲（完整版）\"></a>题 1 参考提纲（完整版）</h3><h4 id=\"选项-A：为什么-HTTPS-抓包仍然有价值-1\"><a href=\"#选项-A：为什么-HTTPS-抓包仍然有价值-1\" class=\"headerlink\" title=\"选项 A：为什么 HTTPS 抓包仍然有价值\"></a>选项 A：为什么 HTTPS 抓包仍然有价值</h4><p><strong>5 个要点</strong>：</p>\n<ol>\n<li><strong>握手信息可见</strong>：能看到 TLS 版本（1.2&#x2F;1.3）、加密套件（如 TLS_AES_128_GCM_SHA256）、SNI（服务器名称）</li>\n<li><strong>证书可见</strong>：能看到完整证书链（Root CA → Intermediate CA → 网站证书），验证有效期和颁发者</li>\n<li><strong>排错线索</strong>：握手失败时能看到具体告警（如 certificate_expired、handshake_failure）</li>\n<li><strong>性能分析</strong>：能看到连接建立时间、重传次数、RTT（往返时间），虽然看不到明文但能定位慢在哪</li>\n<li><strong>协议发现</strong>：能看到 ALPN 协商结果（HTTP&#x2F;2 还是 HTTP&#x2F;1.1）、是否走 QUIC（UDP 443）</li>\n</ol>\n<p><strong>类比</strong>：</p>\n<ul>\n<li>“就像你看不到快递盒子里装的是什么，但你能看到：寄件人、收件人、物流路线、包裹大小、运输时间。这些信息足够你判断物流是否正常。”</li>\n</ul>\n<p><strong>踩坑示例</strong>：</p>\n<ul>\n<li>“我一开始用 <code>ssl.handshake</code> 过滤器没结果，以为 Wireshark 坏了。后来才知道现在应该用 <code>tls.handshake</code>（SSL 是老名字，已被 TLS 替代）。”</li>\n</ul>\n<h4 id=\"选项-B：证书链到底在验证什么-1\"><a href=\"#选项-B：证书链到底在验证什么-1\" class=\"headerlink\" title=\"选项 B：证书链到底在验证什么\"></a>选项 B：证书链到底在验证什么</h4><p><strong>5 个要点</strong>：</p>\n<ol>\n<li><strong>域名匹配</strong>：证书的 CN（Common Name）或 SAN（Subject Alternative Name）必须与访问的域名一致</li>\n<li><strong>有效期</strong>：当前日期必须在证书的 <code>Not Before</code> 和 <code>Not After</code> 之间</li>\n<li><strong>证书链完整</strong>：网站证书 → 中间 CA → 根 CA，每一级都用上一级的私钥签名</li>\n<li><strong>根 CA 受信任</strong>：根 CA 必须在操作系统&#x2F;浏览器的信任列表中（预装或手动添加）</li>\n<li><strong>未被撤销</strong>：通过 CRL（证书撤销列表）或 OCSP（在线证书状态协议）确认证书未被撤销</li>\n</ol>\n<p><strong>类比</strong>：</p>\n<ul>\n<li>“证书链像身份证的验证流程：看身份证上的名字（域名）、有效期、发证机关（CA）；然后打电话到公安局（根 CA）确认’这个发证机关是真的吗’；最后查黑名单（CRL&#x2F;OCSP）看身份证有没有被注销。”</li>\n</ul>\n<p><strong>踩坑示例</strong>：</p>\n<ul>\n<li>“我以为看到证书就是安全的，后来发现证书可能过期、域名不匹配、或者是自签名的（不在信任列表）。现在知道要检查 4 个要素。”</li>\n</ul>\n<h4 id=\"选项-C：SSH-的-known-hosts-vs-authorized-keys-1\"><a href=\"#选项-C：SSH-的-known-hosts-vs-authorized-keys-1\" class=\"headerlink\" title=\"选项 C：SSH 的 known_hosts vs authorized_keys\"></a>选项 C：SSH 的 known_hosts vs authorized_keys</h4><p><strong>5 个要点</strong>：</p>\n<ol>\n<li><strong>位置不同</strong>：known_hosts 在<strong>客户端</strong> <code>~/.ssh/known_hosts</code>，authorized_keys 在<strong>服务器端</strong> <code>~/.ssh/authorized_keys</code></li>\n<li><strong>作用不同</strong>：known_hosts 存”我信任哪些服务器的公钥”，authorized_keys 存”哪些客户端可以登录我”</li>\n<li><strong>首次连接</strong>：第一次 SSH 到新服务器时，客户端会问”是否信任这个服务器？”，确认后服务器公钥写入 known_hosts</li>\n<li><strong>密钥认证流程</strong>：客户端用私钥签名，服务器用 authorized_keys 中的公钥验证签名</li>\n<li><strong>安全意义</strong>：known_hosts 防止中间人攻击（服务器公钥变了会警告），authorized_keys 实现免密登录</li>\n</ol>\n<p><strong>类比</strong>：</p>\n<ul>\n<li>“known_hosts 像你的’通讯录’（记录你认识的人的电话号码），authorized_keys 像门卫的’访客名单’（记录谁可以进门）。”</li>\n</ul>\n<p><strong>踩坑示例</strong>：</p>\n<ul>\n<li>“我以前以为 known_hosts 和 authorized_keys 都在客户端，后来才知道一个在客户端一个在服务器端，名字就是提示：known &#x3D; 我知道谁，authorized &#x3D; 谁被授权。”</li>\n</ul>\n<h4 id=\"选项-D：为什么密码要用-KDF，而不是-SHA-256-1\"><a href=\"#选项-D：为什么密码要用-KDF，而不是-SHA-256-1\" class=\"headerlink\" title=\"选项 D：为什么密码要用 KDF，而不是 SHA-256\"></a>选项 D：为什么密码要用 KDF，而不是 SHA-256</h4><p><strong>5 个要点</strong>：</p>\n<ol>\n<li><strong>速度对比</strong>：SHA-256 太快（&lt;0.1ms），GPU 每秒能尝试数十亿次；KDF 设计就是”慢”（100-300ms），让爆破速度降低数千倍</li>\n<li><strong>salt 机制</strong>：SHA-256 需要手动加 salt，KDF 内置 salt 并包含在输出中，防止彩虹表和重复密码暴露</li>\n<li><strong>可调节性</strong>：SHA-256 固定速度，KDF 有成本参数（如 bcrypt 的 work_factor），可以随硬件升级增加难度</li>\n<li><strong>用途区分</strong>：SHA-256 是通用哈希（文件校验、数字签名），KDF 专门为密码设计（抗爆破）</li>\n<li><strong>根本原因</strong>：密码是<strong>认证凭据</strong>（不需要还原），用哈希不用加密；而敏感数据（如身份证号）才需要可逆加密</li>\n</ol>\n<p><strong>类比</strong>：</p>\n<ul>\n<li>“SHA-256 像高速公路（快但不安全），KDF 像限速 20km&#x2F;h 的学校区域（慢但能保护安全）。对密码来说，’慢’不是缺点，是防御爆破的特性。”</li>\n</ul>\n<p><strong>踩坑示例</strong>：</p>\n<ul>\n<li>“我一开始以为’加密存密码’就安全了，后来才知道密码不需要还原（登录只需验证是否匹配），用 KDF 哈希比加密更安全（密钥泄露也无法批量解密）。”</li>\n</ul>\n<h3 id=\"题-2-参考答案（完整-10-条）\"><a href=\"#题-2-参考答案（完整-10-条）\" class=\"headerlink\" title=\"题 2 参考答案（完整 10 条）\"></a>题 2 参考答案（完整 10 条）</h3><ol>\n<li><p>❌ <strong>错误</strong>：以为 HTTPS 抓包看不到任何信息</p>\n<ul>\n<li>✅ <strong>纠正</strong>：能看到握手、证书、密文长度、协议选择，只是看不到明文内容</li>\n</ul>\n</li>\n<li><p>❌ <strong>错误</strong>：以为 known_hosts 是服务器端文件</p>\n<ul>\n<li>✅ <strong>纠正</strong>：known_hosts 在<strong>客户端</strong>，存”我信任哪些服务器”</li>\n</ul>\n</li>\n<li><p>❌ <strong>错误</strong>：用 SHA-256 直接存密码</p>\n<ul>\n<li>✅ <strong>纠正</strong>：应该用 KDF（bcrypt&#x2F;Argon2&#x2F;PBKDF2），单次验证慢 100-300ms</li>\n</ul>\n</li>\n<li><p>❌ <strong>错误</strong>：以为 IV 要像密钥一样保密</p>\n<ul>\n<li>✅ <strong>纠正</strong>：IV 可以公开（和密文一起存），但不能重复使用</li>\n</ul>\n</li>\n<li><p>❌ <strong>错误</strong>：把签名当成加密的一种</p>\n<ul>\n<li>✅ <strong>纠正</strong>：签名是防篡改+证明身份（用私钥签、公钥验），不一定保密</li>\n</ul>\n</li>\n<li><p>❌ <strong>错误</strong>：以为证书”有效”就是安全的</p>\n<ul>\n<li>✅ <strong>纠正</strong>：还要检查域名匹配、链完整、根 CA 受信任、未被撤销</li>\n</ul>\n</li>\n<li><p>❌ <strong>错误</strong>：用 <code>ssl.handshake</code> 过滤器没结果</p>\n<ul>\n<li>✅ <strong>纠正</strong>：现在应该用 <code>tls.handshake</code>（SSL 是老名字）</li>\n</ul>\n</li>\n<li><p>❌ <strong>错误</strong>：以为全局一个 salt 就够了</p>\n<ul>\n<li>✅ <strong>纠正</strong>：每个用户独立随机 salt，防止重复密码暴露</li>\n</ul>\n</li>\n<li><p>❌ <strong>错误</strong>：以为 HMAC 就是 SHA-256</p>\n<ul>\n<li>✅ <strong>纠正</strong>：HMAC 是”带密钥的哈希”，需要 secret 才能生成有效签名</li>\n</ul>\n</li>\n<li><p>❌ <strong>错误</strong>：以为密码加密存储就安全</p>\n<ul>\n<li>✅ <strong>纠正</strong>：密码是认证凭据（不需要还原），用 KDF 哈希而不是加密</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"题-3-参考答案（TLS-1-3-握手流程图）\"><a href=\"#题-3-参考答案（TLS-1-3-握手流程图）\" class=\"headerlink\" title=\"题 3 参考答案（TLS 1.3 握手流程图）\"></a>题 3 参考答案（TLS 1.3 握手流程图）</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">客户端                                          服务器</span><br><span class=\"line\">  │                                              │</span><br><span class=\"line\">  │                                              │</span><br><span class=\"line\">  ├──── (1) ClientHello ────────────────────────&gt;│</span><br><span class=\"line\">  │     - 支持的 TLS 版本（1.3/1.2）             │</span><br><span class=\"line\">  │     - 支持的加密套件列表                      │</span><br><span class=\"line\">  │     - SNI（服务器名称）                       │</span><br><span class=\"line\">  │     - 客户端随机数                           │</span><br><span class=\"line\">  │                                              │</span><br><span class=\"line\">  │&lt;──── (2) ServerHello ──────────────────────┤</span><br><span class=\"line\">  │     - 选中的 TLS 版本（1.3）                 │</span><br><span class=\"line\">  │     - 选中的加密套件（如 AES-128-GCM）       │</span><br><span class=\"line\">  │     - 服务器随机数                           │</span><br><span class=\"line\">  │                                              │</span><br><span class=\"line\">  │&lt;──── (3) Certificate ───────────────────────┤</span><br><span class=\"line\">  │     - 服务器证书链                           │</span><br><span class=\"line\">  │     - Root CA → Intermediate CA → 网站证书   │</span><br><span class=\"line\">  │                                              │</span><br><span class=\"line\">  │&lt;──── (4) CertificateVerify ─────────────────┤</span><br><span class=\"line\">  │     - 用服务器私钥对握手消息的签名           │</span><br><span class=\"line\">  │                                              │</span><br><span class=\"line\">  │&lt;──── (5) Finished ──────────────────────────┤</span><br><span class=\"line\">  │     - 服务器握手完成消息（已加密）           │</span><br><span class=\"line\">  │                                              │</span><br><span class=\"line\">  ├──── (6) Finished ─────────────────────────&gt;│</span><br><span class=\"line\">  │     - 客户端握手完成消息（已加密）           │</span><br><span class=\"line\">  │                                              │</span><br><span class=\"line\">  │&lt;════════ 加密的应用数据 ═══════════════════&gt;│</span><br><span class=\"line\">  │     - HTTP 请求/响应全程加密                 │</span><br><span class=\"line\">  │     - 用协商好的会话密钥（对称加密）         │</span><br><span class=\"line\">  │                                              │</span><br></pre></td></tr></table></figure>\n\n<p><strong>关键点</strong>：</p>\n<ul>\n<li>TLS 1.3 只需 1-RTT（一个往返）就能完成握手，比 TLS 1.2 更快</li>\n<li>Certificate 和 CertificateVerify 在 TLS 1.3 中是加密的（更安全）</li>\n<li>握手完成后，所有应用数据用对称加密（AES-GCM）</li>\n</ul>\n<h3 id=\"题-4-参考答案（密码重置流程）\"><a href=\"#题-4-参考答案（密码重置流程）\" class=\"headerlink\" title=\"题 4 参考答案（密码重置流程）\"></a>题 4 参考答案（密码重置流程）</h3><h4 id=\"安全的密码重置流程（5-步法）\"><a href=\"#安全的密码重置流程（5-步法）\" class=\"headerlink\" title=\"安全的密码重置流程（5 步法）\"></a>安全的密码重置流程（5 步法）</h4><ol>\n<li><p><strong>用户发起重置请求</strong></p>\n<ul>\n<li>输入注册邮箱&#x2F;手机号</li>\n<li>后端验证账号是否存在（<strong>不要</strong>告诉用户”账号不存在”，防止枚举攻击）</li>\n</ul>\n</li>\n<li><p><strong>生成重置令牌（Token）</strong></p>\n<ul>\n<li>生成随机令牌（如 <code>uuid.uuid4()</code> 或 <code>secrets.token_urlsafe(32)</code>）</li>\n<li>存储到数据库：<code>user_id</code>, <code>token_hash</code>（存哈希不存明文）, <code>expires_at</code>（15-30 分钟后过期）</li>\n</ul>\n</li>\n<li><p><strong>发送重置链接</strong></p>\n<ul>\n<li>通过邮件&#x2F;短信发送链接：<code>https://example.com/reset?token=abc123xyz</code></li>\n<li><strong>不要</strong>在链接中包含用户 ID 或邮箱（防止信息泄露）</li>\n</ul>\n</li>\n<li><p><strong>用户点击链接并设置新密码</strong></p>\n<ul>\n<li>验证 token 是否有效（未过期、未使用、哈希匹配）</li>\n<li>检查新密码强度（长度≥8、包含大小写字母+数字+特殊字符）</li>\n<li>用 KDF（bcrypt&#x2F;Argon2）哈希新密码并更新数据库</li>\n</ul>\n</li>\n<li><p><strong>废弃令牌并通知用户</strong></p>\n<ul>\n<li>标记 token 为已使用（防止重复使用）</li>\n<li>发送”密码已重置”通知邮件（如果不是本人操作，提供申诉链接）</li>\n<li>可选：让其他设备的会话失效（强制重新登录）</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"防滥用措施\"><a href=\"#防滥用措施\" class=\"headerlink\" title=\"防滥用措施\"></a>防滥用措施</h4><ul>\n<li><strong>频率限制</strong>：同一邮箱&#x2F;IP 在 5 分钟内只能请求 3 次</li>\n<li><strong>验证码</strong>：重置请求时要求输入图形验证码或 reCAPTCHA</li>\n<li><strong>审计日志</strong>：记录所有重置请求（时间&#x2F;IP&#x2F;User-Agent），用于事后调查</li>\n<li><strong>异常检测</strong>：短时间内大量重置请求 → 告警并临时冻结该账号</li>\n</ul>\n<h2 id=\"学习成果示例填写（可照抄）\"><a href=\"#学习成果示例填写（可照抄）\" class=\"headerlink\" title=\"学习成果示例填写（可照抄）\"></a>学习成果示例填写（可照抄）</h2><h3 id=\"1-总述（示例）\"><a href=\"#1-总述（示例）\" class=\"headerlink\" title=\"1) 总述（示例）\"></a>1) 总述（示例）</h3><p>我完成了本周 4 个核心任务：</p>\n<ol>\n<li>用 Wireshark 抓取并分析了 HTTPS&#x2F;TLS 握手过程（ClientHello&#x2F;ServerHello&#x2F;Certificate）</li>\n<li>用 curl 验证了 GitHub 的证书链和 TLS 版本</li>\n<li>检查了本地 SSH 密钥文件并理解了 known_hosts vs authorized_keys 的区别</li>\n<li>运行了 PBKDF2 vs SHA-256 性能对比实验，直观感受了 KDF 的”慢”是防御特性</li>\n</ol>\n<p>整理了一份可复现的实验周报，包含截图、命令、输出和反思。</p>\n<h3 id=\"2-关键证据（示例）\"><a href=\"#2-关键证据（示例）\" class=\"headerlink\" title=\"2) 关键证据（示例）\"></a>2) 关键证据（示例）</h3><table>\n<thead>\n<tr>\n<th>任务</th>\n<th>截图文件名</th>\n<th>关键信息</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>TLS ClientHello</td>\n<td><code>images/day014_clienthello.png</code></td>\n<td>TLS 1.3, SNI&#x3D;github.com, 支持的加密套件</td>\n</tr>\n<tr>\n<td>TLS ServerHello</td>\n<td><code>images/day014_serverhello.png</code></td>\n<td>选中 TLS_AES_128_GCM_SHA256</td>\n</tr>\n<tr>\n<td>TLS Certificate</td>\n<td><code>images/day014_certificate.png</code></td>\n<td>证书链：DigiCert Root → Intermediate → github.com</td>\n</tr>\n<tr>\n<td>curl 输出</td>\n<td><code>images/day014_curl.png</code></td>\n<td>SSL certificate verify ok, TLSv1.3</td>\n</tr>\n<tr>\n<td>SSH 文件</td>\n<td><code>images/day014_ssh.png</code></td>\n<td>id_ed25519, id_ed25519.pub, known_hosts</td>\n</tr>\n<tr>\n<td>PBKDF2 对比</td>\n<td><code>images/day014_pbkdf2.png</code></td>\n<td>PBKDF2 慢 5279 倍</td>\n</tr>\n</tbody></table>\n<h3 id=\"3-最重要的-10-行记录（示例）\"><a href=\"#3-最重要的-10-行记录（示例）\" class=\"headerlink\" title=\"3) 最重要的 10 行记录（示例）\"></a>3) 最重要的 10 行记录（示例）</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">1. tls.handshake  <span class=\"comment\"># Wireshark 过滤 TLS 握手</span></span><br><span class=\"line\">2. tls.handshake.type == 1  <span class=\"comment\"># 只看 ClientHello</span></span><br><span class=\"line\">3. curl.exe -Iv https://github.com  <span class=\"comment\"># 查看证书和 TLS 版本</span></span><br><span class=\"line\">4. Get-ChildItem <span class=\"variable\">$env</span>:USERPROFILE\\.ssh  <span class=\"comment\"># 列出 SSH 文件</span></span><br><span class=\"line\">5. python -c <span class=\"string\">&quot;import hashlib; hashlib.sha256(b&#x27;test&#x27;).hexdigest()&quot;</span>  <span class=\"comment\"># 快速哈希</span></span><br><span class=\"line\">6. TLS_AES_128_GCM_SHA256  <span class=\"comment\"># TLS 1.3 常见加密套件</span></span><br><span class=\"line\">7. CN=github.com  <span class=\"comment\"># 证书主题</span></span><br><span class=\"line\">8. SSL certificate verify ok  <span class=\"comment\"># 证书验证成功</span></span><br><span class=\"line\">9. PBKDF2 比 SHA-256 慢 5279 倍  <span class=\"comment\"># KDF 性能对比</span></span><br><span class=\"line\">10. $2b$12$...  <span class=\"comment\"># bcrypt 哈希格式</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-反思（示例）\"><a href=\"#4-反思（示例）\" class=\"headerlink\" title=\"4) 反思（示例）\"></a>4) 反思（示例）</h3><p><strong>我本周真正理解了</strong>：</p>\n<ul>\n<li>HTTPS 抓包虽然看不到明文，但能看到握手、证书、协议选择，对排错很有价值</li>\n<li>证书链验证不是”看见证书就行”，要检查域名&#x2F;有效期&#x2F;链完整&#x2F;根 CA 受信任</li>\n<li>known_hosts（客户端）存”我信任谁”，authorized_keys（服务器端）存”谁能登录我”</li>\n<li>密码存储不是”加密存”，而是”KDF 哈希 + salt”，因为密码是认证凭据不需要还原</li>\n<li>KDF 的”慢”不是缺点，是用来抗爆破的特性（单次 100ms 对用户无感，对攻击者致命）</li>\n</ul>\n<p><strong>我本周最大的坑是</strong>：</p>\n<ul>\n<li>一开始用 <code>ssl.handshake</code> 过滤器没结果，以为 Wireshark 坏了，后来才知道应该用 <code>tls.handshake</code></li>\n<li>以为 IV 要保密，其实 IV 可以公开但不能重复</li>\n<li>把签名当成加密，其实签名是防篡改+证明身份，不一定保密</li>\n</ul>\n<p><strong>我下周要避免的是</strong>：</p>\n<ul>\n<li>不要急着做任务，先理解原理再动手（比如先理解 TLS 握手流程，再去抓包）</li>\n<li>截图要包含完整信息（过滤器+数据包列表+详情面板），不要只截一部分</li>\n<li>遇到问题先看官方文档，不要瞎试（如 Wireshark 的 Display Filter Reference）</li>\n</ul>\n<h3 id=\"5-下周计划（示例）\"><a href=\"#5-下周计划（示例）\" class=\"headerlink\" title=\"5) 下周计划（示例）\"></a>5) 下周计划（示例）</h3><ol>\n<li>学习 Linux 文件权限（755&#x2F;644）和 sudo 配置</li>\n<li>继续深入 PowerShell 脚本自动化（日志分析、CSV 导出）</li>\n<li>搭建一个本地 Windows 测试环境练习事件日志分析</li>\n</ol>\n<p><strong>本周学习耗时</strong>：约 8 小时</p>\n<p><strong>掌握程度自评</strong>：</p>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> 😃 完成了所有任务并理解原理</li>\n</ul>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day015：操作系统与脚本 - Linux 安全基础","url":"/post/3ca7da61.html","content":"<h1 id=\"Day015：操作系统与脚本-Linux-安全基础\"><a href=\"#Day015：操作系统与脚本-Linux-安全基础\" class=\"headerlink\" title=\"Day015：操作系统与脚本 - Linux 安全基础\"></a>Day015：操作系统与脚本 - Linux 安全基础</h1><ul>\n<li>日期：2026-01-08</li>\n<li>周次：第 3 周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p>学完今天你应该能做到：</p>\n<ul>\n<li>能用一句话解释 Linux 安全三件套：<strong>用户&#x2F;组</strong>、<strong>权限</strong>、<strong>服务</strong></li>\n<li>看懂 <code>-rwxr-xr-x</code> 权限字符串，能算出 <code>755/644</code>，理解特殊权限（SUID&#x2F;SGID&#x2F;Sticky Bit）</li>\n<li>在”自建或明确授权”的 Linux 环境里完成最小加固动作：<ul>\n<li>新建普通用户并配置 sudo</li>\n<li>理解”禁止 root 直接登录”的原理（谨慎实施）</li>\n<li>查看安全日志并识别关键事件（登录成功&#x2F;失败&#x2F;sudo 使用）</li>\n<li>盘点监听端口（攻击面最小化）</li>\n</ul>\n</li>\n<li>输出一份 Linux 加固清单（至少 10 条可执行措施）</li>\n</ul>\n<blockquote>\n<p><strong>环境说明</strong>：没有 Linux 也能学！可用 WSL&#x2F;虚拟机&#x2F;云主机，或者先把”概念&#x2F;命令&#x2F;清单”整理出来。</p>\n</blockquote>\n<span id=\"more\"></span>\n\n<h2 id=\"学习内容\"><a href=\"#学习内容\" class=\"headerlink\" title=\"学习内容\"></a>学习内容</h2><h3 id=\"1️⃣-Linux-权限模型：3-类人-×-3-种权限-x3D-9-位权限位\"><a href=\"#1️⃣-Linux-权限模型：3-类人-×-3-种权限-x3D-9-位权限位\" class=\"headerlink\" title=\"1️⃣ Linux 权限模型：3 类人 × 3 种权限 &#x3D; 9 位权限位\"></a>1️⃣ Linux 权限模型：3 类人 × 3 种权限 &#x3D; 9 位权限位</h3><h4 id=\"基础权限（必须掌握）\"><a href=\"#基础权限（必须掌握）\" class=\"headerlink\" title=\"基础权限（必须掌握）\"></a>基础权限（必须掌握）</h4><p>Linux 文件权限看 <strong>3 类人</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>类别</th>\n<th>符号</th>\n<th>含义</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Owner</strong></td>\n<td><code>u</code></td>\n<td>文件拥有者（创建者或被 chown 指定）</td>\n<td>root、alice、www-data</td>\n</tr>\n<tr>\n<td><strong>Group</strong></td>\n<td><code>g</code></td>\n<td>文件所属组（同组用户共享权限）</td>\n<td>wheel、developers、www-data</td>\n</tr>\n<tr>\n<td><strong>Others</strong></td>\n<td><code>o</code></td>\n<td>其他所有人（非 owner 非 group）</td>\n<td>系统上的其他用户</td>\n</tr>\n</tbody></table>\n<p>每类人有 <strong>3 个权限位</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>权限</th>\n<th>符号</th>\n<th>数值</th>\n<th>文件含义</th>\n<th>目录含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Read</strong></td>\n<td><code>r</code></td>\n<td>4</td>\n<td>可读取文件内容</td>\n<td>可列出目录内容（ls）</td>\n</tr>\n<tr>\n<td><strong>Write</strong></td>\n<td><code>w</code></td>\n<td>2</td>\n<td>可修改文件内容</td>\n<td>可在目录中创建&#x2F;删除文件</td>\n</tr>\n<tr>\n<td><strong>Execute</strong></td>\n<td><code>x</code></td>\n<td>1</td>\n<td>可执行文件（脚本&#x2F;二进制）</td>\n<td>可进入目录（cd）</td>\n</tr>\n</tbody></table>\n<h4 id=\"权限计算（快速记忆）\"><a href=\"#权限计算（快速记忆）\" class=\"headerlink\" title=\"权限计算（快速记忆）\"></a>权限计算（快速记忆）</h4><table>\n<thead>\n<tr>\n<th>数字</th>\n<th>二进制</th>\n<th>权限</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>7</strong></td>\n<td>111</td>\n<td><code>rwx</code></td>\n<td>读+写+执行 (4+2+1)</td>\n</tr>\n<tr>\n<td><strong>6</strong></td>\n<td>110</td>\n<td><code>rw-</code></td>\n<td>读+写 (4+2)</td>\n</tr>\n<tr>\n<td><strong>5</strong></td>\n<td>101</td>\n<td><code>r-x</code></td>\n<td>读+执行 (4+1)</td>\n</tr>\n<tr>\n<td><strong>4</strong></td>\n<td>100</td>\n<td><code>r--</code></td>\n<td>只读 (4)</td>\n</tr>\n<tr>\n<td><strong>3</strong></td>\n<td>011</td>\n<td><code>-wx</code></td>\n<td>写+执行 (2+1)</td>\n</tr>\n<tr>\n<td><strong>2</strong></td>\n<td>010</td>\n<td><code>-w-</code></td>\n<td>只写 (2)</td>\n</tr>\n<tr>\n<td><strong>1</strong></td>\n<td>001</td>\n<td><code>--x</code></td>\n<td>只执行 (1)</td>\n</tr>\n<tr>\n<td><strong>0</strong></td>\n<td>000</td>\n<td><code>---</code></td>\n<td>无权限 (0)</td>\n</tr>\n</tbody></table>\n<p><strong>常见权限组合</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>权限</th>\n<th>数字表示</th>\n<th>典型用途</th>\n<th>示例文件</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>-rw-r--r--</code></td>\n<td><strong>644</strong></td>\n<td>普通文件（owner 可写，其他人只读）</td>\n<td><code>/etc/passwd</code></td>\n</tr>\n<tr>\n<td><code>-rwxr-xr-x</code></td>\n<td><strong>755</strong></td>\n<td>可执行文件&#x2F;脚本</td>\n<td><code>/usr/bin/ls</code></td>\n</tr>\n<tr>\n<td><code>-rw-------</code></td>\n<td><strong>600</strong></td>\n<td>私密文件（只有 owner 可读写）</td>\n<td><code>~/.ssh/id_rsa</code></td>\n</tr>\n<tr>\n<td><code>-rw-r-----</code></td>\n<td><strong>640</strong></td>\n<td>敏感配置（owner 可写，group 可读）</td>\n<td><code>/etc/shadow</code></td>\n</tr>\n<tr>\n<td><code>drwxr-xr-x</code></td>\n<td><strong>755</strong></td>\n<td>普通目录</td>\n<td><code>/home/alice</code></td>\n</tr>\n<tr>\n<td><code>drwx------</code></td>\n<td><strong>700</strong></td>\n<td>私密目录</td>\n<td><code>~/.ssh/</code></td>\n</tr>\n</tbody></table>\n<p><strong>实战示例</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看文件权限</span></span><br><span class=\"line\"><span class=\"built_in\">ls</span> -l /etc/passwd</span><br><span class=\"line\"><span class=\"comment\"># 输出：-rw-r--r-- 1 root root 2847 Jan 1 12:00 /etc/passwd</span></span><br><span class=\"line\"><span class=\"comment\">#      │└┬┘└┬┘└┬┘  │  │    │    │    │</span></span><br><span class=\"line\"><span class=\"comment\">#      │ │  │  │   │  │    │    │    └─ 文件名</span></span><br><span class=\"line\"><span class=\"comment\">#      │ │  │  │   │  │    │    └─ 修改时间</span></span><br><span class=\"line\"><span class=\"comment\">#      │ │  │  │   │  │    └─ 文件大小</span></span><br><span class=\"line\"><span class=\"comment\">#      │ │  │  │   │  └─ 所属组</span></span><br><span class=\"line\"><span class=\"comment\">#      │ │  │  │   └─ 所有者</span></span><br><span class=\"line\"><span class=\"comment\">#      │ │  │  └─ others (r--) = 4</span></span><br><span class=\"line\"><span class=\"comment\">#      │ │  └─ group (r--) = 4</span></span><br><span class=\"line\"><span class=\"comment\">#      │ └─ owner (rw-) = 6</span></span><br><span class=\"line\"><span class=\"comment\">#      └─ 文件类型 (- 普通文件, d 目录, l 软链接)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">ls</span> -l /etc/shadow</span><br><span class=\"line\"><span class=\"comment\"># 输出：-rw-r----- 1 root shadow 1234 Jan 1 12:00 /etc/shadow</span></span><br><span class=\"line\"><span class=\"comment\"># 权限：640 (owner=rw, group=r, others=无)</span></span><br><span class=\"line\"><span class=\"comment\"># 原因：密码哈希敏感，只有 root 和 shadow 组可读</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"特殊权限（进阶理解）\"><a href=\"#特殊权限（进阶理解）\" class=\"headerlink\" title=\"特殊权限（进阶理解）\"></a>特殊权限（进阶理解）</h4><table>\n<thead>\n<tr>\n<th>权限</th>\n<th>符号</th>\n<th>数值</th>\n<th>作用</th>\n<th>典型应用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>SUID</strong></td>\n<td><code>s</code>（owner x 位）</td>\n<td>4000</td>\n<td>执行时以文件 owner 身份运行</td>\n<td><code>/usr/bin/passwd</code>（普通用户改密码需要写 &#x2F;etc&#x2F;shadow）</td>\n</tr>\n<tr>\n<td><strong>SGID</strong></td>\n<td><code>s</code>（group x 位）</td>\n<td>2000</td>\n<td>执行时以文件 group 身份运行；目录中新建文件继承目录 group</td>\n<td>共享目录</td>\n</tr>\n<tr>\n<td><strong>Sticky Bit</strong></td>\n<td><code>t</code>（others x 位）</td>\n<td>1000</td>\n<td>目录中只有文件 owner 才能删除自己的文件</td>\n<td><code>/tmp</code>（防止用户互删文件）</td>\n</tr>\n</tbody></table>\n<p><strong>SUID 示例</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">ls</span> -l /usr/bin/passwd</span><br><span class=\"line\"><span class=\"comment\"># 输出：-rwsr-xr-x 1 root root 68208 /usr/bin/passwd</span></span><br><span class=\"line\"><span class=\"comment\">#           ↑ s 表示 SUID（4755）</span></span><br><span class=\"line\"><span class=\"comment\"># 原理：普通用户执行 passwd 时，临时获得 root 权限，可以修改 /etc/shadow</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>危险点</strong>：</p>\n<ul>\n<li>❌ <strong>SUID 滥用</strong>：攻击者可能利用有漏洞的 SUID 程序提权</li>\n<li>✅ <strong>定期检查</strong>：<code>find / -perm -4000 -type f 2&gt;/dev/null</code>（查找所有 SUID 文件）</li>\n</ul>\n<h3 id=\"2️⃣-用户与组管理：最小权限原则\"><a href=\"#2️⃣-用户与组管理：最小权限原则\" class=\"headerlink\" title=\"2️⃣ 用户与组管理：最小权限原则\"></a>2️⃣ 用户与组管理：最小权限原则</h3><h4 id=\"核心原则\"><a href=\"#核心原则\" class=\"headerlink\" title=\"核心原则\"></a>核心原则</h4><ul>\n<li><strong>日常用普通用户</strong>：避免全程 root 操作（误操作 &#x3D; 灾难）</li>\n<li><strong>sudo 按需提权</strong>：需要时才提升权限，操作可审计</li>\n<li><strong>禁止 root 远程登录</strong>：防止暴力破解（改用密钥认证 + 普通用户登录）</li>\n</ul>\n<h4 id=\"用户管理命令\"><a href=\"#用户管理命令\" class=\"headerlink\" title=\"用户管理命令\"></a>用户管理命令</h4><table>\n<thead>\n<tr>\n<th>操作</th>\n<th>命令</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>新建用户</td>\n<td><code>useradd -m &lt;用户名&gt;</code></td>\n<td><code>sudo useradd -m alice</code></td>\n</tr>\n<tr>\n<td>设置密码</td>\n<td><code>passwd &lt;用户名&gt;</code></td>\n<td><code>sudo passwd alice</code></td>\n</tr>\n<tr>\n<td>删除用户</td>\n<td><code>userdel -r &lt;用户名&gt;</code></td>\n<td><code>sudo userdel -r alice</code>（<code>-r</code> 删除主目录）</td>\n</tr>\n<tr>\n<td>修改用户组</td>\n<td><code>usermod -aG &lt;组名&gt; &lt;用户&gt;</code></td>\n<td><code>sudo usermod -aG sudo alice</code></td>\n</tr>\n<tr>\n<td>查看用户信息</td>\n<td><code>id &lt;用户名&gt;</code></td>\n<td><code>id alice</code></td>\n</tr>\n<tr>\n<td>列出所有用户</td>\n<td><code>cat /etc/passwd</code></td>\n<td>查看 UID、主目录、默认 shell</td>\n</tr>\n</tbody></table>\n<h4 id=\"sudo-配置（sudoers-文件）\"><a href=\"#sudo-配置（sudoers-文件）\" class=\"headerlink\" title=\"sudo 配置（sudoers 文件）\"></a>sudo 配置（sudoers 文件）</h4><p><strong>基础语法</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 编辑 sudoers（必须用 visudo，会检查语法错误）</span></span><br><span class=\"line\">sudo visudo</span><br></pre></td></tr></table></figure>\n\n<p><strong>常见配置示例</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. 允许 sudo 组的所有用户执行任何命令</span></span><br><span class=\"line\">%sudo   ALL=(ALL:ALL) ALL</span><br><span class=\"line\"><span class=\"comment\">#  │     │   │   │    │</span></span><br><span class=\"line\"><span class=\"comment\">#  │     │   │   │    └─ 可执行的命令（ALL = 所有）</span></span><br><span class=\"line\"><span class=\"comment\">#  │     │   │   └─ 可切换到的组</span></span><br><span class=\"line\"><span class=\"comment\">#  │     │   └─ 可切换到的用户</span></span><br><span class=\"line\"><span class=\"comment\">#  │     └─ 可在哪些主机执行</span></span><br><span class=\"line\"><span class=\"comment\">#  └─ % 表示组名</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. 允许 alice 执行特定命令（无需密码）</span></span><br><span class=\"line\">alice   ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart nginx</span><br><span class=\"line\"><span class=\"comment\">#       ↑ 重启 nginx 不需要输密码</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. 允许 devops 组执行所有命令（无需密码）</span></span><br><span class=\"line\">%devops ALL=(ALL) NOPASSWD: ALL</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4. 只允许 alice 重启特定服务</span></span><br><span class=\"line\">alice   ALL=(ALL) /usr/bin/systemctl restart nginx, /usr/bin/systemctl reload nginx</span><br></pre></td></tr></table></figure>\n\n<p><strong>安全建议</strong>：</p>\n<ul>\n<li>✅ 用 <code>visudo</code> 编辑（防止语法错误导致 sudo 失效）</li>\n<li>✅ 最小权限：只给需要的命令权限（不要全部 NOPASSWD）</li>\n<li>✅ 审计日志：sudo 操作会记录到 <code>/var/log/auth.log</code></li>\n</ul>\n<h3 id=\"3️⃣-服务管理：攻击面最小化\"><a href=\"#3️⃣-服务管理：攻击面最小化\" class=\"headerlink\" title=\"3️⃣ 服务管理：攻击面最小化\"></a>3️⃣ 服务管理：攻击面最小化</h3><h4 id=\"systemd-服务管理（现代-Linux）\"><a href=\"#systemd-服务管理（现代-Linux）\" class=\"headerlink\" title=\"systemd 服务管理（现代 Linux）\"></a>systemd 服务管理（现代 Linux）</h4><table>\n<thead>\n<tr>\n<th>操作</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>列出所有服务</td>\n<td><code>systemctl list-units --type=service</code></td>\n<td>查看运行中的服务</td>\n</tr>\n<tr>\n<td>启动服务</td>\n<td><code>sudo systemctl start &lt;服务名&gt;</code></td>\n<td><code>sudo systemctl start nginx</code></td>\n</tr>\n<tr>\n<td>停止服务</td>\n<td><code>sudo systemctl stop &lt;服务名&gt;</code></td>\n<td><code>sudo systemctl stop apache2</code></td>\n</tr>\n<tr>\n<td>重启服务</td>\n<td><code>sudo systemctl restart &lt;服务名&gt;</code></td>\n<td><code>sudo systemctl restart sshd</code></td>\n</tr>\n<tr>\n<td>开机自启</td>\n<td><code>sudo systemctl enable &lt;服务名&gt;</code></td>\n<td><code>sudo systemctl enable nginx</code></td>\n</tr>\n<tr>\n<td>禁止自启</td>\n<td><code>sudo systemctl disable &lt;服务名&gt;</code></td>\n<td><code>sudo systemctl disable bluetooth</code></td>\n</tr>\n<tr>\n<td>查看服务状态</td>\n<td><code>systemctl status &lt;服务名&gt;</code></td>\n<td><code>systemctl status sshd</code></td>\n</tr>\n<tr>\n<td>查看服务日志</td>\n<td><code>journalctl -u &lt;服务名&gt;</code></td>\n<td><code>journalctl -u sshd -n 50</code></td>\n</tr>\n</tbody></table>\n<h4 id=\"监听端口排查（攻击面盘点）\"><a href=\"#监听端口排查（攻击面盘点）\" class=\"headerlink\" title=\"监听端口排查（攻击面盘点）\"></a>监听端口排查（攻击面盘点）</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看所有监听端口（推荐）</span></span><br><span class=\"line\">sudo ss -lntup</span><br><span class=\"line\"><span class=\"comment\"># -l: listening（监听）</span></span><br><span class=\"line\"><span class=\"comment\"># -n: numeric（显示 IP 而不是域名）</span></span><br><span class=\"line\"><span class=\"comment\"># -t: TCP</span></span><br><span class=\"line\"><span class=\"comment\"># -u: UDP</span></span><br><span class=\"line\"><span class=\"comment\"># -p: process（显示进程名）</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 输出示例：</span></span><br><span class=\"line\"><span class=\"comment\"># Netid  State   Local Address:Port   Process</span></span><br><span class=\"line\"><span class=\"comment\"># tcp    LISTEN  0.0.0.0:22            users:((&quot;sshd&quot;,pid=1234))</span></span><br><span class=\"line\"><span class=\"comment\"># tcp    LISTEN  0.0.0.0:80            users:((&quot;nginx&quot;,pid=5678))</span></span><br><span class=\"line\"><span class=\"comment\"># tcp    LISTEN  127.0.0.1:3306        users:((&quot;mysqld&quot;,pid=9012))</span></span><br><span class=\"line\"><span class=\"comment\">#        ↑                              ↑</span></span><br><span class=\"line\"><span class=\"comment\">#     监听所有接口                   只监听本地</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>常见端口与风险</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>端口</th>\n<th>服务</th>\n<th>风险</th>\n<th>建议</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>22</strong></td>\n<td>SSH</td>\n<td>暴力破解、弱密码</td>\n<td>改端口、密钥认证、禁止 root 登录</td>\n</tr>\n<tr>\n<td><strong>80&#x2F;443</strong></td>\n<td>HTTP&#x2F;HTTPS</td>\n<td>Web 漏洞</td>\n<td>及时更新、WAF、最小权限运行</td>\n</tr>\n<tr>\n<td><strong>3306</strong></td>\n<td>MySQL</td>\n<td>数据库泄露</td>\n<td><strong>只监听 127.0.0.1</strong>（不对外）</td>\n</tr>\n<tr>\n<td><strong>5432</strong></td>\n<td>PostgreSQL</td>\n<td>数据库泄露</td>\n<td>同上</td>\n</tr>\n<tr>\n<td><strong>6379</strong></td>\n<td>Redis</td>\n<td>未授权访问</td>\n<td>设置密码、绑定内网 IP</td>\n</tr>\n<tr>\n<td><strong>3389</strong></td>\n<td>RDP（Windows）</td>\n<td>暴力破解</td>\n<td>Linux 一般没有，如有则关闭</td>\n</tr>\n<tr>\n<td><strong>445</strong></td>\n<td>SMB</td>\n<td>勒索病毒</td>\n<td>Linux 一般没有，如有则关闭</td>\n</tr>\n</tbody></table>\n<p><strong>最小暴露原则</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ✅ 好：数据库只监听本地（127.0.0.1:3306）</span></span><br><span class=\"line\"><span class=\"comment\"># ❌ 坏：数据库监听所有接口（0.0.0.0:3306）</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 检查命令</span></span><br><span class=\"line\">sudo ss -lntp | grep :3306</span><br><span class=\"line\"><span class=\"comment\"># 如果看到 0.0.0.0:3306 或 :::3306，说明对外暴露了！</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4️⃣-日志审计：你的”黑匣子”\"><a href=\"#4️⃣-日志审计：你的”黑匣子”\" class=\"headerlink\" title=\"4️⃣ 日志审计：你的”黑匣子”\"></a>4️⃣ 日志审计：你的”黑匣子”</h3><h4 id=\"常见日志位置\"><a href=\"#常见日志位置\" class=\"headerlink\" title=\"常见日志位置\"></a>常见日志位置</h4><table>\n<thead>\n<tr>\n<th>日志文件</th>\n<th>内容</th>\n<th>发行版</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>/var/log/auth.log</code></td>\n<td>认证日志（登录&#x2F;sudo&#x2F;su）</td>\n<td>Debian&#x2F;Ubuntu</td>\n</tr>\n<tr>\n<td><code>/var/log/secure</code></td>\n<td>认证日志</td>\n<td>RHEL&#x2F;CentOS</td>\n</tr>\n<tr>\n<td><code>/var/log/syslog</code></td>\n<td>系统日志</td>\n<td>Debian&#x2F;Ubuntu</td>\n</tr>\n<tr>\n<td><code>/var/log/messages</code></td>\n<td>系统日志</td>\n<td>RHEL&#x2F;CentOS</td>\n</tr>\n<tr>\n<td><code>journalctl</code></td>\n<td>systemd 日志（现代系统）</td>\n<td>所有使用 systemd 的发行版</td>\n</tr>\n</tbody></table>\n<h4 id=\"关键事件识别\"><a href=\"#关键事件识别\" class=\"headerlink\" title=\"关键事件识别\"></a>关键事件识别</h4><p><strong>1. SSH 登录成功</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看最近的 SSH 登录</span></span><br><span class=\"line\">sudo journalctl -u sshd | grep <span class=\"string\">&quot;Accepted&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 示例输出：</span></span><br><span class=\"line\"><span class=\"comment\"># Jan 08 10:23:45 server sshd[12345]: Accepted publickey for alice from 192.168.1.100 port 54321 ssh2: RSA SHA256:abc123...</span></span><br><span class=\"line\"><span class=\"comment\">#                                       ↑             ↑           ↑                   ↑</span></span><br><span class=\"line\"><span class=\"comment\">#                                    认证方式      用户名        来源IP              端口</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>2. SSH 登录失败（暴力破解线索）</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo journalctl -u sshd | grep <span class=\"string\">&quot;Failed&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 示例输出：</span></span><br><span class=\"line\"><span class=\"comment\"># Jan 08 10:25:30 server sshd[12346]: Failed password for invalid user admin from 203.0.113.45 port 43210 ssh2</span></span><br><span class=\"line\"><span class=\"comment\">#                                                             ↑           ↑            ↑</span></span><br><span class=\"line\"><span class=\"comment\">#                                                         无效用户    用户名      攻击来源IP</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>3. sudo 使用记录</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo grep <span class=\"string\">&quot;sudo&quot;</span> /var/log/auth.log | <span class=\"built_in\">tail</span> -n 20</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 示例输出：</span></span><br><span class=\"line\"><span class=\"comment\"># Jan 08 10:30:00 server sudo: alice : TTY=pts/0 ; PWD=/home/alice ; USER=root ; COMMAND=/usr/bin/apt update</span></span><br><span class=\"line\"><span class=\"comment\">#                        ↑                                                ↑               ↑</span></span><br><span class=\"line\"><span class=\"comment\">#                    谁用 sudo                                        切换到谁        执行了什么命令</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>4. 用户创建&#x2F;删除</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo grep <span class=\"string\">&quot;useradd\\|userdel&quot;</span> /var/log/auth.log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 示例输出：</span></span><br><span class=\"line\"><span class=\"comment\"># Jan 08 11:00:00 server useradd[12347]: new user: name=bob, UID=1001, GID=1001, home=/home/bob</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"journalctl-高级用法\"><a href=\"#journalctl-高级用法\" class=\"headerlink\" title=\"journalctl 高级用法\"></a>journalctl 高级用法</h4><table>\n<thead>\n<tr>\n<th>用途</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>查看某服务日志</td>\n<td><code>journalctl -u sshd</code></td>\n<td>只看 sshd 服务</td>\n</tr>\n<tr>\n<td>查看最近 N 行</td>\n<td><code>journalctl -n 50</code></td>\n<td>最近 50 行</td>\n</tr>\n<tr>\n<td>实时查看</td>\n<td><code>journalctl -f</code></td>\n<td>类似 <code>tail -f</code></td>\n</tr>\n<tr>\n<td>按时间筛选</td>\n<td><code>journalctl --since &quot;2026-01-08 10:00&quot;</code></td>\n<td>10点后的日志</td>\n</tr>\n<tr>\n<td>按优先级筛选</td>\n<td><code>journalctl -p err</code></td>\n<td>只看错误级别</td>\n</tr>\n<tr>\n<td>查看启动日志</td>\n<td><code>journalctl -b</code></td>\n<td>本次启动的日志</td>\n</tr>\n</tbody></table>\n<h3 id=\"5️⃣-防火墙基础：iptables-vs-firewalld-vs-ufw\"><a href=\"#5️⃣-防火墙基础：iptables-vs-firewalld-vs-ufw\" class=\"headerlink\" title=\"5️⃣ 防火墙基础：iptables vs firewalld vs ufw\"></a>5️⃣ 防火墙基础：iptables vs firewalld vs ufw</h3><table>\n<thead>\n<tr>\n<th>防火墙</th>\n<th>发行版</th>\n<th>特点</th>\n<th>学习曲线</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>iptables</strong></td>\n<td>通用</td>\n<td>底层、强大、复杂</td>\n<td>陡峭</td>\n</tr>\n<tr>\n<td><strong>firewalld</strong></td>\n<td>RHEL&#x2F;CentOS</td>\n<td>动态规则、区域管理</td>\n<td>中等</td>\n</tr>\n<tr>\n<td><strong>ufw</strong></td>\n<td>Ubuntu</td>\n<td>简化版 iptables，易用</td>\n<td>平缓</td>\n</tr>\n</tbody></table>\n<h4 id=\"ufw-快速入门（Ubuntu-推荐）\"><a href=\"#ufw-快速入门（Ubuntu-推荐）\" class=\"headerlink\" title=\"ufw 快速入门（Ubuntu 推荐）\"></a>ufw 快速入门（Ubuntu 推荐）</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. 启用防火墙</span></span><br><span class=\"line\">sudo ufw <span class=\"built_in\">enable</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. 查看状态</span></span><br><span class=\"line\">sudo ufw status</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. 允许特定端口</span></span><br><span class=\"line\">sudo ufw allow 22/tcp    <span class=\"comment\"># SSH</span></span><br><span class=\"line\">sudo ufw allow 80/tcp    <span class=\"comment\"># HTTP</span></span><br><span class=\"line\">sudo ufw allow 443/tcp   <span class=\"comment\"># HTTPS</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4. 允许特定 IP 访问特定端口</span></span><br><span class=\"line\">sudo ufw allow from 192.168.1.0/24 to any port 22</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5. 拒绝特定端口</span></span><br><span class=\"line\">sudo ufw deny 3306/tcp   <span class=\"comment\"># MySQL</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 6. 删除规则</span></span><br><span class=\"line\">sudo ufw delete allow 80/tcp</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 7. 重置所有规则</span></span><br><span class=\"line\">sudo ufw reset</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"实践任务（合法授权范围内）\"><a href=\"#实践任务（合法授权范围内）\" class=\"headerlink\" title=\"实践任务（合法授权范围内）\"></a>实践任务（合法授权范围内）</h2><blockquote>\n<p>⚠️ <strong>重要提醒</strong>：所有操作只在<strong>自建&#x2F;明确授权</strong>的 Linux 环境执行！</p>\n</blockquote>\n<h3 id=\"任务-0（准备环境，三选一）\"><a href=\"#任务-0（准备环境，三选一）\" class=\"headerlink\" title=\"任务 0（准备环境，三选一）\"></a>任务 0（准备环境，三选一）</h3><table>\n<thead>\n<tr>\n<th>方案</th>\n<th>难度</th>\n<th>成本</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>A. WSL</strong></td>\n<td>⭐</td>\n<td>免费</td>\n<td>Windows 10&#x2F;11 自带，适合学习</td>\n</tr>\n<tr>\n<td><strong>B. VirtualBox&#x2F;VMware</strong></td>\n<td>⭐⭐</td>\n<td>免费</td>\n<td>需要下载 ISO（推荐 Ubuntu 22.04 LTS）</td>\n</tr>\n<tr>\n<td><strong>C. 云主机</strong></td>\n<td>⭐⭐⭐</td>\n<td>按量付费</td>\n<td>AWS&#x2F;阿里云轻量服务器（注意关机节约成本）</td>\n</tr>\n</tbody></table>\n<p><strong>WSL 快速安装</strong>（推荐）：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Windows PowerShell（管理员）</span></span><br><span class=\"line\">wsl <span class=\"literal\">--install</span> <span class=\"literal\">-d</span> Ubuntu<span class=\"literal\">-22</span>.<span class=\"number\">04</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装完成后，设置用户名和密码</span></span><br><span class=\"line\"><span class=\"comment\"># 进入 WSL：直接在命令行输入 `wsl` 或 `ubuntu`</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"任务-1（必做）：文件权限识别与转换\"><a href=\"#任务-1（必做）：文件权限识别与转换\" class=\"headerlink\" title=\"任务 1（必做）：文件权限识别与转换\"></a>任务 1（必做）：文件权限识别与转换</h3><h4 id=\"步骤-1：查看敏感文件权限\"><a href=\"#步骤-1：查看敏感文件权限\" class=\"headerlink\" title=\"步骤 1：查看敏感文件权限\"></a>步骤 1：查看敏感文件权限</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看 /etc/passwd（用户信息）</span></span><br><span class=\"line\"><span class=\"built_in\">ls</span> -l /etc/passwd</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看 /etc/shadow（密码哈希）</span></span><br><span class=\"line\"><span class=\"built_in\">ls</span> -l /etc/shadow</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看 SSH 私钥（如果有）</span></span><br><span class=\"line\"><span class=\"built_in\">ls</span> -l ~/.ssh/id_* 2&gt;/dev/null</span><br></pre></td></tr></table></figure>\n\n<p><strong>你要记录的内容</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>文件</th>\n<th>权限（符号）</th>\n<th>权限（数字）</th>\n<th>所有者</th>\n<th>所属组</th>\n<th>为什么这样设置？</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>/etc/passwd</code></td>\n<td><code>-rw-r--r--</code></td>\n<td>644</td>\n<td>root</td>\n<td>root</td>\n<td>用户信息公开可读，但只有 root 可写</td>\n</tr>\n<tr>\n<td><code>/etc/shadow</code></td>\n<td><code>-rw-r-----</code></td>\n<td>640</td>\n<td>root</td>\n<td>shadow</td>\n<td>密码哈希敏感，只有 root 和 shadow 组可读</td>\n</tr>\n<tr>\n<td><code>~/.ssh/id_rsa</code></td>\n<td><code>-rw-------</code></td>\n<td>600</td>\n<td>alice</td>\n<td>alice</td>\n<td>SSH 私钥必须只有 owner 可读写</td>\n</tr>\n</tbody></table>\n<h4 id=\"步骤-2：权限计算练习\"><a href=\"#步骤-2：权限计算练习\" class=\"headerlink\" title=\"步骤 2：权限计算练习\"></a>步骤 2：权限计算练习</h4><p>手动计算以下权限：</p>\n<ol>\n<li><code>-rwxr-x---</code> &#x3D; ?</li>\n<li><code>-rw-rw-r--</code> &#x3D; ?</li>\n<li><code>drwx------</code> &#x3D; ?</li>\n</ol>\n<details>\n<summary>答案</summary>\n\n<ol>\n<li><code>750</code>（owner&#x3D;7, group&#x3D;5, others&#x3D;0）</li>\n<li><code>664</code>（owner&#x3D;6, group&#x3D;6, others&#x3D;4）</li>\n<li><code>700</code>（目录，owner&#x3D;7, group&#x3D;0, others&#x3D;0）</details></li>\n</ol>\n<h3 id=\"任务-2（必做）：创建用户并配置-sudo\"><a href=\"#任务-2（必做）：创建用户并配置-sudo\" class=\"headerlink\" title=\"任务 2（必做）：创建用户并配置 sudo\"></a>任务 2（必做）：创建用户并配置 sudo</h3><h4 id=\"步骤-1：创建新用户\"><a href=\"#步骤-1：创建新用户\" class=\"headerlink\" title=\"步骤 1：创建新用户\"></a>步骤 1：创建新用户</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 创建用户（-m 创建主目录）</span></span><br><span class=\"line\">sudo useradd -m -s /bin/bash alice</span><br><span class=\"line\"><span class=\"comment\">#            │  │</span></span><br><span class=\"line\"><span class=\"comment\">#            │  └─ 指定默认 shell</span></span><br><span class=\"line\"><span class=\"comment\">#            └─ 创建 /home/alice</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置密码</span></span><br><span class=\"line\">sudo passwd alice</span><br><span class=\"line\"><span class=\"comment\"># 输入两次密码（建议：P@ssw0rd!123）</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"步骤-2：将用户加入-sudo-组\"><a href=\"#步骤-2：将用户加入-sudo-组\" class=\"headerlink\" title=\"步骤 2：将用户加入 sudo 组\"></a>步骤 2：将用户加入 sudo 组</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Ubuntu/Debian</span></span><br><span class=\"line\">sudo usermod -aG sudo alice</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># RHEL/CentOS</span></span><br><span class=\"line\">sudo usermod -aG wheel alice</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"步骤-3：验证配置\"><a href=\"#步骤-3：验证配置\" class=\"headerlink\" title=\"步骤 3：验证配置\"></a>步骤 3：验证配置</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看用户信息</span></span><br><span class=\"line\"><span class=\"built_in\">id</span> alice</span><br><span class=\"line\"><span class=\"comment\"># 输出应包含：groups=...,27(sudo),...</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 切换到新用户测试 sudo</span></span><br><span class=\"line\">su - alice</span><br><span class=\"line\"><span class=\"comment\"># 输入 alice 的密码</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 测试 sudo</span></span><br><span class=\"line\">sudo <span class=\"built_in\">whoami</span></span><br><span class=\"line\"><span class=\"comment\"># 输入 alice 的密码</span></span><br><span class=\"line\"><span class=\"comment\"># 输出：root（说明 sudo 生效）</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>你要提交的证据</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> <code>id alice</code> 的输出截图（能看到 sudo 组）</li>\n<li><input disabled=\"\" type=\"checkbox\"> <code>sudo whoami</code> 的输出（显示 root）</li>\n</ul>\n<h3 id=\"任务-3（必做）：盘点监听端口（攻击面评估）\"><a href=\"#任务-3（必做）：盘点监听端口（攻击面评估）\" class=\"headerlink\" title=\"任务 3（必做）：盘点监听端口（攻击面评估）\"></a>任务 3（必做）：盘点监听端口（攻击面评估）</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看所有监听端口</span></span><br><span class=\"line\">sudo ss -lntup | column -t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 或者用更详细的输出</span></span><br><span class=\"line\">sudo ss -lntup | awk <span class=\"string\">&#x27;NR==1 || /LISTEN/ &#123;print $0&#125;&#x27;</span> | column -t</span><br></pre></td></tr></table></figure>\n\n<p><strong>你要分析的内容</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>端口</th>\n<th>协议</th>\n<th>进程名</th>\n<th>监听地址</th>\n<th>是否需要对外？</th>\n<th>风险评估</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>22</td>\n<td>TCP</td>\n<td>sshd</td>\n<td>0.0.0.0</td>\n<td>✅ 是（远程管理）</td>\n<td>高（改端口&#x2F;密钥认证）</td>\n</tr>\n<tr>\n<td>80</td>\n<td>TCP</td>\n<td>nginx</td>\n<td>0.0.0.0</td>\n<td>✅ 是（Web 服务）</td>\n<td>中（及时更新）</td>\n</tr>\n<tr>\n<td>3306</td>\n<td>TCP</td>\n<td>mysqld</td>\n<td><strong>0.0.0.0</strong></td>\n<td>❌ 否（应该 127.0.0.1）</td>\n<td><strong>高风险！</strong></td>\n</tr>\n</tbody></table>\n<p><strong>修复示例</strong>（MySQL 只监听本地）：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 编辑 MySQL 配置</span></span><br><span class=\"line\">sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 找到 bind-address 行，改为：</span></span><br><span class=\"line\">bind-address = 127.0.0.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重启 MySQL</span></span><br><span class=\"line\">sudo systemctl restart mysql</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 验证</span></span><br><span class=\"line\">sudo ss -lntp | grep :3306</span><br><span class=\"line\"><span class=\"comment\"># 应该看到 127.0.0.1:3306（不是 0.0.0.0）</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"任务-4（必做）：查看认证日志\"><a href=\"#任务-4（必做）：查看认证日志\" class=\"headerlink\" title=\"任务 4（必做）：查看认证日志\"></a>任务 4（必做）：查看认证日志</h3><h4 id=\"方案-A：journalctl（推荐）\"><a href=\"#方案-A：journalctl（推荐）\" class=\"headerlink\" title=\"方案 A：journalctl（推荐）\"></a>方案 A：journalctl（推荐）</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看 SSH 服务日志（最近 50 行）</span></span><br><span class=\"line\">sudo journalctl -u ssh -n 50 --no-pager</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 筛选登录成功事件</span></span><br><span class=\"line\">sudo journalctl -u ssh | grep <span class=\"string\">&quot;Accepted&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 筛选登录失败事件</span></span><br><span class=\"line\">sudo journalctl -u ssh | grep <span class=\"string\">&quot;Failed&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看今天的 sudo 使用记录</span></span><br><span class=\"line\">sudo journalctl --since today | grep sudo</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"方案-B：传统日志文件\"><a href=\"#方案-B：传统日志文件\" class=\"headerlink\" title=\"方案 B：传统日志文件\"></a>方案 B：传统日志文件</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Ubuntu/Debian</span></span><br><span class=\"line\">sudo <span class=\"built_in\">tail</span> -n 50 /var/log/auth.log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># RHEL/CentOS</span></span><br><span class=\"line\">sudo <span class=\"built_in\">tail</span> -n 50 /var/log/secure</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 筛选 SSH 登录</span></span><br><span class=\"line\">sudo grep <span class=\"string\">&quot;sshd.*Accepted&quot;</span> /var/log/auth.log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 筛选 sudo 使用</span></span><br><span class=\"line\">sudo grep <span class=\"string\">&quot;sudo.*COMMAND&quot;</span> /var/log/auth.log</span><br></pre></td></tr></table></figure>\n\n<p><strong>你要提取的信息</strong>：</p>\n<ol>\n<li><p><strong>最近一次成功登录</strong>：</p>\n<ul>\n<li>用户名：</li>\n<li>来源 IP：</li>\n<li>认证方式（password&#x2F;publickey）：</li>\n<li>时间：</li>\n</ul>\n</li>\n<li><p><strong>最近一次 sudo 使用</strong>：</p>\n<ul>\n<li>用户名：</li>\n<li>执行的命令：</li>\n<li>时间：</li>\n</ul>\n</li>\n<li><p><strong>异常事件</strong>（如果有）：</p>\n<ul>\n<li>失败登录次数：</li>\n<li>来源 IP（是否陌生）：</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"任务-5（可选）：配置-ufw-防火墙\"><a href=\"#任务-5（可选）：配置-ufw-防火墙\" class=\"headerlink\" title=\"任务 5（可选）：配置 ufw 防火墙\"></a>任务 5（可选）：配置 ufw 防火墙</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. 安装 ufw（Ubuntu 一般自带）</span></span><br><span class=\"line\">sudo apt install ufw</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. 查看当前状态</span></span><br><span class=\"line\">sudo ufw status verbose</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. 设置默认策略（拒绝所有入站，允许所有出站）</span></span><br><span class=\"line\">sudo ufw default deny incoming</span><br><span class=\"line\">sudo ufw default allow outgoing</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4. 允许 SSH（⚠️ 先允许 SSH，否则会把自己锁死！）</span></span><br><span class=\"line\">sudo ufw allow 22/tcp</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5. 启用防火墙</span></span><br><span class=\"line\">sudo ufw <span class=\"built_in\">enable</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 6. 验证规则</span></span><br><span class=\"line\">sudo ufw status numbered</span><br></pre></td></tr></table></figure>\n\n<p><strong>扩展练习</strong>：</p>\n<ul>\n<li>只允许特定 IP 段访问 SSH：<code>sudo ufw allow from 192.168.1.0/24 to any port 22</code></li>\n<li>允许 HTTP&#x2F;HTTPS：<code>sudo ufw allow 80/tcp; sudo ufw allow 443/tcp</code></li>\n<li>拒绝特定 IP：<code>sudo ufw deny from 203.0.113.45</code></li>\n</ul>\n<h2 id=\"巩固练习（题与复盘）\"><a href=\"#巩固练习（题与复盘）\" class=\"headerlink\" title=\"巩固练习（题与复盘）\"></a>巩固练习（题与复盘）</h2><h3 id=\"题-1：权限转换（必做）\"><a href=\"#题-1：权限转换（必做）\" class=\"headerlink\" title=\"题 1：权限转换（必做）\"></a>题 1：权限转换（必做）</h3><p>将以下权限互相转换：</p>\n<table>\n<thead>\n<tr>\n<th>符号表示</th>\n<th>数字表示</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>-rwxr-xr-x</code></td>\n<td>?</td>\n</tr>\n<tr>\n<td><code>-rw-r-----</code></td>\n<td>?</td>\n</tr>\n<tr>\n<td><code>drwx------</code></td>\n<td>?</td>\n</tr>\n<tr>\n<td><code>?</code></td>\n<td>644</td>\n</tr>\n<tr>\n<td><code>?</code></td>\n<td>750</td>\n</tr>\n<tr>\n<td><code>?</code></td>\n<td>600</td>\n</tr>\n</tbody></table>\n<h3 id=\"题-2：安全场景判断（必做）\"><a href=\"#题-2：安全场景判断（必做）\" class=\"headerlink\" title=\"题 2：安全场景判断（必做）\"></a>题 2：安全场景判断（必做）</h3><p>判断以下配置是否安全，如果不安全，写出正确配置：</p>\n<ol>\n<li><code>/etc/shadow</code> 权限是 <code>644</code></li>\n<li>SSH 私钥 <code>~/.ssh/id_rsa</code> 权限是 <code>644</code></li>\n<li>MySQL 监听 <code>0.0.0.0:3306</code></li>\n<li>所有用户都在 sudoers 中配置了 <code>NOPASSWD: ALL</code></li>\n<li>SSH 配置 <code>PermitRootLogin yes</code></li>\n</ol>\n<h3 id=\"题-3：写一份-Linux-加固清单（10-条以上）\"><a href=\"#题-3：写一份-Linux-加固清单（10-条以上）\" class=\"headerlink\" title=\"题 3：写一份 Linux 加固清单（10 条以上）\"></a>题 3：写一份 Linux 加固清单（10 条以上）</h3><p>从以下角度写：账号管理、权限控制、服务管理、网络安全、日志审计。</p>\n<h3 id=\"题-4（进阶）：设计一个-sudo-权限方案\"><a href=\"#题-4（进阶）：设计一个-sudo-权限方案\" class=\"headerlink\" title=\"题 4（进阶）：设计一个 sudo 权限方案\"></a>题 4（进阶）：设计一个 sudo 权限方案</h3><p>场景：你的团队有 3 类人员：</p>\n<ul>\n<li><strong>开发人员</strong>（developers）：需要重启 Web 服务（nginx&#x2F;apache2）</li>\n<li><strong>DBA</strong>（dba）：需要重启数据库服务（mysql&#x2F;postgresql）</li>\n<li><strong>运维人员</strong>（ops）：需要所有权限</li>\n</ul>\n<p>写出 sudoers 配置。</p>\n<h2 id=\"评估标准（达成判定）\"><a href=\"#评估标准（达成判定）\" class=\"headerlink\" title=\"评估标准（达成判定）\"></a>评估标准（达成判定）</h2><table>\n<thead>\n<tr>\n<th>评估项</th>\n<th>达成标准</th>\n<th>检查方法</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>权限理解</strong></td>\n<td>能正确转换 rwx ↔ 数字（至少 3 个例子）</td>\n<td>检查题 1 答案</td>\n</tr>\n<tr>\n<td><strong>用户管理</strong></td>\n<td>成功创建用户并配置 sudo</td>\n<td>检查任务 2 截图</td>\n</tr>\n<tr>\n<td><strong>攻击面盘点</strong></td>\n<td>输出监听端口清单并评估风险</td>\n<td>检查任务 3 分析表</td>\n</tr>\n<tr>\n<td><strong>日志审计</strong></td>\n<td>能找到 SSH 登录&#x2F;sudo 使用记录</td>\n<td>检查任务 4 提取信息</td>\n</tr>\n<tr>\n<td><strong>加固意识</strong></td>\n<td>输出 10+ 条加固清单</td>\n<td>检查题 3 清单</td>\n</tr>\n</tbody></table>\n<p><strong>达成判定</strong>：</p>\n<ul>\n<li>✅ <strong>优秀</strong>（5&#x2F;5）：完成所有任务 + 题 1-4 全部完成 + 清单 15+ 条</li>\n<li>✅ <strong>良好</strong>（4&#x2F;5）：完成 4 个必做任务 + 题 1-3 完成 + 清单 10+ 条</li>\n<li>✅ <strong>合格</strong>（3&#x2F;5）：完成 3 个必做任务 + 题 1-2 完成 + 清单 5+ 条</li>\n</ul>\n<h2 id=\"学习成果达成情况（由学习者填写）\"><a href=\"#学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"学习成果达成情况（由学习者填写）\"></a>学习成果达成情况（由学习者填写）</h2><h3 id=\"截图与证据\"><a href=\"#截图与证据\" class=\"headerlink\" title=\"截图与证据\"></a>截图与证据</h3><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 任务 1：<code>ls -l /etc/shadow</code> 权限截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 任务 2：<code>id alice</code> 输出截图（含 sudo 组）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 任务 2：<code>sudo whoami</code> 输出截图（显示 root）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 任务 3：<code>ss -lntup</code> 监听端口截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 任务 4：<code>journalctl -u ssh | grep Accepted</code> 截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 任务 5（可选）：<code>ufw status</code> 截图</li>\n</ul>\n<h3 id=\"关键命令与输出\"><a href=\"#关键命令与输出\" class=\"headerlink\" title=\"关键命令与输出\"></a>关键命令与输出</h3><p><strong>权限查看</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">/etc/passwd: -rw-r--r-- (644)</span><br><span class=\"line\">/etc/shadow: -rw-r----- (640)</span><br><span class=\"line\">~/.ssh/id_rsa: -rw------- (600)</span><br></pre></td></tr></table></figure>\n\n<p><strong>监听端口</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">端口 22: sshd (0.0.0.0) - 需要对外</span><br><span class=\"line\">端口 80: nginx (0.0.0.0) - 需要对外</span><br><span class=\"line\">端口 3306: mysqld (127.0.0.1) - 只监听本地 ✅</span><br></pre></td></tr></table></figure>\n\n<p><strong>日志摘要</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">最近登录：alice from 192.168.1.100 (publickey)</span><br><span class=\"line\">最近 sudo：alice executed /usr/bin/apt update</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"权限转换练习（题-1-答案）\"><a href=\"#权限转换练习（题-1-答案）\" class=\"headerlink\" title=\"权限转换练习（题 1 答案）\"></a>权限转换练习（题 1 答案）</h3><table>\n<thead>\n<tr>\n<th>符号表示</th>\n<th>数字表示</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>-rwxr-xr-x</code></td>\n<td><strong>755</strong></td>\n</tr>\n<tr>\n<td><code>-rw-r-----</code></td>\n<td><strong>640</strong></td>\n</tr>\n<tr>\n<td><code>drwx------</code></td>\n<td><strong>700</strong></td>\n</tr>\n<tr>\n<td><code>-rw-r--r--</code></td>\n<td><strong>644</strong></td>\n</tr>\n<tr>\n<td><code>-rwxr-x---</code></td>\n<td><strong>750</strong></td>\n</tr>\n<tr>\n<td><code>-rw-------</code></td>\n<td><strong>600</strong></td>\n</tr>\n</tbody></table>\n<h3 id=\"安全场景判断（题-2-答案）\"><a href=\"#安全场景判断（题-2-答案）\" class=\"headerlink\" title=\"安全场景判断（题 2 答案）\"></a>安全场景判断（题 2 答案）</h3><ol>\n<li><p>❌ <strong>不安全</strong>：<code>/etc/shadow</code> 权限 644</p>\n<ul>\n<li>✅ <strong>正确</strong>：应该是 640（<code>-rw-r-----</code>），只有 root 和 shadow 组可读</li>\n<li><strong>原因</strong>：密码哈希敏感，所有用户可读会泄露</li>\n</ul>\n</li>\n<li><p>❌ <strong>不安全</strong>：SSH 私钥权限 644</p>\n<ul>\n<li>✅ <strong>正确</strong>：应该是 600（<code>-rw-------</code>），只有 owner 可读写</li>\n<li><strong>原因</strong>：SSH 会拒绝使用权限过宽的私钥</li>\n</ul>\n</li>\n<li><p>❌ <strong>不安全</strong>：MySQL 监听 0.0.0.0:3306</p>\n<ul>\n<li>✅ <strong>正确</strong>：应该监听 127.0.0.1:3306（只本地访问）</li>\n<li><strong>修复</strong>：编辑 <code>/etc/mysql/mysql.conf.d/mysqld.cnf</code>，设置 <code>bind-address = 127.0.0.1</code></li>\n</ul>\n</li>\n<li><p>❌ <strong>不安全</strong>：所有用户 <code>NOPASSWD: ALL</code></p>\n<ul>\n<li>✅ <strong>正确</strong>：最小权限原则，只给需要的命令权限</li>\n<li><strong>示例</strong>：<code>alice ALL=(ALL) /usr/bin/systemctl restart nginx</code></li>\n</ul>\n</li>\n<li><p>❌ <strong>不安全</strong>：SSH 配置 <code>PermitRootLogin yes</code></p>\n<ul>\n<li>✅ <strong>正确</strong>：应该设置为 <code>PermitRootLogin no</code></li>\n<li><strong>修复</strong>：编辑 <code>/etc/ssh/sshd_config</code>，重启 sshd</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"Linux-加固清单（题-3-答案）\"><a href=\"#Linux-加固清单（题-3-答案）\" class=\"headerlink\" title=\"Linux 加固清单（题 3 答案）\"></a>Linux 加固清单（题 3 答案）</h3><h4 id=\"账号管理（5-条）\"><a href=\"#账号管理（5-条）\" class=\"headerlink\" title=\"账号管理（5 条）\"></a>账号管理（5 条）</h4><ol>\n<li>✅ <strong>禁止 root 远程登录</strong>：<code>PermitRootLogin no</code> in <code>/etc/ssh/sshd_config</code></li>\n<li>✅ <strong>使用密钥认证</strong>：禁用密码登录（<code>PasswordAuthentication no</code>）</li>\n<li>✅ <strong>定期审计用户</strong>：删除不再需要的账号（<code>userdel -r &lt;user&gt;</code>）</li>\n<li>✅ <strong>强制密码策略</strong>：安装 <code>libpam-pwquality</code>，配置最小长度&#x2F;复杂度</li>\n<li>✅ <strong>锁定长期未登录账号</strong>：<code>usermod -L &lt;user&gt;</code>（锁定）或删除</li>\n</ol>\n<h4 id=\"权限控制（3-条）\"><a href=\"#权限控制（3-条）\" class=\"headerlink\" title=\"权限控制（3 条）\"></a>权限控制（3 条）</h4><ol start=\"6\">\n<li>✅ <strong>敏感文件权限</strong>：<ul>\n<li><code>/etc/shadow</code>: 640</li>\n<li><code>~/.ssh/id_*</code>: 600</li>\n<li><code>/etc/sudoers</code>: 440</li>\n</ul>\n</li>\n<li>✅ <strong>定期检查 SUID 文件</strong>：<code>find / -perm -4000 -type f 2&gt;/dev/null</code></li>\n<li>✅ <strong>sudo 最小权限</strong>：不要用 <code>NOPASSWD: ALL</code>，精确到具体命令</li>\n</ol>\n<h4 id=\"服务管理（3-条）\"><a href=\"#服务管理（3-条）\" class=\"headerlink\" title=\"服务管理（3 条）\"></a>服务管理（3 条）</h4><ol start=\"9\">\n<li>✅ <strong>关闭不需要的服务</strong>：<code>systemctl disable &lt;service&gt;</code></li>\n<li>✅ <strong>最小暴露原则</strong>：数据库只监听 127.0.0.1</li>\n<li>✅ <strong>及时更新补丁</strong>：<code>apt update &amp;&amp; apt upgrade</code>（或 <code>yum update</code>）</li>\n</ol>\n<h4 id=\"网络安全（4-条）\"><a href=\"#网络安全（4-条）\" class=\"headerlink\" title=\"网络安全（4 条）\"></a>网络安全（4 条）</h4><ol start=\"12\">\n<li>✅ <strong>配置防火墙</strong>：ufw&#x2F;firewalld，默认拒绝入站</li>\n<li>✅ <strong>修改 SSH 默认端口</strong>：改为非 22 端口（如 2222）</li>\n<li>✅ <strong>SSH 限制来源 IP</strong>：<code>AllowUsers alice@192.168.1.0/24</code></li>\n<li>✅ <strong>安装 fail2ban</strong>：自动封禁暴力破解 IP</li>\n</ol>\n<h4 id=\"日志审计（3-条）\"><a href=\"#日志审计（3-条）\" class=\"headerlink\" title=\"日志审计（3 条）\"></a>日志审计（3 条）</h4><ol start=\"16\">\n<li>✅ <strong>集中日志管理</strong>：配置 rsyslog 发送到日志服务器</li>\n<li>✅ <strong>定期检查日志</strong>：每天查看 <code>/var/log/auth.log</code> 是否有异常</li>\n<li>✅ <strong>启用审计系统</strong>：安装 <code>auditd</code>，记录文件访问&#x2F;命令执行</li>\n</ol>\n<h3 id=\"sudo-权限方案（题-4-答案）\"><a href=\"#sudo-权限方案（题-4-答案）\" class=\"headerlink\" title=\"sudo 权限方案（题 4 答案）\"></a>sudo 权限方案（题 4 答案）</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 编辑 sudoers</span></span><br><span class=\"line\">sudo visudo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 1. 开发人员组（只能重启 Web 服务）</span></span><br><span class=\"line\">%developers ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart nginx, \\</span><br><span class=\"line\">                                  /usr/bin/systemctl reload nginx, \\</span><br><span class=\"line\">                                  /usr/bin/systemctl restart apache2, \\</span><br><span class=\"line\">                                  /usr/bin/systemctl reload apache2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. DBA 组（只能管理数据库服务）</span></span><br><span class=\"line\">%dba ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart mysql, \\</span><br><span class=\"line\">                          /usr/bin/systemctl restart postgresql, \\</span><br><span class=\"line\">                          /usr/bin/systemctl status mysql, \\</span><br><span class=\"line\">                          /usr/bin/systemctl status postgresql</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. 运维人员组（所有权限，但需要密码）</span></span><br><span class=\"line\">%ops ALL=(ALL) ALL</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4. 审计（可选）：记录所有 sudo 命令到单独日志</span></span><br><span class=\"line\">Defaults logfile=<span class=\"string\">&quot;/var/log/sudo.log&quot;</span></span><br><span class=\"line\">Defaults log_input, log_output</span><br></pre></td></tr></table></figure>\n\n<p><strong>安全要点</strong>：</p>\n<ul>\n<li>开发&#x2F;DBA 用 <code>NOPASSWD</code>（频繁操作，但范围受限）</li>\n<li>运维需要密码（权限大，增加一层验证）</li>\n<li>所有 sudo 操作都会记录到日志</li>\n</ul>\n<h3 id=\"结论与反思\"><a href=\"#结论与反思\" class=\"headerlink\" title=\"结论与反思\"></a>结论与反思</h3><p><strong>我今天搞清楚了</strong>：</p>\n<ul>\n<li>Linux 权限模型：3 类人（owner&#x2F;group&#x2F;others）× 3 种权限（rwx）&#x3D; 9 位权限位</li>\n<li>权限数字表示：r&#x3D;4, w&#x3D;2, x&#x3D;1，快速计算（如 644 &#x3D; rw-r–r–）</li>\n<li>特殊权限：SUID&#x2F;SGID&#x2F;Sticky Bit 的作用与风险</li>\n<li>sudo 配置：最小权限原则，不要滥用 <code>NOPASSWD: ALL</code></li>\n<li>攻击面盘点：用 <code>ss -lntup</code> 查看监听端口，数据库不要监听 0.0.0.0</li>\n<li>日志审计：journalctl 查看 SSH 登录&#x2F;sudo 使用记录</li>\n</ul>\n<p><strong>我差点搞混的是</strong>：</p>\n<ul>\n<li>以为 <code>/etc/shadow</code> 权限 644 没问题（其实应该是 640）</li>\n<li>以为 SSH 私钥权限 644 可以用（SSH 会拒绝权限过宽的私钥）</li>\n<li>以为 MySQL 监听 0.0.0.0 没关系（其实应该只监听 127.0.0.1）</li>\n</ul>\n<p><strong>明天我要继续补的是</strong>：</p>\n<ul>\n<li>Windows 安全基础（UAC、事件日志、防火墙）</li>\n<li>PowerShell 脚本自动化（日志分析、CSV 导出）</li>\n<li>实际搭建一个 fail2ban 防暴力破解</li>\n</ul>\n<p><strong>本次学习耗时</strong>：约 ___ 小时</p>\n<p><strong>掌握程度自评</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 😕 只看懂了概念，没动手</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🙂 完成了部分任务（WSL 环境搭建成功）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 😃 完成了所有必做任务并理解原理</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🤩 额外研究了 SELinux&#x2F;AppArmor&#x2F;auditd</li>\n</ul>\n<h2 id=\"集中参考答案（含思路）\"><a href=\"#集中参考答案（含思路）\" class=\"headerlink\" title=\"集中参考答案（含思路）\"></a>集中参考答案（含思路）</h2><h3 id=\"题-1-参考答案（权限转换）\"><a href=\"#题-1-参考答案（权限转换）\" class=\"headerlink\" title=\"题 1 参考答案（权限转换）\"></a>题 1 参考答案（权限转换）</h3><p><strong>方法</strong>：每 3 位权限为一组，rwx 对应 421：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">-rwxr-xr-x</span><br><span class=\"line\"> └┬┘└┬┘└┬┘</span><br><span class=\"line\">  7  5  5  = 755</span><br><span class=\"line\"></span><br><span class=\"line\">-rw-r-----</span><br><span class=\"line\"> └┬┘└┬┘└┬┘</span><br><span class=\"line\">  6  4  0  = 640</span><br><span class=\"line\"></span><br><span class=\"line\">drwx------</span><br><span class=\"line\"> └┬┘└┬┘└┬┘</span><br><span class=\"line\">  7  0  0  = 700（d 表示目录）</span><br><span class=\"line\"></span><br><span class=\"line\">644 → rw-r--r-- (6=rw, 4=r, 4=r)</span><br><span class=\"line\">750 → rwxr-x--- (7=rwx, 5=rx, 0=无)</span><br><span class=\"line\">600 → rw------- (6=rw, 0=无, 0=无)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"题-2-参考答案（详见上方”安全场景判断”）\"><a href=\"#题-2-参考答案（详见上方”安全场景判断”）\" class=\"headerlink\" title=\"题 2 参考答案（详见上方”安全场景判断”）\"></a>题 2 参考答案（详见上方”安全场景判断”）</h3><h3 id=\"题-3-参考答案（详见上方”Linux-加固清单”，共-18-条）\"><a href=\"#题-3-参考答案（详见上方”Linux-加固清单”，共-18-条）\" class=\"headerlink\" title=\"题 3 参考答案（详见上方”Linux 加固清单”，共 18 条）\"></a>题 3 参考答案（详见上方”Linux 加固清单”，共 18 条）</h3><h3 id=\"题-4-参考答案（详见上方”sudo-权限方案”）\"><a href=\"#题-4-参考答案（详见上方”sudo-权限方案”）\" class=\"headerlink\" title=\"题 4 参考答案（详见上方”sudo 权限方案”）\"></a>题 4 参考答案（详见上方”sudo 权限方案”）</h3><h2 id=\"学习成果示例填写（可照抄）\"><a href=\"#学习成果示例填写（可照抄）\" class=\"headerlink\" title=\"学习成果示例填写（可照抄）\"></a>学习成果示例填写（可照抄）</h2><h3 id=\"截图与证据（示例）\"><a href=\"#截图与证据（示例）\" class=\"headerlink\" title=\"截图与证据（示例）\"></a>截图与证据（示例）</h3><ul>\n<li><code>images/day015_shadow_perm.png</code>：<code>/etc/shadow</code> 权限 <code>-rw-r-----</code> (640)</li>\n<li><code>images/day015_user_sudo.png</code>：<code>id alice</code> 输出包含 <code>sudo</code> 组</li>\n<li><code>images/day015_ports.png</code>：<code>ss -lntup</code> 显示端口 22&#x2F;80，MySQL 只监听 127.0.0.1</li>\n<li><code>images/day015_ssh_log.png</code>：<code>journalctl -u ssh | grep Accepted</code> 显示登录记录</li>\n</ul>\n<h3 id=\"关键命令与输出（示例）\"><a href=\"#关键命令与输出（示例）\" class=\"headerlink\" title=\"关键命令与输出（示例）\"></a>关键命令与输出（示例）</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 权限查看</span></span><br><span class=\"line\">-rw-r--r-- 1 root root 2847 /etc/passwd  (644)</span><br><span class=\"line\">-rw-r----- 1 root shadow 1234 /etc/shadow  (640)</span><br><span class=\"line\">-rw------- 1 alice alice 1679 /home/alice/.ssh/id_rsa  (600)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 监听端口</span></span><br><span class=\"line\">tcp LISTEN 0.0.0.0:22 sshd</span><br><span class=\"line\">tcp LISTEN 0.0.0.0:80 nginx</span><br><span class=\"line\">tcp LISTEN 127.0.0.1:3306 mysqld  ✅ 只监听本地</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 日志摘要</span></span><br><span class=\"line\">Accepted publickey <span class=\"keyword\">for</span> alice from 192.168.1.100 port 54321</span><br><span class=\"line\">sudo: alice : COMMAND=/usr/bin/apt update</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"反思（示例）\"><a href=\"#反思（示例）\" class=\"headerlink\" title=\"反思（示例）\"></a>反思（示例）</h3><ul>\n<li>我以前装完 Linux 就不管了，现在知道要盘点监听端口、检查权限、看日志。</li>\n<li>下次我会先建普通用户 + sudo，再考虑禁止 root 登录，避免把自己锁死。</li>\n<li>最大收获：<strong>攻击面最小化</strong> &#x3D; 关闭不需要的服务 + 数据库只监听本地 + 防火墙默认拒绝。</li>\n</ul>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day012：安全协议与加密 - 加密基础：哈希/对称/非对称","url":"/post/47beb889.html","content":"<h1 id=\"Day012：安全协议与加密-加密基础：哈希-x2F-对称-x2F-非对称\"><a href=\"#Day012：安全协议与加密-加密基础：哈希-x2F-对称-x2F-非对称\" class=\"headerlink\" title=\"Day012：安全协议与加密 - 加密基础：哈希&#x2F;对称&#x2F;非对称\"></a>Day012：安全协议与加密 - 加密基础：哈希&#x2F;对称&#x2F;非对称</h1><ul>\n<li>日期：2026-01-05</li>\n<li>周次：第 2### 3️⃣ HMAC：最常见的”接口签名”模型</li>\n</ul>\n<p>HMAC &#x3D; “带密钥的哈希”，非常常见。</p>\n<ul>\n<li>你和服务器共享一个 secret</li>\n<li>你把请求参数按规则拼成字符串</li>\n<li>用 HMAC 算出一个签名</li>\n<li>服务器用同样方法再算一遍，对比</li>\n</ul>\n<p>它的价值：### 任务 3（可选）：生成 RSA 密钥对 + 签名&#x2F;验签（本地演示）</p>\n<p>Python 标准库没有直接的 RSA 签名 API，这里提供<strong>纯 Python 标准库</strong>的简化演示版本（仅用于理解流程，## 巩固练习（题与复盘）</p>\n<h3 id=\"题-1：哈希与加密的区别是什么？\"><a href=\"#题-1：哈希与加密的区别是什么？\" class=\"headerlink\" title=\"题 1：哈希与加密的区别是什么？\"></a>题 1：哈希与加密的区别是什么？</h3><p><strong>思路</strong>：抓住 3 个点：</p>\n<ul>\n<li>能不能解回去（可逆 vs 不可逆）</li>\n<li><h2 id=\"集中参考答案（含思路）\"><a href=\"#集中参考答案（含思路）\" class=\"headerlink\" title=\"集中参考答案（含思路）\"></a>集中参考答案（含思路）</h2></li>\n</ul>\n<h3 id=\"题-1-参考答案\"><a href=\"#题-1-参考答案\" class=\"headerlink\" title=\"题 1 参考答案\"></a>题 1 参考答案</h3><ul>\n<li><p><strong>哈希</strong>：不可逆，输出固定长度指纹，用于完整性校验&#x2F;密码存储等。</p>\n</li>\n<li><p><strong>加密</strong>：可逆，目的是保密，必须有### 截图与证据（示例）</p>\n</li>\n<li><p>任务 1：<code>images/day012_sha256.png</code>（PowerShell 输出 sha256）</p>\n</li>\n<li><p>任务 2：<code>images/day012_hmac_before.png</code>、<code>images/day012_hmac_after.png</code>（改参数后签名变化）</p>\n</li>\n<li><p>任务 3：<code>images/day012_rsa_sign.png</code>（RSA 签名&#x2F;验签成功）</p>\n</li>\n</ul>\n<h3 id=\"关键命令与输出（示例）\"><a href=\"#关键命令与输出（示例）\" class=\"headerlink\" title=\"关键命令与输出（示例）\"></a>关键命令与输出（示例）</h3><p><strong>SHA-256 实验</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">输入: b&#x27;hello day012&#x27;</span><br><span class=\"line\">sha256: 8e35c2cd3bf6641bdb0e2050b76932cbb2e6034a0ddacc1d9bea82a171f51199</span><br><span class=\"line\"></span><br><span class=\"line\">修改为 b&#x27;hello day013&#x27; 后:</span><br><span class=\"line\">sha256: f7a8d5c3e9b12f4a6c8d9e7f3a5b2c8d1e4f7a9b2c5d8e1f4a7b9c2d5e8f1a4b</span><br></pre></td></tr></table></figure>\n\n<p><strong>HMAC 实验</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">msg: b&#x27;user=alice&amp;amount=100&#x27;</span><br><span class=\"line\">hmac_sha256: c5a0f8e7d4b3c2a1f9e8d7c6b5a4f3e2d1c0b9a8f7e6d5c4b3a2f1e0d9c8b7a6</span><br><span class=\"line\"></span><br><span class=\"line\">修改为 amount=1000 后:</span><br><span class=\"line\">hmac_sha256: a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2</span><br></pre></td></tr></table></figure>\n\n<p><strong>RSA 签名&#x2F;验签（示例）</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">消息: b&#x27;This is a test message for Day012&#x27;</span><br><span class=\"line\">签名长度: 256 bytes (2048-bit RSA)</span><br><span class=\"line\">验签结果: ✅ 验签成功：消息未被篡改且来自持有私钥的人</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"结论与反思（示例）\"><a href=\"#结论与反思（示例）\" class=\"headerlink\" title=\"结论与反思（示例）\"></a>结论与反思（示例）</h3><p><strong>我今天搞清楚了</strong>：</p>\n<ul>\n<li>哈希用于”指纹&#x2F;完整性”，不是加密；加密用于”保密”</li>\n<li>HMAC 像”接口签名”：只要参数或 secret 变，签名就变</li>\n<li>签名流程：私钥签名、公钥验签，签的是哈希不是原文</li>\n<li>HTTPS 用非对称解决”密钥分发”，用对称保证”传输速度”</li>\n</ul>\n<p><strong>我差点搞混的是</strong>：</p>\n<ul>\n<li>以前把”签名&#x3D;加密”混在一起了；现在知道签名的重点是”证明真伪+防篡改”，不是为了保密</li>\n<li>IV 可以公开，但不能重复使用（之前以为 IV 也要保密）</li>\n</ul>\n<p><strong>明天我要继续补的是</strong>：</p>\n<ul>\n<li>密码存储的”哈希+盐+迭代”具体实现（bcrypt&#x2F;argon2）</li>\n<li>证书链验证流程（如何从根 CA 到网站证书一层层验证）</li>\n<li>实际抓包看 TLS 握手过程</li>\n</ul>\n<p><strong>本次学习耗时</strong>：约 2.5 小时</p>\n<p><strong>掌握程度自评</strong>：</p>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> 🤩 完成了所有任务并理解原理一把密钥加&#x2F;解密，快，用于大量数据。</li>\n<li><strong>非对称加密</strong>：公私钥配对，用于密钥交换、身份认证、签名。</li>\n</ul>\n<h3 id=\"题-2-参考答案\"><a href=\"#题-2-参考答案\" class=\"headerlink\" title=\"题 2 参考答案\"></a>题 2 参考答案</h3><ol>\n<li>发送方对消息 $M$ 计算哈希 $H&#x3D;hash(M)$。</li>\n<li>发送方用私钥对 $H$ 进行签名得到签名 $S$。</li>\n<li>发送方发送 $M$ 和 $S$。</li>\n<li>接收方对收到的 $M$ 再算哈希 $H’&#x3D;hash(M)$。</li>\n<li>接收方用发送方的公钥验证 $S$ 是否对应 $H’$。</li>\n<li>验证通过：消息未被篡改且来自持有私钥的人。</li>\n</ol>\n<h3 id=\"题-3-参考答案\"><a href=\"#题-3-参考答案\" class=\"headerlink\" title=\"题 3 参考答案\"></a>题 3 参考答案</h3><p><strong>为什么 HTTPS 不全程用非对称加密？</strong></p>\n<ul>\n<li><strong>性能原因</strong>：非对称加密（如 RSA）的运算速度比对称加密（如 AES）慢约 100-1000 倍</li>\n<li><strong>实际做法</strong>：<ul>\n<li>握手阶段：用非对称加密协商”会话密钥”（解决密钥分发问题）</li>\n<li>数据传输阶段：用对称加密保护实际流量（保证速度）</li>\n</ul>\n</li>\n<li><strong>类比</strong>：非对称像”用快递配送保险箱”，对称像”用保险箱里的钥匙开门”</li>\n</ul>\n<h3 id=\"题-4-参考答案\"><a href=\"#题-4-参考答案\" class=\"headerlink\" title=\"题 4 参考答案\"></a>题 4 参考答案</h3><p><strong>什么情况下应该用 HMAC 而不是纯哈希？</strong></p>\n<ul>\n<li><strong>纯哈希</strong>：任何人都能计算，无法证明”是谁算的”</li>\n<li><strong>HMAC</strong>：需要共享密钥，能证明”只有持有密钥的人才能生成有效签名”</li>\n<li><strong>典型场景</strong>：<ul>\n<li>API 请求签名（防止请求被篡改&#x2F;伪造）</li>\n<li>JWT 令牌（HS256 算法）</li>\n<li>Webhook 验证（如 GitHub Webhook Secret）</li>\n<li>Cookie 完整性保护</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"题-5-参考答案\"><a href=\"#题-5-参考答案\" class=\"headerlink\" title=\"题 5 参考答案\"></a>题 5 参考答案</h3><p><strong>对称加密中，IV（初始化向量）可以公开吗？</strong></p>\n<ul>\n<li><strong>可以公开</strong>：IV 不是密钥，其作用是”让相同明文产生不同密文”，防止模式泄露</li>\n<li><strong>但必须满足</strong>：<ul>\n<li>每次加密使用不同的随机 IV</li>\n<li>不能重复使用（否则会暴露”两次加密了相同内容”）</li>\n</ul>\n</li>\n<li><strong>类比</strong>：IV 像”每封信的信封编号”，可以公开印在信封上，但不能两封信用同一个编号</li>\n<li><strong>存储方式</strong>：通常将 IV 附加在密文前面一起传输（如 <code>IV + Ciphertext</code>））</li>\n<li>有没有密钥（哈希一般无；加密一定有密钥）</li>\n</ul>\n<h3 id=\"题-2：简述一次签名流程（不要写错钥匙）\"><a href=\"#题-2：简述一次签名流程（不要写错钥匙）\" class=\"headerlink\" title=\"题 2：简述一次签名流程（不要写错钥匙）\"></a>题 2：简述一次签名流程（不要写错钥匙）</h3><p><strong>思路</strong>：写清”私钥签名、公钥验签”，以及”签的是哈希”。</p>\n<h3 id=\"题-3（新增）：为什么-HTTPS-不全程用非对称加密？\"><a href=\"#题-3（新增）：为什么-HTTPS-不全程用非对称加密？\" class=\"headerlink\" title=\"题 3（新增）：为什么 HTTPS 不全程用非对称加密？\"></a>题 3（新增）：为什么 HTTPS 不全程用非对称加密？</h3><p><strong>思路提示</strong>：</p>\n<ul>\n<li>性能：非对称加密速度远慢于对称加密（数量级差异）</li>\n<li>实用性：TLS 握手用非对称解决”密钥分发”，后续数据传输用对称加密保证速度</li>\n<li>类比：非对称像”快递配送密码箱”，对称像”用密码箱里的钥匙开门”</li>\n</ul>\n<h3 id=\"题-4（新增）：什么情况下应该用-HMAC-而不是纯哈希？\"><a href=\"#题-4（新增）：什么情况下应该用-HMAC-而不是纯哈希？\" class=\"headerlink\" title=\"题 4（新增）：什么情况下应该用 HMAC 而不是纯哈希？\"></a>题 4（新增）：什么情况下应该用 HMAC 而不是纯哈希？</h3><p><strong>思路提示</strong>：</p>\n<ul>\n<li>纯哈希（如 SHA-256）：任何人都能算，无法证明”谁算的”</li>\n<li>HMAC：需要共享密钥，能证明”只有持有密钥的人才能生成有效签名”</li>\n<li>典型场景：API 请求签名、JWT 令牌、Webhook 验证</li>\n</ul>\n<h3 id=\"题-5（新增）：对称加密中，IV（初始化向量）可以公开吗？\"><a href=\"#题-5（新增）：对称加密中，IV（初始化向量）可以公开吗？\" class=\"headerlink\" title=\"题 5（新增）：对称加密中，IV（初始化向量）可以公开吗？\"></a>题 5（新增）：对称加密中，IV（初始化向量）可以公开吗？</h3><p><strong>思路提示</strong>：</p>\n<ul>\n<li>可以公开：IV 的作用是”让相同明文产生不同密文”，不是保密信息</li>\n<li>但必须随机且不重复：否则会泄露模式（如 ECB 模式的弱点）</li>\n<li>类比：IV 像”每封信的信封编号”，可以公开，但不能重复使用 tography&#96; 库）。</li>\n</ul>\n<h4 id=\"方案-A：使用-cryptography-库（推荐，需额外安装）\"><a href=\"#方案-A：使用-cryptography-库（推荐，需额外安装）\" class=\"headerlink\" title=\"方案 A：使用 cryptography 库（推荐，需额外安装）\"></a>方案 A：使用 <code>cryptography</code> 库（推荐，需额外安装）</h4><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装依赖</span></span><br><span class=\"line\">pip install cryptography</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 运行演示</span></span><br><span class=\"line\">python - &lt;&lt; <span class=\"string\">&#x27;PY&#x27;</span></span><br><span class=\"line\">from cryptography.hazmat.primitives.asymmetric import rsa, padding</span><br><span class=\"line\">from cryptography.hazmat.primitives import hashes, serialization</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 1. 生成 RSA 密钥对</span></span><br><span class=\"line\">private_key = rsa.generate_private_key(public_exponent=<span class=\"number\">65537</span>, key_size=<span class=\"number\">2048</span>)</span><br><span class=\"line\">public_key = private_key.public_key()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. 准备消息</span></span><br><span class=\"line\">message = b<span class=\"string\">&quot;This is a test message for Day012&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. 签名（用私钥）</span></span><br><span class=\"line\">signature = private_key.sign(</span><br><span class=\"line\">    message,</span><br><span class=\"line\">    padding.PSS(mgf=padding.MGF1(hashes.SHA256()), salt_length=padding.PSS.MAX_LENGTH),</span><br><span class=\"line\">    hashes.SHA256()</span><br><span class=\"line\">)</span><br><span class=\"line\">print(f<span class=\"string\">&quot;消息: &#123;message&#125;&quot;</span>)</span><br><span class=\"line\">print(f<span class=\"string\">&quot;签名: &#123;signature.hex()[:64]&#125;...&quot;</span>)  <span class=\"comment\"># 只显示前 64 字符</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4. 验签（用公钥）</span></span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">    public_key.verify(</span><br><span class=\"line\">        signature,</span><br><span class=\"line\">        message,</span><br><span class=\"line\">        padding.PSS(mgf=padding.MGF1(hashes.SHA256()), salt_length=padding.PSS.MAX_LENGTH),</span><br><span class=\"line\">        hashes.SHA256()</span><br><span class=\"line\">    )</span><br><span class=\"line\">    print(<span class=\"string\">&quot;✅ 验签成功：消息未被篡改且来自持有私钥的人&quot;</span>)</span><br><span class=\"line\">except Exception as e:</span><br><span class=\"line\">    print(f<span class=\"string\">&quot;❌ 验签失败: &#123;e&#125;&quot;</span>)</span><br><span class=\"line\">PY</span><br></pre></td></tr></table></figure>\n\n<p><strong>验证要点</strong>：</p>\n<ul>\n<li>修改 <code>message</code> 后再验签，会失败</li>\n<li>用错误的公钥验签，会失败</li>\n<li>这就是”私钥签名、公钥验签”的闭环</li>\n</ul>\n<h4 id=\"方案-B：使用-Windows-certutil（概念演示）\"><a href=\"#方案-B：使用-Windows-certutil（概念演示）\" class=\"headerlink\" title=\"方案 B：使用 Windows certutil（概念演示）\"></a>方案 B：使用 Windows <code>certutil</code>（概念演示）</h4><p>如不想安装额外库，可以用 Windows 自带工具理解流程：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. 生成测试文件</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;hello day012&quot;</span> &gt; test.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. 计算哈希（模拟签名第一步）</span></span><br><span class=\"line\">certutil <span class=\"literal\">-hashfile</span> test.txt SHA256</span><br></pre></td></tr></table></figure>\n\n<p><strong>说明</strong>：<code>certutil</code> 无法直接做 RSA 签名，但可以演示”哈希计算”这一步。完整签名&#x2F;验签建议使用方案 A 或后续学习 OpenSSL。</p>\n<h3 id=\"任务-4（进阶）：对比实验-对称加密的-IV-重要性\"><a href=\"#任务-4（进阶）：对比实验-对称加密的-IV-重要性\" class=\"headerlink\" title=\"任务 4（进阶）：对比实验 - 对称加密的 IV 重要性\"></a>任务 4（进阶）：对比实验 - 对称加密的 IV 重要性</h3><p>如果你已安装 <code>cryptography</code>，可以做这个”为什么需要 IV”的对比实验：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> cryptography.hazmat.primitives.ciphers <span class=\"keyword\">import</span> Cipher, algorithms, modes</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"></span><br><span class=\"line\">key = os.urandom(<span class=\"number\">32</span>)  <span class=\"comment\"># AES-256 密钥</span></span><br><span class=\"line\">plaintext = <span class=\"string\">b&quot;secret message 123&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 实验 1：不使用 IV（ECB 模式，不推荐）</span></span><br><span class=\"line\">cipher = Cipher(algorithms.AES(key), modes.ECB())</span><br><span class=\"line\">encryptor = cipher.encryptor()</span><br><span class=\"line\"><span class=\"comment\"># 注意：ECB 需要 padding，这里简化演示</span></span><br><span class=\"line\">ciphertext_ecb = encryptor.update(plaintext.ljust(<span class=\"number\">16</span>)) + encryptor.finalize()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 实验 2：使用随机 IV（CBC 模式，推荐）</span></span><br><span class=\"line\">iv = os.urandom(<span class=\"number\">16</span>)</span><br><span class=\"line\">cipher = Cipher(algorithms.AES(key), modes.CBC(iv))</span><br><span class=\"line\">encryptor = cipher.encryptor()</span><br><span class=\"line\">ciphertext_cbc = encryptor.update(plaintext.ljust(<span class=\"number\">16</span>)) + encryptor.finalize()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">f&quot;ECB 密文: <span class=\"subst\">&#123;ciphertext_ecb.<span class=\"built_in\">hex</span>()&#125;</span>&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">f&quot;CBC 密文（IV=<span class=\"subst\">&#123;iv.<span class=\"built_in\">hex</span>()[:<span class=\"number\">16</span>]&#125;</span>...）: <span class=\"subst\">&#123;ciphertext_cbc.<span class=\"built_in\">hex</span>()&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p><strong>观察重点</strong>：</p>\n<ul>\n<li>同样的明文，ECB 模式每次加密结果相同（不安全）</li>\n<li>CBC 模式因为 IV 随机，每次加密结果不同（更安全）求被篡改</li>\n<li>能一定程度防止伪造（前提是 secret 不泄露）</li>\n</ul>\n<h3 id=\"4️⃣-对称加密实例：AES-的基本原理与应用场景\"><a href=\"#4️⃣-对称加密实例：AES-的基本原理与应用场景\" class=\"headerlink\" title=\"4️⃣ 对称加密实例：AES 的基本原理与应用场景\"></a>4️⃣ 对称加密实例：AES 的基本原理与应用场景</h3><p><strong>对称加密代表：AES（Advanced Encryption Standard）</strong></p>\n<ul>\n<li>工作原理：使用<strong>同一密钥</strong>进行加密和解密</li>\n<li>常见模式：<ul>\n<li><strong>ECB（不推荐）</strong>：相同明文块生成相同密文块，存在模式泄露风险</li>\n<li><strong>CBC</strong>：引入初始化向量（IV），每块密文依赖前一块</li>\n<li><strong>GCM（推荐）</strong>：带认证的加密，既保密又防篡改</li>\n</ul>\n</li>\n</ul>\n<p><strong>应用场景</strong>：</p>\n<ul>\n<li>HTTPS&#x2F;TLS 会话密钥加密（握手后的数据传输）</li>\n<li>文件加密（如 BitLocker、VeraCrypt）</li>\n<li>VPN 隧道加密</li>\n<li>数据库字段加密</li>\n</ul>\n<p><strong>关键要点</strong>：</p>\n<ul>\n<li>密钥长度：AES-128&#x2F;192&#x2F;256（数字越大越安全但略慢）</li>\n<li>IV（初始化向量）：每次加密应使用不同的随机 IV，但 IV 无需保密</li>\n<li>密钥管理是最大挑战：如何安全分发、存储、轮换密钥</li>\n</ul>\n<h3 id=\"5️⃣-非对称加密实例：RSA-与-ECDSA-对比\"><a href=\"#5️⃣-非对称加密实例：RSA-与-ECDSA-对比\" class=\"headerlink\" title=\"5️⃣ 非对称加密实例：RSA 与 ECDSA 对比\"></a>5️⃣ 非对称加密实例：RSA 与 ECDSA 对比</h3><p><strong>RSA（Rivest–Shamir–Adleman）</strong>：</p>\n<ul>\n<li>基于”大数分解难题”</li>\n<li>密钥长度：2048&#x2F;4096 位（目前推荐 2048 起步）</li>\n<li>用途：数字签名、密钥交换、证书体系</li>\n<li>优点：成熟稳定，兼容性好</li>\n<li>缺点：相对慢，密钥&#x2F;签名体积大</li>\n</ul>\n<p><strong>ECDSA（Elliptic Curve Digital Signature Algorithm）</strong>：</p>\n<ul>\n<li>基于”椭圆曲线离散对数难题”</li>\n<li>密钥长度：256&#x2F;384 位（等效 RSA 3072&#x2F;7680 位安全性）</li>\n<li>用途：数字签名（比如比特币、JWT）</li>\n<li>优点：更短的密钥实现同等安全性，速度更快</li>\n<li>缺点：实现复杂，部分库有安全隐患历史</li>\n</ul>\n<p><strong>选型建议</strong>：</p>\n<ul>\n<li>传统证书体系&#x2F;通用场景：RSA 2048</li>\n<li>移动端&#x2F;物联网&#x2F;性能敏感：ECDSA P-256</li>\n<li>追求长期安全：考虑后量子密码（如 Kyber、Dilithium）</li>\n</ul>\n<h3 id=\"6️⃣-加密三要素在真实场景中的协作\"><a href=\"#6️⃣-加密三要素在真实场景中的协作\" class=\"headerlink\" title=\"6️⃣ 加密三要素在真实场景中的协作\"></a>6️⃣ 加密三要素在真实场景中的协作</h3><p>以 <strong>HTTPS 握手</strong>为例，看三者如何配合：</p>\n<ol>\n<li><p><strong>非对称加密（RSA&#x2F;ECDHE）</strong>：</p>\n<ul>\n<li>服务器发送证书（含公钥）</li>\n<li>客户端验证证书签名（证书颁发机构的签名）</li>\n<li>双方通过非对称算法协商出”会话密钥”</li>\n</ul>\n</li>\n<li><p><strong>哈希（SHA-256）</strong>：</p>\n<ul>\n<li>证书签名基于内容哈希</li>\n<li>握手过程中验证消息完整性（Finished 消息的哈希）</li>\n</ul>\n</li>\n<li><p><strong>对称加密（AES-GCM）</strong>：</p>\n<ul>\n<li>握手完成后，用协商好的会话密钥进行 AES 加密</li>\n<li>实际 HTTP 流量全程用对称加密（快）</li>\n</ul>\n</li>\n</ol>\n<p><strong>一句话总结</strong>：非对称解决”密钥分发”问题，对称负责”大量数据加密”，哈希保证”完整性”。</p>\n<p>学完今天你应该能做到：</p>\n<ul>\n<li>一句话说清：<strong>哈希</strong>、<strong>对称加密</strong>、<strong>非对称加密</strong>分别解决什么问题</li>\n<li>画出（或者口述）一个最小闭环：<ul>\n<li>“我怎么把消息加密发给你？”</li>\n<li>“我怎么证明这条消息真的是我发的？”（签名&#x2F;验签）</li>\n</ul>\n</li>\n<li>在 Windows 上用 <strong>Python（标准库）</strong> 做到：<ul>\n<li>计算 SHA-256 哈希</li>\n<li>用 HMAC 生成“带密钥的哈希”（模拟 API 签名）</li>\n<li>生成 RSA 密钥对，并对文本做签名与验签</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>本节聚焦“能用、能解释、能避坑”，无需死记算法细节，重在理解与实操。</p>\n</blockquote>\n<span id=\"more\"></span>\n\n<h2 id=\"学习内容\"><a href=\"#学习内容\" class=\"headerlink\" title=\"学习内容\"></a>学习内容</h2><h3 id=\"1️⃣-三兄弟：哈希-x2F-对称-x2F-非对称，到底差在哪\"><a href=\"#1️⃣-三兄弟：哈希-x2F-对称-x2F-非对称，到底差在哪\" class=\"headerlink\" title=\"1️⃣ 三兄弟：哈希&#x2F;对称&#x2F;非对称，到底差在哪\"></a>1️⃣ 三兄弟：哈希&#x2F;对称&#x2F;非对称，到底差在哪</h3><p>你就记 3 句话：</p>\n<ul>\n<li><strong>哈希（Hash）</strong>：<ul>\n<li>输入任意内容，输出固定长度“指纹”。</li>\n<li><strong>不可逆</strong>（不能从指纹还原原文）。</li>\n<li>用来做：完整性校验、密码存储、文件校验。</li>\n</ul>\n</li>\n<li><strong>对称加密（Symmetric）</strong>：<ul>\n<li><strong>同一把密钥</strong>加密&#x2F;解密。</li>\n<li><strong>快</strong>，适合大数据量（比如 TLS 里真正传输数据的阶段）。</li>\n<li>难点：<strong>密钥怎么安全分发</strong>。</li>\n</ul>\n</li>\n<li><strong>非对称加密（Asymmetric）</strong>：<ul>\n<li>一对钥匙：<strong>公钥（public）</strong>+<strong>私钥（private）</strong>。</li>\n<li>用来做：密钥交换、身份认证、签名。</li>\n<li>缺点：相对慢，不适合直接加密大文件。</li>\n</ul>\n</li>\n</ul>\n<p>把它们放到网络安全场景里：</p>\n<ul>\n<li>TLS&#x2F;HTTPS：用非对称“谈判并安全交换对称密钥” → 然后主要靠对称加密传输</li>\n<li>证书体系：用签名证明“这个公钥属于这个域名&#x2F;组织”</li>\n<li>密码存储：不要“加密存密码”，而是“哈希+盐+迭代”（Day013 会继续）</li>\n</ul>\n<h3 id=\"2️⃣-签名与验签：你要会讲的最小流程\"><a href=\"#2️⃣-签名与验签：你要会讲的最小流程\" class=\"headerlink\" title=\"2️⃣ 签名与验签：你要会讲的最小流程\"></a>2️⃣ 签名与验签：你要会讲的最小流程</h3><p><strong>签名（Signature）</strong>的目标不是保密，是“证明真伪 + 防篡改”。</p>\n<p>最小流程（背这个就够）：</p>\n<ol>\n<li>我有一段消息 $M$。</li>\n<li>我先算哈希 $H &#x3D; hash(M)$（因为直接签大文本太慢）。</li>\n<li>我用<strong>私钥</strong>对 $H$ 签名得到 $S$。</li>\n<li>我把 $M + S$ 发给你。</li>\n<li>你收到后：<ul>\n<li>再算一遍 $H’ &#x3D; hash(M)$</li>\n<li>用<strong>我的公钥</strong>验证签名 $S$ 是否能对应 $H’$</li>\n</ul>\n</li>\n<li>能对应：说明消息没被改过，也确实来自拥有私钥的人。</li>\n</ol>\n<blockquote>\n<p>一句话：<strong>私钥签名，公钥验签；签的是“哈希指纹”，不是为了加密正文。</strong></p>\n</blockquote>\n<h3 id=\"3️⃣-HMAC：最常见的“接口签名”模型\"><a href=\"#3️⃣-HMAC：最常见的“接口签名”模型\" class=\"headerlink\" title=\"3️⃣ HMAC：最常见的“接口签名”模型\"></a>3️⃣ HMAC：最常见的“接口签名”模型</h3><p>HMAC &#x3D; “带密钥的哈希”，非常常见。</p>\n<ul>\n<li>你和服务器共享一个 secret</li>\n<li>你把请求参数按规则拼成字符串</li>\n<li>用 HMAC 算出一个签名</li>\n<li>服务器用同样方法再算一遍，对比</li>\n</ul>\n<p>它的价值：</p>\n<ul>\n<li>能防止请求被篡改</li>\n<li>能一定程度防止伪造（前提是 secret 不泄露）</li>\n</ul>\n<h2 id=\"实践任务（合法授权范围内）\"><a href=\"#实践任务（合法授权范围内）\" class=\"headerlink\" title=\"实践任务（合法授权范围内）\"></a>实践任务（合法授权范围内）</h2><blockquote>\n<p>今天全程本地做，不需要攻击任何东西；这些都是基础能力。</p>\n</blockquote>\n<h3 id=\"任务-1（必做）：用-Python-计算-SHA-256-哈希（完整性指纹）\"><a href=\"#任务-1（必做）：用-Python-计算-SHA-256-哈希（完整性指纹）\" class=\"headerlink\" title=\"任务 1（必做）：用 Python 计算 SHA-256 哈希（完整性指纹）\"></a>任务 1（必做）：用 Python 计算 SHA-256 哈希（完整性指纹）</h3><p>在项目根目录新建一个临时文件（例如 <code>hash-demo.txt</code>），内容随便写一句话。</p>\n<p>用 Python 计算 SHA-256：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">python - &lt;&lt; <span class=\"string\">&#x27;PY&#x27;</span></span><br><span class=\"line\">import hashlib</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">data</span> = b<span class=\"string\">&quot;hello day012&quot;</span></span><br><span class=\"line\">print(<span class=\"string\">&quot;data:&quot;</span>, <span class=\"keyword\">data</span>)</span><br><span class=\"line\">print(<span class=\"string\">&quot;sha256:&quot;</span>, hashlib.sha256(<span class=\"keyword\">data</span>).hexdigest())</span><br><span class=\"line\">PY</span><br></pre></td></tr></table></figure>\n\n<p>你要记录 2 个现象：</p>\n<ul>\n<li>内容只改 1 个字母，sha256 会完全变（雪崩效应）</li>\n<li>同样内容算出来永远一样（确定性）</li>\n</ul>\n<h3 id=\"任务-2（必做）：用-HMAC-生成“带密钥的哈希”（模拟-API-签名）\"><a href=\"#任务-2（必做）：用-HMAC-生成“带密钥的哈希”（模拟-API-签名）\" class=\"headerlink\" title=\"任务 2（必做）：用 HMAC 生成“带密钥的哈希”（模拟 API 签名）\"></a>任务 2（必做）：用 HMAC 生成“带密钥的哈希”（模拟 API 签名）</h3><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">python - &lt;&lt; <span class=\"string\">&#x27;PY&#x27;</span></span><br><span class=\"line\">import hmac</span><br><span class=\"line\">import hashlib</span><br><span class=\"line\"></span><br><span class=\"line\">secret = b<span class=\"string\">&quot;my-secret&quot;</span></span><br><span class=\"line\">msg = b<span class=\"string\">&quot;user=alice&amp;amount=100&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">sig = hmac.new(secret, msg, hashlib.sha256).hexdigest()</span><br><span class=\"line\">print(<span class=\"string\">&quot;msg:&quot;</span>, msg)</span><br><span class=\"line\">print(<span class=\"string\">&quot;hmac_sha256:&quot;</span>, sig)</span><br><span class=\"line\">PY</span><br></pre></td></tr></table></figure>\n\n<p>你要做一次对比实验：</p>\n<ul>\n<li>把 <code>amount=100</code> 改成 <code>amount=1000</code>，签名会变</li>\n<li>把 <code>secret</code> 改了，签名也会变</li>\n</ul>\n<h3 id=\"任务-3（必做）：生成-RSA-密钥对-签名-x2F-验签（本地演示）\"><a href=\"#任务-3（必做）：生成-RSA-密钥对-签名-x2F-验签（本地演示）\" class=\"headerlink\" title=\"任务 3（必做）：生成 RSA 密钥对 + 签名&#x2F;验签（本地演示）\"></a>任务 3（必做）：生成 RSA 密钥对 + 签名&#x2F;验签（本地演示）</h3><p>Python 标准库没有直接的 RSA 签名 API，所以这里我们用 Windows 自带的 <code>certutil</code> 做一个“概念演示版”（不追求工程最佳实践，追求你能看到签名&#x2F;验签闭环）。</p>\n<blockquote>\n<p>如果你更想要“纯 Python 可跑”，我可以在后续某天加一段使用 <code>cryptography</code> 库的版本；但那需要额外安装依赖。</p>\n</blockquote>\n<p><strong>建议</strong>：优先完成“哈希&#x2F;HMAC”两个必做任务，RSA 签名&#x2F;验签以理解流程为主。</p>\n<p>（进阶）如需更标准的 RSA&#x2F;ECDSA 签名演示，可后续安装 OpenSSL 或用 WSL 实现。</p>\n<h2 id=\"巩固练习（题与复盘）\"><a href=\"#巩固练习（题与复盘）\" class=\"headerlink\" title=\"巩固练习（题与复盘）\"></a>巩固练习（题与复盘）</h2><h3 id=\"题-1：哈希与加密的区别是什么？-1\"><a href=\"#题-1：哈希与加密的区别是什么？-1\" class=\"headerlink\" title=\"题 1：哈希与加密的区别是什么？\"></a>题 1：哈希与加密的区别是什么？</h3><p><strong>思路</strong>：抓住 3 个点：</p>\n<ul>\n<li>能不能解回去（可逆 vs 不可逆）</li>\n<li>主要目的（保密 vs 指纹&#x2F;完整性）</li>\n<li>有没有密钥（哈希一般无；加密一定有密钥）</li>\n</ul>\n<h3 id=\"题-2：简述一次签名流程（不要写错钥匙）-1\"><a href=\"#题-2：简述一次签名流程（不要写错钥匙）-1\" class=\"headerlink\" title=\"题 2：简述一次签名流程（不要写错钥匙）\"></a>题 2：简述一次签名流程（不要写错钥匙）</h3><p><strong>思路</strong>：写清“私钥签名、公钥验签”，以及“签的是哈希”。</p>\n<h2 id=\"评估标准（达成判定）\"><a href=\"#评估标准（达成判定）\" class=\"headerlink\" title=\"评估标准（达成判定）\"></a>评估标准（达成判定）</h2><ul>\n<li>✅ 你能口述并举例：哈希&#x2F;对称&#x2F;非对称分别用在什么地方</li>\n<li>✅ 你能跑通并截图保存：<ul>\n<li>SHA-256 输出</li>\n<li>HMAC 输出 + 修改参数后签名变化</li>\n<li>（可选）RSA 签名&#x2F;验签成功的终端输出</li>\n</ul>\n</li>\n<li>✅ 你能写出签名&#x2F;验签最小流程（就 6 步那套）</li>\n<li>✅ 你能解释 HTTPS 握手中”非对称+对称”配合的原因</li>\n<li>✅ 你能说出 IV 的作用与是否需要保密</li>\n</ul>\n<h2 id=\"学习成果达成情况（由学习者填写）\"><a href=\"#学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"学习成果达成情况（由学习者填写）\"></a>学习成果达成情况（由学习者填写）</h2><h3 id=\"截图与证据\"><a href=\"#截图与证据\" class=\"headerlink\" title=\"截图与证据\"></a>截图与证据</h3><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 任务 1：sha256 输出截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 任务 2：hmac 输出截图（至少两次：改参数前&#x2F;后）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 任务 3（可选）：RSA 签名&#x2F;验签成功的终端输出</li>\n<li><input disabled=\"\" type=\"checkbox\"> 任务 4（可选）：对称加密 IV 对比实验截图</li>\n</ul>\n<h3 id=\"关键命令与输出（粘贴关键片段）\"><a href=\"#关键命令与输出（粘贴关键片段）\" class=\"headerlink\" title=\"关键命令与输出（粘贴关键片段）\"></a>关键命令与输出（粘贴关键片段）</h3><p><strong>SHA-256 实验</strong>：</p>\n<ul>\n<li>输入：</li>\n<li>输出：</li>\n<li>修改后输出：</li>\n</ul>\n<p><strong>HMAC 实验</strong>：</p>\n<ul>\n<li>msg：</li>\n<li>sig：</li>\n<li>修改参数后 sig：</li>\n</ul>\n<p><strong>RSA 签名&#x2F;验签（可选）</strong>：</p>\n<ul>\n<li>签名长度：</li>\n<li>验签结果：</li>\n</ul>\n<h3 id=\"结论与反思\"><a href=\"#结论与反思\" class=\"headerlink\" title=\"结论与反思\"></a>结论与反思</h3><p><strong>我今天搞清楚了</strong>：</p>\n<ul>\n<li>（例如：哈希不可逆，签名用私钥&#x2F;验签用公钥，HTTPS 用非对称换密钥+对称传数据）</li>\n</ul>\n<p><strong>我差点搞混的是</strong>：</p>\n<ul>\n<li>（例如：签名 ≠ 加密，IV 可以公开但不能重复）</li>\n</ul>\n<p><strong>明天我要继续补的是</strong>：</p>\n<ul>\n<li>（例如：密码存储的哈希+盐+迭代、证书链验证流程）</li>\n</ul>\n<p><strong>本次学习耗时</strong>：约 ___ 小时</p>\n<p><strong>掌握程度自评</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 😕 看懂了但没动手</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🙂 跑通了基础任务</li>\n<li><input disabled=\"\" type=\"checkbox\"> 😃 完成了所有任务并理解原理</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🤩 额外做了扩展实验（如对比 RSA vs ECDSA 性能）</li>\n</ul>\n<h2 id=\"集中参考答案（含思路）-1\"><a href=\"#集中参考答案（含思路）-1\" class=\"headerlink\" title=\"集中参考答案（含思路）\"></a>集中参考答案（含思路）</h2><h3 id=\"题-1-参考答案-1\"><a href=\"#题-1-参考答案-1\" class=\"headerlink\" title=\"题 1 参考答案\"></a>题 1 参考答案</h3><ul>\n<li>哈希：不可逆，输出固定长度指纹，用于完整性校验&#x2F;密码存储等。</li>\n<li>加密：可逆，目的是保密，必须有密钥。</li>\n<li>对称加密：同一把密钥加&#x2F;解密，快，用于大量数据。</li>\n<li>非对称加密：公私钥配对，用于密钥交换、身份认证、签名。</li>\n</ul>\n<h3 id=\"题-2-参考答案-1\"><a href=\"#题-2-参考答案-1\" class=\"headerlink\" title=\"题 2 参考答案\"></a>题 2 参考答案</h3><ol>\n<li>发送方对消息 $M$ 计算哈希 $H&#x3D;hash(M)$。</li>\n<li>发送方用私钥对 $H$ 进行签名得到签名 $S$。</li>\n<li>发送方发送 $M$ 和 $S$。</li>\n<li>接收方对收到的 $M$ 再算哈希 $H’&#x3D;hash(M)$。</li>\n<li>接收方用发送方的公钥验证 $S$ 是否对应 $H’$。</li>\n<li>验证通过：消息未被篡改且来自持有私钥的人。</li>\n</ol>\n<h2 id=\"学习成果示例填写（可照抄）\"><a href=\"#学习成果示例填写（可照抄）\" class=\"headerlink\" title=\"学习成果示例填写（可照抄）\"></a>学习成果示例填写（可照抄）</h2><blockquote>\n<p>可将“示例”内容替换为你自己的时间与截图文件名。</p>\n</blockquote>\n<h3 id=\"截图与证据（示例）\"><a href=\"#截图与证据（示例）\" class=\"headerlink\" title=\"截图与证据（示例）\"></a>截图与证据（示例）</h3><ul>\n<li>任务 1：<code>images/day012_sha256.png</code>（PowerShell 输出 sha256）</li>\n<li>任务 2：<code>images/day012_hmac_before.png</code>、<code>images/day012_hmac_after.png</code>（改参数后签名变化）</li>\n</ul>\n<h3 id=\"关键命令与输出（示例）-1\"><a href=\"#关键命令与输出（示例）-1\" class=\"headerlink\" title=\"关键命令与输出（示例）\"></a>关键命令与输出（示例）</h3><ul>\n<li>SHA-256：<code>sha256: 0d3c...</code>（略）</li>\n<li>HMAC：<ul>\n<li>msg：<code>user=alice&amp;amount=100</code></li>\n<li>sig：<code>c5a0...</code>（略）</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"结论与反思（示例）-1\"><a href=\"#结论与反思（示例）-1\" class=\"headerlink\" title=\"结论与反思（示例）\"></a>结论与反思（示例）</h3><ul>\n<li>哈希用于“指纹&#x2F;完整性”，不是加密；加密用于“保密”。</li>\n<li>HMAC 很像“接口签名”：只要参数或 secret 变，签名就变。</li>\n<li>我以前把“签名&#x3D;加密”混在一起了；现在知道签名的重点是“证明真伪+防篡改”。</li>\n</ul>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day017：操作系统与脚本 - Shell/PowerShell 脚本入门与批处理","url":"/post/44b1dfb5.html","content":"<h1 id=\"Day017：操作系统与脚本-Shell-x2F-PowerShell-脚本入门与批处理\"><a href=\"#Day017：操作系统与脚本-Shell-x2F-PowerShell-脚本入门与批处理\" class=\"headerlink\" title=\"Day017：操作系统与脚本 - Shell&#x2F;PowerShell 脚本入门与批处理\"></a>Day017：操作系统与脚本 - Shell&#x2F;PowerShell 脚本入门与批处理</h1><ul>\n<li>日期：2026-01-10</li>\n<li>周次：第 3 周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p>学完今天你应该能做到：</p>\n<ul>\n<li>用一句话解释：<strong>管道</strong>、<strong>重定向</strong>、<strong>变量</strong>、<strong>循环</strong>分别是干嘛的</li>\n<li>写一个“能重复跑”的日志整理脚本（PowerShell 版，Windows 直接可用）</li>\n<li>把结果输出成 CSV（后面 Day019&#x2F;Day020 做枚举时直接能复用）</li>\n<li>掌握 PowerShell 的对象管道、条件判断、循环、函数、错误处理</li>\n<li>能独立完成日志批量处理、数据统计、导出等自动化任务</li>\n</ul>\n<hr>\n<span id=\"more\"></span>\n\n<h2 id=\"一、PowerShell-基础语法与对象管道\"><a href=\"#一、PowerShell-基础语法与对象管道\" class=\"headerlink\" title=\"一、PowerShell 基础语法与对象管道\"></a>一、PowerShell 基础语法与对象管道</h2><h3 id=\"1-1-什么是-PowerShell？\"><a href=\"#1-1-什么是-PowerShell？\" class=\"headerlink\" title=\"1.1 什么是 PowerShell？\"></a>1.1 什么是 PowerShell？</h3><ul>\n<li>Windows 自带的命令行自动化工具，支持“对象管道”，比传统 cmd 强大很多</li>\n<li>语法类似 C#&#x2F;Python，支持变量、函数、条件、循环、模块</li>\n<li>适合做批量运维、日志分析、自动化脚本</li>\n</ul>\n<h3 id=\"1-2-管道与重定向的区别\"><a href=\"#1-2-管道与重定向的区别\" class=\"headerlink\" title=\"1.2 管道与重定向的区别\"></a>1.2 管道与重定向的区别</h3><table>\n<thead>\n<tr>\n<th>概念</th>\n<th>作用</th>\n<th>示例</th>\n<th>结果</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>管道 &#96;</td>\n<td>&#96;</td>\n<td>把前一命令的“对象”传给后一命令</td>\n<td>&#96;Get-Process</td>\n</tr>\n<tr>\n<td>重定向 <code>&gt;</code></td>\n<td>把输出写到文件</td>\n<td><code>Get-Process &gt; procs.txt</code></td>\n<td>文件里是纯文本</td>\n</tr>\n<tr>\n<td>追加 <code>&gt;&gt;</code></td>\n<td>追加到文件末尾</td>\n<td><code>echo hello &gt;&gt; log.txt</code></td>\n<td>文件内容不会被覆盖</td>\n</tr>\n</tbody></table>\n<h3 id=\"1-3-PowerShell-与-Bash-最大差异\"><a href=\"#1-3-PowerShell-与-Bash-最大差异\" class=\"headerlink\" title=\"1.3 PowerShell 与 Bash 最大差异\"></a>1.3 PowerShell 与 Bash 最大差异</h3><ul>\n<li>PowerShell 管道传递的是“对象”，不是纯文本</li>\n<li>可以直接用 <code>Select-Object</code>、<code>Where-Object</code>、<code>Group-Object</code> 等命令处理结构化数据</li>\n</ul>\n<h3 id=\"1-4-变量、类型与基本运算\"><a href=\"#1-4-变量、类型与基本运算\" class=\"headerlink\" title=\"1.4 变量、类型与基本运算\"></a>1.4 变量、类型与基本运算</h3><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 变量定义</span></span><br><span class=\"line\"><span class=\"variable\">$name</span> = <span class=\"string\">&quot;Alice&quot;</span></span><br><span class=\"line\"><span class=\"variable\">$age</span> = <span class=\"number\">20</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 字符串拼接</span></span><br><span class=\"line\"><span class=\"built_in\">Write-Output</span> <span class=\"string\">&quot;姓名：<span class=\"variable\">$name</span>，年龄：<span class=\"variable\">$age</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 数组</span></span><br><span class=\"line\"><span class=\"variable\">$nums</span> = <span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 哈希表</span></span><br><span class=\"line\"><span class=\"variable\">$dict</span> = <span class=\"selector-tag\">@</span>&#123;user=<span class=\"string\">&quot;bob&quot;</span>; role=<span class=\"string\">&quot;admin&quot;</span>&#125;</span><br><span class=\"line\"><span class=\"built_in\">Write-Output</span> <span class=\"variable\">$dict</span>[<span class=\"string\">&quot;user&quot;</span>]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-5-条件判断与循环\"><a href=\"#1-5-条件判断与循环\" class=\"headerlink\" title=\"1.5 条件判断与循环\"></a>1.5 条件判断与循环</h3><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># if-else</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"variable\">$age</span> <span class=\"operator\">-ge</span> <span class=\"number\">18</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">Write-Output</span> <span class=\"string\">&quot;成年人&quot;</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">Write-Output</span> <span class=\"string\">&quot;未成年人&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># for 循环</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"variable\">$i</span>=<span class=\"number\">0</span>; <span class=\"variable\">$i</span> <span class=\"operator\">-lt</span> <span class=\"number\">5</span>; <span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">Write-Output</span> <span class=\"variable\">$i</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># foreach</span></span><br><span class=\"line\"><span class=\"keyword\">foreach</span> (<span class=\"variable\">$n</span> <span class=\"keyword\">in</span> <span class=\"variable\">$nums</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">Write-Output</span> <span class=\"variable\">$n</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-6-函数与模块\"><a href=\"#1-6-函数与模块\" class=\"headerlink\" title=\"1.6 函数与模块\"></a>1.6 函数与模块</h3><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Add-Two</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">param</span>(<span class=\"variable\">$a</span>, <span class=\"variable\">$b</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable\">$a</span> + <span class=\"variable\">$b</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$result</span> = <span class=\"built_in\">Add-Two</span> <span class=\"number\">3</span> <span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"built_in\">Write-Output</span> <span class=\"variable\">$result</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"二、日志解析与批量处理实战\"><a href=\"#二、日志解析与批量处理实战\" class=\"headerlink\" title=\"二、日志解析与批量处理实战\"></a>二、日志解析与批量处理实战</h2><h3 id=\"2-1-生成练习日志文件\"><a href=\"#2-1-生成练习日志文件\" class=\"headerlink\" title=\"2.1 生成练习日志文件\"></a>2.1 生成练习日志文件</h3><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 生成 1000 行假日志</span></span><br><span class=\"line\"><span class=\"number\">1</span>..<span class=\"number\">1000</span> | <span class=\"built_in\">ForEach-Object</span> &#123;</span><br><span class=\"line\">    <span class=\"variable\">$user</span> = (<span class=\"string\">&quot;alice&quot;</span>,<span class=\"string\">&quot;bob&quot;</span>,<span class=\"string\">&quot;charlie&quot;</span>,<span class=\"string\">&quot;dave&quot;</span> | <span class=\"built_in\">Get-Random</span>)</span><br><span class=\"line\">    <span class=\"variable\">$action</span> = (<span class=\"string\">&quot;login&quot;</span>,<span class=\"string\">&quot;logout&quot;</span>,<span class=\"string\">&quot;fail&quot;</span>,<span class=\"string\">&quot;download&quot;</span>,<span class=\"string\">&quot;upload&quot;</span> | <span class=\"built_in\">Get-Random</span>)</span><br><span class=\"line\">    <span class=\"variable\">$time</span> = (<span class=\"built_in\">Get-Date</span>).AddMinutes(-<span class=\"variable\">$_</span>)</span><br><span class=\"line\">    <span class=\"string\">&quot;<span class=\"variable\">$</span>(<span class=\"variable\">$time</span>.ToString(&quot;</span>yyyy<span class=\"literal\">-MM-dd</span> HH:mm:ss<span class=\"string\">&quot;)), <span class=\"variable\">$user</span>, <span class=\"variable\">$action</span>&quot;</span></span><br><span class=\"line\">&#125; | <span class=\"built_in\">Set-Content</span> .\\demo.log</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-读取日志并统计每个用户的操作次数\"><a href=\"#2-2-读取日志并统计每个用户的操作次数\" class=\"headerlink\" title=\"2.2 读取日志并统计每个用户的操作次数\"></a>2.2 读取日志并统计每个用户的操作次数</h3><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 读取日志</span></span><br><span class=\"line\"><span class=\"variable\">$lines</span> = <span class=\"built_in\">Get-Content</span> .\\demo.log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 统计每个用户的操作次数</span></span><br><span class=\"line\"><span class=\"variable\">$stats</span> = <span class=\"selector-tag\">@</span>&#123;&#125;</span><br><span class=\"line\"><span class=\"keyword\">foreach</span> (<span class=\"variable\">$line</span> <span class=\"keyword\">in</span> <span class=\"variable\">$lines</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$parts</span> = <span class=\"variable\">$line</span> <span class=\"operator\">-split</span> <span class=\"string\">&quot;, &quot;</span></span><br><span class=\"line\">    <span class=\"variable\">$user</span> = <span class=\"variable\">$parts</span><span class=\"function\">[<span class=\"number\">1</span>]</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable\">$stats</span>.ContainsKey(<span class=\"variable\">$user</span>)) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$stats</span>[<span class=\"variable\">$user</span>]++</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"variable\">$stats</span>[<span class=\"variable\">$user</span>] = <span class=\"number\">1</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable\">$stats</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-3-用管道和-Group-Object-实现同样功能\"><a href=\"#2-3-用管道和-Group-Object-实现同样功能\" class=\"headerlink\" title=\"2.3 用管道和 Group-Object 实现同样功能\"></a>2.3 用管道和 Group-Object 实现同样功能</h3><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Get-Content</span> .\\demo.log |</span><br><span class=\"line\">    <span class=\"built_in\">ForEach-Object</span> &#123;</span><br><span class=\"line\">        (<span class=\"variable\">$_</span> <span class=\"operator\">-split</span> <span class=\"string\">&quot;, &quot;</span>)[<span class=\"number\">1</span>]</span><br><span class=\"line\">    &#125; |</span><br><span class=\"line\">    <span class=\"built_in\">Group-Object</span> | <span class=\"built_in\">Sort-Object</span> Count <span class=\"literal\">-Descending</span> | <span class=\"built_in\">Format-Table</span> Name,Count</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-4-导出统计结果为-CSV\"><a href=\"#2-4-导出统计结果为-CSV\" class=\"headerlink\" title=\"2.4 导出统计结果为 CSV\"></a>2.4 导出统计结果为 CSV</h3><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Get-Content</span> .\\demo.log |</span><br><span class=\"line\">    <span class=\"built_in\">ForEach-Object</span> &#123;</span><br><span class=\"line\">        <span class=\"variable\">$p</span> = <span class=\"variable\">$_</span> <span class=\"operator\">-split</span> <span class=\"string\">&quot;, &quot;</span></span><br><span class=\"line\">        [<span class=\"type\">PSCustomObject</span>]<span class=\"selector-tag\">@</span>&#123;User=<span class=\"variable\">$p</span>[<span class=\"number\">1</span>]; Action=<span class=\"variable\">$p</span>[<span class=\"number\">2</span>]&#125;</span><br><span class=\"line\">    &#125; |</span><br><span class=\"line\">    <span class=\"built_in\">Group-Object</span> User | </span><br><span class=\"line\">    <span class=\"built_in\">Select-Object</span> Name, <span class=\"selector-tag\">@</span>&#123;n=<span class=\"string\">&quot;Count&quot;</span>;e=&#123;<span class=\"variable\">$_</span>.Count&#125;&#125; |</span><br><span class=\"line\">    <span class=\"built_in\">Export-Csv</span> <span class=\"literal\">-Path</span> .\\user_stats.csv <span class=\"literal\">-NoTypeInformation</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"三、进阶：错误处理、正则、批量文件处理\"><a href=\"#三、进阶：错误处理、正则、批量文件处理\" class=\"headerlink\" title=\"三、进阶：错误处理、正则、批量文件处理\"></a>三、进阶：错误处理、正则、批量文件处理</h2><h3 id=\"3-1-错误处理（try-x2F-catch-x2F-finally）\"><a href=\"#3-1-错误处理（try-x2F-catch-x2F-finally）\" class=\"headerlink\" title=\"3.1 错误处理（try&#x2F;catch&#x2F;finally）\"></a>3.1 错误处理（try&#x2F;catch&#x2F;finally）</h3><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\"># 可能出错的代码</span></span><br><span class=\"line\">    <span class=\"variable\">$content</span> = <span class=\"built_in\">Get-Content</span> .\\not_exist.log <span class=\"literal\">-ErrorAction</span> Stop</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">Write-Output</span> <span class=\"string\">&quot;文件不存在！&quot;</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">Write-Output</span> <span class=\"string\">&quot;脚本执行完毕&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-2-正则表达式提取日志字段\"><a href=\"#3-2-正则表达式提取日志字段\" class=\"headerlink\" title=\"3.2 正则表达式提取日志字段\"></a>3.2 正则表达式提取日志字段</h3><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 假设日志格式：2026-01-01 12:00:00, alice, login</span></span><br><span class=\"line\"><span class=\"variable\">$line</span> = <span class=\"string\">&quot;2026-01-01 12:00:00, alice, login&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"variable\">$line</span> <span class=\"operator\">-match</span> <span class=\"string\">&quot;(?&lt;time&gt;\\d&#123;4&#125;-\\d&#123;2&#125;-\\d&#123;2&#125; \\d&#123;2&#125;:\\d&#123;2&#125;:\\d&#123;2&#125;), (?&lt;user&gt;\\w+), (?&lt;action&gt;\\w+)&quot;</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$matches</span>[<span class=\"string\">&quot;time&quot;</span>]  <span class=\"comment\"># 2026-01-01 12:00:00</span></span><br><span class=\"line\">    <span class=\"variable\">$matches</span>[<span class=\"string\">&quot;user&quot;</span>]  <span class=\"comment\"># alice</span></span><br><span class=\"line\">    <span class=\"variable\">$matches</span>[<span class=\"string\">&quot;action&quot;</span>] <span class=\"comment\"># login</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-3-批量处理多个日志文件\"><a href=\"#3-3-批量处理多个日志文件\" class=\"headerlink\" title=\"3.3 批量处理多个日志文件\"></a>3.3 批量处理多个日志文件</h3><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 假设有 log1.txt, log2.txt ...</span></span><br><span class=\"line\"><span class=\"built_in\">Get-ChildItem</span> . <span class=\"literal\">-Filter</span> <span class=\"string\">&quot;log*.txt&quot;</span> | <span class=\"built_in\">ForEach-Object</span> &#123;</span><br><span class=\"line\">    <span class=\"variable\">$file</span> = <span class=\"variable\">$_</span>.FullName</span><br><span class=\"line\">    <span class=\"variable\">$lines</span> = <span class=\"built_in\">Get-Content</span> <span class=\"variable\">$file</span></span><br><span class=\"line\">    <span class=\"comment\"># ...对每个文件做统计</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"四、实战任务（含完整代码与答案）\"><a href=\"#四、实战任务（含完整代码与答案）\" class=\"headerlink\" title=\"四、实战任务（含完整代码与答案）\"></a>四、实战任务（含完整代码与答案）</h2><h3 id=\"任务-1：生成-1000-行假日志文件\"><a href=\"#任务-1：生成-1000-行假日志文件\" class=\"headerlink\" title=\"任务 1：生成 1000 行假日志文件\"></a>任务 1：生成 1000 行假日志文件</h3><p><strong>目标</strong>：掌握 ForEach-Object、随机数、日期格式化</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1</span>..<span class=\"number\">1000</span> | <span class=\"built_in\">ForEach-Object</span> &#123;</span><br><span class=\"line\">    <span class=\"variable\">$user</span> = (<span class=\"string\">&quot;alice&quot;</span>,<span class=\"string\">&quot;bob&quot;</span>,<span class=\"string\">&quot;charlie&quot;</span>,<span class=\"string\">&quot;dave&quot;</span> | <span class=\"built_in\">Get-Random</span>)</span><br><span class=\"line\">    <span class=\"variable\">$action</span> = (<span class=\"string\">&quot;login&quot;</span>,<span class=\"string\">&quot;logout&quot;</span>,<span class=\"string\">&quot;fail&quot;</span>,<span class=\"string\">&quot;download&quot;</span>,<span class=\"string\">&quot;upload&quot;</span> | <span class=\"built_in\">Get-Random</span>)</span><br><span class=\"line\">    <span class=\"variable\">$time</span> = (<span class=\"built_in\">Get-Date</span>).AddMinutes(-<span class=\"variable\">$_</span>)</span><br><span class=\"line\">    <span class=\"string\">&quot;<span class=\"variable\">$</span>(<span class=\"variable\">$time</span>.ToString(&quot;</span>yyyy<span class=\"literal\">-MM-dd</span> HH:mm:ss<span class=\"string\">&quot;)), <span class=\"variable\">$user</span>, <span class=\"variable\">$action</span>&quot;</span></span><br><span class=\"line\">&#125; | <span class=\"built_in\">Set-Content</span> .\\demo.log</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"任务-2：统计每个用户的操作次数\"><a href=\"#任务-2：统计每个用户的操作次数\" class=\"headerlink\" title=\"任务 2：统计每个用户的操作次数\"></a>任务 2：统计每个用户的操作次数</h3><p><strong>目标</strong>：掌握管道、Group-Object、Format-Table</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Get-Content</span> .\\demo.log |</span><br><span class=\"line\">    <span class=\"built_in\">ForEach-Object</span> &#123;</span><br><span class=\"line\">        (<span class=\"variable\">$_</span> <span class=\"operator\">-split</span> <span class=\"string\">&quot;, &quot;</span>)[<span class=\"number\">1</span>]</span><br><span class=\"line\">    &#125; |</span><br><span class=\"line\">    <span class=\"built_in\">Group-Object</span> | <span class=\"built_in\">Sort-Object</span> Count <span class=\"literal\">-Descending</span> | <span class=\"built_in\">Format-Table</span> Name,Count</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"任务-3：统计每种操作类型的次数\"><a href=\"#任务-3：统计每种操作类型的次数\" class=\"headerlink\" title=\"任务 3：统计每种操作类型的次数\"></a>任务 3：统计每种操作类型的次数</h3><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Get-Content</span> .\\demo.log |</span><br><span class=\"line\">    <span class=\"built_in\">ForEach-Object</span> &#123;</span><br><span class=\"line\">        (<span class=\"variable\">$_</span> <span class=\"operator\">-split</span> <span class=\"string\">&quot;, &quot;</span>)[<span class=\"number\">2</span>]</span><br><span class=\"line\">    &#125; |</span><br><span class=\"line\">    <span class=\"built_in\">Group-Object</span> | <span class=\"built_in\">Sort-Object</span> Count <span class=\"literal\">-Descending</span> | <span class=\"built_in\">Format-Table</span> Name,Count</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"任务-4：导出所有“fail”操作的日志到-fail-csv\"><a href=\"#任务-4：导出所有“fail”操作的日志到-fail-csv\" class=\"headerlink\" title=\"任务 4：导出所有“fail”操作的日志到 fail.csv\"></a>任务 4：导出所有“fail”操作的日志到 fail.csv</h3><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Get-Content</span> .\\demo.log |</span><br><span class=\"line\">    <span class=\"built_in\">Where-Object</span> &#123;<span class=\"variable\">$_</span> <span class=\"operator\">-like</span> <span class=\"string\">&quot;*, fail&quot;</span>&#125; |</span><br><span class=\"line\">    <span class=\"built_in\">ForEach-Object</span> &#123;</span><br><span class=\"line\">        <span class=\"variable\">$p</span> = <span class=\"variable\">$_</span> <span class=\"operator\">-split</span> <span class=\"string\">&quot;, &quot;</span></span><br><span class=\"line\">        [<span class=\"type\">PSCustomObject</span>]<span class=\"selector-tag\">@</span>&#123;Time=<span class=\"variable\">$p</span>[<span class=\"number\">0</span>]; User=<span class=\"variable\">$p</span>[<span class=\"number\">1</span>]; Action=<span class=\"variable\">$p</span>[<span class=\"number\">2</span>]&#125;</span><br><span class=\"line\">    &#125; |</span><br><span class=\"line\">    <span class=\"built_in\">Export-Csv</span> <span class=\"literal\">-Path</span> .\\fail.csv <span class=\"literal\">-NoTypeInformation</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"任务-5：写一个函数，统计指定用户的所有操作\"><a href=\"#任务-5：写一个函数，统计指定用户的所有操作\" class=\"headerlink\" title=\"任务 5：写一个函数，统计指定用户的所有操作\"></a>任务 5：写一个函数，统计指定用户的所有操作</h3><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Get-UserActions</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">param</span>(<span class=\"variable\">$username</span>)</span><br><span class=\"line\">    <span class=\"built_in\">Get-Content</span> .\\demo.log |</span><br><span class=\"line\">        <span class=\"built_in\">Where-Object</span> &#123;<span class=\"variable\">$_</span> <span class=\"operator\">-like</span> <span class=\"string\">&quot;*, <span class=\"variable\">$username</span>,*&quot;</span>&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 用法</span></span><br><span class=\"line\"><span class=\"built_in\">Get-UserActions</span> <span class=\"literal\">-username</span> <span class=\"string\">&quot;alice&quot;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"五、巩固练习与评估标准\"><a href=\"#五、巩固练习与评估标准\" class=\"headerlink\" title=\"五、巩固练习与评估标准\"></a>五、巩固练习与评估标准</h2><h3 id=\"巩固练习\"><a href=\"#巩固练习\" class=\"headerlink\" title=\"巩固练习\"></a>巩固练习</h3><ol>\n<li>用 PowerShell 写一个脚本，统计每小时的登录次数（按时间分组）</li>\n<li>写一个脚本，找出 1 小时内操作次数最多的用户</li>\n<li>用正则提取所有“fail”操作的时间和用户名</li>\n<li>写一个函数，批量处理多个日志文件，统计总的“fail”次数</li>\n<li>用 try&#x2F;catch 包裹文件读取，遇到不存在的文件输出“文件缺失”</li>\n</ol>\n<h3 id=\"评估标准\"><a href=\"#评估标准\" class=\"headerlink\" title=\"评估标准\"></a>评估标准</h3><ul>\n<li>✅ 能用管道和 Group-Object 做分组统计</li>\n<li>✅ 能用 Export-Csv 导出结果</li>\n<li>✅ 能写出带参数的函数</li>\n<li>✅ 能用 try&#x2F;catch 做错误处理</li>\n<li>✅ 能用正则提取日志字段</li>\n</ul>\n<hr>\n<h2 id=\"六、参考资料与进阶阅读\"><a href=\"#六、参考资料与进阶阅读\" class=\"headerlink\" title=\"六、参考资料与进阶阅读\"></a>六、参考资料与进阶阅读</h2><ul>\n<li><a href=\"https://docs.microsoft.com/zh-cn/powershell/\">微软官方 PowerShell 文档</a></li>\n<li><a href=\"https://www.powershellgallery.com/\">PowerShell Gallery 脚本库</a></li>\n<li><a href=\"https://docs.microsoft.com/zh-cn/powershell/scripting/learn/deep-dives/everything-about-regular-expressions\">PowerShell 正则表达式教程</a></li>\n<li><a href=\"https://docs.microsoft.com/zh-cn/powershell/scripting/learn/deep-dives/everything-about-pipelines\">PowerShell 管道与对象详解</a></li>\n</ul>\n<hr>\n<h2 id=\"七、学习成果达成情况（由学习者填写）\"><a href=\"#七、学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"七、学习成果达成情况（由学习者填写）\"></a>七、学习成果达成情况（由学习者填写）</h2><ul>\n<li><input disabled=\"\" type=\"checkbox\"> demo.log 生成截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 统计结果输出截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> fail.csv 导出截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 自己写的函数代码</li>\n<li><input disabled=\"\" type=\"checkbox\"> 错误处理脚本截图</li>\n</ul>\n<hr>\n<p><strong>恭喜！你已掌握 PowerShell 脚本的核心技能。明天我们将学习 Python 脚本，进一步提升自动化与数据处理能力！</strong> 🎉</p>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day018：操作系统与脚本 - Python 脚本入门（文本与网络，傻瓜版能照做）","url":"/post/250cf72c.html","content":"<h1 id=\"Day018：操作系统与脚本-Python-脚本入门（文本与网络，傻瓜版能照做）\"><a href=\"#Day018：操作系统与脚本-Python-脚本入门（文本与网络，傻瓜版能照做）\" class=\"headerlink\" title=\"Day018：操作系统与脚本 - Python 脚本入门（文本与网络，傻瓜版能照做）\"></a>Day018：操作系统与脚本 - Python 脚本入门（文本与网络，傻瓜版能照做）</h1><ul>\n<li>日期：2026-01-11</li>\n<li>周次：第 3 周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p>学完今天你应该能做到：</p>\n<ul>\n<li>用 Python 读文件、用正则提取字段、输出 JSON&#x2F;CSV</li>\n<li>用 <strong>标准库</strong> 发起一个 HTTP GET 请求并解析 JSON</li>\n<li>写出”不会一报错就崩”的脚本：会用 <code>try/except</code> 给出可读错误</li>\n<li>掌握 Python 文件操作、正则表达式、数据处理、网络请求的核心技能</li>\n<li>能独立完成日志解析、API 调用、数据导出等自动化任务</li>\n</ul>\n<hr>\n<span id=\"more\"></span>\n\n<h2 id=\"一、为什么学-Python-脚本？\"><a href=\"#一、为什么学-Python-脚本？\" class=\"headerlink\" title=\"一、为什么学 Python 脚本？\"></a>一、为什么学 Python 脚本？</h2><h3 id=\"1-1-Python-在安全领域的优势\"><a href=\"#1-1-Python-在安全领域的优势\" class=\"headerlink\" title=\"1.1 Python 在安全领域的优势\"></a>1.1 Python 在安全领域的优势</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">渗透测试工具</span><br><span class=\"line\">├─ Metasploit：用 Ruby 写，但很多 exploit 用 Python</span><br><span class=\"line\">├─ Impacket：SMB/Kerberos 等协议的 Python 实现</span><br><span class=\"line\">├─ Scapy：数据包构造与分析</span><br><span class=\"line\">└─ 很多 PoC/Exploit 都是 Python 写的</span><br><span class=\"line\"></span><br><span class=\"line\">自动化运维</span><br><span class=\"line\">├─ Ansible：用 Python 写的自动化部署工具</span><br><span class=\"line\">├─ Fabric：SSH 批量执行脚本</span><br><span class=\"line\">└─ 日志分析、漏洞扫描结果解析</span><br><span class=\"line\"></span><br><span class=\"line\">数据处理</span><br><span class=\"line\">├─ pandas：表格数据处理</span><br><span class=\"line\">├─ requests：HTTP 请求</span><br><span class=\"line\">└─ BeautifulSoup：网页解析</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-2-今天你不需要安装第三方库\"><a href=\"#1-2-今天你不需要安装第三方库\" class=\"headerlink\" title=\"1.2 今天你不需要安装第三方库\"></a>1.2 今天你不需要安装第三方库</h3><p>我们只用 <strong>Python 标准库</strong>：</p>\n<ul>\n<li>文件操作：<code>pathlib</code>、<code>open()</code></li>\n<li>正则表达式：<code>re</code></li>\n<li>JSON&#x2F;CSV：<code>json</code>、<code>csv</code></li>\n<li>HTTP 请求：<code>urllib.request</code></li>\n</ul>\n<hr>\n<h2 id=\"二、Python-基础语法与文件操作\"><a href=\"#二、Python-基础语法与文件操作\" class=\"headerlink\" title=\"二、Python 基础语法与文件操作\"></a>二、Python 基础语法与文件操作</h2><h3 id=\"2-1-变量、类型与基本运算\"><a href=\"#2-1-变量、类型与基本运算\" class=\"headerlink\" title=\"2.1 变量、类型与基本运算\"></a>2.1 变量、类型与基本运算</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 变量定义</span></span><br><span class=\"line\">name = <span class=\"string\">&quot;Alice&quot;</span></span><br><span class=\"line\">age = <span class=\"number\">20</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 字符串拼接</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">f&quot;姓名：<span class=\"subst\">&#123;name&#125;</span>，年龄：<span class=\"subst\">&#123;age&#125;</span>&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 列表</span></span><br><span class=\"line\">nums = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 字典</span></span><br><span class=\"line\">user = &#123;<span class=\"string\">&quot;username&quot;</span>: <span class=\"string\">&quot;bob&quot;</span>, <span class=\"string\">&quot;role&quot;</span>: <span class=\"string\">&quot;admin&quot;</span>&#125;</span><br><span class=\"line\"><span class=\"built_in\">print</span>(user[<span class=\"string\">&quot;username&quot;</span>])</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-条件判断与循环\"><a href=\"#2-2-条件判断与循环\" class=\"headerlink\" title=\"2.2 条件判断与循环\"></a>2.2 条件判断与循环</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># if-else</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> age &gt;= <span class=\"number\">18</span>:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;成年人&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">else</span>:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;未成年人&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># for 循环</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> n <span class=\"keyword\">in</span> nums:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(n)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># while 循环</span></span><br><span class=\"line\">i = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> i &lt; <span class=\"number\">5</span>:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(i)</span><br><span class=\"line\">    i += <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-3-函数定义\"><a href=\"#2-3-函数定义\" class=\"headerlink\" title=\"2.3 函数定义\"></a>2.3 函数定义</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">add_two</span>(<span class=\"params\">a, b</span>):</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a + b</span><br><span class=\"line\"></span><br><span class=\"line\">result = add_two(<span class=\"number\">3</span>, <span class=\"number\">5</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-4-读写文件（3-种方法）\"><a href=\"#2-4-读写文件（3-种方法）\" class=\"headerlink\" title=\"2.4 读写文件（3 种方法）\"></a>2.4 读写文件（3 种方法）</h3><p><strong>方法 1：传统 open()</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 读取文件</span></span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&quot;demo.log&quot;</span>, <span class=\"string\">&quot;r&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    lines = f.readlines()</span><br><span class=\"line\">    <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> lines:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(line.strip())</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 写入文件</span></span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&quot;output.txt&quot;</span>, <span class=\"string\">&quot;w&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    f.write(<span class=\"string\">&quot;Hello World\\n&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p><strong>方法 2：pathlib（推荐）</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pathlib <span class=\"keyword\">import</span> Path</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取</span></span><br><span class=\"line\">content = Path(<span class=\"string\">&quot;demo.log&quot;</span>).read_text(encoding=<span class=\"string\">&quot;utf-8&quot;</span>)</span><br><span class=\"line\">lines = content.splitlines()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 写入</span></span><br><span class=\"line\">Path(<span class=\"string\">&quot;output.txt&quot;</span>).write_text(<span class=\"string\">&quot;Hello World\\n&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p><strong>方法 3：逐行处理大文件</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&quot;large.log&quot;</span>, <span class=\"string\">&quot;r&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> f:  <span class=\"comment\"># 不会一次性加载全部到内存</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">&quot;error&quot;</span> <span class=\"keyword\">in</span> line.lower():</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(line.strip())</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"三、正则表达式详解\"><a href=\"#三、正则表达式详解\" class=\"headerlink\" title=\"三、正则表达式详解\"></a>三、正则表达式详解</h2><h3 id=\"3-1-常用正则符号\"><a href=\"#3-1-常用正则符号\" class=\"headerlink\" title=\"3.1 常用正则符号\"></a>3.1 常用正则符号</h3><table>\n<thead>\n<tr>\n<th>符号</th>\n<th>含义</th>\n<th>示例</th>\n<th>匹配</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>.</code></td>\n<td>任意单个字符</td>\n<td><code>a.c</code></td>\n<td>abc, a1c, a@c</td>\n</tr>\n<tr>\n<td><code>*</code></td>\n<td>前面字符重复 0 次或多次</td>\n<td><code>ab*c</code></td>\n<td>ac, abc, abbc</td>\n</tr>\n<tr>\n<td><code>+</code></td>\n<td>前面字符重复 1 次或多次</td>\n<td><code>ab+c</code></td>\n<td>abc, abbc</td>\n</tr>\n<tr>\n<td><code>?</code></td>\n<td>前面字符出现 0 次或 1 次</td>\n<td><code>ab?c</code></td>\n<td>ac, abc</td>\n</tr>\n<tr>\n<td><code>\\d</code></td>\n<td>数字（0-9）</td>\n<td><code>\\d&#123;4&#125;</code></td>\n<td>2026, 1234</td>\n</tr>\n<tr>\n<td><code>\\w</code></td>\n<td>字母、数字、下划线</td>\n<td><code>\\w+</code></td>\n<td>alice, user_123</td>\n</tr>\n<tr>\n<td><code>\\s</code></td>\n<td>空白字符（空格、Tab、换行）</td>\n<td><code>\\s+</code></td>\n<td>空格、Tab</td>\n</tr>\n<tr>\n<td><code>[]</code></td>\n<td>字符集</td>\n<td><code>[abc]</code></td>\n<td>a, b, c</td>\n</tr>\n<tr>\n<td><code>[^]</code></td>\n<td>非字符集</td>\n<td><code>[^abc]</code></td>\n<td>除了 a,b,c 的任意字符</td>\n</tr>\n<tr>\n<td><code>^</code></td>\n<td>行首</td>\n<td><code>^hello</code></td>\n<td>以 hello 开头的行</td>\n</tr>\n<tr>\n<td><code>$</code></td>\n<td>行尾</td>\n<td><code>world$</code></td>\n<td>以 world 结尾的行</td>\n</tr>\n<tr>\n<td><code>()</code></td>\n<td>捕获组</td>\n<td><code>(\\d&#123;4&#125;)-(\\d&#123;2&#125;)</code></td>\n<td>捕获年-月</td>\n</tr>\n</tbody></table>\n<h3 id=\"3-2-正则提取日志字段\"><a href=\"#3-2-正则提取日志字段\" class=\"headerlink\" title=\"3.2 正则提取日志字段\"></a>3.2 正则提取日志字段</h3><p><strong>示例日志格式</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">2026-01-11 12:00:00, alice, login</span><br><span class=\"line\">2026-01-11 12:05:30, bob, logout</span><br><span class=\"line\">2026-01-11 12:10:15, charlie, fail</span><br></pre></td></tr></table></figure>\n\n<p><strong>提取时间、用户、操作</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">log = <span class=\"string\">&quot;2026-01-11 12:00:00, alice, login&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方法 1：简单分割</span></span><br><span class=\"line\">parts = log.split(<span class=\"string\">&quot;, &quot;</span>)</span><br><span class=\"line\">time, user, action = parts[<span class=\"number\">0</span>], parts[<span class=\"number\">1</span>], parts[<span class=\"number\">2</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方法 2：正则捕获组</span></span><br><span class=\"line\">pattern = <span class=\"string\">r&quot;(?P&lt;time&gt;\\d&#123;4&#125;-\\d&#123;2&#125;-\\d&#123;2&#125; \\d&#123;2&#125;:\\d&#123;2&#125;:\\d&#123;2&#125;), (?P&lt;user&gt;\\w+), (?P&lt;action&gt;\\w+)&quot;</span></span><br><span class=\"line\">match = re.match(pattern, log)</span><br><span class=\"line\"><span class=\"keyword\">if</span> match:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(match.group(<span class=\"string\">&quot;time&quot;</span>))   <span class=\"comment\"># 2026-01-11 12:00:00</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(match.group(<span class=\"string\">&quot;user&quot;</span>))   <span class=\"comment\"># alice</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(match.group(<span class=\"string\">&quot;action&quot;</span>)) <span class=\"comment\"># login</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-3-提取-IP-地址\"><a href=\"#3-3-提取-IP-地址\" class=\"headerlink\" title=\"3.3 提取 IP 地址\"></a>3.3 提取 IP 地址</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">text = <span class=\"string\">&quot;192.168.1.100 访问了服务器 10.0.0.5&quot;</span></span><br><span class=\"line\">ips = re.findall(<span class=\"string\">r&quot;\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;&quot;</span>, text)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(ips)  <span class=\"comment\"># [&#x27;192.168.1.100&#x27;, &#x27;10.0.0.5&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-4-提取邮箱地址\"><a href=\"#3-4-提取邮箱地址\" class=\"headerlink\" title=\"3.4 提取邮箱地址\"></a>3.4 提取邮箱地址</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">text = <span class=\"string\">&quot;联系方式：alice@example.com 或 bob@company.org&quot;</span></span><br><span class=\"line\">emails = re.findall(<span class=\"string\">r&quot;\\w+@\\w+\\.\\w+&quot;</span>, text)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(emails)  <span class=\"comment\"># [&#x27;alice@example.com&#x27;, &#x27;bob@company.org&#x27;]</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"四、JSON-与-CSV-处理\"><a href=\"#四、JSON-与-CSV-处理\" class=\"headerlink\" title=\"四、JSON 与 CSV 处理\"></a>四、JSON 与 CSV 处理</h2><h3 id=\"4-1-JSON-读写\"><a href=\"#4-1-JSON-读写\" class=\"headerlink\" title=\"4.1 JSON 读写\"></a>4.1 JSON 读写</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 写入 JSON</span></span><br><span class=\"line\">data = &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;users&quot;</span>: [</span><br><span class=\"line\">        &#123;<span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;alice&quot;</span>, <span class=\"string\">&quot;role&quot;</span>: <span class=\"string\">&quot;admin&quot;</span>&#125;,</span><br><span class=\"line\">        &#123;<span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;bob&quot;</span>, <span class=\"string\">&quot;role&quot;</span>: <span class=\"string\">&quot;user&quot;</span>&#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&quot;users.json&quot;</span>, <span class=\"string\">&quot;w&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    json.dump(data, f, indent=<span class=\"number\">4</span>, ensure_ascii=<span class=\"literal\">False</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取 JSON</span></span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&quot;users.json&quot;</span>, <span class=\"string\">&quot;r&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    data = json.load(f)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(data[<span class=\"string\">&quot;users&quot;</span>][<span class=\"number\">0</span>][<span class=\"string\">&quot;name&quot;</span>])  <span class=\"comment\"># alice</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-2-CSV-读写\"><a href=\"#4-2-CSV-读写\" class=\"headerlink\" title=\"4.2 CSV 读写\"></a>4.2 CSV 读写</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> csv</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 写入 CSV</span></span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&quot;users.csv&quot;</span>, <span class=\"string\">&quot;w&quot;</span>, newline=<span class=\"string\">&quot;&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    writer = csv.writer(f)</span><br><span class=\"line\">    writer.writerow([<span class=\"string\">&quot;Name&quot;</span>, <span class=\"string\">&quot;Role&quot;</span>])  <span class=\"comment\"># 表头</span></span><br><span class=\"line\">    writer.writerow([<span class=\"string\">&quot;alice&quot;</span>, <span class=\"string\">&quot;admin&quot;</span>])</span><br><span class=\"line\">    writer.writerow([<span class=\"string\">&quot;bob&quot;</span>, <span class=\"string\">&quot;user&quot;</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取 CSV</span></span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&quot;users.csv&quot;</span>, <span class=\"string\">&quot;r&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    reader = csv.DictReader(f)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> row <span class=\"keyword\">in</span> reader:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(row[<span class=\"string\">&quot;Name&quot;</span>], row[<span class=\"string\">&quot;Role&quot;</span>])</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"五、HTTP-请求与-API-调用\"><a href=\"#五、HTTP-请求与-API-调用\" class=\"headerlink\" title=\"五、HTTP 请求与 API 调用\"></a>五、HTTP 请求与 API 调用</h2><h3 id=\"5-1-发起-GET-请求（标准库-urllib）\"><a href=\"#5-1-发起-GET-请求（标准库-urllib）\" class=\"headerlink\" title=\"5.1 发起 GET 请求（标准库 urllib）\"></a>5.1 发起 GET 请求（标准库 urllib）</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> urllib.request</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 发起 GET 请求</span></span><br><span class=\"line\">url = <span class=\"string\">&quot;https://api.github.com/users/octocat&quot;</span></span><br><span class=\"line\">req = urllib.request.Request(url)</span><br><span class=\"line\">req.add_header(<span class=\"string\">&quot;User-Agent&quot;</span>, <span class=\"string\">&quot;Python-Script/1.0&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">    <span class=\"keyword\">with</span> urllib.request.urlopen(req, timeout=<span class=\"number\">10</span>) <span class=\"keyword\">as</span> response:</span><br><span class=\"line\">        data = json.loads(response.read().decode(<span class=\"string\">&quot;utf-8&quot;</span>))</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(data[<span class=\"string\">&quot;login&quot;</span>])  <span class=\"comment\"># octocat</span></span><br><span class=\"line\">        <span class=\"built_in\">print</span>(data[<span class=\"string\">&quot;public_repos&quot;</span>])</span><br><span class=\"line\"><span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;请求失败：<span class=\"subst\">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-2-发起-POST-请求\"><a href=\"#5-2-发起-POST-请求\" class=\"headerlink\" title=\"5.2 发起 POST 请求\"></a>5.2 发起 POST 请求</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> urllib.request</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"></span><br><span class=\"line\">url = <span class=\"string\">&quot;https://httpbin.org/post&quot;</span></span><br><span class=\"line\">data = &#123;<span class=\"string\">&quot;username&quot;</span>: <span class=\"string\">&quot;alice&quot;</span>, <span class=\"string\">&quot;password&quot;</span>: <span class=\"string\">&quot;secret&quot;</span>&#125;</span><br><span class=\"line\">data_bytes = json.dumps(data).encode(<span class=\"string\">&quot;utf-8&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">req = urllib.request.Request(url, data=data_bytes, method=<span class=\"string\">&quot;POST&quot;</span>)</span><br><span class=\"line\">req.add_header(<span class=\"string\">&quot;Content-Type&quot;</span>, <span class=\"string\">&quot;application/json&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">    <span class=\"keyword\">with</span> urllib.request.urlopen(req, timeout=<span class=\"number\">10</span>) <span class=\"keyword\">as</span> response:</span><br><span class=\"line\">        result = json.loads(response.read().decode(<span class=\"string\">&quot;utf-8&quot;</span>))</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(result[<span class=\"string\">&quot;json&quot;</span>])  <span class=\"comment\"># 返回你发送的数据</span></span><br><span class=\"line\"><span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;请求失败：<span class=\"subst\">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-3-处理-HTTP-错误\"><a href=\"#5-3-处理-HTTP-错误\" class=\"headerlink\" title=\"5.3 处理 HTTP 错误\"></a>5.3 处理 HTTP 错误</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> urllib.request</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib.error</span><br><span class=\"line\"></span><br><span class=\"line\">url = <span class=\"string\">&quot;https://httpbin.org/status/404&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">    <span class=\"keyword\">with</span> urllib.request.urlopen(url, timeout=<span class=\"number\">10</span>) <span class=\"keyword\">as</span> response:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(response.read())</span><br><span class=\"line\"><span class=\"keyword\">except</span> urllib.error.HTTPError <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;HTTP 错误：<span class=\"subst\">&#123;e.code&#125;</span> <span class=\"subst\">&#123;e.reason&#125;</span>&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">except</span> urllib.error.URLError <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;网络错误：<span class=\"subst\">&#123;e.reason&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"六、错误处理（try-x2F-except）\"><a href=\"#六、错误处理（try-x2F-except）\" class=\"headerlink\" title=\"六、错误处理（try&#x2F;except）\"></a>六、错误处理（try&#x2F;except）</h2><h3 id=\"6-1-基本用法\"><a href=\"#6-1-基本用法\" class=\"headerlink\" title=\"6.1 基本用法\"></a>6.1 基本用法</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">    <span class=\"comment\"># 可能出错的代码</span></span><br><span class=\"line\">    result = <span class=\"number\">10</span> / <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">except</span> ZeroDivisionError:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;除数不能为 0&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;发生错误：<span class=\"subst\">&#123;e&#125;</span>&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">finally</span>:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;无论如何都会执行&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6-2-错误处理最佳实践\"><a href=\"#6-2-错误处理最佳实践\" class=\"headerlink\" title=\"6.2 错误处理最佳实践\"></a>6.2 错误处理最佳实践</h3><p><strong>❌ 不要这样写</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">    <span class=\"comment\"># 某些操作</span></span><br><span class=\"line\">    <span class=\"keyword\">pass</span></span><br><span class=\"line\"><span class=\"keyword\">except</span>:</span><br><span class=\"line\">    <span class=\"keyword\">pass</span>  <span class=\"comment\"># 吞掉所有错误，无法排查问题</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>✅ 正确做法</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&quot;config.json&quot;</span>, <span class=\"string\">&quot;r&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        config = json.load(f)</span><br><span class=\"line\"><span class=\"keyword\">except</span> FileNotFoundError:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;错误：配置文件不存在，请创建 config.json&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">except</span> json.JSONDecodeError:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;错误：配置文件格式错误，请检查 JSON 语法&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;未知错误：<span class=\"subst\">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"七、实战任务（含完整代码）\"><a href=\"#七、实战任务（含完整代码）\" class=\"headerlink\" title=\"七、实战任务（含完整代码）\"></a>七、实战任务（含完整代码）</h2><h3 id=\"任务-1：生成假日志文件\"><a href=\"#任务-1：生成假日志文件\" class=\"headerlink\" title=\"任务 1：生成假日志文件\"></a>任务 1：生成假日志文件</h3><p><strong>目标</strong>：掌握文件写入、时间格式化、随机数</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> random</span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime, timedelta</span><br><span class=\"line\"></span><br><span class=\"line\">users = [<span class=\"string\">&quot;alice&quot;</span>, <span class=\"string\">&quot;bob&quot;</span>, <span class=\"string\">&quot;charlie&quot;</span>, <span class=\"string\">&quot;dave&quot;</span>]</span><br><span class=\"line\">actions = [<span class=\"string\">&quot;login&quot;</span>, <span class=\"string\">&quot;logout&quot;</span>, <span class=\"string\">&quot;fail&quot;</span>, <span class=\"string\">&quot;download&quot;</span>, <span class=\"string\">&quot;upload&quot;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&quot;demo.log&quot;</span>, <span class=\"string\">&quot;w&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1000</span>):</span><br><span class=\"line\">        user = random.choice(users)</span><br><span class=\"line\">        action = random.choice(actions)</span><br><span class=\"line\">        time = (datetime.now() - timedelta(minutes=i)).strftime(<span class=\"string\">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class=\"line\">        f.write(<span class=\"string\">f&quot;<span class=\"subst\">&#123;time&#125;</span>, <span class=\"subst\">&#123;user&#125;</span>, <span class=\"subst\">&#123;action&#125;</span>\\n&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;✅ 已生成 demo.log&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"任务-2：统计每个用户的操作次数\"><a href=\"#任务-2：统计每个用户的操作次数\" class=\"headerlink\" title=\"任务 2：统计每个用户的操作次数\"></a>任务 2：统计每个用户的操作次数</h3><p><strong>目标</strong>：掌握文件读取、字典统计</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> collections <span class=\"keyword\">import</span> defaultdict</span><br><span class=\"line\"></span><br><span class=\"line\">stats = defaultdict(<span class=\"built_in\">int</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&quot;demo.log&quot;</span>, <span class=\"string\">&quot;r&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> f:</span><br><span class=\"line\">        parts = line.strip().split(<span class=\"string\">&quot;, &quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(parts) == <span class=\"number\">3</span>:</span><br><span class=\"line\">            user = parts[<span class=\"number\">1</span>]</span><br><span class=\"line\">            stats[user] += <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 按次数降序排列</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> user, count <span class=\"keyword\">in</span> <span class=\"built_in\">sorted</span>(stats.items(), key=<span class=\"keyword\">lambda</span> x: x[<span class=\"number\">1</span>], reverse=<span class=\"literal\">True</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;<span class=\"subst\">&#123;user&#125;</span>: <span class=\"subst\">&#123;count&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"任务-3：提取所有”fail”操作并导出-CSV\"><a href=\"#任务-3：提取所有”fail”操作并导出-CSV\" class=\"headerlink\" title=\"任务 3：提取所有”fail”操作并导出 CSV\"></a>任务 3：提取所有”fail”操作并导出 CSV</h3><p><strong>目标</strong>：掌握正则、CSV 写入</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> csv</span><br><span class=\"line\"></span><br><span class=\"line\">pattern = <span class=\"string\">r&quot;(?P&lt;time&gt;[\\d\\-: ]+), (?P&lt;user&gt;\\w+), (?P&lt;action&gt;\\w+)&quot;</span></span><br><span class=\"line\">fail_logs = []</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&quot;demo.log&quot;</span>, <span class=\"string\">&quot;r&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> f:</span><br><span class=\"line\">        match = re.match(pattern, line.strip())</span><br><span class=\"line\">        <span class=\"keyword\">if</span> match <span class=\"keyword\">and</span> match.group(<span class=\"string\">&quot;action&quot;</span>) == <span class=\"string\">&quot;fail&quot;</span>:</span><br><span class=\"line\">            fail_logs.append(&#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;Time&quot;</span>: match.group(<span class=\"string\">&quot;time&quot;</span>),</span><br><span class=\"line\">                <span class=\"string\">&quot;User&quot;</span>: match.group(<span class=\"string\">&quot;user&quot;</span>),</span><br><span class=\"line\">                <span class=\"string\">&quot;Action&quot;</span>: match.group(<span class=\"string\">&quot;action&quot;</span>)</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 写入 CSV</span></span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&quot;fail.csv&quot;</span>, <span class=\"string\">&quot;w&quot;</span>, newline=<span class=\"string\">&quot;&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    writer = csv.DictWriter(f, fieldnames=[<span class=\"string\">&quot;Time&quot;</span>, <span class=\"string\">&quot;User&quot;</span>, <span class=\"string\">&quot;Action&quot;</span>])</span><br><span class=\"line\">    writer.writeheader()</span><br><span class=\"line\">    writer.writerows(fail_logs)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">f&quot;✅ 已导出 <span class=\"subst\">&#123;<span class=\"built_in\">len</span>(fail_logs)&#125;</span> 条失败日志到 fail.csv&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"任务-4：请求-GitHub-API-获取用户信息\"><a href=\"#任务-4：请求-GitHub-API-获取用户信息\" class=\"headerlink\" title=\"任务 4：请求 GitHub API 获取用户信息\"></a>任务 4：请求 GitHub API 获取用户信息</h3><p><strong>目标</strong>：掌握 HTTP 请求、JSON 解析、错误处理</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> urllib.request</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_github_user</span>(<span class=\"params\">username</span>):</span><br><span class=\"line\">    url = <span class=\"string\">f&quot;https://api.github.com/users/<span class=\"subst\">&#123;username&#125;</span>&quot;</span></span><br><span class=\"line\">    req = urllib.request.Request(url)</span><br><span class=\"line\">    req.add_header(<span class=\"string\">&quot;User-Agent&quot;</span>, <span class=\"string\">&quot;Python-Script/1.0&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"keyword\">with</span> urllib.request.urlopen(req, timeout=<span class=\"number\">10</span>) <span class=\"keyword\">as</span> response:</span><br><span class=\"line\">            data = json.loads(response.read().decode(<span class=\"string\">&quot;utf-8&quot;</span>))</span><br><span class=\"line\">            <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;login&quot;</span>: data[<span class=\"string\">&quot;login&quot;</span>],</span><br><span class=\"line\">                <span class=\"string\">&quot;name&quot;</span>: data.get(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;N/A&quot;</span>),</span><br><span class=\"line\">                <span class=\"string\">&quot;public_repos&quot;</span>: data[<span class=\"string\">&quot;public_repos&quot;</span>],</span><br><span class=\"line\">                <span class=\"string\">&quot;followers&quot;</span>: data[<span class=\"string\">&quot;followers&quot;</span>]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">    <span class=\"keyword\">except</span> urllib.error.HTTPError <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;error&quot;</span>: <span class=\"string\">f&quot;HTTP <span class=\"subst\">&#123;e.code&#125;</span>: <span class=\"subst\">&#123;e.reason&#125;</span>&quot;</span>&#125;</span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;<span class=\"string\">&quot;error&quot;</span>: <span class=\"built_in\">str</span>(e)&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用</span></span><br><span class=\"line\">result = get_github_user(<span class=\"string\">&quot;octocat&quot;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(json.dumps(result, indent=<span class=\"number\">4</span>, ensure_ascii=<span class=\"literal\">False</span>))</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"任务-5：批量处理多个日志文件\"><a href=\"#任务-5：批量处理多个日志文件\" class=\"headerlink\" title=\"任务 5：批量处理多个日志文件\"></a>任务 5：批量处理多个日志文件</h3><p><strong>目标</strong>：掌握文件遍历、异常处理</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pathlib <span class=\"keyword\">import</span> Path</span><br><span class=\"line\"></span><br><span class=\"line\">log_files = Path(<span class=\"string\">&quot;.&quot;</span>).glob(<span class=\"string\">&quot;*.log&quot;</span>)</span><br><span class=\"line\">total_fails = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> log_file <span class=\"keyword\">in</span> log_files:</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(log_file, <span class=\"string\">&quot;r&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">            fails = <span class=\"built_in\">sum</span>(<span class=\"number\">1</span> <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> f <span class=\"keyword\">if</span> <span class=\"string\">&quot;, fail&quot;</span> <span class=\"keyword\">in</span> line)</span><br><span class=\"line\">            total_fails += fails</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;<span class=\"subst\">&#123;log_file.name&#125;</span>: <span class=\"subst\">&#123;fails&#125;</span> 次失败&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;⚠️ 读取 <span class=\"subst\">&#123;log_file.name&#125;</span> 失败：<span class=\"subst\">&#123;e&#125;</span>&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">f&quot;\\n✅ 总计失败次数：<span class=\"subst\">&#123;total_fails&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"八、巩固练习\"><a href=\"#八、巩固练习\" class=\"headerlink\" title=\"八、巩固练习\"></a>八、巩固练习</h2><h3 id=\"练习-1：统计每小时的登录次数\"><a href=\"#练习-1：统计每小时的登录次数\" class=\"headerlink\" title=\"练习 1：统计每小时的登录次数\"></a>练习 1：统计每小时的登录次数</h3><p><strong>思路</strong>：</p>\n<ol>\n<li>用正则提取时间字段</li>\n<li>截取小时部分（前 13 位：<code>2026-01-11 12</code>）</li>\n<li>用字典统计每小时的次数</li>\n</ol>\n<h3 id=\"练习-2：找出操作次数最多的-Top-3-用户\"><a href=\"#练习-2：找出操作次数最多的-Top-3-用户\" class=\"headerlink\" title=\"练习 2：找出操作次数最多的 Top 3 用户\"></a>练习 2：找出操作次数最多的 Top 3 用户</h3><p><strong>思路</strong>：</p>\n<ol>\n<li>用字典统计每个用户的操作次数</li>\n<li>用 <code>sorted()</code> 按次数降序排列</li>\n<li>取前 3 名</li>\n</ol>\n<h3 id=\"练习-3：用正则提取日志中的所有-IP-地址\"><a href=\"#练习-3：用正则提取日志中的所有-IP-地址\" class=\"headerlink\" title=\"练习 3：用正则提取日志中的所有 IP 地址\"></a>练习 3：用正则提取日志中的所有 IP 地址</h3><p><strong>思路</strong>：</p>\n<ol>\n<li>用 <code>re.findall(r&quot;\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;&quot;, text)</code></li>\n<li>去重后输出</li>\n</ol>\n<h3 id=\"练习-4：请求-API-并保存为-JSON\"><a href=\"#练习-4：请求-API-并保存为-JSON\" class=\"headerlink\" title=\"练习 4：请求 API 并保存为 JSON\"></a>练习 4：请求 API 并保存为 JSON</h3><p><strong>思路</strong>：</p>\n<ol>\n<li>用 <code>urllib.request.urlopen()</code> 请求 API</li>\n<li>用 <code>json.loads()</code> 解析响应</li>\n<li>用 <code>json.dump()</code> 保存到文件</li>\n</ol>\n<h3 id=\"练习-5：批量重命名文件（安全练习）\"><a href=\"#练习-5：批量重命名文件（安全练习）\" class=\"headerlink\" title=\"练习 5：批量重命名文件（安全练习）\"></a>练习 5：批量重命名文件（安全练习）</h3><p><strong>思路</strong>：</p>\n<ol>\n<li>先在临时目录创建测试文件</li>\n<li>用 <code>Path.rename()</code> 重命名</li>\n<li>用 <code>try/except</code> 处理文件不存在的情况</li>\n</ol>\n<hr>\n<h2 id=\"九、评估标准\"><a href=\"#九、评估标准\" class=\"headerlink\" title=\"九、评估标准\"></a>九、评估标准</h2><ul>\n<li>✅ 能用 <code>open()</code> 或 <code>pathlib</code> 读写文件</li>\n<li>✅ 能用正则提取日志字段</li>\n<li>✅ 能导出 JSON&#x2F;CSV 格式</li>\n<li>✅ 能用 <code>urllib</code> 发起 HTTP 请求</li>\n<li>✅ 能用 <code>try/except</code> 做错误处理</li>\n<li>✅ 能写出带参数和返回值的函数</li>\n</ul>\n<hr>\n<h2 id=\"十、参考资料\"><a href=\"#十、参考资料\" class=\"headerlink\" title=\"十、参考资料\"></a>十、参考资料</h2><h3 id=\"官方文档\"><a href=\"#官方文档\" class=\"headerlink\" title=\"官方文档\"></a>官方文档</h3><ul>\n<li><a href=\"https://docs.python.org/zh-cn/3/\">Python 官方文档（中文）</a></li>\n<li><a href=\"https://docs.python.org/zh-cn/3/howto/regex.html\">正则表达式 HOWTO</a></li>\n<li><a href=\"https://docs.python.org/zh-cn/3/library/urllib.html\">urllib 官方文档</a></li>\n</ul>\n<h3 id=\"在线工具\"><a href=\"#在线工具\" class=\"headerlink\" title=\"在线工具\"></a>在线工具</h3><ul>\n<li><a href=\"https://regex101.com/\">正则表达式测试</a>（支持 Python 语法）</li>\n<li><a href=\"https://jsonformatter.org/\">JSON 格式化</a></li>\n<li><a href=\"https://httpbin.org/\">httpbin.org</a>（测试 HTTP 请求的沙箱）</li>\n</ul>\n<h3 id=\"推荐阅读\"><a href=\"#推荐阅读\" class=\"headerlink\" title=\"推荐阅读\"></a>推荐阅读</h3><ul>\n<li>《Python Cookbook》（数据处理篇）</li>\n<li>《Automate the Boring Stuff with Python》（自动化任务）</li>\n</ul>\n<hr>\n<h2 id=\"十一、学习成果达成情况（由学习者填写）\"><a href=\"#十一、学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"十一、学习成果达成情况（由学习者填写）\"></a>十一、学习成果达成情况（由学习者填写）</h2><h3 id=\"截图与证据\"><a href=\"#截图与证据\" class=\"headerlink\" title=\"截图与证据\"></a>截图与证据</h3><ul>\n<li><input disabled=\"\" type=\"checkbox\"> demo.log 生成截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 统计结果输出截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> fail.csv 导出截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> GitHub API 请求结果截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 自己写的函数代码</li>\n</ul>\n<h3 id=\"关键代码与输出\"><a href=\"#关键代码与输出\" class=\"headerlink\" title=\"关键代码与输出\"></a>关键代码与输出</h3><p><strong>日志统计结果</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[粘贴你的输出]</span><br></pre></td></tr></table></figure>\n\n<p><strong>GitHub API 响应</strong>：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">[</span>粘贴 JSON 响应<span class=\"punctuation\">]</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"结论与反思\"><a href=\"#结论与反思\" class=\"headerlink\" title=\"结论与反思\"></a>结论与反思</h3><ul>\n<li><p><strong>我今天学会的最有用的技能</strong>：</p>\n</li>\n<li><p><strong>我遇到的错误及解决方法</strong>：</p>\n</li>\n<li><p><strong>我不确定但要查的 1 件事</strong>：</p>\n</li>\n</ul>\n<hr>\n<p><strong>恭喜！你已掌握 Python 脚本的核心技能。明天我们将学习 Nmap 端口扫描，进入实战枚举阶段！</strong> 🎉</p>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day016：操作系统与脚本 - Windows 安全基础","url":"/post/f97e6e0d.html","content":"<h1 id=\"Day016：操作系统与脚本-Windows-安全基础\"><a href=\"#Day016：操作系统与脚本-Windows-安全基础\" class=\"headerlink\" title=\"Day016：操作系统与脚本 - Windows 安全基础\"></a>Day016：操作系统与脚本 - Windows 安全基础</h1><ul>\n<li>日期：2026-01-09</li>\n<li>周次：第 3 周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p>学完今天你应该能做到：</p>\n<ul>\n<li>掌握 Windows 操作系统安全基础，包括 UAC 原理、用户与组管理、事件日志分析、防火墙配置、本地安全策略、端口监听排查</li>\n<li>学会通过 GUI + PowerShell 双工具进行 Windows 安全审计与加固</li>\n<li>能输出一份 15 条的 Windows 加固清单</li>\n</ul>\n<hr>\n<span id=\"more\"></span>\n\n<h2 id=\"一、为什么-Windows-安全是”必修课”？\"><a href=\"#一、为什么-Windows-安全是”必修课”？\" class=\"headerlink\" title=\"一、为什么 Windows 安全是”必修课”？\"></a>一、为什么 Windows 安全是”必修课”？</h2><h3 id=\"1-1-Windows-在安全运营中的地位\"><a href=\"#1-1-Windows-在安全运营中的地位\" class=\"headerlink\" title=\"1.1 Windows 在安全运营中的地位\"></a>1.1 Windows 在安全运营中的地位</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">企业环境占比</span><br><span class=\"line\">├─ 服务器：Windows Server 占 30-40%（AD/IIS/SQL Server）</span><br><span class=\"line\">├─ 办公终端：Windows 10/11 占 70-80%（Office/OA/邮件客户端）</span><br><span class=\"line\">└─ 攻击者视角：域控（DC）是内网攻击的&quot;皇冠明珠&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">攻击链典型路径</span><br><span class=\"line\">1. 钓鱼邮件打开 Excel 宏 → RCE 在用户 PC</span><br><span class=\"line\">2. 获取明文密码/Kerberos 票据 → 横向移动</span><br><span class=\"line\">3. 域管账号劫持 → 控制整个域（GPO/DC）</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-2-学完今天你能做什么？\"><a href=\"#1-2-学完今天你能做什么？\" class=\"headerlink\" title=\"1.2 学完今天你能做什么？\"></a>1.2 学完今天你能做什么？</h3><table>\n<thead>\n<tr>\n<th>能力项</th>\n<th>实战场景</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>识别异常登录</strong></td>\n<td>通过事件 4625（失败登录）发现爆破攻击</td>\n</tr>\n<tr>\n<td><strong>审计管理员组</strong></td>\n<td>发现”不该在管理员组的账号”（内鬼&#x2F;残留）</td>\n</tr>\n<tr>\n<td><strong>排查开放端口</strong></td>\n<td>用 <code>netstat</code>&#x2F;<code>Get-NetTCPConnection</code> 找到可疑监听进程</td>\n</tr>\n<tr>\n<td><strong>配置防火墙规则</strong></td>\n<td>阻断 RDP 对公网暴露、放通必要服务</td>\n</tr>\n<tr>\n<td><strong>制作加固方案</strong></td>\n<td>输出 15 条 Windows 加固清单（账号&#x2F;服务&#x2F;网络&#x2F;审计）</td>\n</tr>\n</tbody></table>\n<hr>\n<h2 id=\"二、核心知识点详解（傻瓜级讲解）\"><a href=\"#二、核心知识点详解（傻瓜级讲解）\" class=\"headerlink\" title=\"二、核心知识点详解（傻瓜级讲解）\"></a>二、核心知识点详解（傻瓜级讲解）</h2><h3 id=\"2-1-用户账户控制（UAC）原理\"><a href=\"#2-1-用户账户控制（UAC）原理\" class=\"headerlink\" title=\"2.1 用户账户控制（UAC）原理\"></a>2.1 用户账户控制（UAC）原理</h3><h4 id=\"2-1-1-什么是-UAC？\"><a href=\"#2-1-1-什么是-UAC？\" class=\"headerlink\" title=\"2.1.1 什么是 UAC？\"></a>2.1.1 什么是 UAC？</h4><p><strong>UAC（User Account Control）</strong> 是 Windows 从 Vista 开始引入的安全机制，目标是：<strong>即使是管理员账号，默认也以普通权限运行程序，需要提升权限时才弹窗确认</strong>。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">传统模式（XP 时代）             UAC 模式（Vista 后）</span><br><span class=\"line\">管理员登录                      管理员登录</span><br><span class=\"line\">↓                               ↓</span><br><span class=\"line\">直接拥有完整权限                 默认获得&quot;过滤的令牌&quot;（Filtered Token）</span><br><span class=\"line\">↓                               ↓</span><br><span class=\"line\">任意程序都可修改系统             需要提权时弹出&quot;UAC 提示框&quot;</span><br><span class=\"line\">↓                               ↓</span><br><span class=\"line\">恶意软件也能静默提权             用户确认后才获得完整权限</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-1-2-UAC-工作流程\"><a href=\"#2-1-2-UAC-工作流程\" class=\"headerlink\" title=\"2.1.2 UAC 工作流程\"></a>2.1.2 UAC 工作流程</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">用户双击&quot;需要管理员权限&quot;的程序（如 regedit）</span><br><span class=\"line\">↓</span><br><span class=\"line\">检查 manifest（是否标记 requireAdministrator）</span><br><span class=\"line\">↓</span><br><span class=\"line\">【是】→ 触发 UAC 提示框（&quot;是否允许此应用更改设备？&quot;）</span><br><span class=\"line\">       ↓</span><br><span class=\"line\">       用户点击&quot;是&quot; → 创建新进程，使用完整令牌（Full Token）</span><br><span class=\"line\">       用户点击&quot;否&quot; → 拒绝运行</span><br><span class=\"line\">↓</span><br><span class=\"line\">【否】→ 直接以普通权限运行（即使是管理员账号）</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-1-3-UAC-的-4-个安全级别\"><a href=\"#2-1-3-UAC-的-4-个安全级别\" class=\"headerlink\" title=\"2.1.3 UAC 的 4 个安全级别\"></a>2.1.3 UAC 的 4 个安全级别</h4><table>\n<thead>\n<tr>\n<th>级别</th>\n<th>行为</th>\n<th>安全性</th>\n<th>适用场景</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>始终通知</strong></td>\n<td>所有程序提权都弹窗，且切换安全桌面</td>\n<td>⭐⭐⭐⭐⭐</td>\n<td>高风险环境（如域控）</td>\n</tr>\n<tr>\n<td><strong>默认</strong></td>\n<td>程序提权弹窗，Windows 设置更改不弹窗</td>\n<td>⭐⭐⭐⭐</td>\n<td>一般办公环境</td>\n</tr>\n<tr>\n<td><strong>仅在应用尝试更改时通知</strong></td>\n<td>不切换安全桌面（可被劫持）</td>\n<td>⭐⭐⭐</td>\n<td>开发测试环境</td>\n</tr>\n<tr>\n<td><strong>从不通知</strong></td>\n<td>完全关闭 UAC</td>\n<td>⚠️ 极不推荐</td>\n<td>仅用于兼容老旧软件</td>\n</tr>\n</tbody></table>\n<p><strong>安全桌面（Secure Desktop）</strong>：UAC 弹窗时屏幕变暗，此时只有系统进程可绘制界面，防止木马伪造确认按钮。</p>\n<h4 id=\"2-1-4-查看当前-UAC-状态\"><a href=\"#2-1-4-查看当前-UAC-状态\" class=\"headerlink\" title=\"2.1.4 查看当前 UAC 状态\"></a>2.1.4 查看当前 UAC 状态</h4><p><strong>方法 1：GUI</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">控制面板 → 用户账户 → 更改用户账户控制设置</span><br><span class=\"line\">拖动滑块查看当前级别</span><br></pre></td></tr></table></figure>\n\n<p><strong>方法 2：PowerShell</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查询 UAC 启用状态</span></span><br><span class=\"line\"><span class=\"built_in\">Get-ItemProperty</span> <span class=\"literal\">-Path</span> <span class=\"string\">&quot;HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System&quot;</span> <span class=\"literal\">-Name</span> <span class=\"string\">&quot;EnableLUA&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 返回值：</span></span><br><span class=\"line\"><span class=\"comment\"># 1 = UAC 已启用</span></span><br><span class=\"line\"><span class=\"comment\"># 0 = UAC 已禁用</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>方法 3：命令行提权测试</strong></p>\n<figure class=\"highlight cmd\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 测试当前 Shell 是否有管理员权限</span><br><span class=\"line\">whoami /groups | <span class=\"built_in\">findstr</span> &quot;High Mandatory Level&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># 如果有输出 → 当前是高权限 Shell</span><br><span class=\"line\"># 如果无输出 → 当前是普通权限 Shell</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2-2-用户与组管理（本地账户）\"><a href=\"#2-2-用户与组管理（本地账户）\" class=\"headerlink\" title=\"2.2 用户与组管理（本地账户）\"></a>2.2 用户与组管理（本地账户）</h3><h4 id=\"2-2-1-常见本地用户组\"><a href=\"#2-2-1-常见本地用户组\" class=\"headerlink\" title=\"2.2.1 常见本地用户组\"></a>2.2.1 常见本地用户组</h4><table>\n<thead>\n<tr>\n<th>组名</th>\n<th>权限</th>\n<th>典型用途</th>\n<th>安全要点</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Administrators</strong></td>\n<td>完整系统控制</td>\n<td>IT 管理员</td>\n<td>⚠️ 应最小化成员数量</td>\n</tr>\n<tr>\n<td><strong>Users</strong></td>\n<td>运行程序、访问自己的文件</td>\n<td>普通员工</td>\n<td>✅ 日常办公应使用此组</td>\n</tr>\n<tr>\n<td><strong>Remote Desktop Users</strong></td>\n<td>允许 RDP 登录</td>\n<td>远程运维人员</td>\n<td>⚠️ 需配合强密码+MFA</td>\n</tr>\n<tr>\n<td><strong>Guests</strong></td>\n<td>临时访问，权限极低</td>\n<td>访客账号</td>\n<td>⚠️ 应禁用（默认禁用）</td>\n</tr>\n<tr>\n<td><strong>Backup Operators</strong></td>\n<td>可备份&#x2F;还原任意文件</td>\n<td>备份系统管理员</td>\n<td>⚠️ 可能绕过文件权限</td>\n</tr>\n</tbody></table>\n<h4 id=\"2-2-2-管理员组审计实战\"><a href=\"#2-2-2-管理员组审计实战\" class=\"headerlink\" title=\"2.2.2 管理员组审计实战\"></a>2.2.2 管理员组审计实战</h4><p><strong>任务：列出所有管理员组成员，识别异常账号</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 方法 1：PowerShell（推荐）</span></span><br><span class=\"line\"><span class=\"built_in\">Get-LocalGroupMember</span> <span class=\"literal\">-Group</span> <span class=\"string\">&quot;Administrators&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 输出示例：</span></span><br><span class=\"line\"><span class=\"comment\"># Name                           PrincipalSource</span></span><br><span class=\"line\"><span class=\"comment\"># ----                           ---------------</span></span><br><span class=\"line\"><span class=\"comment\"># PC01\\Administrator             Local</span></span><br><span class=\"line\"><span class=\"comment\"># PC01\\alice                     Local</span></span><br><span class=\"line\"><span class=\"comment\"># AzureAD\\bob@company.com        Azure Active Directory</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方法 2：命令行</span></span><br><span class=\"line\">net localgroup Administrators</span><br></pre></td></tr></table></figure>\n\n<p><strong>安全检查清单</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 是否存在”未知账号”（离职员工&#x2F;外包人员）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 是否有”不该有管理员权限的账号”（如前台&#x2F;访客）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 是否有”命名异常”的账号（如 <code>admin123</code>、<code>temp_admin</code>）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 是否有”域账号”在本地管理员组（检查域策略是否符合预期）</li>\n</ul>\n<h4 id=\"2-2-3-创建”安全的本地管理员账号”\"><a href=\"#2-2-3-创建”安全的本地管理员账号”\" class=\"headerlink\" title=\"2.2.3 创建”安全的本地管理员账号”\"></a>2.2.3 创建”安全的本地管理员账号”</h4><p><strong>场景</strong>：需要临时授予 IT 外包人员管理员权限，合同到期后收回。</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. 创建本地用户</span></span><br><span class=\"line\"><span class=\"variable\">$Password</span> = <span class=\"built_in\">ConvertTo-SecureString</span> <span class=\"string\">&quot;P@ssw0rd!2024&quot;</span> <span class=\"literal\">-AsPlainText</span> <span class=\"literal\">-Force</span></span><br><span class=\"line\"><span class=\"built_in\">New-LocalUser</span> <span class=\"literal\">-Name</span> <span class=\"string\">&quot;ITSupport01&quot;</span> <span class=\"literal\">-Password</span> <span class=\"variable\">$Password</span> <span class=\"literal\">-Description</span> <span class=\"string\">&quot;Temporary admin for contractor&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. 添加到管理员组</span></span><br><span class=\"line\"><span class=\"built_in\">Add-LocalGroupMember</span> <span class=\"literal\">-Group</span> <span class=\"string\">&quot;Administrators&quot;</span> <span class=\"literal\">-Member</span> <span class=\"string\">&quot;ITSupport01&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. 设置密码策略</span></span><br><span class=\"line\"><span class=\"comment\"># 强制下次登录修改密码</span></span><br><span class=\"line\"><span class=\"built_in\">Set-LocalUser</span> <span class=\"literal\">-Name</span> <span class=\"string\">&quot;ITSupport01&quot;</span> <span class=\"literal\">-PasswordNeverExpires</span> <span class=\"variable\">$false</span> <span class=\"literal\">-UserMayChangePassword</span> <span class=\"variable\">$true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4. 合同到期后移除</span></span><br><span class=\"line\"><span class=\"built_in\">Remove-LocalGroupMember</span> <span class=\"literal\">-Group</span> <span class=\"string\">&quot;Administrators&quot;</span> <span class=\"literal\">-Member</span> <span class=\"string\">&quot;ITSupport01&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">Remove-LocalUser</span> <span class=\"literal\">-Name</span> <span class=\"string\">&quot;ITSupport01&quot;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2-3-Windows-事件日志（安全审计的”黑匣子”）\"><a href=\"#2-3-Windows-事件日志（安全审计的”黑匣子”）\" class=\"headerlink\" title=\"2.3 Windows 事件日志（安全审计的”黑匣子”）\"></a>2.3 Windows 事件日志（安全审计的”黑匣子”）</h3><h4 id=\"2-3-1-事件日志分类\"><a href=\"#2-3-1-事件日志分类\" class=\"headerlink\" title=\"2.3.1 事件日志分类\"></a>2.3.1 事件日志分类</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Windows 日志</span><br><span class=\"line\">├─ Security（安全日志）← 最重要！记录登录/提权/访问控制</span><br><span class=\"line\">├─ System（系统日志）  ← 记录服务启动/停止、驱动加载</span><br><span class=\"line\">├─ Application（应用日志）← 记录程序错误/崩溃</span><br><span class=\"line\">└─ Setup（安装日志）   ← 记录补丁安装/系统更新</span><br><span class=\"line\"></span><br><span class=\"line\">应用程序和服务日志</span><br><span class=\"line\">└─ Microsoft-Windows-Sysmon/Operational ← Sysmon 日志（需单独安装）</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-3-2-关键安全事件-ID-详解\"><a href=\"#2-3-2-关键安全事件-ID-详解\" class=\"headerlink\" title=\"2.3.2 关键安全事件 ID 详解\"></a>2.3.2 关键安全事件 ID 详解</h4><table>\n<thead>\n<tr>\n<th>事件 ID</th>\n<th>含义</th>\n<th>威胁指示</th>\n<th>查看方法</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>4624</strong></td>\n<td>登录成功</td>\n<td>登录类型 10&#x3D;RDP，3&#x3D;网络，2&#x3D;交互式</td>\n<td>筛选 <code>Logon Type</code> 字段</td>\n</tr>\n<tr>\n<td><strong>4625</strong></td>\n<td>登录失败</td>\n<td>短时间内大量 4625 → 密码爆破</td>\n<td>统计失败次数 Top 5</td>\n</tr>\n<tr>\n<td><strong>4672</strong></td>\n<td>特殊权限登录</td>\n<td>管理员&#x2F;域管账号登录</td>\n<td>审计”不该有管理员权限的人”</td>\n</tr>\n<tr>\n<td><strong>4648</strong></td>\n<td>使用显式凭据登录</td>\n<td><code>runas</code> 或 <code>psexec</code>（横向移动）</td>\n<td>审计”非管理员使用他人凭据”</td>\n</tr>\n<tr>\n<td><strong>4688</strong></td>\n<td>进程创建</td>\n<td>可疑进程（如 <code>mimikatz.exe</code>）</td>\n<td>需启用”进程创建审计”</td>\n</tr>\n<tr>\n<td><strong>4720</strong></td>\n<td>创建用户账户</td>\n<td>后门账户创建</td>\n<td>审计”非预期的账户创建”</td>\n</tr>\n<tr>\n<td><strong>7045</strong></td>\n<td>安装系统服务</td>\n<td>恶意软件注册服务（如勒索软件）</td>\n<td>在 System 日志中查看</td>\n</tr>\n</tbody></table>\n<h4 id=\"2-3-3-事件-4624-详细解读（登录成功）\"><a href=\"#2-3-3-事件-4624-详细解读（登录成功）\" class=\"headerlink\" title=\"2.3.3 事件 4624 详细解读（登录成功）\"></a>2.3.3 事件 4624 详细解读（登录成功）</h4><p><strong>示例事件</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">事件 ID: 4624</span><br><span class=\"line\">任务类别: 登录</span><br><span class=\"line\">关键字: 审核成功</span><br><span class=\"line\">主题:</span><br><span class=\"line\">  安全 ID: S-1-5-21-xxx（谁登录）</span><br><span class=\"line\">  账户名: alice</span><br><span class=\"line\">登录类型: 10（RDP）</span><br><span class=\"line\">新登录:</span><br><span class=\"line\">  安全 ID: S-1-5-21-xxx</span><br><span class=\"line\">  账户名: alice</span><br><span class=\"line\">  登录 GUID: &#123;xxx&#125;</span><br><span class=\"line\">进程信息:</span><br><span class=\"line\">  进程 ID: 0x1234</span><br><span class=\"line\">  进程名: C:\\Windows\\System32\\winlogon.exe</span><br><span class=\"line\">网络信息:</span><br><span class=\"line\">  工作站名: DESKTOP-ABC</span><br><span class=\"line\">  源网络地址: 192.168.1.100</span><br><span class=\"line\">  源端口: 54321</span><br></pre></td></tr></table></figure>\n\n<p><strong>登录类型（Logon Type）对照表</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>含义</th>\n<th>典型场景</th>\n<th>安全关注点</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>2</strong></td>\n<td>交互式登录</td>\n<td>本地键盘登录、Ctrl+Alt+Del</td>\n<td>正常物理访问</td>\n</tr>\n<tr>\n<td><strong>3</strong></td>\n<td>网络登录</td>\n<td>访问共享文件夹（\\server\\share）</td>\n<td>可能是横向移动</td>\n</tr>\n<tr>\n<td><strong>4</strong></td>\n<td>批处理</td>\n<td>计划任务运行</td>\n<td>持久化后门常用</td>\n</tr>\n<tr>\n<td><strong>5</strong></td>\n<td>服务登录</td>\n<td>Windows 服务启动</td>\n<td>正常，除非服务名可疑</td>\n</tr>\n<tr>\n<td><strong>7</strong></td>\n<td>解锁</td>\n<td>屏保解锁</td>\n<td>正常</td>\n</tr>\n<tr>\n<td><strong>8</strong></td>\n<td>网络明文</td>\n<td>IIS 基本认证</td>\n<td>⚠️ 密码明文传输</td>\n</tr>\n<tr>\n<td><strong>10</strong></td>\n<td>远程交互式（RDP）</td>\n<td>远程桌面登录</td>\n<td>⚠️ 需审计源 IP</td>\n</tr>\n<tr>\n<td><strong>11</strong></td>\n<td>缓存交互式</td>\n<td>域账号离线登录（使用缓存凭据）</td>\n<td>可能在域控不可达时</td>\n</tr>\n</tbody></table>\n<h4 id=\"2-3-4-实战：查找”可疑的-RDP-登录”\"><a href=\"#2-3-4-实战：查找”可疑的-RDP-登录”\" class=\"headerlink\" title=\"2.3.4 实战：查找”可疑的 RDP 登录”\"></a>2.3.4 实战：查找”可疑的 RDP 登录”</h4><p><strong>场景</strong>：排查是否有未授权的远程桌面登录（事件 4624，登录类型 10）。</p>\n<p><strong>方法 1：GUI（事件查看器）</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">1. Win+R → eventvwr.msc</span><br><span class=\"line\">2. Windows 日志 → 安全</span><br><span class=\"line\">3. 右侧&quot;筛选当前日志&quot; → 事件 ID 输入 4624</span><br><span class=\"line\">4. 创建自定义视图 → XML 编辑：</span><br><span class=\"line\">   &lt;QueryList&gt;</span><br><span class=\"line\">     &lt;Query Id=&quot;0&quot; Path=&quot;Security&quot;&gt;</span><br><span class=\"line\">       &lt;Select Path=&quot;Security&quot;&gt;</span><br><span class=\"line\">         *[System[(EventID=4624)]]</span><br><span class=\"line\">         and</span><br><span class=\"line\">         *[EventData[Data[@Name=&#x27;LogonType&#x27;]=&#x27;10&#x27;]]</span><br><span class=\"line\">       &lt;/Select&gt;</span><br><span class=\"line\">     &lt;/Query&gt;</span><br><span class=\"line\">   &lt;/QueryList&gt;</span><br><span class=\"line\">5. 查看&quot;源网络地址&quot;字段，检查是否有外网 IP</span><br></pre></td></tr></table></figure>\n\n<p><strong>方法 2：PowerShell（批量导出分析）</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 导出最近 24 小时的 RDP 登录事件</span></span><br><span class=\"line\"><span class=\"built_in\">Get-WinEvent</span> <span class=\"literal\">-FilterHashtable</span> <span class=\"selector-tag\">@</span>&#123;</span><br><span class=\"line\">    LogName=<span class=\"string\">&#x27;Security&#x27;</span></span><br><span class=\"line\">    ID=<span class=\"number\">4624</span></span><br><span class=\"line\">    StartTime=(<span class=\"built_in\">Get-Date</span>).AddDays(<span class=\"literal\">-1</span>)</span><br><span class=\"line\">&#125; | <span class=\"built_in\">Where-Object</span> &#123;</span><br><span class=\"line\">    <span class=\"variable\">$_</span>.Properties[<span class=\"number\">8</span>].Value <span class=\"operator\">-eq</span> <span class=\"number\">10</span>  <span class=\"comment\"># 登录类型=10（RDP）</span></span><br><span class=\"line\">&#125; | <span class=\"built_in\">Select-Object</span> TimeCreated,</span><br><span class=\"line\">    <span class=\"selector-tag\">@</span>&#123;Name=<span class=\"string\">&quot;User&quot;</span>;Expression=&#123;<span class=\"variable\">$_</span>.Properties[<span class=\"number\">5</span>].Value&#125;&#125;,</span><br><span class=\"line\">    <span class=\"selector-tag\">@</span>&#123;Name=<span class=\"string\">&quot;SourceIP&quot;</span>;Expression=&#123;<span class=\"variable\">$_</span>.Properties[<span class=\"number\">18</span>].Value&#125;&#125;,</span><br><span class=\"line\">    <span class=\"selector-tag\">@</span>&#123;Name=<span class=\"string\">&quot;LogonType&quot;</span>;Expression=&#123;<span class=\"variable\">$_</span>.Properties[<span class=\"number\">8</span>].Value&#125;&#125; |</span><br><span class=\"line\"><span class=\"built_in\">Format-Table</span> <span class=\"literal\">-AutoSize</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>分析要点</strong>：</p>\n<ul>\n<li>✅ <strong>正常</strong>：内网 IP（192.168.x.x &#x2F; 10.x.x.x）+ 已知运维人员账号</li>\n<li>⚠️ <strong>可疑</strong>：公网 IP + 非运维时间段（如凌晨 3 点）</li>\n<li>🚨 <strong>高危</strong>：异常地理位置（如来自国外 IP）+ 管理员账号</li>\n</ul>\n<h4 id=\"2-3-5-实战-统计”密码爆破攻击”（事件-4625）\"><a href=\"#2-3-5-实战-统计”密码爆破攻击”（事件-4625）\" class=\"headerlink\" title=\"2.3.5 实战:统计”密码爆破攻击”（事件 4625）\"></a>2.3.5 实战:统计”密码爆破攻击”（事件 4625）</h4><p><strong>场景</strong>：检测短时间内大量登录失败（暴力破解 RDP）。</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 统计最近 1 小时失败登录的 Top 5 账户</span></span><br><span class=\"line\"><span class=\"built_in\">Get-WinEvent</span> <span class=\"literal\">-FilterHashtable</span> <span class=\"selector-tag\">@</span>&#123;</span><br><span class=\"line\">    LogName=<span class=\"string\">&#x27;Security&#x27;</span></span><br><span class=\"line\">    ID=<span class=\"number\">4625</span></span><br><span class=\"line\">    StartTime=(<span class=\"built_in\">Get-Date</span>).AddHours(<span class=\"literal\">-1</span>)</span><br><span class=\"line\">&#125; | <span class=\"built_in\">Select-Object</span> <span class=\"selector-tag\">@</span>&#123;</span><br><span class=\"line\">    Name=<span class=\"string\">&quot;User&quot;</span></span><br><span class=\"line\">    Expression=&#123;<span class=\"variable\">$_</span>.Properties[<span class=\"number\">5</span>].Value&#125;</span><br><span class=\"line\">&#125; | <span class=\"built_in\">Group-Object</span> User |</span><br><span class=\"line\"><span class=\"built_in\">Sort-Object</span> Count <span class=\"literal\">-Descending</span> |</span><br><span class=\"line\"><span class=\"built_in\">Select-Object</span> <span class=\"literal\">-First</span> <span class=\"number\">5</span> Name, Count</span><br></pre></td></tr></table></figure>\n\n<p><strong>输出示例</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Name          Count</span><br><span class=\"line\">----          -----</span><br><span class=\"line\">Administrator   127</span><br><span class=\"line\">admin            89</span><br><span class=\"line\">root             56</span><br><span class=\"line\">test             34</span><br><span class=\"line\">backup           23</span><br></pre></td></tr></table></figure>\n\n<p><strong>判断标准</strong>：</p>\n<ul>\n<li>🚨 <strong>单账号 &gt; 50 次失败</strong>：高度疑似爆破</li>\n<li>⚠️ <strong>多账号均失败 10+ 次</strong>：可能在字典攻击</li>\n<li>✅ <strong>少量失败</strong>：可能是用户忘记密码</li>\n</ul>\n<p><strong>防御措施</strong>：</p>\n<ol>\n<li>启用账户锁定策略（5 次失败锁定 30 分钟）</li>\n<li>使用防火墙限制 RDP（3389）仅对内网开放</li>\n<li>启用 MFA（多因素认证）</li>\n</ol>\n<hr>\n<h3 id=\"2-4-Windows-防火墙配置\"><a href=\"#2-4-Windows-防火墙配置\" class=\"headerlink\" title=\"2.4 Windows 防火墙配置\"></a>2.4 Windows 防火墙配置</h3><h4 id=\"2-4-1-防火墙工作模式\"><a href=\"#2-4-1-防火墙工作模式\" class=\"headerlink\" title=\"2.4.1 防火墙工作模式\"></a>2.4.1 防火墙工作模式</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Windows Defender 防火墙配置文件</span><br><span class=\"line\">├─ 域配置文件（Domain Profile）</span><br><span class=\"line\">│   └─ 适用于：主机加入域，且域控可达</span><br><span class=\"line\">├─ 专用配置文件（Private Profile）</span><br><span class=\"line\">│   └─ 适用于：家庭/公司网络（可信）</span><br><span class=\"line\">└─ 公用配置文件（Public Profile）</span><br><span class=\"line\">    └─ 适用于：机场/咖啡厅 Wi-Fi（不可信）</span><br><span class=\"line\"></span><br><span class=\"line\">默认策略</span><br><span class=\"line\">├─ 入站：拒绝（除非明确放通）</span><br><span class=\"line\">├─ 出站：允许（所有流量）</span><br><span class=\"line\">└─ 推荐：保持此默认配置！</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-4-2-常用防火墙命令\"><a href=\"#2-4-2-常用防火墙命令\" class=\"headerlink\" title=\"2.4.2 常用防火墙命令\"></a>2.4.2 常用防火墙命令</h4><p><strong>查看当前防火墙状态</strong>：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 方法 1：PowerShell</span></span><br><span class=\"line\"><span class=\"built_in\">Get-NetFirewallProfile</span> | <span class=\"built_in\">Select-Object</span> Name, Enabled</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方法 2：命令行</span></span><br><span class=\"line\">netsh advfirewall show allprofiles</span><br></pre></td></tr></table></figure>\n\n<p><strong>查看所有入站规则</strong>：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 列出所有&quot;允许&quot;的入站规则</span></span><br><span class=\"line\"><span class=\"built_in\">Get-NetFirewallRule</span> <span class=\"literal\">-Direction</span> Inbound <span class=\"literal\">-Enabled</span> True <span class=\"literal\">-Action</span> Allow |</span><br><span class=\"line\"><span class=\"built_in\">Select-Object</span> DisplayName, Profile, LocalPort, RemoteAddress |</span><br><span class=\"line\"><span class=\"built_in\">Format-Table</span> <span class=\"literal\">-AutoSize</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>创建规则：允许特定程序</strong>：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 场景：允许 Python Web 服务（Flask）监听 5000 端口</span></span><br><span class=\"line\"><span class=\"built_in\">New-NetFirewallRule</span> <span class=\"literal\">-DisplayName</span> <span class=\"string\">&quot;Allow Flask App&quot;</span> `</span><br><span class=\"line\">    <span class=\"literal\">-Direction</span> Inbound `</span><br><span class=\"line\">    <span class=\"literal\">-Protocol</span> TCP `</span><br><span class=\"line\">    <span class=\"literal\">-LocalPort</span> <span class=\"number\">5000</span> `</span><br><span class=\"line\">    <span class=\"literal\">-Action</span> Allow `</span><br><span class=\"line\">    <span class=\"literal\">-Profile</span> Private</span><br></pre></td></tr></table></figure>\n\n<p><strong>删除规则</strong>：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Remove-NetFirewallRule</span> <span class=\"literal\">-DisplayName</span> <span class=\"string\">&quot;Allow Flask App&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>阻断特定 IP</strong>：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 场景：阻断可疑 IP 的所有流量</span></span><br><span class=\"line\"><span class=\"built_in\">New-NetFirewallRule</span> <span class=\"literal\">-DisplayName</span> <span class=\"string\">&quot;Block Attacker IP&quot;</span> `</span><br><span class=\"line\">    <span class=\"literal\">-Direction</span> Inbound `</span><br><span class=\"line\">    <span class=\"literal\">-RemoteAddress</span> <span class=\"number\">1.2</span>.<span class=\"number\">3.4</span> `</span><br><span class=\"line\">    <span class=\"literal\">-Action</span> Block</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-4-3-常见安全配置错误\"><a href=\"#2-4-3-常见安全配置错误\" class=\"headerlink\" title=\"2.4.3 常见安全配置错误\"></a>2.4.3 常见安全配置错误</h4><table>\n<thead>\n<tr>\n<th>错误配置</th>\n<th>风险</th>\n<th>正确做法</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>关闭防火墙</strong></td>\n<td>所有端口暴露</td>\n<td>保持开启，按需放通</td>\n</tr>\n<tr>\n<td><strong>RDP（3389）对公网开放</strong></td>\n<td>成为暴力破解目标</td>\n<td>仅允许 VPN&#x2F;堡垒机 IP</td>\n</tr>\n<tr>\n<td><strong>允许”所有配置文件”</strong></td>\n<td>公共 Wi-Fi 也放通</td>\n<td>仅允许”域+专用”</td>\n</tr>\n<tr>\n<td><strong>出站规则”全部允许”</strong></td>\n<td>木马可联网下载工具</td>\n<td>高敏感环境考虑白名单</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"2-5-本地安全策略（Local-Security-Policy）\"><a href=\"#2-5-本地安全策略（Local-Security-Policy）\" class=\"headerlink\" title=\"2.5 本地安全策略（Local Security Policy）\"></a>2.5 本地安全策略（Local Security Policy）</h3><h4 id=\"2-5-1-访问本地安全策略\"><a href=\"#2-5-1-访问本地安全策略\" class=\"headerlink\" title=\"2.5.1 访问本地安全策略\"></a>2.5.1 访问本地安全策略</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">方法 1：Win+R → secpol.msc（本地安全策略）</span><br><span class=\"line\">方法 2：gpedit.msc（本地组策略编辑器）→ 计算机配置 → Windows 设置 → 安全设置</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-5-2-关键策略配置\"><a href=\"#2-5-2-关键策略配置\" class=\"headerlink\" title=\"2.5.2 关键策略配置\"></a>2.5.2 关键策略配置</h4><p><strong>账户策略</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>策略</th>\n<th>推荐值</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>密码最短长度</strong></td>\n<td>12 位</td>\n<td>防止弱密码</td>\n</tr>\n<tr>\n<td><strong>密码复杂性要求</strong></td>\n<td>已启用</td>\n<td>必须包含大小写+数字+特殊字符</td>\n</tr>\n<tr>\n<td><strong>密码最长使用期限</strong></td>\n<td>90 天</td>\n<td>定期更换（争议项）</td>\n</tr>\n<tr>\n<td><strong>强制密码历史</strong></td>\n<td>记住 24 个</td>\n<td>防止重复使用旧密码</td>\n</tr>\n<tr>\n<td><strong>账户锁定阈值</strong></td>\n<td>5 次</td>\n<td>失败 5 次后锁定</td>\n</tr>\n<tr>\n<td><strong>账户锁定时间</strong></td>\n<td>30 分钟</td>\n<td>锁定后自动解锁时间</td>\n</tr>\n</tbody></table>\n<p><strong>审核策略</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>策略</th>\n<th>推荐值</th>\n<th>审计内容</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>审核登录事件</strong></td>\n<td>成功和失败</td>\n<td>记录 4624&#x2F;4625</td>\n</tr>\n<tr>\n<td><strong>审核账户管理</strong></td>\n<td>成功和失败</td>\n<td>记录账户创建&#x2F;删除（4720&#x2F;4726）</td>\n</tr>\n<tr>\n<td><strong>审核进程跟踪</strong></td>\n<td>成功</td>\n<td>记录进程创建（4688）</td>\n</tr>\n<tr>\n<td><strong>审核特权使用</strong></td>\n<td>成功</td>\n<td>记录管理员提权（4672）</td>\n</tr>\n</tbody></table>\n<p><strong>配置方法（PowerShell）</strong>：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 启用进程创建审计（4688）</span></span><br><span class=\"line\">auditpol /<span class=\"built_in\">set</span> /subcategory:<span class=\"string\">&quot;Process Creation&quot;</span> /success:enable</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看当前审计策略</span></span><br><span class=\"line\">auditpol /get /category:*</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2-6-监听端口排查\"><a href=\"#2-6-监听端口排查\" class=\"headerlink\" title=\"2.6 监听端口排查\"></a>2.6 监听端口排查</h3><h4 id=\"2-6-1-查看监听端口的-3-种方法\"><a href=\"#2-6-1-查看监听端口的-3-种方法\" class=\"headerlink\" title=\"2.6.1 查看监听端口的 3 种方法\"></a>2.6.1 查看监听端口的 3 种方法</h4><p><strong>方法 1：netstat（传统命令）</strong></p>\n<figure class=\"highlight cmd\"><table><tr><td class=\"code\"><pre><span class=\"line\">netstat -ano | <span class=\"built_in\">findstr</span> LISTENING</span><br></pre></td></tr></table></figure>\n\n<p><strong>输出示例</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">TCP    0.0.0.0:135      0.0.0.0:0     LISTENING       912</span><br><span class=\"line\">TCP    0.0.0.0:445      0.0.0.0:0     LISTENING       4</span><br><span class=\"line\">TCP    0.0.0.0:3389     0.0.0.0:0     LISTENING       1024</span><br></pre></td></tr></table></figure>\n\n<p><strong>字段解释</strong>：</p>\n<ul>\n<li><code>0.0.0.0:135</code> → 监听所有网卡的 135 端口</li>\n<li><code>LISTENING</code> → 当前正在监听</li>\n<li><code>912</code> → 进程 PID</li>\n</ul>\n<p><strong>方法 2：PowerShell（推荐）</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Get-NetTCPConnection</span> <span class=\"literal\">-State</span> Listen |</span><br><span class=\"line\"><span class=\"built_in\">Select-Object</span> LocalAddress, LocalPort,</span><br><span class=\"line\">    <span class=\"selector-tag\">@</span>&#123;Name=<span class=\"string\">&quot;Process&quot;</span>;Expression=&#123;(<span class=\"built_in\">Get-Process</span> <span class=\"literal\">-Id</span> <span class=\"variable\">$_</span>.OwningProcess).ProcessName&#125;&#125; |</span><br><span class=\"line\"><span class=\"built_in\">Format-Table</span> <span class=\"literal\">-AutoSize</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>输出示例</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">LocalAddress LocalPort Process</span><br><span class=\"line\">------------ --------- -------</span><br><span class=\"line\">0.0.0.0      135       svchost</span><br><span class=\"line\">0.0.0.0      445       System</span><br><span class=\"line\">0.0.0.0      3389      TermService</span><br></pre></td></tr></table></figure>\n\n<p><strong>方法 3：使用 Sysinternals TCPView（GUI 工具）</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">下载：https://learn.microsoft.com/en-us/sysinternals/downloads/tcpview</span><br><span class=\"line\">功能：实时显示所有 TCP/UDP 连接，颜色标识新建/关闭连接</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-6-2-常见端口风险评估表\"><a href=\"#2-6-2-常见端口风险评估表\" class=\"headerlink\" title=\"2.6.2 常见端口风险评估表\"></a>2.6.2 常见端口风险评估表</h4><table>\n<thead>\n<tr>\n<th>端口</th>\n<th>服务</th>\n<th>用途</th>\n<th>风险等级</th>\n<th>建议</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>135</strong></td>\n<td>RPC</td>\n<td>Windows 远程过程调用</td>\n<td>⚠️ 中</td>\n<td>仅内网开放</td>\n</tr>\n<tr>\n<td><strong>139&#x2F;445</strong></td>\n<td>SMB</td>\n<td>文件共享</td>\n<td>🚨 高</td>\n<td>仅内网开放，禁止公网访问</td>\n</tr>\n<tr>\n<td><strong>3389</strong></td>\n<td>RDP</td>\n<td>远程桌面</td>\n<td>🚨 高</td>\n<td>仅通过 VPN 访问</td>\n</tr>\n<tr>\n<td><strong>5985&#x2F;5986</strong></td>\n<td>WinRM</td>\n<td>PowerShell 远程管理</td>\n<td>⚠️ 中</td>\n<td>仅管理员网段开放</td>\n</tr>\n<tr>\n<td><strong>80&#x2F;443</strong></td>\n<td>HTTP&#x2F;HTTPS</td>\n<td>Web 服务</td>\n<td>✅ 低</td>\n<td>确认是否需要对外暴露</td>\n</tr>\n<tr>\n<td><strong>1433</strong></td>\n<td>MSSQL</td>\n<td>SQL Server</td>\n<td>⚠️ 中</td>\n<td>禁止直接暴露，使用跳板机</td>\n</tr>\n<tr>\n<td><strong>3306</strong></td>\n<td>MySQL</td>\n<td>数据库</td>\n<td>⚠️ 中</td>\n<td>同上</td>\n</tr>\n<tr>\n<td><strong>22</strong></td>\n<td>SSH</td>\n<td>Linux 远程管理</td>\n<td>⚠️ 中</td>\n<td>需强密码+密钥认证</td>\n</tr>\n</tbody></table>\n<h4 id=\"2-6-3-实战：排查”不该监听的端口”\"><a href=\"#2-6-3-实战：排查”不该监听的端口”\" class=\"headerlink\" title=\"2.6.3 实战：排查”不该监听的端口”\"></a>2.6.3 实战：排查”不该监听的端口”</h4><p><strong>场景</strong>：发现主机监听了意外的高端口（如 4444、5555），怀疑是木马。</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. 找到可疑端口的进程</span></span><br><span class=\"line\"><span class=\"built_in\">Get-NetTCPConnection</span> <span class=\"literal\">-LocalPort</span> <span class=\"number\">4444</span> |</span><br><span class=\"line\"><span class=\"built_in\">Select-Object</span> State, OwningProcess,</span><br><span class=\"line\">    <span class=\"selector-tag\">@</span>&#123;Name=<span class=\"string\">&quot;Process&quot;</span>;Expression=&#123;(<span class=\"built_in\">Get-Process</span> <span class=\"literal\">-Id</span> <span class=\"variable\">$_</span>.OwningProcess).Path&#125;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 输出示例：</span></span><br><span class=\"line\"><span class=\"comment\"># State      : Listen</span></span><br><span class=\"line\"><span class=\"comment\"># OwningProcess : 3456</span></span><br><span class=\"line\"><span class=\"comment\"># Process    : C:\\Users\\alice\\AppData\\Roaming\\svchost.exe  ← 可疑！</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. 查看进程详细信息</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Process</span> <span class=\"literal\">-Id</span> <span class=\"number\">3456</span> | <span class=\"built_in\">Select-Object</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. 查看进程签名（判断是否为合法程序）</span></span><br><span class=\"line\"><span class=\"built_in\">Get-AuthenticodeSignature</span> <span class=\"string\">&quot;C:\\Users\\alice\\AppData\\Roaming\\svchost.exe&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 如果返回 NotSigned → 高度可疑</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>判断恶意进程的技巧</strong>：</p>\n<ul>\n<li>✅ <strong>合法进程</strong>：位于 <code>C:\\Windows\\System32\\</code>，有微软数字签名</li>\n<li>⚠️ <strong>可疑进程</strong>：位于用户目录（<code>AppData</code>）、临时目录（<code>Temp</code>）</li>\n<li>🚨 <strong>恶意进程</strong>：伪装成系统进程名（如 <code>svchost.exe</code> 但不在 System32）</li>\n</ul>\n<hr>\n<h2 id=\"三、实践任务（手把手操作）\"><a href=\"#三、实践任务（手把手操作）\" class=\"headerlink\" title=\"三、实践任务（手把手操作）\"></a>三、实践任务（手把手操作）</h2><h3 id=\"任务-1：审计本地管理员组成员\"><a href=\"#任务-1：审计本地管理员组成员\" class=\"headerlink\" title=\"任务 1：审计本地管理员组成员\"></a>任务 1：审计本地管理员组成员</h3><p><strong>目标</strong>：列出所有管理员组成员，识别不合规账号。</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 执行命令</span></span><br><span class=\"line\"><span class=\"built_in\">Get-LocalGroupMember</span> <span class=\"literal\">-Group</span> <span class=\"string\">&quot;Administrators&quot;</span> |</span><br><span class=\"line\"><span class=\"built_in\">Select-Object</span> Name, PrincipalSource, ObjectClass</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 输出示例：</span></span><br><span class=\"line\"><span class=\"comment\"># Name                          PrincipalSource ObjectClass</span></span><br><span class=\"line\"><span class=\"comment\"># ----                          --------------- -----------</span></span><br><span class=\"line\"><span class=\"comment\"># PC01\\Administrator            Local           User</span></span><br><span class=\"line\"><span class=\"comment\"># PC01\\alice                    Local           User</span></span><br><span class=\"line\"><span class=\"comment\"># AzureAD\\ITAdmin@company.com   AzureActiveDirectory User</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>检查清单</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 是否有”离职员工”残留账号</li>\n<li><input disabled=\"\" type=\"checkbox\"> 是否有”临时账号”未删除（如 <code>temp_admin</code>）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 是否有”非 IT 人员”在管理员组</li>\n<li><input disabled=\"\" type=\"checkbox\"> 域账号是否符合组策略要求</li>\n</ul>\n<p><strong>输出结果</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[你的截图/输出粘贴到这里]</span><br><span class=\"line\"></span><br><span class=\"line\">发现的问题：</span><br><span class=\"line\">-</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-2：导出最近-24-小时的登录事件（4624-x2F-4625）\"><a href=\"#任务-2：导出最近-24-小时的登录事件（4624-x2F-4625）\" class=\"headerlink\" title=\"任务 2：导出最近 24 小时的登录事件（4624&#x2F;4625）\"></a>任务 2：导出最近 24 小时的登录事件（4624&#x2F;4625）</h3><p><strong>目标</strong>：导出登录成功&#x2F;失败事件，检测异常登录。</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 导出 RDP 登录（事件 4624，登录类型 10）</span></span><br><span class=\"line\"><span class=\"built_in\">Get-WinEvent</span> <span class=\"literal\">-FilterHashtable</span> <span class=\"selector-tag\">@</span>&#123;</span><br><span class=\"line\">    LogName=<span class=\"string\">&#x27;Security&#x27;</span></span><br><span class=\"line\">    ID=<span class=\"number\">4624</span></span><br><span class=\"line\">    StartTime=(<span class=\"built_in\">Get-Date</span>).AddDays(<span class=\"literal\">-1</span>)</span><br><span class=\"line\">&#125; | <span class=\"built_in\">Where-Object</span> &#123;</span><br><span class=\"line\">    <span class=\"variable\">$_</span>.Properties[<span class=\"number\">8</span>].Value <span class=\"operator\">-eq</span> <span class=\"number\">10</span></span><br><span class=\"line\">&#125; | <span class=\"built_in\">Select-Object</span> TimeCreated,</span><br><span class=\"line\">    <span class=\"selector-tag\">@</span>&#123;Name=<span class=\"string\">&quot;User&quot;</span>;Expression=&#123;<span class=\"variable\">$_</span>.Properties[<span class=\"number\">5</span>].Value&#125;&#125;,</span><br><span class=\"line\">    <span class=\"selector-tag\">@</span>&#123;Name=<span class=\"string\">&quot;SourceIP&quot;</span>;Expression=&#123;<span class=\"variable\">$_</span>.Properties[<span class=\"number\">18</span>].Value&#125;&#125; |</span><br><span class=\"line\"><span class=\"built_in\">Export-Csv</span> <span class=\"literal\">-Path</span> <span class=\"string\">&quot;RDP_Logins.csv&quot;</span> <span class=\"literal\">-NoTypeInformation</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 导出登录失败事件（4625）</span></span><br><span class=\"line\"><span class=\"built_in\">Get-WinEvent</span> <span class=\"literal\">-FilterHashtable</span> <span class=\"selector-tag\">@</span>&#123;</span><br><span class=\"line\">    LogName=<span class=\"string\">&#x27;Security&#x27;</span></span><br><span class=\"line\">    ID=<span class=\"number\">4625</span></span><br><span class=\"line\">    StartTime=(<span class=\"built_in\">Get-Date</span>).AddDays(<span class=\"literal\">-1</span>)</span><br><span class=\"line\">&#125; | <span class=\"built_in\">Select-Object</span> TimeCreated,</span><br><span class=\"line\">    <span class=\"selector-tag\">@</span>&#123;Name=<span class=\"string\">&quot;User&quot;</span>;Expression=&#123;<span class=\"variable\">$_</span>.Properties[<span class=\"number\">5</span>].Value&#125;&#125;,</span><br><span class=\"line\">    <span class=\"selector-tag\">@</span>&#123;Name=<span class=\"string\">&quot;FailureReason&quot;</span>;Expression=&#123;<span class=\"variable\">$_</span>.Properties[<span class=\"number\">8</span>].Value&#125;&#125; |</span><br><span class=\"line\"><span class=\"built_in\">Export-Csv</span> <span class=\"literal\">-Path</span> <span class=\"string\">&quot;Failed_Logins.csv&quot;</span> <span class=\"literal\">-NoTypeInformation</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>分析要点</strong>：</p>\n<ol>\n<li>打开 <code>RDP_Logins.csv</code>，检查是否有”非预期的源 IP”</li>\n<li>打开 <code>Failed_Logins.csv</code>，统计失败次数最多的账号（可能被爆破）</li>\n</ol>\n<p><strong>输出结果</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[粘贴 CSV 前 10 行或异常记录]</span><br><span class=\"line\"></span><br><span class=\"line\">发现的异常：</span><br><span class=\"line\">-</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-3：检查防火墙入站规则并评估风险\"><a href=\"#任务-3：检查防火墙入站规则并评估风险\" class=\"headerlink\" title=\"任务 3：检查防火墙入站规则并评估风险\"></a>任务 3：检查防火墙入站规则并评估风险</h3><p><strong>目标</strong>：列出所有”允许”的入站规则，找出不必要的暴露。</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 导出所有允许的入站规则</span></span><br><span class=\"line\"><span class=\"built_in\">Get-NetFirewallRule</span> <span class=\"literal\">-Direction</span> Inbound <span class=\"literal\">-Enabled</span> True <span class=\"literal\">-Action</span> Allow |</span><br><span class=\"line\"><span class=\"built_in\">Select-Object</span> DisplayName, Profile,</span><br><span class=\"line\">    <span class=\"selector-tag\">@</span>&#123;Name=<span class=\"string\">&quot;LocalPort&quot;</span>;Expression=&#123;(<span class=\"built_in\">Get-NetFirewallPortFilter</span> <span class=\"literal\">-AssociatedNetFirewallRule</span> <span class=\"variable\">$_</span>).LocalPort&#125;&#125;,</span><br><span class=\"line\">    <span class=\"selector-tag\">@</span>&#123;Name=<span class=\"string\">&quot;RemoteAddress&quot;</span>;Expression=&#123;(<span class=\"built_in\">Get-NetFirewallAddressFilter</span> <span class=\"literal\">-AssociatedNetFirewallRule</span> <span class=\"variable\">$_</span>).RemoteAddress&#125;&#125; |</span><br><span class=\"line\"><span class=\"built_in\">Export-Csv</span> <span class=\"literal\">-Path</span> <span class=\"string\">&quot;Firewall_Inbound.csv&quot;</span> <span class=\"literal\">-NoTypeInformation</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>风险评估表</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>规则名称</th>\n<th>端口</th>\n<th>远程地址</th>\n<th>风险等级</th>\n<th>建议</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Remote Desktop</td>\n<td>3389</td>\n<td>Any</td>\n<td>🚨 高</td>\n<td>限制为 VPN IP</td>\n</tr>\n<tr>\n<td>File and Printer Sharing</td>\n<td>445</td>\n<td>Any</td>\n<td>🚨 高</td>\n<td>限制为内网</td>\n</tr>\n<tr>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n</tr>\n</tbody></table>\n<p><strong>输出结果</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[粘贴 CSV 或截图]</span><br><span class=\"line\"></span><br><span class=\"line\">需要整改的规则：</span><br><span class=\"line\">-</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-4：盘点当前监听端口并识别异常进程\"><a href=\"#任务-4：盘点当前监听端口并识别异常进程\" class=\"headerlink\" title=\"任务 4：盘点当前监听端口并识别异常进程\"></a>任务 4：盘点当前监听端口并识别异常进程</h3><p><strong>目标</strong>：使用 <code>netstat</code> 或 PowerShell 列出所有监听端口，识别可疑服务。</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 列出所有监听端口及其进程</span></span><br><span class=\"line\"><span class=\"built_in\">Get-NetTCPConnection</span> <span class=\"literal\">-State</span> Listen |</span><br><span class=\"line\"><span class=\"built_in\">Select-Object</span> LocalAddress, LocalPort, State,</span><br><span class=\"line\">    <span class=\"selector-tag\">@</span>&#123;Name=<span class=\"string\">&quot;ProcessName&quot;</span>;Expression=&#123;(<span class=\"built_in\">Get-Process</span> <span class=\"literal\">-Id</span> <span class=\"variable\">$_</span>.OwningProcess <span class=\"literal\">-ErrorAction</span> SilentlyContinue).ProcessName&#125;&#125;,</span><br><span class=\"line\">    <span class=\"selector-tag\">@</span>&#123;Name=<span class=\"string\">&quot;ProcessPath&quot;</span>;Expression=&#123;(<span class=\"built_in\">Get-Process</span> <span class=\"literal\">-Id</span> <span class=\"variable\">$_</span>.OwningProcess <span class=\"literal\">-ErrorAction</span> SilentlyContinue).Path&#125;&#125; |</span><br><span class=\"line\"><span class=\"built_in\">Format-Table</span> <span class=\"literal\">-AutoSize</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>检查清单</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 是否有”非预期的高端口监听”（如 4444、5555）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 进程路径是否在 <code>AppData</code> 或 <code>Temp</code>（可疑）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 进程名是否伪装成系统进程（如 <code>svchost.exe</code> 但不在 System32）</li>\n</ul>\n<p><strong>输出结果</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[粘贴输出或截图]</span><br><span class=\"line\"></span><br><span class=\"line\">发现的可疑进程：</span><br><span class=\"line\">-</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-5：配置账户锁定策略（防爆破）\"><a href=\"#任务-5：配置账户锁定策略（防爆破）\" class=\"headerlink\" title=\"任务 5：配置账户锁定策略（防爆破）\"></a>任务 5：配置账户锁定策略（防爆破）</h3><p><strong>目标</strong>：设置”5 次失败锁定 30 分钟”策略。</p>\n<p><strong>方法 1：GUI</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">1. Win+R → secpol.msc</span><br><span class=\"line\">2. 账户策略 → 账户锁定策略</span><br><span class=\"line\">3. 设置：</span><br><span class=\"line\">   - 账户锁定阈值：5 次无效登录</span><br><span class=\"line\">   - 账户锁定时间：30 分钟</span><br><span class=\"line\">   - 重置账户锁定计数器：30 分钟</span><br><span class=\"line\">4. 点击&quot;应用&quot;</span><br></pre></td></tr></table></figure>\n\n<p><strong>方法 2：PowerShell（需管理员权限）</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 导出当前策略到临时文件</span></span><br><span class=\"line\">secedit /export /cfg C:\\Temp\\secpol.cfg</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 编辑文件，添加以下内容：</span></span><br><span class=\"line\"><span class=\"comment\"># [System Access]</span></span><br><span class=\"line\"><span class=\"comment\"># LockoutBadCount = 5</span></span><br><span class=\"line\"><span class=\"comment\"># LockoutDuration = 30</span></span><br><span class=\"line\"><span class=\"comment\"># ResetLockoutCount = 30</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 导入策略</span></span><br><span class=\"line\">secedit /configure /db C:\\Windows\\security\\local.sdb /cfg C:\\Temp\\secpol.cfg</span><br></pre></td></tr></table></figure>\n\n<p><strong>验证</strong>：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看当前锁定策略</span></span><br><span class=\"line\">net accounts</span><br></pre></td></tr></table></figure>\n\n<p><strong>输出示例</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">强制用户在时间到期之后多久必须注销?:     从不</span><br><span class=\"line\">密码最短使用期限(天):                     0</span><br><span class=\"line\">密码最长使用期限(天):                     42</span><br><span class=\"line\">密码长度最小值:                           0</span><br><span class=\"line\">保持的密码历史记录长度:                   None</span><br><span class=\"line\">锁定阈值:                                 5        ← 确认生效</span><br><span class=\"line\">锁定持续时间(分钟):                       30</span><br><span class=\"line\">锁定观测窗口(分钟):                       30</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"四、巩固练习（题与复盘）\"><a href=\"#四、巩固练习（题与复盘）\" class=\"headerlink\" title=\"四、巩固练习（题与复盘）\"></a>四、巩固练习（题与复盘）</h2><h3 id=\"题-1：为什么不建议启用匿名共享？\"><a href=\"#题-1：为什么不建议启用匿名共享？\" class=\"headerlink\" title=\"题 1：为什么不建议启用匿名共享？\"></a>题 1：为什么不建议启用匿名共享？</h3><p><strong>思路</strong>：</p>\n<ul>\n<li>匿名共享 &#x3D; 不鉴权访问</li>\n<li>权限边界失效 → 容易数据泄露</li>\n<li>内网横向移动的跳板</li>\n</ul>\n<p><strong>参考答案</strong>：<br>匿名共享允许任何人无需身份验证即可访问共享资源，导致：</p>\n<ol>\n<li><strong>信息泄露</strong>：敏感文件被未授权用户下载</li>\n<li><strong>横向移动</strong>：攻击者利用匿名共享在内网传播恶意软件（如 WannaCry）</li>\n<li><strong>合规风险</strong>：违反 GDPR&#x2F;等保 2.0 对访问控制的要求</li>\n</ol>\n<p><strong>防御措施</strong>：</p>\n<ul>\n<li>禁用匿名共享：<code>net share IPC$ /delete</code></li>\n<li>使用 NTFS 权限控制文件访问</li>\n<li>启用 SMB 签名（防中间人攻击）</li>\n</ul>\n<hr>\n<h3 id=\"题-2：列出-5-条-Windows-主机加固项并说明原因\"><a href=\"#题-2：列出-5-条-Windows-主机加固项并说明原因\" class=\"headerlink\" title=\"题 2：列出 5 条 Windows 主机加固项并说明原因\"></a>题 2：列出 5 条 Windows 主机加固项并说明原因</h3><p><strong>思路</strong>：账号、补丁、防火墙、远程服务、日志审计。</p>\n<p><strong>参考答案</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>加固项</th>\n<th>原因</th>\n<th>实施方法</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>1. 最小化管理员组成员</strong></td>\n<td>减少高权限账号被攻击面</td>\n<td><code>Get-LocalGroupMember Administrators</code> 审计</td>\n</tr>\n<tr>\n<td><strong>2. 启用自动更新</strong></td>\n<td>及时修复 CVE 漏洞（如 EternalBlue）</td>\n<td>组策略 → Windows Update</td>\n</tr>\n<tr>\n<td><strong>3. 限制 RDP 访问</strong></td>\n<td>防止暴力破解</td>\n<td>防火墙仅允许 VPN IP</td>\n</tr>\n<tr>\n<td><strong>4. 启用账户锁定策略</strong></td>\n<td>5 次失败锁定 30 分钟</td>\n<td><code>secpol.msc</code> 配置</td>\n</tr>\n<tr>\n<td><strong>5. 启用审计日志</strong></td>\n<td>记录 4624&#x2F;4625&#x2F;4688 用于事件溯源</td>\n<td><code>auditpol /set /category:*</code></td>\n</tr>\n</tbody></table>\n<p><strong>额外 3 条（进阶）</strong>： 6. 禁用不必要的服务（如 Telnet、FTP） 7. 启用 BitLocker 磁盘加密 8. 配置 AppLocker 白名单（限制可执行程序）</p>\n<hr>\n<h3 id=\"题-3：如何判断事件-4624-是”正常-RDP-登录”还是”可疑登录”？\"><a href=\"#题-3：如何判断事件-4624-是”正常-RDP-登录”还是”可疑登录”？\" class=\"headerlink\" title=\"题 3：如何判断事件 4624 是”正常 RDP 登录”还是”可疑登录”？\"></a>题 3：如何判断事件 4624 是”正常 RDP 登录”还是”可疑登录”？</h3><p><strong>参考答案</strong>：</p>\n<p><strong>需要检查的字段</strong>：</p>\n<ol>\n<li><strong>Logon Type</strong>：必须是 10（RDP）</li>\n<li><strong>Source Network Address</strong>：检查 IP 是否为：<ul>\n<li>✅ 内网 IP（192.168.x.x &#x2F; 10.x.x.x）</li>\n<li>⚠️ 公网 IP（需对照 VPN 出口 IP 白名单）</li>\n<li>🚨 异常地理位置（如来自国外）</li>\n</ul>\n</li>\n<li><strong>Account Name</strong>：是否为已知运维人员账号</li>\n<li><strong>Time Created</strong>：是否在工作时间段</li>\n</ol>\n<p><strong>可疑登录特征</strong>：</p>\n<ul>\n<li>凌晨 3 点有 RDP 登录（非值班时间）</li>\n<li>源 IP 来自云服务商（如 AWS&#x2F;Azure），但公司未使用</li>\n<li>账号为 <code>Administrator</code>（应禁用或重命名）</li>\n<li>短时间内多次登录失败后成功（可能爆破成功）</li>\n</ul>\n<p><strong>应急响应</strong>：</p>\n<ol>\n<li>立即隔离主机（断网）</li>\n<li>导出 4624&#x2F;4625&#x2F;4672 事件做证据保全</li>\n<li>检查是否有 4720（创建账户）&#x2F;7045（安装服务）</li>\n<li>使用 Autoruns 检查持久化</li>\n</ol>\n<hr>\n<h3 id=\"题-4：如何通过-PowerShell-找出”最近-7-天创建的本地账户”？\"><a href=\"#题-4：如何通过-PowerShell-找出”最近-7-天创建的本地账户”？\" class=\"headerlink\" title=\"题 4：如何通过 PowerShell 找出”最近 7 天创建的本地账户”？\"></a>题 4：如何通过 PowerShell 找出”最近 7 天创建的本地账户”？</h3><p><strong>参考答案</strong>：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 方法 1：查询安全日志（事件 4720）</span></span><br><span class=\"line\"><span class=\"built_in\">Get-WinEvent</span> <span class=\"literal\">-FilterHashtable</span> <span class=\"selector-tag\">@</span>&#123;</span><br><span class=\"line\">    LogName=<span class=\"string\">&#x27;Security&#x27;</span></span><br><span class=\"line\">    ID=<span class=\"number\">4720</span></span><br><span class=\"line\">    StartTime=(<span class=\"built_in\">Get-Date</span>).AddDays(<span class=\"literal\">-7</span>)</span><br><span class=\"line\">&#125; | <span class=\"built_in\">ForEach-Object</span> &#123;</span><br><span class=\"line\">    [<span class=\"type\">PSCustomObject</span>]<span class=\"selector-tag\">@</span>&#123;</span><br><span class=\"line\">        Time = <span class=\"variable\">$_</span>.TimeCreated</span><br><span class=\"line\">        NewAccount = <span class=\"variable\">$_</span>.Properties[<span class=\"number\">0</span>].Value</span><br><span class=\"line\">        CreatedBy = <span class=\"variable\">$_</span>.Properties[<span class=\"number\">4</span>].Value</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; | <span class=\"built_in\">Format-Table</span> <span class=\"literal\">-AutoSize</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方法 2：查询本地用户（需判断创建时间）</span></span><br><span class=\"line\"><span class=\"comment\"># 注意：Get-LocalUser 没有直接的&quot;创建时间&quot;属性，需结合注册表</span></span><br><span class=\"line\"><span class=\"built_in\">Get-LocalUser</span> | <span class=\"built_in\">ForEach-Object</span> &#123;</span><br><span class=\"line\">    <span class=\"variable\">$sid</span> = <span class=\"variable\">$_</span>.SID</span><br><span class=\"line\">    <span class=\"variable\">$regPath</span> = <span class=\"string\">&quot;HKLM:\\SAM\\SAM\\Domains\\Account\\Users\\<span class=\"variable\">$sid</span>&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># 需要管理员权限+SYSTEM权限才能访问 SAM 注册表</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>为什么优先查事件日志？</strong></p>\n<ul>\n<li>事件 4720 明确记录”谁在什么时间创建了账户”</li>\n<li>包含创建者账号（追溯责任）</li>\n<li>即使账户被删除，日志仍保留</li>\n</ul>\n<hr>\n<h2 id=\"五、评估标准（达成判定）\"><a href=\"#五、评估标准（达成判定）\" class=\"headerlink\" title=\"五、评估标准（达成判定）\"></a>五、评估标准（达成判定）</h2><ul>\n<li>✅ 你能列出管理员组成员并解释”谁应该在里面”</li>\n<li>✅ 你能导出 4624&#x2F;4625 某一类事件做证据</li>\n<li>✅ 你能指出 1-2 条”可能不该对外暴露”的入站服务&#x2F;端口</li>\n<li>✅ 你能配置账户锁定策略（5 次失败锁定 30 分钟）</li>\n<li>✅ 你能写出 Windows 加固清单（15 条以上）</li>\n</ul>\n<hr>\n<h2 id=\"六、Windows-安全加固清单（15-条）\"><a href=\"#六、Windows-安全加固清单（15-条）\" class=\"headerlink\" title=\"六、Windows 安全加固清单（15 条）\"></a>六、Windows 安全加固清单（15 条）</h2><h3 id=\"账号安全（5-条）\"><a href=\"#账号安全（5-条）\" class=\"headerlink\" title=\"账号安全（5 条）\"></a>账号安全（5 条）</h3><ol>\n<li>✅ 禁用或重命名默认 <code>Administrator</code> 账号</li>\n<li>✅ 最小化管理员组成员（定期审计）</li>\n<li>✅ 启用密码复杂性（12 位，大小写+数字+符号）</li>\n<li>✅ 启用账户锁定策略（5 次失败锁定 30 分钟）</li>\n<li>✅ 禁用 Guest 账户</li>\n</ol>\n<h3 id=\"补丁与更新（2-条）\"><a href=\"#补丁与更新（2-条）\" class=\"headerlink\" title=\"补丁与更新（2 条）\"></a>补丁与更新（2 条）</h3><ol start=\"6\">\n<li>✅ 启用 Windows 自动更新</li>\n<li>✅ 每月检查未安装的关键更新（<code>wuauclt /detectnow</code>）</li>\n</ol>\n<h3 id=\"网络安全（4-条）\"><a href=\"#网络安全（4-条）\" class=\"headerlink\" title=\"网络安全（4 条）\"></a>网络安全（4 条）</h3><ol start=\"8\">\n<li>✅ 防火墙默认拒绝入站，按需放通</li>\n<li>✅ RDP（3389）仅允许 VPN&#x2F;堡垒机 IP</li>\n<li>✅ 禁用 SMBv1（<code>Disable-WindowsOptionalFeature -Online -FeatureName SMB1Protocol</code>）</li>\n<li>✅ 禁用不必要的服务（Telnet&#x2F;FTP&#x2F;IIS）</li>\n</ol>\n<h3 id=\"审计与日志（2-条）\"><a href=\"#审计与日志（2-条）\" class=\"headerlink\" title=\"审计与日志（2 条）\"></a>审计与日志（2 条）</h3><ol start=\"12\">\n<li>✅ 启用安全审计（4624&#x2F;4625&#x2F;4688&#x2F;4720&#x2F;7045）</li>\n<li>✅ 日志至少保留 90 天（组策略配置）</li>\n</ol>\n<h3 id=\"高级防护（2-条）\"><a href=\"#高级防护（2-条）\" class=\"headerlink\" title=\"高级防护（2 条）\"></a>高级防护（2 条）</h3><ol start=\"14\">\n<li>✅ 启用 Windows Defender 实时保护</li>\n<li>✅ 配置 AppLocker 白名单（限制可执行程序路径）</li>\n</ol>\n<hr>\n<h2 id=\"七、学习成果达成情况（由学习者填写）\"><a href=\"#七、学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"七、学习成果达成情况（由学习者填写）\"></a>七、学习成果达成情况（由学习者填写）</h2><h3 id=\"截图与证据\"><a href=\"#截图与证据\" class=\"headerlink\" title=\"截图与证据\"></a>截图与证据</h3><ul>\n<li><input disabled=\"\" type=\"checkbox\"> <code>Get-LocalGroupMember Administrators</code> 输出截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 4624&#x2F;4625 事件导出 CSV 文件</li>\n<li><input disabled=\"\" type=\"checkbox\"> 防火墙入站规则截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 监听端口列表截图</li>\n</ul>\n<h3 id=\"关键命令与输出\"><a href=\"#关键命令与输出\" class=\"headerlink\" title=\"关键命令与输出\"></a>关键命令与输出</h3><p><strong>管理员组成员</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[粘贴你的输出]</span><br></pre></td></tr></table></figure>\n\n<p><strong>登录事件（4624&#x2F;4625）关键行</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[粘贴异常记录]</span><br></pre></td></tr></table></figure>\n\n<p><strong>入站规则观察到的”可疑&#x2F;不需要”项</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[列出具体规则名称和端口]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"结论与反思\"><a href=\"#结论与反思\" class=\"headerlink\" title=\"结论与反思\"></a>结论与反思</h3><ul>\n<li><strong>我今天确认到的 1 个事实证据</strong>：</li>\n<li><strong>我需要立刻改的 1 个设置（如果是自用电脑）</strong>：</li>\n<li><strong>我不确定但要查的 1 件事</strong>：</li>\n</ul>\n<hr>\n<h2 id=\"八、参考资料\"><a href=\"#八、参考资料\" class=\"headerlink\" title=\"八、参考资料\"></a>八、参考资料</h2><h3 id=\"官方文档\"><a href=\"#官方文档\" class=\"headerlink\" title=\"官方文档\"></a>官方文档</h3><ul>\n<li><a href=\"https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/appendix-l--events-to-monitor\">Windows 安全审核事件 ID</a></li>\n<li><a href=\"https://learn.microsoft.com/en-us/windows/security/application-security/application-control/user-account-control/how-it-works\">UAC 工作原理</a></li>\n<li><a href=\"https://learn.microsoft.com/en-us/windows/security/operating-system-security/network-security/windows-firewall/best-practices-configuring\">Windows Defender 防火墙最佳实践</a></li>\n</ul>\n<h3 id=\"工具下载\"><a href=\"#工具下载\" class=\"headerlink\" title=\"工具下载\"></a>工具下载</h3><ul>\n<li><a href=\"https://learn.microsoft.com/en-us/sysinternals/\">Sysinternals Suite</a>（包含 TCPView&#x2F;Autoruns&#x2F;PsExec）</li>\n<li><a href=\"https://learn.microsoft.com/en-us/sysinternals/downloads/sysmon\">Sysmon</a>（高级日志记录）</li>\n</ul>\n<h3 id=\"安全基线\"><a href=\"#安全基线\" class=\"headerlink\" title=\"安全基线\"></a>安全基线</h3><ul>\n<li><a href=\"https://www.cisecurity.org/benchmark/microsoft_windows_desktop\">CIS Windows 10 Benchmark</a></li>\n<li><a href=\"https://www.microsoft.com/en-us/download/details.aspx?id=55319\">Microsoft Security Compliance Toolkit</a></li>\n</ul>\n<hr>\n<h2 id=\"九、学习成果示例填写（可照抄）\"><a href=\"#九、学习成果示例填写（可照抄）\" class=\"headerlink\" title=\"九、学习成果示例填写（可照抄）\"></a>九、学习成果示例填写（可照抄）</h2><h3 id=\"结论与反思（示例）\"><a href=\"#结论与反思（示例）\" class=\"headerlink\" title=\"结论与反思（示例）\"></a>结论与反思（示例）</h3><p><strong>我今天确认到的 1 个事实证据</strong>：</p>\n<ul>\n<li>在管理员组中发现了离职员工 <code>Bob</code> 的账号残留，已通过 <code>Remove-LocalUser</code> 删除。</li>\n</ul>\n<p><strong>我需要立刻改的 1 个设置（如果是自用电脑）</strong>：</p>\n<ul>\n<li>我的 RDP（3389）端口对所有 IP 开放，需要修改防火墙规则，仅允许家庭网络 IP 段（192.168.1.0&#x2F;24）访问。</li>\n</ul>\n<p><strong>我不确定但要查的 1 件事</strong>：</p>\n<ul>\n<li>事件日志中出现了大量事件 ID 4648（使用显式凭据登录），不确定是否为正常运维行为，需要与 IT 部门确认。</li>\n</ul>\n<hr>\n<p><strong>恭喜！你已掌握 Windows 安全审计与加固的核心技能。明天我们将学习 PowerShell 脚本，进一步提升自动化能力！</strong> 🎉</p>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day019：操作系统与脚本 - Nmap 端口扫描安全使用","url":"/post/b5624f93.html","content":"<h1 id=\"Day019：操作系统与脚本-Nmap-端口扫描安全使用\"><a href=\"#Day019：操作系统与脚本-Nmap-端口扫描安全使用\" class=\"headerlink\" title=\"Day019：操作系统与脚本 - Nmap 端口扫描安全使用\"></a>Day019：操作系统与脚本 - Nmap 端口扫描安全使用</h1><ul>\n<li>日期：2026-01-12</li>\n<li>周次：第 3 周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p>学完今天你应该能做到：</p>\n<ul>\n<li>明确知道一句底线：<strong>扫描是有”扰动”的行为，只能在自建&#x2F;明确授权目标上做</strong></li>\n<li>能解释 <code>-sS</code> 和 <code>-sT</code> 的差异（别背，理解就行）</li>\n<li>能做一次最小扫描并导出结果，然后把结果整理成表（给 Day020 用）</li>\n<li>掌握 Nmap 常用参数、端口状态含义、扫描策略选择</li>\n<li>能输出一份规范的扫描报告（含授权说明、时间窗口、结果分析）</li>\n</ul>\n<hr>\n<span id=\"more\"></span>\n\n<h2 id=\"一、为什么端口扫描需要”合法授权”？\"><a href=\"#一、为什么端口扫描需要”合法授权”？\" class=\"headerlink\" title=\"一、为什么端口扫描需要”合法授权”？\"></a>一、为什么端口扫描需要”合法授权”？</h2><h3 id=\"1-1-端口扫描的法律风险\"><a href=\"#1-1-端口扫描的法律风险\" class=\"headerlink\" title=\"1.1 端口扫描的法律风险\"></a>1.1 端口扫描的法律风险</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">法律视角</span><br><span class=\"line\">├─ 未经授权的端口扫描可能构成&quot;非法侵入计算机系统&quot;</span><br><span class=\"line\">├─ 某些国家/地区的法律明确禁止未授权扫描</span><br><span class=\"line\">└─ 即使是&quot;善意测试&quot;，也可能被视为攻击行为</span><br><span class=\"line\"></span><br><span class=\"line\">企业视角</span><br><span class=\"line\">├─ 触发 IDS/IPS 告警，导致安全团队误判</span><br><span class=\"line\">├─ 影响生产系统性能（尤其是全端口扫描）</span><br><span class=\"line\">└─ 违反公司安全政策，可能被开除</span><br><span class=\"line\"></span><br><span class=\"line\">技术视角</span><br><span class=\"line\">├─ SYN Flood 扫描可能被识别为 DoS 攻击</span><br><span class=\"line\">├─ 频繁连接可能导致目标系统资源耗尽</span><br><span class=\"line\">└─ 留下大量日志痕迹，容易被溯源</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-2-合法授权的-3-个层次\"><a href=\"#1-2-合法授权的-3-个层次\" class=\"headerlink\" title=\"1.2 合法授权的 3 个层次\"></a>1.2 合法授权的 3 个层次</h3><table>\n<thead>\n<tr>\n<th>授权类型</th>\n<th>说明</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>自建环境</strong></td>\n<td>你完全拥有的系统</td>\n<td>本机、自己的虚拟机、家庭 NAS</td>\n</tr>\n<tr>\n<td><strong>书面授权</strong></td>\n<td>有明确的授权文件</td>\n<td>渗透测试合同、安全评估委托书</td>\n</tr>\n<tr>\n<td><strong>公开靶场</strong></td>\n<td>明确允许测试的平台</td>\n<td>HackTheBox、TryHackMe、VulnHub</td>\n</tr>\n</tbody></table>\n<p><strong>⚠️ 重要提醒</strong>：</p>\n<ul>\n<li>即使是公司内网，也需要 IT 部门明确授权</li>\n<li>不要扫描”你认为可能没问题”的目标</li>\n<li>每次扫描都应记录授权证明和扫描时间</li>\n</ul>\n<hr>\n<h2 id=\"二、Nmap-核心概念与参数详解\"><a href=\"#二、Nmap-核心概念与参数详解\" class=\"headerlink\" title=\"二、Nmap 核心概念与参数详解\"></a>二、Nmap 核心概念与参数详解</h2><h3 id=\"2-1-端口状态含义\"><a href=\"#2-1-端口状态含义\" class=\"headerlink\" title=\"2.1 端口状态含义\"></a>2.1 端口状态含义</h3><table>\n<thead>\n<tr>\n<th>状态</th>\n<th>含义</th>\n<th>常见原因</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>open</strong></td>\n<td>端口开放，有服务监听</td>\n<td>正常服务（SSH&#x2F;HTTP&#x2F;MySQL）</td>\n</tr>\n<tr>\n<td><strong>closed</strong></td>\n<td>端口关闭，但主机在线</td>\n<td>服务未启动或已停止</td>\n</tr>\n<tr>\n<td><strong>filtered</strong></td>\n<td>被防火墙过滤，无响应</td>\n<td>防火墙规则拒绝或丢弃数据包</td>\n</tr>\n<tr>\n<td><strong>unfiltered</strong></td>\n<td>端口可达，但无法确定开放&#x2F;关闭</td>\n<td>罕见，通常是 ACK 扫描的结果</td>\n</tr>\n<tr>\n<td>**open</td>\n<td>filtered**</td>\n<td>无法确定是开放还是被过滤</td>\n</tr>\n<tr>\n<td>**closed</td>\n<td>filtered**</td>\n<td>无法确定是关闭还是被过滤</td>\n</tr>\n</tbody></table>\n<h3 id=\"2-2-扫描类型对照表\"><a href=\"#2-2-扫描类型对照表\" class=\"headerlink\" title=\"2.2 扫描类型对照表\"></a>2.2 扫描类型对照表</h3><table>\n<thead>\n<tr>\n<th>参数</th>\n<th>名称</th>\n<th>工作原理</th>\n<th>权限要求</th>\n<th>隐蔽性</th>\n<th>速度</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>-sS</code></td>\n<td>SYN 扫描（半开扫描）</td>\n<td>发送 SYN，收到 SYN-ACK 后发送 RST</td>\n<td>需要 root&#x2F;管理员</td>\n<td>⭐⭐⭐⭐</td>\n<td>快</td>\n</tr>\n<tr>\n<td><code>-sT</code></td>\n<td>TCP Connect 扫描</td>\n<td>完整三次握手</td>\n<td>普通用户</td>\n<td>⭐⭐</td>\n<td>中等</td>\n</tr>\n<tr>\n<td><code>-sU</code></td>\n<td>UDP 扫描</td>\n<td>发送 UDP 数据包</td>\n<td>普通用户</td>\n<td>⭐⭐⭐</td>\n<td>慢</td>\n</tr>\n<tr>\n<td><code>-sA</code></td>\n<td>ACK 扫描</td>\n<td>发送 ACK 包，用于探测防火墙规则</td>\n<td>需要 root&#x2F;管理员</td>\n<td>⭐⭐⭐⭐</td>\n<td>快</td>\n</tr>\n<tr>\n<td><code>-sN/-sF/-sX</code></td>\n<td>NULL&#x2F;FIN&#x2F;Xmas 扫描</td>\n<td>利用 TCP 标志位绕过防火墙</td>\n<td>需要 root&#x2F;管理员</td>\n<td>⭐⭐⭐⭐⭐</td>\n<td>中等</td>\n</tr>\n</tbody></table>\n<p><strong>推荐</strong>：</p>\n<ul>\n<li><strong>日常使用</strong>：<code>-sT</code>（无需特殊权限，兼容性好）</li>\n<li><strong>渗透测试</strong>：<code>-sS</code>（更快，日志痕迹更少）</li>\n<li><strong>防火墙探测</strong>：<code>-sA</code>（判断是否有状态防火墙）</li>\n</ul>\n<h3 id=\"2-3-常用参数详解\"><a href=\"#2-3-常用参数详解\" class=\"headerlink\" title=\"2.3 常用参数详解\"></a>2.3 常用参数详解</h3><h4 id=\"端口指定\"><a href=\"#端口指定\" class=\"headerlink\" title=\"端口指定\"></a>端口指定</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 扫描单个端口</span></span><br><span class=\"line\">nmap -p 80 192.168.1.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 扫描多个端口</span></span><br><span class=\"line\">nmap -p 22,80,443 192.168.1.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 扫描端口范围</span></span><br><span class=\"line\">nmap -p 1-1000 192.168.1.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 扫描所有端口（0-65535）</span></span><br><span class=\"line\">nmap -p- 192.168.1.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 扫描 Top 100 常用端口</span></span><br><span class=\"line\">nmap --top-ports 100 192.168.1.1</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"服务版本探测\"><a href=\"#服务版本探测\" class=\"headerlink\" title=\"服务版本探测\"></a>服务版本探测</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 探测服务版本</span></span><br><span class=\"line\">nmap -sV 192.168.1.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 更激进的版本探测</span></span><br><span class=\"line\">nmap -sV --version-intensity 5 192.168.1.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 轻量级版本探测</span></span><br><span class=\"line\">nmap -sV --version-intensity 0 192.168.1.1</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"操作系统探测\"><a href=\"#操作系统探测\" class=\"headerlink\" title=\"操作系统探测\"></a>操作系统探测</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 探测操作系统</span></span><br><span class=\"line\">nmap -O 192.168.1.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 激进模式（操作系统+版本+脚本+路由追踪）</span></span><br><span class=\"line\">nmap -A 192.168.1.1</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"输出格式\"><a href=\"#输出格式\" class=\"headerlink\" title=\"输出格式\"></a>输出格式</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 正常输出到文件</span></span><br><span class=\"line\">nmap -oN scan.txt 192.168.1.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># XML 输出（可用工具解析）</span></span><br><span class=\"line\">nmap -oX scan.xml 192.168.1.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Grepable 输出（方便脚本处理）</span></span><br><span class=\"line\">nmap -oG scan.gnmap 192.168.1.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 输出到所有格式</span></span><br><span class=\"line\">nmap -oA scan 192.168.1.1</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"速度与时延\"><a href=\"#速度与时延\" class=\"headerlink\" title=\"速度与时延\"></a>速度与时延</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 最快（容易被检测，可能不准确）</span></span><br><span class=\"line\">nmap -T5 192.168.1.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 正常速度（推荐）</span></span><br><span class=\"line\">nmap -T3 192.168.1.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 慢速（隐蔽扫描）</span></span><br><span class=\"line\">nmap -T1 192.168.1.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 自定义扫描延迟（每个探测间隔 1 秒）</span></span><br><span class=\"line\">nmap --scan-delay 1s 192.168.1.1</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"三、实战任务（含完整命令与分析）\"><a href=\"#三、实战任务（含完整命令与分析）\" class=\"headerlink\" title=\"三、实战任务（含完整命令与分析）\"></a>三、实战任务（含完整命令与分析）</h2><h3 id=\"任务-1：确认授权目标并记录\"><a href=\"#任务-1：确认授权目标并记录\" class=\"headerlink\" title=\"任务 1：确认授权目标并记录\"></a>任务 1：确认授权目标并记录</h3><p><strong>目标</strong>：养成”先确认授权”的习惯。</p>\n<p><strong>步骤</strong>：</p>\n<ol>\n<li><p>选择一个合法目标（三选一）：</p>\n<ul>\n<li>✅ 本机（<code>127.0.0.1</code> 或 <code>localhost</code>）</li>\n<li>✅ 自己的虚拟机（VMware&#x2F;VirtualBox）</li>\n<li>✅ 家庭 NAS&#x2F;路由器（确保你拥有）</li>\n</ul>\n</li>\n<li><p>填写授权记录：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">目标：127.0.0.1</span><br><span class=\"line\">授权类型：自建环境（本机自查）</span><br><span class=\"line\">扫描窗口：2026-01-12 14:00 - 14:30</span><br><span class=\"line\">目的：学习端口扫描，排查不必要的开放端口</span><br></pre></td></tr></table></figure></li>\n</ol>\n<hr>\n<h3 id=\"任务-2：基础扫描（Top-1000-端口）\"><a href=\"#任务-2：基础扫描（Top-1000-端口）\" class=\"headerlink\" title=\"任务 2：基础扫描（Top 1000 端口）\"></a>任务 2：基础扫描（Top 1000 端口）</h3><p><strong>命令</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">nmap -sT -sV --top-ports 1000 -oN day019_scan.txt 127.0.0.1</span><br></pre></td></tr></table></figure>\n\n<p><strong>参数说明</strong>：</p>\n<ul>\n<li><code>-sT</code>：TCP Connect 扫描（无需管理员权限）</li>\n<li><code>-sV</code>：探测服务版本</li>\n<li><code>--top-ports 1000</code>：扫描最常见的 1000 个端口</li>\n<li><code>-oN day019_scan.txt</code>：输出到文本文件</li>\n<li><code>127.0.0.1</code>：目标 IP（本机）</li>\n</ul>\n<p><strong>执行时间</strong>：约 1-3 分钟</p>\n<p><strong>预期输出示例</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Starting Nmap 7.94 ( https://nmap.org )</span><br><span class=\"line\">Nmap scan report for localhost (127.0.0.1)</span><br><span class=\"line\">Host is up (0.00010s latency).</span><br><span class=\"line\">Not shown: 996 closed tcp ports (conn-refused)</span><br><span class=\"line\">PORT     STATE SERVICE VERSION</span><br><span class=\"line\">135/tcp  open  msrpc   Microsoft Windows RPC</span><br><span class=\"line\">445/tcp  open  microsoft-ds</span><br><span class=\"line\">3389/tcp open  ms-wbt-server Microsoft Terminal Services</span><br><span class=\"line\">5357/tcp open  http    Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class=\"line\"></span><br><span class=\"line\">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class=\"line\">Nmap done: 1 IP address (1 host up) scanned in 12.34 seconds</span><br></pre></td></tr></table></figure>\n\n<p><strong>结果分析</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>端口</th>\n<th>状态</th>\n<th>服务</th>\n<th>版本</th>\n<th>风险评估</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>135</td>\n<td>open</td>\n<td>msrpc</td>\n<td>Microsoft Windows RPC</td>\n<td>⚠️ 中等：内网常见，不应对公网开放</td>\n</tr>\n<tr>\n<td>445</td>\n<td>open</td>\n<td>microsoft-ds</td>\n<td>SMB</td>\n<td>🚨 高：历史上多个严重漏洞（EternalBlue）</td>\n</tr>\n<tr>\n<td>3389</td>\n<td>open</td>\n<td>ms-wbt-server</td>\n<td>RDP</td>\n<td>🚨 高：容易被暴力破解</td>\n</tr>\n<tr>\n<td>5357</td>\n<td>open</td>\n<td>http</td>\n<td>SSDP&#x2F;UPnP</td>\n<td>⚠️ 中等：可能被利用做 SSRF</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"任务-3：指定端口范围扫描\"><a href=\"#任务-3：指定端口范围扫描\" class=\"headerlink\" title=\"任务 3：指定端口范围扫描\"></a>任务 3：指定端口范围扫描</h3><p><strong>场景</strong>：只扫描 Web 相关端口（80&#x2F;443&#x2F;8080&#x2F;8443）</p>\n<p><strong>命令</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">nmap -sT -sV -p 80,443,8080,8443 -oN day019_web.txt 127.0.0.1</span><br></pre></td></tr></table></figure>\n\n<p><strong>预期输出</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">PORT     STATE  SERVICE VERSION</span><br><span class=\"line\">80/tcp   closed http</span><br><span class=\"line\">443/tcp  closed https</span><br><span class=\"line\">8080/tcp closed http-proxy</span><br><span class=\"line\">8443/tcp closed https-alt</span><br></pre></td></tr></table></figure>\n\n<p><strong>分析</strong>：如果都是 <code>closed</code>，说明本机没有运行 Web 服务。</p>\n<hr>\n<h3 id=\"任务-4：全端口扫描（仅限自建环境）\"><a href=\"#任务-4：全端口扫描（仅限自建环境）\" class=\"headerlink\" title=\"任务 4：全端口扫描（仅限自建环境）\"></a>任务 4：全端口扫描（仅限自建环境）</h3><p><strong>⚠️ 警告</strong>：全端口扫描（0-65535）非常耗时（可能需要 10+ 分钟），仅在必要时使用。</p>\n<p><strong>命令</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">nmap -sT -p- -oN day019_full.txt 127.0.0.1</span><br></pre></td></tr></table></figure>\n\n<p><strong>优化版本</strong>（跳过版本探测，只看开放端口）：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">nmap -sT -p- --min-rate 1000 -oN day019_full.txt 127.0.0.1</span><br></pre></td></tr></table></figure>\n\n<p><strong>参数说明</strong>：</p>\n<ul>\n<li><code>-p-</code>：扫描所有 65535 个端口</li>\n<li><code>--min-rate 1000</code>：每秒至少发送 1000 个探测包（加速）</li>\n</ul>\n<hr>\n<h3 id=\"任务-5：整理扫描结果为表格\"><a href=\"#任务-5：整理扫描结果为表格\" class=\"headerlink\" title=\"任务 5：整理扫描结果为表格\"></a>任务 5：整理扫描结果为表格</h3><p><strong>目标</strong>：从 <code>day019_scan.txt</code> 提取关键信息，整理成表格。</p>\n<p><strong>手动方法</strong>：</p>\n<ol>\n<li>打开 <code>day019_scan.txt</code></li>\n<li>找到类似这样的行：<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">PORT     STATE SERVICE VERSION</span><br><span class=\"line\">135/tcp  open  msrpc   Microsoft Windows RPC</span><br></pre></td></tr></table></figure></li>\n<li>整理成 Markdown 表格：</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>端口</th>\n<th>状态</th>\n<th>服务</th>\n<th>版本</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>135</td>\n<td>open</td>\n<td>msrpc</td>\n<td>Microsoft Windows RPC</td>\n</tr>\n<tr>\n<td>445</td>\n<td>open</td>\n<td>microsoft-ds</td>\n<td>-</td>\n</tr>\n<tr>\n<td>3389</td>\n<td>open</td>\n<td>ms-wbt-server</td>\n<td>Microsoft Terminal Services</td>\n</tr>\n</tbody></table>\n<p><strong>自动化方法</strong>（Python 脚本，明天 Day020 会详细讲）：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&quot;day019_scan.txt&quot;</span>, <span class=\"string\">&quot;r&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> f:</span><br><span class=\"line\">        match = re.match(<span class=\"string\">r&quot;(\\d+)/tcp\\s+(\\w+)\\s+(\\S+)\\s+(.*)&quot;</span>, line)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> match:</span><br><span class=\"line\">            port, state, service, version = match.groups()</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;| <span class=\"subst\">&#123;port&#125;</span> | <span class=\"subst\">&#123;state&#125;</span> | <span class=\"subst\">&#123;service&#125;</span> | <span class=\"subst\">&#123;version&#125;</span> |&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"四、巩固练习\"><a href=\"#四、巩固练习\" class=\"headerlink\" title=\"四、巩固练习\"></a>四、巩固练习</h2><h3 id=\"练习-1：解释-sS-与-sT-的差异\"><a href=\"#练习-1：解释-sS-与-sT-的差异\" class=\"headerlink\" title=\"练习 1：解释 -sS 与 -sT 的差异\"></a>练习 1：解释 -sS 与 -sT 的差异</h3><p><strong>参考答案</strong>：</p>\n<ul>\n<li><p><strong>-sS（SYN 扫描）</strong>：</p>\n<ul>\n<li>发送 SYN 包，收到 SYN-ACK 后立即发送 RST 断开</li>\n<li>不完成三次握手，因此称为”半开扫描”</li>\n<li>需要 root&#x2F;管理员权限（需要构造原始 TCP 包）</li>\n<li>更快，日志痕迹更少（很多日志只记录完整连接）</li>\n</ul>\n</li>\n<li><p><strong>-sT（TCP Connect 扫描）</strong>：</p>\n<ul>\n<li>使用系统 API 完整建立 TCP 连接（三次握手）</li>\n<li>无需特殊权限，普通用户可用</li>\n<li>速度较慢，会在目标日志中留下完整连接记录</li>\n<li>兼容性更好（适用于所有平台）</li>\n</ul>\n</li>\n</ul>\n<p><strong>选择建议</strong>：</p>\n<ul>\n<li>日常学习&#x2F;自查：用 <code>-sT</code>（无需管理员权限）</li>\n<li>渗透测试&#x2F;红队：用 <code>-sS</code>（更隐蔽）</li>\n</ul>\n<hr>\n<h3 id=\"练习-2：设计一套稳妥的扫描参数组合\"><a href=\"#练习-2：设计一套稳妥的扫描参数组合\" class=\"headerlink\" title=\"练习 2：设计一套稳妥的扫描参数组合\"></a>练习 2：设计一套稳妥的扫描参数组合</h3><p><strong>场景</strong>：对一个生产环境服务器进行安全评估。</p>\n<p><strong>推荐参数</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">nmap -sT -sV --top-ports 100 -T3 --max-retries 2 -oA scan_prod 192.168.1.100</span><br></pre></td></tr></table></figure>\n\n<p><strong>参数说明</strong>：</p>\n<ul>\n<li><code>-sT</code>：无需特殊权限，兼容性好</li>\n<li><code>-sV</code>：探测服务版本（便于漏洞评估）</li>\n<li><code>--top-ports 100</code>：只扫描最常见的 100 个端口（减少影响）</li>\n<li><code>-T3</code>：正常速度（不触发限流）</li>\n<li><code>--max-retries 2</code>：最多重试 2 次（避免网络抖动误判）</li>\n<li><code>-oA scan_prod</code>：输出所有格式（方便后续分析）</li>\n</ul>\n<p><strong>进阶版本</strong>（夜间维护窗口）：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">nmap -sS -sV -p- -T4 --min-rate 500 -oA scan_full 192.168.1.100</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"练习-3：识别潜在的安全风险端口\"><a href=\"#练习-3：识别潜在的安全风险端口\" class=\"headerlink\" title=\"练习 3：识别潜在的安全风险端口\"></a>练习 3：识别潜在的安全风险端口</h3><p><strong>场景</strong>：扫描发现以下开放端口，评估风险。</p>\n<table>\n<thead>\n<tr>\n<th>端口</th>\n<th>服务</th>\n<th>风险等级</th>\n<th>原因</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>22</td>\n<td>SSH</td>\n<td>⚠️ 中</td>\n<td>需检查密码强度、是否禁用 root 登录</td>\n</tr>\n<tr>\n<td>23</td>\n<td>Telnet</td>\n<td>🚨 极高</td>\n<td>明文传输，必须禁用</td>\n</tr>\n<tr>\n<td>80</td>\n<td>HTTP</td>\n<td>⚠️ 中</td>\n<td>明文传输，敏感数据应用 HTTPS</td>\n</tr>\n<tr>\n<td>3306</td>\n<td>MySQL</td>\n<td>🚨 高</td>\n<td>数据库不应直接暴露，应通过跳板机</td>\n</tr>\n<tr>\n<td>3389</td>\n<td>RDP</td>\n<td>🚨 高</td>\n<td>容易被暴力破解，应限制 IP</td>\n</tr>\n<tr>\n<td>5900</td>\n<td>VNC</td>\n<td>🚨 高</td>\n<td>默认无加密，易被劫持</td>\n</tr>\n<tr>\n<td>8080</td>\n<td>HTTP</td>\n<td>⚠️ 中</td>\n<td>检查是否为测试服务，不应对公网开放</td>\n</tr>\n</tbody></table>\n<hr>\n<h2 id=\"五、评估标准\"><a href=\"#五、评估标准\" class=\"headerlink\" title=\"五、评估标准\"></a>五、评估标准</h2><ul>\n<li>✅ 报告里写清授权范围（目标&#x2F;窗口&#x2F;理由）</li>\n<li>✅ 至少导出一份扫描结果文件（<code>.txt</code> 或 <code>.xml</code>）</li>\n<li>✅ 能读懂输出中的”open&#x2F;closed&#x2F;filtered”并写一句解释</li>\n<li>✅ 能识别 3 个以上的高风险端口</li>\n<li>✅ 能解释 <code>-sS</code> 和 <code>-sT</code> 的区别</li>\n</ul>\n<hr>\n<h2 id=\"六、参考资料\"><a href=\"#六、参考资料\" class=\"headerlink\" title=\"六、参考资料\"></a>六、参考资料</h2><h3 id=\"官方文档\"><a href=\"#官方文档\" class=\"headerlink\" title=\"官方文档\"></a>官方文档</h3><ul>\n<li><a href=\"https://nmap.org/book/man.html\">Nmap 官方文档</a></li>\n<li><a href=\"https://nmap.org/nsedoc/\">Nmap 脚本引擎（NSE）</a></li>\n<li><a href=\"https://www.iana.org/assignments/service-names-port-numbers/\">端口服务对照表</a></li>\n</ul>\n<h3 id=\"进阶阅读\"><a href=\"#进阶阅读\" class=\"headerlink\" title=\"进阶阅读\"></a>进阶阅读</h3><ul>\n<li>《Nmap Network Scanning》（官方书籍）</li>\n<li><a href=\"https://www.stationx.net/nmap-cheat-sheet/\">Nmap Cheat Sheet</a></li>\n</ul>\n<hr>\n<h2 id=\"七、学习成果达成情况（由学习者填写）\"><a href=\"#七、学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"七、学习成果达成情况（由学习者填写）\"></a>七、学习成果达成情况（由学习者填写）</h2><h3 id=\"授权记录（必填）\"><a href=\"#授权记录（必填）\" class=\"headerlink\" title=\"授权记录（必填）\"></a>授权记录（必填）</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">目标：</span><br><span class=\"line\">授权类型：</span><br><span class=\"line\">扫描窗口：</span><br><span class=\"line\">目的：</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"截图与证据\"><a href=\"#截图与证据\" class=\"headerlink\" title=\"截图与证据\"></a>截图与证据</h3><ul>\n<li><input disabled=\"\" type=\"checkbox\"> <code>day019_scan.txt</code> 文件存在证据</li>\n<li><input disabled=\"\" type=\"checkbox\"> 扫描输出截图（至少显示 1 个开放端口）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 整理的端口&#x2F;服务&#x2F;版本表格</li>\n</ul>\n<h3 id=\"关键命令与输出\"><a href=\"#关键命令与输出\" class=\"headerlink\" title=\"关键命令与输出\"></a>关键命令与输出</h3><p><strong>执行的命令</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[粘贴你的命令]</span><br></pre></td></tr></table></figure>\n\n<p><strong>关键输出片段</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">[粘贴 PORT/STATE/SERVICE/VERSION 部分]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"结论与反思\"><a href=\"#结论与反思\" class=\"headerlink\" title=\"结论与反思\"></a>结论与反思</h3><ul>\n<li><p><strong>我发现的开放端口</strong>：</p>\n</li>\n<li><p><strong>我识别的高风险端口</strong>：</p>\n</li>\n<li><p><strong>我下一步要做的枚举验证</strong>：</p>\n</li>\n</ul>\n<hr>\n<p><strong>恭喜！你已掌握 Nmap 端口扫描的核心技能。明天我们将学习服务枚举与指纹识别，进一步确认服务类型与版本！</strong> 🎉</p>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day020：操作系统与脚本 - 服务枚举与指纹识别","url":"/post/404be563.html","content":"<h1 id=\"Day020：操作系统与脚本-服务枚举与指纹识别\"><a href=\"#Day020：操作系统与脚本-服务枚举与指纹识别\" class=\"headerlink\" title=\"Day020：操作系统与脚本 - 服务枚举与指纹识别\"></a>Day020：操作系统与脚本 - 服务枚举与指纹识别</h1><ul>\n<li>日期：2026-01-13</li>\n<li>周次：第 3 周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p>学完今天你应该能做到：</p>\n<ul>\n<li>能解释”枚举”在做什么：<strong>确认服务是什么+版本是什么+响应特征是什么</strong></li>\n<li>知道 Banner 不可靠，并能用”两种方法交叉验证”</li>\n<li>用最小脚本把扫描结果整理成”服务矩阵”（host×port×service×version）</li>\n<li>掌握常见服务的指纹识别技巧（HTTP&#x2F;SSH&#x2F;MySQL&#x2F;RDP）</li>\n<li>能输出一份结构化的服务清单（CSV&#x2F;JSON）</li>\n</ul>\n<hr>\n<span id=\"more\"></span>\n\n<h2 id=\"一、什么是服务枚举？\"><a href=\"#一、什么是服务枚举？\" class=\"headerlink\" title=\"一、什么是服务枚举？\"></a>一、什么是服务枚举？</h2><h3 id=\"1-1-端口扫描-vs-服务枚举\"><a href=\"#1-1-端口扫描-vs-服务枚举\" class=\"headerlink\" title=\"1.1 端口扫描 vs 服务枚举\"></a>1.1 端口扫描 vs 服务枚举</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">端口扫描（Day019）</span><br><span class=\"line\">├─ 目标：发现哪些端口开放</span><br><span class=\"line\">├─ 方法：发送 SYN/TCP 探测</span><br><span class=\"line\">└─ 结果：端口号 + 状态（open/closed/filtered）</span><br><span class=\"line\"></span><br><span class=\"line\">服务枚举（Day020）</span><br><span class=\"line\">├─ 目标：确认服务类型、版本、配置</span><br><span class=\"line\">├─ 方法：发送协议特定的握手/请求</span><br><span class=\"line\">└─ 结果：服务名 + 版本号 + Banner + 响应特征</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-2-为什么-Banner-不可靠？\"><a href=\"#1-2-为什么-Banner-不可靠？\" class=\"headerlink\" title=\"1.2 为什么 Banner 不可靠？\"></a>1.2 为什么 Banner 不可靠？</h3><table>\n<thead>\n<tr>\n<th>场景</th>\n<th>Banner 显示</th>\n<th>真实情况</th>\n<th>原因</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>伪装</strong></td>\n<td><code>Apache/2.4.41</code></td>\n<td>实际是 Nginx</td>\n<td>管理员手动修改响应头</td>\n</tr>\n<tr>\n<td><strong>代理</strong></td>\n<td><code>Microsoft-IIS/10.0</code></td>\n<td>后端是 Tomcat</td>\n<td>前端有 IIS 反向代理</td>\n</tr>\n<tr>\n<td><strong>隐藏版本</strong></td>\n<td><code>nginx</code></td>\n<td>Nginx 1.18.0</td>\n<td>编译时关闭版本显示</td>\n</tr>\n<tr>\n<td><strong>WAF</strong></td>\n<td><code>Cloudflare</code></td>\n<td>后端未知</td>\n<td>CDN&#x2F;WAF 屏蔽真实指纹</td>\n</tr>\n</tbody></table>\n<p><strong>结论</strong>：Banner 只能当线索，必须交叉验证！</p>\n<hr>\n<h2 id=\"二、常见服务的枚举技巧\"><a href=\"#二、常见服务的枚举技巧\" class=\"headerlink\" title=\"二、常见服务的枚举技巧\"></a>二、常见服务的枚举技巧</h2><h3 id=\"2-1-HTTP-x2F-HTTPS-服务\"><a href=\"#2-1-HTTP-x2F-HTTPS-服务\" class=\"headerlink\" title=\"2.1 HTTP&#x2F;HTTPS 服务\"></a>2.1 HTTP&#x2F;HTTPS 服务</h3><h4 id=\"方法-1：curl-查看响应头\"><a href=\"#方法-1：curl-查看响应头\" class=\"headerlink\" title=\"方法 1：curl 查看响应头\"></a>方法 1：curl 查看响应头</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Windows PowerShell</span></span><br><span class=\"line\">curl.exe -I http://192.168.1.100</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Linux/macOS</span></span><br><span class=\"line\">curl -I http://192.168.1.100</span><br></pre></td></tr></table></figure>\n\n<p><strong>关键字段</strong>：</p>\n<ul>\n<li><code>Server: Apache/2.4.41 (Ubuntu)</code>（服务器类型与版本）</li>\n<li><code>X-Powered-By: PHP/7.4.3</code>（后端语言）</li>\n<li><code>Set-Cookie: PHPSESSID=...</code>（会话管理方式）</li>\n</ul>\n<h4 id=\"方法-2：浏览器开发者工具\"><a href=\"#方法-2：浏览器开发者工具\" class=\"headerlink\" title=\"方法 2：浏览器开发者工具\"></a>方法 2：浏览器开发者工具</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">1. 打开 Chrome/Firefox</span><br><span class=\"line\">2. 按 F12 打开开发者工具</span><br><span class=\"line\">3. 访问 http://192.168.1.100</span><br><span class=\"line\">4. 查看 Network 标签 → Headers</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"方法-3：Nmap-NSE-脚本\"><a href=\"#方法-3：Nmap-NSE-脚本\" class=\"headerlink\" title=\"方法 3：Nmap NSE 脚本\"></a>方法 3：Nmap NSE 脚本</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">nmap -p 80 --script http-headers 192.168.1.100</span><br><span class=\"line\">nmap -p 80 --script http-title 192.168.1.100</span><br><span class=\"line\">nmap -p 80 --script http-methods 192.168.1.100</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2-2-SSH-服务\"><a href=\"#2-2-SSH-服务\" class=\"headerlink\" title=\"2.2 SSH 服务\"></a>2.2 SSH 服务</h3><h4 id=\"方法-1：Telnet-x2F-Netcat-获取-Banner\"><a href=\"#方法-1：Telnet-x2F-Netcat-获取-Banner\" class=\"headerlink\" title=\"方法 1：Telnet&#x2F;Netcat 获取 Banner\"></a>方法 1：Telnet&#x2F;Netcat 获取 Banner</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Windows</span></span><br><span class=\"line\">telnet 192.168.1.100 22</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Linux/macOS</span></span><br><span class=\"line\">nc 192.168.1.100 22</span><br></pre></td></tr></table></figure>\n\n<p><strong>预期输出</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">SSH-2.0-OpenSSH_8.9p1 Ubuntu-3ubuntu0.1</span><br></pre></td></tr></table></figure>\n\n<p><strong>解读</strong>：</p>\n<ul>\n<li><code>SSH-2.0</code>：协议版本</li>\n<li><code>OpenSSH_8.9p1</code>：服务软件与版本</li>\n<li><code>Ubuntu-3ubuntu0.1</code>：操作系统与补丁级别</li>\n</ul>\n<h4 id=\"方法-2：ssh-命令详细模式\"><a href=\"#方法-2：ssh-命令详细模式\" class=\"headerlink\" title=\"方法 2：ssh 命令详细模式\"></a>方法 2：ssh 命令详细模式</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">ssh -vvv 192.168.1.100 2&gt;&amp;1 | grep <span class=\"string\">&quot;remote software version&quot;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2-3-MySQL-x2F-MariaDB\"><a href=\"#2-3-MySQL-x2F-MariaDB\" class=\"headerlink\" title=\"2.3 MySQL&#x2F;MariaDB\"></a>2.3 MySQL&#x2F;MariaDB</h3><h4 id=\"方法-1：Nmap-探测\"><a href=\"#方法-1：Nmap-探测\" class=\"headerlink\" title=\"方法 1：Nmap 探测\"></a>方法 1：Nmap 探测</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">nmap -p 3306 --script mysql-info 192.168.1.100</span><br></pre></td></tr></table></figure>\n\n<p><strong>预期输出</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">3306/tcp open  mysql</span><br><span class=\"line\">| mysql-info:</span><br><span class=\"line\">|   Protocol: 10</span><br><span class=\"line\">|   Version: 5.7.42-0ubuntu0.18.04.1</span><br><span class=\"line\">|   Thread ID: 123</span><br><span class=\"line\">|   Capabilities flags: 65535</span><br><span class=\"line\">|   Some Capabilities: SupportsTransactions, LongColumnFlag, Support41Auth</span><br><span class=\"line\">|   Status: Autocommit</span><br><span class=\"line\">|   Salt: xxx</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"方法-2：MySQL-客户端连接\"><a href=\"#方法-2：MySQL-客户端连接\" class=\"headerlink\" title=\"方法 2：MySQL 客户端连接\"></a>方法 2：MySQL 客户端连接</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql -h 192.168.1.100 -u root -p</span><br></pre></td></tr></table></figure>\n\n<p><strong>如果允许匿名登录</strong>（极不安全）：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql -h 192.168.1.100</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2-4-RDP（远程桌面）\"><a href=\"#2-4-RDP（远程桌面）\" class=\"headerlink\" title=\"2.4 RDP（远程桌面）\"></a>2.4 RDP（远程桌面）</h3><h4 id=\"方法-1：Nmap-探测-1\"><a href=\"#方法-1：Nmap-探测-1\" class=\"headerlink\" title=\"方法 1：Nmap 探测\"></a>方法 1：Nmap 探测</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">nmap -p 3389 --script rdp-ntlm-info 192.168.1.100</span><br></pre></td></tr></table></figure>\n\n<p><strong>预期输出</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">3389/tcp open  ms-wbt-server</span><br><span class=\"line\">| rdp-ntlm-info:</span><br><span class=\"line\">|   Target_Name: WIN-SERVER</span><br><span class=\"line\">|   NetBIOS_Domain_Name: WORKGROUP</span><br><span class=\"line\">|   DNS_Domain_Name: WIN-SERVER</span><br><span class=\"line\">|   DNS_Computer_Name: WIN-SERVER</span><br><span class=\"line\">|   Product_Version: 10.0.17763</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"方法-2：rdesktop-x2F-mstsc-连接测试\"><a href=\"#方法-2：rdesktop-x2F-mstsc-连接测试\" class=\"headerlink\" title=\"方法 2：rdesktop&#x2F;mstsc 连接测试\"></a>方法 2：rdesktop&#x2F;mstsc 连接测试</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Linux</span></span><br><span class=\"line\">rdesktop -u <span class=\"built_in\">test</span> 192.168.1.100</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Windows</span></span><br><span class=\"line\">mstsc /v:192.168.1.100</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2-5-SMB（文件共享）\"><a href=\"#2-5-SMB（文件共享）\" class=\"headerlink\" title=\"2.5 SMB（文件共享）\"></a>2.5 SMB（文件共享）</h3><h4 id=\"方法-1：Nmap-探测-2\"><a href=\"#方法-1：Nmap-探测-2\" class=\"headerlink\" title=\"方法 1：Nmap 探测\"></a>方法 1：Nmap 探测</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">nmap -p 445 --script smb-os-discovery 192.168.1.100</span><br></pre></td></tr></table></figure>\n\n<p><strong>预期输出</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">445/tcp open  microsoft-ds</span><br><span class=\"line\">| smb-os-discovery:</span><br><span class=\"line\">|   OS: Windows Server 2019 Standard 17763</span><br><span class=\"line\">|   Computer name: WIN-SERVER</span><br><span class=\"line\">|   NetBIOS computer name: WIN-SERVER\\x00</span><br><span class=\"line\">|   Workgroup: WORKGROUP\\x00</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"方法-2：smbclient-枚举共享\"><a href=\"#方法-2：smbclient-枚举共享\" class=\"headerlink\" title=\"方法 2：smbclient 枚举共享\"></a>方法 2：smbclient 枚举共享</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">smbclient -L 192.168.1.100 -N</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"三、自动化脚本：解析-Nmap-结果\"><a href=\"#三、自动化脚本：解析-Nmap-结果\" class=\"headerlink\" title=\"三、自动化脚本：解析 Nmap 结果\"></a>三、自动化脚本：解析 Nmap 结果</h2><h3 id=\"3-1-Python-脚本解析-Nmap-XML\"><a href=\"#3-1-Python-脚本解析-Nmap-XML\" class=\"headerlink\" title=\"3.1 Python 脚本解析 Nmap XML\"></a>3.1 Python 脚本解析 Nmap XML</h3><p><strong>目标</strong>：将 Nmap XML 输出转换为 CSV 表格。</p>\n<p><strong>步骤 1</strong>：用 Nmap 扫描并输出 XML</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">nmap -sV -oX scan.xml 192.168.1.100</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 2</strong>：Python 脚本解析</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> xml.etree.ElementTree <span class=\"keyword\">as</span> ET</span><br><span class=\"line\"><span class=\"keyword\">import</span> csv</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 解析 XML</span></span><br><span class=\"line\">tree = ET.parse(<span class=\"string\">&quot;scan.xml&quot;</span>)</span><br><span class=\"line\">root = tree.getroot()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 提取结果</span></span><br><span class=\"line\">results = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> host <span class=\"keyword\">in</span> root.findall(<span class=\"string\">&quot;host&quot;</span>):</span><br><span class=\"line\">    ip = host.find(<span class=\"string\">&quot;address&quot;</span>).get(<span class=\"string\">&quot;addr&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> port <span class=\"keyword\">in</span> host.find(<span class=\"string\">&quot;ports&quot;</span>).findall(<span class=\"string\">&quot;port&quot;</span>):</span><br><span class=\"line\">        portid = port.get(<span class=\"string\">&quot;portid&quot;</span>)</span><br><span class=\"line\">        state = port.find(<span class=\"string\">&quot;state&quot;</span>).get(<span class=\"string\">&quot;state&quot;</span>)</span><br><span class=\"line\">        service = port.find(<span class=\"string\">&quot;service&quot;</span>)</span><br><span class=\"line\">        service_name = service.get(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;unknown&quot;</span>) <span class=\"keyword\">if</span> service <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span> <span class=\"keyword\">else</span> <span class=\"string\">&quot;unknown&quot;</span></span><br><span class=\"line\">        version = service.get(<span class=\"string\">&quot;product&quot;</span>, <span class=\"string\">&quot;&quot;</span>) <span class=\"keyword\">if</span> service <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span> <span class=\"keyword\">else</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">        results.append([ip, portid, state, service_name, version])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 写入 CSV</span></span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&quot;scan_results.csv&quot;</span>, <span class=\"string\">&quot;w&quot;</span>, newline=<span class=\"string\">&quot;&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    writer = csv.writer(f)</span><br><span class=\"line\">    writer.writerow([<span class=\"string\">&quot;IP&quot;</span>, <span class=\"string\">&quot;Port&quot;</span>, <span class=\"string\">&quot;State&quot;</span>, <span class=\"string\">&quot;Service&quot;</span>, <span class=\"string\">&quot;Version&quot;</span>])</span><br><span class=\"line\">    writer.writerows(results)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">f&quot;✅ 已导出 <span class=\"subst\">&#123;<span class=\"built_in\">len</span>(results)&#125;</span> 条结果到 scan_results.csv&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"3-2-PowerShell-脚本解析-Nmap-文本输出\"><a href=\"#3-2-PowerShell-脚本解析-Nmap-文本输出\" class=\"headerlink\" title=\"3.2 PowerShell 脚本解析 Nmap 文本输出\"></a>3.2 PowerShell 脚本解析 Nmap 文本输出</h3><p><strong>目标</strong>：从 <code>day019_scan.txt</code> 提取端口&#x2F;服务&#x2F;版本。</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$results</span> = <span class=\"selector-tag\">@</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Get-Content</span> .\\day019_scan.txt | <span class=\"built_in\">ForEach-Object</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable\">$_</span> <span class=\"operator\">-match</span> <span class=\"string\">&quot;(\\d+)/tcp\\s+(\\w+)\\s+(\\S+)\\s+(.*)&quot;</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$results</span> += [<span class=\"type\">PSCustomObject</span>]<span class=\"selector-tag\">@</span>&#123;</span><br><span class=\"line\">            Port = <span class=\"variable\">$matches</span>[<span class=\"number\">1</span>]</span><br><span class=\"line\">            State = <span class=\"variable\">$matches</span>[<span class=\"number\">2</span>]</span><br><span class=\"line\">            Service = <span class=\"variable\">$matches</span>[<span class=\"number\">3</span>]</span><br><span class=\"line\">            Version = <span class=\"variable\">$matches</span>[<span class=\"number\">4</span>]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$results</span> | <span class=\"built_in\">Export-Csv</span> <span class=\"literal\">-Path</span> .\\scan_summary.csv <span class=\"literal\">-NoTypeInformation</span></span><br><span class=\"line\"><span class=\"built_in\">Write-Output</span> <span class=\"string\">&quot;✅ 已导出 <span class=\"variable\">$</span>(<span class=\"variable\">$results</span>.Count) 条结果&quot;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"四、实战任务\"><a href=\"#四、实战任务\" class=\"headerlink\" title=\"四、实战任务\"></a>四、实战任务</h2><h3 id=\"任务-1：枚举本机开放的-Web-服务\"><a href=\"#任务-1：枚举本机开放的-Web-服务\" class=\"headerlink\" title=\"任务 1：枚举本机开放的 Web 服务\"></a>任务 1：枚举本机开放的 Web 服务</h3><p><strong>场景</strong>：本机运行了一个 Web 服务（如 IIS&#x2F;Apache&#x2F;Nginx），需要确认版本。</p>\n<p><strong>步骤 1</strong>：确认 Web 服务正在运行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">nmap -p 80,443,8080 127.0.0.1</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 2</strong>：获取 HTTP 响应头</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">curl.exe -I http://127.0.0.1</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 3</strong>：记录关键信息</p>\n<ul>\n<li>Server 字段：</li>\n<li>X-Powered-By 字段：</li>\n<li>其他特征字段：</li>\n</ul>\n<hr>\n<h3 id=\"任务-2：枚举虚拟机的-SSH-服务\"><a href=\"#任务-2：枚举虚拟机的-SSH-服务\" class=\"headerlink\" title=\"任务 2：枚举虚拟机的 SSH 服务\"></a>任务 2：枚举虚拟机的 SSH 服务</h3><p><strong>场景</strong>：有一台 Linux 虚拟机，需要确认 SSH 版本。</p>\n<p><strong>步骤 1</strong>：获取 SSH Banner</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">nc 192.168.1.100 22</span><br><span class=\"line\"><span class=\"comment\"># 或</span></span><br><span class=\"line\">telnet 192.168.1.100 22</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 2</strong>：用 Nmap 验证</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">nmap -p 22 -sV 192.168.1.100</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 3</strong>：对比结果</p>\n<ul>\n<li>Netcat Banner：</li>\n<li>Nmap 探测结果：</li>\n<li>是否一致：</li>\n</ul>\n<hr>\n<h3 id=\"任务-3：批量枚举多个主机\"><a href=\"#任务-3：批量枚举多个主机\" class=\"headerlink\" title=\"任务 3：批量枚举多个主机\"></a>任务 3：批量枚举多个主机</h3><p><strong>场景</strong>：有 3 台主机（192.168.1.100-102），批量枚举。</p>\n<p><strong>步骤 1</strong>：批量扫描</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">nmap -sV -oX multi_scan.xml 192.168.1.100-102</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 2</strong>：用 Python 脚本解析（参考 3.1）</p>\n<p><strong>步骤 3</strong>：整理成表格</p>\n<table>\n<thead>\n<tr>\n<th>IP</th>\n<th>Port</th>\n<th>Service</th>\n<th>Version</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n</tr>\n</tbody></table>\n<hr>\n<h2 id=\"五、巩固练习\"><a href=\"#五、巩固练习\" class=\"headerlink\" title=\"五、巩固练习\"></a>五、巩固练习</h2><h3 id=\"练习-1：解释为什么需要交叉验证\"><a href=\"#练习-1：解释为什么需要交叉验证\" class=\"headerlink\" title=\"练习 1：解释为什么需要交叉验证\"></a>练习 1：解释为什么需要交叉验证</h3><p><strong>参考答案</strong>：</p>\n<ul>\n<li>Banner 可以被伪装（管理员手动修改）</li>\n<li>反向代理会改变响应头</li>\n<li>WAF&#x2F;CDN 会屏蔽真实指纹</li>\n<li>因此需要用多种方法（Nmap&#x2F;curl&#x2F;手动连接）交叉验证</li>\n</ul>\n<hr>\n<h3 id=\"练习-2：识别以下-HTTP-响应头的关键信息\"><a href=\"#练习-2：识别以下-HTTP-响应头的关键信息\" class=\"headerlink\" title=\"练习 2：识别以下 HTTP 响应头的关键信息\"></a>练习 2：识别以下 HTTP 响应头的关键信息</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 200 OK</span><br><span class=\"line\">Server: Apache/2.4.41 (Ubuntu)</span><br><span class=\"line\">X-Powered-By: PHP/7.4.3</span><br><span class=\"line\">Set-Cookie: PHPSESSID=abc123</span><br></pre></td></tr></table></figure>\n\n<p><strong>参考答案</strong>：</p>\n<ul>\n<li>Web 服务器：Apache 2.4.41</li>\n<li>操作系统：Ubuntu</li>\n<li>后端语言：PHP 7.4.3</li>\n<li>会话管理：使用 Cookie（PHPSESSID）</li>\n</ul>\n<hr>\n<h3 id=\"练习-3：设计一套服务枚举流程\"><a href=\"#练习-3：设计一套服务枚举流程\" class=\"headerlink\" title=\"练习 3：设计一套服务枚举流程\"></a>练习 3：设计一套服务枚举流程</h3><p><strong>参考答案</strong>：</p>\n<ol>\n<li>端口扫描：<code>nmap -sV -oX scan.xml target</code></li>\n<li>HTTP 枚举：<code>curl -I http://target</code></li>\n<li>SSH 枚举：<code>nc target 22</code></li>\n<li>数据库枚举：<code>nmap --script mysql-info target</code></li>\n<li>交叉验证：对比 Nmap 和手动结果</li>\n<li>输出报告：整理成 CSV&#x2F;JSON</li>\n</ol>\n<hr>\n<h2 id=\"六、评估标准\"><a href=\"#六、评估标准\" class=\"headerlink\" title=\"六、评估标准\"></a>六、评估标准</h2><ul>\n<li>✅ 能用 curl 获取 HTTP 响应头</li>\n<li>✅ 能用 nc&#x2F;telnet 获取 SSH Banner</li>\n<li>✅ 能用 Nmap NSE 脚本枚举服务</li>\n<li>✅ 能用 Python&#x2F;PowerShell 脚本解析 Nmap 输出</li>\n<li>✅ 能输出一份结构化的服务清单（CSV）</li>\n</ul>\n<hr>\n<h2 id=\"七、参考资料\"><a href=\"#七、参考资料\" class=\"headerlink\" title=\"七、参考资料\"></a>七、参考资料</h2><ul>\n<li><a href=\"https://nmap.org/nsedoc/\">Nmap NSE 脚本库</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers\">HTTP 响应头字段</a></li>\n<li><a href=\"https://www.openssh.com/specs.html\">SSH Protocol Documentation</a></li>\n</ul>\n<hr>\n<h2 id=\"八、学习成果达成情况（由学习者填写）\"><a href=\"#八、学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"八、学习成果达成情况（由学习者填写）\"></a>八、学习成果达成情况（由学习者填写）</h2><h3 id=\"截图与证据\"><a href=\"#截图与证据\" class=\"headerlink\" title=\"截图与证据\"></a>截图与证据</h3><ul>\n<li><input disabled=\"\" type=\"checkbox\"> curl 响应头截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> SSH Banner 截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> Nmap 枚举结果截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 生成的 CSV 文件</li>\n</ul>\n<h3 id=\"关键发现\"><a href=\"#关键发现\" class=\"headerlink\" title=\"关键发现\"></a>关键发现</h3><p><strong>HTTP 服务</strong>：</p>\n<ul>\n<li>Server：</li>\n<li>版本：</li>\n</ul>\n<p><strong>SSH 服务</strong>：</p>\n<ul>\n<li>Banner：</li>\n<li>版本：</li>\n</ul>\n<h3 id=\"结论与反思\"><a href=\"#结论与反思\" class=\"headerlink\" title=\"结论与反思\"></a>结论与反思</h3><ul>\n<li><strong>我发现的服务版本</strong>：</li>\n<li><strong>我识别的潜在漏洞</strong>：</li>\n<li><strong>我下一步要做的验证</strong>：</li>\n</ul>\n<hr>\n<p><strong>恭喜！你已掌握服务枚举与指纹识别的核心技能。明天我们将进行第 3 周综合实验，整合本周所学知识！</strong> 🎉</p>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day022：漏洞扫描与基线 - 漏洞类型与编号体系","url":"/post/6de128c9.html","content":"<h1 id=\"Day022：漏洞扫描与基线-漏洞类型与编号体系\"><a href=\"#Day022：漏洞扫描与基线-漏洞类型与编号体系\" class=\"headerlink\" title=\"Day022：漏洞扫描与基线 - 漏洞类型与编号体系\"></a>Day022：漏洞扫描与基线 - 漏洞类型与编号体系</h1><ul>\n<li>日期：2026-01-15</li>\n<li>周次：第4周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p>今天你将搞清楚：</p>\n<ul>\n<li><strong>CVE&#x2F;CWE&#x2F;CVSS</strong> 三个编号体系分别做什么用</li>\n<li>能根据 <strong>CVSS 评分</strong>初步判断漏洞风险等级</li>\n<li>理解常见漏洞分类（配置类&#x2F;逻辑类&#x2F;输入校验类等）</li>\n<li>能快速查阅官方漏洞数据库并理解缓解建议</li>\n</ul>\n<hr>\n<span id=\"more\"></span>\n\n<h2 id=\"学习内容\"><a href=\"#学习内容\" class=\"headerlink\" title=\"学习内容\"></a>学习内容</h2><h3 id=\"1️⃣-漏洞编号体系三兄弟：CVE-x2F-CWE-x2F-CVSS\"><a href=\"#1️⃣-漏洞编号体系三兄弟：CVE-x2F-CWE-x2F-CVSS\" class=\"headerlink\" title=\"1️⃣ 漏洞编号体系三兄弟：CVE&#x2F;CWE&#x2F;CVSS\"></a>1️⃣ 漏洞编号体系三兄弟：CVE&#x2F;CWE&#x2F;CVSS</h3><p>在网络安全领域，漏洞管理有三个核心编号体系，就像给漏洞办”身份证”：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">漏洞管理三要素</span><br><span class=\"line\">├─ CVE  → 漏洞的&quot;身份证号&quot;（这是哪个漏洞）</span><br><span class=\"line\">├─ CWE  → 漏洞的&quot;病因分类&quot;（这是什么类型的漏洞）</span><br><span class=\"line\">└─ CVSS → 漏洞的&quot;危险程度&quot;（这个漏洞有多严重）</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"CVE（Common-Vulnerabilities-and-Exposures）\"><a href=\"#CVE（Common-Vulnerabilities-and-Exposures）\" class=\"headerlink\" title=\"CVE（Common Vulnerabilities and Exposures）\"></a>CVE（Common Vulnerabilities and Exposures）</h4><p><strong>定义</strong>：漏洞的唯一标识符，由 MITRE 组织维护。</p>\n<p><strong>格式</strong>：<code>CVE-年份-编号</code><br><strong>示例</strong>：<code>CVE-2021-44228</code>（Log4Shell）</p>\n<p><strong>作用</strong>：</p>\n<ul>\n<li>全球统一引用标准</li>\n<li>避免同一漏洞被不同厂商用不同名字描述</li>\n<li>方便跨平台、跨工具追踪</li>\n</ul>\n<p><strong>查询地址</strong>：</p>\n<ul>\n<li><a href=\"https://cve.mitre.org/\">https://cve.mitre.org</a></li>\n<li><a href=\"https://nvd.nist.gov(美国国家漏洞数据库,包含更详细评分和缓解建议)/\">https://nvd.nist.gov（美国国家漏洞数据库，包含更详细评分和缓解建议）</a></li>\n</ul>\n<h4 id=\"CWE（Common-Weakness-Enumeration）\"><a href=\"#CWE（Common-Weakness-Enumeration）\" class=\"headerlink\" title=\"CWE（Common Weakness Enumeration）\"></a>CWE（Common Weakness Enumeration）</h4><p><strong>定义</strong>：软件缺陷&#x2F;弱点的分类体系，描述”漏洞的根本原因”。</p>\n<p><strong>格式</strong>：<code>CWE-编号</code><br><strong>示例</strong>：</p>\n<ul>\n<li><code>CWE-79</code>: Cross-site Scripting (XSS)</li>\n<li><code>CWE-89</code>: SQL Injection</li>\n<li><code>CWE-78</code>: OS Command Injection</li>\n<li><code>CWE-287</code>: Improper Authentication</li>\n</ul>\n<p><strong>作用</strong>：</p>\n<ul>\n<li>帮助开发者理解漏洞本质</li>\n<li>用于代码审计工具的规则分类</li>\n<li>指导安全编码规范</li>\n</ul>\n<p><strong>查询地址</strong>：<a href=\"https://cwe.mitre.org/\">https://cwe.mitre.org</a></p>\n<h4 id=\"CVSS（Common-Vulnerability-Scoring-System）\"><a href=\"#CVSS（Common-Vulnerability-Scoring-System）\" class=\"headerlink\" title=\"CVSS（Common Vulnerability Scoring System）\"></a>CVSS（Common Vulnerability Scoring System）</h4><p><strong>定义</strong>：漏洞严重程度的标准化评分系统（0-10分）。</p>\n<p><strong>版本</strong>：目前主流为 <strong>CVSS v3.1</strong>（2019年发布）</p>\n<p><strong>评分维度</strong>（Base Score）：</p>\n<ol>\n<li><p><strong>Attack Vector (AV)</strong> - 攻击向量</p>\n<ul>\n<li>Network (N): 远程攻击</li>\n<li>Adjacent (A): 相邻网络攻击</li>\n<li>Local (L): 本地访问</li>\n<li>Physical (P): 物理接触</li>\n</ul>\n</li>\n<li><p><strong>Attack Complexity (AC)</strong> - 攻击复杂度</p>\n<ul>\n<li>Low (L): 容易利用</li>\n<li>High (H): 需要特殊条件</li>\n</ul>\n</li>\n<li><p><strong>Privileges Required (PR)</strong> - 所需权限</p>\n<ul>\n<li>None (N): 无需权限</li>\n<li>Low (L): 普通用户权限</li>\n<li>High (H): 管理员权限</li>\n</ul>\n</li>\n<li><p><strong>User Interaction (UI)</strong> - 用户交互</p>\n<ul>\n<li>None (N): 无需用户操作</li>\n<li>Required (R): 需要用户点击&#x2F;操作</li>\n</ul>\n</li>\n<li><p><strong>Scope (S)</strong> - 影响范围</p>\n<ul>\n<li>Unchanged (U): 仅影响vulnerable component</li>\n<li>Changed (C): 影响其他组件</li>\n</ul>\n</li>\n<li><p><strong>CIA Impact</strong> - 机密性&#x2F;完整性&#x2F;可用性影响</p>\n<ul>\n<li>None (N) &#x2F; Low (L) &#x2F; High (H)</li>\n</ul>\n</li>\n</ol>\n<p><strong>风险等级分级</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>分数区间</th>\n<th>等级</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>0.0</td>\n<td>None</td>\n<td>无风险</td>\n</tr>\n<tr>\n<td>0.1-3.9</td>\n<td>🟢 Low</td>\n<td>低危</td>\n</tr>\n<tr>\n<td>4.0-6.9</td>\n<td>🟡 Medium</td>\n<td>中危</td>\n</tr>\n<tr>\n<td>7.0-8.9</td>\n<td>🟠 High</td>\n<td>高危</td>\n</tr>\n<tr>\n<td>9.0-10.0</td>\n<td>🔴 Critical</td>\n<td>严重</td>\n</tr>\n</tbody></table>\n<p><strong>查询地址</strong>：<a href=\"https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator\">https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator</a></p>\n<hr>\n<h3 id=\"2️⃣-常见漏洞分类（按成因）\"><a href=\"#2️⃣-常见漏洞分类（按成因）\" class=\"headerlink\" title=\"2️⃣ 常见漏洞分类（按成因）\"></a>2️⃣ 常见漏洞分类（按成因）</h3><table>\n<thead>\n<tr>\n<th>类别</th>\n<th>代表性 CWE</th>\n<th>常见场景</th>\n<th>典型案例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>输入校验不足</strong></td>\n<td>CWE-20</td>\n<td>用户输入未过滤&#x2F;转义</td>\n<td>SQL 注入、XSS、命令注入</td>\n</tr>\n<tr>\n<td><strong>认证&#x2F;授权缺陷</strong></td>\n<td>CWE-287</td>\n<td>弱密码、会话劫持</td>\n<td>未经认证的 API 访问</td>\n</tr>\n<tr>\n<td><strong>配置错误</strong></td>\n<td>CWE-16</td>\n<td>默认密码、权限过大</td>\n<td>数据库暴露在公网</td>\n</tr>\n<tr>\n<td><strong>加密问题</strong></td>\n<td>CWE-327</td>\n<td>弱算法、硬编码密钥</td>\n<td>使用 MD5 存储密码</td>\n</tr>\n<tr>\n<td><strong>逻辑漏洞</strong></td>\n<td>CWE-840</td>\n<td>业务流程绕过</td>\n<td>支付金额可被篡改</td>\n</tr>\n<tr>\n<td><strong>资源管理</strong></td>\n<td>CWE-400</td>\n<td>内存泄漏、DoS</td>\n<td>无限制上传导致磁盘满</td>\n</tr>\n<tr>\n<td><strong>代码注入</strong></td>\n<td>CWE-94</td>\n<td>动态执行恶意代码</td>\n<td>eval() 执行用户输入</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"3️⃣-实战案例：Log4Shell（CVE-2021-44228）\"><a href=\"#3️⃣-实战案例：Log4Shell（CVE-2021-44228）\" class=\"headerlink\" title=\"3️⃣ 实战案例：Log4Shell（CVE-2021-44228）\"></a>3️⃣ 实战案例：Log4Shell（CVE-2021-44228）</h3><p><strong>漏洞信息</strong>：</p>\n<ul>\n<li><strong>CVE</strong>: CVE-2021-44228</li>\n<li><strong>CWE</strong>: CWE-502 (Deserialization of Untrusted Data)</li>\n<li><strong>CVSS</strong>: 10.0（满分严重）</li>\n<li><strong>影响组件</strong>: Apache Log4j 2.x (&lt; 2.17.0)</li>\n</ul>\n<p><strong>CVSS 评分解析</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">AV:N  → 远程可利用（Network）</span><br><span class=\"line\">AC:L  → 攻击复杂度低（Low）</span><br><span class=\"line\">PR:N  → 无需权限（None）</span><br><span class=\"line\">UI:N  → 无需用户交互（None）</span><br><span class=\"line\">S:C   → 影响范围变化（Changed）</span><br><span class=\"line\">C:H / I:H / A:H → 机密性/完整性/可用性均为高影响</span><br></pre></td></tr></table></figure>\n\n<p><strong>为什么是 10.0 分？</strong></p>\n<ul>\n<li>远程可利用 + 无需认证 + 容易利用 + 影响全面 &#x3D; 完美风暴</li>\n</ul>\n<p><strong>缓解措施</strong>：</p>\n<ol>\n<li>立即升级到 Log4j 2.17.0+</li>\n<li>临时措施：设置 JVM 参数 <code>-Dlog4j2.formatMsgNoLookups=true</code></li>\n<li>WAF 规则拦截 <code>$&#123;jndi:</code> 特征字符串</li>\n<li>网络层面限制 LDAP&#x2F;RMI 出站流量</li>\n</ol>\n<hr>\n<h3 id=\"4️⃣-如何快速评估一个漏洞\"><a href=\"#4️⃣-如何快速评估一个漏洞\" class=\"headerlink\" title=\"4️⃣ 如何快速评估一个漏洞\"></a>4️⃣ 如何快速评估一个漏洞</h3><p><strong>五步法</strong>：</p>\n<ol>\n<li><strong>查 CVE 编号</strong> → 确认漏洞存在</li>\n<li><strong>看 CVSS 分数</strong> → 判断严重程度</li>\n<li><strong>查受影响版本</strong> → 对照自己系统版本</li>\n<li><strong>看利用条件</strong> → 评估自己是否满足被攻击条件</li>\n<li><strong>找缓解方案</strong> → 升级&#x2F;打补丁&#x2F;临时加固</li>\n</ol>\n<p><strong>典型判断逻辑</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">CVSS &gt;= 9.0  → 立即处理（24小时内）</span><br><span class=\"line\">CVSS 7.0-8.9 → 高优先级（1周内）</span><br><span class=\"line\">CVSS 4.0-6.9 → 规划修复（1个月内）</span><br><span class=\"line\">CVSS &lt; 4.0   → 低优先级（视情况处理）</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"实践任务（合法授权范围内）\"><a href=\"#实践任务（合法授权范围内）\" class=\"headerlink\" title=\"实践任务（合法授权范围内）\"></a>实践任务（合法授权范围内）</h2><h3 id=\"任务-1（必做）：查询-3-个真实-CVE-并分析\"><a href=\"#任务-1（必做）：查询-3-个真实-CVE-并分析\" class=\"headerlink\" title=\"任务 1（必做）：查询 3 个真实 CVE 并分析\"></a>任务 1（必做）：查询 3 个真实 CVE 并分析</h3><p>选择以下 3 个经典漏洞，查询并记录信息：</p>\n<table>\n<thead>\n<tr>\n<th>CVE编号</th>\n<th>名称</th>\n<th>CVSS</th>\n<th>影响组件</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>CVE-2021-44228</td>\n<td>Log4Shell</td>\n<td>10.0</td>\n<td>Apache Log4j</td>\n</tr>\n<tr>\n<td>CVE-2017-0144</td>\n<td>EternalBlue</td>\n<td>8.1</td>\n<td>Windows SMBv1</td>\n</tr>\n<tr>\n<td>CVE-2014-0160</td>\n<td>Heartbleed</td>\n<td>7.5</td>\n<td>OpenSSL</td>\n</tr>\n</tbody></table>\n<p><strong>步骤</strong>：</p>\n<ol>\n<li>访问 <a href=\"https://nvd.nist.gov/\">https://nvd.nist.gov</a></li>\n<li>搜索每个 CVE 编号</li>\n<li>记录以下信息：<ul>\n<li>CVSS Base Score</li>\n<li>Attack Vector (AV)</li>\n<li>Privileges Required (PR)</li>\n<li>影响的产品&#x2F;版本</li>\n<li>官方建议的缓解措施</li>\n</ul>\n</li>\n</ol>\n<p><strong>记录模板</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">CVE-2021-44228 (Log4Shell)</span><br><span class=\"line\">├─ CVSS: 10.0 (Critical)</span><br><span class=\"line\">├─ AV: Network (远程可利用)</span><br><span class=\"line\">├─ PR: None (无需权限)</span><br><span class=\"line\">├─ 影响: Apache Log4j 2.0 - 2.14.1</span><br><span class=\"line\">└─ 缓解: 升级至 2.17.0 或设置 formatMsgNoLookups=true</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"任务-2（必做）：使用-CVSS-计算器评估一个漏洞\"><a href=\"#任务-2（必做）：使用-CVSS-计算器评估一个漏洞\" class=\"headerlink\" title=\"任务 2（必做）：使用 CVSS 计算器评估一个漏洞\"></a>任务 2（必做）：使用 CVSS 计算器评估一个漏洞</h3><p>访问 <a href=\"https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator\">https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator</a></p>\n<p><strong>模拟场景</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">你发现一个 Web 应用漏洞：</span><br><span class=\"line\">- 攻击者可通过网络（无需认证）访问</span><br><span class=\"line\">- 利用复杂度低（只需发送特定 HTTP 请求）</span><br><span class=\"line\">- 无需用户交互</span><br><span class=\"line\">- 可读取数据库中所有用户信息（机密性影响高）</span><br><span class=\"line\">- 可修改数据（完整性影响高）</span><br><span class=\"line\">- 不影响可用性（可用性影响无）</span><br></pre></td></tr></table></figure>\n\n<p><strong>操作步骤</strong>：</p>\n<ol>\n<li><p>在计算器中选择各个维度的值：</p>\n<ul>\n<li>Attack Vector: <strong>Network</strong></li>\n<li>Attack Complexity: <strong>Low</strong></li>\n<li>Privileges Required: <strong>None</strong></li>\n<li>User Interaction: <strong>None</strong></li>\n<li>Scope: <strong>Unchanged</strong></li>\n<li>Confidentiality: <strong>High</strong></li>\n<li>Integrity: <strong>High</strong></li>\n<li>Availability: <strong>None</strong></li>\n</ul>\n</li>\n<li><p>记录生成的 CVSS 分数和向量字符串</p>\n</li>\n<li><p>判断该漏洞的风险等级（低&#x2F;中&#x2F;高&#x2F;严重）</p>\n</li>\n</ol>\n<h3 id=\"任务-3（必做）：识别-CWE-类型\"><a href=\"#任务-3（必做）：识别-CWE-类型\" class=\"headerlink\" title=\"任务 3（必做）：识别 CWE 类型\"></a>任务 3（必做）：识别 CWE 类型</h3><p>根据以下漏洞描述,匹配正确的 CWE 类型：</p>\n<p><strong>场景 A</strong>：<br>Web 应用登录页面允许无限次尝试密码，未实施账户锁定策略。</p>\n<p><strong>场景 B</strong>：<br>用户输入的文件名直接拼接到系统命令中执行，如：<code>os.system(&quot;cat &quot; + filename)</code></p>\n<p><strong>场景 C</strong>：<br>数据库密码硬编码在源代码中：<code>password = &quot;admin123&quot;</code></p>\n<p><strong>场景 D</strong>：<br>用户可修改 URL 参数中的用户 ID 查看其他人的订单详情，系统未验证权限。</p>\n<p><strong>待匹配的 CWE</strong>：</p>\n<ul>\n<li>CWE-78: OS Command Injection</li>\n<li>CWE-287: Improper Authentication</li>\n<li>CWE-798: Use of Hard-coded Credentials</li>\n<li>CWE-639: Authorization Bypass Through User-Controlled Key</li>\n</ul>\n<p><strong>提示</strong>：访问 <a href=\"https://cwe.mitre.org/\">https://cwe.mitre.org</a> 查看每个 CWE 的详细说明。</p>\n<hr>\n<h2 id=\"巩固练习（题与复盘）\"><a href=\"#巩固练习（题与复盘）\" class=\"headerlink\" title=\"巩固练习（题与复盘）\"></a>巩固练习（题与复盘）</h2><h3 id=\"题-1：CVSS-中的攻击向量（Attack-Vector）如何影响评分？\"><a href=\"#题-1：CVSS-中的攻击向量（Attack-Vector）如何影响评分？\" class=\"headerlink\" title=\"题 1：CVSS 中的攻击向量（Attack Vector）如何影响评分？\"></a>题 1：CVSS 中的攻击向量（Attack Vector）如何影响评分？</h3><p><strong>思路提示</strong>：</p>\n<ul>\n<li>Network（远程）vs Physical（物理接触）哪个更危险？</li>\n<li>为什么远程可利用的漏洞通常分数更高？</li>\n</ul>\n<h3 id=\"题-2：为什么需要-CWE-分类，只有-CVE-编号不够吗？\"><a href=\"#题-2：为什么需要-CWE-分类，只有-CVE-编号不够吗？\" class=\"headerlink\" title=\"题 2：为什么需要 CWE 分类，只有 CVE 编号不够吗？\"></a>题 2：为什么需要 CWE 分类，只有 CVE 编号不够吗？</h3><p><strong>思路提示</strong>：</p>\n<ul>\n<li>CVE 只是”这个漏洞”的编号</li>\n<li>CWE 告诉我们”这类漏洞”的根本原因</li>\n<li>对开发者和安全工程师分别有什么价值？</li>\n</ul>\n<h3 id=\"题-3：一个漏洞-CVSS-评分-9-5，但攻击需要物理接触设备，你会如何调整优先级？\"><a href=\"#题-3：一个漏洞-CVSS-评分-9-5，但攻击需要物理接触设备，你会如何调整优先级？\" class=\"headerlink\" title=\"题 3：一个漏洞 CVSS 评分 9.5，但攻击需要物理接触设备，你会如何调整优先级？\"></a>题 3：一个漏洞 CVSS 评分 9.5，但攻击需要物理接触设备，你会如何调整优先级？</h3><p><strong>思路提示</strong>：</p>\n<ul>\n<li>CVSS Base Score 只是基础评分</li>\n<li>还需考虑 Temporal Score（时效性）和 Environmental Score（环境因素）</li>\n<li>你的环境中物理安全控制如何？</li>\n</ul>\n<hr>\n<h2 id=\"评估标准（达成判定）\"><a href=\"#评估标准（达成判定）\" class=\"headerlink\" title=\"评估标准（达成判定）\"></a>评估标准（达成判定）</h2><ul>\n<li>✅ 能解释 CVE&#x2F;CWE&#x2F;CVSS 三者的区别和用途</li>\n<li>✅ 能在 NVD 上查询漏洞并提取关键信息</li>\n<li>✅ 能使用 CVSS 计算器评估漏洞严重程度</li>\n<li>✅ 能根据漏洞描述匹配正确的 CWE 分类</li>\n<li>✅ 能根据 CVSS 评分初步判断修复优先级</li>\n</ul>\n<hr>\n<h2 id=\"学习成果达成情况（由学习者填写）\"><a href=\"#学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"学习成果达成情况（由学习者填写）\"></a>学习成果达成情况（由学习者填写）</h2><h3 id=\"截图与证据\"><a href=\"#截图与证据\" class=\"headerlink\" title=\"截图与证据\"></a>截图与证据</h3><ul>\n<li><input disabled=\"\" type=\"checkbox\"> NVD 查询 Log4Shell 的截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> CVSS 计算器评分截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 3 个 CVE 的分析笔记</li>\n</ul>\n<h3 id=\"关键命令与输出（粘贴关键片段）\"><a href=\"#关键命令与输出（粘贴关键片段）\" class=\"headerlink\" title=\"关键命令与输出（粘贴关键片段）\"></a>关键命令与输出（粘贴关键片段）</h3><p><strong>CVE-2021-44228 查询结果</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">CVSS:</span><br><span class=\"line\">Attack Vector:</span><br><span class=\"line\">Privileges Required:</span><br><span class=\"line\">缓解措施:</span><br></pre></td></tr></table></figure>\n\n<p><strong>CVSS 计算器结果</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Base Score:</span><br><span class=\"line\">Vector String:</span><br><span class=\"line\">Severity:</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"结论与反思\"><a href=\"#结论与反思\" class=\"headerlink\" title=\"结论与反思\"></a>结论与反思</h3><p><strong>我今天搞清楚了</strong>：</p>\n<ul>\n<li>CVE 是漏洞的身份证，CWE 是病因分类，CVSS 是风险评分</li>\n<li>CVSS 评分越高不一定优先级越高，还要看实际环境</li>\n</ul>\n<p><strong>我差点搞混的是</strong>：</p>\n<ul>\n<li>以前以为 CVE 和漏洞名称是一回事</li>\n<li>不知道 CVSS 有基础评分&#x2F;时效评分&#x2F;环境评分三个维度</li>\n</ul>\n<p><strong>明天我要继续补的是</strong>：</p>\n<ul>\n<li>实际使用漏洞扫描器（如 Nessus&#x2F;OpenVAS）</li>\n<li>理解漏洞扫描报告的结构</li>\n</ul>\n<p><strong>本次学习耗时</strong>：约 ___ 小时</p>\n<p><strong>掌握程度自评</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 😕 看懂了但没动手</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🙂 跑通了基础任务</li>\n<li><input disabled=\"\" type=\"checkbox\"> 😃 完成了所有任务并理解原理</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🤩 额外查询了更多 CVE 案例</li>\n</ul>\n<hr>\n<h2 id=\"集中参考答案（含思路）\"><a href=\"#集中参考答案（含思路）\" class=\"headerlink\" title=\"集中参考答案（含思路）\"></a>集中参考答案（含思路）</h2><h3 id=\"题-1-参考答案\"><a href=\"#题-1-参考答案\" class=\"headerlink\" title=\"题 1 参考答案\"></a>题 1 参考答案</h3><p><strong>Attack Vector 对评分的影响</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>Attack Vector</th>\n<th>说明</th>\n<th>风险程度</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Network (N)</td>\n<td>远程可利用，无需物理接触</td>\n<td>最高</td>\n<td>Web 应用 SQL 注入</td>\n</tr>\n<tr>\n<td>Adjacent (A)</td>\n<td>需要在相邻网络（如同一 VLAN）</td>\n<td>较高</td>\n<td>ARP 欺骗攻击</td>\n</tr>\n<tr>\n<td>Local (L)</td>\n<td>需要本地登录权限</td>\n<td>中等</td>\n<td>本地提权漏洞</td>\n</tr>\n<tr>\n<td>Physical (P)</td>\n<td>需要物理接触设备</td>\n<td>较低</td>\n<td>通过 USB 设备攻击</td>\n</tr>\n</tbody></table>\n<p><strong>为什么远程更危险？</strong></p>\n<ul>\n<li>攻击面更大（全球任何人可尝试）</li>\n<li>自动化扫描工具容易发现</li>\n<li>传播速度快（蠕虫&#x2F;勒索软件）</li>\n</ul>\n<h3 id=\"题-2-参考答案\"><a href=\"#题-2-参考答案\" class=\"headerlink\" title=\"题 2 参考答案\"></a>题 2 参考答案</h3><p><strong>为什么需要 CWE 分类？</strong></p>\n<ol>\n<li><p><strong>对开发者</strong>：</p>\n<ul>\n<li>理解漏洞根本原因（是输入校验问题还是权限问题？）</li>\n<li>建立安全编码规范（如何避免 CWE-79 XSS？）</li>\n<li>代码审计工具基于 CWE 规则检查</li>\n</ul>\n</li>\n<li><p><strong>对安全工程师</strong>：</p>\n<ul>\n<li>漏洞分类统计（我们最常见的是哪类漏洞？）</li>\n<li>培训重点（团队在 CWE-89 SQL 注入防护上薄弱）</li>\n<li>加固策略（针对 CWE-287 认证问题部署多因素认证）</li>\n</ul>\n</li>\n<li><p><strong>CVE vs CWE 的关系</strong>：</p>\n<ul>\n<li>1 个 CWE 可能对应成百上千个 CVE</li>\n<li>CVE 是”实例”，CWE 是”类别”</li>\n<li>类比：CWE-79 是”XSS 这类病”，CVE-2023-12345 是”某个产品的具体 XSS 漏洞”</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"题-3-参考答案\"><a href=\"#题-3-参考答案\" class=\"headerlink\" title=\"题 3 参考答案\"></a>题 3 参考答案</h3><p><strong>CVSS 9.5 但需物理接触的优先级评估</strong>：</p>\n<p><strong>考虑因素</strong>：</p>\n<ol>\n<li><p><strong>环境评分调整</strong>：</p>\n<ul>\n<li>如果设备在数据中心（物理安全严格）→ 优先级降低</li>\n<li>如果设备在公共场所（如 ATM、Kiosk）→ 优先级提升</li>\n</ul>\n</li>\n<li><p><strong>时效性评分</strong>：</p>\n<ul>\n<li>是否有公开 EXP（Exploit Code）？</li>\n<li>是否已被在野利用？</li>\n</ul>\n</li>\n<li><p><strong>业务影响</strong>：</p>\n<ul>\n<li>如果是关键基础设施（如工控系统），即使物理接触也应高优先级</li>\n<li>如果是办公终端且有严格的门禁控制，可降低优先级</li>\n</ul>\n</li>\n</ol>\n<p><strong>建议处理流程</strong>：</p>\n<ul>\n<li>短期：强化物理安全控制（如禁用 USB 端口、监控访问）</li>\n<li>中期：规划补丁部署（在维护窗口更新）</li>\n<li>长期：评估设备替换方案（如已停止支持的老旧设备）</li>\n</ul>\n<hr>\n<h2 id=\"学习成果示例填写（可照抄）\"><a href=\"#学习成果示例填写（可照抄）\" class=\"headerlink\" title=\"学习成果示例填写（可照抄）\"></a>学习成果示例填写（可照抄）</h2><blockquote>\n<p>可将”示例”内容替换为你自己的时间与截图文件名。</p>\n</blockquote>\n<h3 id=\"截图与证据（示例）\"><a href=\"#截图与证据（示例）\" class=\"headerlink\" title=\"截图与证据（示例）\"></a>截图与证据（示例）</h3><ul>\n<li>任务 1：<code>images/day022_cve_log4shell.png</code>（NVD 上 Log4Shell 详情页）</li>\n<li>任务 2：<code>images/day022_cvss_calculator.png</code>（CVSS 计算器评分结果）</li>\n<li>任务 3：<code>images/day022_cwe_matching.png</code>（CWE 分类笔记）</li>\n</ul>\n<h3 id=\"关键命令与输出（示例）\"><a href=\"#关键命令与输出（示例）\" class=\"headerlink\" title=\"关键命令与输出（示例）\"></a>关键命令与输出（示例）</h3><p><strong>CVE-2021-44228 分析</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">CVE: CVE-2021-44228</span><br><span class=\"line\">名称: Log4Shell</span><br><span class=\"line\">CVSS: 10.0 (Critical)</span><br><span class=\"line\">向量: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H</span><br><span class=\"line\">影响: Apache Log4j 2.0-beta9 到 2.14.1</span><br><span class=\"line\">缓解: 升级至 2.17.0 或设置 log4j2.formatMsgNoLookups=true</span><br></pre></td></tr></table></figure>\n\n<p><strong>CVSS 计算器示例</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">场景: 无认证远程 SQL 注入</span><br><span class=\"line\">Base Score: 9.8 (Critical)</span><br><span class=\"line\">Vector String: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H</span><br><span class=\"line\">Severity: CRITICAL</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"结论与反思（示例）\"><a href=\"#结论与反思（示例）\" class=\"headerlink\" title=\"结论与反思（示例）\"></a>结论与反思（示例）</h3><p><strong>我今天搞清楚了</strong>：</p>\n<ul>\n<li>CVE 是漏洞的唯一编号，CWE 是漏洞类型分类，CVSS 是风险评分标准</li>\n<li>CVSS 评分从攻击向量、复杂度、所需权限等多个维度综合计算</li>\n<li>同一个 CWE 类型（如 CWE-79 XSS）可能有成千上万个不同的 CVE</li>\n</ul>\n<p><strong>我差点搞混的是</strong>：</p>\n<ul>\n<li>以前以为 CVSS 只有一个分数，不知道还有基础&#x2F;时效&#x2F;环境三个评分维度</li>\n<li>混淆了”漏洞严重性”和”修复优先级”（高分漏洞在不适用的环境中可降低优先级）</li>\n</ul>\n<p><strong>明天我要继续补的是</strong>：</p>\n<ul>\n<li>实际操作漏洞扫描器（Nessus&#x2F;OpenVAS）</li>\n<li>学习如何解读扫描报告中的 CVE&#x2F;CVSS 信息</li>\n<li>了解漏洞生命周期管理</li>\n</ul>\n<p><strong>本次学习耗时</strong>：约 2 小时</p>\n<p><strong>掌握程度自评</strong>：</p>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> 😃 完成了所有任务并理解原理</li>\n</ul>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day021：操作系统与脚本 - 第 3 周综合实验与测评（OS+枚举+脚本，傻瓜版能照做）","url":"/post/96499f8c.html","content":"<h1 id=\"Day021：操作系统与脚本-第-3-周综合实验与测评（OS-枚举-脚本，傻瓜版能照做）\"><a href=\"#Day021：操作系统与脚本-第-3-周综合实验与测评（OS-枚举-脚本，傻瓜版能照做）\" class=\"headerlink\" title=\"Day021：操作系统与脚本 - 第 3 周综合实验与测评（OS+枚举+脚本，傻瓜版能照做）\"></a>Day021：操作系统与脚本 - 第 3 周综合实验与测评（OS+枚举+脚本，傻瓜版能照做）</h1><ul>\n<li>日期：2026-01-14</li>\n<li>周次：第 3 周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p>今天把第 3 周收口，你应该能做到：</p>\n<ul>\n<li><strong>主机侧</strong>：能给出 Windows&#x2F;Linux 各 5 条加固项（并有证据）</li>\n<li><strong>网络侧</strong>：能对”授权目标”做一次端口&#x2F;服务枚举并导出结果</li>\n<li><strong>脚本侧</strong>：能把输出整理成结构化文件（CSV&#x2F;JSON），形成可复用”小工具”</li>\n<li><strong>报告侧</strong>：输出一份完整的第 3 周周报（含证据链、风险评估、改进建议）</li>\n</ul>\n<hr>\n<span id=\"more\"></span>\n\n<h2 id=\"一、第-3-周知识地图\"><a href=\"#一、第-3-周知识地图\" class=\"headerlink\" title=\"一、第 3 周知识地图\"></a>一、第 3 周知识地图</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">第 3 周：操作系统与脚本</span><br><span class=\"line\">├─ Day015：Linux 安全基础</span><br><span class=\"line\">│   ├─ 权限管理（rwx/SUID/SGID）</span><br><span class=\"line\">│   ├─ 用户与组（useradd/sudo/sudoers）</span><br><span class=\"line\">│   ├─ 服务管理（systemd/监听端口）</span><br><span class=\"line\">│   ├─ 日志审计（journalctl/auth.log）</span><br><span class=\"line\">│   └─ 防火墙（ufw/iptables/firewalld）</span><br><span class=\"line\">│</span><br><span class=\"line\">├─ Day016：Windows 安全基础</span><br><span class=\"line\">│   ├─ UAC 原理（4个安全级别）</span><br><span class=\"line\">│   ├─ 用户与组（管理员组审计）</span><br><span class=\"line\">│   ├─ 事件日志（4624/4625/4672/4688）</span><br><span class=\"line\">│   ├─ 防火墙（入站规则审计）</span><br><span class=\"line\">│   └─ 本地安全策略（密码/锁定策略）</span><br><span class=\"line\">│</span><br><span class=\"line\">├─ Day017：PowerShell 脚本</span><br><span class=\"line\">│   ├─ 对象管道与 Select-Object/Where-Object</span><br><span class=\"line\">│   ├─ 变量、循环、条件、函数</span><br><span class=\"line\">│   ├─ 错误处理（try/catch/finally）</span><br><span class=\"line\">│   ├─ 日志解析与批量处理</span><br><span class=\"line\">│   └─ CSV 导出与数据统计</span><br><span class=\"line\">│</span><br><span class=\"line\">├─ Day018：Python 脚本</span><br><span class=\"line\">│   ├─ 文件操作（open/pathlib）</span><br><span class=\"line\">│   ├─ 正则表达式（re.match/findall）</span><br><span class=\"line\">│   ├─ JSON/CSV 处理</span><br><span class=\"line\">│   ├─ HTTP 请求（urllib.request）</span><br><span class=\"line\">│   └─ 错误处理（try/except）</span><br><span class=\"line\">│</span><br><span class=\"line\">├─ Day019：Nmap 端口扫描</span><br><span class=\"line\">│   ├─ 合法授权原则</span><br><span class=\"line\">│   ├─ 扫描类型（-sS/-sT/-sU）</span><br><span class=\"line\">│   ├─ 端口状态（open/closed/filtered）</span><br><span class=\"line\">│   ├─ 服务版本探测（-sV）</span><br><span class=\"line\">│   └─ 结果导出（-oN/-oX/-oG）</span><br><span class=\"line\">│</span><br><span class=\"line\">└─ Day020：服务枚举与指纹识别</span><br><span class=\"line\">    ├─ HTTP 枚举（curl/浏览器）</span><br><span class=\"line\">    ├─ SSH Banner 获取（nc/telnet）</span><br><span class=\"line\">    ├─ 数据库枚举（mysql-info）</span><br><span class=\"line\">    ├─ RDP/SMB 探测（Nmap NSE）</span><br><span class=\"line\">    └─ 结果解析（Python/PowerShell）</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"二、10-个易错点对照表\"><a href=\"#二、10-个易错点对照表\" class=\"headerlink\" title=\"二、10 个易错点对照表\"></a>二、10 个易错点对照表</h2><table>\n<thead>\n<tr>\n<th>易错点</th>\n<th>错误做法</th>\n<th>正确做法</th>\n<th>后果</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>1. 未记录授权</strong></td>\n<td>直接扫描内网主机</td>\n<td>先获取书面授权，记录扫描窗口</td>\n<td>可能违反公司政策&#x2F;触发 IDS</td>\n</tr>\n<tr>\n<td><strong>2. sudo 配置错误</strong></td>\n<td><code>user ALL=(ALL) NOPASSWD: ALL</code></td>\n<td>仅授权必要命令，且需要密码</td>\n<td>普通账号可无密码提权</td>\n</tr>\n<tr>\n<td><strong>3. 防火墙全开</strong></td>\n<td>关闭 Windows 防火墙</td>\n<td>保持开启，按需放通</td>\n<td>所有端口暴露</td>\n</tr>\n<tr>\n<td><strong>4. RDP 对公网开放</strong></td>\n<td>3389 端口允许 Any</td>\n<td>仅允许 VPN&#x2F;堡垒机 IP</td>\n<td>成为暴力破解目标</td>\n</tr>\n<tr>\n<td><strong>5. 密码策略太弱</strong></td>\n<td>无复杂性要求，无锁定策略</td>\n<td>12 位+复杂性+5 次锁定</td>\n<td>容易被暴力破解</td>\n</tr>\n<tr>\n<td><strong>6. 日志未启用</strong></td>\n<td>未开启进程创建审计（4688）</td>\n<td><code>auditpol /set /category:*</code></td>\n<td>无法溯源攻击行为</td>\n</tr>\n<tr>\n<td><strong>7. Banner 直接信任</strong></td>\n<td>看到 Apache 就认为是 Apache</td>\n<td>交叉验证（curl+Nmap）</td>\n<td>可能被伪装 Banner 误导</td>\n</tr>\n<tr>\n<td><strong>8. 异常处理缺失</strong></td>\n<td><code>except: pass</code>（吞掉错误）</td>\n<td>输出错误信息+解决建议</td>\n<td>脚本出错无法排查</td>\n</tr>\n<tr>\n<td><strong>9. 全端口扫描无节制</strong></td>\n<td>直接 <code>-p-</code> 扫描生产环境</td>\n<td>先 <code>--top-ports 100</code> 测试</td>\n<td>可能触发限流&#x2F;DoS</td>\n</tr>\n<tr>\n<td><strong>10. 结果未脱敏</strong></td>\n<td>日志中包含真实 IP&#x2F;账号</td>\n<td>导出前替换为 <code>192.168.1.X</code>&#x2F;<code>user_A</code></td>\n<td>泄露敏感信息</td>\n</tr>\n</tbody></table>\n<hr>\n<h2 id=\"三、综合实验任务\"><a href=\"#三、综合实验任务\" class=\"headerlink\" title=\"三、综合实验任务\"></a>三、综合实验任务</h2><h3 id=\"任务-1：Windows-自查证据（必做）\"><a href=\"#任务-1：Windows-自查证据（必做）\" class=\"headerlink\" title=\"任务 1：Windows 自查证据（必做）\"></a>任务 1：Windows 自查证据（必做）</h3><p><strong>目标</strong>：用 PowerShell 收集 Windows 安全证据，识别 3 个以上风险点。</p>\n<h4 id=\"步骤-1：审计管理员组成员\"><a href=\"#步骤-1：审计管理员组成员\" class=\"headerlink\" title=\"步骤 1：审计管理员组成员\"></a>步骤 1：审计管理员组成员</h4><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Get-LocalGroupMember</span> <span class=\"literal\">-Group</span> <span class=\"string\">&quot;Administrators&quot;</span> | </span><br><span class=\"line\"><span class=\"built_in\">Select-Object</span> Name, PrincipalSource, ObjectClass | </span><br><span class=\"line\"><span class=\"built_in\">Format-Table</span> <span class=\"literal\">-AutoSize</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>检查清单</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 是否有离职员工残留账号</li>\n<li><input disabled=\"\" type=\"checkbox\"> 是否有非 IT 人员在管理员组</li>\n<li><input disabled=\"\" type=\"checkbox\"> 是否有命名异常的账号（如 <code>temp_admin</code>）</li>\n</ul>\n<h4 id=\"步骤-2：导出最近-24-小时登录事件\"><a href=\"#步骤-2：导出最近-24-小时登录事件\" class=\"headerlink\" title=\"步骤 2：导出最近 24 小时登录事件\"></a>步骤 2：导出最近 24 小时登录事件</h4><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 登录成功（4624）</span></span><br><span class=\"line\"><span class=\"built_in\">Get-WinEvent</span> <span class=\"literal\">-FilterHashtable</span> <span class=\"selector-tag\">@</span>&#123;</span><br><span class=\"line\">    LogName=<span class=\"string\">&#x27;Security&#x27;</span></span><br><span class=\"line\">    ID=<span class=\"number\">4624</span></span><br><span class=\"line\">    StartTime=(<span class=\"built_in\">Get-Date</span>).AddDays(<span class=\"literal\">-1</span>)</span><br><span class=\"line\">&#125; | <span class=\"built_in\">Select-Object</span> TimeCreated, </span><br><span class=\"line\">    <span class=\"selector-tag\">@</span>&#123;Name=<span class=\"string\">&quot;User&quot;</span>;Expression=&#123;<span class=\"variable\">$_</span>.Properties[<span class=\"number\">5</span>].Value&#125;&#125;,</span><br><span class=\"line\">    <span class=\"selector-tag\">@</span>&#123;Name=<span class=\"string\">&quot;LogonType&quot;</span>;Expression=&#123;<span class=\"variable\">$_</span>.Properties[<span class=\"number\">8</span>].Value&#125;&#125;,</span><br><span class=\"line\">    <span class=\"selector-tag\">@</span>&#123;Name=<span class=\"string\">&quot;SourceIP&quot;</span>;Expression=&#123;<span class=\"variable\">$_</span>.Properties[<span class=\"number\">18</span>].Value&#125;&#125; | </span><br><span class=\"line\"><span class=\"built_in\">Export-Csv</span> <span class=\"literal\">-Path</span> <span class=\"string\">&quot;.\\win_logins.csv&quot;</span> <span class=\"literal\">-NoTypeInformation</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 登录失败（4625）</span></span><br><span class=\"line\"><span class=\"built_in\">Get-WinEvent</span> <span class=\"literal\">-FilterHashtable</span> <span class=\"selector-tag\">@</span>&#123;</span><br><span class=\"line\">    LogName=<span class=\"string\">&#x27;Security&#x27;</span></span><br><span class=\"line\">    ID=<span class=\"number\">4625</span></span><br><span class=\"line\">    StartTime=(<span class=\"built_in\">Get-Date</span>).AddDays(<span class=\"literal\">-1</span>)</span><br><span class=\"line\">&#125; | <span class=\"built_in\">Select-Object</span> TimeCreated, </span><br><span class=\"line\">    <span class=\"selector-tag\">@</span>&#123;Name=<span class=\"string\">&quot;User&quot;</span>;Expression=&#123;<span class=\"variable\">$_</span>.Properties[<span class=\"number\">5</span>].Value&#125;&#125; | </span><br><span class=\"line\"><span class=\"built_in\">Group-Object</span> User | <span class=\"built_in\">Sort-Object</span> Count <span class=\"literal\">-Descending</span> | </span><br><span class=\"line\"><span class=\"built_in\">Select-Object</span> <span class=\"literal\">-First</span> <span class=\"number\">5</span> Name, Count</span><br></pre></td></tr></table></figure>\n\n<p><strong>检查清单</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 是否有非预期的 RDP 登录（登录类型 10）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 是否有大量失败登录（可能是暴力破解）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 是否有非工作时间的登录</li>\n</ul>\n<h4 id=\"步骤-3：检查防火墙入站规则\"><a href=\"#步骤-3：检查防火墙入站规则\" class=\"headerlink\" title=\"步骤 3：检查防火墙入站规则\"></a>步骤 3：检查防火墙入站规则</h4><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Get-NetFirewallRule</span> <span class=\"literal\">-Direction</span> Inbound <span class=\"literal\">-Enabled</span> True <span class=\"literal\">-Action</span> Allow | </span><br><span class=\"line\"><span class=\"built_in\">Select-Object</span> DisplayName, Profile, </span><br><span class=\"line\">    <span class=\"selector-tag\">@</span>&#123;Name=<span class=\"string\">&quot;LocalPort&quot;</span>;Expression=&#123;(<span class=\"built_in\">Get-NetFirewallPortFilter</span> <span class=\"literal\">-AssociatedNetFirewallRule</span> <span class=\"variable\">$_</span>).LocalPort&#125;&#125;,</span><br><span class=\"line\">    <span class=\"selector-tag\">@</span>&#123;Name=<span class=\"string\">&quot;RemoteAddress&quot;</span>;Expression=&#123;(<span class=\"built_in\">Get-NetFirewallAddressFilter</span> <span class=\"literal\">-AssociatedNetFirewallRule</span> <span class=\"variable\">$_</span>).RemoteAddress&#125;&#125; | </span><br><span class=\"line\"><span class=\"built_in\">Where-Object</span> &#123;<span class=\"variable\">$_</span>.LocalPort <span class=\"operator\">-ne</span> <span class=\"variable\">$null</span>&#125; | </span><br><span class=\"line\"><span class=\"built_in\">Export-Csv</span> <span class=\"literal\">-Path</span> <span class=\"string\">&quot;.\\win_firewall.csv&quot;</span> <span class=\"literal\">-NoTypeInformation</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>检查清单</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> RDP（3389）是否限制 IP</li>\n<li><input disabled=\"\" type=\"checkbox\"> SMB（445）是否对公网开放</li>\n<li><input disabled=\"\" type=\"checkbox\"> 是否有”Any”远程地址的高危端口</li>\n</ul>\n<h4 id=\"步骤-4：盘点监听端口\"><a href=\"#步骤-4：盘点监听端口\" class=\"headerlink\" title=\"步骤 4：盘点监听端口\"></a>步骤 4：盘点监听端口</h4><figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Get-NetTCPConnection</span> <span class=\"literal\">-State</span> Listen | </span><br><span class=\"line\"><span class=\"built_in\">Select-Object</span> LocalAddress, LocalPort, State,</span><br><span class=\"line\">    <span class=\"selector-tag\">@</span>&#123;Name=<span class=\"string\">&quot;ProcessName&quot;</span>;Expression=&#123;(<span class=\"built_in\">Get-Process</span> <span class=\"literal\">-Id</span> <span class=\"variable\">$_</span>.OwningProcess <span class=\"literal\">-ErrorAction</span> SilentlyContinue).ProcessName&#125;&#125;,</span><br><span class=\"line\">    <span class=\"selector-tag\">@</span>&#123;Name=<span class=\"string\">&quot;ProcessPath&quot;</span>;Expression=&#123;(<span class=\"built_in\">Get-Process</span> <span class=\"literal\">-Id</span> <span class=\"variable\">$_</span>.OwningProcess <span class=\"literal\">-ErrorAction</span> SilentlyContinue).Path&#125;&#125; | </span><br><span class=\"line\"><span class=\"built_in\">Export-Csv</span> <span class=\"literal\">-Path</span> <span class=\"string\">&quot;.\\win_ports.csv&quot;</span> <span class=\"literal\">-NoTypeInformation</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>检查清单</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 是否有意外的高端口监听（如 4444&#x2F;5555）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 进程路径是否在 <code>AppData</code>&#x2F;<code>Temp</code></li>\n<li><input disabled=\"\" type=\"checkbox\"> 进程名是否伪装成系统进程</li>\n</ul>\n<h4 id=\"步骤-5：整理-Windows-风险清单\"><a href=\"#步骤-5：整理-Windows-风险清单\" class=\"headerlink\" title=\"步骤 5：整理 Windows 风险清单\"></a>步骤 5：整理 Windows 风险清单</h4><table>\n<thead>\n<tr>\n<th>风险项</th>\n<th>发现证据</th>\n<th>风险等级</th>\n<th>改进建议</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>管理员组成员过多</td>\n<td>有 3 个非 IT 账号</td>\n<td>⚠️ 中</td>\n<td>移除非必要账号</td>\n</tr>\n<tr>\n<td>RDP 对所有 IP 开放</td>\n<td>防火墙规则 RemoteAddress&#x3D;Any</td>\n<td>🚨 高</td>\n<td>限制为 VPN IP 段</td>\n</tr>\n<tr>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"任务-2：Linux-自查证据（可选，需自建-VM）\"><a href=\"#任务-2：Linux-自查证据（可选，需自建-VM）\" class=\"headerlink\" title=\"任务 2：Linux 自查证据（可选，需自建 VM）\"></a>任务 2：Linux 自查证据（可选，需自建 VM）</h3><p><strong>目标</strong>：用命令行收集 Linux 安全证据。</p>\n<h4 id=\"步骤-1：检查关键文件权限\"><a href=\"#步骤-1：检查关键文件权限\" class=\"headerlink\" title=\"步骤 1：检查关键文件权限\"></a>步骤 1：检查关键文件权限</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">ls</span> -l /etc/shadow /etc/passwd /etc/sudoers</span><br></pre></td></tr></table></figure>\n\n<p><strong>检查清单</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> <code>/etc/shadow</code> 权限是否为 600 或 000</li>\n<li><input disabled=\"\" type=\"checkbox\"> <code>/etc/passwd</code> 是否可被所有人读取（644）</li>\n<li><input disabled=\"\" type=\"checkbox\"> <code>/etc/sudoers</code> 权限是否为 440 或 400</li>\n</ul>\n<h4 id=\"步骤-2：审计-sudo-权限\"><a href=\"#步骤-2：审计-sudo-权限\" class=\"headerlink\" title=\"步骤 2：审计 sudo 权限\"></a>步骤 2：审计 sudo 权限</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo grep -v <span class=\"string\">&#x27;^#&#x27;</span> /etc/sudoers | grep -v <span class=\"string\">&#x27;^$&#x27;</span></span><br><span class=\"line\">sudo <span class=\"built_in\">ls</span> -la /etc/sudoers.d/</span><br></pre></td></tr></table></figure>\n\n<p><strong>检查清单</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 是否有 <code>NOPASSWD: ALL</code>（极不安全）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 是否有非 IT 人员拥有 sudo 权限</li>\n</ul>\n<h4 id=\"步骤-3：盘点监听端口\"><a href=\"#步骤-3：盘点监听端口\" class=\"headerlink\" title=\"步骤 3：盘点监听端口\"></a>步骤 3：盘点监听端口</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo ss -lntup</span><br></pre></td></tr></table></figure>\n\n<p><strong>检查清单</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 是否有意外的高端口监听</li>\n<li><input disabled=\"\" type=\"checkbox\"> SSH（22）是否监听在 <code>0.0.0.0</code>（所有网卡）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 数据库端口（3306&#x2F;5432）是否对外暴露</li>\n</ul>\n<h4 id=\"步骤-4：查看最近登录记录\"><a href=\"#步骤-4：查看最近登录记录\" class=\"headerlink\" title=\"步骤 4：查看最近登录记录\"></a>步骤 4：查看最近登录记录</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">last -n 20</span><br><span class=\"line\">lastb -n 20  <span class=\"comment\"># 失败登录</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>检查清单</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 是否有非预期的 IP 登录</li>\n<li><input disabled=\"\" type=\"checkbox\"> 是否有大量失败登录</li>\n</ul>\n<h4 id=\"步骤-5：整理-Linux-风险清单\"><a href=\"#步骤-5：整理-Linux-风险清单\" class=\"headerlink\" title=\"步骤 5：整理 Linux 风险清单\"></a>步骤 5：整理 Linux 风险清单</h4><table>\n<thead>\n<tr>\n<th>风险项</th>\n<th>发现证据</th>\n<th>风险等级</th>\n<th>改进建议</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>&#x2F;etc&#x2F;shadow 权限 644</td>\n<td><code>ls -l</code> 输出</td>\n<td>🚨 极高</td>\n<td><code>chmod 600 /etc/shadow</code></td>\n</tr>\n<tr>\n<td>MySQL 监听 0.0.0.0:3306</td>\n<td><code>ss -lntup</code></td>\n<td>🚨 高</td>\n<td>改为 127.0.0.1 或限制 IP</td>\n</tr>\n<tr>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"任务-3：授权目标枚举证据（必做）\"><a href=\"#任务-3：授权目标枚举证据（必做）\" class=\"headerlink\" title=\"任务 3：授权目标枚举证据（必做）\"></a>任务 3：授权目标枚举证据（必做）</h3><p><strong>目标</strong>：对一个合法目标（本机&#x2F;VM）做端口扫描+服务枚举。</p>\n<h4 id=\"步骤-1：记录授权信息\"><a href=\"#步骤-1：记录授权信息\" class=\"headerlink\" title=\"步骤 1：记录授权信息\"></a>步骤 1：记录授权信息</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">目标：127.0.0.1（本机）</span><br><span class=\"line\">授权类型：自建环境</span><br><span class=\"line\">扫描窗口：2026-01-14 14:00 - 14:30</span><br><span class=\"line\">目的：第 3 周综合实验，学习端口扫描与服务枚举</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"步骤-2：执行扫描\"><a href=\"#步骤-2：执行扫描\" class=\"headerlink\" title=\"步骤 2：执行扫描\"></a>步骤 2：执行扫描</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">nmap -sT -sV --top-ports 1000 -oX scan.xml 127.0.0.1</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"步骤-3：用-Python-脚本解析结果\"><a href=\"#步骤-3：用-Python-脚本解析结果\" class=\"headerlink\" title=\"步骤 3：用 Python 脚本解析结果\"></a>步骤 3：用 Python 脚本解析结果</h4><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> xml.etree.ElementTree <span class=\"keyword\">as</span> ET</span><br><span class=\"line\"><span class=\"keyword\">import</span> csv</span><br><span class=\"line\"></span><br><span class=\"line\">tree = ET.parse(<span class=\"string\">&quot;scan.xml&quot;</span>)</span><br><span class=\"line\">root = tree.getroot()</span><br><span class=\"line\"></span><br><span class=\"line\">results = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> host <span class=\"keyword\">in</span> root.findall(<span class=\"string\">&quot;host&quot;</span>):</span><br><span class=\"line\">    ip = host.find(<span class=\"string\">&quot;address&quot;</span>).get(<span class=\"string\">&quot;addr&quot;</span>)</span><br><span class=\"line\">    ports_elem = host.find(<span class=\"string\">&quot;ports&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ports_elem <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">        <span class=\"keyword\">continue</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> port <span class=\"keyword\">in</span> ports_elem.findall(<span class=\"string\">&quot;port&quot;</span>):</span><br><span class=\"line\">        portid = port.get(<span class=\"string\">&quot;portid&quot;</span>)</span><br><span class=\"line\">        state = port.find(<span class=\"string\">&quot;state&quot;</span>).get(<span class=\"string\">&quot;state&quot;</span>)</span><br><span class=\"line\">        service = port.find(<span class=\"string\">&quot;service&quot;</span>)</span><br><span class=\"line\">        service_name = service.get(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;unknown&quot;</span>) <span class=\"keyword\">if</span> service <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span> <span class=\"keyword\">else</span> <span class=\"string\">&quot;unknown&quot;</span></span><br><span class=\"line\">        version = service.get(<span class=\"string\">&quot;product&quot;</span>, <span class=\"string\">&quot;&quot;</span>) <span class=\"keyword\">if</span> service <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span> <span class=\"keyword\">else</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">        results.append([ip, portid, state, service_name, version])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&quot;scan_results.csv&quot;</span>, <span class=\"string\">&quot;w&quot;</span>, newline=<span class=\"string\">&quot;&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    writer = csv.writer(f)</span><br><span class=\"line\">    writer.writerow([<span class=\"string\">&quot;IP&quot;</span>, <span class=\"string\">&quot;Port&quot;</span>, <span class=\"string\">&quot;State&quot;</span>, <span class=\"string\">&quot;Service&quot;</span>, <span class=\"string\">&quot;Version&quot;</span>])</span><br><span class=\"line\">    writer.writerows(results)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">f&quot;✅ 已导出 <span class=\"subst\">&#123;<span class=\"built_in\">len</span>(results)&#125;</span> 条结果&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"步骤-4：整理服务清单\"><a href=\"#步骤-4：整理服务清单\" class=\"headerlink\" title=\"步骤 4：整理服务清单\"></a>步骤 4：整理服务清单</h4><table>\n<thead>\n<tr>\n<th>IP</th>\n<th>Port</th>\n<th>State</th>\n<th>Service</th>\n<th>Version</th>\n<th>风险等级</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>127.0.0.1</td>\n<td>135</td>\n<td>open</td>\n<td>msrpc</td>\n<td>-</td>\n<td>⚠️ 中</td>\n</tr>\n<tr>\n<td>127.0.0.1</td>\n<td>445</td>\n<td>open</td>\n<td>microsoft-ds</td>\n<td>-</td>\n<td>🚨 高</td>\n</tr>\n<tr>\n<td>127.0.0.1</td>\n<td>3389</td>\n<td>open</td>\n<td>ms-wbt-server</td>\n<td>-</td>\n<td>🚨 高</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"任务-4：脚本侧实战（必做）\"><a href=\"#任务-4：脚本侧实战（必做）\" class=\"headerlink\" title=\"任务 4：脚本侧实战（必做）\"></a>任务 4：脚本侧实战（必做）</h3><p><strong>目标</strong>：写一个”日志统计工具”，能重复使用。</p>\n<h4 id=\"需求\"><a href=\"#需求\" class=\"headerlink\" title=\"需求\"></a>需求</h4><ol>\n<li>读取 <code>demo.log</code>（格式：<code>时间, 用户, 操作</code>）</li>\n<li>统计每个用户的操作次数</li>\n<li>导出为 CSV</li>\n<li>用 try&#x2F;except 处理文件不存在的情况</li>\n</ol>\n<h4 id=\"参考实现（Python）\"><a href=\"#参考实现（Python）\" class=\"headerlink\" title=\"参考实现（Python）\"></a>参考实现（Python）</h4><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> csv</span><br><span class=\"line\"><span class=\"keyword\">from</span> collections <span class=\"keyword\">import</span> defaultdict</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">analyze_log</span>(<span class=\"params\">log_file, output_file</span>):</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        stats = defaultdict(<span class=\"built_in\">int</span>)</span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(log_file, <span class=\"string\">&quot;r&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">            <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> f:</span><br><span class=\"line\">                parts = line.strip().split(<span class=\"string\">&quot;, &quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(parts) &gt;= <span class=\"number\">2</span>:</span><br><span class=\"line\">                    user = parts[<span class=\"number\">1</span>]</span><br><span class=\"line\">                    stats[user] += <span class=\"number\">1</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># 导出 CSV</span></span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(output_file, <span class=\"string\">&quot;w&quot;</span>, newline=<span class=\"string\">&quot;&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">            writer = csv.writer(f)</span><br><span class=\"line\">            writer.writerow([<span class=\"string\">&quot;User&quot;</span>, <span class=\"string\">&quot;Count&quot;</span>])</span><br><span class=\"line\">            <span class=\"keyword\">for</span> user, count <span class=\"keyword\">in</span> <span class=\"built_in\">sorted</span>(stats.items(), key=<span class=\"keyword\">lambda</span> x: x[<span class=\"number\">1</span>], reverse=<span class=\"literal\">True</span>):</span><br><span class=\"line\">                writer.writerow([user, count])</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;✅ 已导出 <span class=\"subst\">&#123;<span class=\"built_in\">len</span>(stats)&#125;</span> 个用户的统计结果到 <span class=\"subst\">&#123;output_file&#125;</span>&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">except</span> FileNotFoundError:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;❌ 错误：文件 <span class=\"subst\">&#123;log_file&#125;</span> 不存在&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;❌ 未知错误：<span class=\"subst\">&#123;e&#125;</span>&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用</span></span><br><span class=\"line\">analyze_log(<span class=\"string\">&quot;demo.log&quot;</span>, <span class=\"string\">&quot;user_stats.csv&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"四、第-3-周周报模板\"><a href=\"#四、第-3-周周报模板\" class=\"headerlink\" title=\"四、第 3 周周报模板\"></a>四、第 3 周周报模板</h2><h3 id=\"周报标题\"><a href=\"#周报标题\" class=\"headerlink\" title=\"周报标题\"></a>周报标题</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">第 3 周学习周报：操作系统与脚本</span><br><span class=\"line\">学习者：[你的姓名]</span><br><span class=\"line\">日期：2026-01-14</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"一、学习概览\"><a href=\"#一、学习概览\" class=\"headerlink\" title=\"一、学习概览\"></a>一、学习概览</h3><p><strong>本周学习主题</strong>：</p>\n<ul>\n<li>Day015：Linux 安全基础（权限&#x2F;用户&#x2F;服务&#x2F;日志&#x2F;防火墙）</li>\n<li>Day016：Windows 安全基础（UAC&#x2F;事件日志&#x2F;防火墙&#x2F;策略）</li>\n<li>Day017：PowerShell 脚本（管道&#x2F;循环&#x2F;函数&#x2F;错误处理）</li>\n<li>Day018：Python 脚本（文件&#x2F;正则&#x2F;JSON&#x2F;HTTP）</li>\n<li>Day019：Nmap 端口扫描（-sS&#x2F;-sT&#x2F;端口状态&#x2F;导出）</li>\n<li>Day020：服务枚举（HTTP&#x2F;SSH&#x2F;MySQL&#x2F;Banner 交叉验证）</li>\n<li>Day021：综合实验（本周知识整合）</li>\n</ul>\n<p><strong>总学习时长</strong>：约 14 小时<br><strong>完成任务数</strong>：7 天 × 5 个任务 &#x3D; 35 个任务</p>\n<hr>\n<h3 id=\"二、关键发现与证据\"><a href=\"#二、关键发现与证据\" class=\"headerlink\" title=\"二、关键发现与证据\"></a>二、关键发现与证据</h3><h4 id=\"Windows-主机自查\"><a href=\"#Windows-主机自查\" class=\"headerlink\" title=\"Windows 主机自查\"></a>Windows 主机自查</h4><table>\n<thead>\n<tr>\n<th>风险项</th>\n<th>发现证据</th>\n<th>风险等级</th>\n<th>改进建议</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>[示例] 管理员组成员过多</td>\n<td>有 3 个非 IT 账号</td>\n<td>⚠️ 中</td>\n<td>移除非必要账号</td>\n</tr>\n<tr>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n</tr>\n</tbody></table>\n<h4 id=\"Linux-主机自查（如有）\"><a href=\"#Linux-主机自查（如有）\" class=\"headerlink\" title=\"Linux 主机自查（如有）\"></a>Linux 主机自查（如有）</h4><table>\n<thead>\n<tr>\n<th>风险项</th>\n<th>发现证据</th>\n<th>风险等级</th>\n<th>改进建议</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>[示例] &#x2F;etc&#x2F;shadow 权限 644</td>\n<td><code>ls -l</code> 输出</td>\n<td>🚨 极高</td>\n<td><code>chmod 600 /etc/shadow</code></td>\n</tr>\n<tr>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n</tr>\n</tbody></table>\n<h4 id=\"端口扫描与服务枚举\"><a href=\"#端口扫描与服务枚举\" class=\"headerlink\" title=\"端口扫描与服务枚举\"></a>端口扫描与服务枚举</h4><table>\n<thead>\n<tr>\n<th>IP</th>\n<th>Port</th>\n<th>Service</th>\n<th>Version</th>\n<th>风险等级</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>127.0.0.1</td>\n<td>3389</td>\n<td>ms-wbt-server</td>\n<td>-</td>\n<td>🚨 高</td>\n</tr>\n<tr>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"三、已完成的加固措施\"><a href=\"#三、已完成的加固措施\" class=\"headerlink\" title=\"三、已完成的加固措施\"></a>三、已完成的加固措施</h3><ol>\n<li>✅ [示例] 移除了管理员组中的离职员工账号 <code>bob</code></li>\n<li>✅ [示例] 配置了账户锁定策略（5 次失败锁定 30 分钟）</li>\n<li>✅ [示例] 限制 RDP（3389）仅允许内网 IP 段访问</li>\n<li>…</li>\n</ol>\n<hr>\n<h3 id=\"四、脚本工具输出\"><a href=\"#四、脚本工具输出\" class=\"headerlink\" title=\"四、脚本工具输出\"></a>四、脚本工具输出</h3><p><strong>工具 1</strong>：日志统计工具（Python）</p>\n<ul>\n<li>功能：统计每个用户的操作次数</li>\n<li>输入：demo.log</li>\n<li>输出：user_stats.csv</li>\n<li>代码行数：约 30 行</li>\n<li>可复用性：✅ 高（可用于 Day019&#x2F;Day020 的日志分析）</li>\n</ul>\n<p><strong>工具 2</strong>：Nmap 结果解析器（PowerShell）</p>\n<ul>\n<li>功能：从 Nmap 文本输出提取端口&#x2F;服务&#x2F;版本</li>\n<li>输入：day019_scan.txt</li>\n<li>输出：scan_summary.csv</li>\n<li>代码行数：约 15 行</li>\n<li>可复用性：✅ 高</li>\n</ul>\n<hr>\n<h3 id=\"五、知识盲区与改进计划\"><a href=\"#五、知识盲区与改进计划\" class=\"headerlink\" title=\"五、知识盲区与改进计划\"></a>五、知识盲区与改进计划</h3><h4 id=\"本周遇到的困难\"><a href=\"#本周遇到的困难\" class=\"headerlink\" title=\"本周遇到的困难\"></a>本周遇到的困难</h4><ol>\n<li>[示例] PowerShell 的对象管道概念理解不深，需要多练习</li>\n<li>[示例] 正则表达式语法容易忘记，需要建立速查表</li>\n<li>…</li>\n</ol>\n<h4 id=\"下周改进计划\"><a href=\"#下周改进计划\" class=\"headerlink\" title=\"下周改进计划\"></a>下周改进计划</h4><ol>\n<li>每天至少写 1 个完整脚本（PowerShell 或 Python）</li>\n<li>建立个人的”常用正则表达式库”</li>\n<li>复习 Day015-016 的加固清单，应用到实际环境</li>\n</ol>\n<hr>\n<h3 id=\"六、评估标准达成情况\"><a href=\"#六、评估标准达成情况\" class=\"headerlink\" title=\"六、评估标准达成情况\"></a>六、评估标准达成情况</h3><ul>\n<li>✅ 能给出 Windows&#x2F;Linux 各 5 条加固项（并有证据）</li>\n<li>✅ 能对授权目标做一次端口&#x2F;服务枚举并导出结果</li>\n<li>✅ 能用脚本整理输出为 CSV&#x2F;JSON</li>\n<li>✅ 能输出一份完整的周报（含证据链）</li>\n</ul>\n<hr>\n<h3 id=\"七、附件清单\"><a href=\"#七、附件清单\" class=\"headerlink\" title=\"七、附件清单\"></a>七、附件清单</h3><ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> <code>win_logins.csv</code>（Windows 登录事件）</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> <code>win_firewall.csv</code>（防火墙规则）</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> <code>win_ports.csv</code>（监听端口）</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> <code>scan.xml</code>（Nmap 扫描结果）</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> <code>scan_results.csv</code>（解析后的服务清单）</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> <code>user_stats.csv</code>（日志统计结果）</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> 脚本代码（<code>analyze_log.py</code>&#x2F;<code>parse_nmap.ps1</code>）</li>\n</ul>\n<hr>\n<h2 id=\"五、巩固练习\"><a href=\"#五、巩固练习\" class=\"headerlink\" title=\"五、巩固练习\"></a>五、巩固练习</h2><h3 id=\"练习-1：设计一套-Windows-加固方案\"><a href=\"#练习-1：设计一套-Windows-加固方案\" class=\"headerlink\" title=\"练习 1：设计一套 Windows 加固方案\"></a>练习 1：设计一套 Windows 加固方案</h3><p><strong>场景</strong>：新上线一台 Windows Server 2019，需要加固。</p>\n<p><strong>参考答案</strong>（15 条）：</p>\n<ol>\n<li>禁用或重命名默认 <code>Administrator</code> 账号</li>\n<li>最小化管理员组成员</li>\n<li>启用密码复杂性（12 位+大小写+数字+符号）</li>\n<li>启用账户锁定策略（5 次失败锁定 30 分钟）</li>\n<li>禁用 Guest 账户</li>\n<li>启用 Windows 自动更新</li>\n<li>防火墙默认拒绝入站，按需放通</li>\n<li>RDP（3389）仅允许 VPN&#x2F;堡垒机 IP</li>\n<li>禁用 SMBv1</li>\n<li>禁用不必要的服务（Telnet&#x2F;FTP）</li>\n<li>启用安全审计（4624&#x2F;4625&#x2F;4688&#x2F;4720&#x2F;7045）</li>\n<li>日志至少保留 90 天</li>\n<li>启用 Windows Defender 实时保护</li>\n<li>配置 AppLocker 白名单</li>\n<li>定期审计管理员组成员和登录日志</li>\n</ol>\n<hr>\n<h3 id=\"练习-2：设计一套-Linux-加固方案\"><a href=\"#练习-2：设计一套-Linux-加固方案\" class=\"headerlink\" title=\"练习 2：设计一套 Linux 加固方案\"></a>练习 2：设计一套 Linux 加固方案</h3><p><strong>参考答案</strong>（15 条）：</p>\n<ol>\n<li>禁用 root 直接登录（<code>PermitRootLogin no</code>）</li>\n<li>使用 SSH 密钥认证，禁用密码登录</li>\n<li><code>/etc/shadow</code> 权限设为 600 或 000</li>\n<li>最小化 sudo 权限，避免 <code>NOPASSWD: ALL</code></li>\n<li>禁用不必要的服务（<code>systemctl disable telnet</code>）</li>\n<li>监听端口仅绑定必要网卡（不用 <code>0.0.0.0</code>）</li>\n<li>启用 UFW&#x2F;firewalld，默认拒绝入站</li>\n<li>SSH 端口改为非标准端口（如 2222）</li>\n<li>配置 fail2ban 防暴力破解</li>\n<li>日志至少保留 90 天</li>\n<li>定期检查 <code>/etc/passwd</code>、<code>/etc/shadow</code> 完整性</li>\n<li>禁用不必要的 SUID 程序</li>\n<li>启用 SELinux&#x2F;AppArmor</li>\n<li>定期更新系统补丁（<code>apt update &amp;&amp; apt upgrade</code>）</li>\n<li>审计 cron 任务和 systemd timer</li>\n</ol>\n<hr>\n<h2 id=\"六、评估标准\"><a href=\"#六、评估标准\" class=\"headerlink\" title=\"六、评估标准\"></a>六、评估标准</h2><ul>\n<li>✅ 完成 Windows 或 Linux 主机自查（至少一个）</li>\n<li>✅ 完成授权目标的端口扫描+服务枚举</li>\n<li>✅ 写出至少 1 个可复用的脚本（PowerShell 或 Python）</li>\n<li>✅ 输出一份完整的第 3 周周报</li>\n<li>✅ 识别并整改至少 3 个安全风险</li>\n</ul>\n<hr>\n<h2 id=\"七、参考资料\"><a href=\"#七、参考资料\" class=\"headerlink\" title=\"七、参考资料\"></a>七、参考资料</h2><ul>\n<li><a href=\"https://www.cisecurity.org/benchmark/microsoft_windows_server\">CIS Windows Server 2019 Benchmark</a></li>\n<li><a href=\"https://www.cisecurity.org/benchmark/ubuntu_linux\">CIS Ubuntu Linux 20.04 Benchmark</a></li>\n<li><a href=\"https://www.nist.gov/cyberframework\">NIST Cybersecurity Framework</a></li>\n</ul>\n<hr>\n<h2 id=\"八、学习成果达成情况（由学习者填写）\"><a href=\"#八、学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"八、学习成果达成情况（由学习者填写）\"></a>八、学习成果达成情况（由学习者填写）</h2><h3 id=\"Windows-自查证据\"><a href=\"#Windows-自查证据\" class=\"headerlink\" title=\"Windows 自查证据\"></a>Windows 自查证据</h3><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 管理员组成员截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 登录事件 CSV 文件</li>\n<li><input disabled=\"\" type=\"checkbox\"> 防火墙规则 CSV 文件</li>\n<li><input disabled=\"\" type=\"checkbox\"> 监听端口 CSV 文件</li>\n</ul>\n<h3 id=\"Linux-自查证据（如有）\"><a href=\"#Linux-自查证据（如有）\" class=\"headerlink\" title=\"Linux 自查证据（如有）\"></a>Linux 自查证据（如有）</h3><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 关键文件权限截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> sudo 配置截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 监听端口截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 登录记录截图</li>\n</ul>\n<h3 id=\"端口扫描证据\"><a href=\"#端口扫描证据\" class=\"headerlink\" title=\"端口扫描证据\"></a>端口扫描证据</h3><ul>\n<li><input disabled=\"\" type=\"checkbox\"> Nmap 扫描结果（XML 或文本）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 解析后的服务清单（CSV）</li>\n</ul>\n<h3 id=\"脚本工具\"><a href=\"#脚本工具\" class=\"headerlink\" title=\"脚本工具\"></a>脚本工具</h3><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 日志统计工具代码</li>\n<li><input disabled=\"\" type=\"checkbox\"> Nmap 解析工具代码</li>\n</ul>\n<h3 id=\"周报\"><a href=\"#周报\" class=\"headerlink\" title=\"周报\"></a>周报</h3><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 完整的第 3 周周报（Markdown 或 Word）</li>\n</ul>\n<hr>\n<p><strong>恭喜！你已完成第 3 周的学习。下周我们将进入第 4 周：Web 应用安全基础！</strong> 🎉</p>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day023:漏洞扫描器(合规用途)安装与配置,报告解读","url":"/post/18fcaf71.html","content":"<h1 id=\"Day023-漏洞扫描器-合规用途-安装与配置-报告解读\"><a href=\"#Day023-漏洞扫描器-合规用途-安装与配置-报告解读\" class=\"headerlink\" title=\"Day023:漏洞扫描器(合规用途)安装与配置,报告解读\"></a>Day023:漏洞扫描器(合规用途)安装与配置,报告解读</h1><ul>\n<li>日期:2026-01-16</li>\n<li>周次:第 4 周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p>今天是第 4 周的第一天,你应该能做到:</p>\n<ul>\n<li><strong>理解漏洞扫描的合法边界</strong>:能清楚说明授权范围、扫描窗口、合规要求</li>\n<li><strong>完成 OpenVAS&#x2F;Nessus Essentials 安装</strong>:能在 Windows 或 Linux 环境下完成部署</li>\n<li><strong>执行一次标准扫描</strong>:针对授权目标(本机&#x2F;VM)执行基础漏洞扫描</li>\n<li><strong>解读扫描报告</strong>:能识别高&#x2F;中&#x2F;低危漏洞,理解 CVSS 评分体系</li>\n<li><strong>形成可复用流程</strong>:记录扫描 SOP,为后续基线检查打基础</li>\n</ul>\n<blockquote>\n<p><strong>核心原则</strong>:漏洞扫描器是强大的工具,必须在合法授权范围内使用。未经授权扫描他人系统属于违法行为。</p>\n</blockquote>\n<hr>\n<span id=\"more\"></span>\n\n<h2 id=\"学习内容\"><a href=\"#学习内容\" class=\"headerlink\" title=\"学习内容\"></a>学习内容</h2><h3 id=\"1️⃣-漏洞扫描的合法授权框架\"><a href=\"#1️⃣-漏洞扫描的合法授权框架\" class=\"headerlink\" title=\"1️⃣ 漏洞扫描的合法授权框架\"></a>1️⃣ 漏洞扫描的合法授权框架</h3><h4 id=\"什么情况下可以使用漏洞扫描器\"><a href=\"#什么情况下可以使用漏洞扫描器\" class=\"headerlink\" title=\"什么情况下可以使用漏洞扫描器?\"></a>什么情况下可以使用漏洞扫描器?</h4><table>\n<thead>\n<tr>\n<th>场景</th>\n<th>合法性</th>\n<th>前置条件</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>扫描自己的设备(个人电脑&#x2F;虚拟机)</td>\n<td>✅ 合法</td>\n<td>无需额外授权</td>\n</tr>\n<tr>\n<td>扫描公司内部系统(受雇于该公司)</td>\n<td>✅ 合法</td>\n<td>需书面授权+扫描窗口+范围界定</td>\n</tr>\n<tr>\n<td>扫描客户系统(安全测试&#x2F;渗透测试)</td>\n<td>✅ 合法</td>\n<td>需签订合同+明确范围+责任免责条款</td>\n</tr>\n<tr>\n<td>扫描实验室靶场(如 Hack The Box)</td>\n<td>✅ 合法</td>\n<td>平台 ToS 已授权,限平台内部</td>\n</tr>\n<tr>\n<td>扫描公网随机 IP</td>\n<td>🚨 违法</td>\n<td>无授权,可能触发刑法</td>\n</tr>\n<tr>\n<td>扫描学校&#x2F;邻居网络(即使出于好意)</td>\n<td>🚨 违法</td>\n<td>无授权,可能被起诉</td>\n</tr>\n</tbody></table>\n<h4 id=\"企业级授权流程-示例\"><a href=\"#企业级授权流程-示例\" class=\"headerlink\" title=\"企业级授权流程(示例)\"></a>企业级授权流程(示例)</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">┌─────────────────────────────────────────────────────┐</span><br><span class=\"line\">│ 1. 提交扫描申请                                     │</span><br><span class=\"line\">│    - 扫描目的(合规检查/安全评估/渗透测试前置)      │</span><br><span class=\"line\">│    - 目标范围(IP 段/域名/主机列表)                  │</span><br><span class=\"line\">│    - 扫描窗口(开始时间/结束时间)                    │</span><br><span class=\"line\">│    - 预期影响(是否会影响业务)                       │</span><br><span class=\"line\">└─────────────────────────────────────────────────────┘</span><br><span class=\"line\">                        ↓</span><br><span class=\"line\">┌─────────────────────────────────────────────────────┐</span><br><span class=\"line\">│ 2. 审批环节                                         │</span><br><span class=\"line\">│    - 资产负责人签字                                 │</span><br><span class=\"line\">│    - 信息安全部门审批                               │</span><br><span class=\"line\">│    - 如涉及生产环境,需业务部门确认                  │</span><br><span class=\"line\">└─────────────────────────────────────────────────────┘</span><br><span class=\"line\">                        ↓</span><br><span class=\"line\">┌─────────────────────────────────────────────────────┐</span><br><span class=\"line\">│ 3. 执行扫描                                         │</span><br><span class=\"line\">│    - 记录扫描开始/结束时间                          │</span><br><span class=\"line\">│    - 监控扫描过程(是否触发告警/影响业务)            │</span><br><span class=\"line\">│    - 保存原始日志                                   │</span><br><span class=\"line\">└─────────────────────────────────────────────────────┘</span><br><span class=\"line\">                        ↓</span><br><span class=\"line\">┌─────────────────────────────────────────────────────┐</span><br><span class=\"line\">│ 4. 报告与归档                                       │</span><br><span class=\"line\">│    - 导出扫描报告(PDF/HTML/CSV)                     │</span><br><span class=\"line\">│    - 脱敏处理(隐藏真实 IP/账号)                     │</span><br><span class=\"line\">│    - 提交给相关方并归档                             │</span><br><span class=\"line\">└─────────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2️⃣-漏洞扫描器对比-OpenVAS-vs-Nessus\"><a href=\"#2️⃣-漏洞扫描器对比-OpenVAS-vs-Nessus\" class=\"headerlink\" title=\"2️⃣ 漏洞扫描器对比:OpenVAS vs Nessus\"></a>2️⃣ 漏洞扫描器对比:OpenVAS vs Nessus</h3><table>\n<thead>\n<tr>\n<th>特性</th>\n<th>OpenVAS</th>\n<th>Nessus Essentials</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>许可证</strong></td>\n<td>GPL(开源)</td>\n<td>免费版(限 16 IP)</td>\n</tr>\n<tr>\n<td><strong>适用场景</strong></td>\n<td>企业内部&#x2F;学习</td>\n<td>个人学习&#x2F;小规模测试</td>\n</tr>\n<tr>\n<td><strong>漏洞库更新</strong></td>\n<td>社区维护,更新较慢</td>\n<td>Tenable 官方,更新快</td>\n</tr>\n<tr>\n<td><strong>支持平台</strong></td>\n<td>Linux(推荐 Kali&#x2F;Ubuntu)</td>\n<td>Windows&#x2F;Linux&#x2F;macOS</td>\n</tr>\n<tr>\n<td><strong>安装难度</strong></td>\n<td>中等(需配置 PostgreSQL)</td>\n<td>简单(一键安装)</td>\n</tr>\n<tr>\n<td><strong>Web 界面</strong></td>\n<td>Greenbone Security Assistant</td>\n<td>Nessus Web UI</td>\n</tr>\n<tr>\n<td><strong>报告格式</strong></td>\n<td>PDF&#x2F;HTML&#x2F;XML&#x2F;CSV</td>\n<td>PDF&#x2F;HTML&#x2F;CSV&#x2F;Nessus</td>\n</tr>\n<tr>\n<td><strong>推荐用途</strong></td>\n<td>学习 + 企业预算有限</td>\n<td>学习 + 快速上手</td>\n</tr>\n</tbody></table>\n<p><strong>本课程选型</strong>:优先使用 <strong>Nessus Essentials</strong>(安装简单,适合 Windows 学习者)。如有 Linux 环境可选 OpenVAS。</p>\n<hr>\n<h3 id=\"3️⃣-CVSS-评分体系速览\"><a href=\"#3️⃣-CVSS-评分体系速览\" class=\"headerlink\" title=\"3️⃣ CVSS 评分体系速览\"></a>3️⃣ CVSS 评分体系速览</h3><p><strong>CVSS(Common Vulnerability Scoring System)</strong> 是通用漏洞评分系统,范围 0-10。</p>\n<h4 id=\"评分等级\"><a href=\"#评分等级\" class=\"headerlink\" title=\"评分等级\"></a>评分等级</h4><table>\n<thead>\n<tr>\n<th>CVSS 分数</th>\n<th>严重等级</th>\n<th>图标</th>\n<th>典型示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>9.0-10.0</td>\n<td>🔴 严重(Critical)</td>\n<td>🚨</td>\n<td>远程代码执行(RCE)、未授权访问数据库</td>\n</tr>\n<tr>\n<td>7.0-8.9</td>\n<td>🟠 高危(High)</td>\n<td>⚠️</td>\n<td>SQL 注入、权限提升、敏感信息泄露</td>\n</tr>\n<tr>\n<td>4.0-6.9</td>\n<td>🟡 中危(Medium)</td>\n<td>ℹ️</td>\n<td>弱口令、过时的组件版本、信息泄露</td>\n</tr>\n<tr>\n<td>0.1-3.9</td>\n<td>🟢 低危(Low)</td>\n<td>✓</td>\n<td>Banner 泄露、不安全的配置建议</td>\n</tr>\n<tr>\n<td>0.0</td>\n<td>⚪ 信息(Info)</td>\n<td>📋</td>\n<td>开放端口、服务版本信息</td>\n</tr>\n</tbody></table>\n<h4 id=\"CVSS-v3-计算要素\"><a href=\"#CVSS-v3-计算要素\" class=\"headerlink\" title=\"CVSS v3 计算要素\"></a>CVSS v3 计算要素</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">CVSS v3 = f(攻击向量, 攻击复杂度, 权限要求, 用户交互, 机密性影响, 完整性影响, 可用性影响)</span><br><span class=\"line\"></span><br><span class=\"line\">示例:CVE-2021-44228(Log4Shell)</span><br><span class=\"line\">- 攻击向量(AV): Network(可远程利用)</span><br><span class=\"line\">- 攻击复杂度(AC): Low(易于利用)</span><br><span class=\"line\">- 权限要求(PR): None(无需权限)</span><br><span class=\"line\">- 用户交互(UI): None(无需用户操作)</span><br><span class=\"line\">- 机密性(C): High(可读取敏感数据)</span><br><span class=\"line\">- 完整性(I): High(可修改数据)</span><br><span class=\"line\">- 可用性(A): High(可造成服务中断)</span><br><span class=\"line\">→ CVSS 3.1 分数: 10.0(严重)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"4️⃣-Nessus-架构与工作原理\"><a href=\"#4️⃣-Nessus-架构与工作原理\" class=\"headerlink\" title=\"4️⃣ Nessus 架构与工作原理\"></a>4️⃣ Nessus 架构与工作原理</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">┌───────────────────────────────────────────────────────┐</span><br><span class=\"line\">│                    Nessus 扫描器                      │</span><br><span class=\"line\">│                                                       │</span><br><span class=\"line\">│  ┌─────────────┐       ┌─────────────┐              │</span><br><span class=\"line\">│  │  Web UI     │◄─────►│  扫描引擎   │              │</span><br><span class=\"line\">│  │ (8834 端口) │       │  (nessusd)  │              │</span><br><span class=\"line\">│  └─────────────┘       └─────────────┘              │</span><br><span class=\"line\">│         │                     │                      │</span><br><span class=\"line\">│         ▼                     ▼                      │</span><br><span class=\"line\">│  ┌─────────────────────────────────────┐            │</span><br><span class=\"line\">│  │         漏洞插件库(Plugins)         │            │</span><br><span class=\"line\">│  │  - 网络服务漏洞                     │            │</span><br><span class=\"line\">│  │  - Web 应用漏洞                     │            │</span><br><span class=\"line\">│  │  - 操作系统漏洞                     │            │</span><br><span class=\"line\">│  │  - 配置审计(CIS Benchmark)          │            │</span><br><span class=\"line\">│  └─────────────────────────────────────┘            │</span><br><span class=\"line\">└───────────────────────────────────────────────────────┘</span><br><span class=\"line\">                    │</span><br><span class=\"line\">                    ▼</span><br><span class=\"line\">          ┌──────────────────┐</span><br><span class=\"line\">          │   目标主机       │</span><br><span class=\"line\">          │   (被扫描对象)   │</span><br><span class=\"line\">          └──────────────────┘</span><br></pre></td></tr></table></figure>\n\n<p><strong>扫描流程</strong>:</p>\n<ol>\n<li><strong>端口探测</strong>:识别开放端口(类似 Nmap)</li>\n<li><strong>服务识别</strong>:确定运行的服务与版本</li>\n<li><strong>漏洞匹配</strong>:根据插件库匹配已知漏洞</li>\n<li><strong>深度检测</strong>:发送 Payload 验证漏洞是否真实存在</li>\n<li><strong>生成报告</strong>:汇总漏洞信息、修复建议、参考链接</li>\n</ol>\n<hr>\n<h2 id=\"实践任务-合法授权范围内\"><a href=\"#实践任务-合法授权范围内\" class=\"headerlink\" title=\"实践任务(合法授权范围内)\"></a>实践任务(合法授权范围内)</h2><blockquote>\n<p><strong>今天仅扫描自己的设备或虚拟机,严禁扫描未授权目标。</strong></p>\n</blockquote>\n<h3 id=\"任务-1-必做-安装-Nessus-Essentials\"><a href=\"#任务-1-必做-安装-Nessus-Essentials\" class=\"headerlink\" title=\"任务 1(必做):安装 Nessus Essentials\"></a>任务 1(必做):安装 Nessus Essentials</h3><h4 id=\"Windows-安装步骤\"><a href=\"#Windows-安装步骤\" class=\"headerlink\" title=\"Windows 安装步骤\"></a>Windows 安装步骤</h4><p><strong>步骤 1:注册并下载</strong></p>\n<ol>\n<li>访问 <a href=\"https://www.tenable.com/products/nessus/nessus-essentials\">Tenable 官网</a></li>\n<li>注册账号,获取激活码(Activation Code)</li>\n<li>下载 Windows 安装包(约 80MB)</li>\n</ol>\n<p><strong>步骤 2:安装</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 运行安装程序(双击 .msi 文件)</span></span><br><span class=\"line\"><span class=\"comment\"># 安装路径默认:C:\\Program Files\\Tenable\\Nessus</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装完成后,Nessus 服务会自动启动</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Service</span> <span class=\"literal\">-Name</span> <span class=\"string\">&quot;Tenable Nessus&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 3:初始化配置</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">1. 打开浏览器访问:https://localhost:8834</span><br><span class=\"line\">2. 信任自签名证书(点击&quot;高级&quot; → &quot;继续访问&quot;)</span><br><span class=\"line\">3. 选择 &quot;Nessus Essentials&quot;</span><br><span class=\"line\">4. 输入激活码</span><br><span class=\"line\">5. 创建管理员账号(用户名/密码,务必记录)</span><br><span class=\"line\">6. 等待插件下载(约 30-60 分钟,取决于网络)</span><br></pre></td></tr></table></figure>\n\n<p><strong>验证安装</strong>:</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 检查 Nessus 服务状态</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Service</span> <span class=\"literal\">-Name</span> <span class=\"string\">&quot;Tenable Nessus&quot;</span> | <span class=\"built_in\">Select-Object</span> Name, Status, StartType</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 检查监听端口</span></span><br><span class=\"line\"><span class=\"built_in\">Get-NetTCPConnection</span> <span class=\"literal\">-LocalPort</span> <span class=\"number\">8834</span> | <span class=\"built_in\">Select-Object</span> LocalAddress, LocalPort, State</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-2-必做-执行第一次扫描-本机\"><a href=\"#任务-2-必做-执行第一次扫描-本机\" class=\"headerlink\" title=\"任务 2(必做):执行第一次扫描(本机)\"></a>任务 2(必做):执行第一次扫描(本机)</h3><p><strong>步骤 1:创建扫描任务</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">1. 登录 Nessus Web UI(https://localhost:8834)</span><br><span class=\"line\">2. 点击 &quot;New Scan&quot;</span><br><span class=\"line\">3. 选择模板 &quot;Basic Network Scan&quot;</span><br><span class=\"line\">4. 配置扫描参数:</span><br><span class=\"line\">   - Name: Day023_LocalScan</span><br><span class=\"line\">   - Targets: 127.0.0.1(本机)</span><br><span class=\"line\">   - Schedule: 立即运行</span><br><span class=\"line\">5. 点击 &quot;Save&quot; 保存</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 2:启动扫描</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">1. 在 &quot;My Scans&quot; 中找到 Day023_LocalScan</span><br><span class=\"line\">2. 点击 &quot;Launch&quot; 启动</span><br><span class=\"line\">3. 观察扫描进度(状态栏会显示进度百分比)</span><br></pre></td></tr></table></figure>\n\n<p><strong>扫描时长预估</strong>:</p>\n<ul>\n<li>本机扫描:5-15 分钟</li>\n<li>虚拟机扫描:10-30 分钟(取决于开放端口数量)</li>\n</ul>\n<hr>\n<h3 id=\"任务-3-必做-解读扫描报告\"><a href=\"#任务-3-必做-解读扫描报告\" class=\"headerlink\" title=\"任务 3(必做):解读扫描报告\"></a>任务 3(必做):解读扫描报告</h3><p><strong>步骤 1:导出报告</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">1. 扫描完成后,点击扫描任务名称</span><br><span class=\"line\">2. 点击右上角 &quot;Export&quot; → &quot;PDF&quot;</span><br><span class=\"line\">3. 保存为:Day023_Report.pdf</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 2:分析报告结构</strong></p>\n<p>报告通常包含以下部分:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">1. Executive Summary(执行摘要)</span><br><span class=\"line\">   - 漏洞总数</span><br><span class=\"line\">   - 严重等级分布(Critical/High/Medium/Low/Info)</span><br><span class=\"line\">   - 风险评分</span><br><span class=\"line\"></span><br><span class=\"line\">2. Vulnerability Details(漏洞详情)</span><br><span class=\"line\">   - 漏洞名称</span><br><span class=\"line\">   - CVE 编号(如果有)</span><br><span class=\"line\">   - CVSS 分数</span><br><span class=\"line\">   - 受影响的端口/服务</span><br><span class=\"line\">   - 描述</span><br><span class=\"line\">   - 解决方案</span><br><span class=\"line\">   - 参考链接</span><br><span class=\"line\"></span><br><span class=\"line\">3. Remediations(修复建议)</span><br><span class=\"line\">   - 按优先级排序的修复措施</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 3:填写漏洞清单</strong></p>\n<table>\n<thead>\n<tr>\n<th>CVE 编号</th>\n<th>漏洞名称</th>\n<th>CVSS</th>\n<th>等级</th>\n<th>受影响端口</th>\n<th>修复建议</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>CVE-XXXX-XXXX</td>\n<td>[示例] SMBv1 启用</td>\n<td>7.5</td>\n<td>🟠 高危</td>\n<td>445&#x2F;tcp</td>\n<td>禁用 SMBv1</td>\n</tr>\n<tr>\n<td>N&#x2F;A</td>\n<td>[示例] TLS 1.0 启用</td>\n<td>5.3</td>\n<td>🟡 中危</td>\n<td>443&#x2F;tcp</td>\n<td>禁用 TLS 1.0&#x2F;1.1</td>\n</tr>\n<tr>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"任务-4-进阶-使用-PowerShell-提取关键信息\"><a href=\"#任务-4-进阶-使用-PowerShell-提取关键信息\" class=\"headerlink\" title=\"任务 4(进阶):使用 PowerShell 提取关键信息\"></a>任务 4(进阶):使用 PowerShell 提取关键信息</h3><p>虽然 Nessus 提供了 Web 界面,但我们可以用 PowerShell 解析导出的 CSV 报告。</p>\n<p><strong>步骤 1:导出 CSV 格式报告</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">1. Export → CSV</span><br><span class=\"line\">2. 保存为:Day023_Report.csv</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 2:用 PowerShell 分析</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 读取 CSV</span></span><br><span class=\"line\"><span class=\"variable\">$vulns</span> = <span class=\"built_in\">Import-Csv</span> <span class=\"literal\">-Path</span> <span class=\"string\">&quot;.\\Day023_Report.csv&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 统计各等级漏洞数量</span></span><br><span class=\"line\"><span class=\"variable\">$vulns</span> | <span class=\"built_in\">Group-Object</span> Risk | <span class=\"built_in\">Sort-Object</span> Name | <span class=\"built_in\">Select-Object</span> Name, Count</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 提取高危及以上漏洞</span></span><br><span class=\"line\"><span class=\"variable\">$critical</span> = <span class=\"variable\">$vulns</span> | <span class=\"built_in\">Where-Object</span> &#123; <span class=\"variable\">$_</span>.Risk <span class=\"operator\">-in</span> <span class=\"selector-tag\">@</span>(<span class=\"string\">&quot;Critical&quot;</span>, <span class=\"string\">&quot;High&quot;</span>) &#125;</span><br><span class=\"line\"><span class=\"variable\">$critical</span> | <span class=\"built_in\">Select-Object</span> Risk, Name, Host, Port | <span class=\"built_in\">Format-Table</span> <span class=\"literal\">-AutoSize</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 导出高危漏洞清单</span></span><br><span class=\"line\"><span class=\"variable\">$critical</span> | <span class=\"built_in\">Export-Csv</span> <span class=\"literal\">-Path</span> <span class=\"string\">&quot;.\\Day023_Critical.csv&quot;</span> <span class=\"literal\">-NoTypeInformation</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Write-Host</span> <span class=\"string\">&quot;✅ 已导出 <span class=\"variable\">$</span>(<span class=\"variable\">$critical</span>.Count) 个高危及以上漏洞&quot;</span> <span class=\"literal\">-ForegroundColor</span> Green</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-5-可选-扫描虚拟机\"><a href=\"#任务-5-可选-扫描虚拟机\" class=\"headerlink\" title=\"任务 5(可选):扫描虚拟机\"></a>任务 5(可选):扫描虚拟机</h3><p>如果你有虚拟机(如 Windows Server&#x2F;Ubuntu),可以进行跨主机扫描。</p>\n<p><strong>前置条件</strong>:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">1. 虚拟机网络模式:桥接模式或 NAT(确保主机能 ping 通虚拟机)</span><br><span class=\"line\">2. 虚拟机防火墙:暂时允许 ICMP 和常见端口(扫描后恢复)</span><br></pre></td></tr></table></figure>\n\n<p><strong>扫描配置</strong>:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">1. 创建新扫描任务</span><br><span class=\"line\">2. Targets: 192.168.x.x(虚拟机 IP)</span><br><span class=\"line\">3. Credentials: 如果提供凭据,可以执行&quot;认证扫描&quot;(更准确)</span><br><span class=\"line\">   - Windows: 本地管理员账号</span><br><span class=\"line\">   - Linux: root 或 sudo 用户</span><br><span class=\"line\">4. 启动扫描</span><br></pre></td></tr></table></figure>\n\n<p><strong>认证扫描 vs 非认证扫描</strong>:</p>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>优点</th>\n<th>缺点</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>非认证扫描</td>\n<td>无需账号,快速</td>\n<td>只能检测外部可见漏洞</td>\n</tr>\n<tr>\n<td>认证扫描</td>\n<td>可检测补丁缺失、配置错误</td>\n<td>需要管理员权限,速度较慢</td>\n</tr>\n</tbody></table>\n<hr>\n<h2 id=\"巩固练习\"><a href=\"#巩固练习\" class=\"headerlink\" title=\"巩固练习\"></a>巩固练习</h2><h3 id=\"题-1-CVSS-分数-8-1-的漏洞应该优先修复吗\"><a href=\"#题-1-CVSS-分数-8-1-的漏洞应该优先修复吗\" class=\"headerlink\" title=\"题 1:CVSS 分数 8.1 的漏洞应该优先修复吗?\"></a>题 1:CVSS 分数 8.1 的漏洞应该优先修复吗?</h3><p><strong>思路提示</strong>:</p>\n<ul>\n<li>CVSS 8.1 属于”高危”等级</li>\n<li>但修复优先级还需考虑:<ul>\n<li>是否可远程利用?</li>\n<li>是否已有公开 Exploit?</li>\n<li>资产重要性(核心业务系统 vs 测试环境)</li>\n<li>修复成本与业务影响</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"题-2-为什么-Nessus-扫描结果中会有”False-Positive”-误报\"><a href=\"#题-2-为什么-Nessus-扫描结果中会有”False-Positive”-误报\" class=\"headerlink\" title=\"题 2:为什么 Nessus 扫描结果中会有”False Positive”(误报)?\"></a>题 2:为什么 Nessus 扫描结果中会有”False Positive”(误报)?</h3><p><strong>思路提示</strong>:</p>\n<ul>\n<li>漏洞扫描器基于”特征匹配”,可能误判</li>\n<li>常见误报原因:<ul>\n<li>Banner 伪装(服务器故意修改版本号)</li>\n<li>补丁已打但 Banner 未更新</li>\n<li>扫描器插件过时</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"题-3-未经授权扫描公网-IP-有什么法律后果\"><a href=\"#题-3-未经授权扫描公网-IP-有什么法律后果\" class=\"headerlink\" title=\"题 3:未经授权扫描公网 IP 有什么法律后果?\"></a>题 3:未经授权扫描公网 IP 有什么法律后果?</h3><p><strong>思路提示</strong>:</p>\n<ul>\n<li>涉及法律:《网络安全法》、《刑法》第 285 条、第 286 条</li>\n<li>即使”没有恶意”也可能构成犯罪</li>\n</ul>\n<h3 id=\"题-4-认证扫描和非认证扫描的主要区别是什么\"><a href=\"#题-4-认证扫描和非认证扫描的主要区别是什么\" class=\"headerlink\" title=\"题 4:认证扫描和非认证扫描的主要区别是什么?\"></a>题 4:认证扫描和非认证扫描的主要区别是什么?</h3><p><strong>思路提示</strong>:</p>\n<ul>\n<li>认证扫描:提供系统凭据,可以登录系统检查内部配置</li>\n<li>非认证扫描:仅从外部探测,无法检测需要登录才能发现的问题</li>\n<li>准确性、覆盖范围、所需权限的差异</li>\n</ul>\n<h3 id=\"题-5-如何判断一个漏洞是否需要立即修复\"><a href=\"#题-5-如何判断一个漏洞是否需要立即修复\" class=\"headerlink\" title=\"题 5:如何判断一个漏洞是否需要立即修复?\"></a>题 5:如何判断一个漏洞是否需要立即修复?</h3><p><strong>思路提示</strong>:</p>\n<ul>\n<li>CVSS 分数只是参考,不是唯一标准</li>\n<li>需要考虑:可利用性、资产重要性、业务影响、是否有补偿控制措施</li>\n</ul>\n<hr>\n<h2 id=\"评估标准\"><a href=\"#评估标准\" class=\"headerlink\" title=\"评估标准\"></a>评估标准</h2><ul>\n<li>✅ 你能清楚说明漏洞扫描的合法授权边界</li>\n<li>✅ 你能在 Windows 上完成 Nessus Essentials 安装并启动服务</li>\n<li>✅ 你能对本机或虚拟机执行一次完整扫描</li>\n<li>✅ 你能解读扫描报告,识别高危漏洞并提取修复建议</li>\n<li>✅ 你能用 PowerShell 提取扫描报告中的关键信息</li>\n<li>✅ 你能解释 CVSS 评分体系与修复优先级判断</li>\n</ul>\n<hr>\n<h2 id=\"学习成果达成情况-由学习者填写\"><a href=\"#学习成果达成情况-由学习者填写\" class=\"headerlink\" title=\"学习成果达成情况(由学习者填写)\"></a>学习成果达成情况(由学习者填写)</h2><h3 id=\"截图与证据\"><a href=\"#截图与证据\" class=\"headerlink\" title=\"截图与证据\"></a>截图与证据</h3><ul>\n<li><input disabled=\"\" type=\"checkbox\"> Nessus 服务运行截图(<code>Get-Service</code> 输出)</li>\n<li><input disabled=\"\" type=\"checkbox\"> Nessus Web UI 登录截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 扫描任务配置截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 扫描完成后的结果总览截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 导出的 PDF 报告(Day023_Report.pdf)</li>\n<li><input disabled=\"\" type=\"checkbox\"> PowerShell 提取的高危漏洞清单(Day023_Critical.csv)</li>\n</ul>\n<h3 id=\"关键命令与输出\"><a href=\"#关键命令与输出\" class=\"headerlink\" title=\"关键命令与输出\"></a>关键命令与输出</h3><p><strong>Nessus 服务状态</strong>:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Name            Status   StartType</span><br><span class=\"line\">----            ------   ---------</span><br><span class=\"line\">Tenable Nessus  Running  Automatic</span><br></pre></td></tr></table></figure>\n\n<p><strong>扫描结果统计</strong>:</p>\n<ul>\n<li>Critical: ___ 个</li>\n<li>High: ___ 个</li>\n<li>Medium: ___ 个</li>\n<li>Low: ___ 个</li>\n<li>Info: ___ 个</li>\n</ul>\n<p><strong>高危漏洞示例</strong>:</p>\n<table>\n<thead>\n<tr>\n<th>CVE</th>\n<th>漏洞名称</th>\n<th>CVSS</th>\n<th>受影响端口</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n<td>…</td>\n</tr>\n</tbody></table>\n<h3 id=\"结论与反思\"><a href=\"#结论与反思\" class=\"headerlink\" title=\"结论与反思\"></a>结论与反思</h3><p><strong>我今天搞清楚了</strong>:</p>\n<ul>\n<li>(例如:漏洞扫描必须在授权范围内,CVSS 评分不是唯一的修复依据)</li>\n</ul>\n<p><strong>我差点搞混的是</strong>:</p>\n<ul>\n<li>(例如:误以为”低危”漏洞可以不管,实际上组合利用也可能造成严重后果)</li>\n</ul>\n<p><strong>明天我要继续补的是</strong>:</p>\n<ul>\n<li>(例如:学习如何配置认证扫描,提高漏洞检测准确率)</li>\n</ul>\n<p><strong>本次学习耗时</strong>:约 ___ 小时</p>\n<p><strong>掌握程度自评</strong>:</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 😕 看懂了但没动手</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🙂 完成了 Nessus 安装和基础扫描</li>\n<li><input disabled=\"\" type=\"checkbox\"> 😃 完成了所有任务并理解报告结构</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🤩 额外做了认证扫描或虚拟机扫描</li>\n</ul>\n<hr>\n<h2 id=\"集中参考答案\"><a href=\"#集中参考答案\" class=\"headerlink\" title=\"集中参考答案\"></a>集中参考答案</h2><h3 id=\"题-1-参考答案\"><a href=\"#题-1-参考答案\" class=\"headerlink\" title=\"题 1 参考答案\"></a>题 1 参考答案</h3><p>CVSS 8.1 属于高危,但修复优先级需综合考虑:</p>\n<ul>\n<li>可利用性(是否有公开 Exploit)</li>\n<li>资产重要性(生产环境 vs 测试环境)</li>\n<li>暴露面(外网可访问 vs 仅内网)</li>\n<li>修复成本(是否需要停机)</li>\n</ul>\n<p><strong>决策矩阵</strong>:</p>\n<table>\n<thead>\n<tr>\n<th>条件</th>\n<th>优先级</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>远程可利用 + 有 Exploit + 生产环境</td>\n<td>🔴 立即修复</td>\n</tr>\n<tr>\n<td>远程可利用 + 无 Exploit + 生产环境</td>\n<td>🟠 7 天内修复</td>\n</tr>\n<tr>\n<td>仅本地可利用 + 测试环境</td>\n<td>🟡 下次维护窗口修复</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"题-2-参考答案\"><a href=\"#题-2-参考答案\" class=\"headerlink\" title=\"题 2 参考答案\"></a>题 2 参考答案</h3><p>误报原因:</p>\n<ol>\n<li><strong>Banner 匹配不准确</strong>:版本号未更新但已打补丁</li>\n<li><strong>插件检测逻辑不严谨</strong>:未实际验证漏洞</li>\n<li><strong>环境差异</strong>:某些漏洞仅特定配置可利用</li>\n</ol>\n<p><strong>降低误报的方法</strong>:</p>\n<ul>\n<li>启用认证扫描(可检查实际补丁状态)</li>\n<li>手动验证高危漏洞</li>\n<li>使用多个扫描器交叉验证</li>\n</ul>\n<hr>\n<h3 id=\"题-3-参考答案\"><a href=\"#题-3-参考答案\" class=\"headerlink\" title=\"题 3 参考答案\"></a>题 3 参考答案</h3><p>未授权扫描可能触犯:</p>\n<ul>\n<li>《刑法》第 285 条(非法侵入计算机信息系统罪):3 年以下有期徒刑或拘役</li>\n<li>《刑法》第 286 条(破坏计算机信息系统罪):5 年以下有期徒刑或拘役</li>\n</ul>\n<p><strong>真实案例</strong>:</p>\n<ul>\n<li>2018 年某大学生”练手”扫描学校服务器,被判缓刑</li>\n<li>2020 年某安全从业者扫描客户系统但未签合同,被起诉索赔</li>\n</ul>\n<p><strong>合法途径</strong>:</p>\n<ul>\n<li>扫描自己的设备</li>\n<li>获得书面授权后扫描企业内部系统</li>\n<li>参与合法的 SRC&#x2F;漏洞赏金计划</li>\n<li>使用官方靶场练习</li>\n</ul>\n<hr>\n<h3 id=\"题-4-参考答案\"><a href=\"#题-4-参考答案\" class=\"headerlink\" title=\"题 4 参考答案\"></a>题 4 参考答案</h3><table>\n<thead>\n<tr>\n<th>类型</th>\n<th>认证扫描</th>\n<th>非认证扫描</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>需要凭据</strong></td>\n<td>是(管理员账号)</td>\n<td>否</td>\n</tr>\n<tr>\n<td><strong>检测深度</strong></td>\n<td>深(可检查补丁、配置、本地漏洞)</td>\n<td>浅(仅外部可见漏洞)</td>\n</tr>\n<tr>\n<td><strong>准确性</strong></td>\n<td>高(误报率低)</td>\n<td>中(依赖 Banner)</td>\n</tr>\n<tr>\n<td><strong>速度</strong></td>\n<td>慢</td>\n<td>快</td>\n</tr>\n<tr>\n<td><strong>典型用途</strong></td>\n<td>合规审计、内部评估</td>\n<td>外部渗透测试前期侦查</td>\n</tr>\n</tbody></table>\n<p><strong>推荐做法</strong>:</p>\n<ul>\n<li>内部系统:优先使用认证扫描</li>\n<li>外部系统:先非认证扫描,发现问题后再申请认证扫描</li>\n</ul>\n<hr>\n<h3 id=\"题-5-参考答案\"><a href=\"#题-5-参考答案\" class=\"headerlink\" title=\"题 5 参考答案\"></a>题 5 参考答案</h3><p><strong>修复优先级判断矩阵</strong>:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">优先级 = f(CVSS 分数, 可利用性, 资产重要性, 暴露面, 补偿控制)</span><br><span class=\"line\"></span><br><span class=\"line\">示例:</span><br><span class=\"line\">- 漏洞 A: CVSS 9.8, 已有公开 Exploit, 影响外网 Web 服务器</span><br><span class=\"line\">  → 🔴 P0: 立即修复(24 小时内)</span><br><span class=\"line\"></span><br><span class=\"line\">- 漏洞 B: CVSS 8.1, 无公开 Exploit, 影响内网测试环境</span><br><span class=\"line\">  → 🟡 P2: 下次维护窗口修复(30 天内)</span><br><span class=\"line\"></span><br><span class=\"line\">- 漏洞 C: CVSS 7.5, 已有防火墙限制访问, 仅内网可达</span><br><span class=\"line\">  → 🟢 P3: 计划修复(90 天内)</span><br></pre></td></tr></table></figure>\n\n<p><strong>补偿控制措施</strong>:</p>\n<ul>\n<li>防火墙规则限制访问</li>\n<li>WAF&#x2F;IPS 规则拦截已知攻击</li>\n<li>网络隔离(VLAN 分段)</li>\n<li>监控告警(检测异常访问)</li>\n</ul>\n<hr>\n<h2 id=\"学习成果示例填写\"><a href=\"#学习成果示例填写\" class=\"headerlink\" title=\"学习成果示例填写\"></a>学习成果示例填写</h2><h3 id=\"截图与证据-示例\"><a href=\"#截图与证据-示例\" class=\"headerlink\" title=\"截图与证据(示例)\"></a>截图与证据(示例)</h3><ul>\n<li>Nessus 服务运行截图:<code>images/day023_nessus_service.png</code></li>\n<li>扫描结果总览:<code>images/day023_scan_summary.png</code></li>\n<li>高危漏洞清单:<code>Day023_Critical.csv</code>(3 个高危漏洞)</li>\n</ul>\n<h3 id=\"关键命令与输出-示例\"><a href=\"#关键命令与输出-示例\" class=\"headerlink\" title=\"关键命令与输出(示例)\"></a>关键命令与输出(示例)</h3><p><strong>扫描结果统计</strong>:</p>\n<ul>\n<li>Critical: 0 个</li>\n<li>High: 3 个</li>\n<li>Medium: 12 个</li>\n<li>Low: 8 个</li>\n<li>Info: 25 个</li>\n</ul>\n<p><strong>高危漏洞示例</strong>:</p>\n<table>\n<thead>\n<tr>\n<th>CVE</th>\n<th>漏洞名称</th>\n<th>CVSS</th>\n<th>受影响端口</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>CVE-2017-0143</td>\n<td>MS17-010 (EternalBlue)</td>\n<td>8.1</td>\n<td>445&#x2F;tcp</td>\n</tr>\n<tr>\n<td>N&#x2F;A</td>\n<td>TLS 1.0 Enabled</td>\n<td>7.5</td>\n<td>443&#x2F;tcp</td>\n</tr>\n<tr>\n<td>CVE-2019-0708</td>\n<td>BlueKeep (RDP RCE)</td>\n<td>9.8</td>\n<td>3389&#x2F;tcp</td>\n</tr>\n</tbody></table>\n<h3 id=\"结论与反思-示例\"><a href=\"#结论与反思-示例\" class=\"headerlink\" title=\"结论与反思(示例)\"></a>结论与反思(示例)</h3><p><strong>我今天搞清楚了</strong>:</p>\n<ul>\n<li>漏洞扫描必须在合法授权范围内,否则可能触犯刑法</li>\n<li>CVSS 分数是参考,不是唯一的修复依据</li>\n<li>认证扫描比非认证扫描更准确,但需要管理员权限</li>\n<li>误报是常见现象,需要手动验证</li>\n</ul>\n<p><strong>我差点搞混的是</strong>:</p>\n<ul>\n<li>以为”信息级”漏洞可以忽略,实际上 Banner 泄露可能帮助攻击者制定攻击策略</li>\n<li>以为 CVSS 10.0 就一定要立即修复,但还要看是否真实可利用和资产重要性</li>\n</ul>\n<p><strong>明天我要继续补的是</strong>:</p>\n<ul>\n<li>学习如何配置 Windows 认证扫描(提供凭据)</li>\n<li>研究如何手动验证漏洞(避免误报)</li>\n<li>建立漏洞修复跟踪流程</li>\n<li>学习系统基线检查项</li>\n</ul>\n<p><strong>本次学习耗时</strong>:约 3 小时(含 Nessus 插件下载时间)</p>\n<p><strong>掌握程度自评</strong>:</p>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> 😃 完成了所有任务并理解报告结构</li>\n</ul>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day024：漏洞扫描与基线 - 系统基线与审计","url":"/post/87578fee.html","content":"<h1 id=\"Day024：漏洞扫描与基线-系统基线与审计\"><a href=\"#Day024：漏洞扫描与基线-系统基线与审计\" class=\"headerlink\" title=\"Day024：漏洞扫描与基线 - 系统基线与审计\"></a>Day024：漏洞扫描与基线 - 系统基线与审计</h1><ul>\n<li>日期：2026-01-17</li>\n<li>周次：第4周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p>学完今天你应该能做到：</p>\n<ul>\n<li>能说出<strong>什么是基线</strong>以及<strong>为什么需要基线检查</strong></li>\n<li>掌握<strong>5条以上常见基线项</strong>（口令策略、补丁管理、服务暴露、权限配置、日志审计）</li>\n<li>能用脚本<strong>自动化检查本机&#x2F;靶机的关键基线项</strong>并输出结构化结果</li>\n<li>能根据检查结果<strong>识别风险并给出加固建议</strong></li>\n</ul>\n<hr>\n<span id=\"more\"></span>\n\n<h2 id=\"一、什么是基线（Baseline）？\"><a href=\"#一、什么是基线（Baseline）？\" class=\"headerlink\" title=\"一、什么是基线（Baseline）？\"></a>一、什么是基线（Baseline）？</h2><h3 id=\"1-1-基线定义\"><a href=\"#1-1-基线定义\" class=\"headerlink\" title=\"1.1 基线定义\"></a>1.1 基线定义</h3><p><strong>基线（Baseline）</strong>是系统安全配置的”最低安全标准”，就像房子的”地基”：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">基线检查的重要性</span><br><span class=\"line\">├─ 防止&quot;默认配置&quot;带来的风险（如：默认密码、默认服务）</span><br><span class=\"line\">├─ 确保&quot;合规性&quot;（如：等保、ISO27001、CIS Benchmark）</span><br><span class=\"line\">├─ 减少&quot;攻击面&quot;（关闭不必要的服务/端口）</span><br><span class=\"line\">└─ 便于&quot;审计与追踪&quot;（有标准可对比）</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-2-常见基线标准\"><a href=\"#1-2-常见基线标准\" class=\"headerlink\" title=\"1.2 常见基线标准\"></a>1.2 常见基线标准</h3><table>\n<thead>\n<tr>\n<th>标准名称</th>\n<th>适用范围</th>\n<th>特点</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>CIS Benchmark</strong></td>\n<td>通用（Linux&#x2F;Windows&#x2F;数据库&#x2F;云）</td>\n<td>社区维护，可免费使用</td>\n</tr>\n<tr>\n<td><strong>NIST 800-53</strong></td>\n<td>美国政府&#x2F;关键基础设施</td>\n<td>非常详细，覆盖全面</td>\n</tr>\n<tr>\n<td><strong>ISO 27001</strong></td>\n<td>国际通用信息安全管理体系</td>\n<td>侧重流程与管理</td>\n</tr>\n<tr>\n<td><strong>等保2.0</strong></td>\n<td>中国境内重要信息系统</td>\n<td>强制性合规要求</td>\n</tr>\n</tbody></table>\n<hr>\n<h2 id=\"二、五大基线检查项详解\"><a href=\"#二、五大基线检查项详解\" class=\"headerlink\" title=\"二、五大基线检查项详解\"></a>二、五大基线检查项详解</h2><h3 id=\"2-1-口令策略基线\"><a href=\"#2-1-口令策略基线\" class=\"headerlink\" title=\"2.1 口令策略基线\"></a>2.1 口令策略基线</h3><p><strong>Windows 基线项</strong>：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看当前密码策略</span></span><br><span class=\"line\">net accounts</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 检查项</span></span><br><span class=\"line\">├─ 密码最小长度（建议 ≥ <span class=\"number\">12</span>）</span><br><span class=\"line\">├─ 密码最长使用期限（建议 <span class=\"number\">90</span><span class=\"literal\">-180</span> 天）</span><br><span class=\"line\">├─ 密码历史（建议 ≥ <span class=\"number\">5</span> 个）</span><br><span class=\"line\">└─ 锁定阈值（建议 <span class=\"number\">5</span> 次失败后锁定）</span><br></pre></td></tr></table></figure>\n\n<p><strong>Linux 基线项</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看密码策略（PAM配置）</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> /etc/login.defs | grep -E <span class=\"string\">&quot;PASS_MAX_DAYS|PASS_MIN_DAYS|PASS_WARN_AGE&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 检查项</span></span><br><span class=\"line\">├─ PASS_MAX_DAYS ≤ 90（密码过期时间）</span><br><span class=\"line\">├─ PASS_MIN_DAYS ≥ 1（防止频繁修改密码）</span><br><span class=\"line\">└─ PASS_WARN_AGE ≥ 7（提前7天提醒）</span><br></pre></td></tr></table></figure>\n\n<p><strong>风险评估</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>策略</th>\n<th>不安全配置</th>\n<th>风险</th>\n<th>加固建议</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>密码长度</td>\n<td>&lt; 8 位</td>\n<td>容易被暴力破解</td>\n<td>最少12位+复杂性</td>\n</tr>\n<tr>\n<td>密码过期</td>\n<td>永不过期</td>\n<td>泄露后长期有效</td>\n<td>90-180天过期</td>\n</tr>\n<tr>\n<td>锁定策略</td>\n<td>无锁定</td>\n<td>暴力破解无限制</td>\n<td>5次失败锁定30分钟</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"2-2-补丁与更新基线\"><a href=\"#2-2-补丁与更新基线\" class=\"headerlink\" title=\"2.2 补丁与更新基线\"></a>2.2 补丁与更新基线</h3><p><strong>Windows 补丁检查</strong>：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看已安装的补丁</span></span><br><span class=\"line\">wmic qfe list brief</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 或使用 PowerShell 模块</span></span><br><span class=\"line\"><span class=\"built_in\">Get-HotFix</span> | <span class=\"built_in\">Select-Object</span> HotFixID, InstalledOn, Description | <span class=\"built_in\">Sort-Object</span> InstalledOn <span class=\"literal\">-Descending</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>Linux 补丁检查</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Ubuntu/Debian</span></span><br><span class=\"line\">apt list --upgradable</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># CentOS/RHEL</span></span><br><span class=\"line\">yum check-update</span><br></pre></td></tr></table></figure>\n\n<p><strong>风险评估</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>场景</th>\n<th>风险</th>\n<th>加固建议</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>系统长期未更新</td>\n<td>存在已知漏洞（如 Log4Shell）</td>\n<td>每月更新，重要漏洞立即补</td>\n</tr>\n<tr>\n<td>关键服务版本过旧</td>\n<td>CVE 评分 ≥ 9.0</td>\n<td>优先处理严重漏洞</td>\n</tr>\n<tr>\n<td>内核版本过旧</td>\n<td>权限提升漏洞</td>\n<td>定期更新内核</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"2-3-暴露服务基线\"><a href=\"#2-3-暴露服务基线\" class=\"headerlink\" title=\"2.3 暴露服务基线\"></a>2.3 暴露服务基线</h3><p><strong>检查开放端口</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Linux</span></span><br><span class=\"line\">ss -tulnp</span><br><span class=\"line\"><span class=\"comment\"># 或</span></span><br><span class=\"line\">netstat -tulnp</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Windows</span></span><br><span class=\"line\">netstat -ano | findstr LISTENING</span><br></pre></td></tr></table></figure>\n\n<p><strong>高风险端口清单</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>端口</th>\n<th>服务</th>\n<th>风险</th>\n<th>建议</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>21</strong></td>\n<td>FTP</td>\n<td>明文传输</td>\n<td>使用 SFTP&#x2F;FTP over TLS</td>\n</tr>\n<tr>\n<td><strong>23</strong></td>\n<td>Telnet</td>\n<td>明文传输</td>\n<td>使用 SSH</td>\n</tr>\n<tr>\n<td><strong>139&#x2F;445</strong></td>\n<td>SMB</td>\n<td>历史漏洞多</td>\n<td>禁用或限制访问源</td>\n</tr>\n<tr>\n<td><strong>3306</strong></td>\n<td>MySQL</td>\n<td>默认账户风险</td>\n<td>限制监听IP+强密码</td>\n</tr>\n<tr>\n<td><strong>3389</strong></td>\n<td>RDP</td>\n<td>远程桌面漏洞</td>\n<td>仅VPN访问+强密码</td>\n</tr>\n<tr>\n<td><strong>6379</strong></td>\n<td>Redis</td>\n<td>无认证风险</td>\n<td>配置认证+防火墙</td>\n</tr>\n</tbody></table>\n<p><strong>加固脚本示例</strong>（Linux）：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># 检查高风险端口</span></span><br><span class=\"line\">HIGH_RISK_PORTS=(21 23 3306 3389 6379)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> port <span class=\"keyword\">in</span> <span class=\"string\">&quot;<span class=\"variable\">$&#123;HIGH_RISK_PORTS[@]&#125;</span>&quot;</span>; <span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ss -tulnp | grep -q <span class=\"string\">&quot;:<span class=\"variable\">$port</span> &quot;</span>; <span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">&quot;[警告] 高风险端口 <span class=\"variable\">$port</span> 已开放&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2-4-权限配置基线\"><a href=\"#2-4-权限配置基线\" class=\"headerlink\" title=\"2.4 权限配置基线\"></a>2.4 权限配置基线</h3><p><strong>SUID&#x2F;SGID 检查</strong>（Linux）：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查找具有 SUID 位的文件</span></span><br><span class=\"line\">find / -perm -4000 -<span class=\"built_in\">type</span> f 2&gt;/dev/null</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查找具有 SGID 位的文件</span></span><br><span class=\"line\">find / -perm -2000 -<span class=\"built_in\">type</span> f 2&gt;/dev/null</span><br></pre></td></tr></table></figure>\n\n<p><strong>常见 SUID 文件风险评估</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>文件</th>\n<th>用途</th>\n<th>风险</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>/usr/bin/passwd</code></td>\n<td>修改密码</td>\n<td>正常（需要root权限）</td>\n</tr>\n<tr>\n<td><code>/usr/bin/sudo</code></td>\n<td>执行命令</td>\n<td>正常</td>\n</tr>\n<tr>\n<td><code>/usr/bin/vim</code></td>\n<td>文本编辑</td>\n<td>⚠️ 不应有SUID（可提权）</td>\n</tr>\n<tr>\n<td><code>/bin/bash</code></td>\n<td>Shell</td>\n<td>⚠️ 不应有SUID（可提权）</td>\n</tr>\n</tbody></table>\n<p><strong>Windows 权限检查</strong>：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 检查管理员组成员</span></span><br><span class=\"line\"><span class=\"built_in\">Get-LocalGroupMember</span> <span class=\"literal\">-Group</span> <span class=\"string\">&quot;Administrators&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 检查文件权限（如敏感目录）</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Acl</span> <span class=\"string\">&quot;C:\\inetpub\\wwwroot&quot;</span> | <span class=\"built_in\">Format-List</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2-5-日志审计基线\"><a href=\"#2-5-日志审计基线\" class=\"headerlink\" title=\"2.5 日志审计基线\"></a>2.5 日志审计基线</h3><p><strong>Linux 日志检查</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 检查日志目录权限（应仅 root 可写）</span></span><br><span class=\"line\"><span class=\"built_in\">ls</span> -ld /var/log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 检查关键日志文件</span></span><br><span class=\"line\">├─ /var/log/auth.log（认证日志）</span><br><span class=\"line\">├─ /var/log/syslog（系统日志）</span><br><span class=\"line\">└─ /var/log/secure（安全日志）</span><br></pre></td></tr></table></figure>\n\n<p><strong>Windows 日志检查</strong>：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 检查日志配置</span></span><br><span class=\"line\">wevtutil <span class=\"built_in\">gl</span> Security</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 检查关键事件ID</span></span><br><span class=\"line\">├─ <span class=\"number\">4624</span>/<span class=\"number\">4625</span>（登录成功/失败）</span><br><span class=\"line\">├─ <span class=\"number\">4720</span>/<span class=\"number\">4726</span>（创建/删除用户）</span><br><span class=\"line\">├─ <span class=\"number\">4688</span>（进程创建）</span><br><span class=\"line\">└─ <span class=\"number\">4740</span>（账户锁定）</span><br></pre></td></tr></table></figure>\n\n<p><strong>日志保留策略</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>日志类型</th>\n<th>最短保留时间</th>\n<th>用途</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>安全日志</td>\n<td>6个月</td>\n<td>取证溯源</td>\n</tr>\n<tr>\n<td>应用日志</td>\n<td>3个月</td>\n<td>故障排查</td>\n</tr>\n<tr>\n<td>审计日志</td>\n<td>1年</td>\n<td>合规要求</td>\n</tr>\n</tbody></table>\n<hr>\n<h2 id=\"三、实践任务\"><a href=\"#三、实践任务\" class=\"headerlink\" title=\"三、实践任务\"></a>三、实践任务</h2><h3 id=\"任务-1：Windows-本机基线检查脚本\"><a href=\"#任务-1：Windows-本机基线检查脚本\" class=\"headerlink\" title=\"任务 1：Windows 本机基线检查脚本\"></a>任务 1：Windows 本机基线检查脚本</h3><p><strong>目标</strong>：编写 PowerShell 脚本检查 5 大基线项，输出 CSV 报告。</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Windows 基线检查脚本</span></span><br><span class=\"line\"><span class=\"comment\"># 保存为 check_windows_baseline.ps1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$report</span> = <span class=\"selector-tag\">@</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 1. 密码策略检查</span></span><br><span class=\"line\"><span class=\"variable\">$passwordPolicy</span> = net accounts</span><br><span class=\"line\"><span class=\"variable\">$report</span> += [<span class=\"type\">PSCustomObject</span>]<span class=\"selector-tag\">@</span>&#123;</span><br><span class=\"line\">    Item = <span class=\"string\">&quot;密码策略&quot;</span></span><br><span class=\"line\">    Status = <span class=\"variable\">$passwordPolicy</span> <span class=\"operator\">-join</span> <span class=\"string\">&quot;;&quot;</span></span><br><span class=\"line\">    Risk = <span class=\"keyword\">if</span> (<span class=\"variable\">$passwordPolicy</span> <span class=\"operator\">-match</span> <span class=\"string\">&quot;Minimum password length: [0-8]&quot;</span>) &#123; <span class=\"string\">&quot;高&quot;</span> &#125; <span class=\"keyword\">else</span> &#123; <span class=\"string\">&quot;低&quot;</span> &#125;</span><br><span class=\"line\">    Recommendation = <span class=\"string\">&quot;密码长度建议 ≥ 12 位&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. 补丁检查</span></span><br><span class=\"line\"><span class=\"variable\">$lastPatch</span> = <span class=\"built_in\">Get-HotFix</span> | <span class=\"built_in\">Sort-Object</span> InstalledOn <span class=\"literal\">-Descending</span> | <span class=\"built_in\">Select-Object</span> <span class=\"literal\">-First</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"variable\">$report</span> += [<span class=\"type\">PSCustomObject</span>]<span class=\"selector-tag\">@</span>&#123;</span><br><span class=\"line\">    Item = <span class=\"string\">&quot;最近补丁&quot;</span></span><br><span class=\"line\">    Status = <span class=\"string\">&quot;<span class=\"variable\">$</span>(<span class=\"variable\">$lastPatch</span>.HotFixID) - <span class=\"variable\">$</span>(<span class=\"variable\">$lastPatch</span>.InstalledOn)&quot;</span></span><br><span class=\"line\">    Risk = <span class=\"keyword\">if</span> ((<span class=\"built_in\">Get-Date</span>) - <span class=\"variable\">$lastPatch</span>.InstalledOn <span class=\"operator\">-gt</span> (<span class=\"built_in\">New-TimeSpan</span> <span class=\"literal\">-Days</span> <span class=\"number\">90</span>)) &#123; <span class=\"string\">&quot;高&quot;</span> &#125; <span class=\"keyword\">else</span> &#123; <span class=\"string\">&quot;低&quot;</span> &#125;</span><br><span class=\"line\">    Recommendation = <span class=\"string\">&quot;建议每月更新补丁&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. 开放端口检查</span></span><br><span class=\"line\"><span class=\"variable\">$openPorts</span> = netstat <span class=\"literal\">-ano</span> | <span class=\"built_in\">Select-String</span> <span class=\"string\">&quot;LISTENING&quot;</span></span><br><span class=\"line\"><span class=\"variable\">$highRiskPorts</span> = <span class=\"selector-tag\">@</span>(<span class=\"string\">&quot;3306&quot;</span>, <span class=\"string\">&quot;3389&quot;</span>, <span class=\"string\">&quot;6379&quot;</span>)</span><br><span class=\"line\"><span class=\"variable\">$riskPorts</span> = <span class=\"variable\">$openPorts</span> | <span class=\"built_in\">Where-Object</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">foreach</span> (<span class=\"variable\">$port</span> <span class=\"keyword\">in</span> <span class=\"variable\">$highRiskPorts</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable\">$_</span> <span class=\"operator\">-match</span> <span class=\"string\">&quot;:<span class=\"variable\">$port</span> &quot;</span>) &#123; <span class=\"keyword\">return</span> <span class=\"variable\">$true</span> &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$report</span> += [<span class=\"type\">PSCustomObject</span>]<span class=\"selector-tag\">@</span>&#123;</span><br><span class=\"line\">    Item = <span class=\"string\">&quot;开放端口&quot;</span></span><br><span class=\"line\">    Status = <span class=\"string\">&quot;<span class=\"variable\">$</span>(<span class=\"variable\">$openPorts</span>.Count) 个端口开放&quot;</span></span><br><span class=\"line\">    Risk = <span class=\"keyword\">if</span> (<span class=\"variable\">$riskPorts</span>) &#123; <span class=\"string\">&quot;高&quot;</span> &#125; <span class=\"keyword\">else</span> &#123; <span class=\"string\">&quot;低&quot;</span> &#125;</span><br><span class=\"line\">    Recommendation = <span class=\"keyword\">if</span> (<span class=\"variable\">$riskPorts</span>) &#123; <span class=\"string\">&quot;关闭不必要的高风险端口&quot;</span> &#125; <span class=\"keyword\">else</span> &#123; <span class=\"string\">&quot;符合要求&quot;</span> &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4. 管理员组成员检查</span></span><br><span class=\"line\"><span class=\"variable\">$admins</span> = <span class=\"built_in\">Get-LocalGroupMember</span> <span class=\"literal\">-Group</span> <span class=\"string\">&quot;Administrators&quot;</span></span><br><span class=\"line\"><span class=\"variable\">$report</span> += [<span class=\"type\">PSCustomObject</span>]<span class=\"selector-tag\">@</span>&#123;</span><br><span class=\"line\">    Item = <span class=\"string\">&quot;管理员组成员&quot;</span></span><br><span class=\"line\">    Status = <span class=\"string\">&quot;<span class=\"variable\">$</span>(<span class=\"variable\">$admins</span>.Count) 个成员&quot;</span></span><br><span class=\"line\">    Risk = <span class=\"keyword\">if</span> (<span class=\"variable\">$admins</span>.Count <span class=\"operator\">-gt</span> <span class=\"number\">3</span>) &#123; <span class=\"string\">&quot;中&quot;</span> &#125; <span class=\"keyword\">else</span> &#123; <span class=\"string\">&quot;低&quot;</span> &#125;</span><br><span class=\"line\">    Recommendation = <span class=\"string\">&quot;审查管理员组成员，删除不必要账号&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5. 日志配置检查</span></span><br><span class=\"line\"><span class=\"variable\">$logConfig</span> = wevtutil <span class=\"built_in\">gl</span> Security</span><br><span class=\"line\"><span class=\"variable\">$report</span> += [<span class=\"type\">PSCustomObject</span>]<span class=\"selector-tag\">@</span>&#123;</span><br><span class=\"line\">    Item = <span class=\"string\">&quot;安全日志&quot;</span></span><br><span class=\"line\">    Status = (<span class=\"variable\">$logConfig</span> | <span class=\"built_in\">Select-String</span> <span class=\"string\">&quot;enabled&quot;</span>).ToString().Trim()</span><br><span class=\"line\">    Risk = <span class=\"string\">&quot;低&quot;</span></span><br><span class=\"line\">    Recommendation = <span class=\"string\">&quot;确保日志保留 ≥ 180 天&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 导出报告</span></span><br><span class=\"line\"><span class=\"variable\">$report</span> | <span class=\"built_in\">Export-Csv</span> <span class=\"literal\">-Path</span> <span class=\"string\">&quot;.\\baseline_report_<span class=\"variable\">$</span>(Get-Date -Format &#x27;yyyyMMdd&#x27;).csv&quot;</span> <span class=\"literal\">-NoTypeInformation</span></span><br><span class=\"line\"><span class=\"built_in\">Write-Output</span> <span class=\"string\">&quot;✅ 基线检查完成，报告已导出&quot;</span></span><br><span class=\"line\"><span class=\"variable\">$report</span> | <span class=\"built_in\">Format-Table</span> <span class=\"literal\">-AutoSize</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>运行脚本</strong>：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 允许脚本执行</span></span><br><span class=\"line\"><span class=\"built_in\">Set-ExecutionPolicy</span> <span class=\"literal\">-ExecutionPolicy</span> RemoteSigned <span class=\"literal\">-Scope</span> CurrentUser</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 运行检查</span></span><br><span class=\"line\">.\\check_windows_baseline.ps1</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-2：Linux-靶机基线检查\"><a href=\"#任务-2：Linux-靶机基线检查\" class=\"headerlink\" title=\"任务 2：Linux 靶机基线检查\"></a>任务 2：Linux 靶机基线检查</h3><p><strong>目标</strong>：编写 Shell 脚本检查 Linux 基线项。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># Linux 基线检查脚本</span></span><br><span class=\"line\"><span class=\"comment\"># 保存为 check_linux_baseline.sh</span></span><br><span class=\"line\"></span><br><span class=\"line\">REPORT=<span class=\"string\">&quot;baseline_report_<span class=\"subst\">$(date +%Y%m%d)</span>.txt&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;Linux 基线检查报告 - <span class=\"subst\">$(date)</span>&quot;</span> &gt; <span class=\"variable\">$REPORT</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;================================&quot;</span> &gt;&gt; <span class=\"variable\">$REPORT</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 1. 密码策略检查</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;&quot;</span> &gt;&gt; <span class=\"variable\">$REPORT</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;【1】密码策略检查&quot;</span> &gt;&gt; <span class=\"variable\">$REPORT</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> /etc/login.defs | grep -E <span class=\"string\">&quot;PASS_MAX_DAYS|PASS_MIN_DAYS&quot;</span> &gt;&gt; <span class=\"variable\">$REPORT</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. 补丁检查</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;&quot;</span> &gt;&gt; <span class=\"variable\">$REPORT</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;【2】补丁检查（待更新包）&quot;</span> &gt;&gt; <span class=\"variable\">$REPORT</span></span><br><span class=\"line\">apt list --upgradable 2&gt;/dev/null | <span class=\"built_in\">wc</span> -l &gt;&gt; <span class=\"variable\">$REPORT</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. 开放端口检查</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;&quot;</span> &gt;&gt; <span class=\"variable\">$REPORT</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;【3】开放端口&quot;</span> &gt;&gt; <span class=\"variable\">$REPORT</span></span><br><span class=\"line\">ss -tulnp &gt;&gt; <span class=\"variable\">$REPORT</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4. SUID 文件检查</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;&quot;</span> &gt;&gt; <span class=\"variable\">$REPORT</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;【4】SUID 文件&quot;</span> &gt;&gt; <span class=\"variable\">$REPORT</span></span><br><span class=\"line\">find / -perm -4000 -<span class=\"built_in\">type</span> f 2&gt;/dev/null &gt;&gt; <span class=\"variable\">$REPORT</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5. 日志目录权限检查</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;&quot;</span> &gt;&gt; <span class=\"variable\">$REPORT</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;【5】日志目录权限&quot;</span> &gt;&gt; <span class=\"variable\">$REPORT</span></span><br><span class=\"line\"><span class=\"built_in\">ls</span> -ld /var/log &gt;&gt; <span class=\"variable\">$REPORT</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;&quot;</span> &gt;&gt; <span class=\"variable\">$REPORT</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;检查完成，报告已保存到: <span class=\"variable\">$REPORT</span>&quot;</span> &gt;&gt; <span class=\"variable\">$REPORT</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cat</span> <span class=\"variable\">$REPORT</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>运行脚本</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">chmod</span> +x check_linux_baseline.sh</span><br><span class=\"line\">./check_linux_baseline.sh</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-3：基线结果分析与加固\"><a href=\"#任务-3：基线结果分析与加固\" class=\"headerlink\" title=\"任务 3：基线结果分析与加固\"></a>任务 3：基线结果分析与加固</h3><p><strong>目标</strong>：根据基线检查结果，识别 Top 3 风险项并给出加固建议。</p>\n<p><strong>示例报告</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">【基线检查结果分析】</span><br><span class=\"line\"></span><br><span class=\"line\">高风险项：</span><br><span class=\"line\">1. [密码策略] 密码最小长度为 6 位</span><br><span class=\"line\">   建议：修改为 ≥ 12 位，增加复杂性要求</span><br><span class=\"line\"></span><br><span class=\"line\">2. [开放端口] 3306 (MySQL) 对公网开放</span><br><span class=\"line\">   建议：修改 MySQL 配置，仅监听 127.0.0.1</span><br><span class=\"line\"></span><br><span class=\"line\">3. [补丁管理] 超过 90 天未更新</span><br><span class=\"line\">   建议：检查重要补丁，优先修复 CVE ≥ 7.0</span><br><span class=\"line\"></span><br><span class=\"line\">中风险项：</span><br><span class=\"line\">4. [管理员组] 发现 5 个成员</span><br><span class=\"line\">   建议：审查成员列表，删除临时账号</span><br><span class=\"line\"></span><br><span class=\"line\">低风险项：</span><br><span class=\"line\">5. [日志配置] 日志已启用，保留策略合理</span><br><span class=\"line\">   建议：继续保持</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"四、巩固练习\"><a href=\"#四、巩固练习\" class=\"headerlink\" title=\"四、巩固练习\"></a>四、巩固练习</h2><h3 id=\"练习-1：列举-5-条常见基线项\"><a href=\"#练习-1：列举-5-条常见基线项\" class=\"headerlink\" title=\"练习 1：列举 5 条常见基线项\"></a>练习 1：列举 5 条常见基线项</h3><p><strong>参考答案</strong>：</p>\n<ol>\n<li><strong>密码策略</strong>：最小长度、过期时间、历史记录、锁定阈值</li>\n<li><strong>补丁管理</strong>：系统更新频率、关键组件版本、已知漏洞修复</li>\n<li><strong>服务暴露</strong>：开放端口、监听地址、防火墙规则</li>\n<li><strong>权限配置</strong>：SUID&#x2F;SGID 文件、文件权限、管理员组成员</li>\n<li><strong>日志审计</strong>：日志启用状态、保留时间、关键字段</li>\n</ol>\n<hr>\n<h3 id=\"练习-2：设计检查脚本的可扩展结构\"><a href=\"#练习-2：设计检查脚本的可扩展结构\" class=\"headerlink\" title=\"练习 2：设计检查脚本的可扩展结构\"></a>练习 2：设计检查脚本的可扩展结构</h3><p><strong>参考答案</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 可扩展的基线检查框架</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">BaselineCheck</span>:</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, name</span>):</span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.items = []</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">add_check</span>(<span class=\"params\">self, item, status, risk, recommendation</span>):</span><br><span class=\"line\">        self.items.append(&#123;</span><br><span class=\"line\">            <span class=\"string\">&#x27;item&#x27;</span>: item,</span><br><span class=\"line\">            <span class=\"string\">&#x27;status&#x27;</span>: status,</span><br><span class=\"line\">            <span class=\"string\">&#x27;risk&#x27;</span>: risk,</span><br><span class=\"line\">            <span class=\"string\">&#x27;recommendation&#x27;</span>: recommendation</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">export_csv</span>(<span class=\"params\">self, filename</span>):</span><br><span class=\"line\">        <span class=\"comment\"># 导出为 CSV</span></span><br><span class=\"line\">        <span class=\"keyword\">pass</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用示例</span></span><br><span class=\"line\">baseline = BaselineCheck(<span class=\"string\">&quot;Windows Server 2022&quot;</span>)</span><br><span class=\"line\">baseline.add_check(<span class=\"string\">&quot;密码策略&quot;</span>, <span class=\"string\">&quot;最小长度: 6&quot;</span>, <span class=\"string\">&quot;高&quot;</span>, <span class=\"string\">&quot;建议 ≥ 12 位&quot;</span>)</span><br><span class=\"line\">baseline.add_check(<span class=\"string\">&quot;开放端口&quot;</span>, <span class=\"string\">&quot;80, 443, 3389&quot;</span>, <span class=\"string\">&quot;中&quot;</span>, <span class=\"string\">&quot;3389 需限制访问源&quot;</span>)</span><br><span class=\"line\">baseline.export_csv(<span class=\"string\">&quot;baseline_report.csv&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"练习-3：如何定期自动化基线检查？\"><a href=\"#练习-3：如何定期自动化基线检查？\" class=\"headerlink\" title=\"练习 3：如何定期自动化基线检查？\"></a>练习 3：如何定期自动化基线检查？</h3><p><strong>参考答案</strong>：</p>\n<p><strong>Windows（任务计划程序）</strong>：</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 创建任务计划程序任务</span></span><br><span class=\"line\"><span class=\"variable\">$action</span> = <span class=\"built_in\">New-ScheduledTaskAction</span> <span class=\"literal\">-Execute</span> <span class=\"string\">&quot;powershell.exe&quot;</span> <span class=\"literal\">-Argument</span> <span class=\"string\">&quot;-File C:\\scripts\\check_windows_baseline.ps1&quot;</span></span><br><span class=\"line\"><span class=\"variable\">$trigger</span> = <span class=\"built_in\">New-ScheduledTaskTrigger</span> <span class=\"literal\">-Daily</span> <span class=\"literal\">-At</span> <span class=\"string\">&quot;02:00AM&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">Register-ScheduledTask</span> <span class=\"literal\">-Action</span> <span class=\"variable\">$action</span> <span class=\"literal\">-Trigger</span> <span class=\"variable\">$trigger</span> <span class=\"literal\">-TaskName</span> <span class=\"string\">&quot;每日基线检查&quot;</span> <span class=\"literal\">-Description</span> <span class=\"string\">&quot;每日凌晨2点执行基线检查&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>Linux（Cron）</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 编辑 crontab</span></span><br><span class=\"line\">crontab -e</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 每天凌晨 2 点执行</span></span><br><span class=\"line\">0 2 * * * /home/scripts/check_linux_baseline.sh</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"五、评估标准\"><a href=\"#五、评估标准\" class=\"headerlink\" title=\"五、评估标准\"></a>五、评估标准</h2><ul>\n<li>✅ 能说出什么是基线及其重要性</li>\n<li>✅ 掌握 5 条以上常见基线项</li>\n<li>✅ 能编写脚本检查本机&#x2F;靶机的关键基线项</li>\n<li>✅ 能识别风险并给出加固建议</li>\n<li>✅ 输出结构化报告（CSV&#x2F;JSON）</li>\n</ul>\n<hr>\n<h2 id=\"六、参考资料\"><a href=\"#六、参考资料\" class=\"headerlink\" title=\"六、参考资料\"></a>六、参考资料</h2><ul>\n<li><a href=\"https://www.cisecurity.org/cis-benchmarks/\">CIS Benchmarks</a></li>\n<li><a href=\"https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final\">NIST 800-53</a></li>\n<li><a href=\"https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-security-baselines\">Windows Security Baselines</a></li>\n</ul>\n<hr>\n<h2 id=\"七、学习成果达成情况（由学习者填写）\"><a href=\"#七、学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"七、学习成果达成情况（由学习者填写）\"></a>七、学习成果达成情况（由学习者填写）</h2><h3 id=\"截图与证据\"><a href=\"#截图与证据\" class=\"headerlink\" title=\"截图与证据\"></a>截图与证据</h3><ul>\n<li><input disabled=\"\" type=\"checkbox\"> Windows 基线检查脚本运行截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> Linux 基线检查脚本运行截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 生成的 CSV 报告文件</li>\n</ul>\n<h3 id=\"关键发现\"><a href=\"#关键发现\" class=\"headerlink\" title=\"关键发现\"></a>关键发现</h3><p><strong>密码策略</strong>：</p>\n<ul>\n<li>当前配置：</li>\n<li>风险等级：</li>\n<li>改进建议：</li>\n</ul>\n<p><strong>服务暴露</strong>：</p>\n<ul>\n<li>开放端口：</li>\n<li>高风险端口：</li>\n<li>改进建议：</li>\n</ul>\n<h3 id=\"结论与反思\"><a href=\"#结论与反思\" class=\"headerlink\" title=\"结论与反思\"></a>结论与反思</h3><p><strong>我今天搞清楚了</strong>：</p>\n<ul>\n<li>基线是系统安全的”最低标准”，必须定期检查</li>\n<li>常见的 5 大基线项：口令策略、补丁管理、服务暴露、权限配置、日志审计</li>\n<li>脚本化检查可以大大提高效率，输出结构化报告便于分析</li>\n</ul>\n<p><strong>我差点搞混的是</strong>：</p>\n<ul>\n<li>最初以为基线只是”检查密码”，实际上包含多个维度</li>\n<li>没意识到 SUID 文件可能带来的提权风险</li>\n</ul>\n<p><strong>明天我要继续补的是</strong>：</p>\n<ul>\n<li>Web 中间件基线检查（Day025）</li>\n<li>自动化基线检查脚本优化（Day026）</li>\n</ul>\n<p><strong>本次学习耗时</strong>：约 2.5 小时</p>\n<p><strong>掌握程度自评</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 😐 理解了基本概念，但实践不熟练</li>\n<li><input disabled=\"\" type=\"checkbox\"> 😃 完成了所有任务并理解原理</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🤩 能独立设计基线检查脚本并优化</li>\n</ul>\n<hr>\n<p><strong>恭喜！你已掌握系统基线与审计的核心技能。明天我们将学习 Web 中间件与常见暴露面，继续加固你的安全堡垒！</strong> 🎉</p>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day027：漏洞扫描与基线 - 加固复验与变更记录","url":"/post/cd46dc34.html","content":"<h1 id=\"Day027：漏洞扫描与基线-加固复验与变更记录\"><a href=\"#Day027：漏洞扫描与基线-加固复验与变更记录\" class=\"headerlink\" title=\"Day027：漏洞扫描与基线 - 加固复验与变更记录\"></a>Day027：漏洞扫描与基线 - 加固复验与变更记录</h1><ul>\n<li>日期：2026-01-20</li>\n<li>周次：第4周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p>今天你将掌握：</p>\n<ul>\n<li><strong>建立复验流程</strong>：验证安全加固措施是否生效</li>\n<li><strong>形成变更记录</strong>：规范记录配置变更，便于审计和回溯</li>\n<li><strong>理解回归风险</strong>：评估加固措施对业务功能的影响</li>\n<li><strong>制定回滚策略</strong>：在加固失败时快速恢复原配置</li>\n<li><strong>掌握变更管理</strong>：理解企业级变更审批流程</li>\n</ul>\n<hr>\n<span id=\"more\"></span>\n\n<h2 id=\"学习内容\"><a href=\"#学习内容\" class=\"headerlink\" title=\"学习内容\"></a>学习内容</h2><h3 id=\"1️⃣-加固复验的重要性\"><a href=\"#1️⃣-加固复验的重要性\" class=\"headerlink\" title=\"1️⃣ 加固复验的重要性\"></a>1️⃣ 加固复验的重要性</h3><h4 id=\"1-1-为什么需要复验？\"><a href=\"#1-1-为什么需要复验？\" class=\"headerlink\" title=\"1.1 为什么需要复验？\"></a>1.1 为什么需要复验？</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">加固后必须复验</span><br><span class=\"line\">├─ 确认措施生效（配置是否生效？）</span><br><span class=\"line\">├─ 检测副作用（是否影响业务？）</span><br><span class=\"line\">├─ 验证无误报（扫描器误判已修复？）</span><br><span class=\"line\">└─ 建立基线（作为后续对比基准）</span><br></pre></td></tr></table></figure>\n\n<p><strong>常见问题</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>场景</th>\n<th>问题</th>\n<th>后果</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>配置错误</td>\n<td>语法错误导致服务无法启动</td>\n<td>🔴 服务中断</td>\n</tr>\n<tr>\n<td>过度加固</td>\n<td>禁用必要功能导致业务异常</td>\n<td>🟠 功能失效</td>\n</tr>\n<tr>\n<td>未生效</td>\n<td>重启服务时配置未加载</td>\n<td>🟡 漏洞仍存在</td>\n</tr>\n<tr>\n<td>误报</td>\n<td>扫描器误判，实际无需加固</td>\n<td>🟢 虚惊一场</td>\n</tr>\n</tbody></table>\n<h4 id=\"1-2-复验流程\"><a href=\"#1-2-复验流程\" class=\"headerlink\" title=\"1.2 复验流程\"></a>1.2 复验流程</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">┌─────────────────────────────────────────────────────┐</span><br><span class=\"line\">│ 1. 加固前基线扫描（Baseline Scan）                 │</span><br><span class=\"line\">│    - 记录初始状态                                   │</span><br><span class=\"line\">│    - 保存配置备份                                   │</span><br><span class=\"line\">│    - 记录服务正常运行状态                           │</span><br><span class=\"line\">└─────────────────────────────────────────────────────┘</span><br><span class=\"line\">                         ↓</span><br><span class=\"line\">┌─────────────────────────────────────────────────────┐</span><br><span class=\"line\">│ 2. 执行安全加固                                     │</span><br><span class=\"line\">│    - 修改配置文件                                   │</span><br><span class=\"line\">│    - 重启服务                                       │</span><br><span class=\"line\">│    - 基础功能测试                                   │</span><br><span class=\"line\">└─────────────────────────────────────────────────────┘</span><br><span class=\"line\">                         ↓</span><br><span class=\"line\">┌─────────────────────────────────────────────────────┐</span><br><span class=\"line\">│ 3. 加固后复验扫描（Re-scan）                        │</span><br><span class=\"line\">│    - 执行相同扫描任务                               │</span><br><span class=\"line\">│    - 对比前后结果                                   │</span><br><span class=\"line\">│    - 验证措施是否生效                               │</span><br><span class=\"line\">└─────────────────────────────────────────────────────┘</span><br><span class=\"line\">                         ↓</span><br><span class=\"line\">┌─────────────────────────────────────────────────────┐</span><br><span class=\"line\">│ 4. 业务回归测试                                     │</span><br><span class=\"line\">│    - 测试核心业务功能                               │</span><br><span class=\"line\">│    - 验证用户访问是否正常                           │</span><br><span class=\"line\">│    - 检查日志无异常                                 │</span><br><span class=\"line\">└─────────────────────────────────────────────────────┘</span><br><span class=\"line\">                         ↓</span><br><span class=\"line\">┌─────────────────────────────────────────────────────┐</span><br><span class=\"line\">│ 5. 确认或回滚                                     │</span><br><span class=\"line\">│    ├─ 测试通过 → 确认变更，更新文档                 │</span><br><span class=\"line\">│    └─ 测试失败 → 立即回滚，分析原因                 │</span><br><span class=\"line\">└─────────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2️⃣-复验方法与对比技术\"><a href=\"#2️⃣-复验方法与对比技术\" class=\"headerlink\" title=\"2️⃣ 复验方法与对比技术\"></a>2️⃣ 复验方法与对比技术</h3><h4 id=\"2-1-配置文件对比\"><a href=\"#2-1-配置文件对比\" class=\"headerlink\" title=\"2.1 配置文件对比\"></a>2.1 配置文件对比</h4><p><strong>使用 <code>diff</code> 命令对比配置变化</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 备份原配置</span></span><br><span class=\"line\">sudo <span class=\"built_in\">cp</span> /etc/nginx/nginx.conf /etc/nginx/nginx.conf.backup_$(<span class=\"built_in\">date</span> +%Y%m%d)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 修改配置...</span></span><br><span class=\"line\">sudo nano /etc/nginx/nginx.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 对比配置变化</span></span><br><span class=\"line\">diff /etc/nginx/nginx.conf.backup_20260119 /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>\n\n<p><strong>输出示例</strong>：</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">--- nginx.conf.backup_20260119   2026-01-19 10:00:00</span></span><br><span class=\"line\"><span class=\"comment\">+++ nginx.conf                   2026-01-19 10:30:00</span></span><br><span class=\"line\"><span class=\"meta\">@@ -12,6 +12,9 @@</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> http &#123;</span><br><span class=\"line\">     include       /etc/nginx/mime.types;</span><br><span class=\"line\"><span class=\"addition\">+    server_tokens off;</span></span><br><span class=\"line\"><span class=\"addition\">+    add_header X-Frame-Options &quot;SAMEORIGIN&quot; always;</span></span><br><span class=\"line\"><span class=\"addition\">+    add_header X-Content-Type-Options &quot;nosniff&quot; always;</span></span><br><span class=\"line\">     default_type  application/octet-stream;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-2-服务状态对比\"><a href=\"#2-2-服务状态对比\" class=\"headerlink\" title=\"2.2 服务状态对比\"></a>2.2 服务状态对比</h4><p><strong>加固前后服务状态检查</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 加固前</span></span><br><span class=\"line\">systemctl status nginx | <span class=\"built_in\">head</span> -5</span><br><span class=\"line\"><span class=\"comment\"># 输出：Active: active (running)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 加固后（重启后再次检查）</span></span><br><span class=\"line\">systemctl status nginx | <span class=\"built_in\">head</span> -5</span><br><span class=\"line\"><span class=\"comment\"># 验证服务状态</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-3-扫描结果对比\"><a href=\"#2-3-扫描结果对比\" class=\"headerlink\" title=\"2.3 扫描结果对比\"></a>2.3 扫描结果对比</h4><p><strong>使用自动化工具对比</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python3</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">对比加固前后的扫描结果</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> csv</span><br><span class=\"line\"><span class=\"keyword\">from</span> pathlib <span class=\"keyword\">import</span> Path</span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">compare_reports</span>(<span class=\"params\">before_file: <span class=\"built_in\">str</span>, after_file: <span class=\"built_in\">str</span></span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;对比两个扫描报告</span></span><br><span class=\"line\"><span class=\"string\">    </span></span><br><span class=\"line\"><span class=\"string\">    Args:</span></span><br><span class=\"line\"><span class=\"string\">        before_file: 加固前报告路径</span></span><br><span class=\"line\"><span class=\"string\">        after_file: 加固后报告路径</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(before_file, <span class=\"string\">&quot;r&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        before_data = json.load(f)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(after_file, <span class=\"string\">&quot;r&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        after_data = json.load(f)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;=&quot;</span> * <span class=\"number\">60</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;加固前扫描时间: <span class=\"subst\">&#123;before_data[<span class=\"string\">&#x27;report_time&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;加固后扫描时间: <span class=\"subst\">&#123;after_data[<span class=\"string\">&#x27;report_time&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;=&quot;</span> * <span class=\"number\">60</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 提取检查结果</span></span><br><span class=\"line\">    before_checks = before_data[<span class=\"string\">&quot;targets&quot;</span>][<span class=\"number\">0</span>][<span class=\"string\">&quot;checks&quot;</span>]</span><br><span class=\"line\">    after_checks = after_data[<span class=\"string\">&quot;targets&quot;</span>][<span class=\"number\">0</span>][<span class=\"string\">&quot;checks&quot;</span>]</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 统计变化</span></span><br><span class=\"line\">    fixed = []</span><br><span class=\"line\">    still_failed = []</span><br><span class=\"line\">    new_failed = []</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 建立映射</span></span><br><span class=\"line\">    before_map = &#123;c[<span class=\"string\">&quot;name&quot;</span>]: c <span class=\"keyword\">for</span> c <span class=\"keyword\">in</span> before_checks&#125;</span><br><span class=\"line\">    after_map = &#123;c[<span class=\"string\">&quot;name&quot;</span>]: c <span class=\"keyword\">for</span> c <span class=\"keyword\">in</span> after_checks&#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">for</span> check_name <span class=\"keyword\">in</span> before_map:</span><br><span class=\"line\">        before = before_map[check_name]</span><br><span class=\"line\">        after = after_map.get(check_name)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> after:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> before[<span class=\"string\">&quot;status&quot;</span>] == <span class=\"string\">&quot;failed&quot;</span> <span class=\"keyword\">and</span> after[<span class=\"string\">&quot;status&quot;</span>] == <span class=\"string\">&quot;passed&quot;</span>:</span><br><span class=\"line\">                fixed.append(check_name)</span><br><span class=\"line\">            <span class=\"keyword\">elif</span> before[<span class=\"string\">&quot;status&quot;</span>] == <span class=\"string\">&quot;failed&quot;</span> <span class=\"keyword\">and</span> after[<span class=\"string\">&quot;status&quot;</span>] == <span class=\"string\">&quot;failed&quot;</span>:</span><br><span class=\"line\">                still_failed.append(check_name)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">for</span> check_name <span class=\"keyword\">in</span> after_map:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> check_name <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> before_map <span class=\"keyword\">and</span> after_map[check_name][<span class=\"string\">&quot;status&quot;</span>] == <span class=\"string\">&quot;failed&quot;</span>:</span><br><span class=\"line\">            new_failed.append(check_name)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 打印结果</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;\\n✅ 已修复 (<span class=\"subst\">&#123;<span class=\"built_in\">len</span>(fixed)&#125;</span> 个)&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> fixed:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;  - <span class=\"subst\">&#123;item&#125;</span>&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;\\n❌ 仍然失败 (<span class=\"subst\">&#123;<span class=\"built_in\">len</span>(still_failed)&#125;</span> 个)&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> still_failed:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;  - <span class=\"subst\">&#123;item&#125;</span>&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;\\n⚠️  新发现问题 (<span class=\"subst\">&#123;<span class=\"built_in\">len</span>(new_failed)&#125;</span> 个)&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> new_failed:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;  - <span class=\"subst\">&#123;item&#125;</span>&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 生成对比报告</span></span><br><span class=\"line\">    comparison_data = &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;comparison_time&quot;</span>: datetime.now().isoformat(),</span><br><span class=\"line\">        <span class=\"string\">&quot;before_report&quot;</span>: before_file,</span><br><span class=\"line\">        <span class=\"string\">&quot;after_report&quot;</span>: after_file,</span><br><span class=\"line\">        <span class=\"string\">&quot;summary&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;fixed&quot;</span>: <span class=\"built_in\">len</span>(fixed),</span><br><span class=\"line\">            <span class=\"string\">&quot;still_failed&quot;</span>: <span class=\"built_in\">len</span>(still_failed),</span><br><span class=\"line\">            <span class=\"string\">&quot;new_failed&quot;</span>: <span class=\"built_in\">len</span>(new_failed)</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;details&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;fixed&quot;</span>: fixed,</span><br><span class=\"line\">            <span class=\"string\">&quot;still_failed&quot;</span>: still_failed,</span><br><span class=\"line\">            <span class=\"string\">&quot;new_failed&quot;</span>: new_failed</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    output_file = <span class=\"string\">f&quot;comparison_<span class=\"subst\">&#123;datetime.now().strftime(<span class=\"string\">&#x27;%Y%m%d_%H%M%S&#x27;</span>)&#125;</span>.json&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(output_file, <span class=\"string\">&quot;w&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        json.dump(comparison_data, f, indent=<span class=\"number\">2</span>, ensure_ascii=<span class=\"literal\">False</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;\\n✅ 对比报告已保存: <span class=\"subst\">&#123;output_file&#125;</span>&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">import</span> sys</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(sys.argv) != <span class=\"number\">3</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;用法: python compare_reports.py &lt;before_report.json&gt; &lt;after_report.json&gt;&quot;</span>)</span><br><span class=\"line\">        sys.exit(<span class=\"number\">1</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    compare_reports(sys.argv[<span class=\"number\">1</span>], sys.argv[<span class=\"number\">2</span>])</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"3️⃣-变更记录模板\"><a href=\"#3️⃣-变更记录模板\" class=\"headerlink\" title=\"3️⃣ 变更记录模板\"></a>3️⃣ 变更记录模板</h3><h4 id=\"3-1-标准变更记录格式\"><a href=\"#3-1-标准变更记录格式\" class=\"headerlink\" title=\"3.1 标准变更记录格式\"></a>3.1 标准变更记录格式</h4><figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\"># 安全配置变更记录</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 基本信息</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 项目 | 内容 |</span><br><span class=\"line\">|------|------|</span><br><span class=\"line\">| 变更编号 | CR-2026-001 |</span><br><span class=\"line\">| 变更标题 | Nginx 服务器安全加固 |</span><br><span class=\"line\">| 申请人 | 张三 |</span><br><span class=\"line\">| 申请部门 | 信息安全部 |</span><br><span class=\"line\">| 申请日期 | 2026-01-19 |</span><br><span class=\"line\">| 预计执行日期 | 2026-01-20 02:00-04:00 |</span><br><span class=\"line\">| 优先级 | 高 |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 影响范围</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 项目 | 内容 |</span><br><span class=\"line\">|------|------|</span><br><span class=\"line\">| 影响系统 | 前端 Web 服务器 (192.168.1.10) |</span><br><span class=\"line\">| 影响服务 | Nginx HTTP 服务 (端口 80/443) |</span><br><span class=\"line\">| 影响用户 | 所有外部用户 |</span><br><span class=\"line\">| 影响时段 | 维护窗口（凌晨 2:00-4:00） |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 变更内容</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 变更前配置</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"code\">```nginx</span></span><br><span class=\"line\"><span class=\"code\"># /etc/nginx/nginx.conf</span></span><br><span class=\"line\"><span class=\"code\">http &#123;</span></span><br><span class=\"line\"><span class=\"code\">    include       /etc/nginx/mime.types;</span></span><br><span class=\"line\"><span class=\"code\">    default_type  application/octet-stream;</span></span><br><span class=\"line\"><span class=\"code\">    # ... 其他配置</span></span><br><span class=\"line\"><span class=\"code\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"变更后配置\"><a href=\"#变更后配置\" class=\"headerlink\" title=\"变更后配置\"></a>变更后配置</h3><figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># /etc/nginx/nginx.conf</span></span><br><span class=\"line\"><span class=\"section\">http</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">include</span>       /etc/nginx/mime.types;</span><br><span class=\"line\">    <span class=\"attribute\">default_type</span>  application/octet-stream;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 新增安全配置</span></span><br><span class=\"line\">    <span class=\"attribute\">server_tokens</span> <span class=\"literal\">off</span>;</span><br><span class=\"line\">    <span class=\"attribute\">add_header</span> X-Frame-Options <span class=\"string\">&quot;SAMEORIGIN&quot;</span> always;</span><br><span class=\"line\">    <span class=\"attribute\">add_header</span> X-Content-Type-Options <span class=\"string\">&quot;nosniff&quot;</span> always;</span><br><span class=\"line\">    <span class=\"attribute\">add_header</span> X-XSS-Protection <span class=\"string\">&quot;1; mode=block&quot;</span> always;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"变更项列表\"><a href=\"#变更项列表\" class=\"headerlink\" title=\"变更项列表\"></a>变更项列表</h3><table>\n<thead>\n<tr>\n<th>序号</th>\n<th>变更项</th>\n<th>配置文件</th>\n<th>风险等级</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>隐藏 Nginx 版本号</td>\n<td>&#x2F;etc&#x2F;nginx&#x2F;nginx.conf</td>\n<td>低</td>\n</tr>\n<tr>\n<td>2</td>\n<td>添加 X-Frame-Options 响应头</td>\n<td>&#x2F;etc&#x2F;nginx&#x2F;nginx.conf</td>\n<td>中</td>\n</tr>\n<tr>\n<td>3</td>\n<td>添加 X-Content-Type-Options 响应头</td>\n<td>&#x2F;etc&#x2F;nginx&#x2F;nginx.conf</td>\n<td>中</td>\n</tr>\n</tbody></table>\n<h2 id=\"回滚方案\"><a href=\"#回滚方案\" class=\"headerlink\" title=\"回滚方案\"></a>回滚方案</h2><h3 id=\"回滚步骤\"><a href=\"#回滚步骤\" class=\"headerlink\" title=\"回滚步骤\"></a>回滚步骤</h3><ol>\n<li><p>恢复配置文件：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo <span class=\"built_in\">cp</span> /etc/nginx/nginx.conf.backup_20260120 /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>测试配置文件语法：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo nginx -t</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>重启服务：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>验证服务状态：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo systemctl status nginx</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"回滚触发条件\"><a href=\"#回滚触发条件\" class=\"headerlink\" title=\"回滚触发条件\"></a>回滚触发条件</h3><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 服务启动失败</li>\n<li><input disabled=\"\" type=\"checkbox\"> 业务功能异常（如页面无法加载）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 用户投诉增加</li>\n<li><input disabled=\"\" type=\"checkbox\"> 日志中出现大量错误</li>\n<li><input disabled=\"\" type=\"checkbox\"> 响应时间明显变慢（增加超过 50%）</li>\n</ul>\n<h2 id=\"复验计划\"><a href=\"#复验计划\" class=\"headerlink\" title=\"复验计划\"></a>复验计划</h2><table>\n<thead>\n<tr>\n<th>项目</th>\n<th>内容</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>复验工具</td>\n<td>基线检查脚本 (Day026)</td>\n</tr>\n<tr>\n<td>复验内容</td>\n<td>版本信息泄露、安全响应头</td>\n</tr>\n<tr>\n<td>复验时间</td>\n<td>2026-01-20 04:00</td>\n</tr>\n<tr>\n<td>通过标准</td>\n<td>所有检查项状态为 “passed”</td>\n</tr>\n</tbody></table>\n<h2 id=\"审批记录\"><a href=\"#审批记录\" class=\"headerlink\" title=\"审批记录\"></a>审批记录</h2><table>\n<thead>\n<tr>\n<th>角色</th>\n<th>姓名</th>\n<th>意见</th>\n<th>签字</th>\n<th>日期</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>申请人</td>\n<td>张三</td>\n<td>同意</td>\n<td>张三</td>\n<td>2026-01-19</td>\n</tr>\n<tr>\n<td>技术审核</td>\n<td>李四</td>\n<td>建议测试环境先验证</td>\n<td>李四</td>\n<td>2026-01-19</td>\n</tr>\n<tr>\n<td>安全审核</td>\n<td>王五</td>\n<td>同意</td>\n<td>王五</td>\n<td>2026-01-19</td>\n</tr>\n<tr>\n<td>业务审批</td>\n<td>赵六</td>\n<td>需通知用户维护窗口</td>\n<td>赵六</td>\n<td>2026-01-19</td>\n</tr>\n</tbody></table>\n<h2 id=\"执行记录\"><a href=\"#执行记录\" class=\"headerlink\" title=\"执行记录\"></a>执行记录</h2><table>\n<thead>\n<tr>\n<th>项目</th>\n<th>内容</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>实际执行时间</td>\n<td>2026-01-20 02:15-03:30</td>\n</tr>\n<tr>\n<td>执行人</td>\n<td>张三</td>\n</tr>\n<tr>\n<td>执行状态</td>\n<td>✅ 成功</td>\n</tr>\n<tr>\n<td>执行日志</td>\n<td>见附件 execution_log.txt</td>\n</tr>\n<tr>\n<td>回滚操作</td>\n<td>未执行</td>\n</tr>\n</tbody></table>\n<h2 id=\"复验结果\"><a href=\"#复验结果\" class=\"headerlink\" title=\"复验结果\"></a>复验结果</h2><h3 id=\"加固前扫描（2026-01-19-10-00）\"><a href=\"#加固前扫描（2026-01-19-10-00）\" class=\"headerlink\" title=\"加固前扫描（2026-01-19 10:00）\"></a>加固前扫描（2026-01-19 10:00）</h3><table>\n<thead>\n<tr>\n<th>检查项</th>\n<th>状态</th>\n<th>风险等级</th>\n<th>消息</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>版本信息泄露</td>\n<td>❌ 失败</td>\n<td>中</td>\n<td>Server 头暴露版本</td>\n</tr>\n<tr>\n<td>安全响应头检查</td>\n<td>❌ 失败</td>\n<td>高</td>\n<td>缺少 3 个安全响应头</td>\n</tr>\n<tr>\n<td>目录列出检查</td>\n<td>✅ 通过</td>\n<td>-</td>\n<td>未发现目录列出</td>\n</tr>\n</tbody></table>\n<p><strong>通过率</strong>: 33.3% (1&#x2F;3)</p>\n<h3 id=\"加固后扫描（2026-01-20-04-00）\"><a href=\"#加固后扫描（2026-01-20-04-00）\" class=\"headerlink\" title=\"加固后扫描（2026-01-20 04:00）\"></a>加固后扫描（2026-01-20 04:00）</h3><table>\n<thead>\n<tr>\n<th>检查项</th>\n<th>状态</th>\n<th>风险等级</th>\n<th>消息</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>版本信息泄露</td>\n<td>✅ 通过</td>\n<td>-</td>\n<td>未发现版本信息泄露</td>\n</tr>\n<tr>\n<td>安全响应头检查</td>\n<td>✅ 通过</td>\n<td>-</td>\n<td>所有安全响应头已配置</td>\n</tr>\n<tr>\n<td>目录列出检查</td>\n<td>✅ 通过</td>\n<td>-</td>\n<td>未发现目录列出</td>\n</tr>\n</tbody></table>\n<p><strong>通过率</strong>: 100% (3&#x2F;3)</p>\n<h3 id=\"对比结论\"><a href=\"#对比结论\" class=\"headerlink\" title=\"对比结论\"></a>对比结论</h3><ul>\n<li>✅ 已修复：版本信息泄露、安全响应头检查</li>\n<li>✅ 无新增问题</li>\n<li>✅ 通过率从 33.3% 提升到 100%</li>\n</ul>\n<h2 id=\"业务回归测试\"><a href=\"#业务回归测试\" class=\"headerlink\" title=\"业务回归测试\"></a>业务回归测试</h2><table>\n<thead>\n<tr>\n<th>测试项</th>\n<th>测试结果</th>\n<th>备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>首页访问</td>\n<td>✅ 正常</td>\n<td>响应时间 &lt; 500ms</td>\n</tr>\n<tr>\n<td>用户登录</td>\n<td>✅ 正常</td>\n<td>-</td>\n</tr>\n<tr>\n<td>数据提交</td>\n<td>✅ 正常</td>\n<td>-</td>\n</tr>\n<tr>\n<td>静态资源加载</td>\n<td>✅ 正常</td>\n<td>-</td>\n</tr>\n<tr>\n<td>跨域请求</td>\n<td>✅ 正常</td>\n<td>-</td>\n</tr>\n</tbody></table>\n<h2 id=\"总结与后续计划\"><a href=\"#总结与后续计划\" class=\"headerlink\" title=\"总结与后续计划\"></a>总结与后续计划</h2><p><strong>总结</strong>：<br>本次变更成功完成，加固措施全部生效，业务功能正常，无副作用。</p>\n<p><strong>后续计划</strong>：</p>\n<ul>\n<li>1 周：持续监控服务器日志和用户反馈</li>\n<li>1 个月：将相同加固措施推广到其他 Web 服务器</li>\n<li>3 个月：定期复核加固措施有效性</li>\n</ul>\n<hr>\n<h2 id=\"4️⃣-回归风险与兼容性问题\"><a href=\"#4️⃣-回归风险与兼容性问题\" class=\"headerlink\" title=\"4️⃣ 回归风险与兼容性问题\"></a>4️⃣ 回归风险与兼容性问题</h2><h4 id=\"4-1-常见兼容性问题\"><a href=\"#4-1-常见兼容性问题\" class=\"headerlink\" title=\"4.1 常见兼容性问题\"></a>4.1 常见兼容性问题</h4><table>\n<thead>\n<tr>\n<th>加固措施</th>\n<th>潜在兼容性问题</th>\n<th>解决方案</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>安全响应头</strong></td>\n<td>某些旧版浏览器不支持 CSP</td>\n<td>降级使用 Report-Only 模式</td>\n</tr>\n<tr>\n<td><strong>HTTP 方法限制</strong></td>\n<td>API 端点依赖 PUT&#x2F;DELETE 方法</td>\n<td>白名单特定 API 端点</td>\n</tr>\n<tr>\n<td><strong>隐藏版本号</strong></td>\n<td>某些自动化脚本依赖版本号检测</td>\n<td>使用 User-Agent 替代</td>\n</tr>\n<tr>\n<td><strong>防火墙规则</strong></td>\n<td>阻断合法流量</td>\n<td>先在测试环境验证规则</td>\n</tr>\n<tr>\n<td><strong>TLS 加密</strong></td>\n<td>旧客户端不支持新协议</td>\n<td>保留旧协议支持</td>\n</tr>\n</tbody></table>\n<h4 id=\"4-2-回归测试检查清单\"><a href=\"#4-2-回归测试检查清单\" class=\"headerlink\" title=\"4.2 回归测试检查清单\"></a>4.2 回归测试检查清单</h4><figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">## Web 服务器加固回归测试清单</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 功能测试</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 首页能正常访问</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 用户登录功能正常</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 文件上传功能正常</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] API 接口响应正常</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 静态资源（图片、CSS、JS）加载正常</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 表单提交功能正常</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 兼容性测试</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] Chrome 最新版</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] Firefox 最新版</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] Safari 最新版</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] Edge 最新版</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 移动端浏览器（iOS Safari、Android Chrome）</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 性能测试</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 首页加载时间无明显增加</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] API 响应时间无明显增加</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 服务器 CPU/内存使用率正常</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 安全测试</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 安全响应头已添加</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 版本信息已隐藏</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 不安全 HTTP 方法已被禁止</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 目录列出已关闭</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 日志检查</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 错误日志无异常增加</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 访问日志流量正常</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 无用户投诉反馈</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"5️⃣-企业级变更管理流程\"><a href=\"#5️⃣-企业级变更管理流程\" class=\"headerlink\" title=\"5️⃣ 企业级变更管理流程\"></a>5️⃣ 企业级变更管理流程</h3><h4 id=\"5-1-变更管理最佳实践\"><a href=\"#5-1-变更管理最佳实践\" class=\"headerlink\" title=\"5.1 变更管理最佳实践\"></a>5.1 变更管理最佳实践</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">┌─────────────────────────────────────────────────────┐</span><br><span class=\"line\">│                   变更请求                         │</span><br><span class=\"line\">│  - 评估变更必要性                                  │</span><br><span class=\"line\">│  - 编写变更提案                                    │</span><br><span class=\"line\">│  - 风险评估                                        │</span><br><span class=\"line\">└─────────────────────────────────────────────────────┘</span><br><span class=\"line\">                         ↓</span><br><span class=\"line\">┌─────────────────────────────────────────────────────┐</span><br><span class=\"line\">│                   技术评审                         │</span><br><span class=\"line\">│  - 技术可行性分析                                  │</span><br><span class=\"line\">│  - 资源评估（时间、人力）                          │</span><br><span class=\"line\">│  - 影响范围评估                                    │</span><br><span class=\"line\">└─────────────────────────────────────────────────────┘</span><br><span class=\"line\">                         ↓</span><br><span class=\"line\">┌─────────────────────────────────────────────────────┐</span><br><span class=\"line\">│                   安全评审                         │</span><br><span class=\"line\">│  - 安全加固有效性评估                              │</span><br><span class=\"line\">│  - 潜在安全风险评估                                │</span><br><span class=\"line\">│  - 合规性检查                                      │</span><br><span class=\"line\">└─────────────────────────────────────────────────────┘</span><br><span class=\"line\">                         ↓</span><br><span class=\"line\">┌─────────────────────────────────────────────────────┐</span><br><span class=\"line\">│                   业务审批                         │</span><br><span class=\"line\">│  - 业务影响评估                                    │</span><br><span class=\"line\">│  - 用户通知计划                                    │</span><br><span class=\"line\">│  - 维护窗口确认                                    │</span><br><span class=\"line\">└─────────────────────────────────────────────────────┘</span><br><span class=\"line\">                         ↓</span><br><span class=\"line\">┌─────────────────────────────────────────────────────┐</span><br><span class=\"line\">│                   预发布测试                       │</span><br><span class=\"line\">│  - 在测试环境验证                                  │</span><br><span class=\"line\">│  - 执行回归测试                                    │</span><br><span class=\"line\">│  - 性能测试                                        │</span><br><span class=\"line\">└─────────────────────────────────────────────────────┘</span><br><span class=\"line\">                         ↓</span><br><span class=\"line\">┌─────────────────────────────────────────────────────┐</span><br><span class=\"line\">│                   正式发布                         │</span><br><span class=\"line\">│  - 执行变更                                        │</span><br><span class=\"line\">│  - 复验加固效果                                    │</span><br><span class=\"line\">│  - 监控系统状态                                    │</span><br><span class=\"line\">└─────────────────────────────────────────────────────┘</span><br><span class=\"line\">                         ↓</span><br><span class=\"line\">┌─────────────────────────────────────────────────────┐</span><br><span class=\"line\">│                   发布后审查                       │</span><br><span class=\"line\">│  - 24 小时监控期                                   │</span><br><span class=\"line\">│  - 用户反馈收集                                    │</span><br><span class=\"line\">│  - 变更记录归档                                    │</span><br><span class=\"line\">└─────────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"5-2-变更分类与审批权限\"><a href=\"#5-2-变更分类与审批权限\" class=\"headerlink\" title=\"5.2 变更分类与审批权限\"></a>5.2 变更分类与审批权限</h4><table>\n<thead>\n<tr>\n<th>变更类型</th>\n<th>风险等级</th>\n<th>审批流程</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>标准变更</strong></td>\n<td>低</td>\n<td>技术审批</td>\n<td>修改密码策略、添加防火墙规则</td>\n</tr>\n<tr>\n<td><strong>重大变更</strong></td>\n<td>中</td>\n<td>技术 + 安全 + 业务</td>\n<td>升级 Nginx 版本、修改核心配置</td>\n</tr>\n<tr>\n<td><strong>紧急变更</strong></td>\n<td>高</td>\n<td>紧急审批 + 事后报告</td>\n<td>修复已利用的 0-day 漏洞</td>\n</tr>\n</tbody></table>\n<hr>\n<h2 id=\"实践任务（合法授权范围内）\"><a href=\"#实践任务（合法授权范围内）\" class=\"headerlink\" title=\"实践任务（合法授权范围内）\"></a>实践任务（合法授权范围内）</h2><blockquote>\n<p><strong>注意</strong>：请在你自己的测试环境或授权靶场中执行以下任务。</p>\n</blockquote>\n<hr>\n<h3 id=\"任务-1（必做）：加固前基线扫描\"><a href=\"#任务-1（必做）：加固前基线扫描\" class=\"headerlink\" title=\"任务 1（必做）：加固前基线扫描\"></a>任务 1（必做）：加固前基线扫描</h3><p><strong>目标</strong>：对测试 Web 服务器执行加固前的基线扫描，建立基线数据。</p>\n<p><strong>步骤</strong>：</p>\n<ol>\n<li><strong>启动测试服务器</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 使用 Python 启动简单 HTTP 服务器（模拟未加固状态）</span></span><br><span class=\"line\">python -m http.server 8080</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><strong>执行基线检查</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> baseline_checker</span><br><span class=\"line\">python main.py --config config/targets.json --output results/before</span><br></pre></td></tr></table></figure>\n\n<p><strong>预期输出</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">加载了 1 个扫描目标</span><br><span class=\"line\"></span><br><span class=\"line\">============================================================</span><br><span class=\"line\">扫描目标: 本机测试 (web)</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">  ❌ [版本信息泄露] 发现版本信息泄露</span><br><span class=\"line\">  ❌ [安全响应头检查] 缺少 3 个安全响应头</span><br><span class=\"line\"></span><br><span class=\"line\">============================================================</span><br><span class=\"line\">报告生成完成！</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">✅ CSV 报告: results/before/baseline_report_20260120_100000.csv</span><br><span class=\"line\">✅ JSON 报告: results/before/baseline_report_20260120_100000.json</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><strong>记录基线数据</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 复制报告到基线目录</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> baseline</span><br><span class=\"line\"><span class=\"built_in\">cp</span> results/before/baseline_report_*.json baseline/</span><br><span class=\"line\"><span class=\"built_in\">cp</span> results/before/baseline_report_*.csv baseline/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 记录当前服务状态</span></span><br><span class=\"line\">systemctl status nginx &gt; baseline/nginx_status_before.txt</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-2（必做）：执行安全加固\"><a href=\"#任务-2（必做）：执行安全加固\" class=\"headerlink\" title=\"任务 2（必做）：执行安全加固\"></a>任务 2（必做）：执行安全加固</h3><p><strong>目标</strong>：根据 Day025 的内容配置 Web 服务器安全加固。</p>\n<p><strong>步骤</strong>：</p>\n<ol>\n<li><strong>备份当前配置</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Nginx</span></span><br><span class=\"line\">sudo <span class=\"built_in\">cp</span> /etc/nginx/nginx.conf /etc/nginx/nginx.conf.backup_$(<span class=\"built_in\">date</span> +%Y%m%d_%H%M%S)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 或简单 HTTP 服务器无需配置，直接进入下一步</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><strong>应用加固措施</strong></li>\n</ol>\n<p>如果使用 Nginx，按照 Day025 的内容修改配置：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">http</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">server_tokens</span> <span class=\"literal\">off</span>;</span><br><span class=\"line\">    <span class=\"attribute\">add_header</span> X-Frame-Options <span class=\"string\">&quot;SAMEORIGIN&quot;</span> always;</span><br><span class=\"line\">    <span class=\"attribute\">add_header</span> X-Content-Type-Options <span class=\"string\">&quot;nosniff&quot;</span> always;</span><br><span class=\"line\">    <span class=\"attribute\">add_header</span> X-XSS-Protection <span class=\"string\">&quot;1; mode=block&quot;</span> always;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>注意</strong>：如果使用 Python HTTP 服务器，无法直接配置安全响应头。建议：</p>\n<ul>\n<li>使用 Nginx 反向代理</li>\n<li>或使用 Flask&#x2F;FastAPI 编写简单的安全 Web 服务器</li>\n</ul>\n<p><strong>示例：使用 Flask 添加安全响应头</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&#x27;/&#x27;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">index</span>():</span><br><span class=\"line\">    response = app.make_response(<span class=\"string\">&#x27;Hello, World!&#x27;</span>)</span><br><span class=\"line\">    response.headers[<span class=\"string\">&#x27;X-Frame-Options&#x27;</span>] = <span class=\"string\">&#x27;SAMEORIGIN&#x27;</span></span><br><span class=\"line\">    response.headers[<span class=\"string\">&#x27;X-Content-Type-Options&#x27;</span>] = <span class=\"string\">&#x27;nosniff&#x27;</span></span><br><span class=\"line\">    response.headers[<span class=\"string\">&#x27;X-XSS-Protection&#x27;</span>] = <span class=\"string\">&#x27;1; mode=block&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> response</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    app.run(host=<span class=\"string\">&#x27;0.0.0.0&#x27;</span>, port=<span class=\"number\">8080</span>)</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><strong>重启服务</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Nginx</span></span><br><span class=\"line\">sudo systemctl restart nginx</span><br><span class=\"line\">sudo systemctl status nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Flask（直接运行）</span></span><br><span class=\"line\">python secure_server.py</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li><strong>备份加固后配置</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Nginx</span></span><br><span class=\"line\">sudo <span class=\"built_in\">cp</span> /etc/nginx/nginx.conf /etc/nginx/nginx.conf.hardened_$(<span class=\"built_in\">date</span> +%Y%m%d_%H%M%S)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-3（必做）：加固后复验扫描\"><a href=\"#任务-3（必做）：加固后复验扫描\" class=\"headerlink\" title=\"任务 3（必做）：加固后复验扫描\"></a>任务 3（必做）：加固后复验扫描</h3><p><strong>目标</strong>：执行加固后的基线检查，验证加固效果。</p>\n<p><strong>步骤</strong>：</p>\n<ol>\n<li><strong>执行复验扫描</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">python main.py --config config/targets.json --output results/after</span><br></pre></td></tr></table></figure>\n\n<p><strong>预期输出</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">加载了 1 个扫描目标</span><br><span class=\"line\"></span><br><span class=\"line\">============================================================</span><br><span class=\"line\">扫描目标: 本机测试 (web)</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">  ✅ [版本信息泄露] 未发现版本信息泄露</span><br><span class=\"line\">  ✅ [安全响应头检查] 所有安全响应头已配置</span><br><span class=\"line\"></span><br><span class=\"line\">============================================================</span><br><span class=\"line\">报告生成完成！</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">✅ CSV 报告: results/after/baseline_report_20260120_103000.csv</span><br><span class=\"line\">✅ JSON 报告: results/after/baseline_report_20260120_103000.json</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><strong>记录复验数据</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 复制报告到复验目录</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> retest</span><br><span class=\"line\"><span class=\"built_in\">cp</span> results/after/baseline_report_*.json retest/</span><br><span class=\"line\"><span class=\"built_in\">cp</span> results/after/baseline_report_*.csv retest/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 记录服务状态</span></span><br><span class=\"line\">systemctl status nginx &gt; retest/nginx_status_after.txt</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-4（必做）：对比加固效果\"><a href=\"#任务-4（必做）：对比加固效果\" class=\"headerlink\" title=\"任务 4（必做）：对比加固效果\"></a>任务 4（必做）：对比加固效果</h3><p><strong>目标</strong>：对比加固前后的扫描结果，分析加固效果。</p>\n<p><strong>步骤</strong>：</p>\n<ol>\n<li><strong>使用对比脚本</strong></li>\n</ol>\n<p>将对比脚本保存为 <code>compare_reports.py</code>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python3</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">from</span> pathlib <span class=\"keyword\">import</span> Path</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">compare_reports</span>(<span class=\"params\">before_file: <span class=\"built_in\">str</span>, after_file: <span class=\"built_in\">str</span></span>):</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(before_file, <span class=\"string\">&quot;r&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        before_data = json.load(f)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(after_file, <span class=\"string\">&quot;r&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        after_data = json.load(f)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;=&quot;</span> * <span class=\"number\">60</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;加固效果对比报告&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;=&quot;</span> * <span class=\"number\">60</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;加固前: <span class=\"subst\">&#123;before_data[<span class=\"string\">&#x27;report_time&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;加固后: <span class=\"subst\">&#123;after_data[<span class=\"string\">&#x27;report_time&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;=&quot;</span> * <span class=\"number\">60</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    before_checks = before_data[<span class=\"string\">&quot;targets&quot;</span>][<span class=\"number\">0</span>][<span class=\"string\">&quot;checks&quot;</span>]</span><br><span class=\"line\">    after_checks = after_data[<span class=\"string\">&quot;targets&quot;</span>][<span class=\"number\">0</span>][<span class=\"string\">&quot;checks&quot;</span>]</span><br><span class=\"line\">    </span><br><span class=\"line\">    before_map = &#123;c[<span class=\"string\">&quot;name&quot;</span>]: c <span class=\"keyword\">for</span> c <span class=\"keyword\">in</span> before_checks&#125;</span><br><span class=\"line\">    after_map = &#123;c[<span class=\"string\">&quot;name&quot;</span>]: c <span class=\"keyword\">for</span> c <span class=\"keyword\">in</span> after_checks&#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    fixed = []</span><br><span class=\"line\">    still_failed = []</span><br><span class=\"line\">    new_failed = []</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">for</span> check_name <span class=\"keyword\">in</span> before_map:</span><br><span class=\"line\">        before = before_map[check_name]</span><br><span class=\"line\">        after = after_map.get(check_name)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> after:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> before[<span class=\"string\">&quot;status&quot;</span>] == <span class=\"string\">&quot;failed&quot;</span> <span class=\"keyword\">and</span> after[<span class=\"string\">&quot;status&quot;</span>] == <span class=\"string\">&quot;passed&quot;</span>:</span><br><span class=\"line\">                fixed.append(check_name)</span><br><span class=\"line\">            <span class=\"keyword\">elif</span> before[<span class=\"string\">&quot;status&quot;</span>] == <span class=\"string\">&quot;failed&quot;</span> <span class=\"keyword\">and</span> after[<span class=\"string\">&quot;status&quot;</span>] == <span class=\"string\">&quot;failed&quot;</span>:</span><br><span class=\"line\">                still_failed.append(check_name)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">for</span> check_name <span class=\"keyword\">in</span> after_map:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> check_name <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> before_map <span class=\"keyword\">and</span> after_map[check_name][<span class=\"string\">&quot;status&quot;</span>] == <span class=\"string\">&quot;failed&quot;</span>:</span><br><span class=\"line\">            new_failed.append(check_name)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;\\n✅ 已修复 (<span class=\"subst\">&#123;<span class=\"built_in\">len</span>(fixed)&#125;</span> 个)&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> fixed:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;  + <span class=\"subst\">&#123;item&#125;</span>&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;\\n❌ 仍然失败 (<span class=\"subst\">&#123;<span class=\"built_in\">len</span>(still_failed)&#125;</span> 个)&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> still_failed:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;  - <span class=\"subst\">&#123;item&#125;</span>&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;\\n⚠️  新发现问题 (<span class=\"subst\">&#123;<span class=\"built_in\">len</span>(new_failed)&#125;</span> 个)&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> new_failed:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;  ! <span class=\"subst\">&#123;item&#125;</span>&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 计算通过率</span></span><br><span class=\"line\">    before_passed = <span class=\"built_in\">sum</span>(<span class=\"number\">1</span> <span class=\"keyword\">for</span> c <span class=\"keyword\">in</span> before_checks <span class=\"keyword\">if</span> c[<span class=\"string\">&quot;status&quot;</span>] == <span class=\"string\">&quot;passed&quot;</span>)</span><br><span class=\"line\">    after_passed = <span class=\"built_in\">sum</span>(<span class=\"number\">1</span> <span class=\"keyword\">for</span> c <span class=\"keyword\">in</span> after_checks <span class=\"keyword\">if</span> c[<span class=\"string\">&quot;status&quot;</span>] == <span class=\"string\">&quot;passed&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    before_rate = before_passed / <span class=\"built_in\">len</span>(before_checks) * <span class=\"number\">100</span> <span class=\"keyword\">if</span> before_checks <span class=\"keyword\">else</span> <span class=\"number\">0</span></span><br><span class=\"line\">    after_rate = after_passed / <span class=\"built_in\">len</span>(after_checks) * <span class=\"number\">100</span> <span class=\"keyword\">if</span> after_checks <span class=\"keyword\">else</span> <span class=\"number\">0</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;\\n<span class=\"subst\">&#123;<span class=\"string\">&#x27;=&#x27;</span> * <span class=\"number\">60</span>&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;通过率提升: <span class=\"subst\">&#123;before_rate:<span class=\"number\">.1</span>f&#125;</span>% → <span class=\"subst\">&#123;after_rate:<span class=\"number\">.1</span>f&#125;</span>% (+<span class=\"subst\">&#123;after_rate - before_rate:<span class=\"number\">.1</span>f&#125;</span>%)&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;<span class=\"subst\">&#123;<span class=\"string\">&#x27;=&#x27;</span> * <span class=\"number\">60</span>&#125;</span>&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(sys.argv) != <span class=\"number\">3</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;用法: python compare_reports.py &lt;before.json&gt; &lt;after.json&gt;&quot;</span>)</span><br><span class=\"line\">        sys.exit(<span class=\"number\">1</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    compare_reports(sys.argv[<span class=\"number\">1</span>], sys.argv[<span class=\"number\">2</span>])</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><strong>运行对比</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">python compare_reports.py \\</span><br><span class=\"line\">    baseline/baseline_report_20260120_100000.json \\</span><br><span class=\"line\">    retest/baseline_report_20260120_103000.json</span><br></pre></td></tr></table></figure>\n\n<p><strong>预期输出</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">============================================================</span><br><span class=\"line\">加固效果对比报告</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">加固前: 2026-01-20T10:00:00</span><br><span class=\"line\">加固后: 2026-01-20T10:30:00</span><br><span class=\"line\">============================================================</span><br><span class=\"line\"></span><br><span class=\"line\">✅ 已修复 (2 个)</span><br><span class=\"line\">  + 版本信息泄露</span><br><span class=\"line\">  + 安全响应头检查</span><br><span class=\"line\"></span><br><span class=\"line\">❌ 仍然失败 (0 个)</span><br><span class=\"line\"></span><br><span class=\"line\">⚠️  新发现问题 (0 个)</span><br><span class=\"line\"></span><br><span class=\"line\">============================================================</span><br><span class=\"line\">通过率提升: 33.3% → 100.0% (+66.7%)</span><br><span class=\"line\">============================================================</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-5（必做）：业务回归测试\"><a href=\"#任务-5（必做）：业务回归测试\" class=\"headerlink\" title=\"任务 5（必做）：业务回归测试\"></a>任务 5（必做）：业务回归测试</h3><p><strong>目标</strong>：验证加固措施是否影响业务功能。</p>\n<p><strong>步骤</strong>：</p>\n<ol>\n<li><strong>功能测试</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 测试首页访问</span></span><br><span class=\"line\">curl -I http://localhost:8080/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 测试静态资源</span></span><br><span class=\"line\">curl -I http://localhost:8080/style.css</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 测试 API 端点（如果有）</span></span><br><span class=\"line\">curl http://localhost:8080/api/status</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><strong>浏览器测试</strong></li>\n</ol>\n<ul>\n<li>打开浏览器访问 <code>http://localhost:8080</code></li>\n<li>检查页面是否正常加载</li>\n<li>使用开发者工具检查响应头</li>\n</ul>\n<ol start=\"3\">\n<li><strong>检查日志</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看访问日志</span></span><br><span class=\"line\"><span class=\"built_in\">tail</span> -f /var/log/nginx/access.log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看错误日志</span></span><br><span class=\"line\"><span class=\"built_in\">tail</span> -f /var/log/nginx/error.log</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-6（必做）：撰写变更记录\"><a href=\"#任务-6（必做）：撰写变更记录\" class=\"headerlink\" title=\"任务 6（必做）：撰写变更记录\"></a>任务 6（必做）：撰写变更记录</h3><p><strong>目标</strong>：根据实际执行情况，撰写完整的变更记录。</p>\n<p><strong>步骤</strong>：</p>\n<p>创建变更记录文件 <code>change_record_CR-2026-001.md</code>：</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\"># 安全配置变更记录</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 基本信息</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 项目 | 内容 |</span><br><span class=\"line\">|------|------|</span><br><span class=\"line\">| 变更编号 | CR-2026-001 |</span><br><span class=\"line\">| 变更标题 | Web 服务器安全加固 |</span><br><span class=\"line\">| 申请人 | [你的姓名] |</span><br><span class=\"line\">| 申请日期 | 2026-01-20 |</span><br><span class=\"line\">| 执行日期 | 2026-01-20 |</span><br><span class=\"line\">| 优先级 | 高 |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 变更内容</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 序号 | 变更项 | 风险等级 |</span><br><span class=\"line\">|------|--------|---------|</span><br><span class=\"line\">| 1 | 隐藏版本信息 | 低 |</span><br><span class=\"line\">| 2 | 添加 X-Frame-Options 响应头 | 中 |</span><br><span class=\"line\">| 3 | 添加 X-Content-Type-Options 响应头 | 中 |</span><br><span class=\"line\">| 4 | 添加 X-XSS-Protection 响应头 | 低 |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 回滚方案</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 备份文件</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"code\">`/etc/nginx/nginx.conf.backup_20260120_100000`</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 回滚步骤</span></span><br><span class=\"line\"><span class=\"bullet\">1.</span> 恢复配置文件</span><br><span class=\"line\"><span class=\"bullet\">2.</span> 测试配置语法</span><br><span class=\"line\"><span class=\"bullet\">3.</span> 重启服务</span><br><span class=\"line\"><span class=\"bullet\">4.</span> 验证服务状态</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 复验结果</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 检查项 | 加固前 | 加固后 | 状态 |</span><br><span class=\"line\">|--------|-------|-------|------|</span><br><span class=\"line\">| 版本信息泄露 | ❌ 失败 | ✅ 通过 | 已修复 |</span><br><span class=\"line\">| 安全响应头检查 | ❌ 失败 | ✅ 通过 | 已修复 |</span><br><span class=\"line\"></span><br><span class=\"line\">通过率提升: 33.3% → 100.0%</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 业务回归测试</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 测试项 | 结果 |</span><br><span class=\"line\">|--------|------|</span><br><span class=\"line\">| 首页访问 | ✅ 正常 |</span><br><span class=\"line\">| 响应头检查 | ✅ 正常 |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 总结</span></span><br><span class=\"line\"></span><br><span class=\"line\">本次变更成功完成，加固措施全部生效，业务功能正常。</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-7（进阶）：配置文件差异分析\"><a href=\"#任务-7（进阶）：配置文件差异分析\" class=\"headerlink\" title=\"任务 7（进阶）：配置文件差异分析\"></a>任务 7（进阶）：配置文件差异分析</h3><p><strong>目标</strong>：使用专业工具分析配置文件的变化。</p>\n<p><strong>步骤</strong>：</p>\n<ol>\n<li><strong>使用 <code>git diff</code> 对比</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 如果配置文件在 Git 仓库中</span></span><br><span class=\"line\">git diff /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><strong>使用 <code>vimdiff</code> 可视化对比</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">vimdiff /etc/nginx/nginx.conf.backup /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><strong>生成变更报告</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">diff -u /etc/nginx/nginx.conf.backup /etc/nginx/nginx.conf &gt; config_change.diff</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"巩固练习（题与复盘）\"><a href=\"#巩固练习（题与复盘）\" class=\"headerlink\" title=\"巩固练习（题与复盘）\"></a>巩固练习（题与复盘）</h2><hr>\n<h3 id=\"练习-1：如何处理加固引发的兼容问题？\"><a href=\"#练习-1：如何处理加固引发的兼容问题？\" class=\"headerlink\" title=\"练习 1：如何处理加固引发的兼容问题？\"></a>练习 1：如何处理加固引发的兼容问题？</h3><p><strong>思路提示</strong>：</p>\n<ul>\n<li>问题定位（日志、错误信息）</li>\n<li>影响范围评估（哪些用户&#x2F;功能受影响）</li>\n<li>解决方案选择（降级、配置调整、绕过）</li>\n<li>回滚决策（是否立即回滚）</li>\n</ul>\n<hr>\n<h3 id=\"练习-2：撰写变更记录示例\"><a href=\"#练习-2：撰写变更记录示例\" class=\"headerlink\" title=\"练习 2：撰写变更记录示例\"></a>练习 2：撰写变更记录示例</h3><p><strong>任务</strong>：为以下场景撰写变更记录。</p>\n<p><strong>场景</strong>：数据库服务器加固，修改 MySQL 配置：</p>\n<ul>\n<li>禁用符号链接</li>\n<li>限制最大连接数</li>\n<li>启用查询日志</li>\n</ul>\n<p><strong>要求</strong>：包含变更内容、回滚方案、复验结果。</p>\n<hr>\n<h3 id=\"练习-3：设计变更审批流程\"><a href=\"#练习-3：设计变更审批流程\" class=\"headerlink\" title=\"练习 3：设计变更审批流程\"></a>练习 3：设计变更审批流程</h3><p><strong>任务</strong>：为你的团队设计一个变更审批流程。</p>\n<p><strong>要求</strong>：</p>\n<ul>\n<li>定义变更类型（标准、重大、紧急）</li>\n<li>明确各类型的审批路径</li>\n<li>定义回滚触发条件</li>\n</ul>\n<p><strong>思路提示</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">变更类型 → 风险等级 → 审批流程</span><br><span class=\"line\">标准变更 → 低 → 技术主管审批</span><br><span class=\"line\">重大变更 → 中 → 技术 + 安全 + 业务审批</span><br><span class=\"line\">紧急变更 → 高 → 紧急审批 + 事后报告</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"练习-4：回滚演练\"><a href=\"#练习-4：回滚演练\" class=\"headerlink\" title=\"练习 4：回滚演练\"></a>练习 4：回滚演练</h3><p><strong>任务</strong>：在测试环境中演练回滚流程。</p>\n<p><strong>步骤</strong>：</p>\n<ol>\n<li>应用加固配置</li>\n<li>模拟加固失败（如修改端口为无效值）</li>\n<li>执行回滚操作</li>\n<li>验证回滚是否成功</li>\n</ol>\n<hr>\n<h2 id=\"评估标准（达成判定）\"><a href=\"#评估标准（达成判定）\" class=\"headerlink\" title=\"评估标准（达成判定）\"></a>评估标准（达成判定）</h2><ul>\n<li>✅ 完成了加固前基线扫描</li>\n<li>✅ 执行了安全加固配置</li>\n<li>✅ 完成了加固后复验扫描</li>\n<li>✅ 生成了加固效果对比报告</li>\n<li>✅ 完成了业务回归测试</li>\n<li>✅ 撰写了完整的变更记录</li>\n<li>✅ 明确了回滚方案</li>\n</ul>\n<hr>\n<h2 id=\"学习成果达成情况（由学习者填写）\"><a href=\"#学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"学习成果达成情况（由学习者填写）\"></a>学习成果达成情况（由学习者填写）</h2><hr>\n<h3 id=\"截图与证据\"><a href=\"#截图与证据\" class=\"headerlink\" title=\"截图与证据\"></a>截图与证据</h3><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 加固前基线扫描输出截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 加固后复验扫描输出截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 配置文件对比（diff 输出）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 加固效果对比报告输出</li>\n<li><input disabled=\"\" type=\"checkbox\"> 业务回归测试截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 变更记录文档（Markdown 文件）</li>\n</ul>\n<hr>\n<h3 id=\"关键命令与输出（粘贴关键片段）\"><a href=\"#关键命令与输出（粘贴关键片段）\" class=\"headerlink\" title=\"关键命令与输出（粘贴关键片段）\"></a>关键命令与输出（粘贴关键片段）</h3><p><strong>加固前扫描</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ python main.py --config config/targets.json --output results/before</span><br><span class=\"line\">加载了 1 个扫描目标</span><br><span class=\"line\"></span><br><span class=\"line\">============================================================</span><br><span class=\"line\">扫描目标: 本机测试 (web)</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">  ❌ [版本信息泄露] 发现版本信息泄露</span><br><span class=\"line\">  ❌ [安全响应头检查] 缺少 3 个安全响应头</span><br><span class=\"line\"></span><br><span class=\"line\">============================================================</span><br><span class=\"line\">报告生成完成！</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">✅ CSV 报告: results/before/baseline_report_20260120_100000.csv</span><br><span class=\"line\">✅ JSON 报告: results/before/baseline_report_20260120_100000.json</span><br></pre></td></tr></table></figure>\n\n<p><strong>配置文件对比</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ diff nginx.conf.backup nginx.conf</span><br><span class=\"line\">12c12,15</span><br><span class=\"line\">&lt;     include       /etc/nginx/mime.types;</span><br><span class=\"line\">---</span><br><span class=\"line\">&gt;     include       /etc/nginx/mime.types;</span><br><span class=\"line\">&gt;     server_tokens off;</span><br><span class=\"line\">&gt;     add_header X-Frame-Options <span class=\"string\">&quot;SAMEORIGIN&quot;</span> always;</span><br><span class=\"line\">&gt;     add_header X-Content-Type-Options <span class=\"string\">&quot;nosniff&quot;</span> always;</span><br></pre></td></tr></table></figure>\n\n<p><strong>加固后扫描</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ python main.py --config config/targets.json --output results/after</span><br><span class=\"line\">加载了 1 个扫描目标</span><br><span class=\"line\"></span><br><span class=\"line\">============================================================</span><br><span class=\"line\">扫描目标: 本机测试 (web)</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">  ✅ [版本信息泄露] 未发现版本信息泄露</span><br><span class=\"line\">  ✅ [安全响应头检查] 所有安全响应头已配置</span><br><span class=\"line\"></span><br><span class=\"line\">============================================================</span><br><span class=\"line\">报告生成完成！</span><br><span class=\"line\">============================================================</span><br></pre></td></tr></table></figure>\n\n<p><strong>加固效果对比</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ python compare_reports.py \\</span><br><span class=\"line\">    baseline/baseline_report_20260120_100000.json \\</span><br><span class=\"line\">    retest/baseline_report_20260120_103000.json</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">加固效果对比报告</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">加固前: 2026-01-20T10:00:00</span><br><span class=\"line\">加固后: 2026-01-20T10:30:00</span><br><span class=\"line\">============================================================</span><br><span class=\"line\"></span><br><span class=\"line\">✅ 已修复 (2 个)</span><br><span class=\"line\">  + 版本信息泄露</span><br><span class=\"line\">  + 安全响应头检查</span><br><span class=\"line\"></span><br><span class=\"line\">❌ 仍然失败 (0 个)</span><br><span class=\"line\"></span><br><span class=\"line\">⚠️  新发现问题 (0 个)</span><br><span class=\"line\"></span><br><span class=\"line\">============================================================</span><br><span class=\"line\">通过率提升: 33.3% → 100.0% (+66.7%)</span><br><span class=\"line\">============================================================</span><br></pre></td></tr></table></figure>\n\n<p><strong>回归测试</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ curl -I http://localhost:8080/</span><br><span class=\"line\">HTTP/1.1 200 OK</span><br><span class=\"line\">Server: nginx</span><br><span class=\"line\">Date: Mon, 20 Jan 2026 10:35:00 GMT</span><br><span class=\"line\">Content-Type: text/html</span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\">X-Content-Type-Options: nosniff</span><br><span class=\"line\">X-XSS-Protection: 1; mode=block</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"结论与反思\"><a href=\"#结论与反思\" class=\"headerlink\" title=\"结论与反思\"></a>结论与反思</h3><p><strong>我今天搞清楚了</strong>：</p>\n<ul>\n<li>加固复验是确认安全措施是否生效的关键步骤</li>\n<li>变更记录对于审计、回溯和合规非常重要</li>\n<li>必须有明确的回滚方案，以应对加固失败的风险</li>\n<li>业务回归测试可以检测加固措施是否影响正常功能</li>\n</ul>\n<p><strong>我差点搞混的是</strong>：</p>\n<ul>\n<li>最初不理解”复验”和”回归测试”的区别</li>\n<li>以为加固后只要扫描通过就行了，忽略了业务功能测试</li>\n<li>不清楚变更记录应该包含哪些内容</li>\n</ul>\n<p><strong>明天我要继续补的是</strong>：</p>\n<ul>\n<li>学习 WAF（Web 应用防火墙）的原理与配置（Day028）</li>\n<li>了解常见 Web 漏洞（SQL 注入、XSS、CSRF）的检测与防护（Day029-031）</li>\n<li>学习安全加固的持续性监控（Day032）</li>\n</ul>\n<p><strong>本次学习耗时</strong>：约 3 小时</p>\n<p><strong>掌握程度自评</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 😕 理解了基本概念，但实践不熟练</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🙂 完成了加固前后扫描</li>\n<li><input disabled=\"\" type=\"checkbox\"> 😃 完成了所有任务并理解复验流程</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🤩 额外设计了自动化回滚脚本</li>\n</ul>\n<hr>\n<h2 id=\"集中参考答案（含思路）\"><a href=\"#集中参考答案（含思路）\" class=\"headerlink\" title=\"集中参考答案（含思路）\"></a>集中参考答案（含思路）</h2><hr>\n<h3 id=\"练习-1-参考答案：如何处理加固引发的兼容问题？\"><a href=\"#练习-1-参考答案：如何处理加固引发的兼容问题？\" class=\"headerlink\" title=\"练习 1 参考答案：如何处理加固引发的兼容问题？\"></a>练习 1 参考答案：如何处理加固引发的兼容问题？</h3><p><strong>问题定位</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. 检查错误日志</span></span><br><span class=\"line\"><span class=\"built_in\">tail</span> -100 /var/log/nginx/error.log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. 检查服务状态</span></span><br><span class=\"line\">systemctl status nginx -l</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. 检查端口监听</span></span><br><span class=\"line\">ss -tlnp | grep :80</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4. 测试服务响应</span></span><br><span class=\"line\">curl -v http://localhost/</span><br></pre></td></tr></table></figure>\n\n<p><strong>影响范围评估</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>问题类型</th>\n<th>影响范围</th>\n<th>评估方法</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>服务无法启动</td>\n<td>所有用户</td>\n<td>systemctl status、curl 测试</td>\n</tr>\n<tr>\n<td>部分页面加载失败</td>\n<td>特定功能</td>\n<td>浏览器测试、监控日志</td>\n</tr>\n<tr>\n<td>性能下降</td>\n<td>所有用户</td>\n<td>性能测试、响应时间监控</td>\n</tr>\n<tr>\n<td>某些浏览器无法访问</td>\n<td>特定用户</td>\n<td>兼容性测试（Chrome&#x2F;Firefox&#x2F;Safari）</td>\n</tr>\n</tbody></table>\n<p><strong>解决方案选择</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">问题严重程度 → 解决策略</span><br><span class=\"line\">├─ 服务中断 → 立即回滚</span><br><span class=\"line\">├─ 部分功能失效 → 评估回滚 vs 临时绕过</span><br><span class=\"line\">├─ 性能下降 → 监控观察，必要时回滚</span><br><span class=\"line\">└─ 兼容性问题 → 配置降级或兼容模式</span><br></pre></td></tr></table></figure>\n\n<p><strong>示例：CSP 引起的兼容性问题</strong></p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 问题：某些旧浏览器不支持 CSP，导致资源加载失败</span></span><br><span class=\"line\"><span class=\"attribute\">add_header</span> Content-Security-Policy <span class=\"string\">&quot;default-src &#x27;self&#x27;; script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 解决方案 1：使用 Report-Only 模式测试</span></span><br><span class=\"line\"><span class=\"attribute\">add_header</span> Content-Security-Policy-Report-Only <span class=\"string\">&quot;default-src &#x27;self&#x27;; script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 解决方案 2：为旧浏览器降级</span></span><br><span class=\"line\"><span class=\"attribute\">map</span> <span class=\"variable\">$http_user_agent</span> <span class=\"variable\">$csp_policy</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">default</span> <span class=\"string\">&quot;default-src &#x27;self&#x27;;&quot;</span>;</span><br><span class=\"line\">    &quot;~*<span class=\"attribute\">MSIE</span> [<span class=\"number\">6</span>-<span class=\"number\">9</span>]<span class=\"string\">&quot; &quot;</span><span class=\"string\">&quot;;</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">add_header Content-Security-Policy <span class=\"variable\">$csp_policy</span> always;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>回滚决策矩阵</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>场景</th>\n<th>立即回滚</th>\n<th>观察后回滚</th>\n<th>不回滚</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>服务无法启动</td>\n<td>✅</td>\n<td>-</td>\n<td>-</td>\n</tr>\n<tr>\n<td>核心业务功能失效</td>\n<td>✅</td>\n<td>-</td>\n<td>-</td>\n</tr>\n<tr>\n<td>次要功能失效</td>\n<td>-</td>\n<td>✅</td>\n<td>-</td>\n</tr>\n<tr>\n<td>性能下降 &gt; 50%</td>\n<td>✅</td>\n<td>-</td>\n<td>-</td>\n</tr>\n<tr>\n<td>性能下降 &lt; 30%</td>\n<td>-</td>\n<td>✅</td>\n<td>-</td>\n</tr>\n<tr>\n<td>少数用户报告问题</td>\n<td>-</td>\n<td>-</td>\n<td>✅</td>\n</tr>\n</tbody></table>\n<p><strong>回滚步骤标准流程</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. 通知相关人员</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;执行紧急回滚：CR-2026-001&quot;</span> | sendmail admin@example.com</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. 停止服务</span></span><br><span class=\"line\">sudo systemctl stop nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. 恢复备份配置</span></span><br><span class=\"line\">sudo <span class=\"built_in\">cp</span> /etc/nginx/nginx.conf.backup_20260120 /etc/nginx/nginx.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4. 测试配置</span></span><br><span class=\"line\">sudo nginx -t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5. 启动服务</span></span><br><span class=\"line\">sudo systemctl start nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 6. 验证服务状态</span></span><br><span class=\"line\">sudo systemctl status nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 7. 验证功能</span></span><br><span class=\"line\">curl -I http://localhost/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 8. 记录回滚操作</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"subst\">$(date)</span>: 回滚 CR-2026-001&quot;</span> &gt;&gt; /var/log/change_management.log</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"练习-2-参考答案：撰写变更记录示例\"><a href=\"#练习-2-参考答案：撰写变更记录示例\" class=\"headerlink\" title=\"练习 2 参考答案：撰写变更记录示例\"></a>练习 2 参考答案：撰写变更记录示例</h3><p><strong>变更记录模板（数据库服务器加固）</strong>：</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\"># 安全配置变更记录 - 数据库服务器</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 基本信息</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 项目 | 内容 |</span><br><span class=\"line\">|------|------|</span><br><span class=\"line\">| 变更编号 | CR-2026-002 |</span><br><span class=\"line\">| 变更标题 | MySQL 服务器安全加固 |</span><br><span class=\"line\">| 申请人 | [你的姓名] |</span><br><span class=\"line\">| 部门 | 信息安全部 |</span><br><span class=\"line\">| 申请日期 | 2026-01-20 |</span><br><span class=\"line\">| 预计执行日期 | 2026-01-21 02:00-04:00 |</span><br><span class=\"line\">| 优先级 | 高 |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 影响范围</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 项目 | 内容 |</span><br><span class=\"line\">|------|------|</span><br><span class=\"line\">| 影响系统 | 数据库服务器 (192.168.1.50) |</span><br><span class=\"line\">| 影响服务 | MySQL 数据库服务 (端口 3306) |</span><br><span class=\"line\">| 影响用户 | 所有应用系统 |</span><br><span class=\"line\">| 影响时段 | 维护窗口（凌晨 2:00-4:00） |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 变更内容</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 变更前配置</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"code\">```ini</span></span><br><span class=\"line\"><span class=\"code\"># /etc/mysql/my.cnf</span></span><br><span class=\"line\"><span class=\"code\">[mysqld]</span></span><br><span class=\"line\"><span class=\"code\">bind-address = 0.0.0.0</span></span><br><span class=\"line\"><span class=\"code\">max_connections = 151</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"变更后配置-1\"><a href=\"#变更后配置-1\" class=\"headerlink\" title=\"变更后配置\"></a>变更后配置</h3><figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># /etc/mysql/my.cnf</span></span><br><span class=\"line\"><span class=\"section\">[mysqld]</span></span><br><span class=\"line\"><span class=\"attr\">bind-address</span> = <span class=\"number\">127.0</span>.<span class=\"number\">0.1</span></span><br><span class=\"line\"><span class=\"attr\">max_connections</span> = <span class=\"number\">200</span></span><br><span class=\"line\"><span class=\"attr\">symbolic-links</span> = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"attr\">general_log</span> = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">general_log_file</span> = /var/log/mysql/general.log</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"变更项列表-1\"><a href=\"#变更项列表-1\" class=\"headerlink\" title=\"变更项列表\"></a>变更项列表</h3><table>\n<thead>\n<tr>\n<th>序号</th>\n<th>变更项</th>\n<th>配置文件</th>\n<th>风险等级</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>禁用符号链接</td>\n<td>&#x2F;etc&#x2F;mysql&#x2F;my.cnf</td>\n<td>中</td>\n<td>防止符号链接攻击</td>\n</tr>\n<tr>\n<td>2</td>\n<td>限制监听地址</td>\n<td>&#x2F;etc&#x2F;mysql&#x2F;my.cnf</td>\n<td>高</td>\n<td>仅允许本地连接</td>\n</tr>\n<tr>\n<td>3</td>\n<td>调整最大连接数</td>\n<td>&#x2F;etc&#x2F;mysql&#x2F;my.cnf</td>\n<td>低</td>\n<td>提高连接上限</td>\n</tr>\n<tr>\n<td>4</td>\n<td>启用查询日志</td>\n<td>&#x2F;etc&#x2F;mysql&#x2F;my.cnf</td>\n<td>中</td>\n<td>便于审计</td>\n</tr>\n</tbody></table>\n<h2 id=\"回滚方案-1\"><a href=\"#回滚方案-1\" class=\"headerlink\" title=\"回滚方案\"></a>回滚方案</h2><h3 id=\"备份文件\"><a href=\"#备份文件\" class=\"headerlink\" title=\"备份文件\"></a>备份文件</h3><ul>\n<li><code>/etc/mysql/my.cnf.backup_20260121</code></li>\n</ul>\n<h3 id=\"回滚步骤-1\"><a href=\"#回滚步骤-1\" class=\"headerlink\" title=\"回滚步骤\"></a>回滚步骤</h3><ol>\n<li><p>停止 MySQL 服务：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo systemctl stop mysql</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>恢复配置文件：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo <span class=\"built_in\">cp</span> /etc/mysql/my.cnf.backup_20260121 /etc/mysql/my.cnf</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>启动 MySQL 服务：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo systemctl start mysql</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>验证服务状态：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo systemctl status mysql</span><br><span class=\"line\">mysql -u root -p -e <span class=\"string\">&quot;SHOW VARIABLES LIKE &#x27;max_connections&#x27;;&quot;</span></span><br></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"回滚触发条件-1\"><a href=\"#回滚触发条件-1\" class=\"headerlink\" title=\"回滚触发条件\"></a>回滚触发条件</h3><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 应用无法连接数据库</li>\n<li><input disabled=\"\" type=\"checkbox\"> 查询性能明显下降（超过 50%）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 日志磁盘空间不足</li>\n<li><input disabled=\"\" type=\"checkbox\"> 连接数异常增加</li>\n</ul>\n<h2 id=\"复验结果-1\"><a href=\"#复验结果-1\" class=\"headerlink\" title=\"复验结果\"></a>复验结果</h2><h3 id=\"加固前基线扫描\"><a href=\"#加固前基线扫描\" class=\"headerlink\" title=\"加固前基线扫描\"></a>加固前基线扫描</h3><table>\n<thead>\n<tr>\n<th>检查项</th>\n<th>状态</th>\n<th>风险等级</th>\n<th>消息</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>监听地址</td>\n<td>❌ 失败</td>\n<td>高</td>\n<td>对 0.0.0.0 监听</td>\n</tr>\n<tr>\n<td>符号链接</td>\n<td>❌ 失败</td>\n<td>中</td>\n<td>符号链接已启用</td>\n</tr>\n<tr>\n<td>最大连接数</td>\n<td>⚠️ 警告</td>\n<td>低</td>\n<td>连接数偏小</td>\n</tr>\n</tbody></table>\n<p>通过率: 0% (0&#x2F;3)</p>\n<h3 id=\"加固后复验扫描\"><a href=\"#加固后复验扫描\" class=\"headerlink\" title=\"加固后复验扫描\"></a>加固后复验扫描</h3><table>\n<thead>\n<tr>\n<th>检查项</th>\n<th>状态</th>\n<th>风险等级</th>\n<th>消息</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>监听地址</td>\n<td>✅ 通过</td>\n<td>-</td>\n<td>仅监听 127.0.0.1</td>\n</tr>\n<tr>\n<td>符号链接</td>\n<td>✅ 通过</td>\n<td>-</td>\n<td>符号链接已禁用</td>\n</tr>\n<tr>\n<td>最大连接数</td>\n<td>✅ 通过</td>\n<td>-</td>\n<td>连接数已调整</td>\n</tr>\n</tbody></table>\n<p>通过率: 100% (3&#x2F;3)</p>\n<h3 id=\"对比结论-1\"><a href=\"#对比结论-1\" class=\"headerlink\" title=\"对比结论\"></a>对比结论</h3><ul>\n<li>✅ 已修复：监听地址、符号链接、最大连接数</li>\n<li>✅ 无新增问题</li>\n<li>✅ 通过率从 0% 提升到 100%</li>\n</ul>\n<h2 id=\"业务回归测试-1\"><a href=\"#业务回归测试-1\" class=\"headerlink\" title=\"业务回归测试\"></a>业务回归测试</h2><table>\n<thead>\n<tr>\n<th>测试项</th>\n<th>测试结果</th>\n<th>备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>应用连接数据库</td>\n<td>✅ 正常</td>\n<td>连接成功</td>\n</tr>\n<tr>\n<td>基础查询</td>\n<td>✅ 正常</td>\n<td>响应时间 &lt; 100ms</td>\n</tr>\n<tr>\n<td>并发连接测试</td>\n<td>✅ 正常</td>\n<td>200 连接无异常</td>\n</tr>\n<tr>\n<td>事务提交</td>\n<td>✅ 正常</td>\n<td>-</td>\n</tr>\n</tbody></table>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>本次变更成功完成，加固措施全部生效，业务功能正常，无副作用。</p>\n<p><strong>后续计划</strong>：</p>\n<ul>\n<li>1 周：监控数据库性能和日志</li>\n<li>1 个月：定期检查日志磁盘空间</li>\n<li>3 个月：评估是否需要进一步加固<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\"></span><br><span class=\"line\">### 练习 3 参考答案：设计变更审批流程</span><br><span class=\"line\"></span><br><span class=\"line\">**变更审批流程设计**：</span><br><span class=\"line\"></span><br><span class=\"line\">```mermaid</span><br><span class=\"line\">graph TD</span><br><span class=\"line\">    A[变更请求] --&gt; B&#123;变更类型&#125;</span><br><span class=\"line\">    B --&gt;|标准变更| C[技术评审]</span><br><span class=\"line\">    B --&gt;|重大变更| D[技术评审]</span><br><span class=\"line\">    B --&gt;|紧急变更| E[紧急审批]</span><br><span class=\"line\">    </span><br><span class=\"line\">    C --&gt; F[执行变更]</span><br><span class=\"line\">    D --&gt; G[安全评审]</span><br><span class=\"line\">    D --&gt; H[业务审批]</span><br><span class=\"line\">    G --&gt; F</span><br><span class=\"line\">    H --&gt; F</span><br><span class=\"line\">    E --&gt; F</span><br><span class=\"line\">    </span><br><span class=\"line\">    F --&gt; I&#123;测试结果&#125;</span><br><span class=\"line\">    I --&gt;|通过| J[确认变更]</span><br><span class=\"line\">    I --&gt;|失败| K[执行回滚]</span><br><span class=\"line\">    </span><br><span class=\"line\">    J --&gt; L[变更归档]</span><br><span class=\"line\">    K --&gt; M[事后分析]</span><br><span class=\"line\">    M --&gt; L</span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><strong>变更类型定义</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>风险等级</th>\n<th>影响范围</th>\n<th>审批流程</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>标准变更</strong></td>\n<td>低</td>\n<td>单个系统</td>\n<td>技术主管审批</td>\n<td>修改密码策略、添加单个防火墙规则</td>\n</tr>\n<tr>\n<td><strong>重大变更</strong></td>\n<td>中-高</td>\n<td>多个系统&#x2F;核心业务</td>\n<td>技术 + 安全 + 业务</td>\n<td>升级核心中间件、修改网络架构</td>\n</tr>\n<tr>\n<td><strong>紧急变更</strong></td>\n<td>高</td>\n<td>已发生安全事件&#x2F;严重故障</td>\n<td>紧急审批 + 事后报告</td>\n<td>修复被利用的 0-day 漏洞、恢复宕机服务</td>\n</tr>\n</tbody></table>\n<p><strong>审批权限矩阵</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>角色</th>\n<th>标准变更</th>\n<th>重大变更</th>\n<th>紧急变更</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>技术主管</td>\n<td>✅ 签批</td>\n<td>✅ 签批</td>\n<td>✅ 签批</td>\n</tr>\n<tr>\n<td>安全负责人</td>\n<td>-</td>\n<td>✅ 签批</td>\n<td>✅ 事后审核</td>\n</tr>\n<tr>\n<td>业务负责人</td>\n<td>-</td>\n<td>✅ 签批</td>\n<td>-</td>\n</tr>\n<tr>\n<td>CTO</td>\n<td>-</td>\n<td>✅ 最终批准</td>\n<td>✅ 紧急批准</td>\n</tr>\n</tbody></table>\n<p><strong>回滚触发条件清单</strong>：</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">## 回滚决策清单</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 立即回滚（无需审批）</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 服务无法启动</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 核心业务功能完全失效</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 数据丢失或损坏</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 安全事件被触发</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 观察后回滚（需评估）</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 次要功能失效</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 性能下降超过 50%</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 错误率显著增加</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 大量用户投诉</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 不回滚（需监控）</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 性能下降低于 30%</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 少数用户反馈问题</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 非核心功能异常</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"练习-4-参考答案：回滚演练\"><a href=\"#练习-4-参考答案：回滚演练\" class=\"headerlink\" title=\"练习 4 参考答案：回滚演练\"></a>练习 4 参考答案：回滚演练</h3><p><strong>回滚演练脚本</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># 回滚演练脚本</span></span><br><span class=\"line\"><span class=\"comment\"># 用途：在测试环境中演练回滚流程</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">set</span> -e  <span class=\"comment\"># 遇到错误立即退出</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;===================================&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;开始回滚演练&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;===================================&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 1. 应用&quot;破坏性&quot;配置（模拟加固失败）</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;[1/5] 应用破坏性配置...&quot;</span></span><br><span class=\"line\">sudo <span class=\"built_in\">cp</span> /etc/nginx/nginx.conf /etc/nginx/nginx.conf.before_rollback</span><br><span class=\"line\">sudo <span class=\"built_in\">tee</span> /etc/nginx/nginx.conf &gt; /dev/null &lt;&lt;<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\"># 模拟错误配置</span></span><br><span class=\"line\"><span class=\"string\">http &#123;</span></span><br><span class=\"line\"><span class=\"string\">    listen 999999;  # 无效端口号</span></span><br><span class=\"line\"><span class=\"string\">    server_tokens off;</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. 测试配置（应该失败）</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;[2/5] 测试配置（预期失败）...&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> sudo nginx -t 2&gt;&amp;1 | grep -q <span class=\"string\">&quot;invalid&quot;</span>; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;✅ 配置语法错误检测成功&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;❌ 配置语法错误检测失败&quot;</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. 尝试重启服务（应该失败）</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;[3/5] 尝试重启服务（预期失败）...&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> ! sudo systemctl restart nginx 2&gt;&amp;1; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;✅ 服务重启失败（符合预期）&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;❌ 服务重启成功（不符合预期）&quot;</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4. 执行回滚</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;[4/5] 执行回滚...&quot;</span></span><br><span class=\"line\">sudo <span class=\"built_in\">cp</span> /etc/nginx/nginx.conf.before_rollback /etc/nginx/nginx.conf</span><br><span class=\"line\">sudo nginx -t &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">&quot;✅ 配置语法检查通过&quot;</span></span><br><span class=\"line\">sudo systemctl restart nginx &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">&quot;✅ 服务重启成功&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5. 验证服务状态</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;[5/5] 验证服务状态...&quot;</span></span><br><span class=\"line\">sudo systemctl status nginx | grep -q <span class=\"string\">&quot;active (running)&quot;</span> &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">&quot;✅ 服务运行正常&quot;</span></span><br><span class=\"line\">curl -I http://localhost/ 2&gt;&amp;1 | grep -q <span class=\"string\">&quot;200 OK&quot;</span> &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">&quot;✅ 服务响应正常&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;===================================&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;回滚演练完成&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;===================================&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>运行演练</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">chmod</span> +x rollback_drill.sh</span><br><span class=\"line\">sudo ./rollback_drill.sh</span><br></pre></td></tr></table></figure>\n\n<p><strong>预期输出</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">===================================</span><br><span class=\"line\">开始回滚演练</span><br><span class=\"line\">===================================</span><br><span class=\"line\">[1/5] 应用破坏性配置...</span><br><span class=\"line\">[2/5] 测试配置（预期失败）...</span><br><span class=\"line\">✅ 配置语法错误检测成功</span><br><span class=\"line\">[3/5] 尝试重启服务（预期失败）...</span><br><span class=\"line\">Job for nginx.service failed because the control process exited with error code.</span><br><span class=\"line\">See &quot;systemctl status nginx.service&quot; and &quot;journalctl -xe&quot; for details.</span><br><span class=\"line\">✅ 服务重启失败（符合预期）</span><br><span class=\"line\">[4/5] 执行回滚...</span><br><span class=\"line\">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class=\"line\">nginx: configuration file /etc/nginx/nginx.conf test is successful</span><br><span class=\"line\">✅ 配置语法检查通过</span><br><span class=\"line\">✅ 服务重启成功</span><br><span class=\"line\">[5/5] 验证服务状态...</span><br><span class=\"line\">✅ 服务运行正常</span><br><span class=\"line\">✅ 服务响应正常</span><br><span class=\"line\">===================================</span><br><span class=\"line\">回滚演练完成</span><br><span class=\"line\">===================================</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"学习成果示例填写（可照抄）\"><a href=\"#学习成果示例填写（可照抄）\" class=\"headerlink\" title=\"学习成果示例填写（可照抄）\"></a>学习成果示例填写（可照抄）</h2><blockquote>\n<p>可将”示例”内容替换为你自己的时间与截图文件名。</p>\n</blockquote>\n<hr>\n<h3 id=\"截图与证据（示例）\"><a href=\"#截图与证据（示例）\" class=\"headerlink\" title=\"截图与证据（示例）\"></a>截图与证据（示例）</h3><ul>\n<li>加固前扫描：<code>images/day027_before_scan.png</code></li>\n<li>加固后扫描：<code>images/day027_after_scan.png</code></li>\n<li>对比报告：<code>images/day027_comparison_report.png</code></li>\n<li>配置对比：<code>images/day027_config_diff.png</code></li>\n<li>回归测试：<code>images/day027_regression_test.png</code></li>\n<li>变更记录：<code>change_record_CR-2026-001.md</code></li>\n</ul>\n<hr>\n<h3 id=\"关键命令与输出（示例）\"><a href=\"#关键命令与输出（示例）\" class=\"headerlink\" title=\"关键命令与输出（示例）\"></a>关键命令与输出（示例）</h3><p><strong>加固前扫描</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ python main.py --config config/targets.json --output results/before</span><br><span class=\"line\">加载了 1 个扫描目标</span><br><span class=\"line\"></span><br><span class=\"line\">============================================================</span><br><span class=\"line\">扫描目标: 本机测试 (web)</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">  ❌ [版本信息泄露] 发现版本信息泄露</span><br><span class=\"line\">  ❌ [安全响应头检查] 缺少 3 个安全响应头</span><br><span class=\"line\"></span><br><span class=\"line\">通过率: 33.3% (1/3)</span><br></pre></td></tr></table></figure>\n\n<p><strong>加固效果对比</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ python compare_reports.py before.json after.json</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">加固效果对比报告</span><br><span class=\"line\">============================================================</span><br><span class=\"line\"></span><br><span class=\"line\">✅ 已修复 (2 个)</span><br><span class=\"line\">  + 版本信息泄露</span><br><span class=\"line\">  + 安全响应头检查</span><br><span class=\"line\"></span><br><span class=\"line\">❌ 仍然失败 (0 个)</span><br><span class=\"line\"></span><br><span class=\"line\">⚠️  新发现问题 (0 个)</span><br><span class=\"line\"></span><br><span class=\"line\">通过率提升: 33.3% → 100.0% (+66.7%)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"结论与反思（示例）\"><a href=\"#结论与反思（示例）\" class=\"headerlink\" title=\"结论与反思（示例）\"></a>结论与反思（示例）</h3><p><strong>我今天搞清楚了</strong>：</p>\n<ul>\n<li>加固复验是确认安全措施是否生效的关键步骤</li>\n<li>必须建立基线数据，才能评估加固效果</li>\n<li>变更记录对于审计和回溯非常重要</li>\n<li>业务回归测试可以检测加固措施的副作用</li>\n<li>必须提前制定回滚方案，以应对加固失败的情况</li>\n</ul>\n<p><strong>我差点搞混的是</strong>：</p>\n<ul>\n<li>最初不理解”复验”和”回归测试”的区别</li>\n<li>以为只要扫描通过就行了，忽略了业务功能测试</li>\n<li>不清楚变更记录应该包含哪些详细内容</li>\n</ul>\n<p><strong>明天我要继续补的是</strong>：</p>\n<ul>\n<li>学习 WAF（Web 应用防火墙）的原理与配置（Day028）</li>\n<li>了解常见 Web 漏洞（SQL 注入、XSS、CSRF）的检测与防护（Day029-031）</li>\n<li>学习安全加固的持续性监控和告警（Day032）</li>\n</ul>\n<p><strong>本次学习耗时</strong>：约 3.5 小时</p>\n<p><strong>掌握程度自评</strong>：</p>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> 😃 完成了所有任务并理解复验流程</li>\n</ul>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day026：漏洞扫描与基线 - 自动化基线检查与报告","url":"/post/99362a3b.html","content":"<h1 id=\"Day026：漏洞扫描与基线-自动化基线检查与报告\"><a href=\"#Day026：漏洞扫描与基线-自动化基线检查与报告\" class=\"headerlink\" title=\"Day026：漏洞扫描与基线 - 自动化基线检查与报告\"></a>Day026：漏洞扫描与基线 - 自动化基线检查与报告</h1><ul>\n<li>日期：2026-01-19</li>\n<li>周次：第4周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p>今天你将掌握：</p>\n<ul>\n<li><strong>将基线检查脚本化</strong>：用 Python 编写可复用的自动化基线检查工具</li>\n<li><strong>模块化设计</strong>：分离配置、检查项、报告生成，便于扩展</li>\n<li><strong>参数化配置</strong>：避免硬编码，支持命令行参数和配置文件</li>\n<li><strong>多目标批量扫描</strong>：支持对多个主机执行基线检查</li>\n<li><strong>结构化报告导出</strong>：生成 CSV&#x2F;JSON&#x2F;HTML 格式的汇总报告</li>\n</ul>\n<hr>\n<span id=\"more\"></span>\n\n<h2 id=\"学习内容\"><a href=\"#学习内容\" class=\"headerlink\" title=\"学习内容\"></a>学习内容</h2><h3 id=\"1️⃣-自动化基线检查架构设计\"><a href=\"#1️⃣-自动化基线检查架构设计\" class=\"headerlink\" title=\"1️⃣ 自动化基线检查架构设计\"></a>1️⃣ 自动化基线检查架构设计</h3><h4 id=\"1-1-整体架构\"><a href=\"#1-1-整体架构\" class=\"headerlink\" title=\"1.1 整体架构\"></a>1.1 整体架构</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">自动化基线检查系统</span><br><span class=\"line\">│</span><br><span class=\"line\">├─ 配置层（Configuration Layer）</span><br><span class=\"line\">│  ├─ 目标主机列表（targets.json）</span><br><span class=\"line\">│  ├─ 检查项配置（checks.yaml）</span><br><span class=\"line\">│  └─ 报告模板（template.html）</span><br><span class=\"line\">│</span><br><span class=\"line\">├─ 检查层（Check Layer）</span><br><span class=\"line\">│  ├─ Windows 检查模块</span><br><span class=\"line\">│  ├─ Linux 检查模块</span><br><span class=\"line\">│  └─ Web 检查模块</span><br><span class=\"line\">│</span><br><span class=\"line\">├─ 数据层（Data Layer）</span><br><span class=\"line\">│  ├─ 检查结果存储（results/）</span><br><span class=\"line\">│  └─ 历史记录对比（history/）</span><br><span class=\"line\">│</span><br><span class=\"line\">└─ 报告层（Report Layer）</span><br><span class=\"line\">   ├─ CSV 导出</span><br><span class=\"line\">   ├─ JSON 导出</span><br><span class=\"line\">   └─ HTML 可视化报告</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"1-2-代码目录结构\"><a href=\"#1-2-代码目录结构\" class=\"headerlink\" title=\"1.2 代码目录结构\"></a>1.2 代码目录结构</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">baseline_checker/</span><br><span class=\"line\">├── config/</span><br><span class=\"line\">│   ├── targets.json          # 扫描目标列表</span><br><span class=\"line\">│   ├── checks.yaml           # 检查项配置</span><br><span class=\"line\">│   └── thresholds.json       # 风险阈值</span><br><span class=\"line\">├── checks/</span><br><span class=\"line\">│   ├── __init__.py</span><br><span class=\"line\">│   ├── base.py              # 检查基类</span><br><span class=\"line\">│   ├── windows.py           # Windows 检查项</span><br><span class=\"line\">│   ├── linux.py             # Linux 检查项</span><br><span class=\"line\">│   └── web.py               # Web 检查项</span><br><span class=\"line\">├── reports/</span><br><span class=\"line\">│   ├── __init__.py</span><br><span class=\"line\">│   ├── csv_exporter.py      # CSV 导出</span><br><span class=\"line\">│   ├── json_exporter.py    # JSON 导出</span><br><span class=\"line\">│   └── html_generator.py    # HTML 生成</span><br><span class=\"line\">├── main.py                  # 主入口</span><br><span class=\"line\">├── utils.py                 # 工具函数</span><br><span class=\"line\">└── requirements.txt         # 依赖列表</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2️⃣-配置文件设计\"><a href=\"#2️⃣-配置文件设计\" class=\"headerlink\" title=\"2️⃣ 配置文件设计\"></a>2️⃣ 配置文件设计</h3><h4 id=\"2-1-目标主机配置（targets-json）\"><a href=\"#2-1-目标主机配置（targets-json）\" class=\"headerlink\" title=\"2.1 目标主机配置（targets.json）\"></a>2.1 目标主机配置（targets.json）</h4><figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;targets&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Web服务器-01&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;web&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;url&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;http://192.168.1.10:8080&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;description&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;前端应用服务器&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;应用服务器-01&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;linux&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;host&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;192.168.1.20&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;ssh_user&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;root&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;ssh_key_path&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;~/.ssh/id_rsa&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;description&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;后端应用服务器&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;数据库服务器&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;windows&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;host&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;192.168.1.30&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;winrm_user&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;administrator&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;winrm_password&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;encrypted_password&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;description&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;SQL Server&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-2-检查项配置（checks-yaml）\"><a href=\"#2-2-检查项配置（checks-yaml）\" class=\"headerlink\" title=\"2.2 检查项配置（checks.yaml）\"></a>2.2 检查项配置（checks.yaml）</h4><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">checks:</span></span><br><span class=\"line\">  <span class=\"attr\">web:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">&quot;版本信息泄露&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">type:</span> <span class=\"string\">&quot;header&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">severity:</span> <span class=\"string\">&quot;medium&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">&quot;安全响应头&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">type:</span> <span class=\"string\">&quot;headers_check&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">severity:</span> <span class=\"string\">&quot;high&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">headers_required:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">X-Frame-Options</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">X-Content-Type-Options</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">&quot;目录列出&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">type:</span> <span class=\"string\">&quot;directory_listing&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">severity:</span> <span class=\"string\">&quot;high&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">paths:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">/uploads/</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">/backup/</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">linux:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">&quot;SSH 配置检查&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">type:</span> <span class=\"string\">&quot;ssh_config&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">severity:</span> <span class=\"string\">&quot;high&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">&quot;防火墙状态&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">type:</span> <span class=\"string\">&quot;firewall&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">severity:</span> <span class=\"string\">&quot;medium&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">&quot;补丁更新状态&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">type:</span> <span class=\"string\">&quot;patches&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">severity:</span> <span class=\"string\">&quot;high&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">windows:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">&quot;密码策略&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">type:</span> <span class=\"string\">&quot;password_policy&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">severity:</span> <span class=\"string\">&quot;high&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">&quot;管理员组成员&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">type:</span> <span class=\"string\">&quot;admin_users&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">severity:</span> <span class=\"string\">&quot;medium&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"3️⃣-核心代码实现\"><a href=\"#3️⃣-核心代码实现\" class=\"headerlink\" title=\"3️⃣ 核心代码实现\"></a>3️⃣ 核心代码实现</h3><h4 id=\"3-1-基础检查类（checks-x2F-base-py）\"><a href=\"#3-1-基础检查类（checks-x2F-base-py）\" class=\"headerlink\" title=\"3.1 基础检查类（checks&#x2F;base.py）\"></a>3.1 基础检查类（checks&#x2F;base.py）</h4><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> __future__ <span class=\"keyword\">import</span> annotations</span><br><span class=\"line\"><span class=\"keyword\">from</span> abc <span class=\"keyword\">import</span> ABC, abstractmethod</span><br><span class=\"line\"><span class=\"keyword\">from</span> dataclasses <span class=\"keyword\">import</span> dataclass</span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"><span class=\"keyword\">from</span> enum <span class=\"keyword\">import</span> Enum</span><br><span class=\"line\"><span class=\"keyword\">from</span> typing <span class=\"keyword\">import</span> <span class=\"type\">Any</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Severity</span>(<span class=\"title class_ inherited__\">Enum</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;风险等级&quot;&quot;&quot;</span></span><br><span class=\"line\">    CRITICAL = <span class=\"string\">&quot;critical&quot;</span></span><br><span class=\"line\">    HIGH = <span class=\"string\">&quot;high&quot;</span></span><br><span class=\"line\">    MEDIUM = <span class=\"string\">&quot;medium&quot;</span></span><br><span class=\"line\">    LOW = <span class=\"string\">&quot;low&quot;</span></span><br><span class=\"line\">    INFO = <span class=\"string\">&quot;info&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">CheckStatus</span>(<span class=\"title class_ inherited__\">Enum</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;检查状态&quot;&quot;&quot;</span></span><br><span class=\"line\">    PASSED = <span class=\"string\">&quot;passed&quot;</span></span><br><span class=\"line\">    FAILED = <span class=\"string\">&quot;failed&quot;</span></span><br><span class=\"line\">    WARNING = <span class=\"string\">&quot;warning&quot;</span></span><br><span class=\"line\">    SKIPPED = <span class=\"string\">&quot;skipped&quot;</span></span><br><span class=\"line\">    ERROR = <span class=\"string\">&quot;error&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@dataclass</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">CheckResult</span>:</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;检查结果&quot;&quot;&quot;</span></span><br><span class=\"line\">    check_name: <span class=\"built_in\">str</span></span><br><span class=\"line\">    status: CheckStatus</span><br><span class=\"line\">    severity: Severity</span><br><span class=\"line\">    message: <span class=\"built_in\">str</span></span><br><span class=\"line\">    details: <span class=\"built_in\">dict</span>[<span class=\"built_in\">str</span>, <span class=\"type\">Any</span>] | <span class=\"literal\">None</span> = <span class=\"literal\">None</span></span><br><span class=\"line\">    recommendation: <span class=\"built_in\">str</span> | <span class=\"literal\">None</span> = <span class=\"literal\">None</span></span><br><span class=\"line\">    timestamp: datetime = datetime.now()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">BaseCheck</span>(<span class=\"title class_ inherited__\">ABC</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;检查基类&quot;&quot;&quot;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, name: <span class=\"built_in\">str</span>, severity: Severity = Severity.MEDIUM</span>):</span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.severity = severity</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"meta\">    @abstractmethod</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">execute</span>(<span class=\"params\">self, target: <span class=\"built_in\">dict</span>[<span class=\"built_in\">str</span>, <span class=\"type\">Any</span>]</span>) -&gt; CheckResult:</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;执行检查</span></span><br><span class=\"line\"><span class=\"string\">        </span></span><br><span class=\"line\"><span class=\"string\">        Args:</span></span><br><span class=\"line\"><span class=\"string\">            target: 目标主机配置</span></span><br><span class=\"line\"><span class=\"string\">            </span></span><br><span class=\"line\"><span class=\"string\">        Returns:</span></span><br><span class=\"line\"><span class=\"string\">            CheckResult: 检查结果</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">pass</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">_create_passed_result</span>(<span class=\"params\">self, message: <span class=\"built_in\">str</span>, details: <span class=\"built_in\">dict</span>[<span class=\"built_in\">str</span>, <span class=\"type\">Any</span>] | <span class=\"literal\">None</span> = <span class=\"literal\">None</span></span>) -&gt; CheckResult:</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;创建通过结果&quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> CheckResult(</span><br><span class=\"line\">            check_name=self.name,</span><br><span class=\"line\">            status=CheckStatus.PASSED,</span><br><span class=\"line\">            severity=self.severity,</span><br><span class=\"line\">            message=message,</span><br><span class=\"line\">            details=details</span><br><span class=\"line\">        )</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">_create_failed_result</span>(<span class=\"params\">self, message: <span class=\"built_in\">str</span>, recommendation: <span class=\"built_in\">str</span> | <span class=\"literal\">None</span> = <span class=\"literal\">None</span>, </span></span><br><span class=\"line\"><span class=\"params\">                               details: <span class=\"built_in\">dict</span>[<span class=\"built_in\">str</span>, <span class=\"type\">Any</span>] | <span class=\"literal\">None</span> = <span class=\"literal\">None</span></span>) -&gt; CheckResult:</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;创建失败结果&quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> CheckResult(</span><br><span class=\"line\">            check_name=self.name,</span><br><span class=\"line\">            status=CheckStatus.FAILED,</span><br><span class=\"line\">            severity=self.severity,</span><br><span class=\"line\">            message=message,</span><br><span class=\"line\">            recommendation=recommendation,</span><br><span class=\"line\">            details=details</span><br><span class=\"line\">        )</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">_create_error_result</span>(<span class=\"params\">self, message: <span class=\"built_in\">str</span>, details: <span class=\"built_in\">dict</span>[<span class=\"built_in\">str</span>, <span class=\"type\">Any</span>] | <span class=\"literal\">None</span> = <span class=\"literal\">None</span></span>) -&gt; CheckResult:</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;创建错误结果&quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> CheckResult(</span><br><span class=\"line\">            check_name=self.name,</span><br><span class=\"line\">            status=CheckStatus.ERROR,</span><br><span class=\"line\">            severity=self.severity,</span><br><span class=\"line\">            message=message,</span><br><span class=\"line\">            details=details</span><br><span class=\"line\">        )</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-2-Web-检查模块（checks-x2F-web-py）\"><a href=\"#3-2-Web-检查模块（checks-x2F-web-py）\" class=\"headerlink\" title=\"3.2 Web 检查模块（checks&#x2F;web.py）\"></a>3.2 Web 检查模块（checks&#x2F;web.py）</h4><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">from</span> urllib.parse <span class=\"keyword\">import</span> urljoin</span><br><span class=\"line\"><span class=\"keyword\">from</span> typing <span class=\"keyword\">import</span> <span class=\"type\">Any</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> checks.base <span class=\"keyword\">import</span> BaseCheck, CheckResult, Severity, CheckStatus</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">VersionDisclosureCheck</span>(<span class=\"title class_ inherited__\">BaseCheck</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;版本信息泄露检查&quot;&quot;&quot;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"built_in\">super</span>().__init__(<span class=\"string\">&quot;版本信息泄露&quot;</span>, Severity.MEDIUM)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">execute</span>(<span class=\"params\">self, target: <span class=\"built_in\">dict</span>[<span class=\"built_in\">str</span>, <span class=\"type\">Any</span>]</span>) -&gt; CheckResult:</span><br><span class=\"line\">        url = target[<span class=\"string\">&quot;url&quot;</span>]</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            resp = requests.head(url, timeout=<span class=\"number\">10</span>)</span><br><span class=\"line\">            </span><br><span class=\"line\">            server = resp.headers.get(<span class=\"string\">&quot;Server&quot;</span>, <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">            x_powered = resp.headers.get(<span class=\"string\">&quot;X-Powered-By&quot;</span>, <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">            </span><br><span class=\"line\">            issues = []</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\"># 检查 Server 头是否包含版本号</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> server <span class=\"keyword\">and</span> <span class=\"built_in\">any</span>(char.isdigit() <span class=\"keyword\">for</span> char <span class=\"keyword\">in</span> server):</span><br><span class=\"line\">                issues.append(<span class=\"string\">f&quot;Server 头暴露版本: <span class=\"subst\">&#123;server&#125;</span>&quot;</span>)</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\"># 检查 X-Powered-By 头</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> x_powered:</span><br><span class=\"line\">                issues.append(<span class=\"string\">f&quot;X-Powered-By 头暴露技术栈: <span class=\"subst\">&#123;x_powered&#125;</span>&quot;</span>)</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">if</span> issues:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> self._create_failed_result(</span><br><span class=\"line\">                    message=<span class=\"string\">f&quot;发现 <span class=\"subst\">&#123;<span class=\"built_in\">len</span>(issues)&#125;</span> 个版本信息泄露问题&quot;</span>,</span><br><span class=\"line\">                    recommendation=<span class=\"string\">&quot;配置服务器隐藏版本号&quot;</span>,</span><br><span class=\"line\">                    details=&#123;<span class=\"string\">&quot;issues&quot;</span>: issues, <span class=\"string\">&quot;headers&quot;</span>: <span class=\"built_in\">dict</span>(resp.headers)&#125;</span><br><span class=\"line\">                )</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">return</span> self._create_passed_result(</span><br><span class=\"line\">                message=<span class=\"string\">&quot;未发现版本信息泄露&quot;</span>,</span><br><span class=\"line\">                details=&#123;<span class=\"string\">&quot;server&quot;</span>: server&#125;</span><br><span class=\"line\">            )</span><br><span class=\"line\">            </span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> self._create_error_result(</span><br><span class=\"line\">                message=<span class=\"string\">f&quot;检查失败: <span class=\"subst\">&#123;<span class=\"built_in\">str</span>(e)&#125;</span>&quot;</span></span><br><span class=\"line\">            )</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">SecurityHeadersCheck</span>(<span class=\"title class_ inherited__\">BaseCheck</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;安全响应头检查&quot;&quot;&quot;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    REQUIRED_HEADERS = [</span><br><span class=\"line\">        <span class=\"string\">&quot;X-Frame-Options&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;X-Content-Type-Options&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;X-XSS-Protection&quot;</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, required_headers: <span class=\"built_in\">list</span>[<span class=\"built_in\">str</span>] | <span class=\"literal\">None</span> = <span class=\"literal\">None</span></span>):</span><br><span class=\"line\">        <span class=\"built_in\">super</span>().__init__(<span class=\"string\">&quot;安全响应头检查&quot;</span>, Severity.HIGH)</span><br><span class=\"line\">        self.required_headers = required_headers <span class=\"keyword\">or</span> self.REQUIRED_HEADERS</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">execute</span>(<span class=\"params\">self, target: <span class=\"built_in\">dict</span>[<span class=\"built_in\">str</span>, <span class=\"type\">Any</span>]</span>) -&gt; CheckResult:</span><br><span class=\"line\">        url = target[<span class=\"string\">&quot;url&quot;</span>]</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            resp = requests.head(url, timeout=<span class=\"number\">10</span>)</span><br><span class=\"line\">            headers = resp.headers</span><br><span class=\"line\">            </span><br><span class=\"line\">            missing = []</span><br><span class=\"line\">            present = []</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">for</span> header <span class=\"keyword\">in</span> self.required_headers:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> header <span class=\"keyword\">in</span> headers:</span><br><span class=\"line\">                    present.append(header)</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    missing.append(header)</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">if</span> missing:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> self._create_failed_result(</span><br><span class=\"line\">                    message=<span class=\"string\">f&quot;缺少 <span class=\"subst\">&#123;<span class=\"built_in\">len</span>(missing)&#125;</span> 个安全响应头&quot;</span>,</span><br><span class=\"line\">                    recommendation=<span class=\"string\">f&quot;配置以下响应头: <span class=\"subst\">&#123;<span class=\"string\">&#x27;, &#x27;</span>.join(missing)&#125;</span>&quot;</span>,</span><br><span class=\"line\">                    details=&#123;</span><br><span class=\"line\">                        <span class=\"string\">&quot;missing&quot;</span>: missing,</span><br><span class=\"line\">                        <span class=\"string\">&quot;present&quot;</span>: present,</span><br><span class=\"line\">                        <span class=\"string\">&quot;all_headers&quot;</span>: <span class=\"built_in\">dict</span>(headers)</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                )</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">return</span> self._create_passed_result(</span><br><span class=\"line\">                message=<span class=\"string\">f&quot;所有必需的安全响应头已配置 (<span class=\"subst\">&#123;<span class=\"built_in\">len</span>(present)&#125;</span> 个)&quot;</span>,</span><br><span class=\"line\">                details=&#123;<span class=\"string\">&quot;headers&quot;</span>: present&#125;</span><br><span class=\"line\">            )</span><br><span class=\"line\">            </span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> self._create_error_result(</span><br><span class=\"line\">                message=<span class=\"string\">f&quot;检查失败: <span class=\"subst\">&#123;<span class=\"built_in\">str</span>(e)&#125;</span>&quot;</span></span><br><span class=\"line\">            )</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">HTTPMethodsCheck</span>(<span class=\"title class_ inherited__\">BaseCheck</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;HTTP 方法限制检查&quot;&quot;&quot;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    DANGEROUS_METHODS = [<span class=\"string\">&quot;TRACE&quot;</span>, <span class=\"string\">&quot;OPTIONS&quot;</span>, <span class=\"string\">&quot;PUT&quot;</span>, <span class=\"string\">&quot;DELETE&quot;</span>, <span class=\"string\">&quot;PATCH&quot;</span>]</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"built_in\">super</span>().__init__(<span class=\"string\">&quot;HTTP 方法限制&quot;</span>, Severity.HIGH)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">execute</span>(<span class=\"params\">self, target: <span class=\"built_in\">dict</span>[<span class=\"built_in\">str</span>, <span class=\"type\">Any</span>]</span>) -&gt; CheckResult:</span><br><span class=\"line\">        url = target[<span class=\"string\">&quot;url&quot;</span>]</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            allowed = []</span><br><span class=\"line\">            blocked = []</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">for</span> method <span class=\"keyword\">in</span> self.DANGEROUS_METHODS:</span><br><span class=\"line\">                resp = requests.request(method, url, timeout=<span class=\"number\">10</span>)</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"keyword\">if</span> resp.status_code <span class=\"keyword\">in</span> [<span class=\"number\">405</span>, <span class=\"number\">501</span>]:</span><br><span class=\"line\">                    blocked.append(method)</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    allowed.append(method)</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">if</span> allowed:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> self._create_failed_result(</span><br><span class=\"line\">                    message=<span class=\"string\">f&quot;<span class=\"subst\">&#123;<span class=\"built_in\">len</span>(allowed)&#125;</span> 个危险方法被允许&quot;</span>,</span><br><span class=\"line\">                    recommendation=<span class=\"string\">&quot;在服务器配置中禁用不必要的 HTTP 方法&quot;</span>,</span><br><span class=\"line\">                    details=&#123;</span><br><span class=\"line\">                        <span class=\"string\">&quot;allowed&quot;</span>: allowed,</span><br><span class=\"line\">                        <span class=\"string\">&quot;blocked&quot;</span>: blocked</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                )</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">return</span> self._create_passed_result(</span><br><span class=\"line\">                message=<span class=\"string\">f&quot;所有危险方法已被禁用 (<span class=\"subst\">&#123;<span class=\"built_in\">len</span>(blocked)&#125;</span> 个)&quot;</span>,</span><br><span class=\"line\">                details=&#123;<span class=\"string\">&quot;blocked&quot;</span>: blocked&#125;</span><br><span class=\"line\">            )</span><br><span class=\"line\">            </span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> self._create_error_result(</span><br><span class=\"line\">                message=<span class=\"string\">f&quot;检查失败: <span class=\"subst\">&#123;<span class=\"built_in\">str</span>(e)&#125;</span>&quot;</span></span><br><span class=\"line\">            )</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">DirectoryListingCheck</span>(<span class=\"title class_ inherited__\">BaseCheck</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;目录列出检查&quot;&quot;&quot;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, paths: <span class=\"built_in\">list</span>[<span class=\"built_in\">str</span>] | <span class=\"literal\">None</span> = <span class=\"literal\">None</span></span>):</span><br><span class=\"line\">        <span class=\"built_in\">super</span>().__init__(<span class=\"string\">&quot;目录列出检查&quot;</span>, Severity.HIGH)</span><br><span class=\"line\">        self.paths = paths <span class=\"keyword\">or</span> [<span class=\"string\">&quot;/uploads/&quot;</span>, <span class=\"string\">&quot;/backup/&quot;</span>, <span class=\"string\">&quot;/images/&quot;</span>]</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">execute</span>(<span class=\"params\">self, target: <span class=\"built_in\">dict</span>[<span class=\"built_in\">str</span>, <span class=\"type\">Any</span>]</span>) -&gt; CheckResult:</span><br><span class=\"line\">        base_url = target[<span class=\"string\">&quot;url&quot;</span>]</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            listing_dirs = []</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">for</span> path <span class=\"keyword\">in</span> self.paths:</span><br><span class=\"line\">                url = urljoin(base_url, path)</span><br><span class=\"line\">                resp = requests.get(url, timeout=<span class=\"number\">10</span>)</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\"># 简单判断目录列出</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"string\">&quot;Index of&quot;</span> <span class=\"keyword\">in</span> resp.text <span class=\"keyword\">or</span> <span class=\"string\">&quot;Parent Directory&quot;</span> <span class=\"keyword\">in</span> resp.text:</span><br><span class=\"line\">                    listing_dirs.append(url)</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">if</span> listing_dirs:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> self._create_failed_result(</span><br><span class=\"line\">                    message=<span class=\"string\">f&quot;<span class=\"subst\">&#123;<span class=\"built_in\">len</span>(listing_dirs)&#125;</span> 个目录可被列出&quot;</span>,</span><br><span class=\"line\">                    recommendation=<span class=\"string\">&quot;关闭目录列出功能（Nginx: autoindex off, Apache: Options -Indexes）&quot;</span>,</span><br><span class=\"line\">                    details=&#123;<span class=\"string\">&quot;directories&quot;</span>: listing_dirs&#125;</span><br><span class=\"line\">                )</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">return</span> self._create_passed_result(</span><br><span class=\"line\">                message=<span class=\"string\">&quot;未发现目录列出风险&quot;</span>,</span><br><span class=\"line\">                details=&#123;<span class=\"string\">&quot;checked_paths&quot;</span>: self.paths&#125;</span><br><span class=\"line\">            )</span><br><span class=\"line\">            </span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> self._create_error_result(</span><br><span class=\"line\">                message=<span class=\"string\">f&quot;检查失败: <span class=\"subst\">&#123;<span class=\"built_in\">str</span>(e)&#125;</span>&quot;</span></span><br><span class=\"line\">            )</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"4️⃣-报告生成模块\"><a href=\"#4️⃣-报告生成模块\" class=\"headerlink\" title=\"4️⃣ 报告生成模块\"></a>4️⃣ 报告生成模块</h3><h4 id=\"4-1-CSV-导出（reports-x2F-csv-exporter-py）\"><a href=\"#4-1-CSV-导出（reports-x2F-csv-exporter-py）\" class=\"headerlink\" title=\"4.1 CSV 导出（reports&#x2F;csv_exporter.py）\"></a>4.1 CSV 导出（reports&#x2F;csv_exporter.py）</h4><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> csv</span><br><span class=\"line\"><span class=\"keyword\">from</span> pathlib <span class=\"keyword\">import</span> Path</span><br><span class=\"line\"><span class=\"keyword\">from</span> typing <span class=\"keyword\">import</span> <span class=\"type\">Any</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> checks.base <span class=\"keyword\">import</span> CheckResult</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">CSVExporter</span>:</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;CSV 格式导出器&quot;&quot;&quot;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, output_dir: <span class=\"built_in\">str</span> = <span class=\"string\">&quot;results&quot;</span></span>):</span><br><span class=\"line\">        self.output_dir = Path(output_dir)</span><br><span class=\"line\">        self.output_dir.mkdir(exist_ok=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">export</span>(<span class=\"params\">self, results: <span class=\"built_in\">list</span>[<span class=\"built_in\">tuple</span>[<span class=\"built_in\">str</span>, <span class=\"built_in\">list</span>[CheckResult]]], filename: <span class=\"built_in\">str</span> | <span class=\"literal\">None</span> = <span class=\"literal\">None</span></span>) -&gt; <span class=\"built_in\">str</span>:</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;导出检查结果为 CSV</span></span><br><span class=\"line\"><span class=\"string\">        </span></span><br><span class=\"line\"><span class=\"string\">        Args:</span></span><br><span class=\"line\"><span class=\"string\">            results: [(target_name, [CheckResult, ...]), ...]</span></span><br><span class=\"line\"><span class=\"string\">            filename: 输出文件名（默认带时间戳）</span></span><br><span class=\"line\"><span class=\"string\">            </span></span><br><span class=\"line\"><span class=\"string\">        Returns:</span></span><br><span class=\"line\"><span class=\"string\">            str: 导出文件路径</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> filename <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            <span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\">            filename = <span class=\"string\">f&quot;baseline_report_<span class=\"subst\">&#123;datetime.now().strftime(<span class=\"string\">&#x27;%Y%m%d_%H%M%S&#x27;</span>)&#125;</span>.csv&quot;</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        filepath = self.output_dir / filename</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(filepath, <span class=\"string\">&quot;w&quot;</span>, newline=<span class=\"string\">&quot;&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">            writer = csv.writer(f)</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\"># 写入表头</span></span><br><span class=\"line\">            writer.writerow([</span><br><span class=\"line\">                <span class=\"string\">&quot;目标名称&quot;</span>, <span class=\"string\">&quot;检查项&quot;</span>, <span class=\"string\">&quot;状态&quot;</span>, <span class=\"string\">&quot;风险等级&quot;</span>, </span><br><span class=\"line\">                <span class=\"string\">&quot;消息&quot;</span>, <span class=\"string\">&quot;建议&quot;</span>, <span class=\"string\">&quot;时间&quot;</span></span><br><span class=\"line\">            ])</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\"># 写入数据</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> target_name, check_results <span class=\"keyword\">in</span> results:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> result <span class=\"keyword\">in</span> check_results:</span><br><span class=\"line\">                    writer.writerow([</span><br><span class=\"line\">                        target_name,</span><br><span class=\"line\">                        result.check_name,</span><br><span class=\"line\">                        result.status.value,</span><br><span class=\"line\">                        result.severity.value,</span><br><span class=\"line\">                        result.message,</span><br><span class=\"line\">                        result.recommendation <span class=\"keyword\">or</span> <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">                        result.timestamp.strftime(<span class=\"string\">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class=\"line\">                    ])</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">str</span>(filepath)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">export_summary</span>(<span class=\"params\">self, results: <span class=\"built_in\">list</span>[<span class=\"built_in\">tuple</span>[<span class=\"built_in\">str</span>, <span class=\"built_in\">list</span>[CheckResult]]], filename: <span class=\"built_in\">str</span> | <span class=\"literal\">None</span> = <span class=\"literal\">None</span></span>) -&gt; <span class=\"built_in\">str</span>:</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;导出汇总报告</span></span><br><span class=\"line\"><span class=\"string\">        </span></span><br><span class=\"line\"><span class=\"string\">        Args:</span></span><br><span class=\"line\"><span class=\"string\">            results: [(target_name, [CheckResult, ...]), ...]</span></span><br><span class=\"line\"><span class=\"string\">            filename: 输出文件名</span></span><br><span class=\"line\"><span class=\"string\">            </span></span><br><span class=\"line\"><span class=\"string\">        Returns:</span></span><br><span class=\"line\"><span class=\"string\">            str: 导出文件路径</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> filename <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            <span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\">            filename = <span class=\"string\">f&quot;baseline_summary_<span class=\"subst\">&#123;datetime.now().strftime(<span class=\"string\">&#x27;%Y%m%d_%H%M%S&#x27;</span>)&#125;</span>.csv&quot;</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        filepath = self.output_dir / filename</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># 统计各目标的结果</span></span><br><span class=\"line\">        summary_data = []</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">for</span> target_name, check_results <span class=\"keyword\">in</span> results:</span><br><span class=\"line\">            passed = <span class=\"built_in\">sum</span>(<span class=\"number\">1</span> <span class=\"keyword\">for</span> r <span class=\"keyword\">in</span> check_results <span class=\"keyword\">if</span> r.status.value == <span class=\"string\">&quot;passed&quot;</span>)</span><br><span class=\"line\">            failed = <span class=\"built_in\">sum</span>(<span class=\"number\">1</span> <span class=\"keyword\">for</span> r <span class=\"keyword\">in</span> check_results <span class=\"keyword\">if</span> r.status.value == <span class=\"string\">&quot;failed&quot;</span>)</span><br><span class=\"line\">            error = <span class=\"built_in\">sum</span>(<span class=\"number\">1</span> <span class=\"keyword\">for</span> r <span class=\"keyword\">in</span> check_results <span class=\"keyword\">if</span> r.status.value == <span class=\"string\">&quot;error&quot;</span>)</span><br><span class=\"line\">            </span><br><span class=\"line\">            high_risk = <span class=\"built_in\">sum</span>(<span class=\"number\">1</span> <span class=\"keyword\">for</span> r <span class=\"keyword\">in</span> check_results </span><br><span class=\"line\">                          <span class=\"keyword\">if</span> r.status.value == <span class=\"string\">&quot;failed&quot;</span> <span class=\"keyword\">and</span> r.severity.value <span class=\"keyword\">in</span> [<span class=\"string\">&quot;critical&quot;</span>, <span class=\"string\">&quot;high&quot;</span>])</span><br><span class=\"line\">            </span><br><span class=\"line\">            summary_data.append(&#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;目标名称&quot;</span>: target_name,</span><br><span class=\"line\">                <span class=\"string\">&quot;总检查项&quot;</span>: <span class=\"built_in\">len</span>(check_results),</span><br><span class=\"line\">                <span class=\"string\">&quot;通过&quot;</span>: passed,</span><br><span class=\"line\">                <span class=\"string\">&quot;失败&quot;</span>: failed,</span><br><span class=\"line\">                <span class=\"string\">&quot;错误&quot;</span>: error,</span><br><span class=\"line\">                <span class=\"string\">&quot;高危项&quot;</span>: high_risk,</span><br><span class=\"line\">                <span class=\"string\">&quot;通过率&quot;</span>: <span class=\"string\">f&quot;<span class=\"subst\">&#123;passed / <span class=\"built_in\">len</span>(check_results) * <span class=\"number\">100</span>:<span class=\"number\">.1</span>f&#125;</span>%&quot;</span> <span class=\"keyword\">if</span> check_results <span class=\"keyword\">else</span> <span class=\"string\">&quot;N/A&quot;</span></span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># 写入 CSV</span></span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(filepath, <span class=\"string\">&quot;w&quot;</span>, newline=<span class=\"string\">&quot;&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">            writer = csv.DictWriter(f, fieldnames=[</span><br><span class=\"line\">                <span class=\"string\">&quot;目标名称&quot;</span>, <span class=\"string\">&quot;总检查项&quot;</span>, <span class=\"string\">&quot;通过&quot;</span>, <span class=\"string\">&quot;失败&quot;</span>, <span class=\"string\">&quot;错误&quot;</span>, <span class=\"string\">&quot;高危项&quot;</span>, <span class=\"string\">&quot;通过率&quot;</span></span><br><span class=\"line\">            ])</span><br><span class=\"line\">            writer.writeheader()</span><br><span class=\"line\">            writer.writerows(summary_data)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">str</span>(filepath)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-2-JSON-导出（reports-x2F-json-exporter-py）\"><a href=\"#4-2-JSON-导出（reports-x2F-json-exporter-py）\" class=\"headerlink\" title=\"4.2 JSON 导出（reports&#x2F;json_exporter.py）\"></a>4.2 JSON 导出（reports&#x2F;json_exporter.py）</h4><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">from</span> pathlib <span class=\"keyword\">import</span> Path</span><br><span class=\"line\"><span class=\"keyword\">from</span> typing <span class=\"keyword\">import</span> <span class=\"type\">Any</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> checks.base <span class=\"keyword\">import</span> CheckResult</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">JSONExporter</span>:</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;JSON 格式导出器&quot;&quot;&quot;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, output_dir: <span class=\"built_in\">str</span> = <span class=\"string\">&quot;results&quot;</span></span>):</span><br><span class=\"line\">        self.output_dir = Path(output_dir)</span><br><span class=\"line\">        self.output_dir.mkdir(exist_ok=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">export</span>(<span class=\"params\">self, results: <span class=\"built_in\">list</span>[<span class=\"built_in\">tuple</span>[<span class=\"built_in\">str</span>, <span class=\"built_in\">list</span>[CheckResult]]], filename: <span class=\"built_in\">str</span> | <span class=\"literal\">None</span> = <span class=\"literal\">None</span></span>) -&gt; <span class=\"built_in\">str</span>:</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;导出检查结果为 JSON&quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> filename <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            filename = <span class=\"string\">f&quot;baseline_report_<span class=\"subst\">&#123;datetime.now().strftime(<span class=\"string\">&#x27;%Y%m%d_%H%M%S&#x27;</span>)&#125;</span>.json&quot;</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        filepath = self.output_dir / filename</span><br><span class=\"line\">        </span><br><span class=\"line\">        data = &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;report_time&quot;</span>: datetime.now().isoformat(),</span><br><span class=\"line\">            <span class=\"string\">&quot;summary&quot;</span>: self._generate_summary(results),</span><br><span class=\"line\">            <span class=\"string\">&quot;targets&quot;</span>: []</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">for</span> target_name, check_results <span class=\"keyword\">in</span> results:</span><br><span class=\"line\">            target_data = &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;name&quot;</span>: target_name,</span><br><span class=\"line\">                <span class=\"string\">&quot;checks&quot;</span>: []</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">for</span> result <span class=\"keyword\">in</span> check_results:</span><br><span class=\"line\">                target_data[<span class=\"string\">&quot;checks&quot;</span>].append(&#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;name&quot;</span>: result.check_name,</span><br><span class=\"line\">                    <span class=\"string\">&quot;status&quot;</span>: result.status.value,</span><br><span class=\"line\">                    <span class=\"string\">&quot;severity&quot;</span>: result.severity.value,</span><br><span class=\"line\">                    <span class=\"string\">&quot;message&quot;</span>: result.message,</span><br><span class=\"line\">                    <span class=\"string\">&quot;recommendation&quot;</span>: result.recommendation,</span><br><span class=\"line\">                    <span class=\"string\">&quot;timestamp&quot;</span>: result.timestamp.isoformat(),</span><br><span class=\"line\">                    <span class=\"string\">&quot;details&quot;</span>: result.details</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\">            </span><br><span class=\"line\">            data[<span class=\"string\">&quot;targets&quot;</span>].append(target_data)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(filepath, <span class=\"string\">&quot;w&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">            json.dump(data, f, indent=<span class=\"number\">2</span>, ensure_ascii=<span class=\"literal\">False</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">str</span>(filepath)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">_generate_summary</span>(<span class=\"params\">self, results: <span class=\"built_in\">list</span>[<span class=\"built_in\">tuple</span>[<span class=\"built_in\">str</span>, <span class=\"built_in\">list</span>[CheckResult]]]</span>) -&gt; <span class=\"built_in\">dict</span>[<span class=\"built_in\">str</span>, <span class=\"type\">Any</span>]:</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;生成汇总信息&quot;&quot;&quot;</span></span><br><span class=\"line\">        total_checks = <span class=\"built_in\">sum</span>(<span class=\"built_in\">len</span>(checks) <span class=\"keyword\">for</span> _, checks <span class=\"keyword\">in</span> results)</span><br><span class=\"line\">        total_passed = <span class=\"built_in\">sum</span>(<span class=\"number\">1</span> <span class=\"keyword\">for</span> _, checks <span class=\"keyword\">in</span> results <span class=\"keyword\">for</span> r <span class=\"keyword\">in</span> checks <span class=\"keyword\">if</span> r.status.value == <span class=\"string\">&quot;passed&quot;</span>)</span><br><span class=\"line\">        total_failed = <span class=\"built_in\">sum</span>(<span class=\"number\">1</span> <span class=\"keyword\">for</span> _, checks <span class=\"keyword\">in</span> results <span class=\"keyword\">for</span> r <span class=\"keyword\">in</span> checks <span class=\"keyword\">if</span> r.status.value == <span class=\"string\">&quot;failed&quot;</span>)</span><br><span class=\"line\">        total_high_risk = <span class=\"built_in\">sum</span>(<span class=\"number\">1</span> <span class=\"keyword\">for</span> _, checks <span class=\"keyword\">in</span> results </span><br><span class=\"line\">                           <span class=\"keyword\">for</span> r <span class=\"keyword\">in</span> checks <span class=\"keyword\">if</span> r.status.value == <span class=\"string\">&quot;failed&quot;</span> <span class=\"keyword\">and</span> r.severity.value <span class=\"keyword\">in</span> [<span class=\"string\">&quot;critical&quot;</span>, <span class=\"string\">&quot;high&quot;</span>])</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;total_targets&quot;</span>: <span class=\"built_in\">len</span>(results),</span><br><span class=\"line\">            <span class=\"string\">&quot;total_checks&quot;</span>: total_checks,</span><br><span class=\"line\">            <span class=\"string\">&quot;passed&quot;</span>: total_passed,</span><br><span class=\"line\">            <span class=\"string\">&quot;failed&quot;</span>: total_failed,</span><br><span class=\"line\">            <span class=\"string\">&quot;high_risk_items&quot;</span>: total_high_risk,</span><br><span class=\"line\">            <span class=\"string\">&quot;pass_rate&quot;</span>: <span class=\"string\">f&quot;<span class=\"subst\">&#123;total_passed / total_checks * <span class=\"number\">100</span>:<span class=\"number\">.1</span>f&#125;</span>%&quot;</span> <span class=\"keyword\">if</span> total_checks &gt; <span class=\"number\">0</span> <span class=\"keyword\">else</span> <span class=\"string\">&quot;N/A&quot;</span></span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"5️⃣-主程序（main-py）\"><a href=\"#5️⃣-主程序（main-py）\" class=\"headerlink\" title=\"5️⃣ 主程序（main.py）\"></a>5️⃣ 主程序（main.py）</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python3</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">自动化基线检查主程序</span></span><br><span class=\"line\"><span class=\"string\">用法: python main.py --config config/targets.json --output results/</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> argparse</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">from</span> pathlib <span class=\"keyword\">import</span> Path</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> checks.web <span class=\"keyword\">import</span> VersionDisclosureCheck, SecurityHeadersCheck, HTTPMethodsCheck, DirectoryListingCheck</span><br><span class=\"line\"><span class=\"keyword\">from</span> checks.base <span class=\"keyword\">import</span> CheckStatus, Severity</span><br><span class=\"line\"><span class=\"keyword\">from</span> reports.csv_exporter <span class=\"keyword\">import</span> CSVExporter</span><br><span class=\"line\"><span class=\"keyword\">from</span> reports.json_exporter <span class=\"keyword\">import</span> JSONExporter</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">load_targets</span>(<span class=\"params\">config_path: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">list</span>[<span class=\"built_in\">dict</span>]:</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;加载目标配置&quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(config_path, <span class=\"string\">&quot;r&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        data = json.load(f)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> data.get(<span class=\"string\">&quot;targets&quot;</span>, [])</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">run_web_checks</span>(<span class=\"params\">target: <span class=\"built_in\">dict</span></span>) -&gt; <span class=\"built_in\">list</span>:</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;执行 Web 检查&quot;&quot;&quot;</span></span><br><span class=\"line\">    checks = [</span><br><span class=\"line\">        VersionDisclosureCheck(),</span><br><span class=\"line\">        SecurityHeadersCheck(),</span><br><span class=\"line\">        HTTPMethodsCheck(),</span><br><span class=\"line\">        DirectoryListingCheck(),</span><br><span class=\"line\">    ]</span><br><span class=\"line\">    </span><br><span class=\"line\">    results = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> check <span class=\"keyword\">in</span> checks:</span><br><span class=\"line\">        result = check.execute(target)</span><br><span class=\"line\">        results.append(result)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># 打印实时结果</span></span><br><span class=\"line\">        icon = <span class=\"string\">&quot;✅&quot;</span> <span class=\"keyword\">if</span> result.status == CheckStatus.PASSED <span class=\"keyword\">else</span> <span class=\"string\">&quot;❌&quot;</span></span><br><span class=\"line\">        severity_icon = &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;critical&quot;</span>: <span class=\"string\">&quot;🔴&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;high&quot;</span>: <span class=\"string\">&quot;🟠&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;medium&quot;</span>: <span class=\"string\">&quot;🟡&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;low&quot;</span>: <span class=\"string\">&quot;🟢&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;info&quot;</span>: <span class=\"string\">&quot;🔵&quot;</span></span><br><span class=\"line\">        &#125;.get(result.severity.value, <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;  <span class=\"subst\">&#123;icon&#125;</span> <span class=\"subst\">&#123;severity_icon&#125;</span> [<span class=\"subst\">&#123;result.check_name&#125;</span>] <span class=\"subst\">&#123;result.message&#125;</span>&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> results</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">run_checks</span>(<span class=\"params\">targets: <span class=\"built_in\">list</span>[<span class=\"built_in\">dict</span>]</span>) -&gt; <span class=\"built_in\">list</span>[<span class=\"built_in\">tuple</span>[<span class=\"built_in\">str</span>, <span class=\"built_in\">list</span>]]:</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;执行所有检查&quot;&quot;&quot;</span></span><br><span class=\"line\">    all_results = []</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">for</span> target <span class=\"keyword\">in</span> targets:</span><br><span class=\"line\">        target_name = target.get(<span class=\"string\">&quot;name&quot;</span>, target.get(<span class=\"string\">&quot;url&quot;</span>, <span class=\"string\">&quot;Unknown&quot;</span>))</span><br><span class=\"line\">        target_type = target.get(<span class=\"string\">&quot;type&quot;</span>, <span class=\"string\">&quot;unknown&quot;</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;\\n<span class=\"subst\">&#123;<span class=\"string\">&#x27;=&#x27;</span> * <span class=\"number\">60</span>&#125;</span>&quot;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;扫描目标: <span class=\"subst\">&#123;target_name&#125;</span> (<span class=\"subst\">&#123;target_type&#125;</span>)&quot;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;<span class=\"subst\">&#123;<span class=\"string\">&#x27;=&#x27;</span> * <span class=\"number\">60</span>&#125;</span>&quot;</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> target_type == <span class=\"string\">&quot;web&quot;</span>:</span><br><span class=\"line\">            results = run_web_checks(target)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;⚠️  暂不支持 <span class=\"subst\">&#123;target_type&#125;</span> 类型&quot;</span>)</span><br><span class=\"line\">            results = []</span><br><span class=\"line\">        </span><br><span class=\"line\">        all_results.append((target_name, results))</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> all_results</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">generate_reports</span>(<span class=\"params\">results: <span class=\"built_in\">list</span>[<span class=\"built_in\">tuple</span>[<span class=\"built_in\">str</span>, <span class=\"built_in\">list</span>]], output_dir: <span class=\"built_in\">str</span>, formats: <span class=\"built_in\">list</span>[<span class=\"built_in\">str</span>]</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;生成报告&quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\">    </span><br><span class=\"line\">    timestamp = datetime.now().strftime(<span class=\"string\">&quot;%Y%m%d_%H%M%S&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;\\n<span class=\"subst\">&#123;<span class=\"string\">&#x27;=&#x27;</span> * <span class=\"number\">60</span>&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;生成报告...&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;<span class=\"subst\">&#123;<span class=\"string\">&#x27;=&#x27;</span> * <span class=\"number\">60</span>&#125;</span>&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">for</span> fmt <span class=\"keyword\">in</span> formats:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> fmt == <span class=\"string\">&quot;csv&quot;</span>:</span><br><span class=\"line\">            exporter = CSVExporter(output_dir)</span><br><span class=\"line\">            path = exporter.export(results)</span><br><span class=\"line\">            summary_path = exporter.export_summary(results)</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;✅ CSV 报告: <span class=\"subst\">&#123;path&#125;</span>&quot;</span>)</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;✅ CSV 汇总: <span class=\"subst\">&#123;summary_path&#125;</span>&quot;</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">elif</span> fmt == <span class=\"string\">&quot;json&quot;</span>:</span><br><span class=\"line\">            exporter = JSONExporter(output_dir)</span><br><span class=\"line\">            path = exporter.export(results)</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;✅ JSON 报告: <span class=\"subst\">&#123;path&#125;</span>&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">main</span>():</span><br><span class=\"line\">    parser = argparse.ArgumentParser(description=<span class=\"string\">&quot;自动化基线检查工具&quot;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&quot;--config&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, required=<span class=\"literal\">True</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;目标配置文件路径&quot;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&quot;--output&quot;</span>, <span class=\"string\">&quot;-o&quot;</span>, default=<span class=\"string\">&quot;results&quot;</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;输出目录&quot;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&quot;--format&quot;</span>, <span class=\"string\">&quot;-f&quot;</span>, nargs=<span class=\"string\">&quot;+&quot;</span>, default=[<span class=\"string\">&quot;csv&quot;</span>, <span class=\"string\">&quot;json&quot;</span>],</span><br><span class=\"line\">                       choices=[<span class=\"string\">&quot;csv&quot;</span>, <span class=\"string\">&quot;json&quot;</span>], <span class=\"built_in\">help</span>=<span class=\"string\">&quot;报告格式&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    args = parser.parse_args()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 加载配置</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> Path(args.config).exists():</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;❌ 配置文件不存在: <span class=\"subst\">&#123;args.config&#125;</span>&quot;</span>)</span><br><span class=\"line\">        sys.exit(<span class=\"number\">1</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    targets = load_targets(args.config)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;加载了 <span class=\"subst\">&#123;<span class=\"built_in\">len</span>(targets)&#125;</span> 个扫描目标&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 执行检查</span></span><br><span class=\"line\">    results = run_checks(targets)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 生成报告</span></span><br><span class=\"line\">    generate_reports(results, args.output, args.<span class=\"built_in\">format</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 打印汇总</span></span><br><span class=\"line\">    total_checks = <span class=\"built_in\">sum</span>(<span class=\"built_in\">len</span>(checks) <span class=\"keyword\">for</span> _, checks <span class=\"keyword\">in</span> results)</span><br><span class=\"line\">    total_passed = <span class=\"built_in\">sum</span>(<span class=\"number\">1</span> <span class=\"keyword\">for</span> _, checks <span class=\"keyword\">in</span> results <span class=\"keyword\">for</span> r <span class=\"keyword\">in</span> checks <span class=\"keyword\">if</span> r.status == CheckStatus.PASSED)</span><br><span class=\"line\">    total_failed = <span class=\"built_in\">sum</span>(<span class=\"number\">1</span> <span class=\"keyword\">for</span> _, checks <span class=\"keyword\">in</span> results <span class=\"keyword\">for</span> r <span class=\"keyword\">in</span> checks <span class=\"keyword\">if</span> r.status == CheckStatus.FAILED)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;\\n<span class=\"subst\">&#123;<span class=\"string\">&#x27;=&#x27;</span> * <span class=\"number\">60</span>&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;检查完成！&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;<span class=\"subst\">&#123;<span class=\"string\">&#x27;=&#x27;</span> * <span class=\"number\">60</span>&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;总检查项: <span class=\"subst\">&#123;total_checks&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;通过: <span class=\"subst\">&#123;total_passed&#125;</span> ✅&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;失败: <span class=\"subst\">&#123;total_failed&#125;</span> ❌&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;通过率: <span class=\"subst\">&#123;total_passed / total_checks * <span class=\"number\">100</span>:<span class=\"number\">.1</span>f&#125;</span>%&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;<span class=\"subst\">&#123;<span class=\"string\">&#x27;=&#x27;</span> * <span class=\"number\">60</span>&#125;</span>&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"6️⃣-避免硬编码的最佳实践\"><a href=\"#6️⃣-避免硬编码的最佳实践\" class=\"headerlink\" title=\"6️⃣ 避免硬编码的最佳实践\"></a>6️⃣ 避免硬编码的最佳实践</h3><h4 id=\"6-1-配置分离\"><a href=\"#6-1-配置分离\" class=\"headerlink\" title=\"6.1 配置分离\"></a>6.1 配置分离</h4><p><strong>不推荐（硬编码）</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">check_web_server</span>():</span><br><span class=\"line\">    url = <span class=\"string\">&quot;http://192.168.1.10:8080&quot;</span>  <span class=\"comment\"># 硬编码</span></span><br><span class=\"line\">    timeout = <span class=\"number\">10</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    resp = requests.get(url, timeout=timeout)</span><br><span class=\"line\">    ...</span><br></pre></td></tr></table></figure>\n\n<p><strong>推荐（配置化）</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># config.json</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;url&quot;</span>: <span class=\"string\">&quot;http://192.168.1.10:8080&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;timeout&quot;</span>: <span class=\"number\">10</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># script.py</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">check_web_server</span>(<span class=\"params\">config: <span class=\"built_in\">dict</span></span>):</span><br><span class=\"line\">    url = config[<span class=\"string\">&quot;url&quot;</span>]</span><br><span class=\"line\">    timeout = config[<span class=\"string\">&quot;timeout&quot;</span>]</span><br><span class=\"line\">    </span><br><span class=\"line\">    resp = requests.get(url, timeout=timeout)</span><br><span class=\"line\">    ...</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"6-2-环境变量\"><a href=\"#6-2-环境变量\" class=\"headerlink\" title=\"6.2 环境变量\"></a>6.2 环境变量</h4><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">from</span> dotenv <span class=\"keyword\">import</span> load_dotenv</span><br><span class=\"line\"></span><br><span class=\"line\">load_dotenv()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用环境变量</span></span><br><span class=\"line\">api_key = os.getenv(<span class=\"string\">&quot;API_KEY&quot;</span>)</span><br><span class=\"line\">database_url = os.getenv(<span class=\"string\">&quot;DATABASE_URL&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"6-3-命令行参数\"><a href=\"#6-3-命令行参数\" class=\"headerlink\" title=\"6.3 命令行参数\"></a>6.3 命令行参数</h4><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> argparse</span><br><span class=\"line\"></span><br><span class=\"line\">parser = argparse.ArgumentParser()</span><br><span class=\"line\">parser.add_argument(<span class=\"string\">&quot;--url&quot;</span>, required=<span class=\"literal\">True</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;目标 URL&quot;</span>)</span><br><span class=\"line\">parser.add_argument(<span class=\"string\">&quot;--timeout&quot;</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">int</span>, default=<span class=\"number\">10</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;超时时间&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">args = parser.parse_args()</span><br><span class=\"line\"></span><br><span class=\"line\">url = args.url</span><br><span class=\"line\">timeout = args.timeout</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"实践任务（合法授权范围内）\"><a href=\"#实践任务（合法授权范围内）\" class=\"headerlink\" title=\"实践任务（合法授权范围内）\"></a>实践任务（合法授权范围内）</h2><blockquote>\n<p><strong>注意</strong>：请在你自己的测试环境、本地虚拟机或授权靶场中执行以下任务。</p>\n</blockquote>\n<hr>\n<h3 id=\"任务-1（必做）：搭建项目结构\"><a href=\"#任务-1（必做）：搭建项目结构\" class=\"headerlink\" title=\"任务 1（必做）：搭建项目结构\"></a>任务 1（必做）：搭建项目结构</h3><p><strong>目标</strong>：创建自动化基线检查项目的基础目录结构。</p>\n<p><strong>步骤</strong>：</p>\n<ol>\n<li><strong>创建目录结构</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Windows PowerShell</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> baseline_checker, baseline_checker\\config, baseline_checker\\checks, baseline_checker\\reports, baseline_checker\\results</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Linux/Mac</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> -p baseline_checker/&#123;config,checks,reports,results&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><strong>创建配置文件</strong></li>\n</ol>\n<p>创建 <code>config/targets.json</code>：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;targets&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;本机测试&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;web&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;url&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;http://localhost:8080&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;description&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;本地测试服务器&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><strong>创建 Python 模块</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> baseline_checker</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建空的 __init__.py 文件</span></span><br><span class=\"line\"><span class=\"built_in\">type</span> nul &gt; checks\\__init__.py</span><br><span class=\"line\"><span class=\"built_in\">type</span> nul &gt; reports\\__init__.py</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建主文件</span></span><br><span class=\"line\"><span class=\"built_in\">type</span> nul &gt; main.py</span><br><span class=\"line\"><span class=\"built_in\">type</span> nul &gt; utils.py</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li><strong>安装依赖</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 创建 requirements.txt</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> requests &gt; requirements.txt</span><br><span class=\"line\"><span class=\"built_in\">echo</span> pyyaml &gt;&gt; requirements.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装依赖</span></span><br><span class=\"line\">pip install -r requirements.txt</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-2（必做）：实现-Web-检查模块\"><a href=\"#任务-2（必做）：实现-Web-检查模块\" class=\"headerlink\" title=\"任务 2（必做）：实现 Web 检查模块\"></a>任务 2（必做）：实现 Web 检查模块</h3><p><strong>目标</strong>：创建 Web 检查模块并实现基础检查功能。</p>\n<p><strong>步骤</strong>：</p>\n<ol>\n<li><strong>创建 <code>checks/base.py</code></strong></li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> __future__ <span class=\"keyword\">import</span> annotations</span><br><span class=\"line\"><span class=\"keyword\">from</span> abc <span class=\"keyword\">import</span> ABC, abstractmethod</span><br><span class=\"line\"><span class=\"keyword\">from</span> dataclasses <span class=\"keyword\">import</span> dataclass</span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"><span class=\"keyword\">from</span> enum <span class=\"keyword\">import</span> Enum</span><br><span class=\"line\"><span class=\"keyword\">from</span> typing <span class=\"keyword\">import</span> <span class=\"type\">Any</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Severity</span>(<span class=\"title class_ inherited__\">Enum</span>):</span><br><span class=\"line\">    CRITICAL = <span class=\"string\">&quot;critical&quot;</span></span><br><span class=\"line\">    HIGH = <span class=\"string\">&quot;high&quot;</span></span><br><span class=\"line\">    MEDIUM = <span class=\"string\">&quot;medium&quot;</span></span><br><span class=\"line\">    LOW = <span class=\"string\">&quot;low&quot;</span></span><br><span class=\"line\">    INFO = <span class=\"string\">&quot;info&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">CheckStatus</span>(<span class=\"title class_ inherited__\">Enum</span>):</span><br><span class=\"line\">    PASSED = <span class=\"string\">&quot;passed&quot;</span></span><br><span class=\"line\">    FAILED = <span class=\"string\">&quot;failed&quot;</span></span><br><span class=\"line\">    WARNING = <span class=\"string\">&quot;warning&quot;</span></span><br><span class=\"line\">    SKIPPED = <span class=\"string\">&quot;skipped&quot;</span></span><br><span class=\"line\">    ERROR = <span class=\"string\">&quot;error&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@dataclass</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">CheckResult</span>:</span><br><span class=\"line\">    check_name: <span class=\"built_in\">str</span></span><br><span class=\"line\">    status: CheckStatus</span><br><span class=\"line\">    severity: Severity</span><br><span class=\"line\">    message: <span class=\"built_in\">str</span></span><br><span class=\"line\">    details: <span class=\"built_in\">dict</span>[<span class=\"built_in\">str</span>, <span class=\"type\">Any</span>] | <span class=\"literal\">None</span> = <span class=\"literal\">None</span></span><br><span class=\"line\">    recommendation: <span class=\"built_in\">str</span> | <span class=\"literal\">None</span> = <span class=\"literal\">None</span></span><br><span class=\"line\">    timestamp: datetime = datetime.now()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">BaseCheck</span>(<span class=\"title class_ inherited__\">ABC</span>):</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, name: <span class=\"built_in\">str</span>, severity: Severity = Severity.MEDIUM</span>):</span><br><span class=\"line\">        self.name = name</span><br><span class=\"line\">        self.severity = severity</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"meta\">    @abstractmethod</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">execute</span>(<span class=\"params\">self, target: <span class=\"built_in\">dict</span>[<span class=\"built_in\">str</span>, <span class=\"type\">Any</span>]</span>) -&gt; CheckResult:</span><br><span class=\"line\">        <span class=\"keyword\">pass</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><strong>创建 <code>checks/web.py</code></strong></li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">from</span> typing <span class=\"keyword\">import</span> <span class=\"type\">Any</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> checks.base <span class=\"keyword\">import</span> BaseCheck, CheckResult, Severity, CheckStatus</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">VersionDisclosureCheck</span>(<span class=\"title class_ inherited__\">BaseCheck</span>):</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"built_in\">super</span>().__init__(<span class=\"string\">&quot;版本信息泄露&quot;</span>, Severity.MEDIUM)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">execute</span>(<span class=\"params\">self, target: <span class=\"built_in\">dict</span>[<span class=\"built_in\">str</span>, <span class=\"type\">Any</span>]</span>) -&gt; CheckResult:</span><br><span class=\"line\">        url = target[<span class=\"string\">&quot;url&quot;</span>]</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            resp = requests.head(url, timeout=<span class=\"number\">10</span>)</span><br><span class=\"line\">            server = resp.headers.get(<span class=\"string\">&quot;Server&quot;</span>, <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">            x_powered = resp.headers.get(<span class=\"string\">&quot;X-Powered-By&quot;</span>, <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">            </span><br><span class=\"line\">            issues = []</span><br><span class=\"line\">            <span class=\"keyword\">if</span> server <span class=\"keyword\">and</span> <span class=\"built_in\">any</span>(char.isdigit() <span class=\"keyword\">for</span> char <span class=\"keyword\">in</span> server):</span><br><span class=\"line\">                issues.append(<span class=\"string\">f&quot;Server: <span class=\"subst\">&#123;server&#125;</span>&quot;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> x_powered:</span><br><span class=\"line\">                issues.append(<span class=\"string\">f&quot;X-Powered-By: <span class=\"subst\">&#123;x_powered&#125;</span>&quot;</span>)</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">if</span> issues:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> CheckResult(</span><br><span class=\"line\">                    check_name=self.name,</span><br><span class=\"line\">                    status=CheckStatus.FAILED,</span><br><span class=\"line\">                    severity=self.severity,</span><br><span class=\"line\">                    message=<span class=\"string\">f&quot;发现版本信息泄露&quot;</span>,</span><br><span class=\"line\">                    details=&#123;<span class=\"string\">&quot;issues&quot;</span>: issues&#125;,</span><br><span class=\"line\">                    recommendation=<span class=\"string\">&quot;隐藏版本信息&quot;</span></span><br><span class=\"line\">                )</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">return</span> CheckResult(</span><br><span class=\"line\">                check_name=self.name,</span><br><span class=\"line\">                status=CheckStatus.PASSED,</span><br><span class=\"line\">                severity=self.severity,</span><br><span class=\"line\">                message=<span class=\"string\">&quot;未发现版本信息泄露&quot;</span></span><br><span class=\"line\">            )</span><br><span class=\"line\">            </span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> CheckResult(</span><br><span class=\"line\">                check_name=self.name,</span><br><span class=\"line\">                status=CheckStatus.ERROR,</span><br><span class=\"line\">                severity=self.severity,</span><br><span class=\"line\">                message=<span class=\"string\">f&quot;检查失败: <span class=\"subst\">&#123;<span class=\"built_in\">str</span>(e)&#125;</span>&quot;</span></span><br><span class=\"line\">            )</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">SecurityHeadersCheck</span>(<span class=\"title class_ inherited__\">BaseCheck</span>):</span><br><span class=\"line\">    REQUIRED_HEADERS = [</span><br><span class=\"line\">        <span class=\"string\">&quot;X-Frame-Options&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;X-Content-Type-Options&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;X-XSS-Protection&quot;</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"built_in\">super</span>().__init__(<span class=\"string\">&quot;安全响应头检查&quot;</span>, Severity.HIGH)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">execute</span>(<span class=\"params\">self, target: <span class=\"built_in\">dict</span>[<span class=\"built_in\">str</span>, <span class=\"type\">Any</span>]</span>) -&gt; CheckResult:</span><br><span class=\"line\">        url = target[<span class=\"string\">&quot;url&quot;</span>]</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            resp = requests.head(url, timeout=<span class=\"number\">10</span>)</span><br><span class=\"line\">            headers = resp.headers</span><br><span class=\"line\">            </span><br><span class=\"line\">            missing = [h <span class=\"keyword\">for</span> h <span class=\"keyword\">in</span> self.REQUIRED_HEADERS <span class=\"keyword\">if</span> h <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> headers]</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">if</span> missing:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> CheckResult(</span><br><span class=\"line\">                    check_name=self.name,</span><br><span class=\"line\">                    status=CheckStatus.FAILED,</span><br><span class=\"line\">                    severity=self.severity,</span><br><span class=\"line\">                    message=<span class=\"string\">f&quot;缺少 <span class=\"subst\">&#123;<span class=\"built_in\">len</span>(missing)&#125;</span> 个安全响应头&quot;</span>,</span><br><span class=\"line\">                    details=&#123;<span class=\"string\">&quot;missing&quot;</span>: missing&#125;,</span><br><span class=\"line\">                    recommendation=<span class=\"string\">f&quot;配置以下响应头: <span class=\"subst\">&#123;<span class=\"string\">&#x27;, &#x27;</span>.join(missing)&#125;</span>&quot;</span></span><br><span class=\"line\">                )</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">return</span> CheckResult(</span><br><span class=\"line\">                check_name=self.name,</span><br><span class=\"line\">                status=CheckStatus.PASSED,</span><br><span class=\"line\">                severity=self.severity,</span><br><span class=\"line\">                message=<span class=\"string\">f&quot;所有安全响应头已配置 (<span class=\"subst\">&#123;<span class=\"built_in\">len</span>(self.REQUIRED_HEADERS)&#125;</span> 个)&quot;</span></span><br><span class=\"line\">            )</span><br><span class=\"line\">            </span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> CheckResult(</span><br><span class=\"line\">                check_name=self.name,</span><br><span class=\"line\">                status=CheckStatus.ERROR,</span><br><span class=\"line\">                severity=self.severity,</span><br><span class=\"line\">                message=<span class=\"string\">f&quot;检查失败: <span class=\"subst\">&#123;<span class=\"built_in\">str</span>(e)&#125;</span>&quot;</span></span><br><span class=\"line\">            )</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-3（必做）：实现报告导出模块\"><a href=\"#任务-3（必做）：实现报告导出模块\" class=\"headerlink\" title=\"任务 3（必做）：实现报告导出模块\"></a>任务 3（必做）：实现报告导出模块</h3><p><strong>目标</strong>：实现 CSV 和 JSON 格式的报告导出。</p>\n<p><strong>步骤</strong>：</p>\n<ol>\n<li><strong>创建 <code>reports/csv_exporter.py</code></strong></li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> csv</span><br><span class=\"line\"><span class=\"keyword\">from</span> pathlib <span class=\"keyword\">import</span> Path</span><br><span class=\"line\"><span class=\"keyword\">from</span> typing <span class=\"keyword\">import</span> <span class=\"type\">Any</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> checks.base <span class=\"keyword\">import</span> CheckResult</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">CSVExporter</span>:</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, output_dir: <span class=\"built_in\">str</span> = <span class=\"string\">&quot;results&quot;</span></span>):</span><br><span class=\"line\">        self.output_dir = Path(output_dir)</span><br><span class=\"line\">        self.output_dir.mkdir(exist_ok=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">export</span>(<span class=\"params\">self, results: <span class=\"built_in\">list</span>[<span class=\"built_in\">tuple</span>[<span class=\"built_in\">str</span>, <span class=\"built_in\">list</span>[CheckResult]]], filename: <span class=\"built_in\">str</span> | <span class=\"literal\">None</span> = <span class=\"literal\">None</span></span>) -&gt; <span class=\"built_in\">str</span>:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> filename <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            <span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\">            filename = <span class=\"string\">f&quot;baseline_report_<span class=\"subst\">&#123;datetime.now().strftime(<span class=\"string\">&#x27;%Y%m%d_%H%M%S&#x27;</span>)&#125;</span>.csv&quot;</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        filepath = self.output_dir / filename</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(filepath, <span class=\"string\">&quot;w&quot;</span>, newline=<span class=\"string\">&quot;&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">            writer = csv.writer(f)</span><br><span class=\"line\">            writer.writerow([<span class=\"string\">&quot;目标名称&quot;</span>, <span class=\"string\">&quot;检查项&quot;</span>, <span class=\"string\">&quot;状态&quot;</span>, <span class=\"string\">&quot;风险等级&quot;</span>, <span class=\"string\">&quot;消息&quot;</span>, <span class=\"string\">&quot;建议&quot;</span>, <span class=\"string\">&quot;时间&quot;</span>])</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">for</span> target_name, check_results <span class=\"keyword\">in</span> results:</span><br><span class=\"line\">                <span class=\"keyword\">for</span> result <span class=\"keyword\">in</span> check_results:</span><br><span class=\"line\">                    writer.writerow([</span><br><span class=\"line\">                        target_name,</span><br><span class=\"line\">                        result.check_name,</span><br><span class=\"line\">                        result.status.value,</span><br><span class=\"line\">                        result.severity.value,</span><br><span class=\"line\">                        result.message,</span><br><span class=\"line\">                        result.recommendation <span class=\"keyword\">or</span> <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">                        result.timestamp.strftime(<span class=\"string\">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class=\"line\">                    ])</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">str</span>(filepath)</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><strong>创建 <code>reports/json_exporter.py</code></strong></li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">from</span> pathlib <span class=\"keyword\">import</span> Path</span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> checks.base <span class=\"keyword\">import</span> CheckResult</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">JSONExporter</span>:</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, output_dir: <span class=\"built_in\">str</span> = <span class=\"string\">&quot;results&quot;</span></span>):</span><br><span class=\"line\">        self.output_dir = Path(output_dir)</span><br><span class=\"line\">        self.output_dir.mkdir(exist_ok=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">export</span>(<span class=\"params\">self, results: <span class=\"built_in\">list</span>[<span class=\"built_in\">tuple</span>[<span class=\"built_in\">str</span>, <span class=\"built_in\">list</span>[CheckResult]]], filename: <span class=\"built_in\">str</span> | <span class=\"literal\">None</span> = <span class=\"literal\">None</span></span>) -&gt; <span class=\"built_in\">str</span>:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> filename <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            filename = <span class=\"string\">f&quot;baseline_report_<span class=\"subst\">&#123;datetime.now().strftime(<span class=\"string\">&#x27;%Y%m%d_%H%M%S&#x27;</span>)&#125;</span>.json&quot;</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        filepath = self.output_dir / filename</span><br><span class=\"line\">        </span><br><span class=\"line\">        data = &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;report_time&quot;</span>: datetime.now().isoformat(),</span><br><span class=\"line\">            <span class=\"string\">&quot;targets&quot;</span>: []</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">for</span> target_name, check_results <span class=\"keyword\">in</span> results:</span><br><span class=\"line\">            target_data = &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;name&quot;</span>: target_name,</span><br><span class=\"line\">                <span class=\"string\">&quot;checks&quot;</span>: []</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">for</span> result <span class=\"keyword\">in</span> check_results:</span><br><span class=\"line\">                target_data[<span class=\"string\">&quot;checks&quot;</span>].append(&#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;name&quot;</span>: result.check_name,</span><br><span class=\"line\">                    <span class=\"string\">&quot;status&quot;</span>: result.status.value,</span><br><span class=\"line\">                    <span class=\"string\">&quot;severity&quot;</span>: result.severity.value,</span><br><span class=\"line\">                    <span class=\"string\">&quot;message&quot;</span>: result.message,</span><br><span class=\"line\">                    <span class=\"string\">&quot;recommendation&quot;</span>: result.recommendation,</span><br><span class=\"line\">                    <span class=\"string\">&quot;timestamp&quot;</span>: result.timestamp.isoformat()</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\">            </span><br><span class=\"line\">            data[<span class=\"string\">&quot;targets&quot;</span>].append(target_data)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(filepath, <span class=\"string\">&quot;w&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">            json.dump(data, f, indent=<span class=\"number\">2</span>, ensure_ascii=<span class=\"literal\">False</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">str</span>(filepath)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-4（必做）：创建主程序\"><a href=\"#任务-4（必做）：创建主程序\" class=\"headerlink\" title=\"任务 4（必做）：创建主程序\"></a>任务 4（必做）：创建主程序</h3><p><strong>目标</strong>：编写主程序，整合所有模块。</p>\n<p>**创建 <code>main.py</code>**：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python3</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> argparse</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">from</span> pathlib <span class=\"keyword\">import</span> Path</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> checks.web <span class=\"keyword\">import</span> VersionDisclosureCheck, SecurityHeadersCheck</span><br><span class=\"line\"><span class=\"keyword\">from</span> checks.base <span class=\"keyword\">import</span> CheckStatus</span><br><span class=\"line\"><span class=\"keyword\">from</span> reports.csv_exporter <span class=\"keyword\">import</span> CSVExporter</span><br><span class=\"line\"><span class=\"keyword\">from</span> reports.json_exporter <span class=\"keyword\">import</span> JSONExporter</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">load_targets</span>(<span class=\"params\">config_path: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">list</span>[<span class=\"built_in\">dict</span>]:</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(config_path, <span class=\"string\">&quot;r&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        data = json.load(f)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> data.get(<span class=\"string\">&quot;targets&quot;</span>, [])</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">run_checks</span>(<span class=\"params\">targets: <span class=\"built_in\">list</span>[<span class=\"built_in\">dict</span>]</span>) -&gt; <span class=\"built_in\">list</span>[<span class=\"built_in\">tuple</span>[<span class=\"built_in\">str</span>, <span class=\"built_in\">list</span>]]:</span><br><span class=\"line\">    all_results = []</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">for</span> target <span class=\"keyword\">in</span> targets:</span><br><span class=\"line\">        target_name = target.get(<span class=\"string\">&quot;name&quot;</span>, <span class=\"string\">&quot;Unknown&quot;</span>)</span><br><span class=\"line\">        target_type = target.get(<span class=\"string\">&quot;type&quot;</span>, <span class=\"string\">&quot;unknown&quot;</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;\\n<span class=\"subst\">&#123;<span class=\"string\">&#x27;=&#x27;</span> * <span class=\"number\">60</span>&#125;</span>&quot;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;扫描目标: <span class=\"subst\">&#123;target_name&#125;</span> (<span class=\"subst\">&#123;target_type&#125;</span>)&quot;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;<span class=\"subst\">&#123;<span class=\"string\">&#x27;=&#x27;</span> * <span class=\"number\">60</span>&#125;</span>&quot;</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> target_type == <span class=\"string\">&quot;web&quot;</span>:</span><br><span class=\"line\">            checks = [</span><br><span class=\"line\">                VersionDisclosureCheck(),</span><br><span class=\"line\">                SecurityHeadersCheck(),</span><br><span class=\"line\">            ]</span><br><span class=\"line\">            results = []</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">for</span> check <span class=\"keyword\">in</span> checks:</span><br><span class=\"line\">                result = check.execute(target)</span><br><span class=\"line\">                results.append(result)</span><br><span class=\"line\">                </span><br><span class=\"line\">                icon = <span class=\"string\">&quot;✅&quot;</span> <span class=\"keyword\">if</span> result.status == CheckStatus.PASSED <span class=\"keyword\">else</span> <span class=\"string\">&quot;❌&quot;</span></span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;  <span class=\"subst\">&#123;icon&#125;</span> [<span class=\"subst\">&#123;result.check_name&#125;</span>] <span class=\"subst\">&#123;result.message&#125;</span>&quot;</span>)</span><br><span class=\"line\">            </span><br><span class=\"line\">            all_results.append((target_name, results))</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;⚠️  暂不支持 <span class=\"subst\">&#123;target_type&#125;</span> 类型&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> all_results</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">generate_reports</span>(<span class=\"params\">results: <span class=\"built_in\">list</span>[<span class=\"built_in\">tuple</span>[<span class=\"built_in\">str</span>, <span class=\"built_in\">list</span>]], output_dir: <span class=\"built_in\">str</span></span>):</span><br><span class=\"line\">    csv_exporter = CSVExporter(output_dir)</span><br><span class=\"line\">    json_exporter = JSONExporter(output_dir)</span><br><span class=\"line\">    </span><br><span class=\"line\">    csv_path = csv_exporter.export(results)</span><br><span class=\"line\">    json_path = json_exporter.export(results)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;\\n<span class=\"subst\">&#123;<span class=\"string\">&#x27;=&#x27;</span> * <span class=\"number\">60</span>&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;报告生成完成！&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;<span class=\"subst\">&#123;<span class=\"string\">&#x27;=&#x27;</span> * <span class=\"number\">60</span>&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;✅ CSV 报告: <span class=\"subst\">&#123;csv_path&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;✅ JSON 报告: <span class=\"subst\">&#123;json_path&#125;</span>&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">main</span>():</span><br><span class=\"line\">    parser = argparse.ArgumentParser(description=<span class=\"string\">&quot;自动化基线检查工具&quot;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&quot;--config&quot;</span>, <span class=\"string\">&quot;-c&quot;</span>, required=<span class=\"literal\">True</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;目标配置文件路径&quot;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&quot;--output&quot;</span>, <span class=\"string\">&quot;-o&quot;</span>, default=<span class=\"string\">&quot;results&quot;</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;输出目录&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    args = parser.parse_args()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> Path(args.config).exists():</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;❌ 配置文件不存在: <span class=\"subst\">&#123;args.config&#125;</span>&quot;</span>)</span><br><span class=\"line\">        sys.exit(<span class=\"number\">1</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    targets = load_targets(args.config)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;加载了 <span class=\"subst\">&#123;<span class=\"built_in\">len</span>(targets)&#125;</span> 个扫描目标&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    results = run_checks(targets)</span><br><span class=\"line\">    generate_reports(results, args.output)</span><br><span class=\"line\">    </span><br><span class=\"line\">    total_checks = <span class=\"built_in\">sum</span>(<span class=\"built_in\">len</span>(checks) <span class=\"keyword\">for</span> _, checks <span class=\"keyword\">in</span> results)</span><br><span class=\"line\">    total_passed = <span class=\"built_in\">sum</span>(<span class=\"number\">1</span> <span class=\"keyword\">for</span> _, checks <span class=\"keyword\">in</span> results <span class=\"keyword\">for</span> r <span class=\"keyword\">in</span> checks <span class=\"keyword\">if</span> r.status == CheckStatus.PASSED)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;\\n总检查项: <span class=\"subst\">&#123;total_checks&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;通过: <span class=\"subst\">&#123;total_passed&#125;</span> ✅&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;失败: <span class=\"subst\">&#123;total_checks - total_passed&#125;</span> ❌&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-5（必做）：运行测试\"><a href=\"#任务-5（必做）：运行测试\" class=\"headerlink\" title=\"任务 5（必做）：运行测试\"></a>任务 5（必做）：运行测试</h3><p><strong>目标</strong>：运行基线检查工具并验证结果。</p>\n<p><strong>步骤</strong>：</p>\n<ol>\n<li><strong>准备测试环境</strong></li>\n</ol>\n<p>启动一个本地 Web 服务器（如 Nginx&#x2F;Apache）：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Python 简单 HTTP 服务器（用于测试）</span></span><br><span class=\"line\">python -m http.server 8080</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><strong>运行基线检查</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> baseline_checker</span><br><span class=\"line\">python main.py --config config/targets.json --output results</span><br></pre></td></tr></table></figure>\n\n<p><strong>预期输出</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">加载了 1 个扫描目标</span><br><span class=\"line\"></span><br><span class=\"line\">============================================================</span><br><span class=\"line\">扫描目标: 本机测试 (web)</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">  ❌ [版本信息泄露] 发现版本信息泄露</span><br><span class=\"line\">  ❌ [安全响应头检查] 缺少 3 个安全响应头</span><br><span class=\"line\"></span><br><span class=\"line\">============================================================</span><br><span class=\"line\">报告生成完成！</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">✅ CSV 报告: results/baseline_report_20260119_143000.csv</span><br><span class=\"line\">✅ JSON 报告: results/baseline_report_20260119_143000.json</span><br><span class=\"line\"></span><br><span class=\"line\">总检查项: 2</span><br><span class=\"line\">通过: 0 ✅</span><br><span class=\"line\">失败: 2 ❌</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><strong>查看生成的报告</strong></li>\n</ol>\n<p><strong>查看 CSV 报告</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">type</span> results\\baseline_report_*.csv</span><br></pre></td></tr></table></figure>\n\n<p><strong>查看 JSON 报告</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">type</span> results\\baseline_report_*.json</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-6（进阶）：添加日志记录\"><a href=\"#任务-6（进阶）：添加日志记录\" class=\"headerlink\" title=\"任务 6（进阶）：添加日志记录\"></a>任务 6（进阶）：添加日志记录</h3><p><strong>目标</strong>：为脚本添加详细的日志记录功能。</p>\n<p>**修改 <code>utils.py</code>**：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> logging</span><br><span class=\"line\"><span class=\"keyword\">from</span> pathlib <span class=\"keyword\">import</span> Path</span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">setup_logger</span>(<span class=\"params\">name: <span class=\"built_in\">str</span> = <span class=\"string\">&quot;baseline_checker&quot;</span>, log_file: <span class=\"built_in\">str</span> | <span class=\"literal\">None</span> = <span class=\"literal\">None</span>, level: <span class=\"built_in\">int</span> = logging.INFO</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;配置日志记录器</span></span><br><span class=\"line\"><span class=\"string\">    </span></span><br><span class=\"line\"><span class=\"string\">    Args:</span></span><br><span class=\"line\"><span class=\"string\">        name: 日志记录器名称</span></span><br><span class=\"line\"><span class=\"string\">        log_file: 日志文件路径（可选）</span></span><br><span class=\"line\"><span class=\"string\">        level: 日志级别</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    logger = logging.getLogger(name)</span><br><span class=\"line\">    logger.setLevel(level)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 控制台处理器</span></span><br><span class=\"line\">    console_handler = logging.StreamHandler()</span><br><span class=\"line\">    console_handler.setLevel(level)</span><br><span class=\"line\">    console_format = logging.Formatter(</span><br><span class=\"line\">        <span class=\"string\">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>,</span><br><span class=\"line\">        datefmt=<span class=\"string\">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span></span><br><span class=\"line\">    )</span><br><span class=\"line\">    console_handler.setFormatter(console_format)</span><br><span class=\"line\">    logger.addHandler(console_handler)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 文件处理器</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> log_file:</span><br><span class=\"line\">        log_path = Path(log_file)</span><br><span class=\"line\">        log_path.parent.mkdir(parents=<span class=\"literal\">True</span>, exist_ok=<span class=\"literal\">True</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        file_handler = logging.FileHandler(log_path, encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>)</span><br><span class=\"line\">        file_handler.setLevel(level)</span><br><span class=\"line\">        file_format = logging.Formatter(</span><br><span class=\"line\">            <span class=\"string\">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>,</span><br><span class=\"line\">            datefmt=<span class=\"string\">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span></span><br><span class=\"line\">        )</span><br><span class=\"line\">        file_handler.setFormatter(file_format)</span><br><span class=\"line\">        logger.addHandler(file_handler)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> logger</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">create_log_filename</span>() -&gt; <span class=\"built_in\">str</span>:</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;创建带时间戳的日志文件名&quot;&quot;&quot;</span></span><br><span class=\"line\">    timestamp = datetime.now().strftime(<span class=\"string\">&quot;%Y%m%d_%H%M%S&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">f&quot;baseline_checker_<span class=\"subst\">&#123;timestamp&#125;</span>.log&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>修改 <code>main.py</code> 添加日志</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> utils <span class=\"keyword\">import</span> setup_logger, create_log_filename</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">main</span>():</span><br><span class=\"line\">    <span class=\"comment\"># ... 之前的代码 ...</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 设置日志</span></span><br><span class=\"line\">    log_file = Path(args.output) / create_log_filename()</span><br><span class=\"line\">    logger = setup_logger(log_file=<span class=\"built_in\">str</span>(log_file))</span><br><span class=\"line\">    logger.info(<span class=\"string\">f&quot;基线检查工具启动&quot;</span>)</span><br><span class=\"line\">    logger.info(<span class=\"string\">f&quot;配置文件: <span class=\"subst\">&#123;args.config&#125;</span>&quot;</span>)</span><br><span class=\"line\">    logger.info(<span class=\"string\">f&quot;输出目录: <span class=\"subst\">&#123;args.output&#125;</span>&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    targets = load_targets(args.config)</span><br><span class=\"line\">    logger.info(<span class=\"string\">f&quot;加载了 <span class=\"subst\">&#123;<span class=\"built_in\">len</span>(targets)&#125;</span> 个扫描目标&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># ... 运行检查 ...</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    logger.info(<span class=\"string\">&quot;检查完成&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-7（进阶）：支持多目标批量扫描\"><a href=\"#任务-7（进阶）：支持多目标批量扫描\" class=\"headerlink\" title=\"任务 7（进阶）：支持多目标批量扫描\"></a>任务 7（进阶）：支持多目标批量扫描</h3><p><strong>目标</strong>：扩展配置以支持多个目标。</p>\n<p>**修改 <code>config/targets.json</code>**：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;targets&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;本机-8080&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;web&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;url&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;http://localhost:8080&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;description&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;本地测试服务器 1&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;本机-3000&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;web&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;url&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;http://localhost:3000&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;description&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;本地测试服务器 2&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>运行批量扫描</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">python main.py --config config/targets.json --output results</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"巩固练习（题与复盘）\"><a href=\"#巩固练习（题与复盘）\" class=\"headerlink\" title=\"巩固练习（题与复盘）\"></a>巩固练习（题与复盘）</h2><hr>\n<h3 id=\"练习-1：如何避免脚本硬编码？\"><a href=\"#练习-1：如何避免脚本硬编码？\" class=\"headerlink\" title=\"练习 1：如何避免脚本硬编码？\"></a>练习 1：如何避免脚本硬编码？</h3><p><strong>思路提示</strong>：</p>\n<ul>\n<li>配置文件分离（JSON&#x2F;YAML&#x2F;INI）</li>\n<li>环境变量</li>\n<li>命令行参数</li>\n<li>数据库配置存储</li>\n</ul>\n<hr>\n<h3 id=\"练习-2：为脚本添加日志与错误处理\"><a href=\"#练习-2：为脚本添加日志与错误处理\" class=\"headerlink\" title=\"练习 2：为脚本添加日志与错误处理\"></a>练习 2：为脚本添加日志与错误处理</h3><p><strong>任务</strong>：完善 <code>VersionDisclosureCheck</code> 的错误处理，添加重试机制。</p>\n<p><strong>思路提示</strong>：</p>\n<ul>\n<li>使用 <code>try-except</code> 捕获网络异常</li>\n<li>添加超时和重试次数限制</li>\n<li>记录详细的错误日志</li>\n</ul>\n<hr>\n<h3 id=\"练习-3：设计可扩展的检查插件系统\"><a href=\"#练习-3：设计可扩展的检查插件系统\" class=\"headerlink\" title=\"练习 3：设计可扩展的检查插件系统\"></a>练习 3：设计可扩展的检查插件系统</h3><p><strong>任务</strong>：设计一个插件加载机制，允许动态添加新的检查项。</p>\n<p><strong>思路提示</strong>：</p>\n<ul>\n<li>使用 Python 的 <code>importlib</code> 动态加载模块</li>\n<li>定义插件接口规范</li>\n<li>使用装饰器注册检查项</li>\n</ul>\n<hr>\n<h3 id=\"练习-4：生成-HTML-可视化报告\"><a href=\"#练习-4：生成-HTML-可视化报告\" class=\"headerlink\" title=\"练习 4：生成 HTML 可视化报告\"></a>练习 4：生成 HTML 可视化报告</h3><p><strong>任务</strong>：实现 HTML 报告生成器，提供交互式图表。</p>\n<p><strong>思路提示</strong>：</p>\n<ul>\n<li>使用 Jinja2 模板引擎</li>\n<li>集成 Chart.js 或 ECharts 生成图表</li>\n<li>使用 CSS 美化报告样式</li>\n</ul>\n<hr>\n<h2 id=\"评估标准（达成判定）\"><a href=\"#评估标准（达成判定）\" class=\"headerlink\" title=\"评估标准（达成判定）\"></a>评估标准（达成判定）</h2><ul>\n<li>✅ 项目目录结构清晰，模块分离合理</li>\n<li>✅ Web 检查模块能正确执行基础检查</li>\n<li>✅ CSV&#x2F;JSON 报告导出功能正常</li>\n<li>✅ 主程序支持命令行参数</li>\n<li>✅ 配置文件与代码分离，避免硬编码</li>\n<li>✅ 具备基本的日志记录和错误处理</li>\n</ul>\n<hr>\n<h2 id=\"学习成果达成情况（由学习者填写）\"><a href=\"#学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"学习成果达成情况（由学习者填写）\"></a>学习成果达成情况（由学习者填写）</h2><hr>\n<h3 id=\"截图与证据\"><a href=\"#截图与证据\" class=\"headerlink\" title=\"截图与证据\"></a>截图与证据</h3><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 项目目录结构截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> <code>config/targets.json</code> 配置文件内容</li>\n<li><input disabled=\"\" type=\"checkbox\"> 脚本运行输出截图（带实时检查结果）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 生成的 CSV 报告文件</li>\n<li><input disabled=\"\" type=\"checkbox\"> 生成的 JSON 报告文件</li>\n<li><input disabled=\"\" type=\"checkbox\"> 日志文件内容截图</li>\n</ul>\n<hr>\n<h3 id=\"关键命令与输出（粘贴关键片段）\"><a href=\"#关键命令与输出（粘贴关键片段）\" class=\"headerlink\" title=\"关键命令与输出（粘贴关键片段）\"></a>关键命令与输出（粘贴关键片段）</h3><p><strong>项目结构</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">baseline_checker/</span><br><span class=\"line\">├── config/</span><br><span class=\"line\">│   └── targets.json</span><br><span class=\"line\">├── checks/</span><br><span class=\"line\">│   ├── __init__.py</span><br><span class=\"line\">│   ├── base.py</span><br><span class=\"line\">│   └── web.py</span><br><span class=\"line\">├── reports/</span><br><span class=\"line\">│   ├── __init__.py</span><br><span class=\"line\">│   ├── csv_exporter.py</span><br><span class=\"line\">│   └── json_exporter.py</span><br><span class=\"line\">├── results/</span><br><span class=\"line\">│   ├── baseline_report_20260119_143000.csv</span><br><span class=\"line\">│   ├── baseline_report_20260119_143000.json</span><br><span class=\"line\">│   └── baseline_checker_20260119_143000.log</span><br><span class=\"line\">├── main.py</span><br><span class=\"line\">├── utils.py</span><br><span class=\"line\">└── requirements.txt</span><br></pre></td></tr></table></figure>\n\n<p><strong>运行脚本</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ python main.py --config config/targets.json --output results</span><br><span class=\"line\">加载了 1 个扫描目标</span><br><span class=\"line\"></span><br><span class=\"line\">============================================================</span><br><span class=\"line\">扫描目标: 本机测试 (web)</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">  ❌ [版本信息泄露] 发现版本信息泄露</span><br><span class=\"line\">  ❌ [安全响应头检查] 缺少 3 个安全响应头</span><br><span class=\"line\"></span><br><span class=\"line\">============================================================</span><br><span class=\"line\">报告生成完成！</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">✅ CSV 报告: results/baseline_report_20260119_143000.csv</span><br><span class=\"line\">✅ JSON 报告: results/baseline_report_20260119_143000.json</span><br><span class=\"line\"></span><br><span class=\"line\">总检查项: 2</span><br><span class=\"line\">通过: 0 ✅</span><br><span class=\"line\">失败: 2 ❌</span><br></pre></td></tr></table></figure>\n\n<p><strong>CSV 报告内容</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">目标名称,检查项,状态,风险等级,消息,建议,时间</span><br><span class=\"line\">本机测试,版本信息泄露,failed,medium,发现版本信息泄露,隐藏版本信息,2026-01-19 14:30:00</span><br><span class=\"line\">本机测试,安全响应头检查,failed,high,缺少 3 个安全响应头,配置以下响应头: X-Frame-Options, X-Content-Type-Options, X-XSS-Protection,2026-01-19 14:30:00</span><br></pre></td></tr></table></figure>\n\n<p><strong>JSON 报告内容</strong>：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;report_time&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2026-01-19T14:30:00&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;targets&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;本机测试&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;checks&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;版本信息泄露&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;status&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;failed&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;severity&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;medium&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;message&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;发现版本信息泄露&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;recommendation&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;隐藏版本信息&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;timestamp&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2026-01-19T14:30:00&quot;</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;安全响应头检查&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;status&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;failed&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;severity&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;high&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;message&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;缺少 3 个安全响应头&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;recommendation&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;配置以下响应头: X-Frame-Options, X-Content-Type-Options, X-XSS-Protection&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;timestamp&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2026-01-19T14:30:00&quot;</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">]</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"结论与反思\"><a href=\"#结论与反思\" class=\"headerlink\" title=\"结论与反思\"></a>结论与反思</h3><p><strong>我今天搞清楚了</strong>：</p>\n<ul>\n<li>模块化设计是编写可维护脚本的关键（基类、子类分离）</li>\n<li>配置文件与代码分离可以避免硬编码，提高灵活性</li>\n<li>结构化报告（CSV&#x2F;JSON）便于后续分析和自动化处理</li>\n<li>日志记录对于调试和审计非常重要</li>\n</ul>\n<p><strong>我差点搞混的是</strong>：</p>\n<ul>\n<li>最初不知道如何设计基类和子类的继承关系</li>\n<li>不确定应该用数据类（dataclass）还是普通类存储检查结果</li>\n<li>混淆了检查的”状态”（passed&#x2F;failed）和”风险等级”（critical&#x2F;high&#x2F;medium&#x2F;low）</li>\n</ul>\n<p><strong>明天我要继续补的是</strong>：</p>\n<ul>\n<li>学习 WAF（Web 应用防火墙）的原理与配置（Day027）</li>\n<li>了解常见 Web 漏洞（SQL 注入、XSS、CSRF）的检测与防护（Day028-030）</li>\n<li>学习安全报告模板化和可视化</li>\n</ul>\n<p><strong>本次学习耗时</strong>：约 4 小时</p>\n<p><strong>掌握程度自评</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 😕 理解了基本概念，但代码实现不熟练</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🙂 完成了基础任务</li>\n<li><input disabled=\"\" type=\"checkbox\"> 😃 完成了所有任务并理解原理</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🤩 实现了扩展功能（日志、重试、多目标扫描）</li>\n</ul>\n<hr>\n<h2 id=\"集中参考答案（含思路）\"><a href=\"#集中参考答案（含思路）\" class=\"headerlink\" title=\"集中参考答案（含思路）\"></a>集中参考答案（含思路）</h2><hr>\n<h3 id=\"练习-1-参考答案：如何避免脚本硬编码？\"><a href=\"#练习-1-参考答案：如何避免脚本硬编码？\" class=\"headerlink\" title=\"练习 1 参考答案：如何避免脚本硬编码？\"></a>练习 1 参考答案：如何避免脚本硬编码？</h3><p><strong>硬编码的问题</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ❌ 不推荐：硬编码</span></span><br><span class=\"line\">url = <span class=\"string\">&quot;http://192.168.1.10:8080&quot;</span></span><br><span class=\"line\">timeout = <span class=\"number\">10</span></span><br><span class=\"line\">api_key = <span class=\"string\">&quot;sk-abc123def456&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">check_server</span>():</span><br><span class=\"line\">    resp = requests.get(url, timeout=timeout, headers=&#123;<span class=\"string\">&quot;Authorization&quot;</span>: <span class=\"string\">f&quot;Bearer <span class=\"subst\">&#123;api_key&#125;</span>&quot;</span>&#125;)</span><br><span class=\"line\">    ...</span><br></pre></td></tr></table></figure>\n\n<p><strong>问题</strong>：</p>\n<ul>\n<li>目标变更需要修改代码</li>\n<li>敏感信息泄露风险（API Key、密码）</li>\n<li>不同环境（开发&#x2F;测试&#x2F;生产）需要不同配置</li>\n<li>代码复用性差</li>\n</ul>\n<hr>\n<p><strong>方案 1：配置文件（JSON&#x2F;YAML）</strong></p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;server&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;url&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;http://192.168.1.10:8080&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;timeout&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">10</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;auth&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;api_key&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;$&#123;API_KEY&#125;&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&quot;config.json&quot;</span>, <span class=\"string\">&quot;r&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">    config = json.load(f)</span><br><span class=\"line\"></span><br><span class=\"line\">url = config[<span class=\"string\">&quot;server&quot;</span>][<span class=\"string\">&quot;url&quot;</span>]</span><br><span class=\"line\">timeout = config[<span class=\"string\">&quot;server&quot;</span>][<span class=\"string\">&quot;timeout&quot;</span>]</span><br></pre></td></tr></table></figure>\n\n<hr>\n<p><strong>方案 2：环境变量</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># .env 文件（不提交到 Git）</span></span><br><span class=\"line\">API_KEY=sk-abc123def456</span><br><span class=\"line\">SERVER_URL=http://192.168.1.10:8080</span><br><span class=\"line\">TIMEOUT=10</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">from</span> dotenv <span class=\"keyword\">import</span> load_dotenv</span><br><span class=\"line\"></span><br><span class=\"line\">load_dotenv()</span><br><span class=\"line\"></span><br><span class=\"line\">api_key = os.getenv(<span class=\"string\">&quot;API_KEY&quot;</span>)</span><br><span class=\"line\">server_url = os.getenv(<span class=\"string\">&quot;SERVER_URL&quot;</span>)</span><br><span class=\"line\">timeout = <span class=\"built_in\">int</span>(os.getenv(<span class=\"string\">&quot;TIMEOUT&quot;</span>, <span class=\"string\">&quot;10&quot;</span>))  <span class=\"comment\"># 默认值</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<p><strong>方案 3：命令行参数</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> argparse</span><br><span class=\"line\"></span><br><span class=\"line\">parser = argparse.ArgumentParser()</span><br><span class=\"line\">parser.add_argument(<span class=\"string\">&quot;--url&quot;</span>, required=<span class=\"literal\">True</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;服务器 URL&quot;</span>)</span><br><span class=\"line\">parser.add_argument(<span class=\"string\">&quot;--timeout&quot;</span>, <span class=\"built_in\">type</span>=<span class=\"built_in\">int</span>, default=<span class=\"number\">10</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;超时时间&quot;</span>)</span><br><span class=\"line\">parser.add_argument(<span class=\"string\">&quot;--api-key&quot;</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;API 密钥&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">args = parser.parse_args()</span><br><span class=\"line\"></span><br><span class=\"line\">url = args.url</span><br><span class=\"line\">timeout = args.timeout</span><br><span class=\"line\">api_key = args.api_key</span><br></pre></td></tr></table></figure>\n\n<p><strong>最佳实践</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">优先级：命令行参数 &gt; 环境变量 &gt; 配置文件 &gt; 默认值</span><br><span class=\"line\"></span><br><span class=\"line\">┌─────────────────────────────────────┐</span><br><span class=\"line\">│         配置层次结构                 │</span><br><span class=\"line\">├─────────────────────────────────────┤</span><br><span class=\"line\">│ 1. 命令行参数（临时覆盖）           │</span><br><span class=\"line\">│ 2. 环境变量（敏感信息）             │</span><br><span class=\"line\">│ 3. 配置文件（常规配置）             │</span><br><span class=\"line\">│ 4. 代码默认值（兜底）               │</span><br><span class=\"line\">└─────────────────────────────────────┘</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"练习-2-参考答案：为脚本添加日志与错误处理\"><a href=\"#练习-2-参考答案：为脚本添加日志与错误处理\" class=\"headerlink\" title=\"练习 2 参考答案：为脚本添加日志与错误处理\"></a>练习 2 参考答案：为脚本添加日志与错误处理</h3><p>**改进后的 <code>VersionDisclosureCheck</code>**：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">from</span> typing <span class=\"keyword\">import</span> <span class=\"type\">Any</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> checks.base <span class=\"keyword\">import</span> BaseCheck, CheckResult, Severity, CheckStatus</span><br><span class=\"line\"><span class=\"keyword\">from</span> utils <span class=\"keyword\">import</span> get_logger</span><br><span class=\"line\"></span><br><span class=\"line\">logger = get_logger(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">VersionDisclosureCheck</span>(<span class=\"title class_ inherited__\">BaseCheck</span>):</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, max_retries: <span class=\"built_in\">int</span> = <span class=\"number\">3</span>, timeout: <span class=\"built_in\">int</span> = <span class=\"number\">10</span></span>):</span><br><span class=\"line\">        <span class=\"built_in\">super</span>().__init__(<span class=\"string\">&quot;版本信息泄露&quot;</span>, Severity.MEDIUM)</span><br><span class=\"line\">        self.max_retries = max_retries</span><br><span class=\"line\">        self.timeout = timeout</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">execute</span>(<span class=\"params\">self, target: <span class=\"built_in\">dict</span>[<span class=\"built_in\">str</span>, <span class=\"type\">Any</span>]</span>) -&gt; CheckResult:</span><br><span class=\"line\">        url = target[<span class=\"string\">&quot;url&quot;</span>]</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">for</span> attempt <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, self.max_retries + <span class=\"number\">1</span>):</span><br><span class=\"line\">            <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                logger.info(<span class=\"string\">f&quot;检查 <span class=\"subst\">&#123;url&#125;</span>（第 <span class=\"subst\">&#123;attempt&#125;</span>/<span class=\"subst\">&#123;self.max_retries&#125;</span> 次尝试）&quot;</span>)</span><br><span class=\"line\">                </span><br><span class=\"line\">                resp = requests.head(url, timeout=self.timeout)</span><br><span class=\"line\">                </span><br><span class=\"line\">                server = resp.headers.get(<span class=\"string\">&quot;Server&quot;</span>, <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">                x_powered = resp.headers.get(<span class=\"string\">&quot;X-Powered-By&quot;</span>, <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">                </span><br><span class=\"line\">                issues = []</span><br><span class=\"line\">                <span class=\"keyword\">if</span> server <span class=\"keyword\">and</span> <span class=\"built_in\">any</span>(char.isdigit() <span class=\"keyword\">for</span> char <span class=\"keyword\">in</span> server):</span><br><span class=\"line\">                    issues.append(<span class=\"string\">f&quot;Server: <span class=\"subst\">&#123;server&#125;</span>&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">if</span> x_powered:</span><br><span class=\"line\">                    issues.append(<span class=\"string\">f&quot;X-Powered-By: <span class=\"subst\">&#123;x_powered&#125;</span>&quot;</span>)</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"keyword\">if</span> issues:</span><br><span class=\"line\">                    logger.warning(<span class=\"string\">f&quot;<span class=\"subst\">&#123;url&#125;</span> 发现版本信息泄露: <span class=\"subst\">&#123;issues&#125;</span>&quot;</span>)</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> CheckResult(</span><br><span class=\"line\">                        check_name=self.name,</span><br><span class=\"line\">                        status=CheckStatus.FAILED,</span><br><span class=\"line\">                        severity=self.severity,</span><br><span class=\"line\">                        message=<span class=\"string\">f&quot;发现版本信息泄露&quot;</span>,</span><br><span class=\"line\">                        details=&#123;<span class=\"string\">&quot;issues&quot;</span>: issues&#125;,</span><br><span class=\"line\">                        recommendation=<span class=\"string\">&quot;隐藏版本信息&quot;</span></span><br><span class=\"line\">                    )</span><br><span class=\"line\">                </span><br><span class=\"line\">                logger.info(<span class=\"string\">f&quot;<span class=\"subst\">&#123;url&#125;</span> 版本信息检查通过&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> CheckResult(</span><br><span class=\"line\">                    check_name=self.name,</span><br><span class=\"line\">                    status=CheckStatus.PASSED,</span><br><span class=\"line\">                    severity=self.severity,</span><br><span class=\"line\">                    message=<span class=\"string\">&quot;未发现版本信息泄露&quot;</span></span><br><span class=\"line\">                )</span><br><span class=\"line\">                </span><br><span class=\"line\">            <span class=\"keyword\">except</span> requests.exceptions.Timeout:</span><br><span class=\"line\">                logger.warning(<span class=\"string\">f&quot;<span class=\"subst\">&#123;url&#125;</span> 请求超时（第 <span class=\"subst\">&#123;attempt&#125;</span> 次尝试）&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">if</span> attempt &lt; self.max_retries:</span><br><span class=\"line\">                    time.sleep(<span class=\"number\">2</span> ** attempt)  <span class=\"comment\"># 指数退避</span></span><br><span class=\"line\">                    <span class=\"keyword\">continue</span></span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    logger.error(<span class=\"string\">f&quot;<span class=\"subst\">&#123;url&#125;</span> 达到最大重试次数&quot;</span>)</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> CheckResult(</span><br><span class=\"line\">                        check_name=self.name,</span><br><span class=\"line\">                        status=CheckStatus.ERROR,</span><br><span class=\"line\">                        severity=self.severity,</span><br><span class=\"line\">                        message=<span class=\"string\">f&quot;请求超时（重试 <span class=\"subst\">&#123;self.max_retries&#125;</span> 次后仍失败）&quot;</span></span><br><span class=\"line\">                    )</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">except</span> requests.exceptions.ConnectionError <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                logger.error(<span class=\"string\">f&quot;<span class=\"subst\">&#123;url&#125;</span> 连接失败: <span class=\"subst\">&#123;<span class=\"built_in\">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> CheckResult(</span><br><span class=\"line\">                    check_name=self.name,</span><br><span class=\"line\">                    status=CheckStatus.ERROR,</span><br><span class=\"line\">                    severity=self.severity,</span><br><span class=\"line\">                    message=<span class=\"string\">f&quot;连接失败: <span class=\"subst\">&#123;<span class=\"built_in\">str</span>(e)&#125;</span>&quot;</span></span><br><span class=\"line\">                )</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                logger.error(<span class=\"string\">f&quot;<span class=\"subst\">&#123;url&#125;</span> 未知错误: <span class=\"subst\">&#123;<span class=\"built_in\">str</span>(e)&#125;</span>&quot;</span>, exc_info=<span class=\"literal\">True</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> CheckResult(</span><br><span class=\"line\">                    check_name=self.name,</span><br><span class=\"line\">                    status=CheckStatus.ERROR,</span><br><span class=\"line\">                    severity=self.severity,</span><br><span class=\"line\">                    message=<span class=\"string\">f&quot;检查失败: <span class=\"subst\">&#123;<span class=\"built_in\">str</span>(e)&#125;</span>&quot;</span></span><br><span class=\"line\">                )</span><br></pre></td></tr></table></figure>\n\n<p><strong>关键改进点</strong>：</p>\n<ol>\n<li><p><strong>重试机制</strong>：</p>\n<ul>\n<li>最大重试次数（<code>max_retries</code>）</li>\n<li>指数退避（每次重试间隔递增）</li>\n</ul>\n</li>\n<li><p><strong>详细的日志记录</strong>：</p>\n<ul>\n<li><code>logger.info</code>：常规信息</li>\n<li><code>logger.warning</code>：警告（如超时、检查失败）</li>\n<li><code>logger.error</code>：错误（如连接失败）</li>\n<li><code>exc_info=True</code>：记录异常堆栈</li>\n</ul>\n</li>\n<li><p><strong>异常分类处理</strong>：</p>\n<ul>\n<li><code>Timeout</code>：重试</li>\n<li><code>ConnectionError</code>：直接失败</li>\n<li>其他异常：记录堆栈</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h3 id=\"练习-3-参考答案：设计可扩展的检查插件系统\"><a href=\"#练习-3-参考答案：设计可扩展的检查插件系统\" class=\"headerlink\" title=\"练习 3 参考答案：设计可扩展的检查插件系统\"></a>练习 3 参考答案：设计可扩展的检查插件系统</h3><p><strong>插件接口定义（<code>checks/plugin_interface.py</code>）</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> abc <span class=\"keyword\">import</span> ABC, abstractmethod</span><br><span class=\"line\"><span class=\"keyword\">from</span> typing <span class=\"keyword\">import</span> <span class=\"type\">Any</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> checks.base <span class=\"keyword\">import</span> CheckResult</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">BaseCheckPlugin</span>(<span class=\"title class_ inherited__\">ABC</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;检查插件基类&quot;&quot;&quot;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 插件元数据</span></span><br><span class=\"line\">    name: <span class=\"built_in\">str</span> = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    description: <span class=\"built_in\">str</span> = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    version: <span class=\"built_in\">str</span> = <span class=\"string\">&quot;1.0.0&quot;</span></span><br><span class=\"line\">    enabled: <span class=\"built_in\">bool</span> = <span class=\"literal\">True</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"meta\">    @abstractmethod</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">execute</span>(<span class=\"params\">self, target: <span class=\"built_in\">dict</span>[<span class=\"built_in\">str</span>, <span class=\"type\">Any</span>]</span>) -&gt; CheckResult:</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;执行检查&quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">pass</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">init</span>(<span class=\"params\">self, config: <span class=\"built_in\">dict</span>[<span class=\"built_in\">str</span>, <span class=\"type\">Any</span>] | <span class=\"literal\">None</span> = <span class=\"literal\">None</span></span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;初始化插件（可选）&quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">pass</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>插件注册装饰器（<code>checks/registry.py</code>）</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> functools <span class=\"keyword\">import</span> wraps</span><br><span class=\"line\"><span class=\"keyword\">from</span> typing <span class=\"keyword\">import</span> <span class=\"type\">Callable</span>, <span class=\"type\">Type</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> checks.plugin_interface <span class=\"keyword\">import</span> BaseCheckPlugin</span><br><span class=\"line\"></span><br><span class=\"line\">_CHECK_PLUGINS: <span class=\"built_in\">dict</span>[<span class=\"built_in\">str</span>, <span class=\"type\">Type</span>[BaseCheckPlugin]] = &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">register_check</span>(<span class=\"params\">name: <span class=\"built_in\">str</span></span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;插件注册装饰器&quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">decorator</span>(<span class=\"params\">cls: <span class=\"type\">Type</span>[BaseCheckPlugin]</span>):</span><br><span class=\"line\">        cls.name = name</span><br><span class=\"line\">        _CHECK_PLUGINS[name] = cls</span><br><span class=\"line\">        <span class=\"keyword\">return</span> cls</span><br><span class=\"line\">    <span class=\"keyword\">return</span> decorator</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_check</span>(<span class=\"params\">name: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"type\">Type</span>[BaseCheckPlugin] | <span class=\"literal\">None</span>:</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;获取检查插件&quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> _CHECK_PLUGINS.get(name)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">list_checks</span>() -&gt; <span class=\"built_in\">list</span>[<span class=\"built_in\">str</span>]:</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;列出所有可用检查&quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">list</span>(_CHECK_PLUGINS.keys())</span><br></pre></td></tr></table></figure>\n\n<p><strong>动态加载插件（<code>checks/loader.py</code>）</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> importlib</span><br><span class=\"line\"><span class=\"keyword\">import</span> pkgutil</span><br><span class=\"line\"><span class=\"keyword\">from</span> pathlib <span class=\"keyword\">import</span> Path</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> checks.registry <span class=\"keyword\">import</span> list_checks</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">load_plugins</span>(<span class=\"params\">module_name: <span class=\"built_in\">str</span> = <span class=\"string\">&quot;checks.plugins&quot;</span></span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;动态加载所有插件</span></span><br><span class=\"line\"><span class=\"string\">    </span></span><br><span class=\"line\"><span class=\"string\">    Args:</span></span><br><span class=\"line\"><span class=\"string\">        module_name: 插件模块包名</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        package = importlib.import_module(module_name)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">for</span> _, name, _ <span class=\"keyword\">in</span> pkgutil.iter_modules(package.__path__):</span><br><span class=\"line\">            <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                importlib.import_module(<span class=\"string\">f&quot;<span class=\"subst\">&#123;module_name&#125;</span>.<span class=\"subst\">&#123;name&#125;</span>&quot;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;⚠️  加载插件 <span class=\"subst\">&#123;name&#125;</span> 失败: <span class=\"subst\">&#123;e&#125;</span>&quot;</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;✅ 已加载 <span class=\"subst\">&#123;<span class=\"built_in\">len</span>(list_checks())&#125;</span> 个检查插件&quot;</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"keyword\">except</span> ImportError:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;⚠️  插件模块 <span class=\"subst\">&#123;module_name&#125;</span> 不存在&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<p><strong>示例插件（<code>checks/plugins/custom_check.py</code>）</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> checks.plugin_interface <span class=\"keyword\">import</span> BaseCheckPlugin</span><br><span class=\"line\"><span class=\"keyword\">from</span> checks.base <span class=\"keyword\">import</span> CheckStatus, Severity, CheckResult</span><br><span class=\"line\"><span class=\"keyword\">from</span> checks.registry <span class=\"keyword\">import</span> register_check</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@register_check(<span class=\"params\"><span class=\"string\">&quot;自定义HTTP检查&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">CustomHTTPCheck</span>(<span class=\"title class_ inherited__\">BaseCheckPlugin</span>):</span><br><span class=\"line\">    description = <span class=\"string\">&quot;检查自定义 HTTP 响应特征&quot;</span></span><br><span class=\"line\">    version = <span class=\"string\">&quot;1.0.0&quot;</span></span><br><span class=\"line\">    enabled = <span class=\"literal\">True</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">init</span>(<span class=\"params\">self, config: <span class=\"built_in\">dict</span> | <span class=\"literal\">None</span> = <span class=\"literal\">None</span></span>):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> config:</span><br><span class=\"line\">            self.custom_headers = config.get(<span class=\"string\">&quot;headers&quot;</span>, &#123;&#125;)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            self.custom_headers = &#123;&#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">execute</span>(<span class=\"params\">self, target: <span class=\"built_in\">dict</span></span>) -&gt; CheckResult:</span><br><span class=\"line\">        url = target[<span class=\"string\">&quot;url&quot;</span>]</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            resp = requests.get(url, headers=self.custom_headers, timeout=<span class=\"number\">10</span>)</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\"># 自定义检查逻辑</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> resp.status_code == <span class=\"number\">200</span> <span class=\"keyword\">and</span> <span class=\"string\">&quot;custom_flag&quot;</span> <span class=\"keyword\">in</span> resp.text:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> CheckResult(</span><br><span class=\"line\">                    check_name=self.name,</span><br><span class=\"line\">                    status=CheckStatus.PASSED,</span><br><span class=\"line\">                    severity=Severity.LOW,</span><br><span class=\"line\">                    message=<span class=\"string\">&quot;自定义检查通过&quot;</span></span><br><span class=\"line\">                )</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> CheckResult(</span><br><span class=\"line\">                    check_name=self.name,</span><br><span class=\"line\">                    status=CheckStatus.FAILED,</span><br><span class=\"line\">                    severity=Severity.MEDIUM,</span><br><span class=\"line\">                    message=<span class=\"string\">&quot;自定义检查失败&quot;</span>,</span><br><span class=\"line\">                    recommendation=<span class=\"string\">&quot;检查响应内容&quot;</span></span><br><span class=\"line\">                )</span><br><span class=\"line\">                </span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> CheckResult(</span><br><span class=\"line\">                check_name=self.name,</span><br><span class=\"line\">                status=CheckStatus.ERROR,</span><br><span class=\"line\">                severity=Severity.LOW,</span><br><span class=\"line\">                message=<span class=\"string\">f&quot;检查失败: <span class=\"subst\">&#123;<span class=\"built_in\">str</span>(e)&#125;</span>&quot;</span></span><br><span class=\"line\">            )</span><br></pre></td></tr></table></figure>\n\n<p><strong>使用示例</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 加载所有插件</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> checks.loader <span class=\"keyword\">import</span> load_plugins</span><br><span class=\"line\"><span class=\"keyword\">from</span> checks.registry <span class=\"keyword\">import</span> get_check</span><br><span class=\"line\"></span><br><span class=\"line\">load_plugins(<span class=\"string\">&quot;checks.plugins&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 获取并实例化插件</span></span><br><span class=\"line\">check_class = get_check(<span class=\"string\">&quot;自定义HTTP检查&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">if</span> check_class:</span><br><span class=\"line\">    check_instance = check_class()</span><br><span class=\"line\">    result = check_instance.execute(&#123;<span class=\"string\">&quot;url&quot;</span>: <span class=\"string\">&quot;http://example.com&quot;</span>&#125;)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(result)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"练习-4-参考答案：生成-HTML-可视化报告\"><a href=\"#练习-4-参考答案：生成-HTML-可视化报告\" class=\"headerlink\" title=\"练习 4 参考答案：生成 HTML 可视化报告\"></a>练习 4 参考答案：生成 HTML 可视化报告</h3><p><strong>HTML 模板（<code>reports/template.html</code>）</strong>：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>基线检查报告<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;https://cdn.jsdelivr.net/npm/chart.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-tag\">body</span> &#123; <span class=\"attribute\">font-family</span>: Arial, sans-serif; <span class=\"attribute\">margin</span>: <span class=\"number\">20px</span>; &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.summary</span> &#123; <span class=\"attribute\">display</span>: flex; <span class=\"attribute\">gap</span>: <span class=\"number\">20px</span>; <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">30px</span>; &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.card</span> &#123; <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#ddd</span>; <span class=\"attribute\">padding</span>: <span class=\"number\">20px</span>; <span class=\"attribute\">border-radius</span>: <span class=\"number\">8px</span>; <span class=\"attribute\">flex</span>: <span class=\"number\">1</span>; &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.card</span> <span class=\"selector-tag\">h3</span> &#123; <span class=\"attribute\">margin-top</span>: <span class=\"number\">0</span>; &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.passed</span> &#123; <span class=\"attribute\">color</span>: <span class=\"number\">#28a745</span>; &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.failed</span> &#123; <span class=\"attribute\">color</span>: <span class=\"number\">#dc3545</span>; &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.error</span> &#123; <span class=\"attribute\">color</span>: <span class=\"number\">#6c757d</span>; &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.target-section</span> &#123; <span class=\"attribute\">margin-bottom</span>: <span class=\"number\">40px</span>; &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.check-row</span> &#123; <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>; <span class=\"attribute\">border-bottom</span>: <span class=\"number\">1px</span> solid <span class=\"number\">#eee</span>; &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.severity-critical</span> &#123; <span class=\"attribute\">border-left</span>: <span class=\"number\">4px</span> solid <span class=\"number\">#dc3545</span>; &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.severity-high</span> &#123; <span class=\"attribute\">border-left</span>: <span class=\"number\">4px</span> solid <span class=\"number\">#fd7e14</span>; &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.severity-medium</span> &#123; <span class=\"attribute\">border-left</span>: <span class=\"number\">4px</span> solid <span class=\"number\">#ffc107</span>; &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">        <span class=\"selector-class\">.severity-low</span> &#123; <span class=\"attribute\">border-left</span>: <span class=\"number\">4px</span> solid <span class=\"number\">#28a745</span>; &#125;</span></span><br><span class=\"line\"><span class=\"language-css\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>基线检查报告<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>生成时间: &#123;&#123; report_time &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;summary&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;card&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>总览<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>目标数量: &#123;&#123; summary.total_targets &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>总检查项: &#123;&#123; summary.total_checks &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>通过: <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;passed&quot;</span>&gt;</span>&#123;&#123; summary.passed &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>失败: <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;failed&quot;</span>&gt;</span>&#123;&#123; summary.failed &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>通过率: &#123;&#123; summary.pass_rate &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;card&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">h3</span>&gt;</span>风险分布<span class=\"tag\">&lt;/<span class=\"name\">h3</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">canvas</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;severityChart&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">canvas</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    &#123;% for target in targets %&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;target-section&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h2</span>&gt;</span>&#123;&#123; target.name &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">h2</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">thead</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>检查项<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>状态<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>风险等级<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>消息<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">th</span>&gt;</span>建议<span class=\"tag\">&lt;/<span class=\"name\">th</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">thead</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">tbody</span>&gt;</span></span><br><span class=\"line\">                &#123;% for check in target.checks %&#125;</span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">tr</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;check-row severity-&#123;&#123; check.severity &#125;&#125;&quot;</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123; check.name &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">td</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;&#123;&#123; check.status &#125;&#125;&quot;</span>&gt;</span>&#123;&#123; check.status &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123; check.severity &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123; check.message &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>&#123;&#123; check.recommendation or &#x27;-&#x27; &#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></span><br><span class=\"line\">                &#123;% endfor %&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">tbody</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    &#123;% endfor %&#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">const</span> ctx = <span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementById</span>(<span class=\"string\">&#x27;severityChart&#x27;</span>).<span class=\"title function_\">getContext</span>(<span class=\"string\">&#x27;2d&#x27;</span>);</span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Chart</span>(ctx, &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"attr\">type</span>: <span class=\"string\">&#x27;doughnut&#x27;</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"attr\">data</span>: &#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"attr\">labels</span>: [<span class=\"string\">&#x27;严重&#x27;</span>, <span class=\"string\">&#x27;高危&#x27;</span>, <span class=\"string\">&#x27;中危&#x27;</span>, <span class=\"string\">&#x27;低危&#x27;</span>],</span></span><br><span class=\"line\"><span class=\"language-javascript\">                <span class=\"attr\">datasets</span>: [&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"attr\">data</span>: [</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        &#123;&#123; summary.<span class=\"property\">critical_count</span> &#125;&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        &#123;&#123; summary.<span class=\"property\">high_count</span> &#125;&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        &#123;&#123; summary.<span class=\"property\">medium_count</span> &#125;&#125;,</span></span><br><span class=\"line\"><span class=\"language-javascript\">                        &#123;&#123; summary.<span class=\"property\">low_count</span> &#125;&#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    ],</span></span><br><span class=\"line\"><span class=\"language-javascript\">                    <span class=\"attr\">backgroundColor</span>: [<span class=\"string\">&#x27;#dc3545&#x27;</span>, <span class=\"string\">&#x27;#fd7e14&#x27;</span>, <span class=\"string\">&#x27;#ffc107&#x27;</span>, <span class=\"string\">&#x27;#28a745&#x27;</span>]</span></span><br><span class=\"line\"><span class=\"language-javascript\">                &#125;]</span></span><br><span class=\"line\"><span class=\"language-javascript\">            &#125;</span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>HTML 生成器（<code>reports/html_generator.py</code>）</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> pathlib <span class=\"keyword\">import</span> Path</span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"><span class=\"keyword\">from</span> typing <span class=\"keyword\">import</span> <span class=\"type\">Any</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> jinja2 <span class=\"keyword\">import</span> Template</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> checks.base <span class=\"keyword\">import</span> CheckResult</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">HTMLGenerator</span>:</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, template_path: <span class=\"built_in\">str</span>, output_dir: <span class=\"built_in\">str</span> = <span class=\"string\">&quot;results&quot;</span></span>):</span><br><span class=\"line\">        self.template_path = Path(template_path)</span><br><span class=\"line\">        self.output_dir = Path(output_dir)</span><br><span class=\"line\">        self.output_dir.mkdir(exist_ok=<span class=\"literal\">True</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(self.template_path, <span class=\"string\">&quot;r&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">            self.template = Template(f.read())</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">generate</span>(<span class=\"params\">self, results: <span class=\"built_in\">list</span>[<span class=\"built_in\">tuple</span>[<span class=\"built_in\">str</span>, <span class=\"built_in\">list</span>[CheckResult]]], filename: <span class=\"built_in\">str</span> | <span class=\"literal\">None</span> = <span class=\"literal\">None</span></span>) -&gt; <span class=\"built_in\">str</span>:</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;生成 HTML 报告&quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> filename <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            filename = <span class=\"string\">f&quot;baseline_report_<span class=\"subst\">&#123;datetime.now().strftime(<span class=\"string\">&#x27;%Y%m%d_%H%M%S&#x27;</span>)&#125;</span>.html&quot;</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        filepath = self.output_dir / filename</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># 统计汇总数据</span></span><br><span class=\"line\">        summary = self._generate_summary(results)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># 准备目标数据</span></span><br><span class=\"line\">        targets_data = []</span><br><span class=\"line\">        <span class=\"keyword\">for</span> target_name, check_results <span class=\"keyword\">in</span> results:</span><br><span class=\"line\">            targets_data.append(&#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;name&quot;</span>: target_name,</span><br><span class=\"line\">                <span class=\"string\">&quot;checks&quot;</span>: [</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"string\">&quot;name&quot;</span>: r.check_name,</span><br><span class=\"line\">                        <span class=\"string\">&quot;status&quot;</span>: r.status.value,</span><br><span class=\"line\">                        <span class=\"string\">&quot;severity&quot;</span>: r.severity.value,</span><br><span class=\"line\">                        <span class=\"string\">&quot;message&quot;</span>: r.message,</span><br><span class=\"line\">                        <span class=\"string\">&quot;recommendation&quot;</span>: r.recommendation</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> r <span class=\"keyword\">in</span> check_results</span><br><span class=\"line\">                ]</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># 渲染模板</span></span><br><span class=\"line\">        html_content = self.template.render(</span><br><span class=\"line\">            report_time=datetime.now().strftime(<span class=\"string\">&quot;%Y-%m-%d %H:%M:%S&quot;</span>),</span><br><span class=\"line\">            summary=summary,</span><br><span class=\"line\">            targets=targets_data</span><br><span class=\"line\">        )</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(filepath, <span class=\"string\">&quot;w&quot;</span>, encoding=<span class=\"string\">&quot;utf-8&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">            f.write(html_content)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">str</span>(filepath)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">_generate_summary</span>(<span class=\"params\">self, results: <span class=\"built_in\">list</span>[<span class=\"built_in\">tuple</span>[<span class=\"built_in\">str</span>, <span class=\"built_in\">list</span>[CheckResult]]]</span>) -&gt; <span class=\"built_in\">dict</span>[<span class=\"built_in\">str</span>, <span class=\"type\">Any</span>]:</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;生成汇总数据&quot;&quot;&quot;</span></span><br><span class=\"line\">        total_targets = <span class=\"built_in\">len</span>(results)</span><br><span class=\"line\">        total_checks = <span class=\"built_in\">sum</span>(<span class=\"built_in\">len</span>(checks) <span class=\"keyword\">for</span> _, checks <span class=\"keyword\">in</span> results)</span><br><span class=\"line\">        total_passed = <span class=\"built_in\">sum</span>(<span class=\"number\">1</span> <span class=\"keyword\">for</span> _, checks <span class=\"keyword\">in</span> results <span class=\"keyword\">for</span> r <span class=\"keyword\">in</span> checks <span class=\"keyword\">if</span> r.status.value == <span class=\"string\">&quot;passed&quot;</span>)</span><br><span class=\"line\">        total_failed = <span class=\"built_in\">sum</span>(<span class=\"number\">1</span> <span class=\"keyword\">for</span> _, checks <span class=\"keyword\">in</span> results <span class=\"keyword\">for</span> r <span class=\"keyword\">in</span> checks <span class=\"keyword\">if</span> r.status.value == <span class=\"string\">&quot;failed&quot;</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># 风险等级统计</span></span><br><span class=\"line\">        severity_counts = &#123;<span class=\"string\">&quot;critical&quot;</span>: <span class=\"number\">0</span>, <span class=\"string\">&quot;high&quot;</span>: <span class=\"number\">0</span>, <span class=\"string\">&quot;medium&quot;</span>: <span class=\"number\">0</span>, <span class=\"string\">&quot;low&quot;</span>: <span class=\"number\">0</span>&#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> _, checks <span class=\"keyword\">in</span> results:</span><br><span class=\"line\">            <span class=\"keyword\">for</span> r <span class=\"keyword\">in</span> checks:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> r.status.value == <span class=\"string\">&quot;failed&quot;</span>:</span><br><span class=\"line\">                    severity_counts[r.severity.value] += <span class=\"number\">1</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;total_targets&quot;</span>: total_targets,</span><br><span class=\"line\">            <span class=\"string\">&quot;total_checks&quot;</span>: total_checks,</span><br><span class=\"line\">            <span class=\"string\">&quot;passed&quot;</span>: total_passed,</span><br><span class=\"line\">            <span class=\"string\">&quot;failed&quot;</span>: total_failed,</span><br><span class=\"line\">            <span class=\"string\">&quot;pass_rate&quot;</span>: <span class=\"string\">f&quot;<span class=\"subst\">&#123;total_passed / total_checks * <span class=\"number\">100</span>:<span class=\"number\">.1</span>f&#125;</span>%&quot;</span> <span class=\"keyword\">if</span> total_checks &gt; <span class=\"number\">0</span> <span class=\"keyword\">else</span> <span class=\"string\">&quot;N/A&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;critical_count&quot;</span>: severity_counts[<span class=\"string\">&quot;critical&quot;</span>],</span><br><span class=\"line\">            <span class=\"string\">&quot;high_count&quot;</span>: severity_counts[<span class=\"string\">&quot;high&quot;</span>],</span><br><span class=\"line\">            <span class=\"string\">&quot;medium_count&quot;</span>: severity_counts[<span class=\"string\">&quot;medium&quot;</span>],</span><br><span class=\"line\">            <span class=\"string\">&quot;low_count&quot;</span>: severity_counts[<span class=\"string\">&quot;low&quot;</span>]</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"学习成果示例填写（可照抄）\"><a href=\"#学习成果示例填写（可照抄）\" class=\"headerlink\" title=\"学习成果示例填写（可照抄）\"></a>学习成果示例填写（可照抄）</h2><blockquote>\n<p>可将”示例”内容替换为你自己的时间与截图文件名。</p>\n</blockquote>\n<hr>\n<h3 id=\"截图与证据（示例）\"><a href=\"#截图与证据（示例）\" class=\"headerlink\" title=\"截图与证据（示例）\"></a>截图与证据（示例）</h3><ul>\n<li>项目结构：<code>images/day026_project_structure.png</code></li>\n<li>配置文件：<code>images/day026_config_json.png</code></li>\n<li>脚本运行：<code>images/day026_script_output.png</code></li>\n<li>CSV 报告：<code>images/day026_csv_report.png</code></li>\n<li>JSON 报告：<code>images/day026_json_report.png</code></li>\n</ul>\n<hr>\n<h3 id=\"关键命令与输出（示例）\"><a href=\"#关键命令与输出（示例）\" class=\"headerlink\" title=\"关键命令与输出（示例）\"></a>关键命令与输出（示例）</h3><p><strong>项目初始化</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">mkdir</span> baseline_checker &amp;&amp; <span class=\"built_in\">cd</span> baseline_checker</span><br><span class=\"line\">$ <span class=\"built_in\">mkdir</span> config checks reports results</span><br><span class=\"line\">$ <span class=\"built_in\">type</span> nul &gt; checks\\__init__.py</span><br><span class=\"line\">$ <span class=\"built_in\">type</span> nul &gt; reports\\__init__.py</span><br><span class=\"line\"></span><br><span class=\"line\">$ <span class=\"built_in\">echo</span> requests &gt; requirements.txt</span><br><span class=\"line\">$ pip install -r requirements.txt</span><br></pre></td></tr></table></figure>\n\n<p><strong>运行基线检查</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ python main.py --config config/targets.json --output results</span><br><span class=\"line\">加载了 1 个扫描目标</span><br><span class=\"line\"></span><br><span class=\"line\">============================================================</span><br><span class=\"line\">扫描目标: 本机测试 (web)</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">  ❌ [版本信息泄露] 发现版本信息泄露</span><br><span class=\"line\">  ❌ [安全响应头检查] 缺少 3 个安全响应头</span><br><span class=\"line\"></span><br><span class=\"line\">============================================================</span><br><span class=\"line\">报告生成完成！</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">✅ CSV 报告: results/baseline_report_20260119_143000.csv</span><br><span class=\"line\">✅ JSON 报告: results/baseline_report_20260119_143000.json</span><br><span class=\"line\"></span><br><span class=\"line\">总检查项: 2</span><br><span class=\"line\">通过: 0 ✅</span><br><span class=\"line\">失败: 2 ❌</span><br></pre></td></tr></table></figure>\n\n<p><strong>日志文件内容</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">2026-01-19 14:30:00 - baseline_checker - INFO - 基线检查工具启动</span><br><span class=\"line\">2026-01-19 14:30:00 - baseline_checker - INFO - 配置文件: config/targets.json</span><br><span class=\"line\">2026-01-19 14:30:00 - baseline_checker - INFO - 输出目录: results</span><br><span class=\"line\">2026-01-19 14:30:00 - baseline_checker - INFO - 加载了 1 个扫描目标</span><br><span class=\"line\">2026-01-19 14:30:00 - baseline_checker - INFO - 检查 http://localhost:8080（第 1/3 次尝试）</span><br><span class=\"line\">2026-01-19 14:30:00 - baseline_checker - WARNING - http://localhost:8080 发现版本信息泄露: [&#x27;Server: nginx/1.18.0&#x27;]</span><br><span class=\"line\">2026-01-19 14:30:00 - baseline_checker - INFO - 检查完成</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"结论与反思（示例）\"><a href=\"#结论与反思（示例）\" class=\"headerlink\" title=\"结论与反思（示例）\"></a>结论与反思（示例）</h3><p><strong>我今天搞清楚了</strong>：</p>\n<ul>\n<li>模块化设计是构建可维护自动化工具的关键</li>\n<li>配置与代码分离可以避免硬编码，提高灵活性</li>\n<li>日志记录对于调试、审计和问题排查非常重要</li>\n<li>结构化报告（CSV&#x2F;JSON&#x2F;HTML）便于后续分析和可视化</li>\n</ul>\n<p><strong>我差点搞混的是</strong>：</p>\n<ul>\n<li>最初不理解为什么需要基类和子类的继承关系</li>\n<li>混淆了检查的”状态”（passed&#x2F;failed）和”风险等级”（critical&#x2F;high&#x2F;medium&#x2F;low）</li>\n<li>不确定如何实现插件加载机制，后来学习了 <code>importlib</code> 和装饰器模式</li>\n</ul>\n<p><strong>明天我要继续补的是</strong>：</p>\n<ul>\n<li>学习 WAF（Web 应用防火墙）的原理与配置（Day027）</li>\n<li>了解常见 Web 漏洞（SQL 注入、XSS、CSRF）的检测与防护（Day028-030）</li>\n<li>学习安全报告的自动化发送和告警</li>\n</ul>\n<p><strong>本次学习耗时</strong>：约 4.5 小时</p>\n<p><strong>掌握程度自评</strong>：</p>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> 😃 完成了所有任务并理解原理</li>\n</ul>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day025：漏洞扫描与基线 - Web 中间件暴露面与加固","url":"/post/a67b221d.html","content":"<h1 id=\"Day025：漏洞扫描与基线-Web-中间件暴露面与加固\"><a href=\"#Day025：漏洞扫描与基线-Web-中间件暴露面与加固\" class=\"headerlink\" title=\"Day025：漏洞扫描与基线 - Web 中间件暴露面与加固\"></a>Day025：漏洞扫描与基线 - Web 中间件暴露面与加固</h1><ul>\n<li>日期：2026-01-18</li>\n<li>周次：第4周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p>今天你将掌握：</p>\n<ul>\n<li><strong>识别常见中间件的默认配置风险</strong>：Nginx&#x2F;Apache&#x2F;IIS 的目录列出、版本信息泄露、默认配置弱点</li>\n<li><strong>能给出基础加固建议</strong>：关闭目录列出、隐藏版本号、限制 HTTP 方法、配置安全响应头</li>\n<li><strong>能独立修改中间件配置</strong>：在合法靶场环境或测试环境中验证加固效果</li>\n<li><strong>理解常见 Web 漏洞与配置的关系</strong>：如敏感信息泄露、路径遍历、未授权访问</li>\n</ul>\n<hr>\n<span id=\"more\"></span>\n\n<h2 id=\"学习内容\"><a href=\"#学习内容\" class=\"headerlink\" title=\"学习内容\"></a>学习内容</h2><h3 id=\"1️⃣-Web-中间件常见暴露面\"><a href=\"#1️⃣-Web-中间件常见暴露面\" class=\"headerlink\" title=\"1️⃣ Web 中间件常见暴露面\"></a>1️⃣ Web 中间件常见暴露面</h3><h4 id=\"1-1-目录列出（Directory-Listing）\"><a href=\"#1-1-目录列出（Directory-Listing）\" class=\"headerlink\" title=\"1.1 目录列出（Directory Listing）\"></a>1.1 目录列出（Directory Listing）</h4><p><strong>风险说明</strong>：</p>\n<p>当目录列出功能开启时，攻击者可以直接浏览网站目录结构，可能发现：</p>\n<ul>\n<li>备份文件（<code>.bak</code>、<code>.sql</code>、<code>.zip</code>）</li>\n<li>配置文件（<code>config.php</code>、<code>database.yml</code>）</li>\n<li>敏感目录（<code>admin</code>、<code>uploads</code>、<code>logs</code>）</li>\n<li>源代码文件</li>\n</ul>\n<p><strong>各中间件配置对比</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>中间件</th>\n<th>默认行为</th>\n<th>配置文件</th>\n<th>关闭命令</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Nginx</strong></td>\n<td>默认关闭</td>\n<td><code>nginx.conf</code> &#x2F; 站点配置</td>\n<td><code>autoindex off;</code></td>\n</tr>\n<tr>\n<td><strong>Apache</strong></td>\n<td>默认开启</td>\n<td><code>httpd.conf</code> &#x2F; <code>.htaccess</code></td>\n<td><code>Options -Indexes</code></td>\n</tr>\n<tr>\n<td><strong>IIS</strong></td>\n<td>需手动开启</td>\n<td><code>web.config</code> &#x2F; IIS 管理器</td>\n<td><code>&lt;directoryBrowse enabled=&quot;false&quot; /&gt;</code></td>\n</tr>\n</tbody></table>\n<p><strong>实际危害案例</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">http://example.com/uploads/</span><br><span class=\"line\">├── backup_202501.zip        # 完整网站备份</span><br><span class=\"line\">├── database_dump.sql         # 数据库导出文件</span><br><span class=\"line\">└── old_files/                # 旧版本源代码</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"1-2-版本信息泄露（Version-Disclosure）\"><a href=\"#1-2-版本信息泄露（Version-Disclosure）\" class=\"headerlink\" title=\"1.2 版本信息泄露（Version Disclosure）\"></a>1.2 版本信息泄露（Version Disclosure）</h4><p><strong>风险说明</strong>：</p>\n<p>暴露中间件版本号可以帮助攻击者：</p>\n<ul>\n<li>搜索已知 CVE 漏洞</li>\n<li>定制特定版本的攻击 payload</li>\n<li>评估目标系统维护状况</li>\n</ul>\n<p><strong>检测方法</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 使用 curl 查看响应头</span></span><br><span class=\"line\">curl -I http://example.com</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 典型暴露示例（不安全）</span></span><br><span class=\"line\">Server: nginx/1.18.0</span><br><span class=\"line\">Server: Apache/2.4.41 (Ubuntu)</span><br><span class=\"line\">X-Powered-By: PHP/8.1.2</span><br></pre></td></tr></table></figure>\n\n<p><strong>各中间件隐藏版本配置</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>中间件</th>\n<th>配置项</th>\n<th>配置示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Nginx</strong></td>\n<td><code>server_tokens</code></td>\n<td><code>server_tokens off;</code></td>\n</tr>\n<tr>\n<td><strong>Apache</strong></td>\n<td><code>ServerTokens</code></td>\n<td><code>ServerTokens Prod</code></td>\n</tr>\n<tr>\n<td><strong>Apache</strong></td>\n<td><code>ServerSignature</code></td>\n<td><code>ServerSignature Off</code></td>\n</tr>\n<tr>\n<td><strong>IIS</strong></td>\n<td>自定义响应头</td>\n<td><code>Remove-WebManagedHandler</code> &#x2F; 修改 URL Rewrite</td>\n</tr>\n</tbody></table>\n<p><strong>Nginx 隐藏版本示例</strong>：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># nginx.conf http 区块</span></span><br><span class=\"line\"><span class=\"section\">http</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">server_tokens</span> <span class=\"literal\">off</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 额外：隐藏 X-Powered-By 头</span></span><br><span class=\"line\">    <span class=\"attribute\">proxy_hide_header</span> X-Powered-By;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"1-3-HTTP-方法限制（HTTP-Method-Restrictions）\"><a href=\"#1-3-HTTP-方法限制（HTTP-Method-Restrictions）\" class=\"headerlink\" title=\"1.3 HTTP 方法限制（HTTP Method Restrictions）\"></a>1.3 HTTP 方法限制（HTTP Method Restrictions）</h4><p><strong>常见 HTTP 方法与风险</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>方法</th>\n<th>用途</th>\n<th>公开访问风险</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>GET</strong></td>\n<td>获取资源</td>\n<td>✅ 允许</td>\n</tr>\n<tr>\n<td><strong>POST</strong></td>\n<td>提交数据</td>\n<td>✅ 允许</td>\n</tr>\n<tr>\n<td><strong>HEAD</strong></td>\n<td>获取响应头</td>\n<td>⚠️ 信息泄露</td>\n</tr>\n<tr>\n<td><strong>OPTIONS</strong></td>\n<td>查询可用方法</td>\n<td>⚠️ 暴露服务端能力</td>\n</tr>\n<tr>\n<td><strong>PUT&#x2F;DELETE</strong></td>\n<td>上传&#x2F;删除文件</td>\n<td>🚨 文件操作漏洞</td>\n</tr>\n<tr>\n<td><strong>TRACE</strong></td>\n<td>回显请求（用于调试）</td>\n<td>🚨 跨站追踪攻击（XST）</td>\n</tr>\n<tr>\n<td><strong>PATCH</strong></td>\n<td>部分更新资源</td>\n<td>⚠️ 需要认证</td>\n</tr>\n</tbody></table>\n<p><strong>配置限制方法</strong>：</p>\n<p><strong>Nginx</strong>：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\"># 只允许 GET POST HEAD</span></span><br><span class=\"line\">    <span class=\"attribute\">if</span> (<span class=\"variable\">$request_method</span> !<span class=\"regexp\">~ ^(GET|POST|HEAD)$</span> ) &#123;</span><br><span class=\"line\">        <span class=\"attribute\">return</span> <span class=\"number\">405</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 禁止 TRACE</span></span><br><span class=\"line\">    <span class=\"attribute\">if</span> (<span class=\"variable\">$request_method</span> = TRACE ) &#123;</span><br><span class=\"line\">        <span class=\"attribute\">return</span> <span class=\"number\">403</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>Apache</strong>：</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 禁止 TRACE 和 TRACK</span></span><br><span class=\"line\"><span class=\"attribute\">TraceEnable</span> <span class=\"literal\">Off</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 限制允许的方法</span></span><br><span class=\"line\"><span class=\"section\">&lt;LimitExcept GET POST HEAD&gt;</span></span><br><span class=\"line\">    <span class=\"attribute\">Require</span> <span class=\"literal\">all</span> denied</span><br><span class=\"line\"><span class=\"section\">&lt;/LimitExcept&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>IIS</strong>：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">system.webServer</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">handlers</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">remove</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;TRACEVerbHandler&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">remove</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;OPTIONSVerbHandler&quot;</span> /&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">handlers</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">system.webServer</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"1-4-安全响应头（Security-Response-Headers）\"><a href=\"#1-4-安全响应头（Security-Response-Headers）\" class=\"headerlink\" title=\"1.4 安全响应头（Security Response Headers）\"></a>1.4 安全响应头（Security Response Headers）</h4><p><strong>核心安全头部清单</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>头部</th>\n<th>作用</th>\n<th>推荐值</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>X-Frame-Options</strong></td>\n<td>防止点击劫持</td>\n<td><code>DENY</code> 或 <code>SAMEORIGIN</code></td>\n</tr>\n<tr>\n<td><strong>X-Content-Type-Options</strong></td>\n<td>防止 MIME 嗅探</td>\n<td><code>nosniff</code></td>\n</tr>\n<tr>\n<td><strong>X-XSS-Protection</strong></td>\n<td>XSS 过滤器（旧版浏览器）</td>\n<td><code>1; mode=block</code></td>\n</tr>\n<tr>\n<td><strong>Content-Security-Policy</strong></td>\n<td>内容安全策略</td>\n<td>自定义白名单</td>\n</tr>\n<tr>\n<td><strong>Strict-Transport-Security</strong></td>\n<td>强制 HTTPS</td>\n<td><code>max-age=31536000</code></td>\n</tr>\n<tr>\n<td><strong>Referrer-Policy</strong></td>\n<td>控制 Referer 信息</td>\n<td><code>strict-origin-when-cross-origin</code></td>\n</tr>\n</tbody></table>\n<p><strong>配置示例</strong>：</p>\n<p><strong>Nginx</strong>：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">add_header</span> X-Frame-Options <span class=\"string\">&quot;SAMEORIGIN&quot;</span> always;</span><br><span class=\"line\"><span class=\"attribute\">add_header</span> X-Content-Type-Options <span class=\"string\">&quot;nosniff&quot;</span> always;</span><br><span class=\"line\"><span class=\"attribute\">add_header</span> X-XSS-Protection <span class=\"string\">&quot;1; mode=block&quot;</span> always;</span><br><span class=\"line\"><span class=\"attribute\">add_header</span> Referrer-Policy <span class=\"string\">&quot;strict-origin-when-cross-origin&quot;</span> always;</span><br><span class=\"line\"><span class=\"attribute\">add_header</span> Content-Security-Policy <span class=\"string\">&quot;default-src &#x27;self&#x27;; script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;;&quot;</span> always;</span><br></pre></td></tr></table></figure>\n\n<p><strong>Apache</strong>：</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">&lt;IfModule mod_headers.c&gt;</span></span><br><span class=\"line\">    <span class=\"attribute\">Header</span> always set X-Frame-Options <span class=\"string\">&quot;SAMEORIGIN&quot;</span></span><br><span class=\"line\">    <span class=\"attribute\">Header</span> always set X-Content-Type-Options <span class=\"string\">&quot;nosniff&quot;</span></span><br><span class=\"line\">    <span class=\"attribute\">Header</span> always set X-XSS-Protection <span class=\"string\">&quot;1; mode=block&quot;</span></span><br><span class=\"line\">    <span class=\"attribute\">Header</span> always set Referrer-Policy <span class=\"string\">&quot;strict-origin-when-cross-origin&quot;</span></span><br><span class=\"line\"><span class=\"section\">&lt;/IfModule&gt;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"1-5-日志配置（Logging）\"><a href=\"#1-5-日志配置（Logging）\" class=\"headerlink\" title=\"1.5 日志配置（Logging）\"></a>1.5 日志配置（Logging）</h4><p><strong>日志类型与用途</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>日志类型</th>\n<th>记录内容</th>\n<th>用途</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>访问日志</strong></td>\n<td>请求时间、IP、URL、状态码</td>\n<td>流量分析、异常检测</td>\n</tr>\n<tr>\n<td><strong>错误日志</strong></td>\n<td>错误详情、堆栈跟踪</td>\n<td>故障排查、攻击识别</td>\n</tr>\n<tr>\n<td><strong>安全日志</strong></td>\n<td>认证失败、拒绝访问</td>\n<td>安全事件溯源</td>\n</tr>\n</tbody></table>\n<p><strong>Nginx 日志配置</strong>：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">http</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\"># 自定义访问日志格式（包含更多安全相关信息）</span></span><br><span class=\"line\">    <span class=\"attribute\">log_format</span> security <span class=\"string\">&#x27;<span class=\"variable\">$remote_addr</span> - <span class=\"variable\">$remote_user</span> [<span class=\"variable\">$time_local</span>] &#x27;</span></span><br><span class=\"line\">                       <span class=\"string\">&#x27;&quot;<span class=\"variable\">$request</span>&quot; <span class=\"variable\">$status</span> <span class=\"variable\">$body_bytes_sent</span> &#x27;</span></span><br><span class=\"line\">                       <span class=\"string\">&#x27;&quot;<span class=\"variable\">$http_referer</span>&quot; &quot;<span class=\"variable\">$http_user_agent</span>&quot; &#x27;</span></span><br><span class=\"line\">                       <span class=\"string\">&#x27;<span class=\"variable\">$request_time</span> <span class=\"variable\">$upstream_response_time</span>&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">access_log</span> /var/log/nginx/access.log security;</span><br><span class=\"line\">    <span class=\"attribute\">error_log</span> /var/log/nginx/<span class=\"literal\">error</span>.log <span class=\"literal\">warn</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2️⃣-各中间件基础加固配置\"><a href=\"#2️⃣-各中间件基础加固配置\" class=\"headerlink\" title=\"2️⃣ 各中间件基础加固配置\"></a>2️⃣ 各中间件基础加固配置</h3><h4 id=\"2-1-Nginx-完整安全配置示例\"><a href=\"#2-1-Nginx-完整安全配置示例\" class=\"headerlink\" title=\"2.1 Nginx 完整安全配置示例\"></a>2.1 Nginx 完整安全配置示例</h4><figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># /etc/nginx/nginx.conf 安全配置</span></span><br><span class=\"line\"><span class=\"attribute\">user</span> www-data;</span><br><span class=\"line\"><span class=\"attribute\">worker_processes</span> auto;</span><br><span class=\"line\"><span class=\"attribute\">pid</span> /run/nginx.pid;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">events</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">worker_connections</span> <span class=\"number\">1024</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">http</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\"># 1. 隐藏版本号</span></span><br><span class=\"line\">    <span class=\"attribute\">server_tokens</span> <span class=\"literal\">off</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 2. 客户端请求体大小限制（防止大文件上传攻击）</span></span><br><span class=\"line\">    <span class=\"attribute\">client_max_body_size</span> <span class=\"number\">10M</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 3. 超时设置</span></span><br><span class=\"line\">    <span class=\"attribute\">client_body_timeout</span> <span class=\"number\">12</span>;</span><br><span class=\"line\">    <span class=\"attribute\">client_header_timeout</span> <span class=\"number\">12</span>;</span><br><span class=\"line\">    <span class=\"attribute\">keepalive_timeout</span> <span class=\"number\">15</span>;</span><br><span class=\"line\">    <span class=\"attribute\">send_timeout</span> <span class=\"number\">10</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 4. 安全响应头</span></span><br><span class=\"line\">    <span class=\"attribute\">add_header</span> X-Frame-Options <span class=\"string\">&quot;SAMEORIGIN&quot;</span> always;</span><br><span class=\"line\">    <span class=\"attribute\">add_header</span> X-Content-Type-Options <span class=\"string\">&quot;nosniff&quot;</span> always;</span><br><span class=\"line\">    <span class=\"attribute\">add_header</span> X-XSS-Protection <span class=\"string\">&quot;1; mode=block&quot;</span> always;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 5. 日志配置</span></span><br><span class=\"line\">    <span class=\"attribute\">log_format</span> security <span class=\"string\">&#x27;<span class=\"variable\">$remote_addr</span> - <span class=\"variable\">$remote_user</span> [<span class=\"variable\">$time_local</span>] &#x27;</span></span><br><span class=\"line\">                       <span class=\"string\">&#x27;&quot;<span class=\"variable\">$request</span>&quot; <span class=\"variable\">$status</span> <span class=\"variable\">$body_bytes_sent</span> &#x27;</span></span><br><span class=\"line\">                       <span class=\"string\">&#x27;&quot;<span class=\"variable\">$http_referer</span>&quot; &quot;<span class=\"variable\">$http_user_agent</span>&quot;&#x27;</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"attribute\">access_log</span> /var/log/nginx/access.log security;</span><br><span class=\"line\">    <span class=\"attribute\">error_log</span> /var/log/nginx/<span class=\"literal\">error</span>.log <span class=\"literal\">warn</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 6. 禁止不安全的 HTTP 方法</span></span><br><span class=\"line\">    <span class=\"attribute\">if</span> (<span class=\"variable\">$request_method</span> !<span class=\"regexp\">~ ^(GET|POST|HEAD)$</span> ) &#123;</span><br><span class=\"line\">        <span class=\"attribute\">return</span> <span class=\"number\">405</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 7. 限制请求速率（防止 DDoS）</span></span><br><span class=\"line\">    <span class=\"attribute\">limit_req_zone</span> <span class=\"variable\">$binary_remote_addr</span> zone=one:<span class=\"number\">10m</span> rate=10r/s;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"section\">server</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">listen</span> <span class=\"number\">80</span>;</span><br><span class=\"line\">        <span class=\"attribute\">server_name</span> example.com;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># 关闭目录列出</span></span><br><span class=\"line\">        <span class=\"attribute\">autoindex</span> <span class=\"literal\">off</span>;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># 限制请求速率</span></span><br><span class=\"line\">        <span class=\"attribute\">limit_req</span> zone=one burst=<span class=\"number\">20</span> nodelay;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"attribute\">root</span> /var/www/html;</span><br><span class=\"line\">        <span class=\"attribute\">index</span> index.html index.php;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"section\">location</span> <span class=\"regexp\">~ /\\.</span> &#123;</span><br><span class=\"line\">            <span class=\"attribute\">deny</span> all;  <span class=\"comment\"># 隐藏隐藏文件</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"2-2-Apache-完整安全配置示例\"><a href=\"#2-2-Apache-完整安全配置示例\" class=\"headerlink\" title=\"2.2 Apache 完整安全配置示例\"></a>2.2 Apache 完整安全配置示例</h4><figure class=\"highlight apache\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># /etc/apache2/apache2.conf 安全配置</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 1. 隐藏版本信息</span></span><br><span class=\"line\"><span class=\"attribute\">ServerTokens</span> Prod</span><br><span class=\"line\"><span class=\"attribute\">ServerSignature</span> <span class=\"literal\">Off</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. 禁用 TRACE 方法</span></span><br><span class=\"line\"><span class=\"attribute\">TraceEnable</span> <span class=\"literal\">Off</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. 关闭目录列出</span></span><br><span class=\"line\"><span class=\"section\">&lt;Directory /var/www/html&gt;</span></span><br><span class=\"line\">    <span class=\"attribute\">Options</span> -Indexes +FollowSymLinks</span><br><span class=\"line\">    <span class=\"attribute\">AllowOverride</span> None</span><br><span class=\"line\">    <span class=\"attribute\">Require</span> <span class=\"literal\">all</span> granted</span><br><span class=\"line\"><span class=\"section\">&lt;/Directory&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4. 限制请求大小（防止 DoS）</span></span><br><span class=\"line\"><span class=\"attribute\">LimitRequestBody</span> <span class=\"number\">10485760</span></span><br><span class=\"line\"><span class=\"attribute\">LimitRequestFields</span> <span class=\"number\">100</span></span><br><span class=\"line\"><span class=\"attribute\">LimitRequestFieldSize</span> <span class=\"number\">8190</span></span><br><span class=\"line\"><span class=\"attribute\">LimitRequestLine</span> <span class=\"number\">8190</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5. 请求超时</span></span><br><span class=\"line\"><span class=\"attribute\">RequestReadTimeout</span> header=<span class=\"number\">20</span>-<span class=\"number\">40</span>,MinRate=<span class=\"number\">500</span> body=<span class=\"number\">20</span>,MinRate=<span class=\"number\">500</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 6. 安全响应头</span></span><br><span class=\"line\"><span class=\"section\">&lt;IfModule mod_headers.c&gt;</span></span><br><span class=\"line\">    <span class=\"attribute\">Header</span> always set X-Frame-Options <span class=\"string\">&quot;SAMEORIGIN&quot;</span></span><br><span class=\"line\">    <span class=\"attribute\">Header</span> always set X-Content-Type-Options <span class=\"string\">&quot;nosniff&quot;</span></span><br><span class=\"line\">    <span class=\"attribute\">Header</span> always set X-XSS-Protection <span class=\"string\">&quot;1; mode=block&quot;</span></span><br><span class=\"line\"><span class=\"section\">&lt;/IfModule&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 7. 日志配置</span></span><br><span class=\"line\"><span class=\"attribute\">LogFormat</span> <span class=\"string\">&quot;%h %l %u %t \\&quot;%r\\&quot; %&gt;s %b \\&quot;%&#123;Referer&#125;i\\&quot; \\&quot;%&#123;User-Agent&#125;i\\&quot;&quot;</span> combined</span><br><span class=\"line\"><span class=\"attribute\">CustomLog</span> <span class=\"variable\">$&#123;APACHE_LOG_DIR&#125;</span>/access.log combined</span><br><span class=\"line\"><span class=\"attribute\">ErrorLog</span> <span class=\"variable\">$&#123;APACHE_LOG_DIR&#125;</span>/error.log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 8. 防止点击劫持</span></span><br><span class=\"line\"><span class=\"section\">&lt;IfModule mod_rewrite.c&gt;</span></span><br><span class=\"line\">    <span class=\"attribute\">RewriteEngine</span> <span class=\"literal\">On</span></span><br><span class=\"line\">    <span class=\"attribute\">RewriteCond</span> <span class=\"variable\">%&#123;HTTP_REFERER&#125;</span> !^$</span><br><span class=\"line\">    <span class=\"attribute\">RewriteCond</span> <span class=\"variable\">%&#123;HTTP_REFERER&#125;</span> !^https?://yourdomain\\.com<span class=\"meta\"> [NC]</span></span><br><span class=\"line\">    <span class=\"attribute\">RewriteRule</span> .* -<span class=\"meta\"> [F]</span></span><br><span class=\"line\"><span class=\"section\">&lt;/IfModule&gt;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"2-3-IIS-完整安全配置示例\"><a href=\"#2-3-IIS-完整安全配置示例\" class=\"headerlink\" title=\"2.3 IIS 完整安全配置示例\"></a>2.3 IIS 完整安全配置示例</h4><p><strong>web.config 文件配置</strong>：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">system.webServer</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 1. 关闭目录浏览 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">directoryBrowse</span> <span class=\"attr\">enabled</span>=<span class=\"string\">&quot;false&quot;</span> /&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 2. 禁用不安全的 HTTP 方法 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">handlers</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">remove</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;TRACEVerbHandler&quot;</span> /&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">remove</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;OPTIONSVerbHandler&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">handlers</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 3. 请求过滤 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">security</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">requestFiltering</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- 限制最大请求内容长度 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">requestLimits</span> <span class=\"attr\">maxAllowedContentLength</span>=<span class=\"string\">&quot;10485760&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- 限制 URL 最大长度 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">requestLimits</span> <span class=\"attr\">maxUrl</span>=<span class=\"string\">&quot;4096&quot;</span> <span class=\"attr\">maxQueryString</span>=<span class=\"string\">&quot;2048&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- 阻止特定文件扩展名 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">fileExtensions</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">add</span> <span class=\"attr\">fileExtension</span>=<span class=\"string\">&quot;.bak&quot;</span> <span class=\"attr\">allowed</span>=<span class=\"string\">&quot;false&quot;</span> /&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">add</span> <span class=\"attr\">fileExtension</span>=<span class=\"string\">&quot;.log&quot;</span> <span class=\"attr\">allowed</span>=<span class=\"string\">&quot;false&quot;</span> /&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">add</span> <span class=\"attr\">fileExtension</span>=<span class=\"string\">&quot;.sql&quot;</span> <span class=\"attr\">allowed</span>=<span class=\"string\">&quot;false&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">fileExtensions</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- 阻止特定 URL 序列 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">denyUrlSequences</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">add</span> <span class=\"attr\">sequence</span>=<span class=\"string\">&quot;..&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">denyUrlSequences</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">requestFiltering</span>&gt;</span></span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"comment\">&lt;!-- 4. IP 限制（可选） --&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">ipSecurity</span> <span class=\"attr\">allowUnlisted</span>=<span class=\"string\">&quot;true&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">clear</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">add</span> <span class=\"attr\">ipAddress</span>=<span class=\"string\">&quot;192.168.1.0&quot;</span> <span class=\"attr\">subnetMask</span>=<span class=\"string\">&quot;255.255.255.0&quot;</span> <span class=\"attr\">allowed</span>=<span class=\"string\">&quot;true&quot;</span> /&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">ipSecurity</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">security</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 5. HTTP 响应头 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">httpProtocol</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">customHeaders</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">add</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;X-Frame-Options&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;SAMEORIGIN&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">add</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;X-Content-Type-Options&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;nosniff&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">add</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;X-XSS-Protection&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;1; mode=block&quot;</span> /&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">customHeaders</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">httpProtocol</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 6. 错误页面（隐藏详细错误信息） --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">httpErrors</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">remove</span> <span class=\"attr\">statusCode</span>=<span class=\"string\">&quot;500&quot;</span> <span class=\"attr\">subStatusCode</span>=<span class=\"string\">&quot;-1&quot;</span> /&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">remove</span> <span class=\"attr\">statusCode</span>=<span class=\"string\">&quot;404&quot;</span> <span class=\"attr\">subStatusCode</span>=<span class=\"string\">&quot;-1&quot;</span> /&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">error</span> <span class=\"attr\">statusCode</span>=<span class=\"string\">&quot;404&quot;</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;/404.html&quot;</span> <span class=\"attr\">responseMode</span>=<span class=\"string\">&quot;File&quot;</span> /&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">error</span> <span class=\"attr\">statusCode</span>=<span class=\"string\">&quot;500&quot;</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;/500.html&quot;</span> <span class=\"attr\">responseMode</span>=<span class=\"string\">&quot;File&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">httpErrors</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 7. 日志配置 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">logFile</span> <span class=\"attr\">logExtFileFlags</span>=<span class=\"string\">&quot;Date,Time,ClientIP,UserName,SiteName,ComputerName,ServerIP,Method,UriStem,UriQuery,HttpStatus,Win32Status,BytesSent,BytesRecv,TimeTaken,ServerPort,UserAgent,Cookie,Referer,ProtocolVersion,Host,HttpSubStatus&quot;</span> /&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">system.webServer</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"3️⃣-验证加固效果\"><a href=\"#3️⃣-验证加固效果\" class=\"headerlink\" title=\"3️⃣ 验证加固效果\"></a>3️⃣ 验证加固效果</h3><h4 id=\"3-1-使用-curl-检查响应头\"><a href=\"#3-1-使用-curl-检查响应头\" class=\"headerlink\" title=\"3.1 使用 curl 检查响应头\"></a>3.1 使用 curl 检查响应头</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 检查 Server 头（应隐藏版本信息）</span></span><br><span class=\"line\">curl -I http://localhost:8080</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 预期结果（安全）</span></span><br><span class=\"line\">Server: nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 不安全结果</span></span><br><span class=\"line\">Server: nginx/1.18.0 (Ubuntu)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 检查安全响应头</span></span><br><span class=\"line\">curl -I http://localhost:8080 2&gt;&amp;1 | grep -i <span class=\"string\">&quot;x-&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 预期结果</span></span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\">X-Content-Type-Options: nosniff</span><br><span class=\"line\">X-XSS-Protection: 1; mode=block</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-2-测试目录列出\"><a href=\"#3-2-测试目录列出\" class=\"headerlink\" title=\"3.2 测试目录列出\"></a>3.2 测试目录列出</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 访问无 index 文件的目录</span></span><br><span class=\"line\">curl http://localhost:8080/uploads/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 如果返回目录列表（不安全）</span></span><br><span class=\"line\">Index of /uploads/</span><br><span class=\"line\">...</span><br><span class=\"line\">backup.zip</span><br><span class=\"line\">config.php</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 预期结果（安全）</span></span><br><span class=\"line\">403 Forbidden</span><br><span class=\"line\">或</span><br><span class=\"line\">404 Not Found</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-3-测试-HTTP-方法限制\"><a href=\"#3-3-测试-HTTP-方法限制\" class=\"headerlink\" title=\"3.3 测试 HTTP 方法限制\"></a>3.3 测试 HTTP 方法限制</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 测试 PUT 方法（应被拒绝）</span></span><br><span class=\"line\">curl -X PUT http://localhost:8080/test.txt -d <span class=\"string\">&quot;hello&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 预期结果</span></span><br><span class=\"line\">405 Method Not Allowed</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 测试 TRACE 方法（应被拒绝）</span></span><br><span class=\"line\">curl -X TRACE http://localhost:8080/ -v</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 预期结果</span></span><br><span class=\"line\">403 Forbidden</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-4-使用浏览器开发者工具\"><a href=\"#3-4-使用浏览器开发者工具\" class=\"headerlink\" title=\"3.4 使用浏览器开发者工具\"></a>3.4 使用浏览器开发者工具</h4><ol>\n<li>打开开发者工具（F12）</li>\n<li>切换到 Network 标签</li>\n<li>刷新页面，点击任意请求</li>\n<li>查看 Response Headers 标签</li>\n<li>确认安全头部已正确添加</li>\n</ol>\n<hr>\n<h2 id=\"实践任务（合法授权范围内）\"><a href=\"#实践任务（合法授权范围内）\" class=\"headerlink\" title=\"实践任务（合法授权范围内）\"></a>实践任务（合法授权范围内）</h2><blockquote>\n<p><strong>注意</strong>：以下任务请在你自己的测试环境、虚拟机或授权靶场中执行。不要在生产环境中随意修改配置。</p>\n</blockquote>\n<hr>\n<h3 id=\"任务-1（必做）：检查当前配置的暴露面\"><a href=\"#任务-1（必做）：检查当前配置的暴露面\" class=\"headerlink\" title=\"任务 1（必做）：检查当前配置的暴露面\"></a>任务 1（必做）：检查当前配置的暴露面</h3><p><strong>目标</strong>：扫描你的测试 Web 服务器，识别默认配置风险。</p>\n<p><strong>步骤</strong>：</p>\n<ol>\n<li><strong>扫描目录列出风险</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Linux/Mac</span></span><br><span class=\"line\">curl http://localhost/uploads/</span><br><span class=\"line\">curl http://localhost/backup/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Windows PowerShell</span></span><br><span class=\"line\">curl http://localhost/uploads/</span><br><span class=\"line\">curl http://localhost/backup/</span><br></pre></td></tr></table></figure>\n\n<p>记录结果：是否存在目录列出？如果存在，有哪些敏感文件可见？</p>\n<ol start=\"2\">\n<li><strong>检查版本信息泄露</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">curl -I http://localhost/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看响应头中的 Server 和 X-Powered-By</span></span><br></pre></td></tr></table></figure>\n\n<p>记录结果：</p>\n<ul>\n<li>Server 头显示什么信息？</li>\n<li>X-Powered-By 头是否存在？</li>\n</ul>\n<ol start=\"3\">\n<li><strong>测试 HTTP 方法</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 测试 TRACE 方法</span></span><br><span class=\"line\">curl -X TRACE http://localhost/ -v</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 测试 OPTIONS 方法</span></span><br><span class=\"line\">curl -X OPTIONS http://localhost/ -v</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 测试 PUT 方法</span></span><br><span class=\"line\">curl -X PUT http://localhost/test.txt -d <span class=\"string\">&quot;hello world&quot;</span> -v</span><br></pre></td></tr></table></figure>\n\n<p>记录结果：</p>\n<ul>\n<li>哪些方法被允许？</li>\n<li>哪些方法应该被禁止？</li>\n</ul>\n<hr>\n<h3 id=\"任务-2（必做）：配置-Nginx-安全加固\"><a href=\"#任务-2（必做）：配置-Nginx-安全加固\" class=\"headerlink\" title=\"任务 2（必做）：配置 Nginx 安全加固\"></a>任务 2（必做）：配置 Nginx 安全加固</h3><p><strong>前置条件</strong>：本地或虚拟机上已安装 Nginx</p>\n<p><strong>步骤 1：备份原始配置</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo <span class=\"built_in\">cp</span> /etc/nginx/nginx.conf /etc/nginx/nginx.conf.backup</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 2：修改配置文件</strong></p>\n<p>编辑 <code>/etc/nginx/nginx.conf</code>，添加以下安全配置：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">http</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\"># 1. 隐藏版本号</span></span><br><span class=\"line\">    <span class=\"attribute\">server_tokens</span> <span class=\"literal\">off</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 2. 关闭目录列出（在 server 块中）</span></span><br><span class=\"line\">    <span class=\"comment\"># autoindex off;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 3. 禁止不安全的 HTTP 方法</span></span><br><span class=\"line\">    <span class=\"attribute\">if</span> (<span class=\"variable\">$request_method</span> !<span class=\"regexp\">~ ^(GET|POST|HEAD)$</span> ) &#123;</span><br><span class=\"line\">        <span class=\"attribute\">return</span> <span class=\"number\">405</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 4. 添加安全响应头</span></span><br><span class=\"line\">    <span class=\"attribute\">add_header</span> X-Frame-Options <span class=\"string\">&quot;SAMEORIGIN&quot;</span> always;</span><br><span class=\"line\">    <span class=\"attribute\">add_header</span> X-Content-Type-Options <span class=\"string\">&quot;nosniff&quot;</span> always;</span><br><span class=\"line\">    <span class=\"attribute\">add_header</span> X-XSS-Protection <span class=\"string\">&quot;1; mode=block&quot;</span> always;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># ... 其他配置保持不变</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 3：重启 Nginx</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 测试配置文件语法</span></span><br><span class=\"line\">sudo nginx -t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重启服务</span></span><br><span class=\"line\">sudo systemctl restart nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 或 Windows</span></span><br><span class=\"line\">nginx -s reload</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 4：验证加固效果</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. 再次检查 Server 头</span></span><br><span class=\"line\">curl -I http://localhost/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. 测试禁用的 HTTP 方法</span></span><br><span class=\"line\">curl -X TRACE http://localhost/</span><br><span class=\"line\">curl -X PUT http://localhost/test.txt -d <span class=\"string\">&quot;test&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. 使用浏览器开发者工具查看安全响应头</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>对比表</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>检查项</th>\n<th>加固前</th>\n<th>加固后</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Server 头</td>\n<td><code>nginx/1.18.0</code></td>\n<td><code>nginx</code></td>\n<td>✅ 隐藏版本号</td>\n</tr>\n<tr>\n<td>目录列出</td>\n<td>显示文件列表</td>\n<td>403 Forbidden</td>\n<td>✅ 已禁用</td>\n</tr>\n<tr>\n<td>TRACE 方法</td>\n<td>允许</td>\n<td>405 Method Not Allowed</td>\n<td>✅ 已禁止</td>\n</tr>\n<tr>\n<td>PUT 方法</td>\n<td>允许</td>\n<td>405 Method Not Allowed</td>\n<td>✅ 已禁止</td>\n</tr>\n<tr>\n<td>X-Frame-Options</td>\n<td>无</td>\n<td>SAMEORIGIN</td>\n<td>✅ 已添加</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"任务-3（进阶）：配置-Apache-安全加固\"><a href=\"#任务-3（进阶）：配置-Apache-安全加固\" class=\"headerlink\" title=\"任务 3（进阶）：配置 Apache 安全加固\"></a>任务 3（进阶）：配置 Apache 安全加固</h3><p><strong>前置条件</strong>：本地或虚拟机上已安装 Apache</p>\n<p><strong>步骤 1：备份配置</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo <span class=\"built_in\">cp</span> /etc/apache2/apache2.conf /etc/apache2/apache2.conf.backup</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 2：修改配置</strong></p>\n<p>编辑 <code>/etc/apache2/apache2.conf</code> 或站点配置文件：</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1. 隐藏版本信息</span></span><br><span class=\"line\"><span class=\"attribute\">ServerTokens</span> Prod</span><br><span class=\"line\"><span class=\"attribute\">ServerSignature</span> <span class=\"literal\">Off</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2. 禁用 TRACE 方法</span></span><br><span class=\"line\"><span class=\"attribute\">TraceEnable</span> <span class=\"literal\">Off</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3. 关闭目录列出</span></span><br><span class=\"line\"><span class=\"section\">&lt;Directory /var/www/html&gt;</span></span><br><span class=\"line\">    <span class=\"attribute\">Options</span> -Indexes +FollowSymLinks</span><br><span class=\"line\">    <span class=\"comment\"># ...</span></span><br><span class=\"line\"><span class=\"section\">&lt;/Directory&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4. 限制允许的 HTTP 方法</span></span><br><span class=\"line\"><span class=\"section\">&lt;LimitExcept GET POST HEAD&gt;</span></span><br><span class=\"line\">    <span class=\"attribute\">Require</span> <span class=\"literal\">all</span> denied</span><br><span class=\"line\"><span class=\"section\">&lt;/LimitExcept&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5. 添加安全响应头</span></span><br><span class=\"line\"><span class=\"section\">&lt;IfModule mod_headers.c&gt;</span></span><br><span class=\"line\">    <span class=\"attribute\">Header</span> always set X-Frame-Options <span class=\"string\">&quot;SAMEORIGIN&quot;</span></span><br><span class=\"line\">    <span class=\"attribute\">Header</span> always set X-Content-Type-Options <span class=\"string\">&quot;nosniff&quot;</span></span><br><span class=\"line\">    <span class=\"attribute\">Header</span> always set X-XSS-Protection <span class=\"string\">&quot;1; mode=block&quot;</span></span><br><span class=\"line\"><span class=\"section\">&lt;/IfModule&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 3：启用必要模块并重启</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 启用 headers 模块</span></span><br><span class=\"line\">sudo a2enmod headers</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 测试配置</span></span><br><span class=\"line\">sudo apache2ctl configtest</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重启服务</span></span><br><span class=\"line\">sudo systemctl restart apache2</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 4：验证加固效果</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 检查 Server 头</span></span><br><span class=\"line\">curl -I http://localhost/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 测试禁用的方法</span></span><br><span class=\"line\">curl -X TRACE http://localhost/</span><br><span class=\"line\">curl -X OPTIONS http://localhost/</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-4（进阶）：IIS-安全加固\"><a href=\"#任务-4（进阶）：IIS-安全加固\" class=\"headerlink\" title=\"任务 4（进阶）：IIS 安全加固\"></a>任务 4（进阶）：IIS 安全加固</h3><p><strong>前置条件</strong>：Windows Server 或 Windows 10&#x2F;11 上已安装 IIS</p>\n<p><strong>步骤 1：打开 IIS 管理器</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\">inetmgr</span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 2：配置 web.config</strong></p>\n<p>在你的网站根目录创建或编辑 <code>web.config</code>：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">system.webServer</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 关闭目录浏览 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">directoryBrowse</span> <span class=\"attr\">enabled</span>=<span class=\"string\">&quot;false&quot;</span> /&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 禁用不安全的 HTTP 方法 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">handlers</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">remove</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;TRACEVerbHandler&quot;</span> /&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">remove</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;OPTIONSVerbHandler&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">handlers</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 安全响应头 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">httpProtocol</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">customHeaders</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">add</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;X-Frame-Options&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;SAMEORIGIN&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">add</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;X-Content-Type-Options&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;nosniff&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">add</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;X-XSS-Protection&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;1; mode=block&quot;</span> /&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">customHeaders</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">httpProtocol</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">system.webServer</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>步骤 3：验证加固效果</strong></p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 检查响应头</span></span><br><span class=\"line\"><span class=\"built_in\">curl</span> <span class=\"literal\">-I</span> http://localhost/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 测试禁用的方法</span></span><br><span class=\"line\"><span class=\"built_in\">curl</span> <span class=\"literal\">-X</span> TRACE http://localhost/ <span class=\"literal\">-v</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-5（实战）：自动化基线检查脚本\"><a href=\"#任务-5（实战）：自动化基线检查脚本\" class=\"headerlink\" title=\"任务 5（实战）：自动化基线检查脚本\"></a>任务 5（实战）：自动化基线检查脚本</h3><p><strong>目标</strong>：编写 Python 脚本自动检查 Web 服务器安全配置。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python3</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">Web 服务器安全基线检查脚本</span></span><br><span class=\"line\"><span class=\"string\">检查项目：版本信息、安全响应头、HTTP 方法、目录列出</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">from</span> urllib.parse <span class=\"keyword\">import</span> urljoin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">WebSecurityChecker</span>:</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, base_url</span>):</span><br><span class=\"line\">        self.base_url = base_url.rstrip(<span class=\"string\">&#x27;/&#x27;</span>)</span><br><span class=\"line\">        self.issues = []</span><br><span class=\"line\">        self.passed = []</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">check_version_disclosure</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;检查版本信息泄露&quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            resp = requests.head(self.base_url, timeout=<span class=\"number\">5</span>)</span><br><span class=\"line\">            server = resp.headers.get(<span class=\"string\">&#x27;Server&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">            x_powered = resp.headers.get(<span class=\"string\">&#x27;X-Powered-By&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\"># 检查 Server 头是否包含版本号</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"built_in\">any</span>(char.isdigit() <span class=\"keyword\">for</span> char <span class=\"keyword\">in</span> server):</span><br><span class=\"line\">                self.issues.append(<span class=\"string\">f&quot;版本信息泄露: Server 头暴露版本 - &#x27;<span class=\"subst\">&#123;server&#125;</span>&#x27;&quot;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                self.passed.append(<span class=\"string\">f&quot;版本信息: Server 头已隐藏版本号 - &#x27;<span class=\"subst\">&#123;server&#125;</span>&#x27;&quot;</span>)</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">if</span> x_powered:</span><br><span class=\"line\">                self.issues.append(<span class=\"string\">f&quot;技术栈泄露: X-Powered-By 头 - &#x27;<span class=\"subst\">&#123;x_powered&#125;</span>&#x27;&quot;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                self.passed.append(<span class=\"string\">&quot;技术栈: 未暴露 X-Powered-By 头&quot;</span>)</span><br><span class=\"line\">                </span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            self.issues.append(<span class=\"string\">f&quot;版本检查失败: <span class=\"subst\">&#123;e&#125;</span>&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">check_security_headers</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;检查安全响应头&quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            resp = requests.head(self.base_url, timeout=<span class=\"number\">5</span>)</span><br><span class=\"line\">            </span><br><span class=\"line\">            headers = &#123;</span><br><span class=\"line\">                <span class=\"string\">&#x27;X-Frame-Options&#x27;</span>: <span class=\"string\">&#x27;点击劫持防护&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;X-Content-Type-Options&#x27;</span>: <span class=\"string\">&#x27;MIME 嗅探防护&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;X-XSS-Protection&#x27;</span>: <span class=\"string\">&#x27;XSS 过滤器&#x27;</span>,</span><br><span class=\"line\">                <span class=\"string\">&#x27;Content-Security-Policy&#x27;</span>: <span class=\"string\">&#x27;内容安全策略&#x27;</span>,</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">for</span> header, desc <span class=\"keyword\">in</span> headers.items():</span><br><span class=\"line\">                <span class=\"keyword\">if</span> header <span class=\"keyword\">in</span> resp.headers:</span><br><span class=\"line\">                    self.passed.append(<span class=\"string\">f&quot;安全头: <span class=\"subst\">&#123;header&#125;</span> (<span class=\"subst\">&#123;desc&#125;</span>) - 已配置&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    self.issues.append(<span class=\"string\">f&quot;安全头缺失: <span class=\"subst\">&#123;header&#125;</span> (<span class=\"subst\">&#123;desc&#125;</span>)&quot;</span>)</span><br><span class=\"line\">                    </span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            self.issues.append(<span class=\"string\">f&quot;安全头检查失败: <span class=\"subst\">&#123;e&#125;</span>&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">check_http_methods</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;检查不安全的 HTTP 方法&quot;&quot;&quot;</span></span><br><span class=\"line\">        dangerous_methods = [<span class=\"string\">&#x27;TRACE&#x27;</span>, <span class=\"string\">&#x27;OPTIONS&#x27;</span>, <span class=\"string\">&#x27;PUT&#x27;</span>, <span class=\"string\">&#x27;DELETE&#x27;</span>]</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">for</span> method <span class=\"keyword\">in</span> dangerous_methods:</span><br><span class=\"line\">            <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                resp = requests.request(method, self.base_url, timeout=<span class=\"number\">5</span>)</span><br><span class=\"line\">                <span class=\"keyword\">if</span> resp.status_code <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> [<span class=\"number\">405</span>, <span class=\"number\">501</span>]:</span><br><span class=\"line\">                    self.issues.append(<span class=\"string\">f&quot;危险方法: <span class=\"subst\">&#123;method&#125;</span> 被允许 (状态码: <span class=\"subst\">&#123;resp.status_code&#125;</span>)&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                    self.passed.append(<span class=\"string\">f&quot;危险方法: <span class=\"subst\">&#123;method&#125;</span> 已禁用&quot;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">except</span> Exception:</span><br><span class=\"line\">                <span class=\"keyword\">pass</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">check_directory_listing</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;检查目录列出&quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            <span class=\"comment\"># 尝试访问常见目录</span></span><br><span class=\"line\">            test_paths = [<span class=\"string\">&#x27;/uploads/&#x27;</span>, <span class=\"string\">&#x27;/images/&#x27;</span>, <span class=\"string\">&#x27;/backup/&#x27;</span>, <span class=\"string\">&#x27;/tmp/&#x27;</span>]</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">for</span> path <span class=\"keyword\">in</span> test_paths:</span><br><span class=\"line\">                url = urljoin(self.base_url, path)</span><br><span class=\"line\">                <span class=\"keyword\">try</span>:</span><br><span class=\"line\">                    resp = requests.get(url, timeout=<span class=\"number\">5</span>)</span><br><span class=\"line\">                    <span class=\"comment\"># 简单判断：检查响应是否包含目录列表特征</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> <span class=\"string\">&#x27;Index of&#x27;</span> <span class=\"keyword\">in</span> resp.text <span class=\"keyword\">or</span> <span class=\"string\">&#x27;Parent Directory&#x27;</span> <span class=\"keyword\">in</span> resp.text:</span><br><span class=\"line\">                        self.issues.append(<span class=\"string\">f&quot;目录列出: <span class=\"subst\">&#123;path&#125;</span> 可列出&quot;</span>)</span><br><span class=\"line\">                <span class=\"keyword\">except</span>:</span><br><span class=\"line\">                    <span class=\"keyword\">pass</span></span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">            self.issues.append(<span class=\"string\">f&quot;目录列出检查失败: <span class=\"subst\">&#123;e&#125;</span>&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">generate_report</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;生成检查报告&quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;=&quot;</span> * <span class=\"number\">60</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;Web 服务器安全基线检查报告&quot;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;目标: <span class=\"subst\">&#123;self.base_url&#125;</span>&quot;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;=&quot;</span> * <span class=\"number\">60</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;\\n✅ 通过项 (<span class=\"subst\">&#123;<span class=\"built_in\">len</span>(self.passed)&#125;</span>)&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> self.passed:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;  + <span class=\"subst\">&#123;item&#125;</span>&quot;</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;\\n⚠️  问题项 (<span class=\"subst\">&#123;<span class=\"built_in\">len</span>(self.issues)&#125;</span>)&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> self.issues:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;  - <span class=\"subst\">&#123;item&#125;</span>&quot;</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;\\n&quot;</span> + <span class=\"string\">&quot;=&quot;</span> * <span class=\"number\">60</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;安全评分: <span class=\"subst\">&#123;<span class=\"built_in\">len</span>(self.passed) / (<span class=\"built_in\">len</span>(self.passed) + <span class=\"built_in\">len</span>(self.issues)) * <span class=\"number\">100</span>:<span class=\"number\">.1</span>f&#125;</span>%&quot;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;=&quot;</span> * <span class=\"number\">60</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">main</span>():</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(sys.argv) &lt; <span class=\"number\">2</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;用法: python check_web_security.py &lt;URL&gt;&quot;</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;示例: python check_web_security.py http://localhost:8080&quot;</span>)</span><br><span class=\"line\">        sys.exit(<span class=\"number\">1</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    url = sys.argv[<span class=\"number\">1</span>]</span><br><span class=\"line\">    checker = WebSecurityChecker(url)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;正在检查 Web 服务器安全配置...\\n&quot;</span>)</span><br><span class=\"line\">    checker.check_version_disclosure()</span><br><span class=\"line\">    checker.check_security_headers()</span><br><span class=\"line\">    checker.check_http_methods()</span><br><span class=\"line\">    checker.check_directory_listing()</span><br><span class=\"line\">    </span><br><span class=\"line\">    checker.generate_report()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure>\n\n<p><strong>运行脚本</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装依赖</span></span><br><span class=\"line\">pip install requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 运行检查</span></span><br><span class=\"line\">python check_web_security.py http://localhost:8080</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 预期输出示例</span></span><br><span class=\"line\">============================================================</span><br><span class=\"line\">Web 服务器安全基线检查报告</span><br><span class=\"line\">目标: http://localhost:8080</span><br><span class=\"line\">============================================================</span><br><span class=\"line\"></span><br><span class=\"line\">✅ 通过项 (4)</span><br><span class=\"line\">  + 版本信息: Server 头已隐藏版本号 - <span class=\"string\">&#x27;nginx&#x27;</span></span><br><span class=\"line\">  + 安全头: X-Frame-Options (点击劫持防护) - 已配置</span><br><span class=\"line\">  + 安全头: X-Content-Type-Options (MIME 嗅探防护) - 已配置</span><br><span class=\"line\">  + 危险方法: TRACE 已禁用</span><br><span class=\"line\"></span><br><span class=\"line\">⚠️  问题项 (3)</span><br><span class=\"line\">  - 安全头缺失: X-XSS-Protection (XSS 过滤器)</span><br><span class=\"line\">  - 安全头缺失: Content-Security-Policy (内容安全策略)</span><br><span class=\"line\">  - 目录列出: /uploads/ 可列出</span><br><span class=\"line\"></span><br><span class=\"line\">============================================================</span><br><span class=\"line\">安全评分: 57.1%</span><br><span class=\"line\">============================================================</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"巩固练习（题与复盘）\"><a href=\"#巩固练习（题与复盘）\" class=\"headerlink\" title=\"巩固练习（题与复盘）\"></a>巩固练习（题与复盘）</h2><hr>\n<h3 id=\"练习-1：为什么建议隐藏版本信息？\"><a href=\"#练习-1：为什么建议隐藏版本信息？\" class=\"headerlink\" title=\"练习 1：为什么建议隐藏版本信息？\"></a>练习 1：为什么建议隐藏版本信息？</h3><p><strong>思路提示</strong>：</p>\n<ul>\n<li>攻击者如何利用版本信息？</li>\n<li>隐藏版本信息能完全防止攻击吗？</li>\n<li>什么是”深度防御”（Defense in Depth）？</li>\n</ul>\n<hr>\n<h3 id=\"练习-2：X-Frame-Options-头的三种值有什么区别？\"><a href=\"#练习-2：X-Frame-Options-头的三种值有什么区别？\" class=\"headerlink\" title=\"练习 2：X-Frame-Options 头的三种值有什么区别？\"></a>练习 2：X-Frame-Options 头的三种值有什么区别？</h3><p><strong>提示值</strong>：</p>\n<ul>\n<li><code>DENY</code></li>\n<li><code>SAMEORIGIN</code></li>\n<li><code>ALLOW-FROM uri</code></li>\n</ul>\n<p><strong>思路提示</strong>：</p>\n<ul>\n<li>点击劫持（Clickjacking）攻击的原理</li>\n<li>每种值的允许&#x2F;拒绝规则</li>\n<li>CSP 的 <code>frame-ancestors</code> 如何替代 <code>ALLOW-FROM</code></li>\n</ul>\n<hr>\n<h3 id=\"练习-3：配置-Content-Security-Policy（CSP）\"><a href=\"#练习-3：配置-Content-Security-Policy（CSP）\" class=\"headerlink\" title=\"练习 3：配置 Content-Security-Policy（CSP）\"></a>练习 3：配置 Content-Security-Policy（CSP）</h3><p><strong>任务</strong>：为一个允许加载 Google Fonts 的网站编写 CSP 头部。</p>\n<p><strong>要求</strong>：</p>\n<ul>\n<li>默认只允许同源资源</li>\n<li>允许加载 fonts.googleapis.com 和 fonts.gstatic.com</li>\n<li>禁止内联脚本（<code>unsafe-inline</code>）</li>\n<li>允许内联样式（<code>unsafe-inline</code>）</li>\n</ul>\n<p><strong>思路提示</strong>：</p>\n<ul>\n<li>CSP 指令格式：<code>default-src</code>, <code>script-src</code>, <code>style-src</code>, <code>font-src</code></li>\n<li>多个域名用空格分隔</li>\n<li>使用 Report-Only 模式先测试</li>\n</ul>\n<hr>\n<h3 id=\"练习-4：HTTP-状态码与安全加固\"><a href=\"#练习-4：HTTP-状态码与安全加固\" class=\"headerlink\" title=\"练习 4：HTTP 状态码与安全加固\"></a>练习 4：HTTP 状态码与安全加固</h3><p><strong>问题</strong>：以下状态码在加固后应该返回什么？</p>\n<table>\n<thead>\n<tr>\n<th>HTTP 方法</th>\n<th>预期状态码</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>GET</td>\n<td>200 OK</td>\n<td>✅ 允许</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>200 OK</td>\n<td>✅ 允许</td>\n</tr>\n<tr>\n<td>TRACE</td>\n<td>?</td>\n<td>❌ 应禁止</td>\n</tr>\n<tr>\n<td>PUT</td>\n<td>?</td>\n<td>❌ 应禁止</td>\n</tr>\n<tr>\n<td>OPTIONS</td>\n<td>?</td>\n<td>⚠️ 限制</td>\n</tr>\n</tbody></table>\n<p><strong>思路提示</strong>：</p>\n<ul>\n<li>405 Method Not Allowed：方法不被允许</li>\n<li>403 Forbidden：禁止访问</li>\n<li>501 Not Implemented：未实现（服务端不支持该方法）</li>\n</ul>\n<hr>\n<h2 id=\"评估标准（达成判定）\"><a href=\"#评估标准（达成判定）\" class=\"headerlink\" title=\"评估标准（达成判定）\"></a>评估标准（达成判定）</h2><ul>\n<li>✅ 能识别 Web 中间件的三种主要暴露面（目录列出、版本信息、不安全方法）</li>\n<li>✅ 能独立修改 Nginx&#x2F;Apache 配置并重启服务</li>\n<li>✅ 能使用 curl 验证加固效果</li>\n<li>✅ 能解释 5 种以上安全响应头的作用</li>\n<li>✅ 能编写自动化脚本检查 Web 服务器基线</li>\n</ul>\n<hr>\n<h2 id=\"巩固练习（题与复盘）-1\"><a href=\"#巩固练习（题与复盘）-1\" class=\"headerlink\" title=\"巩固练习（题与复盘）\"></a>巩固练习（题与复盘）</h2><ul>\n<li>题目：为何建议隐藏版本信息？</li>\n<li>练习：给出一个安全的基础配置示例</li>\n</ul>\n<h2 id=\"评估标准（达成判定）-1\"><a href=\"#评估标准（达成判定）-1\" class=\"headerlink\" title=\"评估标准（达成判定）\"></a>评估标准（达成判定）</h2><ul>\n<li>配置文件与验证截图齐备</li>\n<li>✅ 能说明加固项的影响</li>\n</ul>\n<h2 id=\"学习成果达成情况（由学习者填写）\"><a href=\"#学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"学习成果达成情况（由学习者填写）\"></a>学习成果达成情况（由学习者填写）</h2><hr>\n<h3 id=\"截图与证据\"><a href=\"#截图与证据\" class=\"headerlink\" title=\"截图与证据\"></a>截图与证据</h3><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 加固前的 curl 响应头截图（Server 头暴露版本信息）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 加固后的 curl 响应头截图（Server 头已隐藏）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 目录列出测试截图（加固前&#x2F;后对比）</li>\n<li><input disabled=\"\" type=\"checkbox\"> HTTP 方法测试截图（TRACE&#x2F;PUT 返回 405）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 浏览器开发者工具查看安全响应头截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 自动化检查脚本运行输出截图</li>\n</ul>\n<hr>\n<h3 id=\"关键命令与输出（粘贴关键片段）\"><a href=\"#关键命令与输出（粘贴关键片段）\" class=\"headerlink\" title=\"关键命令与输出（粘贴关键片段）\"></a>关键命令与输出（粘贴关键片段）</h3><p><strong>加固前 Server 头</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ curl -I http://localhost/</span><br><span class=\"line\">HTTP/1.1 200 OK</span><br><span class=\"line\">Server: nginx/1.18.0 (Ubuntu)</span><br><span class=\"line\">Date: Fri, 17 Jan 2026 10:30:00 GMT</span><br><span class=\"line\">Content-Type: text/html</span><br></pre></td></tr></table></figure>\n\n<p><strong>加固后 Server 头</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ curl -I http://localhost/</span><br><span class=\"line\">HTTP/1.1 200 OK</span><br><span class=\"line\">Server: nginx</span><br><span class=\"line\">Date: Fri, 17 Jan 2026 10:35:00 GMT</span><br><span class=\"line\">Content-Type: text/html</span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\">X-Content-Type-Options: nosniff</span><br><span class=\"line\">X-XSS-Protection: 1; mode=block</span><br></pre></td></tr></table></figure>\n\n<p><strong>目录列出测试</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 加固前</span></span><br><span class=\"line\">$ curl http://localhost/uploads/</span><br><span class=\"line\">Index of /uploads/</span><br><span class=\"line\">..</span><br><span class=\"line\">backup.zip</span><br><span class=\"line\">config.php</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 加固后</span></span><br><span class=\"line\">$ curl http://localhost/uploads/</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;<span class=\"built_in\">head</span>&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;&lt;/center&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n\n<p><strong>HTTP 方法测试</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ curl -X TRACE http://localhost/ -v</span><br><span class=\"line\">...</span><br><span class=\"line\">&lt; HTTP/1.1 405 Method Not Allowed</span><br><span class=\"line\">&lt; Server: nginx</span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">$ curl -X PUT http://localhost/test.txt -d <span class=\"string\">&quot;hello&quot;</span></span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;<span class=\"built_in\">head</span>&gt;&lt;title&gt;405 Not Allowed&lt;/title&gt;&lt;/head&gt;</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"结论与反思\"><a href=\"#结论与反思\" class=\"headerlink\" title=\"结论与反思\"></a>结论与反思</h3><p><strong>我今天搞清楚了</strong>：</p>\n<ul>\n<li>Web 中间件的默认配置存在多种安全风险（目录列出、版本泄露、不安全方法）</li>\n<li>通过简单的配置修改可以显著降低攻击面</li>\n<li>安全响应头（X-Frame-Options、X-Content-Type-Options 等）可以防御常见 Web 攻击</li>\n<li>自动化脚本可以快速检查配置是否符合基线要求</li>\n</ul>\n<p><strong>我差点搞混的是</strong>：</p>\n<ul>\n<li>以为 <code>server_tokens off</code> 完全隐藏 Server 头，实际上只隐藏版本号</li>\n<li>混淆了 Apache 的 <code>Options -Indexes</code> 和 Nginx 的 <code>autoindex off</code> 语法</li>\n<li>最初不理解 X-Frame-Options 的 DENY 和 SAMEORIGIN 的区别</li>\n</ul>\n<p><strong>明天我要继续补的是</strong>：</p>\n<ul>\n<li>学习 WAF（Web 应用防火墙）的基础配置（Day026）</li>\n<li>了解 SQL 注入、XSS 等常见 Web 漏洞的防护（Day027-028）</li>\n<li>实战使用安全扫描工具（Nikto、Wappalyzer 等）</li>\n</ul>\n<p><strong>本次学习耗时</strong>：约 3 小时</p>\n<p><strong>掌握程度自评</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 😕 理解了基本概念，但配置不熟练</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🙂 完成了基础配置任务</li>\n<li><input disabled=\"\" type=\"checkbox\"> 😃 完成了所有任务并理解原理</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🤩 编写了自动化检查脚本并优化了配置</li>\n</ul>\n<hr>\n<h2 id=\"集中参考答案（含思路）\"><a href=\"#集中参考答案（含思路）\" class=\"headerlink\" title=\"集中参考答案（含思路）\"></a>集中参考答案（含思路）</h2><hr>\n<h3 id=\"练习-1-参考答案：为什么建议隐藏版本信息？\"><a href=\"#练习-1-参考答案：为什么建议隐藏版本信息？\" class=\"headerlink\" title=\"练习 1 参考答案：为什么建议隐藏版本信息？\"></a>练习 1 参考答案：为什么建议隐藏版本信息？</h3><p><strong>攻击者如何利用版本信息</strong>：</p>\n<ol>\n<li><p><strong>精确匹配已知漏洞</strong>：</p>\n<ul>\n<li>在 NVD 或 Exploit-DB 中搜索特定版本的 CVE</li>\n<li>例如：<code>nginx/1.18.0</code> → 搜索 <code>CVE-2021-23017</code></li>\n</ul>\n</li>\n<li><p><strong>定制攻击 Payload</strong>：</p>\n<ul>\n<li>不同版本的漏洞利用方式可能不同</li>\n<li>已知版本号可以显著提高攻击成功率</li>\n</ul>\n</li>\n<li><p><strong>评估维护状况</strong>：</p>\n<ul>\n<li>版本过旧说明系统长期未更新</li>\n<li>可能同时存在多个未修复漏洞</li>\n</ul>\n</li>\n</ol>\n<p><strong>隐藏版本信息的局限性</strong>：</p>\n<ul>\n<li><p><strong>指纹识别仍然可能</strong>：</p>\n<ul>\n<li>通过 HTTP 响应特征、错误页面、行为差异推断版本</li>\n<li>例如：Nginx 不同版本的 404 页面略有差异</li>\n</ul>\n</li>\n<li><p><strong>不是完全的防护</strong>：</p>\n<ul>\n<li>如果存在漏洞，攻击者可能通过探测发现</li>\n<li>隐藏版本属于”轻度”防御措施</li>\n</ul>\n</li>\n</ul>\n<p><strong>深度防御（Defense in Depth）理念</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">多层防御策略</span><br><span class=\"line\">├─ 第一层：隐藏版本信息（降低被针对性攻击的概率）</span><br><span class=\"line\">├─ 第二层：及时更新补丁（修复已知漏洞）</span><br><span class=\"line\">├─ 第三层：WAF/IPS（拦截恶意请求）</span><br><span class=\"line\">├─ 第四层：网络隔离（限制访问来源）</span><br><span class=\"line\">└─ 第五层：监控告警（及时发现异常）</span><br></pre></td></tr></table></figure>\n\n<p><strong>结论</strong>：隐藏版本信息是良好的安全实践，但不能替代及时更新和补丁管理。</p>\n<hr>\n<h3 id=\"练习-2-参考答案：X-Frame-Options-头的三种值有什么区别？\"><a href=\"#练习-2-参考答案：X-Frame-Options-头的三种值有什么区别？\" class=\"headerlink\" title=\"练习 2 参考答案：X-Frame-Options 头的三种值有什么区别？\"></a>练习 2 参考答案：X-Frame-Options 头的三种值有什么区别？</h3><p><strong>点击劫持（Clickjacking）攻击原理</strong>：</p>\n<p>攻击者将目标网站嵌入透明 iframe，诱导用户点击看似无害的按钮，实际执行了敏感操作（如转账、授权）。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">攻击者页面</span><br><span class=\"line\">┌─────────────────────────────┐</span><br><span class=\"line\">│  🎁 点击领取免费礼品！      │</span><br><span class=\"line\">│  ┌───────────────────────┐  │</span><br><span class=\"line\">│  │  iframe (透明)        │  │</span><br><span class=\"line\">│  │  [ 确认转账 ]        │  │</span><br><span class=\"line\">│  └───────────────────────┘  │</span><br><span class=\"line\">└─────────────────────────────┘</span><br><span class=\"line\">用户点击&quot;领取礼品&quot; → 实际点击&quot;确认转账&quot;</span><br></pre></td></tr></table></figure>\n\n<p><strong>X-Frame-Options 三种值对比</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>值</th>\n<th>规则</th>\n<th>适用场景</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>DENY</strong></td>\n<td>禁止任何域名嵌入</td>\n<td>高安全性需求（如银行登录页）</td>\n<td><code>&lt;iframe src=&quot;https://bank.com&quot;&gt;</code> 被拒绝</td>\n</tr>\n<tr>\n<td><strong>SAMEORIGIN</strong></td>\n<td>只允许同源域名嵌入</td>\n<td>需要在站内使用 iframe 的场景</td>\n<td><code>example.com</code> 可嵌入 <code>example.com</code></td>\n</tr>\n<tr>\n<td><strong>ALLOW-FROM uri</strong></td>\n<td>允许指定域名嵌入（已废弃）</td>\n<td>跨域嵌入需求（旧版浏览器）</td>\n<td>允许 <code>trusted.com</code> 嵌入</td>\n</tr>\n</tbody></table>\n<p><strong>示例</strong>：</p>\n<figure class=\"highlight http\"><table><tr><td class=\"code\"><pre><span class=\"line\"># DENY 示例</span><br><span class=\"line\"><span class=\"attribute\">X-Frame-Options</span><span class=\"punctuation\">: </span>DENY</span><br><span class=\"line\"># 结果：所有 iframe 嵌入都被阻止</span><br><span class=\"line\"></span><br><span class=\"line\"># SAMEORIGIN 示例</span><br><span class=\"line\"><span class=\"attribute\">X-Frame-Options</span><span class=\"punctuation\">: </span>SAMEORIGIN</span><br><span class=\"line\"># 结果：仅 example.com 可嵌入 example.com 的页面</span><br><span class=\"line\"># example.com 嵌入 other.com 被阻止</span><br><span class=\"line\"></span><br><span class=\"line\"># ALLOW-FROM 示例（已废弃）</span><br><span class=\"line\"><span class=\"attribute\">X-Frame-Options</span><span class=\"punctuation\">: </span>ALLOW-FROM https://trusted.com</span><br><span class=\"line\"># 结果：仅 trusted.com 可嵌入此页面</span><br></pre></td></tr></table></figure>\n\n<p><strong>ALLOW-FROM 已废弃的原因</strong>：</p>\n<ul>\n<li>浏览器支持不一致（Firefox、Safari 不支持）</li>\n<li>CSP 的 <code>frame-ancestors</code> 提供更强大的控制</li>\n</ul>\n<p><strong>CSP 的 <code>frame-ancestors</code> 替代方案</strong>：</p>\n<figure class=\"highlight http\"><table><tr><td class=\"code\"><pre><span class=\"line\"># CSP 示例</span><br><span class=\"line\"><span class=\"attribute\">Content-Security-Policy</span><span class=\"punctuation\">: </span>frame-ancestors &#x27;self&#x27; https://trusted.com;</span><br><span class=\"line\"></span><br><span class=\"line\"># 等价于</span><br><span class=\"line\"># 允许同源 + trusted.com 嵌入</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"练习-3-参考答案：配置-Content-Security-Policy（CSP）\"><a href=\"#练习-3-参考答案：配置-Content-Security-Policy（CSP）\" class=\"headerlink\" title=\"练习 3 参考答案：配置 Content-Security-Policy（CSP）\"></a>练习 3 参考答案：配置 Content-Security-Policy（CSP）</h3><p><strong>CSP 头部配置</strong>：</p>\n<figure class=\"highlight http\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">Content-Security-Policy</span><span class=\"punctuation\">: </span>default-src &#x27;self&#x27;;</span><br><span class=\"line\">                              script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;;</span><br><span class=\"line\">                              style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27; fonts.googleapis.com fonts.gstatic.com;</span><br><span class=\"line\">                              font-src fonts.googleapis.com fonts.gstatic.com;</span><br></pre></td></tr></table></figure>\n\n<p><strong>逐项解释</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>指令</th>\n<th>值</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>default-src</strong></td>\n<td><code>&#39;self&#39;</code></td>\n<td>默认只允许同源资源</td>\n</tr>\n<tr>\n<td><strong>script-src</strong></td>\n<td><code>&#39;self&#39; &#39;unsafe-inline&#39;</code></td>\n<td>允许同源脚本 + 内联脚本</td>\n</tr>\n<tr>\n<td><strong>style-src</strong></td>\n<td><code>&#39;self&#39; &#39;unsafe-inline&#39; fonts.googleapis.com fonts.gstatic.com</code></td>\n<td>允许同源样式 + 内联样式 + Google Fonts</td>\n</tr>\n<tr>\n<td><strong>font-src</strong></td>\n<td><code>fonts.googleapis.com fonts.gstatic.com</code></td>\n<td>允许从 Google Fonts 加载字体</td>\n</tr>\n</tbody></table>\n<p><strong>完整示例</strong>（Nginx 配置）：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">listen</span> <span class=\"number\">80</span>;</span><br><span class=\"line\">    <span class=\"attribute\">server_name</span> example.com;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"section\">location</span> / &#123;</span><br><span class=\"line\">        <span class=\"attribute\">add_header</span> Content-Security-Policy <span class=\"string\">&quot;</span></span><br><span class=\"line\"><span class=\"string\">            default-src &#x27;self&#x27;;</span></span><br><span class=\"line\"><span class=\"string\">            script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;;</span></span><br><span class=\"line\"><span class=\"string\">            style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27; fonts.googleapis.com fonts.gstatic.com;</span></span><br><span class=\"line\"><span class=\"string\">            font-src fonts.googleapis.com fonts.gstatic.com;</span></span><br><span class=\"line\"><span class=\"string\">            img-src &#x27;self&#x27; data:;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;</span> always;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>使用 Report-Only 模式测试</strong>：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 先测试策略，不实际阻止</span></span><br><span class=\"line\"><span class=\"attribute\">add_header</span> Content-Security-Policy-Report-Only <span class=\"string\">&quot;</span></span><br><span class=\"line\"><span class=\"string\">    default-src &#x27;self&#x27;;</span></span><br><span class=\"line\"><span class=\"string\">    script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;;</span></span><br><span class=\"line\"><span class=\"string\">    style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27; fonts.googleapis.com fonts.gstatic.com;</span></span><br><span class=\"line\"><span class=\"string\">    font-src fonts.googleapis.com fonts.gstatic.com;</span></span><br><span class=\"line\"><span class=\"string\">&quot;</span> always;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 报告接收端点</span></span><br><span class=\"line\"><span class=\"attribute\">add_header</span> Report-To <span class=\"string\">&#x27;&#123;&quot;group&quot;:&quot;csp-endpoint&quot;,&quot;max_age&quot;:10886400,&quot;endpoints&quot;:[&#123;&quot;url&quot;:&quot;https://example.com/csp-report&quot;&#125;]&#125;&#x27;</span> always;</span><br></pre></td></tr></table></figure>\n\n<p><strong>CSP 生成工具</strong>：</p>\n<ul>\n<li>Mozilla CSP Evaluator: <a href=\"https://csp-evaluator.withgoogle.com/\">https://csp-evaluator.withgoogle.com/</a></li>\n<li>Report URI: <a href=\"https://report-uri.com/\">https://report-uri.com/</a></li>\n</ul>\n<hr>\n<h3 id=\"练习-4-参考答案：HTTP-状态码与安全加固\"><a href=\"#练习-4-参考答案：HTTP-状态码与安全加固\" class=\"headerlink\" title=\"练习 4 参考答案：HTTP 状态码与安全加固\"></a>练习 4 参考答案：HTTP 状态码与安全加固</h3><p><strong>预期状态码表</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>HTTP 方法</th>\n<th>预期状态码</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>GET</td>\n<td>200 OK</td>\n<td>✅ 允许正常访问</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>200 OK</td>\n<td>✅ 允许提交数据</td>\n</tr>\n<tr>\n<td>HEAD</td>\n<td>200 OK</td>\n<td>✅ 允许获取响应头</td>\n</tr>\n<tr>\n<td>TRACE</td>\n<td>405 Method Not Allowed</td>\n<td>❌ 应禁止（跨站追踪攻击）</td>\n</tr>\n<tr>\n<td>PUT</td>\n<td>405 Method Not Allowed</td>\n<td>❌ 应禁止（文件上传漏洞）</td>\n</tr>\n<tr>\n<td>DELETE</td>\n<td>405 Method Not Allowed</td>\n<td>❌ 应禁止（文件删除漏洞）</td>\n</tr>\n<tr>\n<td>OPTIONS</td>\n<td>501 Not Implemented</td>\n<td>⚠️ 限制（或返回 405）</td>\n</tr>\n<tr>\n<td>PATCH</td>\n<td>405 Method Not Allowed</td>\n<td>❌ 应禁止（需认证）</td>\n</tr>\n</tbody></table>\n<p><strong>状态码说明</strong>：</p>\n<ul>\n<li><p><strong>405 Method Not Allowed</strong>：</p>\n<ul>\n<li>服务器识别请求方法，但不允许使用</li>\n<li>常用于明确禁止某些方法</li>\n<li>响应头包含 <code>Allow</code> 字段，列出允许的方法</li>\n</ul>\n</li>\n<li><p><strong>403 Forbidden</strong>：</p>\n<ul>\n<li>服务器理解请求，但拒绝执行</li>\n<li>常用于权限不足</li>\n<li>可用于禁止某些方法，但 405 更明确</li>\n</ul>\n</li>\n<li><p><strong>501 Not Implemented</strong>：</p>\n<ul>\n<li>服务器不支持请求方法</li>\n<li>表示服务端根本不实现该方法</li>\n<li>常用于 OPTIONS（禁用时）</li>\n</ul>\n</li>\n</ul>\n<p><strong>验证示例</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 405 响应示例</span></span><br><span class=\"line\">$ curl -X PUT http://localhost/test.txt -v</span><br><span class=\"line\">...</span><br><span class=\"line\">&lt; HTTP/1.1 405 Method Not Allowed</span><br><span class=\"line\">&lt; Server: nginx</span><br><span class=\"line\">&lt; Allow: GET, POST, HEAD</span><br><span class=\"line\">&lt; Content-Length: 178</span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 501 响应示例</span></span><br><span class=\"line\">$ curl -X OPTIONS http://localhost/ -v</span><br><span class=\"line\">...</span><br><span class=\"line\">&lt; HTTP/1.1 501 Not Implemented</span><br><span class=\"line\">&lt; Server: nginx</span><br><span class=\"line\">&lt; Content-Length: 153</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p><strong>推荐做法</strong>：</p>\n<ol>\n<li>使用 <strong>405</strong> 明确告知客户端哪些方法被允许</li>\n<li>在 <code>Allow</code> 响应头中列出允许的方法</li>\n<li>在服务器配置中显式允许&#x2F;禁止方法，而非依赖默认行为</li>\n</ol>\n<p><strong>Apache 配置示例</strong>：</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 明确允许的方法</span></span><br><span class=\"line\"><span class=\"section\">&lt;LimitExcept GET POST HEAD&gt;</span></span><br><span class=\"line\">    <span class=\"attribute\">Require</span> <span class=\"literal\">all</span> denied</span><br><span class=\"line\"><span class=\"section\">&lt;/LimitExcept&gt;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"学习成果示例填写（可照抄）\"><a href=\"#学习成果示例填写（可照抄）\" class=\"headerlink\" title=\"学习成果示例填写（可照抄）\"></a>学习成果示例填写（可照抄）</h2><blockquote>\n<p>可将”示例”内容替换为你自己的时间与截图文件名。</p>\n</blockquote>\n<hr>\n<h3 id=\"截图与证据（示例）\"><a href=\"#截图与证据（示例）\" class=\"headerlink\" title=\"截图与证据（示例）\"></a>截图与证据（示例）</h3><ul>\n<li>任务 1：<code>images/day025_before_headers.png</code>（加固前的响应头）</li>\n<li>任务 1：<code>images/day025_after_headers.png</code>（加固后的响应头）</li>\n<li>任务 2：<code>images/day025_nginx_config.png</code>（Nginx 配置文件）</li>\n<li>任务 5：<code>images/day025_script_output.png</code>（自动化检查脚本输出）</li>\n</ul>\n<hr>\n<h3 id=\"关键命令与输出（示例）\"><a href=\"#关键命令与输出（示例）\" class=\"headerlink\" title=\"关键命令与输出（示例）\"></a>关键命令与输出（示例）</h3><p><strong>Nginx 加固前后对比</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 加固前</span></span><br><span class=\"line\">$ curl -I http://localhost:8080/</span><br><span class=\"line\">HTTP/1.1 200 OK</span><br><span class=\"line\">Server: nginx/1.18.0 (Ubuntu)</span><br><span class=\"line\">Date: Fri, 17 Jan 2026 14:30:00 GMT</span><br><span class=\"line\">Content-Type: text/html</span><br><span class=\"line\">Connection: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 加固后</span></span><br><span class=\"line\">$ curl -I http://localhost:8080/</span><br><span class=\"line\">HTTP/1.1 200 OK</span><br><span class=\"line\">Server: nginx</span><br><span class=\"line\">Date: Fri, 17 Jan 2026 14:45:00 GMT</span><br><span class=\"line\">Content-Type: text/html</span><br><span class=\"line\">Connection: keep-alive</span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\">X-Content-Type-Options: nosniff</span><br><span class=\"line\">X-XSS-Protection: 1; mode=block</span><br></pre></td></tr></table></figure>\n\n<p><strong>自动化检查脚本输出</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">============================================================</span><br><span class=\"line\">Web 服务器安全基线检查报告</span><br><span class=\"line\">目标: http://localhost:8080</span><br><span class=\"line\">============================================================</span><br><span class=\"line\"></span><br><span class=\"line\">✅ 通过项 (6)</span><br><span class=\"line\">  + 版本信息: Server 头已隐藏版本号 - &#x27;nginx&#x27;</span><br><span class=\"line\">  + 安全头: X-Frame-Options (点击劫持防护) - 已配置</span><br><span class=\"line\">  + 安全头: X-Content-Type-Options (MIME 嗅探防护) - 已配置</span><br><span class=\"line\">  + 安全头: X-XSS-Protection (XSS 过滤器) - 已配置</span><br><span class=\"line\">  + 危险方法: TRACE 已禁用</span><br><span class=\"line\">  + 危险方法: PUT 已禁用</span><br><span class=\"line\"></span><br><span class=\"line\">⚠️  问题项 (1)</span><br><span class=\"line\">  - 安全头缺失: Content-Security-Policy (内容安全策略)</span><br><span class=\"line\"></span><br><span class=\"line\">============================================================</span><br><span class=\"line\">安全评分: 85.7%</span><br><span class=\"line\">============================================================</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"结论与反思（示例）\"><a href=\"#结论与反思（示例）\" class=\"headerlink\" title=\"结论与反思（示例）\"></a>结论与反思（示例）</h3><p><strong>我今天搞清楚了</strong>：</p>\n<ul>\n<li>Web 中间件的默认配置存在多种安全风险，需要主动加固</li>\n<li>隐藏版本信息、关闭目录列出、限制 HTTP 方法是基础加固项</li>\n<li>安全响应头（X-Frame-Options、X-Content-Type-Options、CSP）可以防御常见 Web 攻击</li>\n<li>可以用 Python 编写自动化脚本快速检查配置合规性</li>\n</ul>\n<p><strong>我差点搞混的是</strong>：</p>\n<ul>\n<li>以为 <code>X-Frame-Options: ALLOW-FROM</code> 是推荐方式，实际上已被废弃</li>\n<li>混淆了 Nginx 的 <code>autoindex off</code> 和 Apache 的 <code>Options -Indexes</code> 语法</li>\n<li>最初不理解 CSP 的 <code>script-src &#39;unsafe-inline&#39;</code> 是降低安全性，但为了兼容性不得已</li>\n</ul>\n<p><strong>明天我要继续补的是</strong>：</p>\n<ul>\n<li>学习 WAF（Web 应用防火墙）的基础概念与配置（Day026）</li>\n<li>了解 SQL 注入、XSS 等常见 Web 漏洞的攻击与防御（Day027-028）</li>\n<li>实战使用安全扫描工具（Nikto、Wappalyzer、Nuclei）</li>\n</ul>\n<p><strong>本次学习耗时</strong>：约 3.5 小时</p>\n<p><strong>掌握程度自评</strong>：</p>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> 😃 完成了所有任务并理解原理</li>\n</ul>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day028：漏洞扫描与基线 - 周综合实验与测评（扫描+基线+加固）","url":"/post/e442a326.html","content":"<h1 id=\"Day028：漏洞扫描与基线-周综合实验与测评（扫描-基线-加固）\"><a href=\"#Day028：漏洞扫描与基线-周综合实验与测评（扫描-基线-加固）\" class=\"headerlink\" title=\"Day028：漏洞扫描与基线 - 周综合实验与测评（扫描+基线+加固）\"></a>Day028：漏洞扫描与基线 - 周综合实验与测评（扫描+基线+加固）</h1><ul>\n<li>日期：2026-01-21</li>\n<li>周次：第4周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p>今天你将完成<strong>第 4 周综合实验</strong>，实现从扫描到加固的完整闭环：</p>\n<ul>\n<li><strong>整合本周所学</strong>：将漏洞扫描、基线检查、加固复验的知识串联应用</li>\n<li><strong>完成端到端实验</strong>：对一个目标执行完整的 安全扫描 → 基线检查 → 安全加固 → 复验验证</li>\n<li><strong>输出结构化周报</strong>：汇总本周所有实验结果，形成可汇报的技术文档</li>\n<li><strong>制定改进计划</strong>：识别问题与不足，提出后续改进措施</li>\n<li><strong>建立证据链</strong>：确保每个步骤都有可追溯的记录和截图</li>\n</ul>\n<hr>\n<span id=\"more\"></span>\n\n<h2 id=\"学习内容\"><a href=\"#学习内容\" class=\"headerlink\" title=\"学习内容\"></a>学习内容</h2><h3 id=\"1️⃣-本周知识回顾\"><a href=\"#1️⃣-本周知识回顾\" class=\"headerlink\" title=\"1️⃣ 本周知识回顾\"></a>1️⃣ 本周知识回顾</h3><h4 id=\"1-1-漏洞扫描与基线检查模块概览\"><a href=\"#1-1-漏洞扫描与基线检查模块概览\" class=\"headerlink\" title=\"1.1 漏洞扫描与基线检查模块概览\"></a>1.1 漏洞扫描与基线检查模块概览</h4><table>\n<thead>\n<tr>\n<th>天数</th>\n<th>主题</th>\n<th>核心技能</th>\n<th>工具&#x2F;技术</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Day022</strong></td>\n<td>漏洞类型与编号体系</td>\n<td>CVE&#x2F;CWE&#x2F;CVSS 体系理解</td>\n<td>NVD 数据库查询</td>\n</tr>\n<tr>\n<td><strong>Day023</strong></td>\n<td>漏洞扫描器安装与使用</td>\n<td>Nessus&#x2F;OpenVAS 扫描与报告解读</td>\n<td>Nessus Essentials</td>\n</tr>\n<tr>\n<td><strong>Day024</strong></td>\n<td>系统基线与审计</td>\n<td>口令策略、补丁管理、服务暴露检查</td>\n<td>PowerShell&#x2F;Shell 脚本</td>\n</tr>\n<tr>\n<td><strong>Day025</strong></td>\n<td>Web 中间件暴露面与加固</td>\n<td>目录列出、版本信息、安全响应头</td>\n<td>Nginx&#x2F;Apache&#x2F;IIS 配置</td>\n</tr>\n<tr>\n<td><strong>Day026</strong></td>\n<td>自动化基线检查</td>\n<td>脚本化、模块化、报告生成</td>\n<td>Python、JSON&#x2F;CSV 导出</td>\n</tr>\n<tr>\n<td><strong>Day027</strong></td>\n<td>加固复验与变更记录</td>\n<td>复验流程、变更记录、回滚方案</td>\n<td>对比脚本、Markdown 文档</td>\n</tr>\n</tbody></table>\n<hr>\n<h4 id=\"1-2-完整工作流程\"><a href=\"#1-2-完整工作流程\" class=\"headerlink\" title=\"1.2 完整工作流程\"></a>1.2 完整工作流程</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">┌──────────────────────────────────────────────────────────┐</span><br><span class=\"line\">│                   安全加固闭环流程                        │</span><br><span class=\"line\">└──────────────────────────────────────────────────────────┘</span><br><span class=\"line\">                            │</span><br><span class=\"line\">        ┌───────────────────┼───────────────────┐</span><br><span class=\"line\">        │                   │                   │</span><br><span class=\"line\">        ▼                   ▼                   ▼</span><br><span class=\"line\">   ┌────────┐        ┌────────┐        ┌────────┐</span><br><span class=\"line\">   │ 1. 扫描 │        │ 2. 基线 │        │ 3. 加固 │</span><br><span class=\"line\">   │ 漏洞   │        │ 检查   │        │ 配置   │</span><br><span class=\"line\">   └────────┘        └────────┘        └────────┘</span><br><span class=\"line\">        │                   │                   │</span><br><span class=\"line\">        └───────────────────┼───────────────────┘</span><br><span class=\"line\">                            │</span><br><span class=\"line\">                            ▼</span><br><span class=\"line\">                     ┌────────────┐</span><br><span class=\"line\">                     │ 4. 复验   │</span><br><span class=\"line\">                     │ 有效性    │</span><br><span class=\"line\">                     └────────────┘</span><br><span class=\"line\">                            │</span><br><span class=\"line\">                            ▼</span><br><span class=\"line\">                     ┌────────────┐</span><br><span class=\"line\">                     │ 5. 变更   │</span><br><span class=\"line\">                     │ 记录归档   │</span><br><span class=\"line\">                     └────────────┘</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2️⃣-误报与漏报处理\"><a href=\"#2️⃣-误报与漏报处理\" class=\"headerlink\" title=\"2️⃣ 误报与漏报处理\"></a>2️⃣ 误报与漏报处理</h3><h4 id=\"2-1-误报（False-Positive）类型\"><a href=\"#2-1-误报（False-Positive）类型\" class=\"headerlink\" title=\"2.1 误报（False Positive）类型\"></a>2.1 误报（False Positive）类型</h4><table>\n<thead>\n<tr>\n<th>误报类型</th>\n<th>原因</th>\n<th>处理方法</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Banner 误报</strong></td>\n<td>版本号已更新但 Banner 未修改</td>\n<td>手动验证实际版本</td>\n</tr>\n<tr>\n<td><strong>配置误报</strong></td>\n<td>配置存在但实际未生效</td>\n<td>重启服务后复验</td>\n</tr>\n<tr>\n<td><strong>依赖误报</strong></td>\n<td>漏洞依赖条件不满足</td>\n<td>检查环境条件</td>\n</tr>\n<tr>\n<td><strong>插件过时</strong></td>\n<td>扫描器插件版本旧</td>\n<td>更新漏洞数据库</td>\n</tr>\n</tbody></table>\n<h4 id=\"2-2-漏报（False-Negative）类型\"><a href=\"#2-2-漏报（False-Negative）类型\" class=\"headerlink\" title=\"2.2 漏报（False Negative）类型\"></a>2.2 漏报（False Negative）类型</h4><table>\n<thead>\n<tr>\n<th>漏报类型</th>\n<th>原因</th>\n<th>处理方法</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>未授权扫描</strong></td>\n<td>扫描器无认证权限</td>\n<td>使用认证扫描</td>\n</tr>\n<tr>\n<td><strong>端口未开放</strong></td>\n<td>服务未运行或端口关闭</td>\n<td>检查服务状态</td>\n</tr>\n<tr>\n<td><strong>防火墙拦截</strong></td>\n<td>流量被防火墙丢弃</td>\n<td>调整防火墙规则</td>\n</tr>\n<tr>\n<td><strong>自定义应用</strong></td>\n<td>针对特定应用的检测缺失</td>\n<td>使用自定义脚本</td>\n</tr>\n</tbody></table>\n<h4 id=\"2-3-误报-x2F-漏报处置流程\"><a href=\"#2-3-误报-x2F-漏报处置流程\" class=\"headerlink\" title=\"2.3 误报&#x2F;漏报处置流程\"></a>2.3 误报&#x2F;漏报处置流程</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">┌─────────────────────────────────────────┐</span><br><span class=\"line\">│ 发现异常报告                            │</span><br><span class=\"line\">└─────────────────────────────────────────┘</span><br><span class=\"line\">                  │</span><br><span class=\"line\">        ┌─────────┼─────────┐</span><br><span class=\"line\">        ▼                   ▼</span><br><span class=\"line\">   误报?              漏报?</span><br><span class=\"line\">        │                   │</span><br><span class=\"line\">        ▼                   ▼</span><br><span class=\"line\">   手动验证          深度扫描</span><br><span class=\"line\">        │                   │</span><br><span class=\"line\">        ▼                   ▼</span><br><span class=\"line\">   确认误报?        发现漏洞?</span><br><span class=\"line\">        │                   │</span><br><span class=\"line\">   ┌───┴───┐              │</span><br><span class=\"line\">   │       │              │</span><br><span class=\"line\">   是       否              │</span><br><span class=\"line\">   │       │              │</span><br><span class=\"line\">   ▼       ▼              ▼</span><br><span class=\"line\">忽略   重新评估        修复漏洞</span><br><span class=\"line\">        │                   │</span><br><span class=\"line\">        └────────┬──────────┘</span><br><span class=\"line\">                 ▼</span><br><span class=\"line\">            更新报告</span><br><span class=\"line\">                 │</span><br><span class=\"line\">                 ▼</span><br><span class=\"line\">           归档与改进</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"3️⃣-检查清单模板\"><a href=\"#3️⃣-检查清单模板\" class=\"headerlink\" title=\"3️⃣ 检查清单模板\"></a>3️⃣ 检查清单模板</h3><h4 id=\"3-1-综合检查清单\"><a href=\"#3-1-综合检查清单\" class=\"headerlink\" title=\"3.1 综合检查清单\"></a>3.1 综合检查清单</h4><figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">## 安全加固综合检查清单</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 阶段 1：扫描前准备</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 确认目标授权范围</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 确定维护窗口</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 备份关键配置文件</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 记录服务正常运行状态</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 准备回滚方案</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 阶段 2：漏洞扫描</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 执行漏洞扫描（Nessus/OpenVAS）</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 导出扫描报告（PDF/HTML/CSV）</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 识别高危漏洞（CVSS ≥ 7.0）</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 记录漏洞详情（CVE、CVSS、修复建议）</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 阶段 3：基线检查</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 执行自动化基线检查脚本</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 检查 Web 中间件配置（版本信息、安全响应头）</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 检查系统配置（口令策略、开放端口、补丁状态）</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 导出基线检查报告（CSV/JSON）</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 阶段 4：安全加固</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 根据扫描结果制定加固方案</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 修改配置文件</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 测试配置文件语法</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 重启服务</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 验证服务状态</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 阶段 5：复验验证</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 重新执行漏洞扫描</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 重新执行基线检查</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 对比加固前后结果</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 执行业务回归测试</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 检查日志无异常</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 阶段 6：变更记录</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 撰写变更记录文档</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 记录变更内容、时间、执行人</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 记录回滚方案</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 附件：配置备份、扫描报告、测试结果</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 审批签字（如需要）</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 阶段 7：周报汇总</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 汇总本周所有实验结果</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 统计发现的漏洞数量与风险等级</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 统计加固措施及效果</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 识别误报/漏报并说明处置方式</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 提出改进计划</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"4️⃣-周报模板\"><a href=\"#4️⃣-周报模板\" class=\"headerlink\" title=\"4️⃣ 周报模板\"></a>4️⃣ 周报模板</h3><h4 id=\"4-1-标准周报格式\"><a href=\"#4-1-标准周报格式\" class=\"headerlink\" title=\"4.1 标准周报格式\"></a>4.1 标准周报格式</h4><figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\"># 网络安全学习周报 - 第 4 周</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 基本信息</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 项目 | 内容 |</span><br><span class=\"line\">|------|------|</span><br><span class=\"line\">| 周次 | 第 4 周 |</span><br><span class=\"line\">| 学习主题 | 漏洞扫描与基线 |</span><br><span class=\"line\">| 学习周期 | 2026-01-15 至 2026-01-21 |</span><br><span class=\"line\">| 学习者 | [你的姓名] |</span><br><span class=\"line\">| 完成天数 | 7/7 天 |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 本周学习内容概览</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 天数 | 主题 | 完成状态 | 耗时 |</span><br><span class=\"line\">|------|------|---------|------|</span><br><span class=\"line\">| Day022 | 漏洞类型与编号体系 | ✅ | 2 小时 |</span><br><span class=\"line\">| Day023 | 漏洞扫描器安装与使用 | ✅ | 3 小时 |</span><br><span class=\"line\">| Day024 | 系统基线与审计 | ✅ | 2.5 小时 |</span><br><span class=\"line\">| Day025 | Web 中间件暴露面与加固 | ✅ | 3.5 小时 |</span><br><span class=\"line\">| Day026 | 自动化基线检查 | ✅ | 4 小时 |</span><br><span class=\"line\">| Day027 | 加固复验与变更记录 | ✅ | 3 小时 |</span><br><span class=\"line\">| Day028 | 周综合实验 | ✅ | 5 小时 |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"strong\">**本周总耗时**</span>: 约 23 小时</span><br><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 本周实验成果汇总</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 漏洞扫描统计</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 扫描目标 | 高危漏洞 | 中危漏洞 | 低危漏洞 | 信息级 | 已修复 |</span><br><span class=\"line\">|---------|---------|---------|---------|-------|-------|</span><br><span class=\"line\">| 本机 Web 服务器 | 0 | 2 | 3 | 5 | 2 |</span><br><span class=\"line\">| 测试虚拟机 | 1 | 5 | 8 | 12 | 4 |</span><br><span class=\"line\">| <span class=\"strong\">**总计**</span> | <span class=\"strong\">**1**</span> | <span class=\"strong\">**7**</span> | <span class=\"strong\">**11**</span> | <span class=\"strong\">**17**</span> | <span class=\"strong\">**6**</span> |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 基线检查统计</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 检查类别 | 检查项 | 通过 | 失败 | 通过率 |</span><br><span class=\"line\">|---------|-------|------|------|--------|</span><br><span class=\"line\">| Web 配置 | 4 | 3 | 1 | 75% |</span><br><span class=\"line\">| 系统配置 | 6 | 4 | 2 | 67% |</span><br><span class=\"line\">| 日志审计 | 3 | 2 | 1 | 67% |</span><br><span class=\"line\">| <span class=\"strong\">**总计**</span> | <span class=\"strong\">**13**</span> | <span class=\"strong\">**9**</span> | <span class=\"strong\">**4**</span> | <span class=\"strong\">**69%**</span> |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 加固措施统计</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 类别 | 实施措施数 | 验证通过 | 待验证 |</span><br><span class=\"line\">|------|-----------|---------|-------|</span><br><span class=\"line\">| Web 中间件 | 4 | 4 | 0 |</span><br><span class=\"line\">| 系统配置 | 3 | 3 | 0 |</span><br><span class=\"line\">| 防火墙规则 | 2 | 1 | 1 |</span><br><span class=\"line\">| <span class=\"strong\">**总计**</span> | <span class=\"strong\">**9**</span> | <span class=\"strong\">**8**</span> | <span class=\"strong\">**1**</span> |</span><br><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 典型案例分析</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 案例 1：Web 服务器加固</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"strong\">**发现问题**</span>：</span><br><span class=\"line\"><span class=\"bullet\">-</span> ❌ Server 头暴露版本信息（nginx/1.18.0）</span><br><span class=\"line\"><span class=\"bullet\">-</span> ❌ 缺少 X-Frame-Options 响应头</span><br><span class=\"line\"><span class=\"bullet\">-</span> ❌ 缺少 X-Content-Type-Options 响应头</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"strong\">**加固措施**</span>：</span><br><span class=\"line\"><span class=\"code\">```nginx</span></span><br><span class=\"line\"><span class=\"code\">server_tokens off;</span></span><br><span class=\"line\"><span class=\"code\">add_header X-Frame-Options &quot;SAMEORIGIN&quot; always;</span></span><br><span class=\"line\"><span class=\"code\">add_header X-Content-Type-Options &quot;nosniff&quot; always;</span></span><br><span class=\"line\"><span class=\"code\">add_header X-XSS-Protection &quot;1; mode=block&quot; always;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>复验结果</strong>：</p>\n<ul>\n<li>✅ Server 头已隐藏（仅显示 “nginx”）</li>\n<li>✅ 所有安全响应头已配置</li>\n<li>✅ 业务功能正常，无副作用</li>\n</ul>\n<p><strong>通过率提升</strong>: 25% → 100%</p>\n<hr>\n<h3 id=\"案例-2：系统基线检查\"><a href=\"#案例-2：系统基线检查\" class=\"headerlink\" title=\"案例 2：系统基线检查\"></a>案例 2：系统基线检查</h3><p><strong>发现问题</strong>：</p>\n<ul>\n<li>❌ SSH 允许 root 直接登录</li>\n<li>❌ 密码最小长度仅 6 位</li>\n<li>❌ 系统超过 90 天未更新补丁</li>\n</ul>\n<p><strong>加固措施</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 禁用 root SSH 登录</span></span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;s/PermitRootLogin yes/PermitRootLogin no/&#x27;</span> /etc/ssh/sshd_config</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 调整密码策略</span></span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;s/PASS_MIN_LEN 6/PASS_MIN_LEN 12/&#x27;</span> /etc/login.defs</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 更新系统补丁</span></span><br><span class=\"line\">apt update &amp;&amp; apt upgrade -y</span><br></pre></td></tr></table></figure>\n\n<p><strong>复验结果</strong>：</p>\n<ul>\n<li>✅ SSH root 登录已禁用</li>\n<li>✅ 密码最小长度已调整为 12 位</li>\n<li>✅ 系统补丁已更新至最新版本</li>\n</ul>\n<hr>\n<h2 id=\"误报与漏报处理\"><a href=\"#误报与漏报处理\" class=\"headerlink\" title=\"误报与漏报处理\"></a>误报与漏报处理</h2><h3 id=\"误报案例\"><a href=\"#误报案例\" class=\"headerlink\" title=\"误报案例\"></a>误报案例</h3><table>\n<thead>\n<tr>\n<th>检查项</th>\n<th>原因</th>\n<th>处置方式</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>CVE-2021-23017</td>\n<td>Nginx 实际版本为 1.22.1，但扫描器检测为 1.18.0</td>\n<td>手动验证，标记为误报</td>\n</tr>\n<tr>\n<td>缺少补丁 MS17-010</td>\n<td>系统已安装补丁，但注册表未更新</td>\n<td>认证扫描后确认已修复，标记为误报</td>\n</tr>\n</tbody></table>\n<h3 id=\"漏报案例\"><a href=\"#漏报案例\" class=\"headerlink\" title=\"漏报案例\"></a>漏报案例</h3><table>\n<thead>\n<tr>\n<th>检查项</th>\n<th>原因</th>\n<th>处置方式</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>数据库默认密码</td>\n<td>扫描器无数据库凭据，无法验证</td>\n<td>手动检查，添加到基线检查项</td>\n</tr>\n<tr>\n<td>敏感文件暴露</td>\n<td>路径不在常见扫描列表</td>\n<td>使用自定义脚本补充检查</td>\n</tr>\n</tbody></table>\n<hr>\n<h2 id=\"工具与脚本\"><a href=\"#工具与脚本\" class=\"headerlink\" title=\"工具与脚本\"></a>工具与脚本</h2><h3 id=\"使用的工具\"><a href=\"#使用的工具\" class=\"headerlink\" title=\"使用的工具\"></a>使用的工具</h3><ul>\n<li>Nessus Essentials（漏洞扫描）</li>\n<li>curl（响应头检查）</li>\n<li>diff（配置对比）</li>\n<li>Python 3（自动化脚本）</li>\n</ul>\n<h3 id=\"开发的脚本\"><a href=\"#开发的脚本\" class=\"headerlink\" title=\"开发的脚本\"></a>开发的脚本</h3><ol>\n<li><strong>Web 安全基线检查脚本</strong>（Day025）</li>\n<li><strong>基线检查报告生成器</strong>（Day026）</li>\n<li><strong>加固效果对比脚本</strong>（Day027）</li>\n<li><strong>变更记录模板</strong>（Day027）</li>\n</ol>\n<hr>\n<h2 id=\"遇到的问题与解决方案\"><a href=\"#遇到的问题与解决方案\" class=\"headerlink\" title=\"遇到的问题与解决方案\"></a>遇到的问题与解决方案</h2><table>\n<thead>\n<tr>\n<th>问题</th>\n<th>原因</th>\n<th>解决方案</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>扫描结果过多，难以筛选</td>\n<td>未设置风险等级筛选</td>\n<td>只关注 CVSS ≥ 7.0 的漏洞</td>\n</tr>\n<tr>\n<td>加固后服务无法启动</td>\n<td>配置文件语法错误</td>\n<td>使用 <code>nginx -t</code> 检查语法后再重启</td>\n</tr>\n<tr>\n<td>基线检查脚本报错</td>\n<td>requests 库未安装</td>\n<td><code>pip install requests</code></td>\n</tr>\n<tr>\n<td>复验结果与加固前无变化</td>\n<td>服务未重启</td>\n<td>确保修改配置后重启服务</td>\n</tr>\n</tbody></table>\n<hr>\n<h2 id=\"本周收获与感悟\"><a href=\"#本周收获与感悟\" class=\"headerlink\" title=\"本周收获与感悟\"></a>本周收获与感悟</h2><p><strong>技术收获</strong>：</p>\n<ol>\n<li>掌握了 CVE&#x2F;CWE&#x2F;CVSS 三大编号体系的应用</li>\n<li>学会了使用 Nessus 进行漏洞扫描和报告解读</li>\n<li>理解了系统基线检查的重要性和常用检查项</li>\n<li>掌握了 Web 中间件的安全加固方法</li>\n<li>学会了编写自动化基线检查脚本</li>\n<li>理解了加固复验和变更管理的重要性</li>\n</ol>\n<p><strong>思维转变</strong>：</p>\n<ul>\n<li>从”发现问题”到”解决问题”</li>\n<li>从”手动操作”到”自动化工具”</li>\n<li>从”单点加固”到”系统化加固”</li>\n<li>从”临时修复”到”标准化流程”</li>\n</ul>\n<p><strong>印象深刻的知识点</strong>：</p>\n<ul>\n<li>CVSS 评分的六个维度（AV、AC、PR、UI、S、CIA）</li>\n<li>常见安全响应头的作用和配置方法</li>\n<li>误报和漏报的识别与处理流程</li>\n<li>变更记录的标准化格式和回滚方案</li>\n</ul>\n<hr>\n<h2 id=\"不足与改进计划\"><a href=\"#不足与改进计划\" class=\"headerlink\" title=\"不足与改进计划\"></a>不足与改进计划</h2><h3 id=\"本周不足\"><a href=\"#本周不足\" class=\"headerlink\" title=\"本周不足\"></a>本周不足</h3><ol>\n<li><p><strong>深度不足</strong>：</p>\n<ul>\n<li>对部分 CVE 的原理理解不深入</li>\n<li>对某些加固措施的影响评估不够全面</li>\n</ul>\n</li>\n<li><p><strong>自动化程度有待提高</strong>：</p>\n<ul>\n<li>扫描、基线检查、加固复验仍需手动整合</li>\n<li>尚未实现完全自动化的一站式加固工具</li>\n</ul>\n</li>\n<li><p><strong>实战经验缺乏</strong>：</p>\n<ul>\n<li>仅在本地测试环境练习，缺乏真实企业环境经验</li>\n<li>对大型系统的加固策略不够熟悉</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"改进计划\"><a href=\"#改进计划\" class=\"headerlink\" title=\"改进计划\"></a>改进计划</h3><table>\n<thead>\n<tr>\n<th>改进项</th>\n<th>具体措施</th>\n<th>时间规划</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>深入理解 CVE 原理</strong></td>\n<td>选择 3-5 个经典漏洞（如 Log4Shell、EternalBlue），深入分析原理和利用方式</td>\n<td>第 5 周</td>\n</tr>\n<tr>\n<td><strong>完善自动化工具</strong></td>\n<td>开发集成扫描、基线、加固、复验的一体化工具</td>\n<td>第 6 周</td>\n</tr>\n<tr>\n<td><strong>增加实战练习</strong></td>\n<td>使用 Hack The Box、VulnHub 等靶场进行实战演练</td>\n<td>持续进行</td>\n</tr>\n<tr>\n<td><strong>建立知识库</strong></td>\n<td>整理本周所学，建立个人安全知识库</td>\n<td>第 5 周</td>\n</tr>\n<tr>\n<td><strong>学习 WAF 部署</strong></td>\n<td>了解 WAF 原理，学习 ModSecurity 规则配置</td>\n<td>第 6-7 周</td>\n</tr>\n</tbody></table>\n<hr>\n<h2 id=\"下周学习计划\"><a href=\"#下周学习计划\" class=\"headerlink\" title=\"下周学习计划\"></a>下周学习计划</h2><table>\n<thead>\n<tr>\n<th>天数</th>\n<th>主题</th>\n<th>预期产出</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Day029</td>\n<td>WAF 原理与安装</td>\n<td>完成 ModSecurity 安装与配置</td>\n</tr>\n<tr>\n<td>Day030</td>\n<td>常见 Web 漏洞检测</td>\n<td>理解 SQL 注入、XSS、CSRF 原理</td>\n</tr>\n<tr>\n<td>Day031</td>\n<td>WAF 规则编写</td>\n<td>编写自定义 WAF 规则</td>\n</tr>\n<tr>\n<td>Day032</td>\n<td>安全事件监控</td>\n<td>配置日志监控与告警</td>\n</tr>\n<tr>\n<td>Day033-035</td>\n<td>综合演练</td>\n<td>完成 WAF + 监控的闭环实验</td>\n</tr>\n</tbody></table>\n<hr>\n<h2 id=\"附录\"><a href=\"#附录\" class=\"headerlink\" title=\"附录\"></a>附录</h2><h3 id=\"证据文件清单\"><a href=\"#证据文件清单\" class=\"headerlink\" title=\"证据文件清单\"></a>证据文件清单</h3><table>\n<thead>\n<tr>\n<th>文件名</th>\n<th>说明</th>\n<th>日期</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>day023_scan_report.pdf</code></td>\n<td>Nessus 扫描报告</td>\n<td>2026-01-16</td>\n</tr>\n<tr>\n<td><code>day024_baseline_report.csv</code></td>\n<td>系统基线检查报告</td>\n<td>2026-01-17</td>\n</tr>\n<tr>\n<td><code>day025_web_check.json</code></td>\n<td>Web 安全检查报告</td>\n<td>2026-01-18</td>\n</tr>\n<tr>\n<td><code>day026_baseline_report.json</code></td>\n<td>自动化基线检查报告</td>\n<td>2026-01-19</td>\n</tr>\n<tr>\n<td><code>day027_change_record.md</code></td>\n<td>变更记录文档</td>\n<td>2026-01-20</td>\n</tr>\n<tr>\n<td><code>day028_comparison.json</code></td>\n<td>加固效果对比报告</td>\n<td>2026-01-21</td>\n</tr>\n</tbody></table>\n<hr>\n<p><strong>周报撰写人</strong>: [你的姓名]<br><strong>周报日期</strong>: 2026-01-21<br><strong>审阅人</strong>: （如有）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\"></span><br><span class=\"line\">## 实践任务（合法授权范围内）</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; **注意**：本次综合实验请在你的测试环境、本地虚拟机或授权靶场中执行。</span><br><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\"></span><br><span class=\"line\">### 任务 1（必做）：选择实验目标</span><br><span class=\"line\"></span><br><span class=\"line\">**目标**：选择一个 Web 服务器或系统作为本次综合实验的目标。</span><br><span class=\"line\"></span><br><span class=\"line\">**建议选项**：</span><br><span class=\"line\"></span><br><span class=\"line\">1. **本地 Web 服务器**</span><br><span class=\"line\">   - 使用 Nginx/Apache 搭建</span><br><span class=\"line\">   - 模拟未加固状态（开启目录列出、暴露版本等）</span><br><span class=\"line\"></span><br><span class=\"line\">2. **虚拟机**</span><br><span class=\"line\">   - 使用 VirtualBox/VMware 创建 Linux 虚拟机</span><br><span class=\"line\">   - 安装常见服务（Nginx、MySQL、SSH）</span><br><span class=\"line\"></span><br><span class=\"line\">3. **在线靶场**</span><br><span class=\"line\">   - Hack The Box</span><br><span class=\"line\">   - VulnHub</span><br><span class=\"line\">   - PortSwigger Web Security Academy</span><br><span class=\"line\"></span><br><span class=\"line\">**要求**：</span><br><span class=\"line\">- 有明确的授权范围</span><br><span class=\"line\">- 可以反复测试和回滚</span><br><span class=\"line\">- 能够修改配置和重启服务</span><br><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\"></span><br><span class=\"line\">### 任务 2（必做）：加固前基线扫描</span><br><span class=\"line\"></span><br><span class=\"line\">**目标**：对目标系统执行加固前的完整基线扫描，建立初始状态。</span><br><span class=\"line\"></span><br><span class=\"line\">**步骤**：</span><br><span class=\"line\"></span><br><span class=\"line\">1. **记录初始状态**</span><br><span class=\"line\"></span><br><span class=\"line\">```bash</span><br><span class=\"line\"># 创建基线目录</span><br><span class=\"line\">mkdir -p ~/week4_experiment/baseline</span><br><span class=\"line\"></span><br><span class=\"line\"># 记录服务状态</span><br><span class=\"line\">systemctl status nginx &gt; baseline/service_status.txt</span><br><span class=\"line\">systemctl status ssh &gt; baseline/ssh_status.txt</span><br><span class=\"line\"></span><br><span class=\"line\"># 记录配置文件</span><br><span class=\"line\">cp /etc/nginx/nginx.conf baseline/nginx.conf.before</span><br><span class=\"line\"></span><br><span class=\"line\"># 记录开放端口</span><br><span class=\"line\">ss -tlnp &gt; baseline/open_ports.txt</span><br><span class=\"line\"></span><br><span class=\"line\"># 记录进程列表</span><br><span class=\"line\">ps aux &gt; baseline/processes.txt</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><strong>执行 Web 安全检查</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> baseline_checker</span><br><span class=\"line\">python main.py --config config/targets.json --output ../week4_experiment/baseline</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><strong>执行漏洞扫描（如果使用 Nessus）</strong></li>\n</ol>\n<p>启动 Nessus 扫描，导出报告到 <code>baseline/</code> 目录。</p>\n<hr>\n<h3 id=\"任务-3（必做）：制定加固方案\"><a href=\"#任务-3（必做）：制定加固方案\" class=\"headerlink\" title=\"任务 3（必做）：制定加固方案\"></a>任务 3（必做）：制定加固方案</h3><p><strong>目标</strong>：根据扫描结果，制定详细的安全加固方案。</p>\n<p><strong>步骤</strong>：</p>\n<ol>\n<li><strong>分析扫描结果</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看基线检查报告</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> baseline/baseline_report_*.json | grep -A 5 <span class=\"string\">&quot;status.*failed&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看漏洞扫描报告（PDF/Nessus 报告）</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><strong>制定加固计划</strong></li>\n</ol>\n<p>创建 <code>hardening_plan.md</code>：</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\"># 安全加固计划</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 目标系统</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> 系统: Ubuntu 20.04 / Windows Server 2019</span><br><span class=\"line\"><span class=\"bullet\">-</span> IP: 192.168.1.10</span><br><span class=\"line\"><span class=\"bullet\">-</span> 主要服务: Nginx, MySQL, SSH</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 发现的问题</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 高危问题</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">1.</span> <span class=\"strong\">**问题**</span>: Server 头暴露版本信息</span><br><span class=\"line\"><span class=\"bullet\">   -</span> <span class=\"strong\">**风险等级**</span>: 中</span><br><span class=\"line\"><span class=\"bullet\">   -</span> <span class=\"strong\">**影响**</span>: 攻击者可精确匹配 CVE</span><br><span class=\"line\"><span class=\"bullet\">   -</span> <span class=\"strong\">**修复方案**</span>: 配置 <span class=\"code\">`server_tokens off;`</span></span><br><span class=\"line\"><span class=\"bullet\">   -</span> <span class=\"strong\">**预计影响**</span>: 无</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">2.</span> <span class=\"strong\">**问题**</span>: 缺少安全响应头</span><br><span class=\"line\"><span class=\"bullet\">   -</span> <span class=\"strong\">**风险等级**</span>: 高</span><br><span class=\"line\"><span class=\"bullet\">   -</span> <span class=\"strong\">**影响**</span>: 易受点击劫持、XSS 攻击</span><br><span class=\"line\"><span class=\"bullet\">   -</span> <span class=\"strong\">**修复方案**</span>: 添加 X-Frame-Options、X-Content-Type-Options 等</span><br><span class=\"line\"><span class=\"bullet\">   -</span> <span class=\"strong\">**预计影响**</span>: 可能影响某些旧浏览器</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 中危问题</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">1.</span> <span class=\"strong\">**问题**</span>: SSH 允许 root 登录</span><br><span class=\"line\"><span class=\"bullet\">   -</span> <span class=\"strong\">**风险等级**</span>: 中</span><br><span class=\"line\"><span class=\"bullet\">   -</span> <span class=\"strong\">**修复方案**</span>: 禁用 PermitRootLogin</span><br><span class=\"line\"><span class=\"bullet\">   -</span> <span class=\"strong\">**预计影响**</span>: 需要使用 sudo 账户</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 加固实施计划</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 序号 | 加固项 | 配置文件 | 预计时间 | 回滚方案 |</span><br><span class=\"line\">|------|--------|---------|---------|---------|</span><br><span class=\"line\">| 1 | 隐藏版本信息 | /etc/nginx/nginx.conf | 5 分钟 | 恢复配置文件 |</span><br><span class=\"line\">| 2 | 添加安全响应头 | /etc/nginx/nginx.conf | 5 分钟 | 恢复配置文件 |</span><br><span class=\"line\">| 3 | 禁用 SSH root 登录 | /etc/ssh/sshd<span class=\"emphasis\">_config | 5 分钟 | 恢复配置文件 |</span></span><br><span class=\"line\"><span class=\"emphasis\">| 4 | 调整密码策略 | /etc/login.defs | 10 分钟 | 恢复配置文件 |</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">## 回滚预案</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">- 备份配置文件到 `baseline/`</span></span><br><span class=\"line\"><span class=\"emphasis\">- 每次加固前单独备份</span></span><br><span class=\"line\"><span class=\"emphasis\">- 如果服务无法启动，立即回滚</span></span><br><span class=\"line\"><span class=\"emphasis\">- 如果业务功能异常，评估是否回滚</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-4（必做）：执行安全加固\"><a href=\"#任务-4（必做）：执行安全加固\" class=\"headerlink\" title=\"任务 4（必做）：执行安全加固\"></a>任务 4（必做）：执行安全加固</h3><p><strong>目标</strong>：按照加固计划，逐一实施加固措施。</p>\n<p><strong>步骤</strong>：</p>\n<ol>\n<li><strong>备份当前配置</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 创建加固目录</span></span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> -p ~/week4_experiment/hardening</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 备份配置</span></span><br><span class=\"line\">sudo <span class=\"built_in\">cp</span> /etc/nginx/nginx.conf hardening/nginx.conf.backup</span><br><span class=\"line\">sudo <span class=\"built_in\">cp</span> /etc/ssh/sshd_config hardening/sshd_config.backup</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><strong>实施加固措施</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Web 中间件加固</span></span><br><span class=\"line\">sudo nano /etc/nginx/nginx.conf</span><br><span class=\"line\"><span class=\"comment\"># 添加:</span></span><br><span class=\"line\"><span class=\"comment\"># server_tokens off;</span></span><br><span class=\"line\"><span class=\"comment\"># add_header X-Frame-Options &quot;SAMEORIGIN&quot; always;</span></span><br><span class=\"line\"><span class=\"comment\"># add_header X-Content-Type-Options &quot;nosniff&quot; always;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># SSH 加固</span></span><br><span class=\"line\">sudo nano /etc/ssh/sshd_config</span><br><span class=\"line\"><span class=\"comment\"># 修改:</span></span><br><span class=\"line\"><span class=\"comment\"># PermitRootLogin no</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 测试配置</span></span><br><span class=\"line\">sudo nginx -t</span><br><span class=\"line\">sudo sshd -t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重启服务</span></span><br><span class=\"line\">sudo systemctl restart nginx</span><br><span class=\"line\">sudo systemctl restart sshd</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><strong>验证服务状态</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">systemctl status nginx</span><br><span class=\"line\">systemctl status sshd</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 测试 Web 访问</span></span><br><span class=\"line\">curl -I http://localhost/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 测试 SSH 连接</span></span><br><span class=\"line\">ssh -o PreferredAuthentications=publickey root@localhost</span><br><span class=\"line\"><span class=\"comment\"># 应该拒绝连接</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-5（必做）：加固后复验扫描\"><a href=\"#任务-5（必做）：加固后复验扫描\" class=\"headerlink\" title=\"任务 5（必做）：加固后复验扫描\"></a>任务 5（必做）：加固后复验扫描</h3><p><strong>目标</strong>：执行加固后的完整基线扫描，对比加固效果。</p>\n<p><strong>步骤</strong>：</p>\n<ol>\n<li><strong>执行复验扫描</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> baseline_checker</span><br><span class=\"line\">python main.py --config config/targets.json --output ../week4_experiment/retest</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><strong>对比加固效果</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">python compare_reports.py \\</span><br><span class=\"line\">    ../week4_experiment/baseline/baseline_report_*.json \\</span><br><span class=\"line\">    ../week4_experiment/retest/baseline_report_*.json</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><strong>业务回归测试</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 测试首页访问</span></span><br><span class=\"line\">curl http://localhost/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 测试静态资源</span></span><br><span class=\"line\">curl http://localhost/style.css</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 测试功能（如果有）</span></span><br><span class=\"line\">curl http://localhost/api/status</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 浏览器测试</span></span><br><span class=\"line\"><span class=\"comment\"># 打开 http://localhost 验证页面正常</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-6（必做）：撰写变更记录\"><a href=\"#任务-6（必做）：撰写变更记录\" class=\"headerlink\" title=\"任务 6（必做）：撰写变更记录\"></a>任务 6（必做）：撰写变更记录</h3><p><strong>目标</strong>：根据实际执行情况，撰写完整的变更记录。</p>\n<p>**创建 <code>change_record_CR-2026-W4.md</code>**：</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\"># 安全配置变更记录 - 第 4 周综合实验</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 基本信息</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 项目 | 内容 |</span><br><span class=\"line\">|------|------|</span><br><span class=\"line\">| 变更编号 | CR-2026-W4 |</span><br><span class=\"line\">| 变更标题 | 综合安全加固实验 |</span><br><span class=\"line\">| 申请人 | [你的姓名] |</span><br><span class=\"line\">| 执行日期 | 2026-01-21 |</span><br><span class=\"line\">| 影响系统 | 本地测试服务器 |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 变更内容</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 序号 | 变更项 | 风险等级 | 状态 |</span><br><span class=\"line\">|------|--------|---------|------|</span><br><span class=\"line\">| 1 | 隐藏 Nginx 版本信息 | 低 | ✅ 已完成 |</span><br><span class=\"line\">| 2 | 添加安全响应头 | 中 | ✅ 已完成 |</span><br><span class=\"line\">| 3 | 禁用 SSH root 登录 | 中 | ✅ 已完成 |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 复验结果</span></span><br><span class=\"line\"></span><br><span class=\"line\">加固前通过率: 33.3% (1/3)</span><br><span class=\"line\">加固后通过率: 100% (3/3)</span><br><span class=\"line\">通过率提升: +66.7%</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 业务回归测试</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 测试项 | 结果 |</span><br><span class=\"line\">|--------|------|</span><br><span class=\"line\">| 首页访问 | ✅ 正常 |</span><br><span class=\"line\">| SSH 登录（非 root）| ✅ 正常 |</span><br><span class=\"line\">| SSH 登录（root） | ❌ 已禁用 |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 总结</span></span><br><span class=\"line\"></span><br><span class=\"line\">本次综合实验成功完成，加固措施全部生效，业务功能正常。</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-7（必做）：撰写周报\"><a href=\"#任务-7（必做）：撰写周报\" class=\"headerlink\" title=\"任务 7（必做）：撰写周报\"></a>任务 7（必做）：撰写周报</h3><p><strong>目标</strong>：汇总本周所有实验成果，撰写完整周报。</p>\n<p>**创建 <code>week4_report.md</code>**，按照本节”学习内容 4.1”的模板填写。</p>\n<p><strong>必填内容</strong>：</p>\n<ol>\n<li>本周学习内容概览（填写完成状态和耗时）</li>\n<li>实验成果汇总（漏洞扫描、基线检查、加固措施统计）</li>\n<li>典型案例分析（至少 2 个案例）</li>\n<li>误报与漏报处理（如有）</li>\n<li>遇到的问题与解决方案</li>\n<li>本周收获与感悟</li>\n<li>不足与改进计划</li>\n<li>下周学习计划</li>\n</ol>\n<p><strong>附件清单</strong>：</p>\n<ul>\n<li>加固前基线报告</li>\n<li>加固后复验报告</li>\n<li>加固效果对比报告</li>\n<li>变更记录文档</li>\n<li>配置文件备份</li>\n<li>截图证据</li>\n</ul>\n<hr>\n<h2 id=\"巩固练习（题与复盘）\"><a href=\"#巩固练习（题与复盘）\" class=\"headerlink\" title=\"巩固练习（题与复盘）\"></a>巩固练习（题与复盘）</h2><hr>\n<h3 id=\"练习-1：本周最易忽视的风险是什么？\"><a href=\"#练习-1：本周最易忽视的风险是什么？\" class=\"headerlink\" title=\"练习 1：本周最易忽视的风险是什么？\"></a>练习 1：本周最易忽视的风险是什么？</h3><p><strong>思路提示</strong>：</p>\n<ul>\n<li>常见误区：只关注高危漏洞，忽视中低危问题</li>\n<li>业务影响：某些中低危问题组合可能导致严重后果</li>\n<li>防御深度：单一加固措施可能不够，需要多层防御</li>\n</ul>\n<hr>\n<h3 id=\"练习-2：完善加固检查清单\"><a href=\"#练习-2：完善加固检查清单\" class=\"headerlink\" title=\"练习 2：完善加固检查清单\"></a>练习 2：完善加固检查清单</h3><p><strong>任务</strong>：根据本周所学，完善以下检查清单。</p>\n<p><strong>示例</strong>：</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">## 加固前检查清单</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 确认授权范围</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 确定维护窗口</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 备份配置文件</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 记录服务状态</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 准备回滚方案</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] <span class=\"strong\">__<span class=\"emphasis\">_（请补充）</span></span></span><br><span class=\"line\"><span class=\"emphasis\"><span class=\"strong\"></span></span></span><br><span class=\"line\"><span class=\"emphasis\"><span class=\"strong\">## 加固后检查清单</span></span></span><br><span class=\"line\"><span class=\"emphasis\"><span class=\"strong\"></span></span></span><br><span class=\"line\"><span class=\"emphasis\"><span class=\"strong\">- [ ] 配置文件语法检查</span></span></span><br><span class=\"line\"><span class=\"emphasis\"><span class=\"strong\">- [ ] 服务重启成功</span></span></span><br><span class=\"line\"><span class=\"emphasis\"><span class=\"strong\">- [ ] 基线检查通过</span></span></span><br><span class=\"line\"><span class=\"emphasis\"><span class=\"strong\">- [ ] 业务回归测试通过</span></span></span><br><span class=\"line\"><span class=\"emphasis\"><span class=\"strong\">- [ ] 日志无异常</span></span></span><br><span class=\"line\"><span class=\"emphasis\"><span class=\"strong\">- [ ] _</span>__</span>（请补充）</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"练习-3：设计自动化加固工具\"><a href=\"#练习-3：设计自动化加固工具\" class=\"headerlink\" title=\"练习 3：设计自动化加固工具\"></a>练习 3：设计自动化加固工具</h3><p><strong>任务</strong>：设计一个工具，自动执行扫描 → 基线 → 加固 → 复验的流程。</p>\n<p><strong>思路提示</strong>：</p>\n<ul>\n<li>模块化设计：扫描模块、基线模块、加固模块、复验模块</li>\n<li>配置化：加固策略可配置</li>\n<li>可回滚：自动备份配置，失败时自动回滚</li>\n<li>报告生成：自动生成加固前后对比报告</li>\n</ul>\n<hr>\n<h3 id=\"练习-4：评估加固措施的-ROI（投资回报率）\"><a href=\"#练习-4：评估加固措施的-ROI（投资回报率）\" class=\"headerlink\" title=\"练习 4：评估加固措施的 ROI（投资回报率）\"></a>练习 4：评估加固措施的 ROI（投资回报率）</h3><p><strong>任务</strong>：对本周实施的加固措施进行 ROI 评估。</p>\n<p><strong>评估框架</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>加固项</th>\n<th>实施成本</th>\n<th>风险降低</th>\n<th>业务影响</th>\n<th>ROI 评分</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>隐藏版本信息</td>\n<td>5 分钟</td>\n<td>低</td>\n<td>无</td>\n<td>高</td>\n</tr>\n<tr>\n<td>添加安全响应头</td>\n<td>5 分钟</td>\n<td>中</td>\n<td>低</td>\n<td>高</td>\n</tr>\n<tr>\n<td>禁用 SSH root</td>\n<td>5 分钟</td>\n<td>中</td>\n<td>低</td>\n<td>高</td>\n</tr>\n</tbody></table>\n<p><strong>ROI 计算公式</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">ROI = (风险降低 × 影响范围) / (实施成本 + 业务影响)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"评估标准（达成判定）\"><a href=\"#评估标准（达成判定）\" class=\"headerlink\" title=\"评估标准（达成判定）\"></a>评估标准（达成判定）</h2><ul>\n<li>✅ 完成了加固前的基线扫描</li>\n<li>✅ 制定并执行了完整的加固方案</li>\n<li>✅ 完成了加固后的复验扫描</li>\n<li>✅ 生成了加固效果对比报告</li>\n<li>✅ 完成了业务回归测试</li>\n<li>✅ 撰写了变更记录文档</li>\n<li>✅ 撰写了完整的周报</li>\n<li>✅ 周报逻辑清晰、证据充分</li>\n<li>✅ 提出了可执行的改进计划</li>\n</ul>\n<hr>\n<h2 id=\"学习成果达成情况（由学习者填写）\"><a href=\"#学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"学习成果达成情况（由学习者填写）\"></a>学习成果达成情况（由学习者填写）</h2><hr>\n<h3 id=\"截图与证据\"><a href=\"#截图与证据\" class=\"headerlink\" title=\"截图与证据\"></a>截图与证据</h3><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 实验目标系统截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 加固前基线扫描输出</li>\n<li><input disabled=\"\" type=\"checkbox\"> 加固方案文档（hardening_plan.md）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 加固后复验扫描输出</li>\n<li><input disabled=\"\" type=\"checkbox\"> 加固效果对比报告</li>\n<li><input disabled=\"\" type=\"checkbox\"> 业务回归测试截图</li>\n<li><input disabled=\"\" type=\"checkbox\"> 变更记录文档（change_record_CR-2026-W4.md）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 周报文档（week4_report.md）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 配置文件备份</li>\n</ul>\n<hr>\n<h3 id=\"关键命令与输出（粘贴关键片段）\"><a href=\"#关键命令与输出（粘贴关键片段）\" class=\"headerlink\" title=\"关键命令与输出（粘贴关键片段）\"></a>关键命令与输出（粘贴关键片段）</h3><p><strong>加固前扫描</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ python main.py --config config/targets.json --output baseline</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">扫描目标: 本机测试 (web)</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">  ❌ [版本信息泄露] 发现版本信息泄露</span><br><span class=\"line\">  ❌ [安全响应头检查] 缺少 3 个安全响应头</span><br><span class=\"line\">  ✅ [目录列出检查] 未发现目录列出</span><br><span class=\"line\"></span><br><span class=\"line\">通过率: 33.3% (1/3)</span><br></pre></td></tr></table></figure>\n\n<p><strong>加固配置</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ sudo nano /etc/nginx/nginx.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 添加的配置:</span></span><br><span class=\"line\">server_tokens off;</span><br><span class=\"line\">add_header X-Frame-Options <span class=\"string\">&quot;SAMEORIGIN&quot;</span> always;</span><br><span class=\"line\">add_header X-Content-Type-Options <span class=\"string\">&quot;nosniff&quot;</span> always;</span><br><span class=\"line\">add_header X-XSS-Protection <span class=\"string\">&quot;1; mode=block&quot;</span> always;</span><br></pre></td></tr></table></figure>\n\n<p><strong>加固后扫描</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ python main.py --config config/targets.json --output retest</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">扫描目标: 本机测试 (web)</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">  ✅ [版本信息泄露] 未发现版本信息泄露</span><br><span class=\"line\">  ✅ [安全响应头检查] 所有安全响应头已配置</span><br><span class=\"line\">  ✅ [目录列出检查] 未发现目录列出</span><br><span class=\"line\"></span><br><span class=\"line\">通过率: 100% (3/3)</span><br></pre></td></tr></table></figure>\n\n<p><strong>加固效果对比</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ python compare_reports.py before.json after.json</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">加固效果对比报告</span><br><span class=\"line\">============================================================</span><br><span class=\"line\"></span><br><span class=\"line\">✅ 已修复 (2 个)</span><br><span class=\"line\">  + 版本信息泄露</span><br><span class=\"line\">  + 安全响应头检查</span><br><span class=\"line\"></span><br><span class=\"line\">通过率提升: 33.3% → 100.0% (+66.7%)</span><br><span class=\"line\">============================================================</span><br></pre></td></tr></table></figure>\n\n<p><strong>业务回归测试</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ curl -I http://localhost/</span><br><span class=\"line\">HTTP/1.1 200 OK</span><br><span class=\"line\">Server: nginx</span><br><span class=\"line\">Date: Wed, 21 Jan 2026 14:00:00 GMT</span><br><span class=\"line\">X-Frame-Options: SAMEORIGIN</span><br><span class=\"line\">X-Content-Type-Options: nosniff</span><br><span class=\"line\">X-XSS-Protection: 1; mode=block</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"结论与反思\"><a href=\"#结论与反思\" class=\"headerlink\" title=\"结论与反思\"></a>结论与反思</h3><p><strong>本周学习总结</strong>：</p>\n<ul>\n<li>掌握了完整的漏洞扫描、基线检查、安全加固、复验验证的闭环流程</li>\n<li>理解了 CVE&#x2F;CWE&#x2F;CVSS 三大编号体系的实际应用</li>\n<li>学会了使用 Nessus 进行漏洞扫描和报告解读</li>\n<li>掌握了系统基线检查和 Web 中间件加固的方法</li>\n<li>学会了编写自动化基线检查脚本</li>\n<li>理解了加固复验和变更记录的重要性</li>\n</ul>\n<p><strong>技术收获</strong>：</p>\n<ol>\n<li>Nginx 安全响应头配置</li>\n<li>SSH 安全加固（禁用 root 登录）</li>\n<li>自动化基线检查脚本开发</li>\n<li>加固效果对比分析</li>\n<li>变更记录文档撰写</li>\n</ol>\n<p><strong>思维转变</strong>：</p>\n<ul>\n<li>从”单点加固”到”系统化加固”</li>\n<li>从”手动操作”到”自动化工具”</li>\n<li>从”临时修复”到”标准化流程”</li>\n<li>从”发现问题”到”解决问题”</li>\n</ul>\n<p><strong>遇到的问题与解决</strong>：</p>\n<ol>\n<li>扫描结果过多 → 只关注高危问题（CVSS ≥ 7.0）</li>\n<li>加固后服务无法启动 → 使用 <code>nginx -t</code> 检查语法</li>\n<li>复验结果无变化 → 确认服务已重启</li>\n<li>脚本报错 → 检查依赖库是否安装</li>\n</ol>\n<p><strong>本周不足</strong>：</p>\n<ul>\n<li>对部分 CVE 的原理理解不够深入</li>\n<li>自动化工具集成程度有待提高</li>\n<li>缺乏真实企业环境的实战经验</li>\n</ul>\n<p><strong>下周改进计划</strong>：</p>\n<ol>\n<li>选择 3-5 个经典漏洞深入分析</li>\n<li>开发一站式自动化加固工具</li>\n<li>使用 Hack The Box 进行实战练习</li>\n<li>学习 WAF 原理与部署</li>\n</ol>\n<p><strong>本次实验耗时</strong>：约 5 小时（包含周报撰写）</p>\n<p><strong>掌握程度自评</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 😕 理解了基本概念，但实践不熟练</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🙂 完成了基础任务</li>\n<li><input disabled=\"\" type=\"checkbox\"> 😃 完成了所有任务并理解原理</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🤩 额外开发了自动化工具或深入研究了某个方向</li>\n</ul>\n<hr>\n<h2 id=\"集中参考答案（含思路）\"><a href=\"#集中参考答案（含思路）\" class=\"headerlink\" title=\"集中参考答案（含思路）\"></a>集中参考答案（含思路）</h2><hr>\n<h3 id=\"练习-1-参考答案：本周最易忽视的风险是什么？\"><a href=\"#练习-1-参考答案：本周最易忽视的风险是什么？\" class=\"headerlink\" title=\"练习 1 参考答案：本周最易忽视的风险是什么？\"></a>练习 1 参考答案：本周最易忽视的风险是什么？</h3><p><strong>易忽视的风险类型</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>风险类型</th>\n<th>为什么易忽视</th>\n<th>潜在危害</th>\n<th>防御措施</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>信息级风险</strong></td>\n<td>认为不是漏洞，不需要修复</td>\n<td>帮助攻击者制定攻击策略</td>\n<td>隐藏 Banner、敏感文件</td>\n</tr>\n<tr>\n<td><strong>组合风险</strong></td>\n<td>单独看风险不大</td>\n<td>组合利用可造成严重后果</td>\n<td>多层防御、减少攻击面</td>\n</tr>\n<tr>\n<td><strong>配置风险</strong></td>\n<td>不是代码漏洞</td>\n<td>默认配置可能引入安全漏洞</td>\n<td>强化配置、遵循最佳实践</td>\n</tr>\n<tr>\n<td><strong>依赖风险</strong></td>\n<td>依赖第三方组件</td>\n<td>第三方组件漏洞影响整体安全</td>\n<td>定期更新、依赖扫描</td>\n</tr>\n<tr>\n<td><strong>人为风险</strong></td>\n<td>技术问题容易引起注意</td>\n<td>社会工程、钓鱼攻击不易发现</td>\n<td>安全培训、权限最小化</td>\n</tr>\n</tbody></table>\n<p><strong>示例：组合风险的危害</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">风险 A: 目录列出（低危）</span><br><span class=\"line\">风险 B: 备份文件包含数据库密码（高危）</span><br><span class=\"line\">风险 C: SSH 弱密码（中危）</span><br><span class=\"line\"></span><br><span class=\"line\">单独看:</span><br><span class=\"line\">- 风险 A: 低危</span><br><span class=\"line\">- 风险 B: 高危</span><br><span class=\"line\">- 风险 C: 中危</span><br><span class=\"line\"></span><br><span class=\"line\">组合利用:</span><br><span class=\"line\">1. 通过风险 A 发现备份文件</span><br><span class=\"line\">2. 下载备份文件，获取数据库密码</span><br><span class=\"line\">3. 使用风险 C 登录服务器</span><br><span class=\"line\">4. 结果: 服务器被完全控制</span><br></pre></td></tr></table></figure>\n\n<p><strong>结论</strong>：</p>\n<ol>\n<li><p><strong>信息级风险不容忽视</strong>：Banner 泄露、敏感文件暴露等信息虽然单独不算高危，但可能成为攻击链的重要一环。</p>\n</li>\n<li><p><strong>组合攻击更危险</strong>：多个低&#x2F;中危漏洞组合利用，可能达到高危甚至严重后果。</p>\n</li>\n<li><p><strong>防御需要深度</strong>：单一防护措施容易被绕过，需要多层防御（Defense in Depth）。</p>\n</li>\n<li><p><strong>定期全面检查</strong>：不能只关注高危漏洞，中低危问题也需要定期评估和修复。</p>\n</li>\n</ol>\n<hr>\n<h3 id=\"练习-2-参考答案：完善加固检查清单\"><a href=\"#练习-2-参考答案：完善加固检查清单\" class=\"headerlink\" title=\"练习 2 参考答案：完善加固检查清单\"></a>练习 2 参考答案：完善加固检查清单</h3><p><strong>加固前检查清单（完整版）</strong>：</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">## 加固前检查清单</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 授权与准备</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 确认目标在授权范围内</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 确认维护窗口并获得相关方同意</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 备份所有配置文件</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 记录服务正常运行状态</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 准备回滚方案和回滚命令</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 通知相关用户维护窗口</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 基线扫描</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 执行漏洞扫描（Nessus/OpenVAS）</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 执行基线检查（系统/中间件）</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 导出扫描报告（PDF/CSV/JSON）</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 记录高危漏洞（CVSS ≥ 7.0）</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 记录基线检查失败项</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 分析误报和漏报</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 风险评估</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 评估加固措施的业务影响</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 评估加固失败的风险</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 制定优先级（高危优先）</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 准备测试环境验证（如需要）</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 制定应急响应预案</span><br></pre></td></tr></table></figure>\n\n<p><strong>加固后检查清单（完整版）</strong>：</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">## 加固后检查清单</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 配置验证</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 配置文件语法检查（nginx -t, sshd -t）</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 服务重启成功</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 服务状态正常（systemctl status）</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 端口监听正常（ss -tlnp）</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 功能验证</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 首页访问正常</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 核心功能正常</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] API 端点正常（如有）</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 静态资源加载正常</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 数据库连接正常（如有）</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 安全复验</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 重新执行漏洞扫描</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 重新执行基线检查</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 对比加固前后结果</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 确认高危问题已修复</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 检查是否引入新问题</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 业务回归测试</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 用户登录功能正常</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 数据提交功能正常</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 文件上传功能正常（如有）</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 跨域请求正常（如有）</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 浏览器兼容性测试（Chrome/Firefox/Safari）</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 监控与日志</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 检查错误日志无异常增加</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 检查访问日志流量正常</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 检查性能指标（响应时间、CPU/内存）</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 配置监控告警（如需要）</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 观察 24 小时（生产环境）</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">### 文档与归档</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 撰写变更记录文档</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 保存配置文件备份</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 保存扫描报告</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 保存测试结果和截图</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 更新资产管理台账</span><br><span class=\"line\"><span class=\"bullet\">-</span> [ ] 归档到知识库</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"练习-3-参考答案：设计自动化加固工具\"><a href=\"#练习-3-参考答案：设计自动化加固工具\" class=\"headerlink\" title=\"练习 3 参考答案：设计自动化加固工具\"></a>练习 3 参考答案：设计自动化加固工具</h3><p><strong>工具架构设计</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">自动化安全加固工具 (Auto-Harden)</span><br><span class=\"line\">│</span><br><span class=\"line\">├─ 配置层</span><br><span class=\"line\">│  ├─ targets.yaml       # 目标列表</span><br><span class=\"line\">│  ├─ rules.yaml         # 加固规则</span><br><span class=\"line\">│  └─ thresholds.yaml    # 风险阈值</span><br><span class=\"line\">│</span><br><span class=\"line\">├─ 扫描层</span><br><span class=\"line\">│  ├─ vulnerability_scanner.py  # 漏洞扫描模块</span><br><span class=\"line\">│  ├─ baseline_checker.py       # 基线检查模块</span><br><span class=\"line\">│  └─ port_scanner.py          # 端口扫描模块</span><br><span class=\"line\">│</span><br><span class=\"line\">├─ 加固层</span><br><span class=\"line\">│  ├─ hardening_engine.py      # 加固引擎</span><br><span class=\"line\">│  ├─ rule_processor.py       # 规则处理器</span><br><span class=\"line\">│  └─ backup_manager.py       # 备份管理</span><br><span class=\"line\">│</span><br><span class=\"line\">├─ 验证层</span><br><span class=\"line\">│  ├─ verification.py       # 验证模块</span><br><span class=\"line\">│  ├─ regression_test.py    # 回归测试</span><br><span class=\"line\">│  └─ diff_generator.py    # 差异分析</span><br><span class=\"line\">│</span><br><span class=\"line\">├─ 报告层</span><br><span class=\"line\">│  ├─ report_generator.py   # 报告生成</span><br><span class=\"line\">│  └─ exporter.py         # 导出器（CSV/JSON/PDF）</span><br><span class=\"line\">│</span><br><span class=\"line\">└─ CLI (命令行接口)</span><br><span class=\"line\">   └─ main.py</span><br></pre></td></tr></table></figure>\n\n<p><strong>核心代码示例</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python3</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">自动化安全加固工具</span></span><br><span class=\"line\"><span class=\"string\">用法: python auto_harden.py --target config/targets.yaml</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> argparse</span><br><span class=\"line\"><span class=\"keyword\">import</span> shutil</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">from</span> pathlib <span class=\"keyword\">import</span> Path</span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> modules.scanner <span class=\"keyword\">import</span> VulnerabilityScanner, BaselineChecker</span><br><span class=\"line\"><span class=\"keyword\">from</span> modules.hardening <span class=\"keyword\">import</span> HardeningEngine, BackupManager</span><br><span class=\"line\"><span class=\"keyword\">from</span> modules.verification <span class=\"keyword\">import</span> VerificationEngine</span><br><span class=\"line\"><span class=\"keyword\">from</span> modules.report <span class=\"keyword\">import</span> ReportGenerator</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">main</span>():</span><br><span class=\"line\">    parser = argparse.ArgumentParser(description=<span class=\"string\">&quot;自动化安全加固工具&quot;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&quot;--target&quot;</span>, <span class=\"string\">&quot;-t&quot;</span>, required=<span class=\"literal\">True</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;目标配置文件&quot;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&quot;--backup-dir&quot;</span>, <span class=\"string\">&quot;-b&quot;</span>, default=<span class=\"string\">&quot;backups&quot;</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;备份目录&quot;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&quot;--output&quot;</span>, <span class=\"string\">&quot;-o&quot;</span>, default=<span class=\"string\">&quot;reports&quot;</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;报告输出目录&quot;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&quot;--dry-run&quot;</span>, <span class=\"string\">&quot;-d&quot;</span>, action=<span class=\"string\">&quot;store_true&quot;</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;仅模拟执行，不实际修改&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    args = parser.parse_args()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 初始化各模块</span></span><br><span class=\"line\">    backup_mgr = BackupManager(args.backup_dir)</span><br><span class=\"line\">    vuln_scanner = VulnerabilityScanner()</span><br><span class=\"line\">    baseline_checker = BaselineChecker()</span><br><span class=\"line\">    hardening_engine = HardeningEngine(backup_mgr, dry_run=args.dry_run)</span><br><span class=\"line\">    verifier = VerificationEngine()</span><br><span class=\"line\">    report_gen = ReportGenerator(args.output)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;=&quot;</span> * <span class=\"number\">60</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;自动化安全加固工具&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;=&quot;</span> * <span class=\"number\">60</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;目标配置: <span class=\"subst\">&#123;args.target&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;备份目录: <span class=\"subst\">&#123;args.backup_dir&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;输出目录: <span class=\"subst\">&#123;args.output&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;模拟执行: <span class=\"subst\">&#123;args.dry_run&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;=&quot;</span> * <span class=\"number\">60</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 阶段 1: 扫描</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;\\n[阶段 1/5] 执行扫描...&quot;</span>)</span><br><span class=\"line\">    vuln_results = vuln_scanner.scan(args.target)</span><br><span class=\"line\">    baseline_results = baseline_checker.check(args.target)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;  发现漏洞: <span class=\"subst\">&#123;<span class=\"built_in\">len</span>(vuln_results)&#125;</span> 个&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;  基线检查: <span class=\"subst\">&#123;<span class=\"built_in\">len</span>([r <span class=\"keyword\">for</span> r <span class=\"keyword\">in</span> baseline_results <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> r.passed])&#125;</span> 个失败&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 阶段 2: 分析</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;\\n[阶段 2/5] 分析结果...&quot;</span>)</span><br><span class=\"line\">    hardening_plan = hardening_engine.analyze(vuln_results, baseline_results)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;  生成加固计划: <span class=\"subst\">&#123;<span class=\"built_in\">len</span>(hardening_plan.rules)&#125;</span> 条规则&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 阶段 3: 加固</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;\\n[阶段 3/5] 执行加固...&quot;</span>)</span><br><span class=\"line\">    backup_id = backup_mgr.create_backup()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;  备份 ID: <span class=\"subst\">&#123;backup_id&#125;</span>&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    hardening_results = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> rule <span class=\"keyword\">in</span> hardening_plan.rules:</span><br><span class=\"line\">        result = hardening_engine.apply(rule)</span><br><span class=\"line\">        hardening_results.append(result)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;  [<span class=\"subst\">&#123;result.status&#125;</span>] <span class=\"subst\">&#123;rule.description&#125;</span>&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 阶段 4: 验证</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;\\n[阶段 4/5] 验证加固...&quot;</span>)</span><br><span class=\"line\">    verification_results = verifier.verify(args.target)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;  验证通过: <span class=\"subst\">&#123;<span class=\"built_in\">len</span>([r <span class=\"keyword\">for</span> r <span class=\"keyword\">in</span> verification_results <span class=\"keyword\">if</span> r.passed])&#125;</span>/<span class=\"subst\">&#123;<span class=\"built_in\">len</span>(verification_results)&#125;</span>&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 阶段 5: 回归测试</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;\\n[阶段 5/5] 回归测试...&quot;</span>)</span><br><span class=\"line\">    regression_results = verifier.regression_test(args.target)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;  回归测试: <span class=\"subst\">&#123;<span class=\"built_in\">len</span>([r <span class=\"keyword\">for</span> r <span class=\"keyword\">in</span> regression_results <span class=\"keyword\">if</span> r.passed])&#125;</span>/<span class=\"subst\">&#123;<span class=\"built_in\">len</span>(regression_results)&#125;</span>&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 生成报告</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;\\n生成报告...&quot;</span>)</span><br><span class=\"line\">    report = report_gen.generate(</span><br><span class=\"line\">        scan_results=(vuln_results, baseline_results),</span><br><span class=\"line\">        hardening_results=hardening_results,</span><br><span class=\"line\">        verification_results=verification_results,</span><br><span class=\"line\">        regression_results=regression_results,</span><br><span class=\"line\">        backup_id=backup_id</span><br><span class=\"line\">    )</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;\\n报告已生成: <span class=\"subst\">&#123;report&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;=&quot;</span> * <span class=\"number\">60</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;加固流程完成！&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;=&quot;</span> * <span class=\"number\">60</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure>\n\n<p><strong>规则配置示例（rules.yaml）</strong>：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">&quot;隐藏 Nginx 版本信息&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">severity:</span> <span class=\"string\">&quot;low&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">target_type:</span> <span class=\"string\">&quot;web&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">action:</span> <span class=\"string\">&quot;config_modify&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">config_file:</span> <span class=\"string\">&quot;/etc/nginx/nginx.conf&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">config_path:</span> <span class=\"string\">&quot;http.server_tokens&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">value:</span> <span class=\"string\">&quot;off&quot;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">&quot;添加 X-Frame-Options 响应头&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">severity:</span> <span class=\"string\">&quot;medium&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">target_type:</span> <span class=\"string\">&quot;web&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">action:</span> <span class=\"string\">&quot;config_add&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">config_file:</span> <span class=\"string\">&quot;/etc/nginx/nginx.conf&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">config_path:</span> <span class=\"string\">&quot;http.add_header&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">value:</span> <span class=\"string\">&quot;X-Frame-Options \\&quot;SAMEORIGIN\\&quot; always&quot;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">&quot;禁用 SSH root 登录&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">severity:</span> <span class=\"string\">&quot;medium&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">target_type:</span> <span class=\"string\">&quot;ssh&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">action:</span> <span class=\"string\">&quot;config_modify&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">config_file:</span> <span class=\"string\">&quot;/etc/ssh/sshd_config&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">config_path:</span> <span class=\"string\">&quot;PermitRootLogin&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">value:</span> <span class=\"string\">&quot;no&quot;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"练习-4-参考答案：评估加固措施的-ROI\"><a href=\"#练习-4-参考答案：评估加固措施的-ROI\" class=\"headerlink\" title=\"练习 4 参考答案：评估加固措施的 ROI\"></a>练习 4 参考答案：评估加固措施的 ROI</h3><p><strong>ROI 评估表</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>加固项</th>\n<th>实施成本</th>\n<th>风险降低</th>\n<th>业务影响</th>\n<th>影响范围</th>\n<th>ROI 评分</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>隐藏版本信息</td>\n<td>5 分钟</td>\n<td>低（减少信息泄露）</td>\n<td>无</td>\n<td>全局</td>\n<td>⭐⭐⭐⭐⭐</td>\n</tr>\n<tr>\n<td>添加安全响应头</td>\n<td>5 分钟</td>\n<td>中（防御 XSS&#x2F;点击劫持）</td>\n<td>低</td>\n<td>全局</td>\n<td>⭐⭐⭐⭐⭐</td>\n</tr>\n<tr>\n<td>禁用 SSH root</td>\n<td>5 分钟</td>\n<td>中（减少暴力破解）</td>\n<td>低</td>\n<td>全局</td>\n<td>⭐⭐⭐⭐⭐</td>\n</tr>\n<tr>\n<td>调整密码策略</td>\n<td>10 分钟</td>\n<td>中（提高账户安全）</td>\n<td>中（可能影响用户）</td>\n<td>全局</td>\n<td>⭐⭐⭐⭐</td>\n</tr>\n<tr>\n<td>更新系统补丁</td>\n<td>30 分钟</td>\n<td>高（修复已知漏洞）</td>\n<td>高（可能需要重启）</td>\n<td>全局</td>\n<td>⭐⭐⭐⭐</td>\n</tr>\n<tr>\n<td>配置防火墙规则</td>\n<td>15 分钟</td>\n<td>高（限制攻击面）</td>\n<td>中（可能阻断合法流量）</td>\n<td>全局</td>\n<td>⭐⭐⭐⭐</td>\n</tr>\n<tr>\n<td>关闭不必要端口</td>\n<td>5 分钟</td>\n<td>中（减少攻击面）</td>\n<td>低（影响小众功能）</td>\n<td>特定服务</td>\n<td>⭐⭐⭐</td>\n</tr>\n<tr>\n<td>启用 SELinux</td>\n<td>20 分钟</td>\n<td>高（强制访问控制）</td>\n<td>高（配置复杂）</td>\n<td>全局</td>\n<td>⭐⭐⭐</td>\n</tr>\n<tr>\n<td>配置日志审计</td>\n<td>15 分钟</td>\n<td>中（便于事后溯源）</td>\n<td>低</td>\n<td>全局</td>\n<td>⭐⭐⭐⭐</td>\n</tr>\n</tbody></table>\n<p><strong>ROI 评分标准</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">ROI = (风险降低 × 影响范围 × 影响权重) / (实施成本 + 业务影响)</span><br><span class=\"line\"></span><br><span class=\"line\">评分:</span><br><span class=\"line\">⭐⭐⭐⭐⭐  极高 ROI (低成本、高收益、低风险)</span><br><span class=\"line\">⭐⭐⭐⭐    高 ROI</span><br><span class=\"line\">⭐⭐⭐      中等 ROI</span><br><span class=\"line\">⭐⭐        低 ROI</span><br><span class=\"line\">⭐         负 ROI (成本过高或影响过大)</span><br></pre></td></tr></table></figure>\n\n<p><strong>优先级建议</strong>：</p>\n<ol>\n<li><p><strong>P0（立即实施）</strong>：⭐⭐⭐⭐⭐</p>\n<ul>\n<li>隐藏版本信息</li>\n<li>添加安全响应头</li>\n<li>禁用 SSH root 登录</li>\n</ul>\n</li>\n<li><p><strong>P1（一周内）</strong>：⭐⭐⭐⭐</p>\n<ul>\n<li>调整密码策略</li>\n<li>更新系统补丁</li>\n<li>配置日志审计</li>\n</ul>\n</li>\n<li><p><strong>P2（一个月内）</strong>：⭐⭐⭐</p>\n<ul>\n<li>配置防火墙规则</li>\n<li>关闭不必要端口</li>\n</ul>\n</li>\n<li><p><strong>P3（计划中）</strong>：⭐⭐</p>\n<ul>\n<li>启用 SELinux（需要充分测试）</li>\n</ul>\n</li>\n</ol>\n<p><strong>结论</strong>：</p>\n<ol>\n<li><p><strong>优先实施低成本高收益的措施</strong>：隐藏版本信息、添加安全响应头等措施只需几分钟，但能显著降低信息泄露风险。</p>\n</li>\n<li><p><strong>评估业务影响</strong>：某些措施（如启用 SELinux）虽然安全性高，但配置复杂、可能影响业务，需要充分测试。</p>\n</li>\n<li><p><strong>持续优化 ROI</strong>：随着技术进步，某些措施的 ROI 可能变化，需要定期评估和调整优先级。</p>\n</li>\n</ol>\n<hr>\n<h2 id=\"学习成果示例填写（可照抄）\"><a href=\"#学习成果示例填写（可照抄）\" class=\"headerlink\" title=\"学习成果示例填写（可照抄）\"></a>学习成果示例填写（可照抄）</h2><blockquote>\n<p>可将”示例”内容替换为你自己的时间与截图文件名。</p>\n</blockquote>\n<hr>\n<h3 id=\"截图与证据（示例）\"><a href=\"#截图与证据（示例）\" class=\"headerlink\" title=\"截图与证据（示例）\"></a>截图与证据（示例）</h3><ul>\n<li>实验目标：<code>images/day028_target_system.png</code></li>\n<li>加固前扫描：<code>images/day028_before_scan.png</code></li>\n<li>加固后扫描：<code>images/day028_after_scan.png</code></li>\n<li>加固效果对比：<code>images/day028_comparison.png</code></li>\n<li>业务回归测试：<code>images/day028_regression_test.png</code></li>\n<li>变更记录：<code>change_record_CR-2026-W4.md</code></li>\n<li>周报：<code>week4_report.md</code></li>\n</ul>\n<hr>\n<h3 id=\"关键命令与输出（示例）\"><a href=\"#关键命令与输出（示例）\" class=\"headerlink\" title=\"关键命令与输出（示例）\"></a>关键命令与输出（示例）</h3><p><strong>加固前扫描</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ python main.py --config config/targets.json --output baseline</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">扫描目标: 本机测试 (web)</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">  ❌ [版本信息泄露] 发现版本信息泄露</span><br><span class=\"line\">  ❌ [安全响应头检查] 缺少 3 个安全响应头</span><br><span class=\"line\"></span><br><span class=\"line\">通过率: 33.3% (1/3)</span><br></pre></td></tr></table></figure>\n\n<p><strong>加固后扫描</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ python main.py --config config/targets.json --output retest</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">扫描目标: 本机测试 (web)</span><br><span class=\"line\">============================================================</span><br><span class=\"line\">  ✅ [版本信息泄露] 未发现版本信息泄露</span><br><span class=\"line\">  ✅ [安全响应头检查] 所有安全响应头已配置</span><br><span class=\"line\"></span><br><span class=\"line\">通过率: 100% (3/3)</span><br></pre></td></tr></table></figure>\n\n<p><strong>加固效果对比</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ python compare_reports.py before.json after.json</span><br><span class=\"line\">通过率提升: 33.3% → 100.0% (+66.7%)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"结论与反思（示例）\"><a href=\"#结论与反思（示例）\" class=\"headerlink\" title=\"结论与反思（示例）\"></a>结论与反思（示例）</h3><p><strong>本周学习总结</strong>：</p>\n<ul>\n<li>完成了从漏洞扫描、基线检查、安全加固到复验验证的完整闭环</li>\n<li>掌握了 CVE&#x2F;CWE&#x2F;CVSS 体系的实际应用</li>\n<li>学会了使用 Nessus 进行漏洞扫描</li>\n<li>掌握了系统基线和 Web 中间件加固方法</li>\n<li>开发了自动化基线检查脚本</li>\n<li>理解了加固复验和变更记录的重要性</li>\n</ul>\n<p><strong>技术收获</strong>：</p>\n<ol>\n<li>Nginx 安全响应头配置</li>\n<li>SSH 安全加固</li>\n<li>自动化脚本开发</li>\n<li>报告生成和对比分析</li>\n</ol>\n<p><strong>思维转变</strong>：</p>\n<ul>\n<li>从”单点加固”到”系统化加固”</li>\n<li>从”手动操作”到”自动化工具”</li>\n<li>从”临时修复”到”标准化流程”</li>\n</ul>\n<p><strong>不足与改进</strong>：</p>\n<ul>\n<li>深入研究 3-5 个经典漏洞原理</li>\n<li>开发一站式自动化加固工具</li>\n<li>使用 Hack The Box 进行实战练习</li>\n</ul>\n<p><strong>本次实验耗时</strong>：约 5 小时</p>\n<p><strong>掌握程度自评</strong>：</p>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> 😃 完成了所有任务并理解原理</li>\n</ul>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]},{"title":"Day029：日志与可观测性 - 日志类型与字段规范","url":"/post/8abede0b.html","content":"<h1 id=\"Day029：日志与可观测性-日志类型与字段规范\"><a href=\"#Day029：日志与可观测性-日志类型与字段规范\" class=\"headerlink\" title=\"Day029：日志与可观测性 - 日志类型与字段规范\"></a>Day029：日志与可观测性 - 日志类型与字段规范</h1><ul>\n<li>日期：2026-01-22</li>\n<li>周次：第5周</li>\n</ul>\n<h2 id=\"学习目标\"><a href=\"#学习目标\" class=\"headerlink\" title=\"学习目标\"></a>学习目标</h2><p>今天你将掌握日志管理的基础知识：</p>\n<ul>\n<li><strong>识别日志类型</strong>：系统日志、应用日志、安全日志、访问日志的区别与用途</li>\n<li><strong>理解关键字段</strong>：时间戳、主机名、用户、事件类型、上下文信息的作用</li>\n<li><strong>掌握规范化意义</strong>：理解日志规范化的好处（分析、搜索、合规）</li>\n<li><strong>设计日志字段</strong>：能为不同场景设计合理的日志字段结构</li>\n<li><strong>输出统一格式</strong>：能将不同来源的日志转换为统一格式（JSON&#x2F;CSV）</li>\n</ul>\n<hr>\n<span id=\"more\"></span>\n\n<h2 id=\"学习内容\"><a href=\"#学习内容\" class=\"headerlink\" title=\"学习内容\"></a>学习内容</h2><h3 id=\"1️⃣-日志分类与用途\"><a href=\"#1️⃣-日志分类与用途\" class=\"headerlink\" title=\"1️⃣ 日志分类与用途\"></a>1️⃣ 日志分类与用途</h3><h4 id=\"1-1-日志类型总览\"><a href=\"#1-1-日志类型总览\" class=\"headerlink\" title=\"1.1 日志类型总览\"></a>1.1 日志类型总览</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">日志分类体系</span><br><span class=\"line\">│</span><br><span class=\"line\">├─ 系统日志</span><br><span class=\"line\">│  ├─ 内核日志</span><br><span class=\"line\">│  ├─ 系统服务日志</span><br><span class=\"line\">│  └─ 硬件日志</span><br><span class=\"line\">│</span><br><span class=\"line\">├─ 应用日志</span><br><span class=\"line\">│  ├─ Web 服务器日志（Nginx/Apache）</span><br><span class=\"line\">│  ├─ 应用程序日志（Python/Java/Node.js）</span><br><span class=\"line\">│  ├─ 数据库日志（MySQL/PostgreSQL）</span><br><span class=\"line\">│  └─ 中间件日志（Redis/MQ）</span><br><span class=\"line\">│</span><br><span class=\"line\">├─ 安全日志</span><br><span class=\"line\">│  ├─ 认证日志（登录/登出）</span><br><span class=\"line\">│  ├─ 授权日志（权限变更）</span><br><span class=\"line\">│  ├─ 审计日志（操作记录）</span><br><span class=\"line\">│  └─ 威胁日志（攻击检测）</span><br><span class=\"line\">│</span><br><span class=\"line\">└─ 访问日志</span><br><span class=\"line\">   ├─ HTTP 访问日志</span><br><span class=\"line\">   ├─ API 调用日志</span><br><span class=\"line\">   └─ 用户行为日志</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"1-2-各类型日志详解\"><a href=\"#1-2-各类型日志详解\" class=\"headerlink\" title=\"1.2 各类型日志详解\"></a>1.2 各类型日志详解</h4><p><strong>1. 系统日志</strong></p>\n<table>\n<thead>\n<tr>\n<th>日志类型</th>\n<th>路径（Linux）</th>\n<th>路径（Windows）</th>\n<th>典型字段</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>内核日志</td>\n<td><code>/var/log/kern.log</code></td>\n<td>事件查看器 → 系统</td>\n<td>timestamp, level, message</td>\n</tr>\n<tr>\n<td>系统日志</td>\n<td><code>/var/log/syslog</code></td>\n<td>事件查看器 → 系统</td>\n<td>timestamp, facility, level, message</td>\n</tr>\n<tr>\n<td>服务日志</td>\n<td><code>/var/log/</code></td>\n<td>Event Log</td>\n<td>timestamp, service, status, message</td>\n</tr>\n</tbody></table>\n<p><strong>示例</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Jan 22 10:30:00 server01 systemd[1]: Started nginx.service</span><br><span class=\"line\">Jan 22 10:30:01 server01 kernel: [UFW BLOCK] IN=eth0 SRC=192.168.1.100</span><br></pre></td></tr></table></figure>\n\n<hr>\n<p><strong>2. 应用日志</strong></p>\n<p><strong>Web 服务器访问日志（Nginx&#x2F;Apache）</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">192.168.1.10 - - [22/Jan/2026:10:30:00 +0800] &quot;GET /api/users HTTP/1.1&quot; 200 1234 &quot;-&quot; &quot;Mozilla/5.0&quot;</span><br></pre></td></tr></table></figure>\n\n<p><strong>应用程序日志（结构化）</strong>：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;timestamp&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2026-01-22T10:30:00.123Z&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;level&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;INFO&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;service&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;user-service&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;trace_id&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;abc123&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;user_id&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;user001&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;action&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;login&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;ip&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;192.168.1.10&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;status&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;success&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>数据库日志（MySQL）</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">2026-01-22T10:30:00.123456Z 123 [Note] Access denied for user &#x27;root&#x27;@&#x27;192.168.1.10&#x27;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<p><strong>3. 安全日志</strong></p>\n<p><strong>认证日志</strong>（Linux <code>/var/log/auth.log</code>）：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Jan 22 10:30:00 server01 sshd[12345]: Accepted password for user01 from 192.168.1.10 port 54321 ssh2</span><br><span class=\"line\">Jan 22 10:30:05 server01 sshd[12346]: Failed password for admin from 192.168.1.11 port 54322 ssh2</span><br></pre></td></tr></table></figure>\n\n<p><strong>安全事件日志</strong>（Windows Event ID 4625）：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">账户登录失败</span><br><span class=\"line\">事件 ID: 4625</span><br><span class=\"line\">用户名: Administrator</span><br><span class=\"line\">源 IP: 192.168.1.100</span><br><span class=\"line\">失败原因: 错误密码</span><br><span class=\"line\">时间: 2026-01-22 10:30:00</span><br></pre></td></tr></table></figure>\n\n<hr>\n<p><strong>4. 访问日志</strong></p>\n<p><strong>HTTP 访问日志（组合日志格式）</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">192.168.1.10 - user01 [22/Jan/2026:10:30:00 +0800] &quot;GET /api/data HTTP/1.1&quot; 200 5678 &quot;https://example.com&quot; &quot;Mozilla/5.0&quot; 0.123</span><br></pre></td></tr></table></figure>\n\n<p><strong>API 调用日志</strong>：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;timestamp&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2026-01-22T10:30:00.123Z&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;method&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;POST&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;path&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;/api/orders&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;status_code&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">201</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;user_id&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;user001&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;request_id&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;req_abc123&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;duration_ms&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">123</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;ip&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;192.168.1.10&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2️⃣-日志关键字段\"><a href=\"#2️⃣-日志关键字段\" class=\"headerlink\" title=\"2️⃣ 日志关键字段\"></a>2️⃣ 日志关键字段</h3><h4 id=\"2-1-核心字段说明\"><a href=\"#2-1-核心字段说明\" class=\"headerlink\" title=\"2.1 核心字段说明\"></a>2.1 核心字段说明</h4><table>\n<thead>\n<tr>\n<th>字段类别</th>\n<th>字段名</th>\n<th>类型</th>\n<th>说明</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>时间相关</strong></td>\n<td>timestamp</td>\n<td>datetime</td>\n<td>事件发生时间</td>\n<td>2026-01-22T10:30:00.123Z</td>\n</tr>\n<tr>\n<td></td>\n<td>duration_ms</td>\n<td>int</td>\n<td>请求持续时间（毫秒）</td>\n<td>123</td>\n</tr>\n<tr>\n<td><strong>主机相关</strong></td>\n<td>hostname</td>\n<td>string</td>\n<td>主机名</td>\n<td>server01.example.com</td>\n</tr>\n<tr>\n<td></td>\n<td>ip_address</td>\n<td>string</td>\n<td>IP 地址</td>\n<td>192.168.1.10</td>\n</tr>\n<tr>\n<td></td>\n<td>port</td>\n<td>int</td>\n<td>端口号</td>\n<td>443</td>\n</tr>\n<tr>\n<td><strong>用户相关</strong></td>\n<td>user_id</td>\n<td>string</td>\n<td>用户 ID</td>\n<td>user001</td>\n</tr>\n<tr>\n<td></td>\n<td>username</td>\n<td>string</td>\n<td>用户名</td>\n<td>admin</td>\n</tr>\n<tr>\n<td></td>\n<td>session_id</td>\n<td>string</td>\n<td>会话 ID</td>\n<td>sess_abc123</td>\n</tr>\n<tr>\n<td><strong>请求相关</strong></td>\n<td>method</td>\n<td>string</td>\n<td>HTTP 方法</td>\n<td>GET, POST, PUT, DELETE</td>\n</tr>\n<tr>\n<td></td>\n<td>path</td>\n<td>string</td>\n<td>请求路径</td>\n<td>&#x2F;api&#x2F;users</td>\n</tr>\n<tr>\n<td></td>\n<td>query_string</td>\n<td>string</td>\n<td>查询参数</td>\n<td>?page&#x3D;1&amp;limit&#x3D;10</td>\n</tr>\n<tr>\n<td></td>\n<td>user_agent</td>\n<td>string</td>\n<td>用户代理</td>\n<td>Mozilla&#x2F;5.0…</td>\n</tr>\n<tr>\n<td></td>\n<td>referer</td>\n<td>string</td>\n<td>来源页面</td>\n<td><a href=\"https://example.com/\">https://example.com</a></td>\n</tr>\n<tr>\n<td><strong>响应相关</strong></td>\n<td>status_code</td>\n<td>int</td>\n<td>HTTP 状态码</td>\n<td>200, 404, 500</td>\n</tr>\n<tr>\n<td></td>\n<td>response_size</td>\n<td>int</td>\n<td>响应大小（字节）</td>\n<td>1234</td>\n</tr>\n<tr>\n<td><strong>事件相关</strong></td>\n<td>event_type</td>\n<td>string</td>\n<td>事件类型</td>\n<td>login, logout, error</td>\n</tr>\n<tr>\n<td></td>\n<td>event_id</td>\n<td>string</td>\n<td>事件 ID</td>\n<td>evt_abc123</td>\n</tr>\n<tr>\n<td></td>\n<td>level</td>\n<td>string</td>\n<td>日志级别</td>\n<td>DEBUG, INFO, WARNING, ERROR</td>\n</tr>\n<tr>\n<td></td>\n<td>message</td>\n<td>string</td>\n<td>日志消息</td>\n<td>用户登录成功</td>\n</tr>\n<tr>\n<td><strong>上下文相关</strong></td>\n<td>trace_id</td>\n<td>string</td>\n<td>追踪 ID</td>\n<td>trace_abc123</td>\n</tr>\n<tr>\n<td></td>\n<td>tags</td>\n<td>array</td>\n<td>标签</td>\n<td>[“web”, “api”, “orders”]</td>\n</tr>\n<tr>\n<td></td>\n<td>metadata</td>\n<td>object</td>\n<td>元数据</td>\n<td>{“version”: “1.0.0”}</td>\n</tr>\n</tbody></table>\n<hr>\n<h4 id=\"2-2-时间戳格式规范\"><a href=\"#2-2-时间戳格式规范\" class=\"headerlink\" title=\"2.2 时间戳格式规范\"></a>2.2 时间戳格式规范</h4><table>\n<thead>\n<tr>\n<th>格式</th>\n<th>标准</th>\n<th>示例</th>\n<th>优点</th>\n<th>缺点</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>ISO 8601</strong></td>\n<td>国际标准</td>\n<td>2026-01-22T10:30:00.123Z</td>\n<td>机器可读、时区明确</td>\n<td>人类可读性略差</td>\n</tr>\n<tr>\n<td><strong>Unix 时间戳</strong></td>\n<td>Unix 标准</td>\n<td>1737515400.123</td>\n<td>精确、易于计算</td>\n<td>不可读</td>\n</tr>\n<tr>\n<td><strong>Apache 格式</strong></td>\n<td>Web 标准</td>\n<td>22&#x2F;Jan&#x2F;2026:10:30:00 +0800</td>\n<td>Web 服务器通用</td>\n<td>不易解析</td>\n</tr>\n</tbody></table>\n<p><strong>推荐格式</strong>：ISO 8601 (UTC)</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;timestamp&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2026-01-22T10:30:00.123Z&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"3️⃣-日志规范化与标准化\"><a href=\"#3️⃣-日志规范化与标准化\" class=\"headerlink\" title=\"3️⃣ 日志规范化与标准化\"></a>3️⃣ 日志规范化与标准化</h3><h4 id=\"3-1-为何需要日志规范化？\"><a href=\"#3-1-为何需要日志规范化？\" class=\"headerlink\" title=\"3.1 为何需要日志规范化？\"></a>3.1 为何需要日志规范化？</h4><p><strong>不规范的问题</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">问题 1: 时间格式不统一</span><br><span class=\"line\">→ 2026-01-22 10:30:00</span><br><span class=\"line\">→ 01/22/2026 10:30:00 AM</span><br><span class=\"line\">→ Jan 22, 2026 10:30 AM</span><br><span class=\"line\"></span><br><span class=\"line\">问题 2: 字段名称不统一</span><br><span class=\"line\">→ user_id, userId, User_ID</span><br><span class=\"line\">→ ip, IP, ip_address, client_ip</span><br><span class=\"line\"></span><br><span class=\"line\">问题 3: 日志级别不统一</span><br><span class=\"line\">→ INFO, info, Information</span><br><span class=\"line\">→ ERROR, error, Error, CRITICAL</span><br></pre></td></tr></table></figure>\n\n<p><strong>规范化的好处</strong>：</p>\n<ol>\n<li><strong>统一分析</strong>：所有日志可用同一工具分析</li>\n<li><strong>快速检索</strong>：字段名一致，搜索更高效</li>\n<li><strong>自动化处理</strong>：机器可解析，易于自动化</li>\n<li><strong>合规要求</strong>：满足审计和监管要求</li>\n<li><strong>降低成本</strong>：减少格式转换和清洗工作</li>\n</ol>\n<hr>\n<h4 id=\"3-2-日志级别规范\"><a href=\"#3-2-日志级别规范\" class=\"headerlink\" title=\"3.2 日志级别规范\"></a>3.2 日志级别规范</h4><table>\n<thead>\n<tr>\n<th>级别</th>\n<th>用途</th>\n<th>示例场景</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>TRACE</strong></td>\n<td>最详细的调试信息</td>\n<td>函数调用、变量值</td>\n</tr>\n<tr>\n<td><strong>DEBUG</strong></td>\n<td>调试信息</td>\n<td>数据库查询、中间状态</td>\n</tr>\n<tr>\n<td><strong>INFO</strong></td>\n<td>一般信息</td>\n<td>用户登录、服务启动</td>\n</tr>\n<tr>\n<td><strong>WARNING</strong></td>\n<td>警告信息</td>\n<td>配置项缺失、降级使用</td>\n</tr>\n<tr>\n<td><strong>ERROR</strong></td>\n<td>错误信息</td>\n<td>异常抛出、请求失败</td>\n</tr>\n<tr>\n<td><strong>CRITICAL</strong></td>\n<td>严重错误</td>\n<td>服务宕机、数据丢失</td>\n</tr>\n</tbody></table>\n<p><strong>推荐映射</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 标准日志级别</span></span><br><span class=\"line\">LOG_LEVELS = &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;TRACE&quot;</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;DEBUG&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;INFO&quot;</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;WARNING&quot;</span>: <span class=\"number\">3</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;ERROR&quot;</span>: <span class=\"number\">4</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;CRITICAL&quot;</span>: <span class=\"number\">5</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"3-3-统一日志格式（JSON）示例\"><a href=\"#3-3-统一日志格式（JSON）示例\" class=\"headerlink\" title=\"3.3 统一日志格式（JSON）示例\"></a>3.3 统一日志格式（JSON）示例</h4><figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;timestamp&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2026-01-22T10:30:00.123Z&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;level&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;INFO&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;hostname&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;web-01&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;service&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;nginx&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;event_type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;http_access&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;ip_address&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;192.168.1.10&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;user_id&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;user001&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;http&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;method&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;GET&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;path&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;/api/users&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;query_string&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;?page=1&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;status_code&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">200</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;response_size&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1234</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;duration_ms&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">123</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;context&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;user_agent&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Mozilla/5.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;referer&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;https://example.com&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;trace_id&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;trace_abc123&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"4️⃣-日志采集与标准化\"><a href=\"#4️⃣-日志采集与标准化\" class=\"headerlink\" title=\"4️⃣ 日志采集与标准化\"></a>4️⃣ 日志采集与标准化</h3><h4 id=\"4-1-常用日志采集工具\"><a href=\"#4-1-常用日志采集工具\" class=\"headerlink\" title=\"4.1 常用日志采集工具\"></a>4.1 常用日志采集工具</h4><table>\n<thead>\n<tr>\n<th>工具</th>\n<th>适用场景</th>\n<th>特点</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Filebeat</strong></td>\n<td>文件日志采集</td>\n<td>轻量级、配置简单</td>\n</tr>\n<tr>\n<td><strong>Fluentd</strong></td>\n<td>多源日志采集</td>\n<td>插件丰富、灵活</td>\n</tr>\n<tr>\n<td><strong>Logstash</strong></td>\n<td>日志处理与转换</td>\n<td>强大的过滤和转换能力</td>\n</tr>\n<tr>\n<td><strong>Flume</strong></td>\n<td>大数据日志</td>\n<td>Hadoop 生态</td>\n</tr>\n<tr>\n<td><strong>Splunk</strong></td>\n<td>日志分析平台</td>\n<td>商业软件、功能强大</td>\n</tr>\n<tr>\n<td><strong>ELK Stack</strong></td>\n<td>开源日志平台</td>\n<td>Elasticsearch + Logstash + Kibana</td>\n</tr>\n</tbody></table>\n<hr>\n<h4 id=\"4-2-日志标准化流程\"><a href=\"#4-2-日志标准化流程\" class=\"headerlink\" title=\"4.2 日志标准化流程\"></a>4.2 日志标准化流程</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">┌─────────────────────────────────────────────────────┐</span><br><span class=\"line\">│ 1. 日志采集                                     │</span><br><span class=\"line\">│    - 文件日志：Filebeat/Fluentd                     │</span><br><span class=\"line\">│    - 系统日志：Syslog/Windows Event Log           │</span><br><span class=\"line\">│    - 应用日志：直接写入或通过 Agent                │</span><br><span class=\"line\">└─────────────────────────────────────────────────────┘</span><br><span class=\"line\">                         ↓</span><br><span class=\"line\">┌─────────────────────────────────────────────────────┐</span><br><span class=\"line\">│ 2. 格式转换                                     │</span><br><span class=\"line\">│    - 解析原始日志（文本 → 结构化）                │</span><br><span class=\"line\">│    - 统一字段名称                                 │</span><br><span class=\"line\">│    - 转换时间格式                                 │</span><br><span class=\"line\">└─────────────────────────────────────────────────────┘</span><br><span class=\"line\">                         ↓</span><br><span class=\"line\">┌─────────────────────────────────────────────────────┐</span><br><span class=\"line\">│ 3. 字段映射                                     │</span><br><span class=\"line\">│    - 提取关键字段                                 │</span><br><span class=\"line\">│    - 添加上下文信息                                 │</span><br><span class=\"line\">│    - 富化数据（IP 地理位置、User Agent 解析）      │</span><br><span class=\"line\">└─────────────────────────────────────────────────────┘</span><br><span class=\"line\">                         ↓</span><br><span class=\"line\">┌─────────────────────────────────────────────────────┐</span><br><span class=\"line\">│ 4. 数据存储                                     │</span><br><span class=\"line\">│    - 时序数据库：Elasticsearch、InfluxDB           │</span><br><span class=\"line\">│    - 数据仓库：ClickHouse、Hive                   │</span><br><span class=\"line\">│    - 对象存储：S3、HDFS                          │</span><br><span class=\"line\">└─────────────────────────────────────────────────────┘</span><br><span class=\"line\">                         ↓</span><br><span class=\"line\">┌─────────────────────────────────────────────────────┐</span><br><span class=\"line\">│ 5. 分析与可视化                                 │</span><br><span class=\"line\">│    - 搜索查询                                     │</span><br><span class=\"line\">│    - 统计分析                                     │</span><br><span class=\"line\">│    - 告警规则                                     │</span><br><span class=\"line\">│    - 可视化仪表盘                                 │</span><br><span class=\"line\">└─────────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"4-3-字段映射示例\"><a href=\"#4-3-字段映射示例\" class=\"headerlink\" title=\"4.3 字段映射示例\"></a>4.3 字段映射示例</h4><p><strong>原始 Nginx 日志</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">192.168.1.10 - user01 [22/Jan/2026:10:30:00 +0800] &quot;GET /api/users HTTP/1.1&quot; 200 1234 &quot;-&quot; &quot;Mozilla/5.0&quot;</span><br></pre></td></tr></table></figure>\n\n<p><strong>标准化后的 JSON</strong>：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;timestamp&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2026-01-22T02:30:00.000Z&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;level&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;INFO&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;hostname&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;web-01&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;service&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;nginx&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;event_type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;http_access&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;ip_address&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;192.168.1.10&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;user_id&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;user01&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;http&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;method&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;GET&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;path&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;/api/users&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;protocol&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;HTTP/1.1&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;status_code&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">200</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;response_size&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1234</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;context&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;user_agent&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Mozilla/5.0&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"5️⃣-合规要求与最佳实践\"><a href=\"#5️⃣-合规要求与最佳实践\" class=\"headerlink\" title=\"5️⃣ 合规要求与最佳实践\"></a>5️⃣ 合规要求与最佳实践</h3><h4 id=\"5-1-合规要求\"><a href=\"#5-1-合规要求\" class=\"headerlink\" title=\"5.1 合规要求\"></a>5.1 合规要求</h4><table>\n<thead>\n<tr>\n<th>合规标准</th>\n<th>日志要求</th>\n<th>保留期限</th>\n<th>关键字段</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>等保 2.0</strong></td>\n<td>访问日志、安全日志</td>\n<td>≥ 6 个月</td>\n<td>用户 ID、IP、时间、操作内容</td>\n</tr>\n<tr>\n<td><strong>PCI DSS</strong></td>\n<td>访问日志、审计日志</td>\n<td>≥ 1 年</td>\n<td>用户 ID、IP、时间、操作内容</td>\n</tr>\n<tr>\n<td><strong>GDPR</strong></td>\n<td>个人数据处理日志</td>\n<td>特定场景</td>\n<td>用户标识、数据处理目的</td>\n</tr>\n<tr>\n<td><strong>SOX</strong></td>\n<td>财务相关日志</td>\n<td>≥ 7 年</td>\n<td>操作人员、操作内容、审计记录</td>\n</tr>\n</tbody></table>\n<hr>\n<h4 id=\"5-2-日志最佳实践\"><a href=\"#5-2-日志最佳实践\" class=\"headerlink\" title=\"5.2 日志最佳实践\"></a>5.2 日志最佳实践</h4><table>\n<thead>\n<tr>\n<th>实践</th>\n<th>说明</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>结构化日志</strong></td>\n<td>使用 JSON 格式</td>\n<td>{“timestamp”: “…”, “level”: “INFO”}</td>\n</tr>\n<tr>\n<td><strong>统一时间格式</strong></td>\n<td>使用 ISO 8601</td>\n<td>2026-01-22T10:30:00.123Z</td>\n</tr>\n<tr>\n<td><strong>唯一追踪 ID</strong></td>\n<td>每个请求生成唯一 ID</td>\n<td>trace_abc123</td>\n</tr>\n<tr>\n<td><strong>敏感信息脱敏</strong></td>\n<td>不记录密码、信用卡号</td>\n<td><code>password=***</code></td>\n</tr>\n<tr>\n<td><strong>日志分级</strong></td>\n<td>合理使用日志级别</td>\n<td>错误用 ERROR，普通操作用 INFO</td>\n</tr>\n<tr>\n<td><strong>日志轮转</strong></td>\n<td>定期清理旧日志</td>\n<td>日志文件按天&#x2F;大小轮转</td>\n</tr>\n<tr>\n<td><strong>异步日志</strong></td>\n<td>不阻塞主线程</td>\n<td>使用异步日志库</td>\n</tr>\n<tr>\n<td><strong>上下文信息</strong></td>\n<td>记录请求上下文</td>\n<td>user_id, session_id, ip_address</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"6️⃣-日志分析案例\"><a href=\"#6️⃣-日志分析案例\" class=\"headerlink\" title=\"6️⃣ 日志分析案例\"></a>6️⃣ 日志分析案例</h3><h4 id=\"6-1-分析场景-1：暴力破解检测\"><a href=\"#6-1-分析场景-1：暴力破解检测\" class=\"headerlink\" title=\"6.1 分析场景 1：暴力破解检测\"></a>6.1 分析场景 1：暴力破解检测</h4><p><strong>查询语句（Elasticsearch&#x2F;Kibana）</strong>：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;query&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;bool&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;must&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;match&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;event_type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;auth_failed&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;range&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;timestamp&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;gte&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;now-1h&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">]</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;aggs&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;failed_logins_by_ip&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;terms&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;field&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ip_address&quot;</span><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>告警规则</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">如果同一 IP 在 5 分钟内失败登录超过 10 次，触发告警</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"6-2-分析场景-2：异常流量检测\"><a href=\"#6-2-分析场景-2：异常流量检测\" class=\"headerlink\" title=\"6.2 分析场景 2：异常流量检测\"></a>6.2 分析场景 2：异常流量检测</h4><p><strong>查询语句</strong>：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;query&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;bool&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;must&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;match&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;event_type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;http_access&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;filter&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;range&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;http.response_size&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;gte&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">10000000</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">]</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;aggs&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;top_downloads&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;terms&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;field&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;http.path&quot;</span><span class=\"punctuation\">,</span> <span class=\"attr\">&quot;size&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">10</span><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>告警规则</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">如果单次响应大小超过 10 MB，触发告警</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"实践任务（合法授权范围内）\"><a href=\"#实践任务（合法授权范围内）\" class=\"headerlink\" title=\"实践任务（合法授权范围内）\"></a>实践任务（合法授权范围内）</h2><blockquote>\n<p><strong>注意</strong>：请在你自己的测试环境或授权靶场中执行以下任务。</p>\n</blockquote>\n<hr>\n<h3 id=\"任务-1（必做）：分析本地日志\"><a href=\"#任务-1（必做）：分析本地日志\" class=\"headerlink\" title=\"任务 1（必做）：分析本地日志\"></a>任务 1（必做）：分析本地日志</h3><p><strong>目标</strong>：分析本地系统的不同类型日志，识别关键字段。</p>\n<p><strong>步骤</strong>：</p>\n<ol>\n<li><strong>查看系统日志（Linux）</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看 syslog</span></span><br><span class=\"line\"><span class=\"built_in\">tail</span> -50 /var/log/syslog</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看 auth.log（认证日志）</span></span><br><span class=\"line\"><span class=\"built_in\">tail</span> -50 /var/log/auth.log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看 Nginx 访问日志</span></span><br><span class=\"line\"><span class=\"built_in\">tail</span> -50 /var/log/nginx/access.log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看 Nginx 错误日志</span></span><br><span class=\"line\"><span class=\"built_in\">tail</span> -50 /var/log/nginx/error.log</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><strong>查看系统日志（Windows）</strong></li>\n</ol>\n<figure class=\"highlight powershell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看系统日志</span></span><br><span class=\"line\"><span class=\"built_in\">Get-EventLog</span> <span class=\"literal\">-LogName</span> System <span class=\"literal\">-Newest</span> <span class=\"number\">50</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看安全日志</span></span><br><span class=\"line\"><span class=\"built_in\">Get-EventLog</span> <span class=\"literal\">-LogName</span> Security <span class=\"literal\">-Newest</span> <span class=\"number\">50</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看应用程序日志</span></span><br><span class=\"line\"><span class=\"built_in\">Get-EventLog</span> <span class=\"literal\">-LogName</span> Application <span class=\"literal\">-Newest</span> <span class=\"number\">50</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><strong>记录字段</strong></li>\n</ol>\n<p>创建 <code>log_fields_analysis.md</code>：</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\"># 日志字段分析</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 系统日志 (/var/log/syslog)</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 字段 | 类型 | 示例 | 说明 |</span><br><span class=\"line\">|------|------|------|------|</span><br><span class=\"line\">| timestamp | datetime | Jan 22 10:30:00 | 事件时间 |</span><br><span class=\"line\">| hostname | string | server01 | 主机名 |</span><br><span class=\"line\">| process | string | systemd[1] | 进程名 |</span><br><span class=\"line\">| message | string | Started nginx.service | 消息内容 |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 认证日志 (/var/log/auth.log)</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 字段 | 类型 | 示例 | 说明 |</span><br><span class=\"line\">|------|------|------|------|</span><br><span class=\"line\">| timestamp | datetime | Jan 22 10:30:00 | 事件时间 |</span><br><span class=\"line\">| hostname | string | server01 | 主机名 |</span><br><span class=\"line\">| process | string | sshd[12345] | 进程名 |</span><br><span class=\"line\">| action | string | Accepted | 动作类型 |</span><br><span class=\"line\">| username | string | user01 | 用户名 |</span><br><span class=\"line\">| ip | string | 192.168.1.10 | IP 地址 |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## Nginx 访问日志</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 字段 | 类型 | 示例 | 说明 |</span><br><span class=\"line\">|------|------|------|------|</span><br><span class=\"line\">| ip | string | 192.168.1.10 | 客户端 IP |</span><br><span class=\"line\">| user | string | user01 | 用户名 |</span><br><span class=\"line\">| timestamp | string | 22/Jan/2026:10:30:00 | 时间 |</span><br><span class=\"line\">| method | string | GET | HTTP 方法 |</span><br><span class=\"line\">| path | string | /api/users | 请求路径 |</span><br><span class=\"line\">| protocol | string | HTTP/1.1 | 协议版本 |</span><br><span class=\"line\">| status | int | 200 | 状态码 |</span><br><span class=\"line\">| size | int | 1234 | 响应大小 |</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-2（必做）：设计日志规范\"><a href=\"#任务-2（必做）：设计日志规范\" class=\"headerlink\" title=\"任务 2（必做）：设计日志规范\"></a>任务 2（必做）：设计日志规范</h3><p><strong>目标</strong>：为你的应用设计统一的日志规范。</p>\n<p><strong>步骤</strong>：</p>\n<p>创建 <code>log_specification.md</code>：</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\"># 日志规范草案</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 概述</span></span><br><span class=\"line\"></span><br><span class=\"line\">本文档定义了 [你的应用名称] 的日志规范，确保所有日志格式统一、易于分析。</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 通用字段</span></span><br><span class=\"line\"></span><br><span class=\"line\">所有日志必须包含以下字段：</span><br><span class=\"line\"></span><br><span class=\"line\">| 字段名 | 类型 | 必填 | 说明 | 示例 |</span><br><span class=\"line\">|-------|------|------|------|------|</span><br><span class=\"line\">| timestamp | string (ISO 8601) | ✅ | 事件时间（UTC）| 2026-01-22T10:30:00.123Z |</span><br><span class=\"line\">| level | string | ✅ | 日志级别 | DEBUG, INFO, WARNING, ERROR, CRITICAL |</span><br><span class=\"line\">| hostname | string | ✅ | 主机名 | web-01 |</span><br><span class=\"line\">| service | string | ✅ | 服务名 | user-service |</span><br><span class=\"line\">| trace<span class=\"emphasis\">_id | string | ⚠️ | 追踪 ID（可选）| trace_</span>abc123 |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## HTTP 访问日志</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 字段名 | 类型 | 必填 | 说明 | 示例 |</span><br><span class=\"line\">|-------|------|------|------|------|</span><br><span class=\"line\">| event<span class=\"emphasis\">_type | string | ✅ | 事件类型 | http_</span>access |</span><br><span class=\"line\">| ip<span class=\"emphasis\">_address | string | ✅ | 客户端 IP | 192.168.1.10 |</span></span><br><span class=\"line\"><span class=\"emphasis\">| user_</span>id | string | ⚠️ | 用户 ID（如已认证）| user001 |</span><br><span class=\"line\">| http.method | string | ✅ | HTTP 方法 | GET |</span><br><span class=\"line\">| http.path | string | ✅ | 请求路径 | /api/users |</span><br><span class=\"line\">| http.query<span class=\"emphasis\">_string | string | ⚠️ | 查询参数 | ?page=1 |</span></span><br><span class=\"line\"><span class=\"emphasis\">| http.status_</span>code | int | ✅ | HTTP 状态码 | 200 |</span><br><span class=\"line\">| http.response<span class=\"emphasis\">_size | int | ✅ | 响应大小（字节）| 1234 |</span></span><br><span class=\"line\"><span class=\"emphasis\">| http.duration_</span>ms | int | ✅ | 请求时长（毫秒）| 123 |</span><br><span class=\"line\">| context.user<span class=\"emphasis\">_agent | string | ⚠️ | 用户代理 | Mozilla/5.0... |</span></span><br><span class=\"line\"><span class=\"emphasis\">| context.referer | string | ⚠️ | 来源页面 | https://example.com |</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">### 示例</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">```json</span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;</span></span><br><span class=\"line\"><span class=\"emphasis\">  &quot;timestamp&quot;: &quot;2026-01-22T10:30:00.123Z&quot;,</span></span><br><span class=\"line\"><span class=\"emphasis\">  &quot;level&quot;: &quot;INFO&quot;,</span></span><br><span class=\"line\"><span class=\"emphasis\">  &quot;hostname&quot;: &quot;web-01&quot;,</span></span><br><span class=\"line\"><span class=\"emphasis\">  &quot;service&quot;: &quot;user-service&quot;,</span></span><br><span class=\"line\"><span class=\"emphasis\">  &quot;trace_</span>id&quot;: &quot;trace<span class=\"emphasis\">_abc123&quot;,</span></span><br><span class=\"line\"><span class=\"emphasis\">  &quot;event_</span>type&quot;: &quot;http<span class=\"emphasis\">_access&quot;,</span></span><br><span class=\"line\"><span class=\"emphasis\">  &quot;ip_</span>address&quot;: &quot;192.168.1.10&quot;,</span><br><span class=\"line\">  &quot;user<span class=\"emphasis\">_id&quot;: &quot;user001&quot;,</span></span><br><span class=\"line\"><span class=\"emphasis\">  &quot;http&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"emphasis\">    &quot;method&quot;: &quot;GET&quot;,</span></span><br><span class=\"line\"><span class=\"emphasis\">    &quot;path&quot;: &quot;/api/users&quot;,</span></span><br><span class=\"line\"><span class=\"emphasis\">    &quot;query_</span>string&quot;: &quot;?page=1&quot;,</span><br><span class=\"line\"><span class=\"code\">    &quot;status_code&quot;: 200,</span></span><br><span class=\"line\"><span class=\"code\">    &quot;response_size&quot;: 1234,</span></span><br><span class=\"line\"><span class=\"code\">    &quot;duration_ms&quot;: 123</span></span><br><span class=\"line\"><span class=\"code\">  &#125;,</span></span><br><span class=\"line\"><span class=\"code\">  &quot;context&quot;: &#123;</span></span><br><span class=\"line\"><span class=\"code\">    &quot;user_agent&quot;: &quot;Mozilla/5.0...&quot;,</span></span><br><span class=\"line\"><span class=\"code\">    &quot;referer&quot;: &quot;https://example.com&quot;</span></span><br><span class=\"line\"><span class=\"code\">  &#125;</span></span><br><span class=\"line\"><span class=\"code\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"认证日志\"><a href=\"#认证日志\" class=\"headerlink\" title=\"认证日志\"></a>认证日志</h2><table>\n<thead>\n<tr>\n<th>字段名</th>\n<th>类型</th>\n<th>必填</th>\n<th>说明</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>event_type</td>\n<td>string</td>\n<td>✅</td>\n<td>事件类型</td>\n<td>login, logout, auth_failed</td>\n</tr>\n<tr>\n<td>ip_address</td>\n<td>string</td>\n<td>✅</td>\n<td>客户端 IP</td>\n<td>192.168.1.10</td>\n</tr>\n<tr>\n<td>username</td>\n<td>string</td>\n<td>⚠️</td>\n<td>用户名</td>\n<td>admin</td>\n</tr>\n<tr>\n<td>status</td>\n<td>string</td>\n<td>✅</td>\n<td>状态</td>\n<td>success, failed</td>\n</tr>\n<tr>\n<td>failure_reason</td>\n<td>string</td>\n<td>⚠️</td>\n<td>失败原因（如失败）</td>\n<td>invalid_password, account_locked</td>\n</tr>\n</tbody></table>\n<h3 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h3><figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;timestamp&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2026-01-22T10:30:00.123Z&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;level&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;INFO&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;hostname&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;web-01&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;service&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;user-service&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;event_type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;login&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;ip_address&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;192.168.1.10&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;username&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;user001&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;status&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;success&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"错误日志\"><a href=\"#错误日志\" class=\"headerlink\" title=\"错误日志\"></a>错误日志</h2><table>\n<thead>\n<tr>\n<th>字段名</th>\n<th>类型</th>\n<th>必填</th>\n<th>说明</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>event_type</td>\n<td>string</td>\n<td>✅</td>\n<td>事件类型</td>\n<td>error, exception</td>\n</tr>\n<tr>\n<td>error_code</td>\n<td>string</td>\n<td>⚠️</td>\n<td>错误代码</td>\n<td>ERR_001</td>\n</tr>\n<tr>\n<td>error_message</td>\n<td>string</td>\n<td>✅</td>\n<td>错误消息</td>\n<td>Division by zero</td>\n</tr>\n<tr>\n<td>exception_type</td>\n<td>string</td>\n<td>⚠️</td>\n<td>异常类型</td>\n<td>ValueError</td>\n</tr>\n<tr>\n<td>stack_trace</td>\n<td>string</td>\n<td>⚠️</td>\n<td>堆栈信息</td>\n<td>at line 42…</td>\n</tr>\n</tbody></table>\n<h3 id=\"示例-1\"><a href=\"#示例-1\" class=\"headerlink\" title=\"示例\"></a>示例</h3><figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;timestamp&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2026-01-22T10:30:00.123Z&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;level&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ERROR&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;hostname&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;web-01&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;service&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;user-service&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;event_type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;error&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;error_code&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ERR_001&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;error_message&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Division by zero&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;exception_type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ZeroDivisionError&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;stack_trace&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;at line 42...&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\"></span><br><span class=\"line\">### 任务 3（必做）：日志标准化脚本</span><br><span class=\"line\"></span><br><span class=\"line\">**目标**：编写脚本，将不同来源的日志转换为统一格式。</span><br><span class=\"line\"></span><br><span class=\"line\">**步骤**：</span><br><span class=\"line\"></span><br><span class=\"line\">创建 `log_normalizer.py`：</span><br><span class=\"line\"></span><br><span class=\"line\">```python</span><br><span class=\"line\">#!/usr/bin/env python3</span><br><span class=\"line\">&quot;&quot;&quot;</span><br><span class=\"line\">日志标准化脚本</span><br><span class=\"line\">将 Nginx 访问日志转换为统一 JSON 格式</span><br><span class=\"line\">&quot;&quot;&quot;</span><br><span class=\"line\">import re</span><br><span class=\"line\">import json</span><br><span class=\"line\">import sys</span><br><span class=\"line\">from datetime import datetime</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">class NginxLogNormalizer:</span><br><span class=\"line\">    &quot;&quot;&quot;Nginx 访问日志标准化器&quot;&quot;&quot;</span><br><span class=\"line\">    </span><br><span class=\"line\">    # Nginx 访问日志正则</span><br><span class=\"line\">    LOG_PATTERN = re.compile(</span><br><span class=\"line\">        r&#x27;(?P&lt;ip&gt;\\S+) &#x27;</span><br><span class=\"line\">        r&#x27;(?P&lt;user&gt;\\S+) &#x27;</span><br><span class=\"line\">        r&#x27;\\[(?P&lt;timestamp&gt;[^\\]]+)\\] &#x27;</span><br><span class=\"line\">        r&#x27;&quot;(?P&lt;request&gt;[^&quot;]*)&quot; &#x27;</span><br><span class=\"line\">        r&#x27;(?P&lt;status&gt;\\d+) &#x27;</span><br><span class=\"line\">        r&#x27;(?P&lt;size&gt;\\d+) &#x27;</span><br><span class=\"line\">        r&#x27;&quot;(?P&lt;referer&gt;[^&quot;]*)&quot; &#x27;</span><br><span class=\"line\">        r&#x27;&quot;(?P&lt;user_agent&gt;[^&quot;]*)&quot;&#x27;</span><br><span class=\"line\">    )</span><br><span class=\"line\">    </span><br><span class=\"line\">    def __init__(self, hostname: str = &quot;localhost&quot;, service: str = &quot;nginx&quot;):</span><br><span class=\"line\">        self.hostname = hostname</span><br><span class=\"line\">        self.service = service</span><br><span class=\"line\">    </span><br><span class=\"line\">    def parse(self, line: str) -&gt; dict | None:</span><br><span class=\"line\">        &quot;&quot;&quot;解析单行 Nginx 日志</span><br><span class=\"line\">        </span><br><span class=\"line\">        Args:</span><br><span class=\"line\">            line: Nginx 日志行</span><br><span class=\"line\">            </span><br><span class=\"line\">        Returns:</span><br><span class=\"line\">            标准化的日志字典</span><br><span class=\"line\">        &quot;&quot;&quot;</span><br><span class=\"line\">        match = self.LOG_PATTERN.match(line)</span><br><span class=\"line\">        if not match:</span><br><span class=\"line\">            return None</span><br><span class=\"line\">        </span><br><span class=\"line\">        data = match.groupdict()</span><br><span class=\"line\">        </span><br><span class=\"line\">        # 解析请求</span><br><span class=\"line\">        request_parts = data[&#x27;request&#x27;].split()</span><br><span class=\"line\">        method = request_parts[0] if len(request_parts) &gt; 0 else &quot;-&quot;</span><br><span class=\"line\">        path = request_parts[1] if len(request_parts) &gt; 1 else &quot;-&quot;</span><br><span class=\"line\">        </span><br><span class=\"line\">        # 分离路径和查询字符串</span><br><span class=\"line\">        if &#x27;?&#x27; in path:</span><br><span class=\"line\">            path, query_string = path.split(&#x27;?&#x27;, 1)</span><br><span class=\"line\">        else:</span><br><span class=\"line\">            query_string = None</span><br><span class=\"line\">        </span><br><span class=\"line\">        # 转换时间格式（Nginx → ISO 8601）</span><br><span class=\"line\">        try:</span><br><span class=\"line\">            # 22/Jan/2026:10:30:00 +0800 → datetime</span><br><span class=\"line\">            dt = datetime.strptime(data[&#x27;timestamp&#x27;], &#x27;%d/%b/%Y:%H:%M:%S %z&#x27;)</span><br><span class=\"line\">            timestamp = dt.strftime(&#x27;%Y-%m-%dT%H:%M:%S.%fZ&#x27;)</span><br><span class=\"line\">        except ValueError:</span><br><span class=\"line\">            timestamp = data[&#x27;timestamp&#x27;]</span><br><span class=\"line\">        </span><br><span class=\"line\">        # 构建标准化日志</span><br><span class=\"line\">        return &#123;</span><br><span class=\"line\">            &quot;timestamp&quot;: timestamp,</span><br><span class=\"line\">            &quot;level&quot;: &quot;INFO&quot;,</span><br><span class=\"line\">            &quot;hostname&quot;: self.hostname,</span><br><span class=\"line\">            &quot;service&quot;: self.service,</span><br><span class=\"line\">            &quot;event_type&quot;: &quot;http_access&quot;,</span><br><span class=\"line\">            &quot;ip_address&quot;: data[&#x27;ip&#x27;],</span><br><span class=\"line\">            &quot;user_id&quot;: data[&#x27;user&#x27;] if data[&#x27;user&#x27;] != &#x27;-&#x27; else None,</span><br><span class=\"line\">            &quot;http&quot;: &#123;</span><br><span class=\"line\">                &quot;method&quot;: method,</span><br><span class=\"line\">                &quot;path&quot;: path,</span><br><span class=\"line\">                &quot;query_string&quot;: query_string,</span><br><span class=\"line\">                &quot;status_code&quot;: int(data[&#x27;status&#x27;]),</span><br><span class=\"line\">                &quot;response_size&quot;: int(data[&#x27;size&#x27;]),</span><br><span class=\"line\">                &quot;duration_ms&quot;: 0  # Nginx 默认不记录时长，需配置</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &quot;context&quot;: &#123;</span><br><span class=\"line\">                &quot;user_agent&quot;: data[&#x27;user_agent&#x27;],</span><br><span class=\"line\">                &quot;referer&quot;: data[&#x27;referer&#x27;]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">def main():</span><br><span class=\"line\">    if len(sys.argv) != 2:</span><br><span class=\"line\">        print(&quot;用法: python log_normalizer.py &lt;nginx_access_log&gt;&quot;)</span><br><span class=\"line\">        sys.exit(1)</span><br><span class=\"line\">    </span><br><span class=\"line\">    input_file = sys.argv[1]</span><br><span class=\"line\">    output_file = input_file.replace(&#x27;.log&#x27;, &#x27;_normalized.jsonl&#x27;)</span><br><span class=\"line\">    </span><br><span class=\"line\">    normalizer = NginxLogNormalizer(hostname=&quot;web-01&quot;, service=&quot;nginx&quot;)</span><br><span class=\"line\">    </span><br><span class=\"line\">    with open(input_file, &#x27;r&#x27;, encoding=&#x27;utf-8&#x27;) as f_in, \\</span><br><span class=\"line\">         open(output_file, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;) as f_out:</span><br><span class=\"line\">        </span><br><span class=\"line\">        count = 0</span><br><span class=\"line\">        for line in f_in:</span><br><span class=\"line\">            line = line.strip()</span><br><span class=\"line\">            if not line:</span><br><span class=\"line\">                continue</span><br><span class=\"line\">            </span><br><span class=\"line\">            normalized = normalizer.parse(line)</span><br><span class=\"line\">            if normalized:</span><br><span class=\"line\">                f_out.write(json.dumps(normalized, ensure_ascii=False) + &#x27;\\n&#x27;)</span><br><span class=\"line\">                count += 1</span><br><span class=\"line\">    </span><br><span class=\"line\">    print(f&quot;✅ 完成！&quot;)</span><br><span class=\"line\">    print(f&quot;   输入文件: &#123;input_file&#125;&quot;)</span><br><span class=\"line\">    print(f&quot;   输出文件: &#123;output_file&#125;&quot;)</span><br><span class=\"line\">    print(f&quot;   处理记录: &#123;count&#125; 条&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">if __name__ == &quot;__main__&quot;:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure>\n\n<p><strong>运行脚本</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 获取 Nginx 访问日志（如有）</span></span><br><span class=\"line\">sudo <span class=\"built_in\">tail</span> -100 /var/log/nginx/access.log &gt; /tmp/nginx_sample.log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 或者创建示例日志</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> &gt; /tmp/nginx_sample.log &lt;&lt;<span class=\"string\">&#x27;EOF&#x27;</span></span><br><span class=\"line\">192.168.1.10 - user01 [22/Jan/2026:10:30:00 +0800] <span class=\"string\">&quot;GET /api/users HTTP/1.1&quot;</span> 200 1234 <span class=\"string\">&quot;-&quot;</span> <span class=\"string\">&quot;Mozilla/5.0&quot;</span></span><br><span class=\"line\">192.168.1.11 - - [22/Jan/2026:10:30:01 +0800] <span class=\"string\">&quot;POST /api/login HTTP/1.1&quot;</span> 401 567 <span class=\"string\">&quot;-&quot;</span> <span class=\"string\">&quot;Mozilla/5.0&quot;</span></span><br><span class=\"line\">192.168.1.12 - user02 [22/Jan/2026:10:30:02 +0800] <span class=\"string\">&quot;GET /api/data HTTP/1.1&quot;</span> 500 890 <span class=\"string\">&quot;-&quot;</span> <span class=\"string\">&quot;Mozilla/5.0&quot;</span></span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 运行标准化脚本</span></span><br><span class=\"line\">python log_normalizer.py /tmp/nginx_sample.log</span><br></pre></td></tr></table></figure>\n\n<p><strong>预期输出</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">✅ 完成！</span><br><span class=\"line\">   输入文件: /tmp/nginx_sample.log</span><br><span class=\"line\">   输出文件: /tmp/nginx_sample_normalized.jsonl</span><br><span class=\"line\">   处理记录: 3 条</span><br></pre></td></tr></table></figure>\n\n<p><strong>查看标准化后的日志</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cat</span> /tmp/nginx_sample_normalized.jsonl | python -m json.tool | <span class=\"built_in\">head</span> -30</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"任务-4（进阶）：生成-CSV-格式\"><a href=\"#任务-4（进阶）：生成-CSV-格式\" class=\"headerlink\" title=\"任务 4（进阶）：生成 CSV 格式\"></a>任务 4（进阶）：生成 CSV 格式</h3><p><strong>目标</strong>：将标准化后的日志导出为 CSV 格式。</p>\n<p>**创建 <code>log_exporter.py</code>**：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python3</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">日志导出器</span></span><br><span class=\"line\"><span class=\"string\">将 JSONL 日志导出为 CSV 格式</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> csv</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">from</span> pathlib <span class=\"keyword\">import</span> Path</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">export_to_csv</span>(<span class=\"params\">input_file: <span class=\"built_in\">str</span>, output_file: <span class=\"built_in\">str</span> | <span class=\"literal\">None</span> = <span class=\"literal\">None</span></span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;将 JSONL 日志导出为 CSV</span></span><br><span class=\"line\"><span class=\"string\">    </span></span><br><span class=\"line\"><span class=\"string\">    Args:</span></span><br><span class=\"line\"><span class=\"string\">        input_file: 输入 JSONL 文件</span></span><br><span class=\"line\"><span class=\"string\">        output_file: 输出 CSV 文件（可选）</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> output_file <span class=\"keyword\">is</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">        output_file = input_file.replace(<span class=\"string\">&#x27;.jsonl&#x27;</span>, <span class=\"string\">&#x27;.csv&#x27;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 读取日志并提取字段</span></span><br><span class=\"line\">    records = []</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(input_file, <span class=\"string\">&#x27;r&#x27;</span>, encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> f:</span><br><span class=\"line\">            line = line.strip()</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> line:</span><br><span class=\"line\">                <span class=\"keyword\">continue</span></span><br><span class=\"line\">            </span><br><span class=\"line\">            record = json.loads(line)</span><br><span class=\"line\">            records.append(record)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> records:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;❌ 无数据可导出&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 展平嵌套字段</span></span><br><span class=\"line\">    flat_records = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> record <span class=\"keyword\">in</span> records:</span><br><span class=\"line\">        flat = &#123;&#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># 顶层字段</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> key <span class=\"keyword\">in</span> [<span class=\"string\">&#x27;timestamp&#x27;</span>, <span class=\"string\">&#x27;level&#x27;</span>, <span class=\"string\">&#x27;hostname&#x27;</span>, <span class=\"string\">&#x27;service&#x27;</span>, <span class=\"string\">&#x27;event_type&#x27;</span>, <span class=\"string\">&#x27;ip_address&#x27;</span>, <span class=\"string\">&#x27;user_id&#x27;</span>]:</span><br><span class=\"line\">            flat[key] = record.get(key, <span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># HTTP 字段</span></span><br><span class=\"line\">        http = record.get(<span class=\"string\">&#x27;http&#x27;</span>, &#123;&#125;)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> key <span class=\"keyword\">in</span> [<span class=\"string\">&#x27;method&#x27;</span>, <span class=\"string\">&#x27;path&#x27;</span>, <span class=\"string\">&#x27;query_string&#x27;</span>, <span class=\"string\">&#x27;status_code&#x27;</span>, <span class=\"string\">&#x27;response_size&#x27;</span>, <span class=\"string\">&#x27;duration_ms&#x27;</span>]:</span><br><span class=\"line\">            flat[<span class=\"string\">f&#x27;http.<span class=\"subst\">&#123;key&#125;</span>&#x27;</span>] = http.get(key, <span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># 上下文字段</span></span><br><span class=\"line\">        context = record.get(<span class=\"string\">&#x27;context&#x27;</span>, &#123;&#125;)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> key <span class=\"keyword\">in</span> [<span class=\"string\">&#x27;user_agent&#x27;</span>, <span class=\"string\">&#x27;referer&#x27;</span>]:</span><br><span class=\"line\">            flat[<span class=\"string\">f&#x27;context.<span class=\"subst\">&#123;key&#125;</span>&#x27;</span>] = context.get(key, <span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        flat_records.append(flat)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 写入 CSV</span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(output_file, <span class=\"string\">&#x27;w&#x27;</span>, encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>, newline=<span class=\"string\">&#x27;&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        fieldnames = <span class=\"built_in\">list</span>(flat_records[<span class=\"number\">0</span>].keys())</span><br><span class=\"line\">        writer = csv.DictWriter(f, fieldnames=fieldnames)</span><br><span class=\"line\">        writer.writeheader()</span><br><span class=\"line\">        writer.writerows(flat_records)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;✅ 完成！&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;   输入文件: <span class=\"subst\">&#123;input_file&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;   输出文件: <span class=\"subst\">&#123;output_file&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;   导出记录: <span class=\"subst\">&#123;<span class=\"built_in\">len</span>(flat_records)&#125;</span> 条&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(sys.argv) &lt; <span class=\"number\">2</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;用法: python log_exporter.py &lt;input.jsonl&gt; [output.csv]&quot;</span>)</span><br><span class=\"line\">        sys.exit(<span class=\"number\">1</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    input_file = sys.argv[<span class=\"number\">1</span>]</span><br><span class=\"line\">    output_file = sys.argv[<span class=\"number\">2</span>] <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(sys.argv) &gt; <span class=\"number\">2</span> <span class=\"keyword\">else</span> <span class=\"literal\">None</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    export_to_csv(input_file, output_file)</span><br></pre></td></tr></table></figure>\n\n<p><strong>运行导出</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">python log_exporter.py /tmp/nginx_sample_normalized.jsonl /tmp/nginx_sample_normalized.csv</span><br></pre></td></tr></table></figure>\n\n<p><strong>查看 CSV</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cat</span> /tmp/nginx_sample_normalized.csv</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"巩固练习（题与复盘）\"><a href=\"#巩固练习（题与复盘）\" class=\"headerlink\" title=\"巩固练习（题与复盘）\"></a>巩固练习（题与复盘）</h2><hr>\n<h3 id=\"练习-1：为何需要统一字段？\"><a href=\"#练习-1：为何需要统一字段？\" class=\"headerlink\" title=\"练习 1：为何需要统一字段？\"></a>练习 1：为何需要统一字段？</h3><p><strong>思路提示</strong>：</p>\n<ul>\n<li>字段不统一带来的问题（搜索、分析、自动化）</li>\n<li>不同团队协作时的沟通成本</li>\n<li>日志聚合和分析工具的效率</li>\n</ul>\n<hr>\n<h3 id=\"练习-2：设计一份日志规范草案\"><a href=\"#练习-2：设计一份日志规范草案\" class=\"headerlink\" title=\"练习 2：设计一份日志规范草案\"></a>练习 2：设计一份日志规范草案</h3><p><strong>任务</strong>：为以下场景设计日志规范。</p>\n<p><strong>场景</strong>：电商订单服务</p>\n<p><strong>要求</strong>：</p>\n<ol>\n<li>订单创建日志</li>\n<li>订单支付日志</li>\n<li>订单发货日志</li>\n<li>错误日志</li>\n</ol>\n<p><strong>提示</strong>：</p>\n<ul>\n<li>必须包含通用字段（timestamp, level, hostname, service）</li>\n<li>必须包含事件类型（event_type）</li>\n<li>必须包含业务相关字段（order_id, user_id, amount 等）</li>\n</ul>\n<hr>\n<h3 id=\"练习-3：日志敏感信息脱敏\"><a href=\"#练习-3：日志敏感信息脱敏\" class=\"headerlink\" title=\"练习 3：日志敏感信息脱敏\"></a>练习 3：日志敏感信息脱敏</h3><p><strong>任务</strong>：编写脚本，脱敏日志中的敏感信息。</p>\n<p><strong>示例</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">sanitize_log</span>(<span class=\"params\">message: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">str</span>:</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;脱敏敏感信息&quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># 脱敏密码</span></span><br><span class=\"line\">    message = re.sub(<span class=\"string\">r&#x27;password=[^&amp;\\s]+&#x27;</span>, <span class=\"string\">&#x27;password=***&#x27;</span>, message)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 脱敏信用卡号</span></span><br><span class=\"line\">    message = re.sub(<span class=\"string\">r&#x27;\\b\\d&#123;16&#125;\\b&#x27;</span>, <span class=\"string\">&#x27;************&#x27;</span>, message)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 脱敏手机号</span></span><br><span class=\"line\">    message = re.sub(<span class=\"string\">r&#x27;\\b1[3-9]\\d&#123;9&#125;\\b&#x27;</span>, <span class=\"string\">&#x27;***&#x27;</span>, message)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> message</span><br></pre></td></tr></table></figure>\n\n<p><strong>任务</strong>：</p>\n<ol>\n<li>扩展脱敏规则（邮箱、身份证等）</li>\n<li>应用到日志标准化流程</li>\n</ol>\n<hr>\n<h3 id=\"练习-4：设计日志轮转策略\"><a href=\"#练习-4：设计日志轮转策略\" class=\"headerlink\" title=\"练习 4：设计日志轮转策略\"></a>练习 4：设计日志轮转策略</h3><p><strong>任务</strong>：为你的应用设计日志轮转策略。</p>\n<p><strong>思路提示</strong>：</p>\n<ul>\n<li>按时间轮转（按天、按小时）</li>\n<li>按大小轮转（100MB、1GB）</li>\n<li>压缩旧日志（gzip）</li>\n<li>删除过期日志（保留 7 天、30 天）</li>\n</ul>\n<p><strong>示例（logrotate 配置）</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">/var/log/myapp/*.log &#123;</span><br><span class=\"line\">    daily           # 每天轮转</span><br><span class=\"line\">    rotate 7        # 保留 7 个文件</span><br><span class=\"line\">    compress        # 压缩旧日志</span><br><span class=\"line\">    delaycompress   # 延迟压缩</span><br><span class=\"line\">    missingok       # 文件不存在不报错</span><br><span class=\"line\">    notifempty      # 文件为空不轮转</span><br><span class=\"line\">    create 0644 www-data www-data  # 创建新文件，指定权限</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"评估标准（达成判定）\"><a href=\"#评估标准（达成判定）\" class=\"headerlink\" title=\"评估标准（达成判定）\"></a>评估标准（达成判定）</h2><ul>\n<li>✅ 完成了本地日志分析，识别了关键字段</li>\n<li>✅ 设计了日志规范文档（包含字段定义和示例）</li>\n<li>✅ 编写了日志标准化脚本</li>\n<li>✅ 将标准化日志导出为 CSV 格式</li>\n<li>✅ 能说明日志规范化的好处</li>\n</ul>\n<hr>\n<h2 id=\"学习成果达成情况（由学习者填写）\"><a href=\"#学习成果达成情况（由学习者填写）\" class=\"headerlink\" title=\"学习成果达成情况（由学习者填写）\"></a>学习成果达成情况（由学习者填写）</h2><hr>\n<h3 id=\"截图与证据\"><a href=\"#截图与证据\" class=\"headerlink\" title=\"截图与证据\"></a>截图与证据</h3><ul>\n<li><input disabled=\"\" type=\"checkbox\"> 本地日志分析截图（syslog, auth.log, nginx.log）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 日志字段分析文档（log_fields_analysis.md）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 日志规范文档（log_specification.md）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 日志标准化脚本（log_normalizer.py）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 标准化后的日志输出（JSONL 格式）</li>\n<li><input disabled=\"\" type=\"checkbox\"> CSV 导出脚本（log_exporter.py）</li>\n<li><input disabled=\"\" type=\"checkbox\"> 导出的 CSV 文件</li>\n</ul>\n<hr>\n<h3 id=\"关键命令与输出（粘贴关键片段）\"><a href=\"#关键命令与输出（粘贴关键片段）\" class=\"headerlink\" title=\"关键命令与输出（粘贴关键片段）\"></a>关键命令与输出（粘贴关键片段）</h3><p><strong>查看系统日志</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">tail</span> -20 /var/log/syslog</span><br><span class=\"line\">Jan 22 10:30:00 server01 systemd[1]: Started nginx.service</span><br><span class=\"line\">Jan 22 10:30:01 server01 sshd[12345]: Accepted password <span class=\"keyword\">for</span> user01 from 192.168.1.10</span><br></pre></td></tr></table></figure>\n\n<p><strong>查看 Nginx 访问日志</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">tail</span> -10 /var/log/nginx/access.log</span><br><span class=\"line\">192.168.1.10 - user01 [22/Jan/2026:10:30:00 +0800] <span class=\"string\">&quot;GET /api/users HTTP/1.1&quot;</span> 200 1234 <span class=\"string\">&quot;-&quot;</span> <span class=\"string\">&quot;Mozilla/5.0&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>运行日志标准化脚本</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ python log_normalizer.py /tmp/nginx_sample.log</span><br><span class=\"line\">✅ 完成！</span><br><span class=\"line\">   输入文件: /tmp/nginx_sample.log</span><br><span class=\"line\">   输出文件: /tmp/nginx_sample_normalized.jsonl</span><br><span class=\"line\">   处理记录: 3 条</span><br></pre></td></tr></table></figure>\n\n<p><strong>查看标准化后的日志</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cat</span> /tmp/nginx_sample_normalized.jsonl | python -m json.tool</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;timestamp&quot;</span>: <span class=\"string\">&quot;2026-01-22T02:30:00.000Z&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;level&quot;</span>: <span class=\"string\">&quot;INFO&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;hostname&quot;</span>: <span class=\"string\">&quot;web-01&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;service&quot;</span>: <span class=\"string\">&quot;nginx&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;event_type&quot;</span>: <span class=\"string\">&quot;http_access&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;ip_address&quot;</span>: <span class=\"string\">&quot;192.168.1.10&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;user_id&quot;</span>: <span class=\"string\">&quot;user01&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;http&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;method&quot;</span>: <span class=\"string\">&quot;GET&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;path&quot;</span>: <span class=\"string\">&quot;/api/users&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;query_string&quot;</span>: null,</span><br><span class=\"line\">    <span class=\"string\">&quot;status_code&quot;</span>: 200,</span><br><span class=\"line\">    <span class=\"string\">&quot;response_size&quot;</span>: 1234,</span><br><span class=\"line\">    <span class=\"string\">&quot;duration_ms&quot;</span>: 0</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;context&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;user_agent&quot;</span>: <span class=\"string\">&quot;Mozilla/5.0&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;referer&quot;</span>: <span class=\"string\">&quot;-&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>导出 CSV 格式</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ python log_exporter.py /tmp/nginx_sample_normalized.jsonl /tmp/nginx_sample_normalized.csv</span><br><span class=\"line\">✅ 完成！</span><br><span class=\"line\">   输入文件: /tmp/nginx_sample_normalized.jsonl</span><br><span class=\"line\">   输出文件: /tmp/nginx_sample_normalized.csv</span><br><span class=\"line\">   导出记录: 3 条</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"结论与反思\"><a href=\"#结论与反思\" class=\"headerlink\" title=\"结论与反思\"></a>结论与反思</h3><p><strong>我今天搞清楚了</strong>：</p>\n<ul>\n<li>不同类型日志（系统、应用、安全、访问）的区别和用途</li>\n<li>日志关键字段（timestamp, hostname, user_id, event_type 等）的作用</li>\n<li>日志规范化和标准化的重要性</li>\n<li>如何编写脚本将不同格式的日志转换为统一的 JSON 格式</li>\n<li>如何将结构化日志导出为 CSV 格式便于分析</li>\n</ul>\n<p><strong>我差点搞混的是</strong>：</p>\n<ul>\n<li>最初不理解 ISO 8601 时间格式的优势</li>\n<li>混淆了日志级别（DEBUG&#x2F;INFO&#x2F;WARNING&#x2F;ERROR）的使用场景</li>\n<li>不清楚字段映射和结构化日志的关系</li>\n</ul>\n<p><strong>明天我要继续补的是</strong>：</p>\n<ul>\n<li>学习日志分析工具（Elasticsearch&#x2F;Kibana、Splunk）的使用（Day030）</li>\n<li>了解日志告警规则的设计与配置（Day031）</li>\n<li>学习日志存储与检索优化（Day032）</li>\n</ul>\n<p><strong>本次学习耗时</strong>：约 3 小时</p>\n<p><strong>掌握程度自评</strong>：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 😕 理解了基本概念，但实践不熟练</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🙂 完成了日志分析和规范设计</li>\n<li><input disabled=\"\" type=\"checkbox\"> 😃 完成了所有任务并理解原理</li>\n<li><input disabled=\"\" type=\"checkbox\"> 🤩 额外扩展了脱敏和轮转功能</li>\n</ul>\n<hr>\n<h2 id=\"集中参考答案（含思路）\"><a href=\"#集中参考答案（含思路）\" class=\"headerlink\" title=\"集中参考答案（含思路）\"></a>集中参考答案（含思路）</h2><hr>\n<h3 id=\"练习-1-参考答案：为何需要统一字段？\"><a href=\"#练习-1-参考答案：为何需要统一字段？\" class=\"headerlink\" title=\"练习 1 参考答案：为何需要统一字段？\"></a>练习 1 参考答案：为何需要统一字段？</h3><p><strong>字段不统一带来的问题</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>问题类型</th>\n<th>具体表现</th>\n<th>影响</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>检索困难</strong></td>\n<td><code>user_id</code>, <code>userId</code>, <code>User_ID</code> 混用</td>\n<td>搜索时需要尝试多种字段名，效率低</td>\n</tr>\n<tr>\n<td><strong>分析复杂</strong></td>\n<td>时间格式不统一（<code>2026-01-22</code> vs <code>01/22/2026</code>）</td>\n<td>需要额外转换才能做时间范围查询</td>\n</tr>\n<tr>\n<td><strong>自动化困难</strong></td>\n<td>字段含义不明确</td>\n<td>需要人工干预，自动化脚本无法通用</td>\n</tr>\n<tr>\n<td><strong>协作成本高</strong></td>\n<td>不同团队使用不同字段规范</td>\n<td>数据共享和集成需要额外适配工作</td>\n</tr>\n<tr>\n<td><strong>合规审计难</strong></td>\n<td>字段缺失或不一致</td>\n<td>难以满足审计和合规要求</td>\n</tr>\n</tbody></table>\n<p><strong>统一字段的好处</strong>：</p>\n<ol>\n<li><p><strong>提高检索效率</strong>：</p>\n<ul>\n<li>字段名统一，一次查询即可找到所有相关记录</li>\n<li>不需要尝试多个可能的字段名</li>\n</ul>\n</li>\n<li><p><strong>简化数据分析</strong>：</p>\n<ul>\n<li>时间格式统一（ISO 8601），时间范围查询更简单</li>\n<li>数据类型一致，聚合统计更容易</li>\n</ul>\n</li>\n<li><p><strong>便于自动化</strong>：</p>\n<ul>\n<li>标准化字段，自动化脚本可通用</li>\n<li>减少人工干预，提高效率</li>\n</ul>\n</li>\n<li><p><strong>降低协作成本</strong>：</p>\n<ul>\n<li>团队之间数据共享无需额外适配</li>\n<li>新人快速理解日志结构</li>\n</ul>\n</li>\n<li><p><strong>满足合规要求</strong>：</p>\n<ul>\n<li>审计所需字段明确</li>\n<li>便于生成合规报告</li>\n</ul>\n</li>\n</ol>\n<p><strong>示例：字段不统一的检索问题</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 不统一：需要尝试多种字段名</span></span><br><span class=\"line\">grep <span class=\"string\">&quot;user001&quot;</span> log1.txt | grep <span class=\"string\">&quot;user_id&quot;</span></span><br><span class=\"line\">grep <span class=\"string\">&quot;user001&quot;</span> log2.txt | grep <span class=\"string\">&quot;userId&quot;</span></span><br><span class=\"line\">grep <span class=\"string\">&quot;user001&quot;</span> log3.txt | grep <span class=\"string\">&quot;User_ID&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 统一：一次查询</span></span><br><span class=\"line\">grep <span class=\"string\">&#x27;&quot;user_id&quot;: &quot;user001&quot;&#x27;</span> standardized_logs.jsonl</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"练习-2-参考答案：设计一份日志规范草案\"><a href=\"#练习-2-参考答案：设计一份日志规范草案\" class=\"headerlink\" title=\"练习 2 参考答案：设计一份日志规范草案\"></a>练习 2 参考答案：设计一份日志规范草案</h3><p><strong>电商订单服务日志规范</strong>：</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\"># 电商订单服务日志规范</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 通用字段</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 字段名 | 类型 | 必填 | 说明 | 示例 |</span><br><span class=\"line\">|-------|------|------|------|------|</span><br><span class=\"line\">| timestamp | string (ISO 8601) | ✅ | 事件时间（UTC）| 2026-01-22T10:30:00.123Z |</span><br><span class=\"line\">| level | string | ✅ | 日志级别 | DEBUG, INFO, WARNING, ERROR, CRITICAL |</span><br><span class=\"line\">| hostname | string | ✅ | 主机名 | order-service-01 |</span><br><span class=\"line\">| service | string | ✅ | 服务名 | order-service |</span><br><span class=\"line\">| trace<span class=\"emphasis\">_id | string | ⚠️ | 追踪 ID | trace_</span>abc123 |</span><br><span class=\"line\">| event<span class=\"emphasis\">_type | string | ✅ | 事件类型 | order_</span>created, order<span class=\"emphasis\">_paid, order_</span>shipped |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 订单创建日志</span></span><br><span class=\"line\"></span><br><span class=\"line\">| 字段名 | 类型 | 必填 | 说明 | 示例 |</span><br><span class=\"line\">|-------|------|------|------|------|</span><br><span class=\"line\">| order<span class=\"emphasis\">_id | string | ✅ | 订单 ID | ORD-20260122-001 |</span></span><br><span class=\"line\"><span class=\"emphasis\">| user_</span>id | string | ✅ | 用户 ID | user001 |</span><br><span class=\"line\">| product<span class=\"emphasis\">_id | string | ✅ | 产品 ID | PROD-001 |</span></span><br><span class=\"line\"><span class=\"emphasis\">| quantity | int | ✅ | 数量 | 2 |</span></span><br><span class=\"line\"><span class=\"emphasis\">| unit_</span>price | decimal | ✅ | 单价 | 99.99 |</span><br><span class=\"line\">| total<span class=\"emphasis\">_amount | decimal | ✅ | 总金额 | 199.98 |</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">### 示例</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">```json</span></span><br><span class=\"line\"><span class=\"emphasis\">&#123;</span></span><br><span class=\"line\"><span class=\"emphasis\">  &quot;timestamp&quot;: &quot;2026-01-22T10:30:00.123Z&quot;,</span></span><br><span class=\"line\"><span class=\"emphasis\">  &quot;level&quot;: &quot;INFO&quot;,</span></span><br><span class=\"line\"><span class=\"emphasis\">  &quot;hostname&quot;: &quot;order-service-01&quot;,</span></span><br><span class=\"line\"><span class=\"emphasis\">  &quot;service&quot;: &quot;order-service&quot;,</span></span><br><span class=\"line\"><span class=\"emphasis\">  &quot;trace_</span>id&quot;: &quot;trace<span class=\"emphasis\">_abc123&quot;,</span></span><br><span class=\"line\"><span class=\"emphasis\">  &quot;event_</span>type&quot;: &quot;order<span class=\"emphasis\">_created&quot;,</span></span><br><span class=\"line\"><span class=\"emphasis\">  &quot;order_</span>id&quot;: &quot;ORD-20260122-001&quot;,</span><br><span class=\"line\">  &quot;user<span class=\"emphasis\">_id&quot;: &quot;user001&quot;,</span></span><br><span class=\"line\"><span class=\"emphasis\">  &quot;product_</span>id&quot;: &quot;PROD-001&quot;,</span><br><span class=\"line\">  &quot;quantity&quot;: 2,</span><br><span class=\"line\">  &quot;unit<span class=\"emphasis\">_price&quot;: 99.99,</span></span><br><span class=\"line\"><span class=\"emphasis\">  &quot;total_</span>amount&quot;: 199.98</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"订单支付日志\"><a href=\"#订单支付日志\" class=\"headerlink\" title=\"订单支付日志\"></a>订单支付日志</h2><table>\n<thead>\n<tr>\n<th>字段名</th>\n<th>类型</th>\n<th>必填</th>\n<th>说明</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>order_id</td>\n<td>string</td>\n<td>✅</td>\n<td>订单 ID</td>\n<td>ORD-20260122-001</td>\n</tr>\n<tr>\n<td>user_id</td>\n<td>string</td>\n<td>✅</td>\n<td>用户 ID</td>\n<td>user001</td>\n</tr>\n<tr>\n<td>payment_method</td>\n<td>string</td>\n<td>✅</td>\n<td>支付方式</td>\n<td>credit_card, wechat_pay, alipay</td>\n</tr>\n<tr>\n<td>amount</td>\n<td>decimal</td>\n<td>✅</td>\n<td>支付金额</td>\n<td>199.98</td>\n</tr>\n<tr>\n<td>transaction_id</td>\n<td>string</td>\n<td>✅</td>\n<td>交易 ID</td>\n<td>TXN-20260122-001</td>\n</tr>\n<tr>\n<td>status</td>\n<td>string</td>\n<td>✅</td>\n<td>状态</td>\n<td>success, failed, pending</td>\n</tr>\n<tr>\n<td>failure_reason</td>\n<td>string</td>\n<td>⚠️</td>\n<td>失败原因（如失败）</td>\n<td>insufficient_balance</td>\n</tr>\n</tbody></table>\n<h3 id=\"示例-2\"><a href=\"#示例-2\" class=\"headerlink\" title=\"示例\"></a>示例</h3><figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;timestamp&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2026-01-22T10:30:05.456Z&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;level&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;INFO&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;hostname&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;order-service-01&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;service&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;order-service&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;trace_id&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;trace_abc123&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;event_type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;order_paid&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;order_id&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ORD-20260122-001&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;user_id&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;user001&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;payment_method&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;wechat_pay&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;amount&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">199.98</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;transaction_id&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;TXN-20260122-001&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;status&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;success&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"订单发货日志\"><a href=\"#订单发货日志\" class=\"headerlink\" title=\"订单发货日志\"></a>订单发货日志</h2><table>\n<thead>\n<tr>\n<th>字段名</th>\n<th>类型</th>\n<th>必填</th>\n<th>说明</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>order_id</td>\n<td>string</td>\n<td>✅</td>\n<td>订单 ID</td>\n<td>ORD-20260122-001</td>\n</tr>\n<tr>\n<td>user_id</td>\n<td>string</td>\n<td>✅</td>\n<td>用户 ID</td>\n<td>user001</td>\n</tr>\n<tr>\n<td>shipping_address</td>\n<td>object</td>\n<td>✅</td>\n<td>收货地址</td>\n<td>{“province”: “Beijing”, “city”: “Beijing”, …}</td>\n</tr>\n<tr>\n<td>shipping_method</td>\n<td>string</td>\n<td>✅</td>\n<td>配送方式</td>\n<td>standard, express</td>\n</tr>\n<tr>\n<td>tracking_number</td>\n<td>string</td>\n<td>✅</td>\n<td>物流单号</td>\n<td>SF1234567890</td>\n</tr>\n</tbody></table>\n<h3 id=\"示例-3\"><a href=\"#示例-3\" class=\"headerlink\" title=\"示例\"></a>示例</h3><figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;timestamp&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2026-01-22T10:35:00.789Z&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;level&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;INFO&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;hostname&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;order-service-01&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;service&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;order-service&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;trace_id&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;trace_abc123&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;event_type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;order_shipped&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;order_id&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ORD-20260122-001&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;user_id&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;user001&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;shipping_address&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;province&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Beijing&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;city&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Beijing&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;district&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Chaoyang&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;address&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;xxx Street&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;postal_code&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;100000&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;shipping_method&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;express&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;tracking_number&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;SF1234567890&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"错误日志-1\"><a href=\"#错误日志-1\" class=\"headerlink\" title=\"错误日志\"></a>错误日志</h2><table>\n<thead>\n<tr>\n<th>字段名</th>\n<th>类型</th>\n<th>必填</th>\n<th>说明</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>error_code</td>\n<td>string</td>\n<td>⚠️</td>\n<td>错误代码</td>\n<td>ORD_ERR_001</td>\n</tr>\n<tr>\n<td>error_message</td>\n<td>string</td>\n<td>✅</td>\n<td>错误消息</td>\n<td>Inventory insufficient</td>\n</tr>\n<tr>\n<td>exception_type</td>\n<td>string</td>\n<td>⚠️</td>\n<td>异常类型</td>\n<td>ValueError</td>\n</tr>\n<tr>\n<td>stack_trace</td>\n<td>string</td>\n<td>⚠️</td>\n<td>堆栈信息</td>\n<td>at line 42…</td>\n</tr>\n</tbody></table>\n<h3 id=\"示例-4\"><a href=\"#示例-4\" class=\"headerlink\" title=\"示例\"></a>示例</h3><figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;timestamp&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2026-01-22T10:32:00.123Z&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;level&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ERROR&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;hostname&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;order-service-01&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;service&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;order-service&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;trace_id&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;trace_abc123&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;event_type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;error&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;order_id&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ORD-20260122-002&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;error_code&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ORD_ERR_001&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;error_message&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Inventory insufficient&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;exception_type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ValueError&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;stack_trace&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;at line 42...&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\"></span><br><span class=\"line\">### 练习 3 参考答案：日志敏感信息脱敏</span><br><span class=\"line\"></span><br><span class=\"line\">**扩展脱敏规则**：</span><br><span class=\"line\"></span><br><span class=\"line\">```python</span><br><span class=\"line\">import re</span><br><span class=\"line\"></span><br><span class=\"line\">class LogSanitizer:</span><br><span class=\"line\">    &quot;&quot;&quot;日志脱敏器&quot;&quot;&quot;</span><br><span class=\"line\">    </span><br><span class=\"line\">    def __init__(self):</span><br><span class=\"line\">        self.rules = [</span><br><span class=\"line\">            # 密码</span><br><span class=\"line\">            (r&#x27;password=[^&amp;\\s]+&#x27;, &#x27;password=***&#x27;),</span><br><span class=\"line\">            # 信用卡号（16位）</span><br><span class=\"line\">            (r&#x27;\\b\\d&#123;16&#125;\\b&#x27;, &#x27;************&#x27;),</span><br><span class=\"line\">            # 手机号（中国）</span><br><span class=\"line\">            (r&#x27;\\b1[3-9]\\d&#123;9&#125;\\b&#x27;, &#x27;***&#x27;),</span><br><span class=\"line\">            # 邮箱</span><br><span class=\"line\">            (r&#x27;\\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Z|a-z]&#123;2,&#125;\\b&#x27;, &#x27;***@***.com&#x27;),</span><br><span class=\"line\">            # 身份证号（18位）</span><br><span class=\"line\">            (r&#x27;\\b\\d&#123;17&#125;[\\dXx]\\b&#x27;, &#x27;******************&#x27;),</span><br><span class=\"line\">            # API Key</span><br><span class=\"line\">            (r&#x27;api[_-]?key\\s*=\\s*[\\w-]&#123;20,&#125;&#x27;, &#x27;api_key=***&#x27;),</span><br><span class=\"line\">            # Token</span><br><span class=\"line\">            (r&#x27;token\\s*=\\s*[\\w.-]&#123;20,&#125;&#x27;, &#x27;token=***&#x27;),</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    </span><br><span class=\"line\">    def sanitize(self, message: str) -&gt; str:</span><br><span class=\"line\">        &quot;&quot;&quot;脱敏敏感信息</span><br><span class=\"line\">        </span><br><span class=\"line\">        Args:</span><br><span class=\"line\">            message: 原始日志消息</span><br><span class=\"line\">            </span><br><span class=\"line\">        Returns:</span><br><span class=\"line\">            脱敏后的日志消息</span><br><span class=\"line\">        &quot;&quot;&quot;</span><br><span class=\"line\">        result = message</span><br><span class=\"line\">        </span><br><span class=\"line\">        for pattern, replacement in self.rules:</span><br><span class=\"line\">            result = re.sub(pattern, replacement, result)</span><br><span class=\"line\">        </span><br><span class=\"line\">        return result</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 使用示例</span><br><span class=\"line\">sanitizer = LogSanitizer()</span><br><span class=\"line\"></span><br><span class=\"line\">original = &quot;user=admin&amp;password=secret123&amp;email=user@example.com&quot;</span><br><span class=\"line\">sanitized = sanitizer.sanitize(original)</span><br><span class=\"line\"></span><br><span class=\"line\">print(f&quot;原始: &#123;original&#125;&quot;)</span><br><span class=\"line\">print(f&quot;脱敏: &#123;sanitized&#125;&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"># 输出:</span><br><span class=\"line\"># 原始: user=admin&amp;password=secret123&amp;email=user@example.com</span><br><span class=\"line\"># 脱敏: user=admin&amp;password=***&amp;email=***@***.com</span><br></pre></td></tr></table></figure>\n\n<p><strong>集成到日志标准化流程</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">NginxLogNormalizer</span>:</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;Nginx 访问日志标准化器（带脱敏）&quot;&quot;&quot;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, hostname: <span class=\"built_in\">str</span> = <span class=\"string\">&quot;localhost&quot;</span>, service: <span class=\"built_in\">str</span> = <span class=\"string\">&quot;nginx&quot;</span></span>):</span><br><span class=\"line\">        self.hostname = hostname</span><br><span class=\"line\">        self.service = service</span><br><span class=\"line\">        self.sanitizer = LogSanitizer()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">parse</span>(<span class=\"params\">self, line: <span class=\"built_in\">str</span></span>) -&gt; <span class=\"built_in\">dict</span> | <span class=\"literal\">None</span>:</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;解析单行 Nginx 日志（带脱敏）&quot;&quot;&quot;</span></span><br><span class=\"line\">        match = self.LOG_PATTERN.match(line)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> match:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">None</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        data = match.groupdict()</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># 脱敏敏感信息</span></span><br><span class=\"line\">        sanitized_user_agent = self.sanitizer.sanitize(data[<span class=\"string\">&#x27;user_agent&#x27;</span>])</span><br><span class=\"line\">        sanitized_referer = self.sanitizer.sanitize(data[<span class=\"string\">&#x27;referer&#x27;</span>])</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># ... 其他解析逻辑 ...</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\"># ...</span></span><br><span class=\"line\">            <span class=\"string\">&quot;context&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;user_agent&quot;</span>: sanitized_user_agent,</span><br><span class=\"line\">                <span class=\"string\">&quot;referer&quot;</span>: sanitized_referer</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"练习-4-参考答案：设计日志轮转策略\"><a href=\"#练习-4-参考答案：设计日志轮转策略\" class=\"headerlink\" title=\"练习 4 参考答案：设计日志轮转策略\"></a>练习 4 参考答案：设计日志轮转策略</h3><p><strong>logrotate 配置示例</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"># /etc/logrotate.d/myapp</span><br><span class=\"line\"></span><br><span class=\"line\">/var/log/myapp/*.log &#123;</span><br><span class=\"line\">    # 轮转频率：每天</span><br><span class=\"line\">    daily</span><br><span class=\"line\">    </span><br><span class=\"line\">    # 保留文件数：7 天</span><br><span class=\"line\">    rotate 7</span><br><span class=\"line\">    </span><br><span class=\"line\">    # 压缩旧日志</span><br><span class=\"line\">    compress</span><br><span class=\"line\">    </span><br><span class=\"line\">    # 延迟压缩（最新的不压缩）</span><br><span class=\"line\">    delaycompress</span><br><span class=\"line\">    </span><br><span class=\"line\">    # 文件不存在不报错</span><br><span class=\"line\">    missingok</span><br><span class=\"line\">    </span><br><span class=\"line\">    # 文件为空不轮转</span><br><span class=\"line\">    notifempty</span><br><span class=\"line\">    </span><br><span class=\"line\">    # 轮转后创建新文件</span><br><span class=\"line\">    # 格式: [path] [owner] [group] [mode]</span><br><span class=\"line\">    create 0644 www-data www-data</span><br><span class=\"line\">    </span><br><span class=\"line\">    # 轮转后执行脚本</span><br><span class=\"line\">    postrotate</span><br><span class=\"line\">        # 通知应用重新打开日志文件</span><br><span class=\"line\">        systemctl reload myapp &gt; /dev/null 2&gt;&amp;1 || true</span><br><span class=\"line\">    endscript</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">/var/log/myapp/access.log &#123;</span><br><span class=\"line\">    # 按大小轮转（100MB）</span><br><span class=\"line\">    size 100M</span><br><span class=\"line\">    </span><br><span class=\"line\">    # 保留 5 个文件</span><br><span class=\"line\">    rotate 5</span><br><span class=\"line\">    </span><br><span class=\"line\">    # 压缩</span><br><span class=\"line\">    compress</span><br><span class=\"line\">    </span><br><span class=\"line\">    delaycompress</span><br><span class=\"line\">    missingok</span><br><span class=\"line\">    notifempty</span><br><span class=\"line\">    create 0644 www-data www-data</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>轮转策略对比</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>策略类型</th>\n<th>配置项</th>\n<th>优点</th>\n<th>缺点</th>\n<th>适用场景</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>按时间</strong></td>\n<td><code>daily</code>, <code>weekly</code>, <code>monthly</code></td>\n<td>简单、易于理解</td>\n<td>文件大小不固定</td>\n<td>日志量稳定的系统</td>\n</tr>\n<tr>\n<td><strong>按大小</strong></td>\n<td><code>size 100M</code></td>\n<td>控制单个文件大小</td>\n<td>轮转频率不确定</td>\n<td>日志量波动大的系统</td>\n</tr>\n<tr>\n<td><strong>混合</strong></td>\n<td><code>daily</code> + <code>maxsize</code></td>\n<td>兼顾时间和大小</td>\n<td>配置复杂</td>\n<td>需要精细控制的场景</td>\n</tr>\n</tbody></table>\n<p><strong>Python 轮转脚本示例</strong>：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python3</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">日志轮转脚本</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> gzip</span><br><span class=\"line\"><span class=\"keyword\">import</span> shutil</span><br><span class=\"line\"><span class=\"keyword\">from</span> pathlib <span class=\"keyword\">import</span> Path</span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime, timedelta</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">rotate_log</span>(<span class=\"params\">log_file: Path, max_files: <span class=\"built_in\">int</span> = <span class=\"number\">7</span>, max_size_mb: <span class=\"built_in\">int</span> = <span class=\"number\">100</span></span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;轮转日志文件</span></span><br><span class=\"line\"><span class=\"string\">    </span></span><br><span class=\"line\"><span class=\"string\">    Args:</span></span><br><span class=\"line\"><span class=\"string\">        log_file: 日志文件路径</span></span><br><span class=\"line\"><span class=\"string\">        max_files: 保留的最大文件数</span></span><br><span class=\"line\"><span class=\"string\">        max_size_mb: 最大文件大小（MB），超过则立即轮转</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> log_file.exists():</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 检查文件大小</span></span><br><span class=\"line\">    file_size_mb = log_file.stat().st_size / (<span class=\"number\">1024</span> * <span class=\"number\">1024</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> file_size_mb &lt; max_size_mb:</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 生成轮转文件名</span></span><br><span class=\"line\">    timestamp = datetime.now().strftime(<span class=\"string\">&#x27;%Y%m%d_%H%M%S&#x27;</span>)</span><br><span class=\"line\">    rotated_file = log_file.parent / <span class=\"string\">f&quot;<span class=\"subst\">&#123;log_file.name&#125;</span>.<span class=\"subst\">&#123;timestamp&#125;</span>&quot;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 移动文件</span></span><br><span class=\"line\">    shutil.move(<span class=\"built_in\">str</span>(log_file), <span class=\"built_in\">str</span>(rotated_file))</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;✅ 轮转: <span class=\"subst\">&#123;log_file.name&#125;</span> → <span class=\"subst\">&#123;rotated_file.name&#125;</span>&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 压缩旧文件</span></span><br><span class=\"line\">    compressed_file = rotated_file.with_suffix(<span class=\"string\">f&quot;<span class=\"subst\">&#123;rotated_file.suffix&#125;</span>.gz&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(rotated_file, <span class=\"string\">&#x27;rb&#x27;</span>) <span class=\"keyword\">as</span> f_in:</span><br><span class=\"line\">        <span class=\"keyword\">with</span> gzip.<span class=\"built_in\">open</span>(compressed_file, <span class=\"string\">&#x27;wb&#x27;</span>) <span class=\"keyword\">as</span> f_out:</span><br><span class=\"line\">            shutil.copyfileobj(f_in, f_out)</span><br><span class=\"line\">    os.remove(rotated_file)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;✅ 压缩: <span class=\"subst\">&#123;rotated_file.name&#125;</span> → <span class=\"subst\">&#123;compressed_file.name&#125;</span>&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 清理过期文件</span></span><br><span class=\"line\">    clean_old_logs(log_file.parent, log_file.name, max_files)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">clean_old_logs</span>(<span class=\"params\">directory: Path, base_name: <span class=\"built_in\">str</span>, max_files: <span class=\"built_in\">int</span></span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;清理过期日志文件</span></span><br><span class=\"line\"><span class=\"string\">    </span></span><br><span class=\"line\"><span class=\"string\">    Args:</span></span><br><span class=\"line\"><span class=\"string\">        directory: 日志目录</span></span><br><span class=\"line\"><span class=\"string\">        base_name: 基础文件名</span></span><br><span class=\"line\"><span class=\"string\">        max_files: 保留的最大文件数</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># 获取所有相关文件（包括压缩文件）</span></span><br><span class=\"line\">    files = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> pattern <span class=\"keyword\">in</span> [<span class=\"string\">f&quot;<span class=\"subst\">&#123;base_name&#125;</span>.*.log*&quot;</span>, <span class=\"string\">f&quot;<span class=\"subst\">&#123;base_name&#125;</span>.log*.gz&quot;</span>]:</span><br><span class=\"line\">        files.extend(directory.glob(pattern))</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 按修改时间排序（从旧到新）</span></span><br><span class=\"line\">    files.sort(key=<span class=\"keyword\">lambda</span> f: f.stat().st_mtime)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 删除超出数量的文件</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(files) &gt; max_files:</span><br><span class=\"line\">        <span class=\"keyword\">for</span> f <span class=\"keyword\">in</span> files[:-max_files]:</span><br><span class=\"line\">            f.unlink()</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;✅ 删除过期文件: <span class=\"subst\">&#123;f.name&#125;</span>&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">main</span>():</span><br><span class=\"line\">    log_dir = Path(<span class=\"string\">&quot;/var/log/myapp&quot;</span>)</span><br><span class=\"line\">    log_files = [<span class=\"string\">&quot;access.log&quot;</span>, <span class=\"string\">&quot;error.log&quot;</span>, <span class=\"string\">&quot;app.log&quot;</span>]</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">for</span> log_file <span class=\"keyword\">in</span> log_files:</span><br><span class=\"line\">        full_path = log_dir / log_file</span><br><span class=\"line\">        rotate_log(full_path, max_files=<span class=\"number\">7</span>, max_size_mb=<span class=\"number\">100</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"学习成果示例填写（可照抄）\"><a href=\"#学习成果示例填写（可照抄）\" class=\"headerlink\" title=\"学习成果示例填写（可照抄）\"></a>学习成果示例填写（可照抄）</h2><blockquote>\n<p>可将”示例”内容替换为你自己的时间与截图文件名。</p>\n</blockquote>\n<hr>\n<h3 id=\"截图与证据（示例）\"><a href=\"#截图与证据（示例）\" class=\"headerlink\" title=\"截图与证据（示例）\"></a>截图与证据（示例）</h3><ul>\n<li>日志分析：<code>images/day029_log_analysis.png</code></li>\n<li>规范文档：<code>log_specification.md</code></li>\n<li>标准化脚本：<code>log_normalizer.py</code></li>\n<li>标准化输出：<code>images/day029_normalized_logs.png</code></li>\n<li>CSV 导出：<code>images/day029_csv_export.png</code></li>\n</ul>\n<hr>\n<h3 id=\"关键命令与输出（示例）\"><a href=\"#关键命令与输出（示例）\" class=\"headerlink\" title=\"关键命令与输出（示例）\"></a>关键命令与输出（示例）</h3><p><strong>查看系统日志</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">tail</span> -20 /var/log/syslog</span><br><span class=\"line\">Jan 22 10:30:00 server01 systemd[1]: Started nginx.service</span><br></pre></td></tr></table></figure>\n\n<p><strong>运行日志标准化</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ python log_normalizer.py /tmp/nginx_sample.log</span><br><span class=\"line\">✅ 完成！</span><br><span class=\"line\">   处理记录: 3 条</span><br></pre></td></tr></table></figure>\n\n<p><strong>查看标准化日志</strong>：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;timestamp&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2026-01-22T10:30:00.000Z&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;level&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;INFO&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;event_type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;http_access&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;ip_address&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;192.168.1.10&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;http&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;method&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;GET&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;status_code&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">200</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"结论与反思（示例）\"><a href=\"#结论与反思（示例）\" class=\"headerlink\" title=\"结论与反思（示例）\"></a>结论与反思（示例）</h3><p><strong>我今天搞清楚了</strong>：</p>\n<ul>\n<li>不同类型日志（系统、应用、安全、访问）的区别和用途</li>\n<li>日志关键字段的作用和重要性</li>\n<li>日志规范化和标准化的好处</li>\n<li>如何编写脚本将不同格式日志转换为统一 JSON 格式</li>\n<li>敏感信息脱敏和日志轮转的重要性</li>\n</ul>\n<p><strong>我差点搞混的是</strong>：</p>\n<ul>\n<li>最初不理解 ISO 8601 时间格式的优势</li>\n<li>混淆了日志级别的使用场景</li>\n<li>不清楚结构化日志和字段映射的关系</li>\n</ul>\n<p><strong>明天我要继续补的是</strong>：</p>\n<ul>\n<li>学习 Elasticsearch&#x2F;Kibana 的使用（Day030）</li>\n<li>了解日志告警规则设计（Day031）</li>\n</ul>\n<p><strong>本次学习耗时</strong>：约 3 小时</p>\n<p><strong>掌握程度自评</strong>：</p>\n<ul>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> 😃 完成了所有任务并理解原理</li>\n</ul>\n","categories":["网络安全"],"tags":["网络","安全","学习计划"]}]